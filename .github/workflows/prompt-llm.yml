name: LLM Semantic Analysis

on:
    repository_dispatch:
        types: [prompt-llm]

jobs:
    analyze-intent:
        runs-on: ubuntu-latest
        permissions:
            contents: write
        env:
            GEMINI_API_KEY: ${{ secrets.GEMINI_API_KEY }}

        steps:
            - name: Checkout Repository
              uses: actions/checkout@v4
              with:
                  ref: ${{ github.event.client_payload.branch }}

            - name: Setup Python
              uses: actions/setup-python@v5
              with:
                  python-version: "3.11"

            # FIX: Upgrade the library to the latest version to support 1.5 Flash
            - name: Install Dependencies
              run: pip install --upgrade google-generativeai

            - name: Prompt Gemini
              run: python scripts/prompt_gemini.py

            - name: Commit LLM Response
              run: |
                  git config --global user.name 'JTopas Automation'
                  git config --global user.email 'automation@jtopas.local'
                  git add llm.txt
                  git commit -m "chore: update llm.txt [skip ci]"
                  git pull origin ${{ github.event.client_payload.branch }} --rebase
                  git push origin ${{ github.event.client_payload.branch }}
