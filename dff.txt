diff --git a/jakarta-jmeter/.cvsignore b/jakarta-jmeter/.cvsignore
index 5ef2a1e..3112c02 100644
--- a/jakarta-jmeter/.cvsignore
+++ b/jakarta-jmeter/.cvsignore
@@ -1,2 +1,4 @@
 velocity.log
-bin/classes
+build
+jmeter.log
+dist
diff --git a/jakarta-jmeter/CVS/Entries b/jakarta-jmeter/CVS/Entries
index 92816ae..5e12e02 100644
--- a/jakarta-jmeter/CVS/Entries
+++ b/jakarta-jmeter/CVS/Entries
@@ -1,10 +1,10 @@
-/.cvsignore/1.2/Fri Aug 17 21:21:36 2001//Tv1_7_3
-/LICENSE/1.3/Thu Mar 29 03:01:48 2001//Tv1_7_3
-/README/1.7/Sat May  4 01:02:01 2002//Tv1_7_3
-/build.bat/1.7/Tue May 28 17:30:18 2002//Tv1_7_3
-/build.sh/1.2/Mon Sep 24 13:16:59 2001//Tv1_7_3
-/build.xml/1.70/Wed Aug 14 18:33:15 2002//Tv1_7_3
-/lcp.bat/1.2/Mon Sep 24 12:02:27 2001//Tv1_7_3
+/.cvsignore/1.7/Tue Jan 28 21:30:32 2003//Tv1_8_1
+/LICENSE/1.3/Thu Mar 29 03:01:48 2001//Tv1_8_1
+/README/1.7/Sat May  4 01:02:01 2002//Tv1_8_1
+/build.bat/1.7/Tue May 28 17:30:18 2002//Tv1_8_1
+/build.sh/1.2/Mon Sep 24 13:16:59 2001//Tv1_8_1
+/build.xml/1.90/Mon Feb  3 20:29:00 2003//Tv1_8_1
+/lcp.bat/1.2/Mon Sep 24 12:02:27 2001//Tv1_8_1
 D/bin////
 D/lib////
 D/src////
diff --git a/jakarta-jmeter/CVS/Tag b/jakarta-jmeter/CVS/Tag
index 5f312fe..e2fda28 100644
--- a/jakarta-jmeter/CVS/Tag
+++ b/jakarta-jmeter/CVS/Tag
@@ -1 +1 @@
-Nv1_7_3
+Nv1_8_1
diff --git a/jakarta-jmeter/bin/.cvsignore b/jakarta-jmeter/bin/.cvsignore
new file mode 100644
index 0000000..67bcae4
--- /dev/null
+++ b/jakarta-jmeter/bin/.cvsignore
@@ -0,0 +1,4 @@
+ApacheJMeter.jar
+HTTPSamplerFullTestFile.txt
+jmeter.log
+testresults.txt
diff --git a/jakarta-jmeter/bin/CVS/Entries b/jakarta-jmeter/bin/CVS/Entries
index 0c789da..af71680 100644
--- a/jakarta-jmeter/bin/CVS/Entries
+++ b/jakarta-jmeter/bin/CVS/Entries
@@ -1,9 +1,10 @@
-/jmeter/1.20/Wed Jun  5 03:29:06 2002//Tv1_7_3
-/jmeter-server/1.5/Sat Jun 29 00:36:59 2002//Tv1_7_3
-/jmeter-server.bat/1.5/Wed Jun  5 03:29:06 2002//Tv1_7_3
-/jmeter.bat/1.21/Wed Jun  5 03:29:06 2002//Tv1_7_3
-/jmeter.properties/1.42/Thu Aug  8 16:23:40 2002//Tv1_7_3
-/log4j.conf/1.4/Thu May 23 15:47:03 2002//Tv1_7_3
-/users.dtd/1.1/Wed May  1 02:02:19 2002//Tv1_7_3
-/users.xml/1.1/Wed May  1 02:02:19 2002//Tv1_7_3
+/.cvsignore/1.1/Tue Dec 31 18:05:53 2002//Tv1_8_1
+/jmeter/1.20/Wed Jun  5 03:29:06 2002//Tv1_8_1
+/jmeter-server/1.5/Sat Jun 29 00:36:59 2002//Tv1_8_1
+/jmeter-server.bat/1.5/Wed Jun  5 03:29:06 2002//Tv1_8_1
+/jmeter.bat/1.22/Sun Aug 25 19:42:20 2002//Tv1_8_1
+/jmeter.properties/1.52/Wed Jan 29 19:47:04 2003//Tv1_8_1
+/log4j.conf/1.4/Thu May 23 15:47:03 2002//Tv1_8_1
+/users.dtd/1.1/Wed May  1 02:02:19 2002//Tv1_8_1
+/users.xml/1.1/Wed May  1 02:02:19 2002//Tv1_8_1
 D/testfiles////
diff --git a/jakarta-jmeter/bin/CVS/Tag b/jakarta-jmeter/bin/CVS/Tag
index 5f312fe..e2fda28 100644
--- a/jakarta-jmeter/bin/CVS/Tag
+++ b/jakarta-jmeter/bin/CVS/Tag
@@ -1 +1 @@
-Nv1_7_3
+Nv1_8_1
diff --git a/jakarta-jmeter/bin/jmeter.bat b/jakarta-jmeter/bin/jmeter.bat
index 815c6d0..eb22335 100644
--- a/jakarta-jmeter/bin/jmeter.bat
+++ b/jakarta-jmeter/bin/jmeter.bat
@@ -30,4 +30,4 @@ goto setupArgs
 rem This label provides a place for the argument list loop to break out 
 rem and for NT handling to skip to.
 
-java -Xincgc -jar ApacheJMeter.jar %JMETER_CMD_LINE_ARGS%
+java -Xincgc -jar ApacheJMeter.jar %JMETER_CMD_LINE_ARGS%
\ No newline at end of file
diff --git a/jakarta-jmeter/bin/jmeter.properties b/jakarta-jmeter/bin/jmeter.properties
index 39e6d92..88a5916 100644
--- a/jakarta-jmeter/bin/jmeter.properties
+++ b/jakarta-jmeter/bin/jmeter.properties
@@ -1,6 +1,9 @@
 ################################################################################
 # Apache JMeter Property file
 ################################################################################
+#Preferred GUI language. Comment out to use the JVM default locale's language.
+#language=de
+
 #Paths to search for classes (";" must be the separator)
 search_paths=lib/ext
 
@@ -48,17 +51,63 @@ javax.net.debug=all
 #  Windows = com.sun.java.swing.plaf.windows.WindowsLookAndFeel
 jmeter.laf=javax.swing.plaf.metal.MetalLookAndFeel
 
-#icons
-timer.tree.icon=timer.gif
-listener.tree.icon=ear.gif
-bench.tree.icon=clipboard.gif
-thread.tree.icon=thread.gif
-control.tree.icon=knob.gif
-plan.tree.icon=beaker.gif
-config.tree.icon=leafnode.gif
+#icons -> moved to program code
+#timer.tree.icon=timer.gif
+#listener.tree.icon=ear.gif
+#bench.tree.icon=clipboard.gif
+#thread.tree.icon=thread.gif
+#control.tree.icon=knob.gif
+#plan.tree.icon=beaker.gif
+#config.tree.icon=leafnode.gif
 
 # Remote Hosts - comma delimited
-#remote_hosts=127.0.0.1
+remote_hosts=127.0.0.1
 
 #Components to not display in JMeter GUI
-not_in_menu=Remote Method Configuration,JNDI Configuration,JNDI Lookup Configuration,JNDI Request,Default Controller,org.apache.jmeter.control.DynamicController, org.apache.jmeter.protocol.http.control.Cookie,org.apache.jmeter.protocol.http.control.Authorization,org.apache.jmeter.config.LoginConfig,Header,org.apache.jmeter.protocol.http.config.UrlConfigFull,org.apache.jmeter.protocol.http.config.MultipartUrlConfig
+not_in_menu=Remote Method Configuration,JNDI Configuration,JNDI Lookup Configuration,JNDI Request,Default Controller,org.apache.jmeter.control.DynamicController, org.apache.jmeter.protocol.http.control.Cookie,org.apache.jmeter.protocol.http.control.Authorization,org.apache.jmeter.config.LoginConfig,Header,org.apache.jmeter.protocol.http.config.MultipartUrlConfig
+
+#Logging levels for the logging categories in JMeter.  Correct values are FATAL_ERROR, ERROR, WARN, INFO, and DEBUG
+log_level.jmeter=WARN
+log_level.jmeter.engine=WARN
+log_level.jmeter.gui=WARN
+log_level.jmeter.elements=WARN
+log_level.jmeter.util=WARN
+log_level.jmeter.util.classfinder=WARN
+log_level.jmeter.test=DEBUG
+log_level.jmeter.protocol.http=WARN
+log_level.jmeter.protocol.ftp=WARN
+log_level.jmeter.protocol.jdbc=WARN
+log_level.jmeter.protocol.java=WARN
+log_level.jorphan=ERROR
+
+#Log file for log messages.
+log_file=jmeter.log
+
+
+#---------------------------------------------------------------------------
+# Results file configuration
+#---------------------------------------------------------------------------
+
+# This section helps determine how result data will be saved.
+# The commented out values are the defaults.
+
+# legitimate values: xml, csv, db.  Only xml is currently supported.
+#jmeter.save.saveservice.output_format=xml
+
+# true when field should be saved; false otherwise
+
+#jmeter.save.saveservice.data_type=true
+#jmeter.save.saveservice.label=true
+#jmeter.save.saveservice.response_code=true
+#jmeter.save.saveservice.response_data=false
+#jmeter.save.saveservice.response_message=true
+#jmeter.save.saveservice.successful=true
+#jmeter.save.saveservice.thread_name=true
+#jmeter.save.saveservice.time=true
+
+# legitimate values: none, ms, or a format suitable for SimpleDateFormat
+#jmeter.save.saveservice.timestamp_format=ms
+#jmeter.save.saveservice.timestamp_format=MM/dd/yy HH:mm:ss
+
+# legitimate values: none, first, all
+#jmeter.save.saveservice.assertion_results=none
diff --git a/jakarta-jmeter/bin/testfiles/AssertionTestPlan.jmx b/jakarta-jmeter/bin/testfiles/AssertionTestPlan.jmx
index 4ee191f..e8eaae2 100644
--- a/jakarta-jmeter/bin/testfiles/AssertionTestPlan.jmx
+++ b/jakarta-jmeter/bin/testfiles/AssertionTestPlan.jmx
@@ -1,45 +1,85 @@
-<?xml version="1.0"?>
-
-<TestPlan>
-<threadgroups>
-<ThreadGroup name="Thread Group" numThreads="1" rampUp="0">
-<controllers>
-<LoopController type="org.apache.jmeter.control.LoopController" name="Loop Controller" iterations="1">
-<configElements>
-</configElements>
-<controllers>
-<HttpTestSample type="org.apache.jmeter.protocol.http.control.HttpTestSample" name="HTTP Request" getImages="false">
-<defaultUrl>
-<ConfigElement type="org.apache.jmeter.protocol.http.config.MultipartUrlConfig">
-<property name="PROTOCOL">http</property>
-<property name="domain">jakarta.apache.org</property>
-<property name="arguments"><Arguments>
-</Arguments>
-</property>
-<property name="path">/</property>
-<property name="method">GET</property>
-</ConfigElement></defaultUrl>
-<configElements>
-</configElements>
-<controllers>
-</controllers>
-<assertion name="Assertion" class="org.apache.jmeter.assertions.Assertion" testType="2" testField="sampler.RESPONSE">
-<testString>&lt;/html&gt;</testString>
-</assertion>
-</HttpTestSample>
-
-</controllers>
-</LoopController>
-</controllers>
-<timers>
-</timers>
-<listeners>
-<Filer type="org.apache.jmeter.reporters.Filer" name="File Reporter" verbose="true" append="false" autoFlush="false" viewSubmitData="true" file="assertion.dat"/>
-<JMeterComponent type="org.apache.jmeter.reporters.AssertionReporter" name="Assertion Results"/>
-</listeners>
-</ThreadGroup>
-
-</threadgroups>
-<configElements>
-</configElements>
-</TestPlan>
+<?xml version="1.0" encoding="UTF-8"?>
+<node>
+<testelement class="org.apache.jmeter.testelement.TestPlan">
+<testelement class="org.apache.jmeter.config.Arguments" name="TestPlan.user_defined_variables">
+<property xml:space="preserve" name="TestElement.gui_class">org.apache.jmeter.config.gui.ArgumentsPanel</property>
+<property xml:space="preserve" name="TestElement.test_class">org.apache.jmeter.config.Arguments</property>
+<collection class="java.util.ArrayList" name="Arguments.arguments"/>
+<property xml:space="preserve" name="TestElement.name">Argument List</property>
+</testelement>
+<property xml:space="preserve" name="TestElement.gui_class">org.apache.jmeter.control.gui.TestPlanGui</property>
+<collection class="java.util.LinkedList" name="TestPlan.thread_groups"/>
+<property xml:space="preserve" name="TestElement.test_class">org.apache.jmeter.testelement.TestPlan</property>
+<property xml:space="preserve" name="TestElement.name">Test Plan</property>
+<property xml:space="preserve" name="TestPlan.functional_mode">false</property>
+</testelement>
+<node>
+<testelement class="org.apache.jmeter.threads.ThreadGroup">
+<property xml:space="preserve" name="TestElement.gui_class">org.apache.jmeter.threads.gui.ThreadGroupGui</property>
+<property xml:space="preserve" name="TestElement.test_class">org.apache.jmeter.threads.ThreadGroup</property>
+<testelement class="org.apache.jmeter.control.LoopController" name="ThreadGroup.main_controller">
+<property xml:space="preserve" name="TestElement.gui_class">org.apache.jmeter.control.gui.LoopControlPanel</property>
+<property xml:space="preserve" name="LoopController.loops">1</property>
+<property xml:space="preserve" name="TestElement.test_class">org.apache.jmeter.control.LoopController</property>
+<property xml:space="preserve" name="TestElement.name">Loop Controller</property>
+<property xml:space="preserve" name="LoopController.continue_forever">false</property>
+</testelement>
+<property xml:space="preserve" name="TestElement.name">Thread Group</property>
+<property xml:space="preserve" name="ThreadGroup.num_threads">1</property>
+<property xml:space="preserve" name="ThreadGroup.ramp_time">0</property>
+</testelement>
+<node>
+<testelement class="org.apache.jmeter.protocol.http.sampler.HTTPSampler">
+<property xml:space="preserve" name="HTTPSampler.mimetype"/>
+<property xml:space="preserve" name="TestElement.gui_class">org.apache.jmeter.protocol.http.control.gui.HttpTestSampleGui</property>
+<property xml:space="preserve" name="HTTPSampler.path">/</property>
+<collection class="java.util.ArrayList" name="AbstractSampler.assertions"/>
+<property xml:space="preserve" name="HTTPSampler.FILE_FIELD"/>
+<property xml:space="preserve" name="TestElement.test_class">org.apache.jmeter.protocol.http.sampler.HTTPSampler</property>
+<property xml:space="preserve" name="HTTPSampler.method">GET</property>
+<property xml:space="preserve" name="TestElement.name">HTTP Request</property>
+<property xml:space="preserve" name="HTTPSampler.domain">jakarta.apache.org</property>
+<property xml:space="preserve" name="HTTPSampler.use_keepalive">false</property>
+<property xml:space="preserve" name="HTTPSampler.protocol">http</property>
+<property xml:space="preserve" name="HTTPSampler.follow_redirects">false</property>
+<property xml:space="preserve" name="HTTPSampler.port"/>
+<testelement class="org.apache.jmeter.config.Arguments" name="HTTPsampler.Arguments">
+<property xml:space="preserve" name="TestElement.gui_class">org.apache.jmeter.protocol.http.gui.HTTPArgumentsPanel</property>
+<property xml:space="preserve" name="TestElement.test_class">org.apache.jmeter.config.Arguments</property>
+<collection class="java.util.ArrayList" name="Arguments.arguments"/>
+<property xml:space="preserve" name="TestElement.name"/>
+</testelement>
+<property xml:space="preserve" name="HTTPSampler.FILE_NAME"/>
+</testelement>
+<node>
+<testelement class="org.apache.jmeter.assertions.ResponseAssertion">
+<property xml:space="preserve" name="TestElement.gui_class">org.apache.jmeter.assertions.gui.AssertionGui</property>
+<property xml:space="preserve" name="TestElement.test_class">org.apache.jmeter.assertions.ResponseAssertion</property>
+<property xml:space="preserve" name="TestElement.name">Assertion</property>
+<collection class="java.util.ArrayList" name="Asserion.test_strings">
+<string xml:space="preserve">&lt;/html&gt;</string>
+</collection>
+<property xml:space="preserve" name="Assertion.test_field">Assertion.response_data</property>
+<property xml:space="preserve" name="Assertion.test_type">2</property>
+</testelement>
+</node>
+</node>
+<node>
+<testelement class="org.apache.jmeter.reporters.ResultCollector">
+<property xml:space="preserve" name="TestElement.gui_class">org.apache.jmeter.visualizers.GraphVisualizer</property>
+<property xml:space="preserve" name="TestElement.test_class">org.apache.jmeter.reporters.ResultCollector</property>
+<property xml:space="preserve" name="TestElement.name">File Reporter</property>
+<property xml:space="preserve" name="filename">assertion.dat</property>
+<property xml:space="preserve" name="ResultCollector.error_logging">false</property>
+</testelement>
+</node>
+<node>
+<testelement class="org.apache.jmeter.reporters.ResultCollector">
+<property xml:space="preserve" name="TestElement.gui_class">org.apache.jmeter.visualizers.AssertionVisualizer</property>
+<property xml:space="preserve" name="TestElement.test_class">org.apache.jmeter.reporters.ResultCollector</property>
+<property xml:space="preserve" name="TestElement.name">Assertion Results</property>
+<property xml:space="preserve" name="ResultCollector.error_logging">false</property>
+</testelement>
+</node>
+</node>
+</node>
diff --git a/jakarta-jmeter/bin/testfiles/AuthManagerTestPlan.jmx b/jakarta-jmeter/bin/testfiles/AuthManagerTestPlan.jmx
index 212449d..664454f 100644
--- a/jakarta-jmeter/bin/testfiles/AuthManagerTestPlan.jmx
+++ b/jakarta-jmeter/bin/testfiles/AuthManagerTestPlan.jmx
@@ -1,90 +1,143 @@
-<?xml version="1.0"?>
-
-<TestPlan>
-<threadgroups>
-<ThreadGroup name="Thread Group" numThreads="1" rampUp="0">
-<controllers>
-<LoopController type="org.apache.jmeter.control.LoopController" name="Loop Controller" iterations="1">
-<configElements>
-<AuthManager name="HTTP Authorization Manager">
-<ConfigElement type="org.apache.jmeter.protocol.http.control.Authorization">
-<property name="password">spot</property>
-<property name="url">http://localhost/secret</property>
-<property name="username">kevin</property>
-</ConfigElement>
-</AuthManager>
-
-<ConfigElement type="org.apache.jmeter.protocol.http.config.UrlConfig">
-<property name="name">HTTP Request Defaults</property>
-<property name="PROTOCOL">http</property>
-<property name="domain">localhost</property>
-<property name="arguments"><Arguments>
-</Arguments>
-</property>
-<property name="path">/</property>
-<property name="method">GET</property>
-</ConfigElement>
-</configElements>
-<controllers>
-<HttpTestSample type="org.apache.jmeter.protocol.http.control.HttpTestSample" name="SecretPage1" getImages="false">
-<defaultUrl>
-<ConfigElement type="org.apache.jmeter.protocol.http.config.MultipartUrlConfig">
-<property name="PROTOCOL">http</property>
-<property name="arguments"><Arguments>
-</Arguments>
-</property>
-<property name="path">/secret/index.html</property>
-<property name="method">GET</property>
-</ConfigElement></defaultUrl>
-<configElements>
-</configElements>
-<controllers>
-</controllers>
-</HttpTestSample>
-
-<HttpTestSample type="org.apache.jmeter.protocol.http.control.HttpTestSample" name="SecretPage2" getImages="false">
-<defaultUrl>
-<ConfigElement type="org.apache.jmeter.protocol.http.config.MultipartUrlConfig">
-<property name="PROTOCOL">http</property>
-<property name="arguments"><Arguments>
-</Arguments>
-</property>
-<property name="path">/secret/index2.html</property>
-<property name="method">GET</property>
-</ConfigElement></defaultUrl>
-<configElements>
-</configElements>
-<controllers>
-</controllers>
-</HttpTestSample>
-
-<HttpTestSample type="org.apache.jmeter.protocol.http.control.HttpTestSample" name="NoSecretPage" getImages="false">
-<defaultUrl>
-<ConfigElement type="org.apache.jmeter.protocol.http.config.MultipartUrlConfig">
-<property name="PROTOCOL">http</property>
-<property name="arguments"><Arguments>
-</Arguments>
-</property>
-<property name="path">/index.html</property>
-<property name="method">GET</property>
-</ConfigElement></defaultUrl>
-<configElements>
-</configElements>
-<controllers>
-</controllers>
-</HttpTestSample>
-
-</controllers>
-</LoopController>
-</controllers>
-<timers>
-</timers>
-<listeners>
-<Filer type="org.apache.jmeter.reporters.Filer" name="File Reporter" verbose="true" append="false" autoFlush="false" viewSubmitData="true" file="auth-manager.dat"/>
-</listeners>
-</ThreadGroup>
-
-</threadgroups>
-<configElements>
-</configElements>
-</TestPlan>
+<?xml version="1.0" encoding="UTF-8"?>
+<node>
+<testelement class="org.apache.jmeter.testelement.TestPlan">
+<testelement class="org.apache.jmeter.config.Arguments" name="TestPlan.user_defined_variables">
+<property xml:space="preserve" name="TestElement.gui_class">org.apache.jmeter.config.gui.ArgumentsPanel</property>
+<property xml:space="preserve" name="TestElement.test_class">org.apache.jmeter.config.Arguments</property>
+<collection class="java.util.ArrayList" name="Arguments.arguments"/>
+<property xml:space="preserve" name="TestElement.name">Argument List</property>
+</testelement>
+<property xml:space="preserve" name="TestElement.gui_class">org.apache.jmeter.control.gui.TestPlanGui</property>
+<collection class="java.util.LinkedList" name="TestPlan.thread_groups"/>
+<property xml:space="preserve" name="TestElement.test_class">org.apache.jmeter.testelement.TestPlan</property>
+<property xml:space="preserve" name="TestElement.name">Test Plan</property>
+<property xml:space="preserve" name="TestPlan.functional_mode">false</property>
+</testelement>
+<node>
+<testelement class="org.apache.jmeter.threads.ThreadGroup">
+<property xml:space="preserve" name="TestElement.gui_class">org.apache.jmeter.threads.gui.ThreadGroupGui</property>
+<property xml:space="preserve" name="TestElement.test_class">org.apache.jmeter.threads.ThreadGroup</property>
+<testelement class="org.apache.jmeter.control.LoopController" name="ThreadGroup.main_controller">
+<property xml:space="preserve" name="TestElement.gui_class">org.apache.jmeter.control.gui.LoopControlPanel</property>
+<property xml:space="preserve" name="LoopController.loops">1</property>
+<property xml:space="preserve" name="TestElement.test_class">org.apache.jmeter.control.LoopController</property>
+<property xml:space="preserve" name="TestElement.name">Loop Controller</property>
+<property xml:space="preserve" name="LoopController.continue_forever">false</property>
+</testelement>
+<property xml:space="preserve" name="TestElement.name">Thread Group</property>
+<property xml:space="preserve" name="ThreadGroup.num_threads">1</property>
+<property xml:space="preserve" name="ThreadGroup.ramp_time">0</property>
+</testelement>
+<node>
+<testelement class="org.apache.jmeter.protocol.http.control.AuthManager">
+<property xml:space="preserve" name="TestElement.gui_class">org.apache.jmeter.protocol.http.gui.AuthPanel</property>
+<property xml:space="preserve" name="TestElement.test_class">org.apache.jmeter.protocol.http.control.AuthManager</property>
+<property xml:space="preserve" name="TestElement.name">HTTP Authorization Manager</property>
+<collection class="java.util.ArrayList" name="AuthManager.auth_list">
+<testelement class="org.apache.jmeter.protocol.http.control.Authorization">
+<property xml:space="preserve" name="Authorization.url">http://localhost/secret</property>
+<property xml:space="preserve" name="Authorization.password">spot</property>
+<property xml:space="preserve" name="Authorization.username">kevin</property>
+</testelement>
+</collection>
+</testelement>
+</node>
+<node>
+<testelement class="org.apache.jmeter.config.ConfigTestElement">
+<property xml:space="preserve" name="HTTPSampler.path">/</property>
+<property xml:space="preserve" name="TestElement.gui_class">org.apache.jmeter.protocol.http.config.gui.HttpDefaultsGui</property>
+<property xml:space="preserve" name="TestElement.test_class">org.apache.jmeter.config.ConfigTestElement</property>
+<property xml:space="preserve" name="TestElement.name">HTTP Request Defaults</property>
+<property xml:space="preserve" name="HTTPSampler.domain">localhost</property>
+<property xml:space="preserve" name="HTTPSampler.port"/>
+<testelement class="org.apache.jmeter.config.Arguments" name="HTTPsampler.Arguments">
+<property xml:space="preserve" name="TestElement.gui_class">org.apache.jmeter.protocol.http.gui.HTTPArgumentsPanel</property>
+<property xml:space="preserve" name="TestElement.test_class">org.apache.jmeter.config.Arguments</property>
+<collection class="java.util.ArrayList" name="Arguments.arguments"/>
+<property xml:space="preserve" name="TestElement.name"/>
+</testelement>
+</testelement>
+</node>
+<node>
+<testelement class="org.apache.jmeter.protocol.http.sampler.HTTPSampler">
+<property xml:space="preserve" name="HTTPSampler.mimetype"/>
+<property xml:space="preserve" name="TestElement.gui_class">org.apache.jmeter.protocol.http.control.gui.HttpTestSampleGui</property>
+<property xml:space="preserve" name="HTTPSampler.path">/secret/index.html</property>
+<collection class="java.util.ArrayList" name="AbstractSampler.assertions"/>
+<property xml:space="preserve" name="HTTPSampler.FILE_FIELD"/>
+<property xml:space="preserve" name="TestElement.test_class">org.apache.jmeter.protocol.http.sampler.HTTPSampler</property>
+<property xml:space="preserve" name="HTTPSampler.method">GET</property>
+<property xml:space="preserve" name="TestElement.name">SecretPage1</property>
+<property xml:space="preserve" name="HTTPSampler.domain"/>
+<property xml:space="preserve" name="HTTPSampler.use_keepalive">false</property>
+<property xml:space="preserve" name="HTTPSampler.protocol">http</property>
+<property xml:space="preserve" name="HTTPSampler.follow_redirects">false</property>
+<property xml:space="preserve" name="HTTPSampler.port"/>
+<testelement class="org.apache.jmeter.config.Arguments" name="HTTPsampler.Arguments">
+<property xml:space="preserve" name="TestElement.gui_class">org.apache.jmeter.protocol.http.gui.HTTPArgumentsPanel</property>
+<property xml:space="preserve" name="TestElement.test_class">org.apache.jmeter.config.Arguments</property>
+<collection class="java.util.ArrayList" name="Arguments.arguments"/>
+<property xml:space="preserve" name="TestElement.name"/>
+</testelement>
+<property xml:space="preserve" name="HTTPSampler.FILE_NAME"/>
+</testelement>
+</node>
+<node>
+<testelement class="org.apache.jmeter.protocol.http.sampler.HTTPSampler">
+<property xml:space="preserve" name="HTTPSampler.mimetype"/>
+<property xml:space="preserve" name="TestElement.gui_class">org.apache.jmeter.protocol.http.control.gui.HttpTestSampleGui</property>
+<property xml:space="preserve" name="HTTPSampler.path">/secret/index2.html</property>
+<collection class="java.util.ArrayList" name="AbstractSampler.assertions"/>
+<property xml:space="preserve" name="HTTPSampler.FILE_FIELD"/>
+<property xml:space="preserve" name="TestElement.test_class">org.apache.jmeter.protocol.http.sampler.HTTPSampler</property>
+<property xml:space="preserve" name="HTTPSampler.method">GET</property>
+<property xml:space="preserve" name="TestElement.name">SecretPage2</property>
+<property xml:space="preserve" name="HTTPSampler.domain"/>
+<property xml:space="preserve" name="HTTPSampler.use_keepalive">false</property>
+<property xml:space="preserve" name="HTTPSampler.protocol">http</property>
+<property xml:space="preserve" name="HTTPSampler.follow_redirects">false</property>
+<property xml:space="preserve" name="HTTPSampler.port"/>
+<testelement class="org.apache.jmeter.config.Arguments" name="HTTPsampler.Arguments">
+<property xml:space="preserve" name="TestElement.gui_class">org.apache.jmeter.protocol.http.gui.HTTPArgumentsPanel</property>
+<property xml:space="preserve" name="TestElement.test_class">org.apache.jmeter.config.Arguments</property>
+<collection class="java.util.ArrayList" name="Arguments.arguments"/>
+<property xml:space="preserve" name="TestElement.name"/>
+</testelement>
+<property xml:space="preserve" name="HTTPSampler.FILE_NAME"/>
+</testelement>
+</node>
+<node>
+<testelement class="org.apache.jmeter.protocol.http.sampler.HTTPSampler">
+<property xml:space="preserve" name="HTTPSampler.mimetype"/>
+<property xml:space="preserve" name="TestElement.gui_class">org.apache.jmeter.protocol.http.control.gui.HttpTestSampleGui</property>
+<property xml:space="preserve" name="HTTPSampler.path">/index.html</property>
+<collection class="java.util.ArrayList" name="AbstractSampler.assertions"/>
+<property xml:space="preserve" name="HTTPSampler.FILE_FIELD"/>
+<property xml:space="preserve" name="TestElement.test_class">org.apache.jmeter.protocol.http.sampler.HTTPSampler</property>
+<property xml:space="preserve" name="HTTPSampler.method">GET</property>
+<property xml:space="preserve" name="TestElement.name">NoSecretPage</property>
+<property xml:space="preserve" name="HTTPSampler.domain"/>
+<property xml:space="preserve" name="HTTPSampler.use_keepalive">false</property>
+<property xml:space="preserve" name="HTTPSampler.protocol">http</property>
+<property xml:space="preserve" name="HTTPSampler.follow_redirects">false</property>
+<property xml:space="preserve" name="HTTPSampler.port"/>
+<testelement class="org.apache.jmeter.config.Arguments" name="HTTPsampler.Arguments">
+<property xml:space="preserve" name="TestElement.gui_class">org.apache.jmeter.protocol.http.gui.HTTPArgumentsPanel</property>
+<property xml:space="preserve" name="TestElement.test_class">org.apache.jmeter.config.Arguments</property>
+<collection class="java.util.ArrayList" name="Arguments.arguments"/>
+<property xml:space="preserve" name="TestElement.name"/>
+</testelement>
+<property xml:space="preserve" name="HTTPSampler.FILE_NAME"/>
+</testelement>
+</node>
+<node>
+<testelement class="org.apache.jmeter.reporters.ResultCollector">
+<property xml:space="preserve" name="TestElement.gui_class">org.apache.jmeter.visualizers.GraphVisualizer</property>
+<property xml:space="preserve" name="TestElement.test_class">org.apache.jmeter.reporters.ResultCollector</property>
+<property xml:space="preserve" name="TestElement.name">File Reporter</property>
+<property xml:space="preserve" name="filename">auth-manager.dat</property>
+<property xml:space="preserve" name="ResultCollector.error_logging">false</property>
+</testelement>
+</node>
+</node>
+</node>
diff --git a/jakarta-jmeter/bin/testfiles/CVS/Entries b/jakarta-jmeter/bin/testfiles/CVS/Entries
index 99a2da3..f88ed1f 100644
--- a/jakarta-jmeter/bin/testfiles/CVS/Entries
+++ b/jakarta-jmeter/bin/testfiles/CVS/Entries
@@ -1,15 +1,15 @@
-/AssertionTestPlan.jmx/1.1/Wed Aug  7 18:49:37 2002//Tv1_7_3
-/AuthManagerTestPlan.jmx/1.1/Wed Aug  7 18:49:37 2002//Tv1_7_3
-/HeaderManagerTestPlan.jmx/1.1/Wed Aug  7 18:49:37 2002//Tv1_7_3
-/InterleaveTestPlan.jmx/1.1/Wed Aug  7 18:49:37 2002//Tv1_7_3
-/InterleaveTestPlan2.jmx/1.1/Wed Aug  7 18:49:37 2002//Tv1_7_3
-/LoopTestPlan.jmx/1.1/Wed Aug  7 18:49:37 2002//Tv1_7_3
-/Modification Manager.jmx/1.1/Fri Aug 17 21:21:36 2001//Tv1_7_3
-/OnceOnlyTestPlan.jmx/1.1/Wed Aug  7 18:49:37 2002//Tv1_7_3
-/ProxyServerTestPlan.jmx/1.1/Wed Aug  7 18:49:37 2002//Tv1_7_3
-/SimpleTestPlan.jmx/1.1/Wed Aug  7 18:49:37 2002//Tv1_7_3
-/Test Plan.jmx/1.1/Fri Aug 17 21:21:36 2001//Tv1_7_3
-/URLRewritingExample.jmx/1.1/Wed Aug  7 18:49:37 2002//Tv1_7_3
-/assertion.jmx/1.1/Thu Jun 13 00:45:14 2002//Tv1_7_3
-/proxy.jmx/1.1/Wed Mar  6 03:52:27 2002//Tv1_7_3
+/AssertionTestPlan.jmx/1.2/Sun Dec 29 14:20:54 2002//Tv1_8_1
+/AuthManagerTestPlan.jmx/1.2/Sun Dec 29 14:20:55 2002//Tv1_8_1
+/HeaderManagerTestPlan.jmx/1.2/Sun Dec 29 14:20:55 2002//Tv1_8_1
+/InterleaveTestPlan.jmx/1.2/Sun Dec 29 14:20:55 2002//Tv1_8_1
+/InterleaveTestPlan2.jmx/1.2/Sun Dec 29 14:20:55 2002//Tv1_8_1
+/LoopTestPlan.jmx/1.2/Sun Dec 29 14:20:55 2002//Tv1_8_1
+/Modification Manager.jmx/1.2/Sun Dec 29 14:20:55 2002//Tv1_8_1
+/OnceOnlyTestPlan.jmx/1.2/Sun Dec 29 14:20:55 2002//Tv1_8_1
+/ProxyServerTestPlan.jmx/1.2/Sun Dec 29 14:20:55 2002//Tv1_8_1
+/SimpleTestPlan.jmx/1.2/Sun Dec 29 14:20:55 2002//Tv1_8_1
+/Test Plan.jmx/1.1/Fri Aug 17 21:21:36 2001//Tv1_8_1
+/URLRewritingExample.jmx/1.1/Wed Aug  7 18:49:37 2002//Tv1_8_1
+/assertion.jmx/1.1/Thu Jun 13 00:45:14 2002//Tv1_8_1
+/proxy.jmx/1.2/Sun Dec 29 14:20:55 2002//Tv1_8_1
 D
diff --git a/jakarta-jmeter/bin/testfiles/CVS/Tag b/jakarta-jmeter/bin/testfiles/CVS/Tag
index 5f312fe..e2fda28 100644
--- a/jakarta-jmeter/bin/testfiles/CVS/Tag
+++ b/jakarta-jmeter/bin/testfiles/CVS/Tag
@@ -1 +1 @@
-Nv1_7_3
+Nv1_8_1
diff --git a/jakarta-jmeter/bin/testfiles/HeaderManagerTestPlan.jmx b/jakarta-jmeter/bin/testfiles/HeaderManagerTestPlan.jmx
index 6869b23..a34105a 100644
--- a/jakarta-jmeter/bin/testfiles/HeaderManagerTestPlan.jmx
+++ b/jakarta-jmeter/bin/testfiles/HeaderManagerTestPlan.jmx
@@ -1,48 +1,78 @@
-<?xml version="1.0"?>
-
-<TestPlan>
-<threadgroups>
-<ThreadGroup name="Thread Group" numThreads="1" rampUp="0">
-<controllers>
-<LoopController type="org.apache.jmeter.control.LoopController" name="Loop Controller" iterations="1">
-<configElements>
-<HeaderManager name="HTTP Header Manager">
-<ConfigElement type="org.apache.jmeter.protocol.http.control.Header">
-<property name="name">User-Agent</property>
-<property name="value">Mozilla/4.0 (compatible; MSIE 5.5; Windows 98)</property>
-</ConfigElement>
-</HeaderManager>
-
-</configElements>
-<controllers>
-<HttpTestSample type="org.apache.jmeter.protocol.http.control.HttpTestSample" name="HTTP Request" getImages="false">
-<defaultUrl>
-<ConfigElement type="org.apache.jmeter.protocol.http.config.MultipartUrlConfig">
-<property name="PROTOCOL">http</property>
-<property name="domain">jakarta.apache.org</property>
-<property name="arguments"><Arguments>
-</Arguments>
-</property>
-<property name="path">/</property>
-<property name="method">GET</property>
-</ConfigElement></defaultUrl>
-<configElements>
-</configElements>
-<controllers>
-</controllers>
-</HttpTestSample>
-
-</controllers>
-</LoopController>
-</controllers>
-<timers>
-</timers>
-<listeners>
-<Filer type="org.apache.jmeter.reporters.Filer" name="File Reporter" verbose="true" append="false" autoFlush="false" viewSubmitData="true" file="header-manager.dat"/>
-</listeners>
-</ThreadGroup>
-
-</threadgroups>
-<configElements>
-</configElements>
-</TestPlan>
+<?xml version="1.0" encoding="UTF-8"?>
+<node>
+<testelement class="org.apache.jmeter.testelement.TestPlan">
+<testelement class="org.apache.jmeter.config.Arguments" name="TestPlan.user_defined_variables">
+<property xml:space="preserve" name="TestElement.gui_class">org.apache.jmeter.config.gui.ArgumentsPanel</property>
+<property xml:space="preserve" name="TestElement.test_class">org.apache.jmeter.config.Arguments</property>
+<collection class="java.util.ArrayList" name="Arguments.arguments"/>
+<property xml:space="preserve" name="TestElement.name">Argument List</property>
+</testelement>
+<property xml:space="preserve" name="TestElement.gui_class">org.apache.jmeter.control.gui.TestPlanGui</property>
+<collection class="java.util.LinkedList" name="TestPlan.thread_groups"/>
+<property xml:space="preserve" name="TestElement.test_class">org.apache.jmeter.testelement.TestPlan</property>
+<property xml:space="preserve" name="TestElement.name">Test Plan</property>
+<property xml:space="preserve" name="TestPlan.functional_mode">false</property>
+</testelement>
+<node>
+<testelement class="org.apache.jmeter.threads.ThreadGroup">
+<property xml:space="preserve" name="TestElement.gui_class">org.apache.jmeter.threads.gui.ThreadGroupGui</property>
+<property xml:space="preserve" name="TestElement.test_class">org.apache.jmeter.threads.ThreadGroup</property>
+<testelement class="org.apache.jmeter.control.LoopController" name="ThreadGroup.main_controller">
+<property xml:space="preserve" name="TestElement.gui_class">org.apache.jmeter.control.gui.LoopControlPanel</property>
+<property xml:space="preserve" name="LoopController.loops">1</property>
+<property xml:space="preserve" name="TestElement.test_class">org.apache.jmeter.control.LoopController</property>
+<property xml:space="preserve" name="TestElement.name">Loop Controller</property>
+<property xml:space="preserve" name="LoopController.continue_forever">false</property>
+</testelement>
+<property xml:space="preserve" name="TestElement.name">Thread Group</property>
+<property xml:space="preserve" name="ThreadGroup.num_threads">1</property>
+<property xml:space="preserve" name="ThreadGroup.ramp_time">0</property>
+</testelement>
+<node>
+<testelement class="org.apache.jmeter.protocol.http.control.HeaderManager">
+<property xml:space="preserve" name="TestElement.gui_class">org.apache.jmeter.protocol.http.gui.HeaderPanel</property>
+<property xml:space="preserve" name="TestElement.test_class">org.apache.jmeter.protocol.http.control.HeaderManager</property>
+<property xml:space="preserve" name="TestElement.name">HTTP Header Manager</property>
+<collection class="java.util.ArrayList" name="HeaderManager.headers">
+<testelement class="org.apache.jmeter.protocol.http.control.Header">
+<property xml:space="preserve" name="Header.value">Mozilla/4.0 (compatible; MSIE 5.5; Windows 98)</property>
+<property xml:space="preserve" name="TestElement.name">User-Agent</property>
+</testelement>
+</collection>
+</testelement>
+</node>
+<node>
+<testelement class="org.apache.jmeter.protocol.http.sampler.HTTPSampler">
+<property xml:space="preserve" name="HTTPSampler.mimetype"/>
+<property xml:space="preserve" name="TestElement.gui_class">org.apache.jmeter.protocol.http.control.gui.HttpTestSampleGui</property>
+<property xml:space="preserve" name="HTTPSampler.path">/</property>
+<collection class="java.util.ArrayList" name="AbstractSampler.assertions"/>
+<property xml:space="preserve" name="HTTPSampler.FILE_FIELD"/>
+<property xml:space="preserve" name="TestElement.test_class">org.apache.jmeter.protocol.http.sampler.HTTPSampler</property>
+<property xml:space="preserve" name="HTTPSampler.method">GET</property>
+<property xml:space="preserve" name="TestElement.name">HTTP Request</property>
+<property xml:space="preserve" name="HTTPSampler.domain">jakarta.apache.org</property>
+<property xml:space="preserve" name="HTTPSampler.use_keepalive">false</property>
+<property xml:space="preserve" name="HTTPSampler.protocol">http</property>
+<property xml:space="preserve" name="HTTPSampler.follow_redirects">false</property>
+<property xml:space="preserve" name="HTTPSampler.port"/>
+<testelement class="org.apache.jmeter.config.Arguments" name="HTTPsampler.Arguments">
+<property xml:space="preserve" name="TestElement.gui_class">org.apache.jmeter.protocol.http.gui.HTTPArgumentsPanel</property>
+<property xml:space="preserve" name="TestElement.test_class">org.apache.jmeter.config.Arguments</property>
+<collection class="java.util.ArrayList" name="Arguments.arguments"/>
+<property xml:space="preserve" name="TestElement.name"/>
+</testelement>
+<property xml:space="preserve" name="HTTPSampler.FILE_NAME"/>
+</testelement>
+</node>
+<node>
+<testelement class="org.apache.jmeter.reporters.ResultCollector">
+<property xml:space="preserve" name="TestElement.gui_class">org.apache.jmeter.visualizers.GraphVisualizer</property>
+<property xml:space="preserve" name="TestElement.test_class">org.apache.jmeter.reporters.ResultCollector</property>
+<property xml:space="preserve" name="TestElement.name">File Reporter</property>
+<property xml:space="preserve" name="filename">header-manager.dat</property>
+<property xml:space="preserve" name="ResultCollector.error_logging">false</property>
+</testelement>
+</node>
+</node>
+</node>
diff --git a/jakarta-jmeter/bin/testfiles/InterleaveTestPlan.jmx b/jakarta-jmeter/bin/testfiles/InterleaveTestPlan.jmx
index d5bf681..bece280 100644
--- a/jakarta-jmeter/bin/testfiles/InterleaveTestPlan.jmx
+++ b/jakarta-jmeter/bin/testfiles/InterleaveTestPlan.jmx
@@ -1,87 +1,137 @@
-<?xml version="1.0"?>
-
-<TestPlan>
-<threadgroups>
-<ThreadGroup name="Jakarta Users" numThreads="2" rampUp="0">
-<controllers>
-<LoopController type="org.apache.jmeter.control.LoopController" name="Loop Controller" iterations="5">
-<configElements>
-</configElements>
-<controllers>
-<Controller type="org.apache.jmeter.control.InterleaveControl" name="Interleave Controller">
-<configElements>
-<ConfigElement type="org.apache.jmeter.protocol.http.config.UrlConfig">
-<property name="name">Defaults</property>
-<property name="PROTOCOL">http</property>
-<property name="arguments"><Arguments>
-</Arguments>
-</property>
-<property name="method">GET</property>
-</ConfigElement>
-</configElements>
-<controllers>
-<HttpTestSample type="org.apache.jmeter.protocol.http.control.HttpTestSample" name="News Page" getImages="false">
-<defaultUrl>
-<ConfigElement type="org.apache.jmeter.protocol.http.config.MultipartUrlConfig">
-<property name="PROTOCOL">http</property>
-<property name="domain"></property>
-<property name="arguments"><Arguments>
-</Arguments>
-</property>
-<property name="path">/site/news.html</property>
-<property name="method">GET</property>
-</ConfigElement></defaultUrl>
-<configElements>
-</configElements>
-<controllers>
-</controllers>
-</HttpTestSample>
-
-<HttpTestSample type="org.apache.jmeter.protocol.http.control.HttpTestSample" name="FAQ Page" getImages="false">
-<defaultUrl>
-<ConfigElement type="org.apache.jmeter.protocol.http.config.MultipartUrlConfig">
-<property name="PROTOCOL">http</property>
-<property name="arguments"><Arguments>
-</Arguments>
-</property>
-<property name="path">/site/faqs.html</property>
-<property name="method">GET</property>
-</ConfigElement></defaultUrl>
-<configElements>
-</configElements>
-<controllers>
-</controllers>
-</HttpTestSample>
-
-<HttpTestSample type="org.apache.jmeter.protocol.http.control.HttpTestSample" name="Gump Page" getImages="false">
-<defaultUrl>
-<ConfigElement type="org.apache.jmeter.protocol.http.config.MultipartUrlConfig">
-<property name="PROTOCOL">http</property>
-<property name="arguments"><Arguments>
-</Arguments>
-</property>
-<property name="path">/gump</property>
-<property name="method">GET</property>
-</ConfigElement></defaultUrl>
-<configElements>
-</configElements>
-<controllers>
-</controllers>
-</HttpTestSample>
-
-</controllers>
-</Controller>
-</controllers>
-</LoopController>
-</controllers>
-<timers>
-</timers>
-<listeners>
-<Filer type="org.apache.jmeter.reporters.Filer" name="File Reporter" verbose="true" append="false" autoFlush="false" viewSubmitData="true" file="interleave-test.dat"/>
-</listeners>
-</ThreadGroup>
-
-</threadgroups>
-<configElements>
-</configElements>
-</TestPlan>
+<?xml version="1.0" encoding="UTF-8"?>
+<node>
+<testelement class="org.apache.jmeter.testelement.TestPlan">
+<testelement class="org.apache.jmeter.config.Arguments" name="TestPlan.user_defined_variables">
+<property xml:space="preserve" name="TestElement.gui_class">org.apache.jmeter.config.gui.ArgumentsPanel</property>
+<property xml:space="preserve" name="TestElement.test_class">org.apache.jmeter.config.Arguments</property>
+<collection class="java.util.ArrayList" name="Arguments.arguments"/>
+<property xml:space="preserve" name="TestElement.name">Argument List</property>
+</testelement>
+<property xml:space="preserve" name="TestElement.gui_class">org.apache.jmeter.control.gui.TestPlanGui</property>
+<collection class="java.util.LinkedList" name="TestPlan.thread_groups"/>
+<property xml:space="preserve" name="TestElement.test_class">org.apache.jmeter.testelement.TestPlan</property>
+<property xml:space="preserve" name="TestElement.name">Test Plan</property>
+<property xml:space="preserve" name="TestPlan.functional_mode">false</property>
+</testelement>
+<node>
+<testelement class="org.apache.jmeter.threads.ThreadGroup">
+<property xml:space="preserve" name="TestElement.gui_class">org.apache.jmeter.threads.gui.ThreadGroupGui</property>
+<property xml:space="preserve" name="TestElement.test_class">org.apache.jmeter.threads.ThreadGroup</property>
+<testelement class="org.apache.jmeter.control.LoopController" name="ThreadGroup.main_controller">
+<property xml:space="preserve" name="TestElement.gui_class">org.apache.jmeter.control.gui.LoopControlPanel</property>
+<property xml:space="preserve" name="LoopController.loops">5</property>
+<property xml:space="preserve" name="TestElement.test_class">org.apache.jmeter.control.LoopController</property>
+<property xml:space="preserve" name="TestElement.name">Loop Controller</property>
+<property xml:space="preserve" name="LoopController.continue_forever">false</property>
+</testelement>
+<property xml:space="preserve" name="TestElement.name">Jakarta Users</property>
+<property xml:space="preserve" name="ThreadGroup.num_threads">2</property>
+<property xml:space="preserve" name="ThreadGroup.ramp_time">0</property>
+</testelement>
+<node>
+<testelement class="org.apache.jmeter.control.InterleaveControl">
+<property xml:space="preserve" name="TestElement.gui_class">org.apache.jmeter.control.gui.InterleaveControlGui</property>
+<property xml:space="preserve" name="TestElement.test_class">org.apache.jmeter.control.InterleaveControl</property>
+<property xml:space="preserve" name="InterleaveControl.style">0</property>
+<property xml:space="preserve" name="TestElement.name">Interleave Controller</property>
+</testelement>
+<node>
+<testelement class="org.apache.jmeter.config.ConfigTestElement">
+<property xml:space="preserve" name="HTTPSampler.path"/>
+<property xml:space="preserve" name="TestElement.gui_class">org.apache.jmeter.protocol.http.config.gui.HttpDefaultsGui</property>
+<property xml:space="preserve" name="TestElement.test_class">org.apache.jmeter.config.ConfigTestElement</property>
+<property xml:space="preserve" name="TestElement.name">Defaults</property>
+<property xml:space="preserve" name="HTTPSampler.domain"/>
+<property xml:space="preserve" name="HTTPSampler.port"/>
+<testelement class="org.apache.jmeter.config.Arguments" name="HTTPsampler.Arguments">
+<property xml:space="preserve" name="TestElement.gui_class">org.apache.jmeter.protocol.http.gui.HTTPArgumentsPanel</property>
+<property xml:space="preserve" name="TestElement.test_class">org.apache.jmeter.config.Arguments</property>
+<collection class="java.util.ArrayList" name="Arguments.arguments"/>
+<property xml:space="preserve" name="TestElement.name"/>
+</testelement>
+</testelement>
+</node>
+<node>
+<testelement class="org.apache.jmeter.protocol.http.sampler.HTTPSampler">
+<property xml:space="preserve" name="HTTPSampler.mimetype"/>
+<property xml:space="preserve" name="TestElement.gui_class">org.apache.jmeter.protocol.http.control.gui.HttpTestSampleGui</property>
+<property xml:space="preserve" name="HTTPSampler.path">/site/news.html</property>
+<collection class="java.util.ArrayList" name="AbstractSampler.assertions"/>
+<property xml:space="preserve" name="HTTPSampler.FILE_FIELD"/>
+<property xml:space="preserve" name="TestElement.test_class">org.apache.jmeter.protocol.http.sampler.HTTPSampler</property>
+<property xml:space="preserve" name="HTTPSampler.method">GET</property>
+<property xml:space="preserve" name="TestElement.name">News Page</property>
+<property xml:space="preserve" name="HTTPSampler.domain"/>
+<property xml:space="preserve" name="HTTPSampler.use_keepalive">false</property>
+<property xml:space="preserve" name="HTTPSampler.protocol">http</property>
+<property xml:space="preserve" name="HTTPSampler.follow_redirects">false</property>
+<property xml:space="preserve" name="HTTPSampler.port"/>
+<testelement class="org.apache.jmeter.config.Arguments" name="HTTPsampler.Arguments">
+<property xml:space="preserve" name="TestElement.gui_class">org.apache.jmeter.protocol.http.gui.HTTPArgumentsPanel</property>
+<property xml:space="preserve" name="TestElement.test_class">org.apache.jmeter.config.Arguments</property>
+<collection class="java.util.ArrayList" name="Arguments.arguments"/>
+<property xml:space="preserve" name="TestElement.name"/>
+</testelement>
+<property xml:space="preserve" name="HTTPSampler.FILE_NAME"/>
+</testelement>
+</node>
+<node>
+<testelement class="org.apache.jmeter.protocol.http.sampler.HTTPSampler">
+<property xml:space="preserve" name="HTTPSampler.mimetype"/>
+<property xml:space="preserve" name="TestElement.gui_class">org.apache.jmeter.protocol.http.control.gui.HttpTestSampleGui</property>
+<property xml:space="preserve" name="HTTPSampler.path">/site/faqs.html</property>
+<collection class="java.util.ArrayList" name="AbstractSampler.assertions"/>
+<property xml:space="preserve" name="HTTPSampler.FILE_FIELD"/>
+<property xml:space="preserve" name="TestElement.test_class">org.apache.jmeter.protocol.http.sampler.HTTPSampler</property>
+<property xml:space="preserve" name="HTTPSampler.method">GET</property>
+<property xml:space="preserve" name="TestElement.name">FAQ Page</property>
+<property xml:space="preserve" name="HTTPSampler.domain"/>
+<property xml:space="preserve" name="HTTPSampler.use_keepalive">false</property>
+<property xml:space="preserve" name="HTTPSampler.protocol">http</property>
+<property xml:space="preserve" name="HTTPSampler.follow_redirects">false</property>
+<property xml:space="preserve" name="HTTPSampler.port"/>
+<testelement class="org.apache.jmeter.config.Arguments" name="HTTPsampler.Arguments">
+<property xml:space="preserve" name="TestElement.gui_class">org.apache.jmeter.protocol.http.gui.HTTPArgumentsPanel</property>
+<property xml:space="preserve" name="TestElement.test_class">org.apache.jmeter.config.Arguments</property>
+<collection class="java.util.ArrayList" name="Arguments.arguments"/>
+<property xml:space="preserve" name="TestElement.name"/>
+</testelement>
+<property xml:space="preserve" name="HTTPSampler.FILE_NAME"/>
+</testelement>
+</node>
+<node>
+<testelement class="org.apache.jmeter.protocol.http.sampler.HTTPSampler">
+<property xml:space="preserve" name="HTTPSampler.mimetype"/>
+<property xml:space="preserve" name="TestElement.gui_class">org.apache.jmeter.protocol.http.control.gui.HttpTestSampleGui</property>
+<property xml:space="preserve" name="HTTPSampler.path">/gump</property>
+<collection class="java.util.ArrayList" name="AbstractSampler.assertions"/>
+<property xml:space="preserve" name="HTTPSampler.FILE_FIELD"/>
+<property xml:space="preserve" name="TestElement.test_class">org.apache.jmeter.protocol.http.sampler.HTTPSampler</property>
+<property xml:space="preserve" name="HTTPSampler.method">GET</property>
+<property xml:space="preserve" name="TestElement.name">Gump Page</property>
+<property xml:space="preserve" name="HTTPSampler.domain"/>
+<property xml:space="preserve" name="HTTPSampler.use_keepalive">false</property>
+<property xml:space="preserve" name="HTTPSampler.protocol">http</property>
+<property xml:space="preserve" name="HTTPSampler.follow_redirects">false</property>
+<property xml:space="preserve" name="HTTPSampler.port"/>
+<testelement class="org.apache.jmeter.config.Arguments" name="HTTPsampler.Arguments">
+<property xml:space="preserve" name="TestElement.gui_class">org.apache.jmeter.protocol.http.gui.HTTPArgumentsPanel</property>
+<property xml:space="preserve" name="TestElement.test_class">org.apache.jmeter.config.Arguments</property>
+<collection class="java.util.ArrayList" name="Arguments.arguments"/>
+<property xml:space="preserve" name="TestElement.name"/>
+</testelement>
+<property xml:space="preserve" name="HTTPSampler.FILE_NAME"/>
+</testelement>
+</node>
+</node>
+<node>
+<testelement class="org.apache.jmeter.reporters.ResultCollector">
+<property xml:space="preserve" name="TestElement.gui_class">org.apache.jmeter.visualizers.GraphVisualizer</property>
+<property xml:space="preserve" name="TestElement.test_class">org.apache.jmeter.reporters.ResultCollector</property>
+<property xml:space="preserve" name="TestElement.name">File Reporter</property>
+<property xml:space="preserve" name="filename">interleave-test.dat</property>
+<property xml:space="preserve" name="ResultCollector.error_logging">false</property>
+</testelement>
+</node>
+</node>
+</node>
diff --git a/jakarta-jmeter/bin/testfiles/InterleaveTestPlan2.jmx b/jakarta-jmeter/bin/testfiles/InterleaveTestPlan2.jmx
index 69af227..c968fd5 100644
--- a/jakarta-jmeter/bin/testfiles/InterleaveTestPlan2.jmx
+++ b/jakarta-jmeter/bin/testfiles/InterleaveTestPlan2.jmx
@@ -1,116 +1,177 @@
-<?xml version="1.0"?>
-
-<TestPlan>
-<threadgroups>
-<ThreadGroup name="Jakarta Users" numThreads="1" rampUp="0">
-<controllers>
-<LoopController type="org.apache.jmeter.control.LoopController" name="Loop Controller" iterations="8">
-<configElements>
-</configElements>
-<controllers>
-<Controller type="org.apache.jmeter.control.InterleaveControl" name="Interleave Controller">
-<configElements>
-<ConfigElement type="org.apache.jmeter.protocol.http.config.UrlConfig">
-<property name="name">Defaults</property>
-<property name="PROTOCOL">http</property>
-<property name="domain">jakarta.apache.org</property>
-<property name="arguments"><Arguments>
-</Arguments>
-</property>
-<property name="path">/</property>
-<property name="method">GET</property>
-</ConfigElement>
-</configElements>
-<controllers>
-<Controller type="org.apache.jmeter.control.InterleaveControl" name="Interleave Controller">
-<configElements>
-</configElements>
-<controllers>
-<HttpTestSample type="org.apache.jmeter.protocol.http.control.HttpTestSample" name="Home Page" getImages="false">
-<defaultUrl>
-<ConfigElement type="org.apache.jmeter.protocol.http.config.MultipartUrlConfig">
-<property name="PROTOCOL">http</property>
-<property name="arguments"><Arguments>
-</Arguments>
-</property>
-<property name="path">/</property>
-<property name="method">GET</property>
-</ConfigElement></defaultUrl>
-<configElements>
-</configElements>
-<controllers>
-</controllers>
-</HttpTestSample>
-
-<HttpTestSample type="org.apache.jmeter.protocol.http.control.HttpTestSample" name="CVS Page" getImages="false">
-<defaultUrl>
-<ConfigElement type="org.apache.jmeter.protocol.http.config.MultipartUrlConfig">
-<property name="PROTOCOL">http</property>
-<property name="arguments"><Arguments>
-</Arguments>
-</property>
-<property name="path">/site/cvsindex.html</property>
-<property name="method">GET</property>
-</ConfigElement></defaultUrl>
-<configElements>
-</configElements>
-<controllers>
-</controllers>
-</HttpTestSample>
-
-</controllers>
-</Controller>
-<Controller type="org.apache.jmeter.control.InterleaveControl" name="Interleave Controller">
-<configElements>
-</configElements>
-<controllers>
-<HttpTestSample type="org.apache.jmeter.protocol.http.control.HttpTestSample" name="Bug Page" getImages="false">
-<defaultUrl>
-<ConfigElement type="org.apache.jmeter.protocol.http.config.MultipartUrlConfig">
-<property name="PROTOCOL">http</property>
-<property name="arguments"><Arguments>
-</Arguments>
-</property>
-<property name="path">/site/bugs.html</property>
-<property name="method">GET</property>
-</ConfigElement></defaultUrl>
-<configElements>
-</configElements>
-<controllers>
-</controllers>
-</HttpTestSample>
-
-<HttpTestSample type="org.apache.jmeter.protocol.http.control.HttpTestSample" name="FAQ Page" getImages="false">
-<defaultUrl>
-<ConfigElement type="org.apache.jmeter.protocol.http.config.MultipartUrlConfig">
-<property name="PROTOCOL">http</property>
-<property name="arguments"><Arguments>
-</Arguments>
-</property>
-<property name="path">/site/faqs.html</property>
-<property name="method">GET</property>
-</ConfigElement></defaultUrl>
-<configElements>
-</configElements>
-<controllers>
-</controllers>
-</HttpTestSample>
-
-</controllers>
-</Controller>
-</controllers>
-</Controller>
-</controllers>
-</LoopController>
-</controllers>
-<timers>
-</timers>
-<listeners>
-<Filer type="org.apache.jmeter.reporters.Filer" name="File Reporter" verbose="true" append="false" autoFlush="false" viewSubmitData="true" file="interleave-test2.dat"/>
-</listeners>
-</ThreadGroup>
-
-</threadgroups>
-<configElements>
-</configElements>
-</TestPlan>
+<?xml version="1.0" encoding="UTF-8"?>
+<node>
+<testelement class="org.apache.jmeter.testelement.TestPlan">
+<testelement class="org.apache.jmeter.config.Arguments" name="TestPlan.user_defined_variables">
+<property xml:space="preserve" name="TestElement.gui_class">org.apache.jmeter.config.gui.ArgumentsPanel</property>
+<property xml:space="preserve" name="TestElement.test_class">org.apache.jmeter.config.Arguments</property>
+<collection class="java.util.ArrayList" name="Arguments.arguments"/>
+<property xml:space="preserve" name="TestElement.name">Argument List</property>
+</testelement>
+<property xml:space="preserve" name="TestElement.gui_class">org.apache.jmeter.control.gui.TestPlanGui</property>
+<collection class="java.util.LinkedList" name="TestPlan.thread_groups"/>
+<property xml:space="preserve" name="TestElement.test_class">org.apache.jmeter.testelement.TestPlan</property>
+<property xml:space="preserve" name="TestElement.name">Test Plan</property>
+<property xml:space="preserve" name="TestPlan.functional_mode">false</property>
+</testelement>
+<node>
+<testelement class="org.apache.jmeter.threads.ThreadGroup">
+<property xml:space="preserve" name="TestElement.gui_class">org.apache.jmeter.threads.gui.ThreadGroupGui</property>
+<property xml:space="preserve" name="TestElement.test_class">org.apache.jmeter.threads.ThreadGroup</property>
+<testelement class="org.apache.jmeter.control.LoopController" name="ThreadGroup.main_controller">
+<property xml:space="preserve" name="TestElement.gui_class">org.apache.jmeter.control.gui.LoopControlPanel</property>
+<property xml:space="preserve" name="LoopController.loops">8</property>
+<property xml:space="preserve" name="TestElement.test_class">org.apache.jmeter.control.LoopController</property>
+<property xml:space="preserve" name="TestElement.name">Loop Controller</property>
+<property xml:space="preserve" name="LoopController.continue_forever">false</property>
+</testelement>
+<property xml:space="preserve" name="TestElement.name">Jakarta Users</property>
+<property xml:space="preserve" name="ThreadGroup.num_threads">1</property>
+<property xml:space="preserve" name="ThreadGroup.ramp_time">0</property>
+</testelement>
+<node>
+<testelement class="org.apache.jmeter.control.InterleaveControl">
+<property xml:space="preserve" name="TestElement.gui_class">org.apache.jmeter.control.gui.InterleaveControlGui</property>
+<property xml:space="preserve" name="TestElement.test_class">org.apache.jmeter.control.InterleaveControl</property>
+<property xml:space="preserve" name="InterleaveControl.style">0</property>
+<property xml:space="preserve" name="TestElement.name">Interleave Controller</property>
+</testelement>
+<node>
+<testelement class="org.apache.jmeter.config.ConfigTestElement">
+<property xml:space="preserve" name="HTTPSampler.path">/</property>
+<property xml:space="preserve" name="TestElement.gui_class">org.apache.jmeter.protocol.http.config.gui.HttpDefaultsGui</property>
+<property xml:space="preserve" name="TestElement.test_class">org.apache.jmeter.config.ConfigTestElement</property>
+<property xml:space="preserve" name="TestElement.name">Defaults</property>
+<property xml:space="preserve" name="HTTPSampler.domain">jakarta.apache.org</property>
+<property xml:space="preserve" name="HTTPSampler.port"/>
+<testelement class="org.apache.jmeter.config.Arguments" name="HTTPsampler.Arguments">
+<property xml:space="preserve" name="TestElement.gui_class">org.apache.jmeter.protocol.http.gui.HTTPArgumentsPanel</property>
+<property xml:space="preserve" name="TestElement.test_class">org.apache.jmeter.config.Arguments</property>
+<collection class="java.util.ArrayList" name="Arguments.arguments"/>
+<property xml:space="preserve" name="TestElement.name"/>
+</testelement>
+</testelement>
+</node>
+<node>
+<testelement class="org.apache.jmeter.control.InterleaveControl">
+<property xml:space="preserve" name="TestElement.gui_class">org.apache.jmeter.control.gui.InterleaveControlGui</property>
+<property xml:space="preserve" name="TestElement.test_class">org.apache.jmeter.control.InterleaveControl</property>
+<property xml:space="preserve" name="InterleaveControl.style">0</property>
+<property xml:space="preserve" name="TestElement.name">Interleave Controller</property>
+</testelement>
+<node>
+<testelement class="org.apache.jmeter.protocol.http.sampler.HTTPSampler">
+<property xml:space="preserve" name="HTTPSampler.mimetype"/>
+<property xml:space="preserve" name="TestElement.gui_class">org.apache.jmeter.protocol.http.control.gui.HttpTestSampleGui</property>
+<property xml:space="preserve" name="HTTPSampler.path">/</property>
+<collection class="java.util.ArrayList" name="AbstractSampler.assertions"/>
+<property xml:space="preserve" name="HTTPSampler.FILE_FIELD"/>
+<property xml:space="preserve" name="TestElement.test_class">org.apache.jmeter.protocol.http.sampler.HTTPSampler</property>
+<property xml:space="preserve" name="HTTPSampler.method">GET</property>
+<property xml:space="preserve" name="TestElement.name">Home Page</property>
+<property xml:space="preserve" name="HTTPSampler.domain"/>
+<property xml:space="preserve" name="HTTPSampler.use_keepalive">false</property>
+<property xml:space="preserve" name="HTTPSampler.protocol">http</property>
+<property xml:space="preserve" name="HTTPSampler.follow_redirects">false</property>
+<property xml:space="preserve" name="HTTPSampler.port"/>
+<testelement class="org.apache.jmeter.config.Arguments" name="HTTPsampler.Arguments">
+<property xml:space="preserve" name="TestElement.gui_class">org.apache.jmeter.protocol.http.gui.HTTPArgumentsPanel</property>
+<property xml:space="preserve" name="TestElement.test_class">org.apache.jmeter.config.Arguments</property>
+<collection class="java.util.ArrayList" name="Arguments.arguments"/>
+<property xml:space="preserve" name="TestElement.name"/>
+</testelement>
+<property xml:space="preserve" name="HTTPSampler.FILE_NAME"/>
+</testelement>
+</node>
+<node>
+<testelement class="org.apache.jmeter.protocol.http.sampler.HTTPSampler">
+<property xml:space="preserve" name="HTTPSampler.mimetype"/>
+<property xml:space="preserve" name="TestElement.gui_class">org.apache.jmeter.protocol.http.control.gui.HttpTestSampleGui</property>
+<property xml:space="preserve" name="HTTPSampler.path">/site/cvsindex.html</property>
+<collection class="java.util.ArrayList" name="AbstractSampler.assertions"/>
+<property xml:space="preserve" name="HTTPSampler.FILE_FIELD"/>
+<property xml:space="preserve" name="TestElement.test_class">org.apache.jmeter.protocol.http.sampler.HTTPSampler</property>
+<property xml:space="preserve" name="HTTPSampler.method">GET</property>
+<property xml:space="preserve" name="TestElement.name">CVS Page</property>
+<property xml:space="preserve" name="HTTPSampler.domain"/>
+<property xml:space="preserve" name="HTTPSampler.use_keepalive">false</property>
+<property xml:space="preserve" name="HTTPSampler.protocol">http</property>
+<property xml:space="preserve" name="HTTPSampler.follow_redirects">false</property>
+<property xml:space="preserve" name="HTTPSampler.port"/>
+<testelement class="org.apache.jmeter.config.Arguments" name="HTTPsampler.Arguments">
+<property xml:space="preserve" name="TestElement.gui_class">org.apache.jmeter.protocol.http.gui.HTTPArgumentsPanel</property>
+<property xml:space="preserve" name="TestElement.test_class">org.apache.jmeter.config.Arguments</property>
+<collection class="java.util.ArrayList" name="Arguments.arguments"/>
+<property xml:space="preserve" name="TestElement.name"/>
+</testelement>
+<property xml:space="preserve" name="HTTPSampler.FILE_NAME"/>
+</testelement>
+</node>
+</node>
+<node>
+<testelement class="org.apache.jmeter.control.InterleaveControl">
+<property xml:space="preserve" name="TestElement.gui_class">org.apache.jmeter.control.gui.InterleaveControlGui</property>
+<property xml:space="preserve" name="TestElement.test_class">org.apache.jmeter.control.InterleaveControl</property>
+<property xml:space="preserve" name="InterleaveControl.style">0</property>
+<property xml:space="preserve" name="TestElement.name">Interleave Controller</property>
+</testelement>
+<node>
+<testelement class="org.apache.jmeter.protocol.http.sampler.HTTPSampler">
+<property xml:space="preserve" name="HTTPSampler.mimetype"/>
+<property xml:space="preserve" name="TestElement.gui_class">org.apache.jmeter.protocol.http.control.gui.HttpTestSampleGui</property>
+<property xml:space="preserve" name="HTTPSampler.path">/site/bugs.html</property>
+<collection class="java.util.ArrayList" name="AbstractSampler.assertions"/>
+<property xml:space="preserve" name="HTTPSampler.FILE_FIELD"/>
+<property xml:space="preserve" name="TestElement.test_class">org.apache.jmeter.protocol.http.sampler.HTTPSampler</property>
+<property xml:space="preserve" name="HTTPSampler.method">GET</property>
+<property xml:space="preserve" name="TestElement.name">Bug Page</property>
+<property xml:space="preserve" name="HTTPSampler.domain"/>
+<property xml:space="preserve" name="HTTPSampler.use_keepalive">false</property>
+<property xml:space="preserve" name="HTTPSampler.protocol">http</property>
+<property xml:space="preserve" name="HTTPSampler.follow_redirects">false</property>
+<property xml:space="preserve" name="HTTPSampler.port"/>
+<testelement class="org.apache.jmeter.config.Arguments" name="HTTPsampler.Arguments">
+<property xml:space="preserve" name="TestElement.gui_class">org.apache.jmeter.protocol.http.gui.HTTPArgumentsPanel</property>
+<property xml:space="preserve" name="TestElement.test_class">org.apache.jmeter.config.Arguments</property>
+<collection class="java.util.ArrayList" name="Arguments.arguments"/>
+<property xml:space="preserve" name="TestElement.name"/>
+</testelement>
+<property xml:space="preserve" name="HTTPSampler.FILE_NAME"/>
+</testelement>
+</node>
+<node>
+<testelement class="org.apache.jmeter.protocol.http.sampler.HTTPSampler">
+<property xml:space="preserve" name="HTTPSampler.mimetype"/>
+<property xml:space="preserve" name="TestElement.gui_class">org.apache.jmeter.protocol.http.control.gui.HttpTestSampleGui</property>
+<property xml:space="preserve" name="HTTPSampler.path">/site/faqs.html</property>
+<collection class="java.util.ArrayList" name="AbstractSampler.assertions"/>
+<property xml:space="preserve" name="HTTPSampler.FILE_FIELD"/>
+<property xml:space="preserve" name="TestElement.test_class">org.apache.jmeter.protocol.http.sampler.HTTPSampler</property>
+<property xml:space="preserve" name="HTTPSampler.method">GET</property>
+<property xml:space="preserve" name="TestElement.name">FAQ Page</property>
+<property xml:space="preserve" name="HTTPSampler.domain"/>
+<property xml:space="preserve" name="HTTPSampler.use_keepalive">false</property>
+<property xml:space="preserve" name="HTTPSampler.protocol">http</property>
+<property xml:space="preserve" name="HTTPSampler.follow_redirects">false</property>
+<property xml:space="preserve" name="HTTPSampler.port"/>
+<testelement class="org.apache.jmeter.config.Arguments" name="HTTPsampler.Arguments">
+<property xml:space="preserve" name="TestElement.gui_class">org.apache.jmeter.protocol.http.gui.HTTPArgumentsPanel</property>
+<property xml:space="preserve" name="TestElement.test_class">org.apache.jmeter.config.Arguments</property>
+<collection class="java.util.ArrayList" name="Arguments.arguments"/>
+<property xml:space="preserve" name="TestElement.name"/>
+</testelement>
+<property xml:space="preserve" name="HTTPSampler.FILE_NAME"/>
+</testelement>
+</node>
+</node>
+</node>
+<node>
+<testelement class="org.apache.jmeter.reporters.ResultCollector">
+<property xml:space="preserve" name="TestElement.gui_class">org.apache.jmeter.visualizers.GraphVisualizer</property>
+<property xml:space="preserve" name="TestElement.test_class">org.apache.jmeter.reporters.ResultCollector</property>
+<property xml:space="preserve" name="TestElement.name">File Reporter</property>
+<property xml:space="preserve" name="filename">interleave-test2.dat</property>
+<property xml:space="preserve" name="ResultCollector.error_logging">false</property>
+</testelement>
+</node>
+</node>
+</node>
diff --git a/jakarta-jmeter/bin/testfiles/LoopTestPlan.jmx b/jakarta-jmeter/bin/testfiles/LoopTestPlan.jmx
index c866e08..b5d25d7 100644
--- a/jakarta-jmeter/bin/testfiles/LoopTestPlan.jmx
+++ b/jakarta-jmeter/bin/testfiles/LoopTestPlan.jmx
@@ -1,72 +1,114 @@
-<?xml version="1.0"?>
-
-<TestPlan>
-<threadgroups>
-<ThreadGroup name="Jakarta Users" numThreads="1" rampUp="0">
-<controllers>
-<LoopController type="org.apache.jmeter.control.LoopController" name="Loop Controller" iterations="1">
-<configElements>
-<ConfigElement type="org.apache.jmeter.protocol.http.config.UrlConfig">
-<property name="name">Defaults</property>
-<property name="PROTOCOL">http</property>
-<property name="domain">jakarta.apache.org</property>
-<property name="arguments"><Arguments>
-</Arguments>
-</property>
-<property name="path">/</property>
-<property name="method">GET</property>
-</ConfigElement>
-</configElements>
-<controllers>
-<HttpTestSample type="org.apache.jmeter.protocol.http.control.HttpTestSample" name="Home Page" getImages="false">
-<defaultUrl>
-<ConfigElement type="org.apache.jmeter.protocol.http.config.MultipartUrlConfig">
-<property name="PROTOCOL">http</property>
-<property name="arguments"><Arguments>
-</Arguments>
-</property>
-<property name="path">/</property>
-<property name="method">GET</property>
-</ConfigElement></defaultUrl>
-<configElements>
-</configElements>
-<controllers>
-</controllers>
-</HttpTestSample>
-
-<LoopController type="org.apache.jmeter.control.LoopController" name="Loop Controller" iterations="5">
-<configElements>
-</configElements>
-<controllers>
-<HttpTestSample type="org.apache.jmeter.protocol.http.control.HttpTestSample" name="News Page" getImages="false">
-<defaultUrl>
-<ConfigElement type="org.apache.jmeter.protocol.http.config.MultipartUrlConfig">
-<property name="PROTOCOL">http</property>
-<property name="arguments"><Arguments>
-</Arguments>
-</property>
-<property name="path">/site/news.html</property>
-<property name="method">GET</property>
-</ConfigElement></defaultUrl>
-<configElements>
-</configElements>
-<controllers>
-</controllers>
-</HttpTestSample>
-
-</controllers>
-</LoopController>
-</controllers>
-</LoopController>
-</controllers>
-<timers>
-</timers>
-<listeners>
-<Filer type="org.apache.jmeter.reporters.Filer" name="File Reporter" verbose="true" append="false" autoFlush="false" viewSubmitData="true" file="loop-test.dat"/>
-</listeners>
-</ThreadGroup>
-
-</threadgroups>
-<configElements>
-</configElements>
-</TestPlan>
+<?xml version="1.0" encoding="UTF-8"?>
+<node>
+<testelement class="org.apache.jmeter.testelement.TestPlan">
+<testelement class="org.apache.jmeter.config.Arguments" name="TestPlan.user_defined_variables">
+<property xml:space="preserve" name="TestElement.gui_class">org.apache.jmeter.config.gui.ArgumentsPanel</property>
+<property xml:space="preserve" name="TestElement.test_class">org.apache.jmeter.config.Arguments</property>
+<collection class="java.util.ArrayList" name="Arguments.arguments"/>
+<property xml:space="preserve" name="TestElement.name">Argument List</property>
+</testelement>
+<property xml:space="preserve" name="TestElement.gui_class">org.apache.jmeter.control.gui.TestPlanGui</property>
+<collection class="java.util.LinkedList" name="TestPlan.thread_groups"/>
+<property xml:space="preserve" name="TestElement.test_class">org.apache.jmeter.testelement.TestPlan</property>
+<property xml:space="preserve" name="TestElement.name">Test Plan</property>
+<property xml:space="preserve" name="TestPlan.functional_mode">false</property>
+</testelement>
+<node>
+<testelement class="org.apache.jmeter.threads.ThreadGroup">
+<property xml:space="preserve" name="TestElement.gui_class">org.apache.jmeter.threads.gui.ThreadGroupGui</property>
+<property xml:space="preserve" name="TestElement.test_class">org.apache.jmeter.threads.ThreadGroup</property>
+<testelement class="org.apache.jmeter.control.LoopController" name="ThreadGroup.main_controller">
+<property xml:space="preserve" name="TestElement.gui_class">org.apache.jmeter.control.gui.LoopControlPanel</property>
+<property xml:space="preserve" name="LoopController.loops">1</property>
+<property xml:space="preserve" name="TestElement.test_class">org.apache.jmeter.control.LoopController</property>
+<property xml:space="preserve" name="TestElement.name">Loop Controller</property>
+<property xml:space="preserve" name="LoopController.continue_forever">false</property>
+</testelement>
+<property xml:space="preserve" name="TestElement.name">Jakarta Users</property>
+<property xml:space="preserve" name="ThreadGroup.num_threads">1</property>
+<property xml:space="preserve" name="ThreadGroup.ramp_time">0</property>
+</testelement>
+<node>
+<testelement class="org.apache.jmeter.config.ConfigTestElement">
+<property xml:space="preserve" name="HTTPSampler.path">/</property>
+<property xml:space="preserve" name="TestElement.gui_class">org.apache.jmeter.protocol.http.config.gui.HttpDefaultsGui</property>
+<property xml:space="preserve" name="TestElement.test_class">org.apache.jmeter.config.ConfigTestElement</property>
+<property xml:space="preserve" name="TestElement.name">Defaults</property>
+<property xml:space="preserve" name="HTTPSampler.domain">jakarta.apache.org</property>
+<property xml:space="preserve" name="HTTPSampler.port"/>
+<testelement class="org.apache.jmeter.config.Arguments" name="HTTPsampler.Arguments">
+<property xml:space="preserve" name="TestElement.gui_class">org.apache.jmeter.protocol.http.gui.HTTPArgumentsPanel</property>
+<property xml:space="preserve" name="TestElement.test_class">org.apache.jmeter.config.Arguments</property>
+<collection class="java.util.ArrayList" name="Arguments.arguments"/>
+<property xml:space="preserve" name="TestElement.name"/>
+</testelement>
+</testelement>
+</node>
+<node>
+<testelement class="org.apache.jmeter.protocol.http.sampler.HTTPSampler">
+<property xml:space="preserve" name="HTTPSampler.mimetype"/>
+<property xml:space="preserve" name="TestElement.gui_class">org.apache.jmeter.protocol.http.control.gui.HttpTestSampleGui</property>
+<property xml:space="preserve" name="HTTPSampler.path">/</property>
+<collection class="java.util.ArrayList" name="AbstractSampler.assertions"/>
+<property xml:space="preserve" name="HTTPSampler.FILE_FIELD"/>
+<property xml:space="preserve" name="TestElement.test_class">org.apache.jmeter.protocol.http.sampler.HTTPSampler</property>
+<property xml:space="preserve" name="HTTPSampler.method">GET</property>
+<property xml:space="preserve" name="TestElement.name">Home Page</property>
+<property xml:space="preserve" name="HTTPSampler.domain"/>
+<property xml:space="preserve" name="HTTPSampler.use_keepalive">false</property>
+<property xml:space="preserve" name="HTTPSampler.protocol">http</property>
+<property xml:space="preserve" name="HTTPSampler.follow_redirects">false</property>
+<property xml:space="preserve" name="HTTPSampler.port"/>
+<testelement class="org.apache.jmeter.config.Arguments" name="HTTPsampler.Arguments">
+<property xml:space="preserve" name="TestElement.gui_class">org.apache.jmeter.protocol.http.gui.HTTPArgumentsPanel</property>
+<property xml:space="preserve" name="TestElement.test_class">org.apache.jmeter.config.Arguments</property>
+<collection class="java.util.ArrayList" name="Arguments.arguments"/>
+<property xml:space="preserve" name="TestElement.name"/>
+</testelement>
+<property xml:space="preserve" name="HTTPSampler.FILE_NAME"/>
+</testelement>
+</node>
+<node>
+<testelement class="org.apache.jmeter.control.LoopController">
+<property xml:space="preserve" name="TestElement.gui_class">org.apache.jmeter.control.gui.LoopControlPanel</property>
+<property xml:space="preserve" name="LoopController.loops">5</property>
+<property xml:space="preserve" name="TestElement.test_class">org.apache.jmeter.control.LoopController</property>
+<property xml:space="preserve" name="TestElement.name">Loop Controller</property>
+<property xml:space="preserve" name="LoopController.continue_forever">true</property>
+</testelement>
+<node>
+<testelement class="org.apache.jmeter.protocol.http.sampler.HTTPSampler">
+<property xml:space="preserve" name="HTTPSampler.mimetype"/>
+<property xml:space="preserve" name="TestElement.gui_class">org.apache.jmeter.protocol.http.control.gui.HttpTestSampleGui</property>
+<property xml:space="preserve" name="HTTPSampler.path">/site/news.html</property>
+<collection class="java.util.ArrayList" name="AbstractSampler.assertions"/>
+<property xml:space="preserve" name="HTTPSampler.FILE_FIELD"/>
+<property xml:space="preserve" name="TestElement.test_class">org.apache.jmeter.protocol.http.sampler.HTTPSampler</property>
+<property xml:space="preserve" name="HTTPSampler.method">GET</property>
+<property xml:space="preserve" name="TestElement.name">News Page</property>
+<property xml:space="preserve" name="HTTPSampler.domain"/>
+<property xml:space="preserve" name="HTTPSampler.use_keepalive">false</property>
+<property xml:space="preserve" name="HTTPSampler.protocol">http</property>
+<property xml:space="preserve" name="HTTPSampler.follow_redirects">false</property>
+<property xml:space="preserve" name="HTTPSampler.port"/>
+<testelement class="org.apache.jmeter.config.Arguments" name="HTTPsampler.Arguments">
+<property xml:space="preserve" name="TestElement.gui_class">org.apache.jmeter.protocol.http.gui.HTTPArgumentsPanel</property>
+<property xml:space="preserve" name="TestElement.test_class">org.apache.jmeter.config.Arguments</property>
+<collection class="java.util.ArrayList" name="Arguments.arguments"/>
+<property xml:space="preserve" name="TestElement.name"/>
+</testelement>
+<property xml:space="preserve" name="HTTPSampler.FILE_NAME"/>
+</testelement>
+</node>
+</node>
+<node>
+<testelement class="org.apache.jmeter.reporters.ResultCollector">
+<property xml:space="preserve" name="TestElement.gui_class">org.apache.jmeter.visualizers.GraphVisualizer</property>
+<property xml:space="preserve" name="TestElement.test_class">org.apache.jmeter.reporters.ResultCollector</property>
+<property xml:space="preserve" name="TestElement.name">File Reporter</property>
+<property xml:space="preserve" name="filename">loop-test.dat</property>
+<property xml:space="preserve" name="ResultCollector.error_logging">false</property>
+</testelement>
+</node>
+</node>
+</node>
diff --git a/jakarta-jmeter/bin/testfiles/Modification Manager.jmx b/jakarta-jmeter/bin/testfiles/Modification Manager.jmx
index 1c4ef83..eceae30 100644
--- a/jakarta-jmeter/bin/testfiles/Modification Manager.jmx	
+++ b/jakarta-jmeter/bin/testfiles/Modification Manager.jmx	
@@ -1,41 +1,85 @@
-<?xml version="1.0"?>
-
-<Controller type="org.apache.jmeter.control.ModifyController" name="Modification Manager">
-<configElements>
-</configElements>
-<controllers>
-<HttpTestSample type="org.apache.jmeter.protocol.http.control.HttpTestSample" name="Web Testing">
-<defaultUrl>
-<ConfigElement type="org.apache.jmeter.protocol.http.config.UrlConfig">
-<property name="port">80</property>
-<property name="PROTOCOL">http</property>
-<property name="arguments"><Arguments>
-</Arguments>
-</property>
-<property name="domain">13.231.197.158</property>
-<property name="path"></property>
-<property name="method">GET</property>
-</ConfigElement></defaultUrl>
-<urlList>
-<ConfigElement type="org.apache.jmeter.protocol.http.config.UrlConfig">
-<property name="port">80</property>
-<property name="name">/xdx/admin/inspect_job.jsp</property>
-<property name="PROTOCOL">http</property>
-<property name="arguments"><Arguments>
-<argument name="request.job_id">.*</argument>
-<argument name="request.action1">opjobadmin.action.inspect</argument>
-</Arguments>
-</property>
-<property name="domain"></property>
-<property name="path">/xdx/admin/inspect_job.jsp</property>
-<property name="method">GET</property>
-</ConfigElement>
-</urlList>
-<configElements>
-</configElements>
-<controllers>
-</controllers>
-</HttpTestSample>
-
-</controllers>
-</Controller>
\ No newline at end of file
+<?xml version="1.0" encoding="UTF-8"?>
+<node>
+<testelement class="org.apache.jmeter.testelement.TestPlan">
+<testelement class="org.apache.jmeter.config.Arguments" name="TestPlan.user_defined_variables">
+<property xml:space="preserve" name="TestElement.gui_class">org.apache.jmeter.config.gui.ArgumentsPanel</property>
+<property xml:space="preserve" name="TestElement.test_class">org.apache.jmeter.config.Arguments</property>
+<collection class="java.util.ArrayList" name="Arguments.arguments"/>
+<property xml:space="preserve" name="TestElement.name">Argument List</property>
+</testelement>
+<property xml:space="preserve" name="TestElement.gui_class">org.apache.jmeter.control.gui.TestPlanGui</property>
+<collection class="java.util.LinkedList" name="TestPlan.thread_groups"/>
+<property xml:space="preserve" name="TestElement.test_class">org.apache.jmeter.testelement.TestPlan</property>
+<property xml:space="preserve" name="TestElement.name">Test Plan</property>
+<property xml:space="preserve" name="TestPlan.functional_mode">false</property>
+</testelement>
+<node>
+<testelement class="org.apache.jmeter.control.GenericController">
+<property xml:space="preserve" name="TestElement.gui_class">org.apache.jmeter.control.gui.LogicControllerGui</property>
+<property xml:space="preserve" name="TestElement.test_class">org.apache.jmeter.control.GenericController</property>
+<property xml:space="preserve" name="TestElement.name">Modification Manager</property>
+</testelement>
+<node>
+<testelement class="org.apache.jmeter.control.GenericController">
+<property xml:space="preserve" name="TestElement.gui_class">org.apache.jmeter.control.gui.LogicControllerGui</property>
+<property xml:space="preserve" name="TestElement.test_class">org.apache.jmeter.control.GenericController</property>
+<property xml:space="preserve" name="TestElement.name">Simple Controller</property>
+</testelement>
+<node>
+<testelement class="org.apache.jmeter.protocol.http.sampler.HTTPSampler">
+<property xml:space="preserve" name="HTTPSampler.mimetype"/>
+<property xml:space="preserve" name="TestElement.gui_class">org.apache.jmeter.protocol.http.control.gui.HttpTestSampleGui</property>
+<property xml:space="preserve" name="HTTPSampler.path">/xdx/admin/inspect_job.jsp</property>
+<collection class="java.util.ArrayList" name="AbstractSampler.assertions"/>
+<property xml:space="preserve" name="HTTPSampler.FILE_FIELD"/>
+<property xml:space="preserve" name="TestElement.test_class">org.apache.jmeter.protocol.http.sampler.HTTPSampler</property>
+<property xml:space="preserve" name="HTTPSampler.method">GET</property>
+<property xml:space="preserve" name="TestElement.name">Web Testing</property>
+<property xml:space="preserve" name="HTTPSampler.domain"/>
+<property xml:space="preserve" name="HTTPSampler.use_keepalive">false</property>
+<property xml:space="preserve" name="HTTPSampler.protocol">http</property>
+<property xml:space="preserve" name="HTTPSampler.follow_redirects">false</property>
+<property xml:space="preserve" name="HTTPSampler.port">80</property>
+<testelement class="org.apache.jmeter.config.Arguments" name="HTTPsampler.Arguments">
+<property xml:space="preserve" name="TestElement.gui_class">org.apache.jmeter.protocol.http.gui.HTTPArgumentsPanel</property>
+<property xml:space="preserve" name="TestElement.test_class">org.apache.jmeter.config.Arguments</property>
+<collection class="java.util.ArrayList" name="Arguments.arguments">
+<testelement class="org.apache.jmeter.protocol.http.util.HTTPArgument">
+<property xml:space="preserve" name="Argument.value">.*</property>
+<property xml:space="preserve" name="Argument.name">request.job_id</property>
+<property xml:space="preserve" name="HTTPArgument.always_encode">true</property>
+<property xml:space="preserve" name="HTTPArgument.encoded_name">request.job_id</property>
+<property xml:space="preserve" name="HTTPArgument.encoded_value">.*</property>
+</testelement>
+<testelement class="org.apache.jmeter.protocol.http.util.HTTPArgument">
+<property xml:space="preserve" name="Argument.value">opjobadmin.action.inspect</property>
+<property xml:space="preserve" name="Argument.name">request.action1</property>
+<property xml:space="preserve" name="HTTPArgument.always_encode">true</property>
+<property xml:space="preserve" name="HTTPArgument.encoded_name">request.action1</property>
+<property xml:space="preserve" name="HTTPArgument.encoded_value">opjobadmin.action.inspect</property>
+</testelement>
+</collection>
+<property xml:space="preserve" name="TestElement.name"/>
+</testelement>
+<property xml:space="preserve" name="HTTPSampler.FILE_NAME"/>
+</testelement>
+</node>
+<node>
+<testelement class="org.apache.jmeter.config.ConfigTestElement">
+<property xml:space="preserve" name="HTTPSampler.path"/>
+<property xml:space="preserve" name="TestElement.gui_class">org.apache.jmeter.protocol.http.config.gui.HttpDefaultsGui</property>
+<property xml:space="preserve" name="TestElement.test_class">org.apache.jmeter.config.ConfigTestElement</property>
+<property xml:space="preserve" name="TestElement.name">HTTP Request Defaults</property>
+<property xml:space="preserve" name="HTTPSampler.domain">13.231.197.158</property>
+<property xml:space="preserve" name="HTTPSampler.port">80</property>
+<testelement class="org.apache.jmeter.config.Arguments" name="HTTPsampler.Arguments">
+<property xml:space="preserve" name="TestElement.gui_class">org.apache.jmeter.protocol.http.gui.HTTPArgumentsPanel</property>
+<property xml:space="preserve" name="TestElement.test_class">org.apache.jmeter.config.Arguments</property>
+<collection class="java.util.ArrayList" name="Arguments.arguments"/>
+<property xml:space="preserve" name="TestElement.name"/>
+</testelement>
+</testelement>
+</node>
+</node>
+</node>
+</node>
diff --git a/jakarta-jmeter/bin/testfiles/OnceOnlyTestPlan.jmx b/jakarta-jmeter/bin/testfiles/OnceOnlyTestPlan.jmx
index a26ab79..11b8e31 100644
--- a/jakarta-jmeter/bin/testfiles/OnceOnlyTestPlan.jmx
+++ b/jakarta-jmeter/bin/testfiles/OnceOnlyTestPlan.jmx
@@ -1,72 +1,112 @@
-<?xml version="1.0"?>
-
-<TestPlan>
-<threadgroups>
-<ThreadGroup name="Jakarta Users" numThreads="2" rampUp="0">
-<controllers>
-<LoopController type="org.apache.jmeter.control.LoopController" name="Loop Controller" iterations="3">
-<configElements>
-<ConfigElement type="org.apache.jmeter.protocol.http.config.UrlConfig">
-<property name="name">Defaults</property>
-<property name="PROTOCOL">http</property>
-<property name="domain">jakarta.apache.org</property>
-<property name="arguments"><Arguments>
-</Arguments>
-</property>
-<property name="path">/</property>
-<property name="method">GET</property>
-</ConfigElement>
-</configElements>
-<controllers>
-<Controller type="org.apache.jmeter.control.OnceOnlyController" name="Once Only Controller">
-<configElements>
-</configElements>
-<controllers>
-<HttpTestSample type="org.apache.jmeter.protocol.http.control.HttpTestSample" name="Home Page" getImages="false">
-<defaultUrl>
-<ConfigElement type="org.apache.jmeter.protocol.http.config.MultipartUrlConfig">
-<property name="PROTOCOL">http</property>
-<property name="arguments"><Arguments>
-</Arguments>
-</property>
-<property name="path">/</property>
-<property name="method">GET</property>
-</ConfigElement></defaultUrl>
-<configElements>
-</configElements>
-<controllers>
-</controllers>
-</HttpTestSample>
-
-</controllers>
-</Controller>
-<HttpTestSample type="org.apache.jmeter.protocol.http.control.HttpTestSample" name="Bug Page" getImages="false">
-<defaultUrl>
-<ConfigElement type="org.apache.jmeter.protocol.http.config.MultipartUrlConfig">
-<property name="PROTOCOL">http</property>
-<property name="arguments"><Arguments>
-</Arguments>
-</property>
-<property name="path">/site/bugs.html</property>
-<property name="method">GET</property>
-</ConfigElement></defaultUrl>
-<configElements>
-</configElements>
-<controllers>
-</controllers>
-</HttpTestSample>
-
-</controllers>
-</LoopController>
-</controllers>
-<timers>
-</timers>
-<listeners>
-<Filer type="org.apache.jmeter.reporters.Filer" name="File Reporter" verbose="true" append="false" autoFlush="false" viewSubmitData="true" file="once-only-test.dat"/>
-</listeners>
-</ThreadGroup>
-
-</threadgroups>
-<configElements>
-</configElements>
-</TestPlan>
+<?xml version="1.0" encoding="UTF-8"?>
+<node>
+<testelement class="org.apache.jmeter.testelement.TestPlan">
+<testelement class="org.apache.jmeter.config.Arguments" name="TestPlan.user_defined_variables">
+<property xml:space="preserve" name="TestElement.gui_class">org.apache.jmeter.config.gui.ArgumentsPanel</property>
+<property xml:space="preserve" name="TestElement.test_class">org.apache.jmeter.config.Arguments</property>
+<collection class="java.util.ArrayList" name="Arguments.arguments"/>
+<property xml:space="preserve" name="TestElement.name">Argument List</property>
+</testelement>
+<property xml:space="preserve" name="TestElement.gui_class">org.apache.jmeter.control.gui.TestPlanGui</property>
+<collection class="java.util.LinkedList" name="TestPlan.thread_groups"/>
+<property xml:space="preserve" name="TestElement.test_class">org.apache.jmeter.testelement.TestPlan</property>
+<property xml:space="preserve" name="TestElement.name">Test Plan</property>
+<property xml:space="preserve" name="TestPlan.functional_mode">false</property>
+</testelement>
+<node>
+<testelement class="org.apache.jmeter.threads.ThreadGroup">
+<property xml:space="preserve" name="TestElement.gui_class">org.apache.jmeter.threads.gui.ThreadGroupGui</property>
+<property xml:space="preserve" name="TestElement.test_class">org.apache.jmeter.threads.ThreadGroup</property>
+<testelement class="org.apache.jmeter.control.LoopController" name="ThreadGroup.main_controller">
+<property xml:space="preserve" name="TestElement.gui_class">org.apache.jmeter.control.gui.LoopControlPanel</property>
+<property xml:space="preserve" name="LoopController.loops">3</property>
+<property xml:space="preserve" name="TestElement.test_class">org.apache.jmeter.control.LoopController</property>
+<property xml:space="preserve" name="TestElement.name">Loop Controller</property>
+<property xml:space="preserve" name="LoopController.continue_forever">false</property>
+</testelement>
+<property xml:space="preserve" name="TestElement.name">Jakarta Users</property>
+<property xml:space="preserve" name="ThreadGroup.num_threads">2</property>
+<property xml:space="preserve" name="ThreadGroup.ramp_time">0</property>
+</testelement>
+<node>
+<testelement class="org.apache.jmeter.config.ConfigTestElement">
+<property xml:space="preserve" name="HTTPSampler.path">/</property>
+<property xml:space="preserve" name="TestElement.gui_class">org.apache.jmeter.protocol.http.config.gui.HttpDefaultsGui</property>
+<property xml:space="preserve" name="TestElement.test_class">org.apache.jmeter.config.ConfigTestElement</property>
+<property xml:space="preserve" name="TestElement.name">Defaults</property>
+<property xml:space="preserve" name="HTTPSampler.domain">jakarta.apache.org</property>
+<property xml:space="preserve" name="HTTPSampler.port"/>
+<testelement class="org.apache.jmeter.config.Arguments" name="HTTPsampler.Arguments">
+<property xml:space="preserve" name="TestElement.gui_class">org.apache.jmeter.protocol.http.gui.HTTPArgumentsPanel</property>
+<property xml:space="preserve" name="TestElement.test_class">org.apache.jmeter.config.Arguments</property>
+<collection class="java.util.ArrayList" name="Arguments.arguments"/>
+<property xml:space="preserve" name="TestElement.name"/>
+</testelement>
+</testelement>
+</node>
+<node>
+<testelement class="org.apache.jmeter.control.OnceOnlyController">
+<property xml:space="preserve" name="TestElement.gui_class">org.apache.jmeter.control.gui.OnceOnlyControllerGui</property>
+<property xml:space="preserve" name="TestElement.test_class">org.apache.jmeter.control.OnceOnlyController</property>
+<property xml:space="preserve" name="TestElement.name">Once Only Controller</property>
+</testelement>
+<node>
+<testelement class="org.apache.jmeter.protocol.http.sampler.HTTPSampler">
+<property xml:space="preserve" name="HTTPSampler.mimetype"/>
+<property xml:space="preserve" name="TestElement.gui_class">org.apache.jmeter.protocol.http.control.gui.HttpTestSampleGui</property>
+<property xml:space="preserve" name="HTTPSampler.path">/</property>
+<collection class="java.util.ArrayList" name="AbstractSampler.assertions"/>
+<property xml:space="preserve" name="HTTPSampler.FILE_FIELD"/>
+<property xml:space="preserve" name="TestElement.test_class">org.apache.jmeter.protocol.http.sampler.HTTPSampler</property>
+<property xml:space="preserve" name="HTTPSampler.method">GET</property>
+<property xml:space="preserve" name="TestElement.name">Home Page</property>
+<property xml:space="preserve" name="HTTPSampler.domain"/>
+<property xml:space="preserve" name="HTTPSampler.use_keepalive">false</property>
+<property xml:space="preserve" name="HTTPSampler.protocol">http</property>
+<property xml:space="preserve" name="HTTPSampler.follow_redirects">false</property>
+<property xml:space="preserve" name="HTTPSampler.port"/>
+<testelement class="org.apache.jmeter.config.Arguments" name="HTTPsampler.Arguments">
+<property xml:space="preserve" name="TestElement.gui_class">org.apache.jmeter.protocol.http.gui.HTTPArgumentsPanel</property>
+<property xml:space="preserve" name="TestElement.test_class">org.apache.jmeter.config.Arguments</property>
+<collection class="java.util.ArrayList" name="Arguments.arguments"/>
+<property xml:space="preserve" name="TestElement.name"/>
+</testelement>
+<property xml:space="preserve" name="HTTPSampler.FILE_NAME"/>
+</testelement>
+</node>
+</node>
+<node>
+<testelement class="org.apache.jmeter.protocol.http.sampler.HTTPSampler">
+<property xml:space="preserve" name="HTTPSampler.mimetype"/>
+<property xml:space="preserve" name="TestElement.gui_class">org.apache.jmeter.protocol.http.control.gui.HttpTestSampleGui</property>
+<property xml:space="preserve" name="HTTPSampler.path">/site/bugs.html</property>
+<collection class="java.util.ArrayList" name="AbstractSampler.assertions"/>
+<property xml:space="preserve" name="HTTPSampler.FILE_FIELD"/>
+<property xml:space="preserve" name="TestElement.test_class">org.apache.jmeter.protocol.http.sampler.HTTPSampler</property>
+<property xml:space="preserve" name="HTTPSampler.method">GET</property>
+<property xml:space="preserve" name="TestElement.name">Bug Page</property>
+<property xml:space="preserve" name="HTTPSampler.domain"/>
+<property xml:space="preserve" name="HTTPSampler.use_keepalive">false</property>
+<property xml:space="preserve" name="HTTPSampler.protocol">http</property>
+<property xml:space="preserve" name="HTTPSampler.follow_redirects">false</property>
+<property xml:space="preserve" name="HTTPSampler.port"/>
+<testelement class="org.apache.jmeter.config.Arguments" name="HTTPsampler.Arguments">
+<property xml:space="preserve" name="TestElement.gui_class">org.apache.jmeter.protocol.http.gui.HTTPArgumentsPanel</property>
+<property xml:space="preserve" name="TestElement.test_class">org.apache.jmeter.config.Arguments</property>
+<collection class="java.util.ArrayList" name="Arguments.arguments"/>
+<property xml:space="preserve" name="TestElement.name"/>
+</testelement>
+<property xml:space="preserve" name="HTTPSampler.FILE_NAME"/>
+</testelement>
+</node>
+<node>
+<testelement class="org.apache.jmeter.reporters.ResultCollector">
+<property xml:space="preserve" name="TestElement.gui_class">org.apache.jmeter.visualizers.GraphVisualizer</property>
+<property xml:space="preserve" name="TestElement.test_class">org.apache.jmeter.reporters.ResultCollector</property>
+<property xml:space="preserve" name="TestElement.name">File Reporter</property>
+<property xml:space="preserve" name="filename">once-only-test.dat</property>
+<property xml:space="preserve" name="ResultCollector.error_logging">false</property>
+</testelement>
+</node>
+</node>
+</node>
diff --git a/jakarta-jmeter/bin/testfiles/ProxyServerTestPlan.jmx b/jakarta-jmeter/bin/testfiles/ProxyServerTestPlan.jmx
index bb68bbe..5c8068b 100644
--- a/jakarta-jmeter/bin/testfiles/ProxyServerTestPlan.jmx
+++ b/jakarta-jmeter/bin/testfiles/ProxyServerTestPlan.jmx
@@ -1,33 +1,42 @@
-<?xml version="1.0"?>
-
-<TestPlan>
-<threadgroups>
-<ThreadGroup name="Thread Group" numThreads="1" rampUp="0">
-<controllers>
-<LoopController type="org.apache.jmeter.control.LoopController" name="Loop Controller" iterations="1">
-<configElements>
-<ProxyControl type="org.apache.jmeter.protocol.http.proxy.ProxyControl">
-<property name="port">8080</property>
-<property name="name">HTTP Proxy Server</property>
-<property name="includes"><Arguments>
-</Arguments>
-</property>
-<property name="excludes"><Arguments>
-</Arguments>
-</property>
-</ProxyControl>
-</configElements>
-<controllers>
-</controllers>
-</LoopController>
-</controllers>
-<timers>
-</timers>
-<listeners>
-</listeners>
-</ThreadGroup>
-
-</threadgroups>
-<configElements>
-</configElements>
-</TestPlan>
+<?xml version="1.0" encoding="UTF-8"?>
+<node>
+<testelement class="org.apache.jmeter.testelement.TestPlan">
+<testelement class="org.apache.jmeter.config.Arguments" name="TestPlan.user_defined_variables">
+<property xml:space="preserve" name="TestElement.gui_class">org.apache.jmeter.config.gui.ArgumentsPanel</property>
+<property xml:space="preserve" name="TestElement.test_class">org.apache.jmeter.config.Arguments</property>
+<collection class="java.util.ArrayList" name="Arguments.arguments"/>
+<property xml:space="preserve" name="TestElement.name">Argument List</property>
+</testelement>
+<property xml:space="preserve" name="TestElement.gui_class">org.apache.jmeter.control.gui.TestPlanGui</property>
+<collection class="java.util.LinkedList" name="TestPlan.thread_groups"/>
+<property xml:space="preserve" name="TestElement.test_class">org.apache.jmeter.testelement.TestPlan</property>
+<property xml:space="preserve" name="TestElement.name">Test Plan</property>
+<property xml:space="preserve" name="TestPlan.functional_mode">false</property>
+</testelement>
+<node>
+<testelement class="org.apache.jmeter.threads.ThreadGroup">
+<property xml:space="preserve" name="TestElement.gui_class">org.apache.jmeter.threads.gui.ThreadGroupGui</property>
+<property xml:space="preserve" name="TestElement.test_class">org.apache.jmeter.threads.ThreadGroup</property>
+<testelement class="org.apache.jmeter.control.LoopController" name="ThreadGroup.main_controller">
+<property xml:space="preserve" name="TestElement.gui_class">org.apache.jmeter.control.gui.LoopControlPanel</property>
+<property xml:space="preserve" name="LoopController.loops">1</property>
+<property xml:space="preserve" name="TestElement.test_class">org.apache.jmeter.control.LoopController</property>
+<property xml:space="preserve" name="TestElement.name">Loop Controller</property>
+<property xml:space="preserve" name="LoopController.continue_forever">false</property>
+</testelement>
+<property xml:space="preserve" name="TestElement.name">Thread Group</property>
+<property xml:space="preserve" name="ThreadGroup.num_threads">1</property>
+<property xml:space="preserve" name="ThreadGroup.ramp_time">0</property>
+</testelement>
+<node>
+<testelement class="org.apache.jmeter.protocol.http.proxy.ProxyControl">
+<property xml:space="preserve" name="TestElement.gui_class">org.apache.jmeter.protocol.http.proxy.gui.ProxyControlGui</property>
+<property xml:space="preserve" name="TestElement.test_class">org.apache.jmeter.protocol.http.proxy.ProxyControl</property>
+<property xml:space="preserve" name="TestElement.name">HTTP Proxy Server</property>
+<collection class="java.util.LinkedList" name="ProxyControlGui.include_list"/>
+<collection class="java.util.LinkedList" name="ProxyControlGui.exclude_list"/>
+<property xml:space="preserve" name="ProxyControlGui.port">8080</property>
+</testelement>
+</node>
+</node>
+</node>
diff --git a/jakarta-jmeter/bin/testfiles/SimpleTestPlan.jmx b/jakarta-jmeter/bin/testfiles/SimpleTestPlan.jmx
index 03af422..817ee64 100644
--- a/jakarta-jmeter/bin/testfiles/SimpleTestPlan.jmx
+++ b/jakarta-jmeter/bin/testfiles/SimpleTestPlan.jmx
@@ -1,110 +1,167 @@
-<?xml version="1.0"?>
-
-<TestPlan>
-<threadgroups>
-<ThreadGroup name="Jakarta Users" numThreads="1" rampUp="0">
-<controllers>
-<LoopController type="org.apache.jmeter.control.LoopController" name="Loop Controller" iterations="1">
-<configElements>
-<ConfigElement type="org.apache.jmeter.protocol.http.config.UrlConfig">
-<property name="name">Defaults</property>
-<property name="PROTOCOL">http</property>
-<property name="domain">jakarta.apache.org</property>
-<property name="arguments"><Arguments>
-</Arguments>
-</property>
-<property name="path">/</property>
-<property name="method">GET</property>
-</ConfigElement>
-</configElements>
-<controllers>
-<Controller type="org.apache.jmeter.control.LogicController" name="Ant Pages">
-<configElements>
-</configElements>
-<controllers>
-<HttpTestSample type="org.apache.jmeter.protocol.http.control.HttpTestSample" name="Home Page" getImages="false">
-<defaultUrl>
-<ConfigElement type="org.apache.jmeter.protocol.http.config.MultipartUrlConfig">
-<property name="PROTOCOL">http</property>
-<property name="arguments"><Arguments>
-</Arguments>
-</property>
-<property name="path">/ant/index.html</property>
-<property name="method">GET</property>
-</ConfigElement></defaultUrl>
-<configElements>
-</configElements>
-<controllers>
-</controllers>
-</HttpTestSample>
-
-<HttpTestSample type="org.apache.jmeter.protocol.http.control.HttpTestSample" name="News Page" getImages="false">
-<defaultUrl>
-<ConfigElement type="org.apache.jmeter.protocol.http.config.MultipartUrlConfig">
-<property name="PROTOCOL">http</property>
-<property name="arguments"><Arguments>
-</Arguments>
-</property>
-<property name="path">/ant/antnews.html</property>
-<property name="method">GET</property>
-</ConfigElement></defaultUrl>
-<configElements>
-</configElements>
-<controllers>
-</controllers>
-</HttpTestSample>
-
-</controllers>
-</Controller>
-<Controller type="org.apache.jmeter.control.LogicController" name="Log4J Pages">
-<configElements>
-</configElements>
-<controllers>
-<HttpTestSample type="org.apache.jmeter.protocol.http.control.HttpTestSample" name="Home Page" getImages="false">
-<defaultUrl>
-<ConfigElement type="org.apache.jmeter.protocol.http.config.MultipartUrlConfig">
-<property name="PROTOCOL">http</property>
-<property name="arguments"><Arguments>
-</Arguments>
-</property>
-<property name="path">/log4j/index.html</property>
-<property name="method">GET</property>
-</ConfigElement></defaultUrl>
-<configElements>
-</configElements>
-<controllers>
-</controllers>
-</HttpTestSample>
-
-<HttpTestSample type="org.apache.jmeter.protocol.http.control.HttpTestSample" name="History Page" getImages="false">
-<defaultUrl>
-<ConfigElement type="org.apache.jmeter.protocol.http.config.MultipartUrlConfig">
-<property name="PROTOCOL">http</property>
-<property name="arguments"><Arguments>
-</Arguments>
-</property>
-<property name="path">/log4j/docs/history.html</property>
-<property name="method">GET</property>
-</ConfigElement></defaultUrl>
-<configElements>
-</configElements>
-<controllers>
-</controllers>
-</HttpTestSample>
-
-</controllers>
-</Controller>
-</controllers>
-</LoopController>
-</controllers>
-<timers>
-</timers>
-<listeners>
-<Filer type="org.apache.jmeter.reporters.Filer" name="File Reporter" verbose="true" append="false" autoFlush="false" viewSubmitData="true" file="simple-test.dat"/>
-</listeners>
-</ThreadGroup>
-
-</threadgroups>
-<configElements>
-</configElements>
-</TestPlan>
+<?xml version="1.0" encoding="UTF-8"?>
+<node>
+<testelement class="org.apache.jmeter.testelement.TestPlan">
+<testelement class="org.apache.jmeter.config.Arguments" name="TestPlan.user_defined_variables">
+<property xml:space="preserve" name="TestElement.gui_class">org.apache.jmeter.config.gui.ArgumentsPanel</property>
+<property xml:space="preserve" name="TestElement.test_class">org.apache.jmeter.config.Arguments</property>
+<collection class="java.util.ArrayList" name="Arguments.arguments"/>
+<property xml:space="preserve" name="TestElement.name">Argument List</property>
+</testelement>
+<property xml:space="preserve" name="TestElement.gui_class">org.apache.jmeter.control.gui.TestPlanGui</property>
+<collection class="java.util.LinkedList" name="TestPlan.thread_groups"/>
+<property xml:space="preserve" name="TestElement.test_class">org.apache.jmeter.testelement.TestPlan</property>
+<property xml:space="preserve" name="TestElement.name">Test Plan</property>
+<property xml:space="preserve" name="TestPlan.functional_mode">false</property>
+</testelement>
+<node>
+<testelement class="org.apache.jmeter.threads.ThreadGroup">
+<property xml:space="preserve" name="TestElement.gui_class">org.apache.jmeter.threads.gui.ThreadGroupGui</property>
+<property xml:space="preserve" name="TestElement.test_class">org.apache.jmeter.threads.ThreadGroup</property>
+<testelement class="org.apache.jmeter.control.LoopController" name="ThreadGroup.main_controller">
+<property xml:space="preserve" name="TestElement.gui_class">org.apache.jmeter.control.gui.LoopControlPanel</property>
+<property xml:space="preserve" name="LoopController.loops">1</property>
+<property xml:space="preserve" name="TestElement.test_class">org.apache.jmeter.control.LoopController</property>
+<property xml:space="preserve" name="TestElement.name">Loop Controller</property>
+<property xml:space="preserve" name="LoopController.continue_forever">false</property>
+</testelement>
+<property xml:space="preserve" name="TestElement.name">Jakarta Users</property>
+<property xml:space="preserve" name="ThreadGroup.num_threads">1</property>
+<property xml:space="preserve" name="ThreadGroup.ramp_time">0</property>
+</testelement>
+<node>
+<testelement class="org.apache.jmeter.config.ConfigTestElement">
+<property xml:space="preserve" name="HTTPSampler.path">/</property>
+<property xml:space="preserve" name="TestElement.gui_class">org.apache.jmeter.protocol.http.config.gui.HttpDefaultsGui</property>
+<property xml:space="preserve" name="TestElement.test_class">org.apache.jmeter.config.ConfigTestElement</property>
+<property xml:space="preserve" name="TestElement.name">Defaults</property>
+<property xml:space="preserve" name="HTTPSampler.domain">jakarta.apache.org</property>
+<property xml:space="preserve" name="HTTPSampler.port"/>
+<testelement class="org.apache.jmeter.config.Arguments" name="HTTPsampler.Arguments">
+<property xml:space="preserve" name="TestElement.gui_class">org.apache.jmeter.protocol.http.gui.HTTPArgumentsPanel</property>
+<property xml:space="preserve" name="TestElement.test_class">org.apache.jmeter.config.Arguments</property>
+<collection class="java.util.ArrayList" name="Arguments.arguments"/>
+<property xml:space="preserve" name="TestElement.name"/>
+</testelement>
+</testelement>
+</node>
+<node>
+<testelement class="org.apache.jmeter.control.GenericController">
+<property xml:space="preserve" name="TestElement.gui_class">org.apache.jmeter.control.gui.LogicControllerGui</property>
+<property xml:space="preserve" name="TestElement.test_class">org.apache.jmeter.control.GenericController</property>
+<property xml:space="preserve" name="TestElement.name">Ant Pages</property>
+</testelement>
+<node>
+<testelement class="org.apache.jmeter.protocol.http.sampler.HTTPSampler">
+<property xml:space="preserve" name="HTTPSampler.mimetype"/>
+<property xml:space="preserve" name="TestElement.gui_class">org.apache.jmeter.protocol.http.control.gui.HttpTestSampleGui</property>
+<property xml:space="preserve" name="HTTPSampler.path">/ant/index.html</property>
+<collection class="java.util.ArrayList" name="AbstractSampler.assertions"/>
+<property xml:space="preserve" name="HTTPSampler.FILE_FIELD"/>
+<property xml:space="preserve" name="TestElement.test_class">org.apache.jmeter.protocol.http.sampler.HTTPSampler</property>
+<property xml:space="preserve" name="HTTPSampler.method">GET</property>
+<property xml:space="preserve" name="TestElement.name">Home Page</property>
+<property xml:space="preserve" name="HTTPSampler.domain"/>
+<property xml:space="preserve" name="HTTPSampler.use_keepalive">false</property>
+<property xml:space="preserve" name="HTTPSampler.protocol">http</property>
+<property xml:space="preserve" name="HTTPSampler.follow_redirects">false</property>
+<property xml:space="preserve" name="HTTPSampler.port"/>
+<testelement class="org.apache.jmeter.config.Arguments" name="HTTPsampler.Arguments">
+<property xml:space="preserve" name="TestElement.gui_class">org.apache.jmeter.protocol.http.gui.HTTPArgumentsPanel</property>
+<property xml:space="preserve" name="TestElement.test_class">org.apache.jmeter.config.Arguments</property>
+<collection class="java.util.ArrayList" name="Arguments.arguments"/>
+<property xml:space="preserve" name="TestElement.name"/>
+</testelement>
+<property xml:space="preserve" name="HTTPSampler.FILE_NAME"/>
+</testelement>
+</node>
+<node>
+<testelement class="org.apache.jmeter.protocol.http.sampler.HTTPSampler">
+<property xml:space="preserve" name="HTTPSampler.mimetype"/>
+<property xml:space="preserve" name="TestElement.gui_class">org.apache.jmeter.protocol.http.control.gui.HttpTestSampleGui</property>
+<property xml:space="preserve" name="HTTPSampler.path">/ant/antnews.html</property>
+<collection class="java.util.ArrayList" name="AbstractSampler.assertions"/>
+<property xml:space="preserve" name="HTTPSampler.FILE_FIELD"/>
+<property xml:space="preserve" name="TestElement.test_class">org.apache.jmeter.protocol.http.sampler.HTTPSampler</property>
+<property xml:space="preserve" name="HTTPSampler.method">GET</property>
+<property xml:space="preserve" name="TestElement.name">News Page</property>
+<property xml:space="preserve" name="HTTPSampler.domain"/>
+<property xml:space="preserve" name="HTTPSampler.use_keepalive">false</property>
+<property xml:space="preserve" name="HTTPSampler.protocol">http</property>
+<property xml:space="preserve" name="HTTPSampler.follow_redirects">false</property>
+<property xml:space="preserve" name="HTTPSampler.port"/>
+<testelement class="org.apache.jmeter.config.Arguments" name="HTTPsampler.Arguments">
+<property xml:space="preserve" name="TestElement.gui_class">org.apache.jmeter.protocol.http.gui.HTTPArgumentsPanel</property>
+<property xml:space="preserve" name="TestElement.test_class">org.apache.jmeter.config.Arguments</property>
+<collection class="java.util.ArrayList" name="Arguments.arguments"/>
+<property xml:space="preserve" name="TestElement.name"/>
+</testelement>
+<property xml:space="preserve" name="HTTPSampler.FILE_NAME"/>
+</testelement>
+</node>
+</node>
+<node>
+<testelement class="org.apache.jmeter.control.GenericController">
+<property xml:space="preserve" name="TestElement.gui_class">org.apache.jmeter.control.gui.LogicControllerGui</property>
+<property xml:space="preserve" name="TestElement.test_class">org.apache.jmeter.control.GenericController</property>
+<property xml:space="preserve" name="TestElement.name">Log4J Pages</property>
+</testelement>
+<node>
+<testelement class="org.apache.jmeter.protocol.http.sampler.HTTPSampler">
+<property xml:space="preserve" name="HTTPSampler.mimetype"/>
+<property xml:space="preserve" name="TestElement.gui_class">org.apache.jmeter.protocol.http.control.gui.HttpTestSampleGui</property>
+<property xml:space="preserve" name="HTTPSampler.path">/log4j/index.html</property>
+<collection class="java.util.ArrayList" name="AbstractSampler.assertions"/>
+<property xml:space="preserve" name="HTTPSampler.FILE_FIELD"/>
+<property xml:space="preserve" name="TestElement.test_class">org.apache.jmeter.protocol.http.sampler.HTTPSampler</property>
+<property xml:space="preserve" name="HTTPSampler.method">GET</property>
+<property xml:space="preserve" name="TestElement.name">Home Page</property>
+<property xml:space="preserve" name="HTTPSampler.domain"/>
+<property xml:space="preserve" name="HTTPSampler.use_keepalive">false</property>
+<property xml:space="preserve" name="HTTPSampler.protocol">http</property>
+<property xml:space="preserve" name="HTTPSampler.follow_redirects">false</property>
+<property xml:space="preserve" name="HTTPSampler.port"/>
+<testelement class="org.apache.jmeter.config.Arguments" name="HTTPsampler.Arguments">
+<property xml:space="preserve" name="TestElement.gui_class">org.apache.jmeter.protocol.http.gui.HTTPArgumentsPanel</property>
+<property xml:space="preserve" name="TestElement.test_class">org.apache.jmeter.config.Arguments</property>
+<collection class="java.util.ArrayList" name="Arguments.arguments"/>
+<property xml:space="preserve" name="TestElement.name"/>
+</testelement>
+<property xml:space="preserve" name="HTTPSampler.FILE_NAME"/>
+</testelement>
+</node>
+<node>
+<testelement class="org.apache.jmeter.protocol.http.sampler.HTTPSampler">
+<property xml:space="preserve" name="HTTPSampler.mimetype"/>
+<property xml:space="preserve" name="TestElement.gui_class">org.apache.jmeter.protocol.http.control.gui.HttpTestSampleGui</property>
+<property xml:space="preserve" name="HTTPSampler.path">/log4j/docs/history.html</property>
+<collection class="java.util.ArrayList" name="AbstractSampler.assertions"/>
+<property xml:space="preserve" name="HTTPSampler.FILE_FIELD"/>
+<property xml:space="preserve" name="TestElement.test_class">org.apache.jmeter.protocol.http.sampler.HTTPSampler</property>
+<property xml:space="preserve" name="HTTPSampler.method">GET</property>
+<property xml:space="preserve" name="TestElement.name">History Page</property>
+<property xml:space="preserve" name="HTTPSampler.domain"/>
+<property xml:space="preserve" name="HTTPSampler.use_keepalive">false</property>
+<property xml:space="preserve" name="HTTPSampler.protocol">http</property>
+<property xml:space="preserve" name="HTTPSampler.follow_redirects">false</property>
+<property xml:space="preserve" name="HTTPSampler.port"/>
+<testelement class="org.apache.jmeter.config.Arguments" name="HTTPsampler.Arguments">
+<property xml:space="preserve" name="TestElement.gui_class">org.apache.jmeter.protocol.http.gui.HTTPArgumentsPanel</property>
+<property xml:space="preserve" name="TestElement.test_class">org.apache.jmeter.config.Arguments</property>
+<collection class="java.util.ArrayList" name="Arguments.arguments"/>
+<property xml:space="preserve" name="TestElement.name"/>
+</testelement>
+<property xml:space="preserve" name="HTTPSampler.FILE_NAME"/>
+</testelement>
+</node>
+</node>
+<node>
+<testelement class="org.apache.jmeter.reporters.ResultCollector">
+<property xml:space="preserve" name="TestElement.gui_class">org.apache.jmeter.visualizers.GraphVisualizer</property>
+<property xml:space="preserve" name="TestElement.test_class">org.apache.jmeter.reporters.ResultCollector</property>
+<property xml:space="preserve" name="TestElement.name">File Reporter</property>
+<property xml:space="preserve" name="filename">simple-test.dat</property>
+<property xml:space="preserve" name="ResultCollector.error_logging">false</property>
+</testelement>
+</node>
+</node>
+</node>
diff --git a/jakarta-jmeter/bin/testfiles/proxy.jmx b/jakarta-jmeter/bin/testfiles/proxy.jmx
index c6a20d1..8b75c94 100644
--- a/jakarta-jmeter/bin/testfiles/proxy.jmx
+++ b/jakarta-jmeter/bin/testfiles/proxy.jmx
@@ -1,31 +1,55 @@
-<?xml version="1.0"?>
-
-<ThreadGroup name="Thread Group" numThreads="1" rampUp="0">
-<controllers>
-<LoopController type="org.apache.jmeter.control.LoopController" name="Loop Controller" iterations="-1">
-<configElements>
-</configElements>
-<controllers>
-<Controller type="org.apache.jmeter.control.LogicController" name="Simple Controller">
-<configElements>
-<ConfigElement type="org.apache.jmeter.protocol.http.config.UrlConfig">
-<property name="name">HTTP Request Defaults</property>
-<property name="PROTOCOL">http</property>
-<property name="domain">jakarta.apache.org</property>
-<property name="arguments"><Arguments>
-</Arguments>
-</property>
-<property name="method">GET</property>
-</ConfigElement>
-</configElements>
-<controllers>
-</controllers>
-</Controller>
-</controllers>
-</LoopController>
-</controllers>
-<timers>
-</timers>
-<listeners>
-</listeners>
-</ThreadGroup>
+<?xml version="1.0" encoding="UTF-8"?>
+<node>
+<testelement class="org.apache.jmeter.testelement.TestPlan">
+<testelement class="org.apache.jmeter.config.Arguments" name="TestPlan.user_defined_variables">
+<property xml:space="preserve" name="TestElement.gui_class">org.apache.jmeter.config.gui.ArgumentsPanel</property>
+<property xml:space="preserve" name="TestElement.test_class">org.apache.jmeter.config.Arguments</property>
+<collection class="java.util.ArrayList" name="Arguments.arguments"/>
+<property xml:space="preserve" name="TestElement.name">Argument List</property>
+</testelement>
+<property xml:space="preserve" name="TestElement.gui_class">org.apache.jmeter.control.gui.TestPlanGui</property>
+<collection class="java.util.LinkedList" name="TestPlan.thread_groups"/>
+<property xml:space="preserve" name="TestElement.test_class">org.apache.jmeter.testelement.TestPlan</property>
+<property xml:space="preserve" name="TestElement.name">Test Plan</property>
+<property xml:space="preserve" name="TestPlan.functional_mode">false</property>
+</testelement>
+<node>
+<testelement class="org.apache.jmeter.threads.ThreadGroup">
+<property xml:space="preserve" name="TestElement.gui_class">org.apache.jmeter.threads.gui.ThreadGroupGui</property>
+<property xml:space="preserve" name="TestElement.test_class">org.apache.jmeter.threads.ThreadGroup</property>
+<testelement class="org.apache.jmeter.control.LoopController" name="ThreadGroup.main_controller">
+<property xml:space="preserve" name="TestElement.gui_class">org.apache.jmeter.control.gui.LoopControlPanel</property>
+<property xml:space="preserve" name="LoopController.loops">-1</property>
+<property xml:space="preserve" name="TestElement.test_class">org.apache.jmeter.control.LoopController</property>
+<property xml:space="preserve" name="TestElement.name">Loop Controller</property>
+<property xml:space="preserve" name="LoopController.continue_forever">false</property>
+</testelement>
+<property xml:space="preserve" name="TestElement.name">Thread Group</property>
+<property xml:space="preserve" name="ThreadGroup.num_threads">1</property>
+<property xml:space="preserve" name="ThreadGroup.ramp_time">0</property>
+</testelement>
+<node>
+<testelement class="org.apache.jmeter.control.GenericController">
+<property xml:space="preserve" name="TestElement.gui_class">org.apache.jmeter.control.gui.LogicControllerGui</property>
+<property xml:space="preserve" name="TestElement.test_class">org.apache.jmeter.control.GenericController</property>
+<property xml:space="preserve" name="TestElement.name">Simple Controller</property>
+</testelement>
+<node>
+<testelement class="org.apache.jmeter.config.ConfigTestElement">
+<property xml:space="preserve" name="HTTPSampler.path"/>
+<property xml:space="preserve" name="TestElement.gui_class">org.apache.jmeter.protocol.http.config.gui.HttpDefaultsGui</property>
+<property xml:space="preserve" name="TestElement.test_class">org.apache.jmeter.config.ConfigTestElement</property>
+<property xml:space="preserve" name="TestElement.name">HTTP Request Defaults</property>
+<property xml:space="preserve" name="HTTPSampler.domain">jakarta.apache.org</property>
+<property xml:space="preserve" name="HTTPSampler.port"/>
+<testelement class="org.apache.jmeter.config.Arguments" name="HTTPsampler.Arguments">
+<property xml:space="preserve" name="TestElement.gui_class">org.apache.jmeter.protocol.http.gui.HTTPArgumentsPanel</property>
+<property xml:space="preserve" name="TestElement.test_class">org.apache.jmeter.config.Arguments</property>
+<collection class="java.util.ArrayList" name="Arguments.arguments"/>
+<property xml:space="preserve" name="TestElement.name"/>
+</testelement>
+</testelement>
+</node>
+</node>
+</node>
+</node>
diff --git a/jakarta-jmeter/build.xml b/jakarta-jmeter/build.xml
index 0969ebd..5920a26 100644
--- a/jakarta-jmeter/build.xml
+++ b/jakarta-jmeter/build.xml
@@ -1,15 +1,20 @@
+<?xml version="1.0"?>
 <project name="JMeter" default="all" basedir=".">
+  <description>
+    To build JMeter from source and install:
+      ./build.sh
+    To rebuild and install:
+      ./build.sh install
+    For more info:
+      ./build.sh -projecthelp
+
+    To diagnose usage of deprecated APIs:
+      ./build.sh -Ddeprecation=on clean compile
+  </description>
+
+  <!-- JMeter version -->
+  <property name="version" value="1.8.1"/>
 
-  <!-- Where the class files should live -->
-  <property name="build.dir" value="build"/>
-  <property name="build.core" value="build/core"/>
-  <property name="build.http" value="build/protocol/http"/>
-  <property name="build.ftp" value="build/protocol/ftp"/>
-  <property name="build.jdbc" value="build/protocol/jdbc"/>
-  <property name="build.java" value="build/protocol/java"/>
-  <property name="build.components" value="build/components"/>
-  <property name="build.functions" value="build/functions"/>
-  
   <!-- Where the Sources live -->
   <property name="src.dir" value="src"/>
   <property name="src.core" value="src/core"/>
@@ -19,408 +24,412 @@
   <property name="src.java" value="src/protocol/java"/>
   <property name="src.components" value="src/components"/>
   <property name="src.functions" value="src/functions"/>
-  
+  <property name="src.jorphan" value="src/jorphan"/>
+
+  <path id="srcpaths">
+    <pathelement location="${src.core}"/>
+    <pathelement location="${src.components}"/>
+    <pathelement location="${src.functions}"/>
+    <pathelement location="${src.http}"/>
+    <pathelement location="${src.ftp}"/>
+    <pathelement location="${src.jdbc}"/>
+    <pathelement location="${src.java}"/>
+    <pathelement location="${src.jorphan}"/>
+  </path>
+
+  <!-- Temporary build directories: where the .class live -->
+  <property name="build.dir" value="build"/>
+  <property name="build.core" value="build/core"/>
+  <property name="build.http" value="build/protocol/http"/>
+  <property name="build.ftp" value="build/protocol/ftp"/>
+  <property name="build.jdbc" value="build/protocol/jdbc"/>
+  <property name="build.java" value="build/protocol/java"/>
+  <property name="build.components" value="build/components"/>
+  <property name="build.functions" value="build/functions"/>
+  <property name="build.jorphan" value="build/jorphan"/>
+
+  <!-- Where the build result .jars will be placed -->
+  <property name="jar.dest" value="lib/ext"/>
+  <property name="jorphan.jar.dest" value="lib"/>
+
   <!-- Where the API documentation lives -->
-  <property name="docs.api.dest.dir" value="docs/api"/>
-  <property name="version" value="1.7.3"/>
-  <property name="docs.src" value="./xdocs"/>
-  <property name="docs.dest" value="./docs"/>
-  <property name="printable_docs.dest" value="./printable_docs"/>
+  <property name="docs.api.dest" value="docs/api"/>
+
+  <!-- Where the doc sources and results live -->
+  <property name="docs.src" value="xdocs"/>
+  <property name="docs.dest" value="docs"/>
+  <property name="printable_docs.dest" value="printable_docs"/>
+
+  <!-- Where the distribution packages will be created -->
+  <property name="dist.dir" value="dist"/>
+
+  <!-- Compilation parameters -->
   <property name="optimize" value="on"/>
-  <property name="tools.jar" value="${java.home}/lib/tools.jar"/>
+  <property name="deprecation" value="off"/>
+  <property name="target.java.version" value="1.2"/>
+
+  <!-- List of Unix executable files in the binary distribution -->
+  <property name="dist.executables" value="bin/jmeter bin/jmeter-server"/>
+
+  <!-- 3rd party libraries to be included in the binary distribution -->
+  <property name="avalon-excalibur.jar" value="lib/avalon-excalibur-4.1.jar"/>
+  <property name="avalon-framework.jar" value="lib/avalon-framework.jar"/>
+  <property name="jakarta-oro.jar" value="lib/jakarta-oro.jar"/>
+  <property name="junit.jar" value="lib/junit.jar"/>
+  <property name="logkit.jar" value="lib/logkit-1.0.1.jar"/>
+  <property name="xalan.jar" value="lib/xalan.jar"/>
+  <property name="xerces.jar" value="lib/xerces.jar"/>
+  <property name="xml-apis.jar" value="lib/xml-apis.jar"/>
+
+  <fileset dir="." id="external.jars">
+    <include name="${avalon-excalibur.jar}"/>
+    <include name="${avalon-framework.jar}"/>
+    <include name="${jakarta-oro.jar}"/>
+    <include name="${junit.jar}"/>
+    <include name="${logkit.jar}"/>
+    <include name="${xalan.jar}"/>
+    <include name="${xerces.jar}"/>
+    <include name="${xml-apis.jar}"/>
+  </fileset>
+
+  <!-- Directory where these 3rd party libraries will live -->
+  <property name="lib.dir" value="lib"/>
 
   <!-- Build classpath -->
   <path id="classpath">
-	<fileset dir=".">
-	 <include name="**/lib/*.jar"/>
-	<include name="**/ext/*.jar"/>
-	</fileset>
-	  <pathelement location="${tools.jar}"/>
+    <fileset dir="${lib.dir}" includes="*.jar"/>
   </path>
 
-  <path id="testClasspath">
-		<path refid="classpath"/>
-		<fileset dir="./lib/ext">
-	 		<include name="*.jar"/>
-			<include name="*.jar"/>
-		</fileset>
-  </path>
+  <target name="init" depends="check-libs,report-missing-libs"/>
+  <target name="init-docs" depends="check-anakia,report-anakia-missing"/>
+
+  <!--
+    - Check for optional libraries.
+    -->
+  <target name="check-libs" description="Check availability of optional libraries." unless="assuming.libs.present">
+    <available classname="com.sun.net.ssl.internal.ssl.Provider" property="jsse.present">
+      <classpath refid="classpath"/>
+    </available>
+    <available classname="javax.mail.Transport" property="javamail.present">
+      <classpath refid="classpath"/>
+    </available>
+    <available classname="javax.activation.DataHandler" property="javamail.complete">
+      <classpath refid="classpath"/>
+    </available>
+    <available classname="iaik.protocol.https.Handler" property="isasilk.present">
+      <classpath refid="classpath"/>
+    </available>
+  </target>
+
+  <!--
+    - Messages for missing libraries
+    -->
+  <target name="ssl-message" depends="check-libs" unless="jsse.present">
+    <echo message="Classes for SSL not found in classpath"/>
+  </target>
+
+  <target name="iaik-message" depends="check-libs" unless="isasilk.present">
+    <echo message="Classes for IAIK iSaSiLk not found in classpath"/>
+  </target>
+
+  <target name="mail-message" depends="check-libs" unless="javamail.complete">
+    <echo message="Classes for Mail support not found in classpath"/>
+  </target>
+
+  <target name="report-missing-libs" depends="ssl-message,iaik-message,mail-message"/>
+
+  <!--
+    - Check for anakia task
+    -->
+  <target name="check-anakia">
+    <available classname="org.apache.velocity.anakia.AnakiaTask" property="AnakiaTask.present"/>
+  </target>
+  <target name="report-anakia-missing" depends="check-anakia" unless="AnakiaTask.present">
+    <echo>
+      AnakiaTask is not present, documentation will not be generated.
+    </echo>
+  </target>
+
+  <target name="compile-core" depends="compile-jorphan" description="Compile JMeter core classes.">
+    <mkdir dir="${build.core}"/>
+    <replaceregexp file="${src.core}/org/apache/jmeter/util/JMeterUtils.java"
+    	match="VERSION=&quot;.*?&quot;"
+	replace="VERSION=&quot;${version}&quot;"/>
+    <javac srcdir="${src.core}" destdir="${build.core}" optimize="${optimize}" debug="on" target="${target.java.version}" deprecation="${deprecation}">
+      <include name="**/*.java"/>
+      <exclude name="org/apache/jmeter/util/JsseSSLManager.java" unless="jsse.present"/>
+      <exclude name="org/apache/jmeter/util/IaikSSLManager.java" unless="isasilk.present"/>
+      <exclude name="org/apache/jmeter/util/keystore/PKCS12KeyStore.java" unless="isasilk.present"/>
+      <exclude name="org/apache/jmeter/util/keystore/DefaultKeyStore.java" unless="jsse.present"/>
+      <exclude name="org/apache/jmeter/reporters/MailerResultCollector.java" unless="javamail.complete"/>
+      <classpath>
+        <path refid="classpath"/>
+        <pathelement location="${build.jorphan}"/>
+      </classpath>
+    </javac>
+  </target>
+
+  <target name="compile-components" depends="compile-jorphan,compile-core" description="Compile generic (protocol-independent) components.">
+    <mkdir dir="${build.components}"/>
+    <javac srcdir="${src.components}" destdir="${build.components}" optimize="${optimize}" debug="on" target="${target.java.version}" deprecation="${deprecation}">
+      <include name="**/*.java"/>
+      <exclude name="org/apache/jmeter/visualizers/MailerVisualizer.java" unless="javamail.complete"/>
+      <exclude name="org/apache/jmeter/visualizers/MailerModel.java" unless="javamail.complete"/>
+      <exclude name="org/apache/jmeter/reporters/MailerResultCollector.java" unless="javamail.complete"/>
+      <classpath>
+        <path refid="classpath"/>
+        <pathelement location="${build.jorphan}"/>
+        <pathelement location="${build.core}"/>
+      </classpath>
+    </javac>
+  </target>
+
+  <target name="compile-functions" depends="compile-jorphan,compile-core" description="Compile functions.">
+    <mkdir dir="${build.functions}"/>
+    <javac srcdir="${src.functions}" destdir="${build.functions}" optimize="${optimize}" debug="on" target="${target.java.version}" deprecation="${deprecation}">
+      <include name="**/*.java"/>
+      <classpath>
+        <path refid="classpath"/>
+        <pathelement location="${build.jorphan}"/>
+        <pathelement location="${build.core}"/>
+      </classpath>
+    </javac>
+  </target>
+
+  <target name="compile-http" depends="compile-jorphan,compile-core" description="Compile components specific to HTTP sampling.">
+    <mkdir dir="${build.http}"/>
+    <javac srcdir="${src.http}" destdir="${build.http}" optimize="${optimize}" debug="on" target="${target.java.version}" deprecation="${deprecation}">
+      <include name="**/*.java"/>
+      <classpath>
+        <path refid="classpath"/>
+        <pathelement location="${build.jorphan}"/>
+        <pathelement location="${build.core}"/>
+      </classpath>
+    </javac>
+  </target>
+
+  <target name="compile-ftp" depends="compile-jorphan,compile-core" description="Compile components specific to FTP sampling.">
+    <mkdir dir="${build.ftp}"/>
+    <javac srcdir="${src.ftp}" destdir="${build.ftp}" optimize="${optimize}" debug="on" target="${target.java.version}" deprecation="${deprecation}">
+      <include name="**/*.java"/>
+      <classpath>
+        <path refid="classpath"/>
+        <pathelement location="${build.jorphan}"/>
+        <pathelement location="${build.core}"/>
+      </classpath>
+    </javac>
+  </target>
+
+  <target name="compile-jdbc" depends="compile-jorphan,compile-core" description="Compile components specific to JDBC sampling.">
+    <mkdir dir="${build.jdbc}"/>
+    <javac srcdir="${src.jdbc}" destdir="${build.jdbc}" optimize="${optimize}" debug="on" target="${target.java.version}" deprecation="${deprecation}">
+      <include name="**/*.java"/>
+      <classpath>
+        <path refid="classpath"/>
+        <pathelement location="${build.jorphan}"/>
+        <pathelement location="${build.core}"/>
+      </classpath>
+    </javac>
+  </target>
+
+  <target name="compile-java" depends="compile-jorphan,compile-core" description="Compile components specific to Java sampling.">
+    <mkdir dir="${build.java}"/>
+    <javac srcdir="${src.java}" destdir="${build.java}" optimize="${optimize}" debug="on" target="${target.java.version}" deprecation="${deprecation}">
+      <include name="**/*.java"/>
+      <classpath>
+        <path refid="classpath"/>
+        <pathelement location="${build.jorphan}"/>
+        <pathelement location="${build.core}"/>
+      </classpath>
+    </javac>
+  </target>
+
+  <target name="compile-protocols" depends="compile-http,compile-ftp,compile-jdbc,compile-java" description="Compile all protocol-specific components."/>
+
+  <target name="compile-jorphan" depends="init" description="Compile JOrphan utility classes.">
+    <mkdir dir="${build.jorphan}"/>
+    <javac srcdir="${src.jorphan}" destdir="${build.jorphan}" optimize="${optimize}" debug="on" target="${target.java.version}" deprecation="${deprecation}">
+      <include name="**/*.java"/>
+      <classpath>
+        <path refid="classpath"/>
+      </classpath>
+    </javac>
+  </target>
+
+  <target name="compile-rmi" depends="compile-jorphan,compile-core" description="Compile RMI stubs and skeletons.">
+    <rmic base="${build.core}" classname="org.apache.jmeter.engine.RemoteJMeterEngineImpl">
+      <classpath>
+        <path refid="classpath"/>
+        <pathelement location="${build.jorphan}"/>
+        <pathelement path="${build.core}"/>
+      </classpath>
+    </rmic>
+    <rmic base="${build.core}" classname="org.apache.jmeter.samplers.RemoteSampleListenerImpl">
+      <classpath>
+        <path refid="classpath"/>
+        <pathelement path="${build.core}"/>
+      </classpath>
+    </rmic>
+  </target>
+
+  <target name="compile" depends="compile-core,compile-components,compile-functions,compile-protocols,compile-rmi" description="Compile everything."/>
+
+  <target name="api-docs" description="Generate the API documentation.">
+    <mkdir dir="${docs.api.dest}"/>
+    <javadoc sourcepathref="srcpaths" destdir="${docs.api.dest}" Protected="yes" author="yes" version="yes" doctitle="Apache JMeter APIs Specification" windowtitle="Apache JMeter API Specification" header="&lt;b&gt;Apache JMeter&lt;/b&gt;&lt;br&gt;&lt;font size='-1'&gt;1.7&lt;/font&gt;" bottom="Copyright &#xA9; 1998-2003 Apache Software Foundation. All Rights Reserved." packagenames="org.apache.jmeter.*">
+      <classpath refid="classpath"/>
+    </javadoc>
+  </target>
+
+  <target name="package" depends="compile">
+    <mkdir dir="${jar.dest}"/>
+    <jar jarfile="${jar.dest}/ApacheJMeter_core.jar" excludes="**/NewDriver*" manifest="${src.core}/MANIFEST">
+      <fileset dir="${build.core}"/>
+      <fileset dir="${src.core}" includes="org/apache/jmeter/images/"/>
+      <fileset dir="${src.core}" includes="org/apache/jmeter/resources/">
+        <exclude name="*eucJP*"/>
+      </fileset>
+      <fileset dir="${src.core}" includes="org/apache/jmeter/help.txt"/>
+    </jar>
+    <jar jarfile="bin/ApacheJMeter.jar" includes="**/NewDriver*" manifest="${src.core}/MANIFEST" basedir="${build.core}"/>
+    <jar jarfile="${jar.dest}/ApacheJMeter_components.jar" basedir="${build.components}"/>
+    <jar jarfile="${jar.dest}/ApacheJMeter_functions.jar" basedir="${build.functions}"/>
+    <jar jarfile="${jar.dest}/ApacheJMeter_http.jar" basedir="${build.http}"/>
+    <jar jarfile="${jar.dest}/ApacheJMeter_ftp.jar" basedir="${build.ftp}"/>
+    <jar jarfile="${jar.dest}/ApacheJMeter_jdbc.jar" basedir="${build.jdbc}"/>
+    <jar jarfile="${jar.dest}/ApacheJMeter_java.jar" basedir="${build.java}"/>
+    <jar jarfile="${jorphan.jar.dest}/jorphan.jar" basedir="${build.jorphan}"/>
+  </target>
+
+  <target name="install" depends="package" description="Install JMeter.">
+    <fixcrlf srcdir="." eol="lf" includes="**/jmeter,**/jmeter-server"/>
+  </target>
+
+  <target name="all" depends="clean,install" description="Default target: build from source and install."/>
+
+  <target name="assume-libs-present">
+    <property name="assuming.libs.present" value="true"/>
+
+    <property name="jsse.present" value="assume"/>
+    <property name="javamail.present" value="assume"/>
+    <property name="javamail.complete" value="assume"/>
+  </target>
+
+  <patternset id="dist.binaries">
+    <include name="bin/"/>
+    <include name="${lib.dir}/"/>
+    <include name="${jar.dest}/"/> <!-- redundant but future-proof -->
+    <include name="${docs.dest}/"/> <exclude name="${docs.api.dest}/"/>
+    <exclude name="**/mail.jar"/>
+    <exclude name="**/activation.jar"/>
+    <exclude name="**/mailapi.jar"/>
+    <exclude name="**/pop3.jar"/>
+    <exclude name="**/smtp.jar"/>
+    <exclude name="**/imap.jar"/>
+    <include name="README"/>
+    <include name="LICENSE"/>
+  </patternset>
   
-  <path id="srcpaths">
-  	<pathelement location="${src.core}"/>
-  		<pathelement location="${src.core}"/>
-  		<pathelement location="${src.components}"/>
-  		<pathelement location="${src.functions}"/>
-  		<pathelement location="${src.http}"/>
-  		<pathelement location="${src.ftp}"/>
-  		<pathelement location="${src.jdbc}"/>
-  		<pathelement location="${src.java}"/>
-  </path>
+  <patternset id="dist.sources">
+  <include name="${src.dir}/"/>
+  <include name="${docs.src}/"/>
+  <include name="*"/>
+  </patternset>
+
+  <target name="dist" depends="assume-libs-present,clean,install,all-docs,test" description="Create the distribution packages.">
+    <property name="dist.name" value="jakarta-jmeter-${version}"/>
+    <mkdir dir="${dist.dir}"/>
+    <!-- copy 3rd party libraries if not already there -->
+    <copy todir="${lib.dir}" flatten="true">
+      <fileset refid="external.jars"/>
+    </copy>
+    <tar destfile="${dist.dir}/${dist.name}.tar" longfile="gnu">
+      <tarfileset dir="." prefix="${dist.name}" excludes="${dist.executables}" defaultexcludes="yes">
+        <patternset refid="dist.binaries"/>
+      </tarfileset>
+      <tarfileset mode="755" includes="${dist.executables}" dir="." prefix="${dist.name}" defaultexcludes="yes"/>
+    </tar>
+    <gzip zipfile="${dist.dir}/${dist.name}.tgz" src="${dist.dir}/${dist.name}.tar" />
+    <zip zipfile="${dist.dir}/${dist.name}.zip">
+      <zipfileset dir="." prefix="${dist.name}" defaultexcludes="yes">
+        <patternset refid="dist.binaries"/>
+      </zipfileset>
+    </zip>
+    <tar destfile="${dist.dir}/${dist.name}-javadoc.tar" longfile="gnu">
+      <tarfileset includes="${docs.api.dest}/" dir="." prefix="${dist.name}" defaultexcludes="yes"/>
+    </tar>
+    <gzip zipfile="${dist.dir}/${dist.name}-javadoc.tgz" src="${dist.dir}/${dist.name}-javadoc.tar" />
+    <zip zipfile="${dist.dir}/${dist.name}-javadoc.zip">
+      <zipfileset includes="${docs.api.dest}/" dir="." prefix="${dist.name}" defaultexcludes="yes"/>
+    </zip>
+  </target>
   
-  <target name="init">
-  	<mkdir dir="${build.dir}"/>
-  	<mkdir dir="${build.core}"/>
-  	<mkdir dir="${build.http}"/>
-  	<mkdir dir="${build.jdbc}"/>
-  	<mkdir dir="${build.ftp}"/>
-  	<mkdir dir="${build.java}"/>
-  	<mkdir dir="${build.components}"/>
-  	<mkdir dir="${build.functions}"/>
+  <target name="src_dist" depends="assume-libs-present,clean,install,all-docs,test" description="Create the distribution packages.">
+    <property name="dist.name" value="jakarta-jmeter-${version}"/>
+    <mkdir dir="${dist.dir}"/>
+    <!-- copy 3rd party libraries if not already there -->
+    <copy todir="${lib.dir}" flatten="true">
+      <fileset refid="external.jars"/>
+    </copy>
+    <tar destfile="${dist.dir}/${dist.name}.src.tar" longfile="gnu">
+      <tarfileset dir="." prefix="${dist.name}" excludes="${dist.executables}" defaultexcludes="yes">
+        <patternset refid="dist.binaries"/>
+        <patternset refid="dist.sources"/>
+      </tarfileset>
+      <tarfileset mode="755" includes="${dist.executables}" dir="." prefix="${dist.name}" defaultexcludes="yes"/>
+    </tar>
+    <gzip zipfile="${dist.dir}/${dist.name}.src.tgz" src="${dist.dir}/${dist.name}.src.tar" />
+    <zip zipfile="${dist.dir}/${dist.name}.src.zip">
+      <zipfileset dir="." prefix="${dist.name}" defaultexcludes="yes">
+        <patternset refid="dist.binaries"/>
+        <patternset refid="dist.sources"/>
+      </zipfileset>
+    </zip>
+    <tar destfile="${dist.dir}/${dist.name}-javadoc.tar" longfile="gnu">
+      <tarfileset includes="${docs.api.dest}/" dir="." prefix="${dist.name}" defaultexcludes="yes"/>
+    </tar>
+    <gzip zipfile="${dist.dir}/${dist.name}-javadoc.tgz" src="${dist.dir}/${dist.name}-javadoc.tar" />
+    <zip zipfile="${dist.dir}/${dist.name}-javadoc.zip">
+      <zipfileset includes="${docs.api.dest}/" dir="." prefix="${dist.name}" defaultexcludes="yes"/>
+    </zip>
+  </target>
+
+  <target name="clean" description="Clean up to force a build from source.">
+    <delete file="bin/ApacheJMeter.jar"/>
+    <delete file="lib/jorphan.jar"/>
+    <delete dir="${jar.dest}"/>
+    <delete dir="${build.dir}"/>
+    <delete dir="${dist.dir}"/>
   </target>
 
+  <target name="docs" depends="init-docs" if="AnakiaTask.present" description="Generate browsable HTML documentation.">
+    <taskdef name="anakia" classname="org.apache.velocity.anakia.AnakiaTask"/>
+    <anakia basedir="${docs.src}" destdir="${docs.dest}/" extension=".html" style="./xdocs/stylesheets/site.vsl" projectFile="./stylesheets/project.xml" excludes="**/stylesheets/**" includes="**/*.xml" lastModifiedCheck="true" velocityPropertiesFile="${docs.src}/velocity.properties"/>
+    <copy todir="${docs.dest}">
+      <fileset dir="${docs.src}">
+        <include name="images/**"/>
+        <include name="demos/**"/>
+      </fileset>
+    </copy>
+  </target>
 
-	<!--
-	- Check for optional JSSE libs.
-	-->
-	<target name="check.jsse.libs">
-	  <available classname="com.sun.net.ssl.internal.ssl.Provider"
-					 property="jsse.present">
-		 <classpath refid="classpath"/>
-	  </available>
-	</target>
-
-	<!--
-	- Check for optional JavaMail libs.
-	-->
-	<target name="check.mail.libs">
-		<available classname="javax.mail.Transport"
-					 property="javamail.present">
-		 <classpath refid="classpath"/>
-	  </available>
-	  <available classname="javax.activation.DataHandler"
-					 property="javamail.complete"/>
-	</target>
-	
-	<!--
-	- Check for optional IAIK libs (related to SSL)
-	-->
-	<target name="check.iaik.libs">
-		<available classname="iaik.protocol.https.Handler"
-					 property="isasilk.present">
-		 <classpath refid="classpath"/>
-	  </available>
-	</target>
-
-	<!--
-	- Check for anakia task
-	-->
-	<target name="check.anakia">
-	  <available classname="org.apache.velocity.anakia.AnakiaTask"
-					 property="AnakiaTask.present"/>
-	</target>
-
-	<target name="no.anakia" depends="check.anakia" unless="AnakiaTask.present">
-	  <echo>
-		 AnakiaTask is not present, documentation will not be generated.
-	  </echo>
-	</target>
-
-	<target name="ssl.message" depends="check.jsse.libs,iaik.message" unless="jsse.present">
-	  <echo message="Classes for SSL not found in classpath"/>
-	</target>
-
-	<target name="iaik.message" depends="check.iaik.libs" unless="isasilk.present">
-	  <echo message="Classes for IAIK iSaSiLk not found in classpath"/>
-	</target>
-
-	<target name="mail.message" depends="check.mail.libs" unless="javamail.complete">
-	  <echo message="Classes for Mail support not found in classpath"/>
-	</target>
-
-	<!--
-	- Compiles the source into class files - dumping results into the
-	- bin/clases directory
-	-->
-	<target name="compile_all" depends="init,ssl.message,iaik.message,mail.message">		
-		<javac
-				 destdir="${build.dir}"
-				 optimize="${optimize}"
-				 debug="on"
-				 target="1.3">
-			<src>			
-				<path refid="srcpaths"/>
-			</src>
-		  <include name="**/*.java"/>
-		  <exclude name="org/apache/jmeter/util/JsseSSLManager.java"
-					  unless="jsse.present"/>
-		  <exclude name="org/apache/jmeter/util/IaikSSLManager.java"
-					  unless="isasilk.present"/>
-		  <exclude name="org/apache/jmeter/util/keystore/PKCS12KeyStore.java"
-					  unless="isasilk.present"/>
-		  <exclude name="org/apache/jmeter/util/keystore/DefaultKeyStore.java"
-					  unless="jsse.present"/>
-		  <exclude name="org/apache/jmeter/visualizers/MailerVisualizer.java"
-					  unless="javamail.complete"/>
-		  <exclude name="org/apache/jmeter/reporters/MailerResultCollector.java"
-					  unless="javamail.complete"/>
-		  <classpath refid="classpath"/>
-		</javac>
-	</target>
-	
-	<target name="compile_core" depends="init,compile_all">		
-		<copy tofile="${src.core}/org/apache/jmeter/util/JMeterUtils.java_temp"
-				file="${src.core}/org/apache/jmeter/util/JMeterUtils.java"
-				overwrite="yes"/>
-		<replace file="${src.core}/org/apache/jmeter/util/JMeterUtils.java"
-					token="@VERSION@"
-					value="${version}"/>
-		<javac   srcdir="${src.core}"
-				 destdir="${build.core}"
-				 optimize="${optimize}"
-				 debug="on"
-				 target="1.3">
-		  <include name="**/*.java"/>
-		  <exclude name="org/apache/jmeter/util/JsseSSLManager.java"
-					  unless="jsse.present"/>
-		  <exclude name="org/apache/jmeter/util/IaikSSLManager.java"
-					  unless="isasilk.present"/>
-		  <exclude name="org/apache/jmeter/util/keystore/PKCS12KeyStore.java"
-					  unless="isasilk.present"/>
-		  <exclude name="org/apache/jmeter/util/keystore/DefaultKeyStore.java"
-					  unless="jsse.present"/>
-		  <exclude name="org/apache/jmeter/visualizers/MailerVisualizer.java"
-					  unless="javamail.complete"/>
-		  <exclude name="org/apache/jmeter/reporters/MailerResultCollector.java"
-					  unless="javamail.complete"/>
-		  <classpath>
-		  	<path refid="classpath"/>
-		  	<pathelement location="${build.dir}"/>
-		  </classpath>
-		</javac>
-		<copy tofile="${src.core}/org/apache/jmeter/util/JMeterUtils.java"
-				file="${src.core}/org/apache/jmeter/util/JMeterUtils.java_temp"
-				overwrite="yes"/>
-		<delete file="${src.core}/org/apache/jmeter/util/JMeterUtils.java_temp"/>
-	</target>
-	
-	<target name="compile_components" depends="init,compile_all">
-		<javac srcdir="${src.components}"
-				 destdir="${build.components}"
-				 optimize="${optimize}"
-				 debug="on"
-				 target="1.3">
-		  <include name="**/*.java"/>
-		  <exclude name="org/apache/jmeter/visualizers/MailerVisualizer.java"
-					  unless="javamail.complete"/>
-		  <exclude name="org/apache/jmeter/reporters/MailerResultCollector.java"
-					  unless="javamail.complete"/>
-		  <classpath>
-		  	<path refid="classpath"/>
-		  	<pathelement location="${build.dir}"/>
-		  </classpath>
-		</javac>
-	</target>
-	
-	<target name="compile_functions" depends="init,compile_all">
-		<javac srcdir="${src.functions}"
-				 destdir="${build.functions}"
-				 optimize="${optimize}"
-				 debug="on"
-				 target="1.3">
-		  <include name="**/*.java"/>
-		  <classpath>
-		  	<path refid="classpath"/>
-		  	<pathelement location="${build.dir}"/>
-		  </classpath>
-		</javac>
-	</target>
-	
-	<target name="compile_http" depends="init,compile_all">
-		<javac srcdir="${src.http}"
-				 destdir="${build.http}"
-				 optimize="${optimize}"
-				 debug="on"
-				 target="1.3">
-		  <include name="**/*.java"/>
-		  <classpath>
-		  	<path refid="classpath"/>
-		  	<pathelement location="${build.dir}"/>
-		  </classpath>
-		</javac>
-	</target>
-	
-	<target name="compile_ftp" depends="init,compile_all">
-		<javac srcdir="${src.ftp}"
-				 destdir="${build.ftp}"
-				 optimize="${optimize}"
-				 debug="on"
-				 target="1.3">
-		  <include name="**/*.java"/>
-		  <classpath>
-		  	<path refid="classpath"/>
-		  	<pathelement location="${build.dir}"/>
-		  </classpath>
-		</javac>
-	</target>
-	
-	<target name="compile_jdbc" depends="init,compile_all">
-		<javac srcdir="${src.jdbc}"
-				 destdir="${build.jdbc}"
-				 optimize="${optimize}"
-				 debug="on"
-				 target="1.3">
-		  <include name="**/*.java"/>
-		  <classpath>
-		  	<path refid="classpath"/>
-		  	<pathelement location="${build.dir}"/>
-		  </classpath>
-		</javac>
-	</target>
-	
-	<target name="compile_java" depends="init,compile_all">
-		<javac srcdir="${src.java}"
-				 destdir="${build.java}"
-				 optimize="${optimize}"
-				 debug="on"
-				 target="1.3">
-		  <include name="**/*.java"/>
-		  <classpath>
-		  	<path refid="classpath"/>
-		  	<pathelement location="${build.dir}"/>
-		  </classpath>
-		</javac>
-	</target>
-	
-	<target name="compile_protocols" depends="clean,compile_http,compile_ftp,compile_jdbc,compile_java"/>
-	
-	<target name="compile" depends="clean,compile_core,compile_components,compile_functions,compile_protocols"/>
-
-	<target name="rmi" depends="compile">
-	  <rmic base="${build.core}" classname="org.apache.jmeter.engine.RemoteJMeterEngineImpl">
-	  	<classpath>
-	  		<path refid="classpath"/>      
-	  		<pathelement path="${build.core}"/>
-	  	</classpath>
-	  </rmic>
-	  	
-	  <rmic classpath="${build.core}" base="${build.core}" classname="org.apache.jmeter.samplers.RemoteSampleListenerImpl"/>
-	</target>
-
-	<!--
-	- Generates java-docs
-	-->
-	<target name="api-docs">
-	  <mkdir dir="${docs.api.dest.dir}"/>
-	  <javadoc sourcepathref="srcpaths"
-				  destdir="${docs.api.dest.dir}"
-				  Protected="yes" author="yes" version="yes"
-				  doctitle="Apache JMeter APIs Specification"
-				  windowtitle="Apache JMeter API Specification"
-				  header="&lt;b&gt;Apache JMeter&lt;/b&gt;&lt;br&gt;&lt;font size='-1'&gt;1.7&lt;/font&gt;"
-				  bottom="Copyright &#169; 1998-2002 Apache Software Foundation. All Rights Reserved."
-				  packagenames="org.apache.jmeter.*">
-		 <classpath refid="classpath"/>
-	  </javadoc>
-	</target>
-
-	<!--
-	- Creates the ApacheJMeter.jar file.
-	-->
-	<target name="package" depends="compile,rmi">
-	  <copy toDir="${build.core}/org/apache/jmeter/images">
-		 <fileset dir="${src.core}/org/apache/jmeter/images"/>
-	  </copy>
-	  <copy toDir="${build.core}/org/apache/jmeter/resources">
-		 <fileset dir="${src.core}/org/apache/jmeter/resources">
-			<exclude name="*eucJP*"/>
-		</fileset>
-	  </copy>
-	  <copy toFile="${build.core}/org/apache/jmeter/help.txt" 
-	  		file="${src.core}/org/apache/jmeter/help.txt"/>	
-	  <mkdir dir="./lib/ext/"/> 
-
-	  <jar jarfile="./lib/ext/ApacheJMeter_core.jar" excludes="**/NewDriver*" manifest="${src.core}/MANIFEST" basedir="${build.core}"/>
-	  <jar jarfile="bin/ApacheJMeter.jar" includes="**/NewDriver*" manifest="${src.core}/MANIFEST" basedir="${build.core}"/>
-	  <jar jarfile="./lib/ext/ApacheJMeter_components.jar" basedir="${build.components}"/>
-	  <jar jarfile="./lib/ext/ApacheJMeter_functions.jar" basedir="${build.functions}"/>
-	  <jar jarfile="./lib/ext/ApacheJMeter_http.jar" basedir="${build.http}"/>
-	  <jar jarfile="./lib/ext/ApacheJMeter_ftp.jar" basedir="${build.ftp}"/>
-	  <jar jarfile="./lib/ext/ApacheJMeter_jdbc.jar" basedir="${build.jdbc}"/>
-	  <jar jarfile="./lib/ext/ApacheJMeter_java.jar" basedir="${build.java}"/>
-	</target>
-
-	<!--
-	- Copies the jar file to bin/ and everything else needed to run JMeter
-	- from bin/.
-	-->
-	<target name="install" depends="package">
-	  <fixcrlf srcdir="." eol="lf" includes="**/jmeter,**/jmeter-server" />
-	</target>
-
-	<!--
-	- Another name for install(?)
-	-->
-	<target name="all" depends="install"/>
-
-	<target name="assume_packages_present">
-		<property name="jsse.present" value="assume"/>
-		<property name="javamail.present" value="assume"/>
-		<property name="javamail.complete" value="assume"/>
-	</target>
-
-	<!--
-	- Creates the distribution packages
-	-->
-	<target name="dist" depends="assume_packages_present,clean,install">
-		<zip zipfile="../ApacheJMeter_${version}.zip">
-			<fileset dir="../">
-				<include name="jakarta-jmeter/**"/>
-				<exclude name="**/build/**"/>
-				<exclude name="**/classes*/**"/>
-				<exclude name="**/xdocs/**"/>
-				<exclude name="jakarta-jmeter/ext/**"/>
-			</fileset>
-		</zip>
-		<tar tarfile="../ApacheJMeter_${version}.tar" basedir=".." includes="jakarta-jmeter/**"
-				excludes="**/classes*/**,**/xdocs/**,jakarta-jmeter/ext/**,**/build/**"/>
-		<gzip zipfile="../ApacheJMeter_${version}.tar.gz" src="../ApacheJMeter_${version}.tar" />
-	</target>
-
-	<!--
-	- Deletes old build files.
-	-->
-	<target name="clean">
-	  <delete file="bin/ApacheJMeter.jar"/>
-	  <delete dir="lib/ext"/>
-	  <delete dir="${build.dir}"/>
-	  <delete dir="${docs.api.dest.dir}"/>
-	</target>
-
-
-	<target name="docs" depends="no.anakia" if="AnakiaTask.present">
-	  <taskdef name="anakia" classname="org.apache.velocity.anakia.AnakiaTask"/>
-	  <anakia basedir="${docs.src}" destdir="${docs.dest}/"
-				 extension=".html" style="./xdocs/stylesheets/site.vsl"
-				 projectFile="./stylesheets/project.xml"
-				 excludes="**/stylesheets/**"
-				 includes="**/*.xml"
-				 lastModifiedCheck="true"
-				 velocityPropertiesFile="${docs.src}/velocity.properties"/>
-		<copy todir="${docs.dest}">
-			<fileset dir="${docs.src}">
-				<include name="images/**"/>
-				<include name="demos/**"/>
-			</fileset>
-		</copy>
-	</target>
-
-	<target name="printable_docs" depends="no.anakia" if="AnakiaTask.present">
-	  <taskdef name="anakia" classname="org.apache.velocity.anakia.AnakiaTask"/>
-	  <anakia basedir="${docs.src}" destdir="${docs.dest}/"
-				 extension=".html" style="./xdocs/stylesheets/site_printable.vsl"
-				 projectFile="./stylesheets/project.xml"
-				 excludes="**/stylesheets/**"
-				 includes="**/*.xml"
-				 lastModifiedCheck="true"
-				 velocityPropertiesFile="${docs.src}/velocity.properties"/>
-
-	</target>
-
-	<target name="test" depends="install">
-	  <java classname="org.apache.jmeter.junit.AllTests" fork="yes" dir="${basedir}/bin">
-		 <classpath refid="testClasspath"/>
-		 <arg value="./jmeter.properties"/>
-	  </java>
+  <target name="printable-docs" depends="init-docs" if="AnakiaTask.present" description="Generate printable HTML documentation.">
+    <taskdef name="anakia" classname="org.apache.velocity.anakia.AnakiaTask"/>
+    <anakia basedir="${docs.src}" destdir="${docs.dest}/" extension=".html" style="./xdocs/stylesheets/site_printable.vsl" projectFile="./stylesheets/project.xml" excludes="**/stylesheets/**" includes="**/*.xml" lastModifiedCheck="true" velocityPropertiesFile="${docs.src}/velocity.properties"/>
   </target>
 
+  <target name="all-docs" depends="docs,printable-docs,api-docs" description="Generate documentation."/>
+
+  <target name="test" depends="install" description="Run tests">
+    <java classname="org.apache.jorphan.test.AllTests" fork="yes" dir="${basedir}/bin">
+      <classpath>
+	<path refid="classpath"/>
+	<fileset dir="${jar.dest}" includes="*.jar"/>
+      </classpath>
+
+      <arg value="../lib/ext"/>
+      <arg value="./jmeter.properties"/>
+      <arg value="org.apache.jmeter.util.JMeterUtils"/>
+    </java>
+  </target>
 </project>
diff --git a/jakarta-jmeter/src/CVS/Entries b/jakarta-jmeter/src/CVS/Entries
index 2957935..42a30af 100644
--- a/jakarta-jmeter/src/CVS/Entries
+++ b/jakarta-jmeter/src/CVS/Entries
@@ -1,5 +1,6 @@
-/MANIFEST/1.3/Fri Jun 29 01:37:38 2001//Tv1_7_3
+/MANIFEST/1.3/Fri Jun 29 01:37:38 2001//Tv1_8_1
 D/components////
 D/core////
 D/functions////
+D/jorphan////
 D/protocol////
diff --git a/jakarta-jmeter/src/CVS/Tag b/jakarta-jmeter/src/CVS/Tag
index 5f312fe..e2fda28 100644
--- a/jakarta-jmeter/src/CVS/Tag
+++ b/jakarta-jmeter/src/CVS/Tag
@@ -1 +1 @@
-Nv1_7_3
+Nv1_8_1
diff --git a/jakarta-jmeter/src/components/CVS/Tag b/jakarta-jmeter/src/components/CVS/Tag
index f4b6a59..75ba187 100644
--- a/jakarta-jmeter/src/components/CVS/Tag
+++ b/jakarta-jmeter/src/components/CVS/Tag
@@ -1 +1 @@
-Tv1_7_3
+Tv1_8_1
diff --git a/jakarta-jmeter/src/components/org/CVS/Tag b/jakarta-jmeter/src/components/org/CVS/Tag
index f4b6a59..75ba187 100644
--- a/jakarta-jmeter/src/components/org/CVS/Tag
+++ b/jakarta-jmeter/src/components/org/CVS/Tag
@@ -1 +1 @@
-Tv1_7_3
+Tv1_8_1
diff --git a/jakarta-jmeter/src/components/org/apache/CVS/Tag b/jakarta-jmeter/src/components/org/apache/CVS/Tag
index f4b6a59..75ba187 100644
--- a/jakarta-jmeter/src/components/org/apache/CVS/Tag
+++ b/jakarta-jmeter/src/components/org/apache/CVS/Tag
@@ -1 +1 @@
-Tv1_7_3
+Tv1_8_1
diff --git a/jakarta-jmeter/src/components/org/apache/jmeter/CVS/Entries b/jakarta-jmeter/src/components/org/apache/jmeter/CVS/Entries
index 023703c..d78df42 100644
--- a/jakarta-jmeter/src/components/org/apache/jmeter/CVS/Entries
+++ b/jakarta-jmeter/src/components/org/apache/jmeter/CVS/Entries
@@ -1,6 +1,6 @@
 D/assertions////
-D/config////
 D/control////
+D/modifiers////
 D/reporters////
 D/timers////
 D/visualizers////
diff --git a/jakarta-jmeter/src/components/org/apache/jmeter/CVS/Tag b/jakarta-jmeter/src/components/org/apache/jmeter/CVS/Tag
index f4b6a59..75ba187 100644
--- a/jakarta-jmeter/src/components/org/apache/jmeter/CVS/Tag
+++ b/jakarta-jmeter/src/components/org/apache/jmeter/CVS/Tag
@@ -1 +1 @@
-Tv1_7_3
+Tv1_8_1
diff --git a/jakarta-jmeter/src/components/org/apache/jmeter/assertions/CVS/Entries b/jakarta-jmeter/src/components/org/apache/jmeter/assertions/CVS/Entries
index 5d0d6aa..80f9068 100644
--- a/jakarta-jmeter/src/components/org/apache/jmeter/assertions/CVS/Entries
+++ b/jakarta-jmeter/src/components/org/apache/jmeter/assertions/CVS/Entries
@@ -1,3 +1,4 @@
-/DurationAssertion.java/1.1/Sun Aug 11 19:24:39 2002//Tv1_7_3
-/ResponseAssertion.java/1.1/Sun Aug 11 19:24:39 2002//Tv1_7_3
+/DurationAssertion.java/1.1/Sun Aug 11 19:24:39 2002//Tv1_8_1
+/ResponseAssertion.java/1.3/Tue Jan  7 02:09:50 2003//Tv1_8_1
+/SizeAssertion.java/1.3/Sat Jan 11 23:14:44 2003//Tv1_8_1
 D/gui////
diff --git a/jakarta-jmeter/src/components/org/apache/jmeter/assertions/CVS/Tag b/jakarta-jmeter/src/components/org/apache/jmeter/assertions/CVS/Tag
index 5f312fe..e2fda28 100644
--- a/jakarta-jmeter/src/components/org/apache/jmeter/assertions/CVS/Tag
+++ b/jakarta-jmeter/src/components/org/apache/jmeter/assertions/CVS/Tag
@@ -1 +1 @@
-Nv1_7_3
+Nv1_8_1
diff --git a/jakarta-jmeter/src/components/org/apache/jmeter/assertions/ResponseAssertion.java b/jakarta-jmeter/src/components/org/apache/jmeter/assertions/ResponseAssertion.java
index 0e29969..13d2a25 100644
--- a/jakarta-jmeter/src/components/org/apache/jmeter/assertions/ResponseAssertion.java
+++ b/jakarta-jmeter/src/components/org/apache/jmeter/assertions/ResponseAssertion.java
@@ -2,7 +2,7 @@
  * ====================================================================
  * The Apache Software License, Version 1.1
  *
- * Copyright (c) 2001 The Apache Software Foundation.  All rights
+ * Copyright (c) 2001-2003 The Apache Software Foundation.  All rights
  * reserved.
  *
  * Redistribution and use in source and binary forms, with or without
@@ -57,18 +57,22 @@ package org.apache.jmeter.assertions;
 import java.util.*;
 import java.io.Serializable;
 import org.apache.jmeter.samplers.SampleResult;
-import org.apache.jmeter.config.ConfigElement;
 import org.apache.jmeter.testelement.AbstractTestElement;
 
-import org.apache.oro.text.regex.*;
+import org.apache.oro.text.PatternCacheLRU;
+import org.apache.oro.text.MalformedCachePatternException;
+import org.apache.oro.text.regex.Perl5Compiler;
+import org.apache.oro.text.regex.Perl5Matcher;
+import org.apache.oro.text.regex.Pattern;
 
 /************************************************************
  *  Title: Jakarta-JMeter Description: Copyright: Copyright (c) 2001 Company:
  *  Apache
  *
- *@author     Michael Stover
- *@created    $Date: 2002/08/11 19:24:39 $
- *@version    1.0
+ * @author     Michael Stover
+ * @author     <a href="mailto:jacarlco@katun.com">Jonathan Carlson</a>
+ * @created    $Date: 2003/01/07 02:09:50 $
+ * @version    $Revision: 1.3 $
  ***********************************************************/
 
 public class ResponseAssertion extends AbstractTestElement implements Serializable, Assertion
@@ -86,8 +90,17 @@ public class ResponseAssertion extends AbstractTestElement implements Serializab
 	public final static int MATCH = 1 << 0;
 	public final static int CONTAINS = 1 << 1;
 	public final static int NOT = 1 << 2;
-	private transient static Perl5Compiler compiler = new Perl5Compiler();
-	private transient static Perl5Matcher matcher = new Perl5Matcher();
+
+	private static ThreadLocal matcher =
+	    new ThreadLocal()
+	    {
+			protected Object initialValue()
+			{
+			    return new Perl5Matcher();
+			}
+	    };
+	private static PatternCacheLRU patternCache =
+		new PatternCacheLRU(1000, new Perl5Compiler());
 
 	/************************************************************
 	 *  !ToDo (Constructor description)
@@ -278,50 +291,115 @@ public class ResponseAssertion extends AbstractTestElement implements Serializab
 		setTestType(getTestType() & (NOT ^ (CONTAINS | MATCH | NOT)));
 	}
 
-	private AssertionResult evaluateResponse(SampleResult response)
+    /**
+     * Make sure the response satisfies the specified assertion requirements.
+     * 
+     * @param response an instance of SampleResult
+     * @return an instance of AssertionResult
+     */
+    private AssertionResult evaluateResponse(SampleResult response)
+    {
+	boolean pass = true;
+	boolean not = (NOT & getTestType()) > 0;
+	AssertionResult result = new AssertionResult();
+	String responseString = new String(response.getResponseData());
+
+	try
 	{
-		boolean pass = true;
-		boolean not = (NOT & getTestType()) > 0;
-		AssertionResult result = new AssertionResult();
-		try
+	    // Get the Matcher for this thread
+	    Perl5Matcher localMatcher = (Perl5Matcher)matcher.get();
+
+	    Iterator iter = getTestStrings().iterator();
+	    while (iter.hasNext())
+	    {
+		String stringPattern= (String) iter.next();
+		Pattern pattern = patternCache.getPattern(stringPattern, Perl5Compiler.READ_ONLY_MASK);
+		boolean found;
+		if ((CONTAINS & getTestType()) > 0)
 		{
-			Iterator iter = getTestStrings().iterator();
-			while (iter.hasNext())
-			{
-				String pattern = (String)iter.next();
-				if ((CONTAINS & getTestType()) > 0)
-				{
-					pass = pass && (not ? !matcher.contains(new String(response.getResponseData()),
-							compiler.compile(pattern)) :
-							matcher.contains(new String(response.getResponseData()),
-							compiler.compile(pattern)));
-				}
-				else
-				{
-					pass = pass && (not ? !matcher.matches(new String(response.getResponseData()),
-							compiler.compile(pattern)) :
-							matcher.matches(new String(response.getResponseData()),
-							compiler.compile(pattern)));
-				}
-				if (!pass)
-				{
-					result.setFailure(true);
-					result.setFailureMessage("Test Failed, expected " + notMessage + failMessage + pattern);
-					break;
-				}
-			}
-			if(pass)
-			{
-				result.setFailure(false);
-			}
-			result.setError(false);
+		    found = localMatcher.contains(responseString, pattern);
 		}
-		catch(MalformedPatternException e)
+		else
 		{
-			result.setError(true);
-			result.setFailure(false);
-			result.setFailureMessage("Bad test configuration"+e);
+		    found = localMatcher.matches(responseString, pattern);
 		}
-		return result;
+		pass = not ? !found : found;
+
+		if (!pass)
+		{
+		    result.setFailure(true);
+		    result.setFailureMessage("Test Failed, expected " +
+			    notMessage + failMessage + stringPattern);
+		    break;
+		}
+	    }
+	    if(pass)
+	    {
+		result.setFailure(false);
+	    }
+	    result.setError(false);
 	}
+	catch (MalformedCachePatternException e)
+	{
+	    result.setError(true);
+	    result.setFailure(false);
+	    result.setFailureMessage("Bad test configuration"+e);
+	}
+
+	return result;
+    }
+
+    public static class Test extends junit.framework.TestCase
+    {
+	int threadsRunning;
+	int failed;
+
+	public Test(String name)
+	{
+	    super(name);
+	}
+
+	public void testThreadSafety() throws Exception
+	{
+	    Thread[] threads= new Thread[100];
+	    for (int i= 0; i < threads.length; i++) {
+		threads[i]= new TestThread();
+	    }
+	    failed= 0;
+	    for (int i= 0; i < threads.length; i++) {
+		threads[i].start();
+		threadsRunning++;
+	    }
+	    synchronized (this)
+	    {
+		while (threadsRunning>0) wait();
+	    }
+	    assertEquals(failed, 0);
+	}
+
+	class TestThread extends Thread
+	{
+	    static final String TEST_STRING= "Dábale arroz a la zorra el abad.";
+	    static final String TEST_PATTERN= ".*á.*\\.";
+	    public void run()
+	    {
+		ResponseAssertion assertion= new ResponseAssertion(
+			RESPONSE_DATA, CONTAINS, TEST_PATTERN);
+		SampleResult response= new SampleResult();
+		response.setResponseData(TEST_STRING.getBytes());
+		for (int i= 0; i< 100; i++) {
+		    AssertionResult result;
+		    result= assertion.evaluateResponse(response);
+		    if (result.isFailure() || result.isError()) {
+			failed++;
+		    }
+		}
+		synchronized(Test.this) {
+		  threadsRunning--;
+		  Test.this.notify();
+		}
+	    }
+	}
+    }
+
 }
diff --git a/jakarta-jmeter/src/components/org/apache/jmeter/assertions/SizeAssertion.java b/jakarta-jmeter/src/components/org/apache/jmeter/assertions/SizeAssertion.java
new file mode 100644
index 0000000..f2d7a9f
--- /dev/null
+++ b/jakarta-jmeter/src/components/org/apache/jmeter/assertions/SizeAssertion.java
@@ -0,0 +1,229 @@
+/*
+ * ====================================================================
+ * The Apache Software License, Version 1.1
+ *
+ * Copyright (c) 2001 The Apache Software Foundation.  All rights
+ * reserved.
+ *
+ * Redistribution and use in source and binary forms, with or without
+ * modification, are permitted provided that the following conditions
+ * are met:
+ *
+ * 1. Redistributions of source code must retain the above copyright
+ * notice, this list of conditions and the following disclaimer.
+ *
+ * 2. Redistributions in binary form must reproduce the above copyright
+ * notice, this list of conditions and the following disclaimer in
+ * the documentation and/or other materials provided with the
+ * distribution.
+ *
+ * 3. The end-user documentation included with the redistribution,
+ * if any, must include the following acknowledgment:
+ * "This product includes software developed by the
+ * Apache Software Foundation (http://www.apache.org/)."
+ * Alternately, this acknowledgment may appear in the software itself,
+ * if and wherever such third-party acknowledgments normally appear.
+ *
+ * 4. The names "Apache" and "Apache Software Foundation" and
+ * "Apache JMeter" must not be used to endorse or promote products
+ * derived from this software without prior written permission. For
+ * written permission, please contact apache@apache.org.
+ *
+ * 5. Products derived from this software may not be called "Apache",
+ * "Apache JMeter", nor may "Apache" appear in their name, without
+ * prior written permission of the Apache Software Foundation.
+ *
+ * THIS SOFTWARE IS PROVIDED ``AS IS'' AND ANY EXPRESSED OR IMPLIED
+ * WARRANTIES, INCLUDING, BUT NOT LIMITED TO, THE IMPLIED WARRANTIES
+ * OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE ARE
+ * DISCLAIMED.  IN NO EVENT SHALL THE APACHE SOFTWARE FOUNDATION OR
+ * ITS CONTRIBUTORS BE LIABLE FOR ANY DIRECT, INDIRECT, INCIDENTAL,
+ * SPECIAL, EXEMPLARY, OR CONSEQUENTIAL DAMAGES (INCLUDING, BUT NOT
+ * LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES; LOSS OF
+ * USE, DATA, OR PROFITS; OR BUSINESS INTERRUPTION) HOWEVER CAUSED AND
+ * ON ANY THEORY OF LIABILITY, WHETHER IN CONTRACT, STRICT LIABILITY,
+ * OR TORT (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT
+ * OF THE USE OF THIS SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF
+ * SUCH DAMAGE.
+ * ====================================================================
+ *
+ * This software consists of voluntary contributions made by many
+ * individuals on behalf of the Apache Software Foundation.  For more
+ * information on the Apache Software Foundation, please see
+ * <http://www.apache.org/>.
+ */
+package org.apache.jmeter.assertions;
+
+import java.io.Serializable;
+import java.text.MessageFormat;
+import org.apache.jmeter.util.JMeterUtils;
+import org.apache.jmeter.testelement.AbstractTestElement;
+import org.apache.jmeter.samplers.SampleResult;
+
+/**
+ * Checks if an Sample is sampled within a specified time-frame. If the
+ * duration is larger than the timeframe the Assertion is considered
+ * a failure.
+ *
+ Copyright: Copyright (c) 2001
+ * Company: Apache
+ *
+ * @author <a href="mailto:wolfram.rittmeyer@web.de">Wolfram Rittmeyer</a>
+ *
+ * @version $Revision: 1.3 $, $Date: 2003/01/11 23:14:44 $
+ */
+public class SizeAssertion extends AbstractTestElement implements Serializable, Assertion {
+
+	int comparator = 1;
+	String comparatorErrorMessage = "ERROR!";
+	//* Static int to signify the type of logical comparitor to assert
+	public final static int EQUAL = 1;
+	public final static int NOTEQUAL = 2;
+	public final static int GREATERTHAN = 3;
+	public final static int LESSTHAN = 4;
+	public final static int GREATERTHANEQUAL = 5;
+	public final static int LESSTHANEQUAL = 6;
+	/** Key for storing assertion-informations in the jmx-file. */
+	private static final String SIZE_KEY = "SizeAssertion.size";
+	byte[] resultData;
+	
+	/**
+	 * Returns the result of the Assertion. Here it checks wether the
+	 * Sample took to long to be considered successful. If so an AssertionResult
+	 * containing a FailureMessage will be returned. Otherwise the returned
+	 * AssertionResult will reflect the success of the Sample.
+	 */
+	public AssertionResult getResult(SampleResult response) {
+		AssertionResult result = new AssertionResult();
+		result.setFailure(false);
+
+		// is the Sample the correct size?
+		resultData = getResultBody(response.getResponseData());
+		long resultSize = resultData.length;
+		if ((!(compareSize(resultSize)) && (getAllowedSize() > 0))) {
+			result.setFailure(true);
+			Object[] arguments = { new Long(resultSize), new String(comparatorErrorMessage), new Long(getAllowedSize())};
+			String message = MessageFormat.format(JMeterUtils.getResString("size_assertion_failure"), arguments);
+			result.setFailureMessage(message);
+		}
+		return result;
+	}
+
+	/**
+	 * Returns the size in bytes to be asserted. A duration of 0 indicates this assertion is to 
+	 * be ignored.
+	 */
+	public long getAllowedSize() {
+		return getPropertyAsLong(SIZE_KEY);
+	}
+
+	/**
+	 * Set the size that shall be asserted.
+	 *
+	 * @param duration A number of bytes. Is not allowed to be negative. Use Double.MAX_VALUE to indicate illegal or empty inputs. This will result to not checking the assertion.
+	 *
+	 * @throws IllegalArgumentException If <code>duration</code> is negative.
+	 */
+	public void setAllowedSize(long size) throws IllegalArgumentException {
+		if (size < 0L) {
+			throw new IllegalArgumentException(JMeterUtils.getResString("argument_must_not_be_negative"));
+		}
+		if (size == Long.MAX_VALUE) {
+			setProperty(SIZE_KEY, new Long(0));
+		}
+		else {
+			setProperty(SIZE_KEY, new Long(size));
+		}
+	}
+
+	/**
+	 * Return the body of the http return.
+	 *
+	 * 
+	 *
+	 * 
+	 */
+	private byte[] getResultBody(byte[] resultData) {
+		for (int i = 0; i < (resultData.length - 1) ; i++) {
+	 		if (resultData[i] == '\n' && resultData[i+1] == '\n') {
+	 			return getByteArraySlice(resultData,(i+3),resultData.length);
+	 		}
+		}
+		return resultData;
+	}
+	 
+	/**
+	 * Return a slice of a byte array
+	 *
+	 * 
+	 *
+	 * 
+	 */
+	private byte[] getByteArraySlice(byte[] array, int begin, int end) {
+		byte[] slice = new byte [(end - begin  + 1)];
+		int count = 0;
+		for (int i = begin; i < end ; i++) {
+			slice[count] = array[i];
+			count++;
+		}
+		return slice;
+	}	 
+	
+	/**
+	 * Set the type of logical comparator to assert.
+	 *
+	 * Possible values are:
+	 * equal, not equal, 
+	 * greater than, less than, 
+	 * greater than eqaul, less than equal, .
+	 * 
+	 *@param comparator is an int value indicating logical comparator type
+	 *
+	 */
+	public void setLogicalComparator(int comparator) {
+		this.comparator = comparator;
+	}
+	
+	/**
+	 * Compares the the size of a return result to the set allowed size
+	 *using a logical comparator set in setLogicalComparator().
+	 *
+	 * Possible values are:
+	 * equal, not equal, 
+	 * greater than, less than, 
+	 * greater than eqaul, less than equal, .
+	 * 
+	 */
+	
+	private boolean compareSize(long resultSize) {
+		boolean result = false;
+		switch (comparator) 
+		{
+			case EQUAL: 
+				result = (resultSize == getAllowedSize());
+				comparatorErrorMessage = JMeterUtils.getResString("size_assertion_comparator_error_equal");
+				break;
+			case NOTEQUAL: 
+				result = (resultSize != getAllowedSize());
+				comparatorErrorMessage = JMeterUtils.getResString("size_assertion_comparator_error_notequal");
+				break;
+			case GREATERTHAN: 
+				result = (resultSize > getAllowedSize());
+				comparatorErrorMessage = JMeterUtils.getResString("size_assertion_comparator_error_greater");
+				break;
+			case LESSTHAN: 
+				result = (resultSize < getAllowedSize());
+				comparatorErrorMessage = JMeterUtils.getResString("size_assertion_comparator_error_less");
+				break;				
+			case GREATERTHANEQUAL: 
+				result = (resultSize >= getAllowedSize());
+				comparatorErrorMessage = JMeterUtils.getResString("size_assertion_comparator_error_greaterequal");
+				break;
+			case LESSTHANEQUAL: 
+				result = (resultSize <= getAllowedSize());
+				comparatorErrorMessage = JMeterUtils.getResString("size_assertion_comparator_error_lessequal");
+				break;
+		}
+		return result;
+	}
+}
diff --git a/jakarta-jmeter/src/components/org/apache/jmeter/assertions/gui/CVS/Entries b/jakarta-jmeter/src/components/org/apache/jmeter/assertions/gui/CVS/Entries
index 0a7fcf9..4c8b8a0 100644
--- a/jakarta-jmeter/src/components/org/apache/jmeter/assertions/gui/CVS/Entries
+++ b/jakarta-jmeter/src/components/org/apache/jmeter/assertions/gui/CVS/Entries
@@ -1,3 +1,4 @@
-/AssertionGui.java/1.1/Sun Aug 11 19:24:40 2002//Tv1_7_3
-/DurationAssertionGui.java/1.1/Sun Aug 11 19:24:40 2002//Tv1_7_3
+/AssertionGui.java/1.1/Sun Aug 11 19:24:40 2002//Tv1_8_1
+/DurationAssertionGui.java/1.6/Thu Oct 17 19:47:14 2002//Tv1_8_1
+/SizeAssertionGui.java/1.3/Sat Jan 11 23:14:44 2003//Tv1_8_1
 D
diff --git a/jakarta-jmeter/src/components/org/apache/jmeter/assertions/gui/CVS/Tag b/jakarta-jmeter/src/components/org/apache/jmeter/assertions/gui/CVS/Tag
index 5f312fe..e2fda28 100644
--- a/jakarta-jmeter/src/components/org/apache/jmeter/assertions/gui/CVS/Tag
+++ b/jakarta-jmeter/src/components/org/apache/jmeter/assertions/gui/CVS/Tag
@@ -1 +1 @@
-Nv1_7_3
+Nv1_8_1
diff --git a/jakarta-jmeter/src/components/org/apache/jmeter/assertions/gui/DurationAssertionGui.java b/jakarta-jmeter/src/components/org/apache/jmeter/assertions/gui/DurationAssertionGui.java
index 197cec6..3cd1669 100644
--- a/jakarta-jmeter/src/components/org/apache/jmeter/assertions/gui/DurationAssertionGui.java
+++ b/jakarta-jmeter/src/components/org/apache/jmeter/assertions/gui/DurationAssertionGui.java
@@ -55,42 +55,24 @@
 package org.apache.jmeter.assertions.gui;
 
 import java.awt.FlowLayout;
-import java.awt.BorderLayout;
-import java.awt.Color;
-import java.awt.Component;
 import java.awt.Font;
-import java.awt.GridBagConstraints;
-import java.awt.GridBagLayout;
-import java.awt.event.ActionEvent;
-import java.awt.event.ActionListener;
 import java.awt.event.FocusEvent;
 import java.awt.event.FocusListener;
-import java.util.Iterator;
 
 import javax.swing.BorderFactory;
-import javax.swing.Box;
-import javax.swing.ButtonGroup;
-import javax.swing.DefaultListCellRenderer;
-import javax.swing.JButton;
-import javax.swing.JCheckBox;
 import javax.swing.JLabel;
-import javax.swing.JList;
+import javax.swing.JOptionPane;
 import javax.swing.JPanel;
-import javax.swing.JRadioButton;
-import javax.swing.JScrollPane;
 import javax.swing.JTextField;
-import javax.swing.JTable;
 import javax.swing.border.Border;
 import javax.swing.border.EmptyBorder;
-import javax.swing.table.TableCellRenderer;
+
 import org.apache.jmeter.assertions.DurationAssertion;
-import org.apache.jmeter.assertions.ResponseAssertion;
-import org.apache.jmeter.gui.util.PowerTableModel;
-import org.apache.jmeter.gui.util.TextAreaCellRenderer;
-import org.apache.jmeter.gui.util.TextAreaTableCellEditor;
-import org.apache.jmeter.gui.util.VerticalLayout;
 import org.apache.jmeter.testelement.TestElement;
 import org.apache.jmeter.util.JMeterUtils;
+import org.apache.log.Hierarchy;
+import org.apache.log.Logger;
+import org.apache.jorphan.gui.layout.VerticalLayout;
 
 
 /****************************************
@@ -98,12 +80,14 @@ import org.apache.jmeter.util.JMeterUtils;
  * Apache
  *
  *@author    Michael Stover
- *@created   $Date: 2002/08/11 19:24:40 $
+ *@created   $Date: 2002/10/17 19:47:14 $
  *@version   1.0
  ***************************************/
 
 public class DurationAssertionGui extends AbstractAssertionGui implements FocusListener
 {
+	transient private static Logger log = Hierarchy.getDefaultHierarchy().getLoggerFor(
+			"jmeter.elements");
 
 	private JTextField duration;
 
@@ -139,7 +123,6 @@ public class DurationAssertionGui extends AbstractAssertionGui implements FocusL
 			assertionDuration = Long.parseLong(durationString);
 		}
 		catch (NumberFormatException e) {
-			System.out.println("exception");
 			assertionDuration = Long.MAX_VALUE;
 		}
 		el.setAllowedDuration(assertionDuration);
@@ -185,6 +168,7 @@ public class DurationAssertionGui extends AbstractAssertionGui implements FocusL
 
 		durationPanel.add(new JLabel(JMeterUtils.getResString("duration_assertion_label")));
 		duration = new JTextField(5);
+		duration.addFocusListener(this);
 		durationPanel.add(duration);
 
 		mainPanel.add(durationPanel);
@@ -199,6 +183,23 @@ public class DurationAssertionGui extends AbstractAssertionGui implements FocusL
 	 ***************************************/
 	public void focusLost(FocusEvent e)
 	{
+		boolean isInvalid = false;
+		String durationString = duration.getText();
+		if (durationString != null) {
+			try {
+				long assertionDuration = Long.parseLong(durationString);
+				if (assertionDuration < 0) {
+					isInvalid = true;
+				}
+			}
+			catch (NumberFormatException ex) {
+				isInvalid = true;
+			}
+			if (isInvalid) {
+				log.warn("DurationAssertionGui: Not a valid number!");
+				JOptionPane.showMessageDialog(null, JMeterUtils.getResString("duration_assertion_input_error"), "Error", JOptionPane.ERROR_MESSAGE);
+			}
+		}
 	}
 
 	/****************************************
diff --git a/jakarta-jmeter/src/components/org/apache/jmeter/assertions/gui/SizeAssertionGui.java b/jakarta-jmeter/src/components/org/apache/jmeter/assertions/gui/SizeAssertionGui.java
new file mode 100644
index 0000000..df928de
--- /dev/null
+++ b/jakarta-jmeter/src/components/org/apache/jmeter/assertions/gui/SizeAssertionGui.java
@@ -0,0 +1,275 @@
+/*
+ * ====================================================================
+ * The Apache Software License, Version 1.1
+ *
+ * Copyright (c) 2001 The Apache Software Foundation.  All rights
+ * reserved.
+ *
+ * Redistribution and use in source and binary forms, with or without
+ * modification, are permitted provided that the following conditions
+ * are met:
+ *
+ * 1. Redistributions of source code must retain the above copyright
+ * notice, this list of conditions and the following disclaimer.
+ *
+ * 2. Redistributions in binary form must reproduce the above copyright
+ * notice, this list of conditions and the following disclaimer in
+ * the documentation and/or other materials provided with the
+ * distribution.
+ *
+ * 3. The end-user documentation included with the redistribution,
+ * if any, must include the following acknowledgment:
+ * "This product includes software developed by the
+ * Apache Software Foundation (http://www.apache.org/)."
+ * Alternately, this acknowledgment may appear in the software itself,
+ * if and wherever such third-party acknowledgments normally appear.
+ *
+ * 4. The names "Apache" and "Apache Software Foundation" and
+ * "Apache JMeter" must not be used to endorse or promote products
+ * derived from this software without prior written permission. For
+ * written permission, please contact apache@apache.org.
+ *
+ * 5. Products derived from this software may not be called "Apache",
+ * "Apache JMeter", nor may "Apache" appear in their name, without
+ * prior written permission of the Apache Software Foundation.
+ *
+ * THIS SOFTWARE IS PROVIDED ``AS IS'' AND ANY EXPRESSED OR IMPLIED
+ * WARRANTIES, INCLUDING, BUT NOT LIMITED TO, THE IMPLIED WARRANTIES
+ * OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE ARE
+ * DISCLAIMED.  IN NO EVENT SHALL THE APACHE SOFTWARE FOUNDATION OR
+ * ITS CONTRIBUTORS BE LIABLE FOR ANY DIRECT, INDIRECT, INCIDENTAL,
+ * SPECIAL, EXEMPLARY, OR CONSEQUENTIAL DAMAGES (INCLUDING, BUT NOT
+ * LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES; LOSS OF
+ * USE, DATA, OR PROFITS; OR BUSINESS INTERRUPTION) HOWEVER CAUSED AND
+ * ON ANY THEORY OF LIABILITY, WHETHER IN CONTRACT, STRICT LIABILITY,
+ * OR TORT (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT
+ * OF THE USE OF THIS SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF
+ * SUCH DAMAGE.
+ * ====================================================================
+ *
+ * This software consists of voluntary contributions made by many
+ * individuals on behalf of the Apache Software Foundation.  For more
+ * information on the Apache Software Foundation, please see
+ * <http://www.apache.org/>.
+ */
+package org.apache.jmeter.assertions.gui;
+
+import java.awt.FlowLayout;
+import java.awt.GridLayout;
+import java.awt.Font;
+import java.awt.event.FocusEvent;
+import java.awt.event.FocusListener;
+import java.awt.event.ActionEvent;
+import java.awt.event.ActionListener;
+
+import javax.swing.BorderFactory;
+import javax.swing.JLabel;
+import javax.swing.JOptionPane;
+import javax.swing.JPanel;
+import javax.swing.JTextField;
+import javax.swing.border.Border;
+import javax.swing.border.EmptyBorder;
+import javax.swing.ButtonGroup;
+import javax.swing.JRadioButton;
+
+import org.apache.jmeter.assertions.SizeAssertion;
+import org.apache.jmeter.testelement.TestElement;
+import org.apache.jmeter.util.JMeterUtils;
+import org.apache.log.Hierarchy;
+import org.apache.log.Logger;
+import org.apache.jorphan.gui.layout.VerticalLayout;
+
+
+/****************************************
+ * Title: Jakarta-JMeter Description: Copyright: Copyright (c) 2001 Company:
+ * Apache
+ *
+ *@author    Michael Stover
+ *@created   $Date: 2003/01/11 23:14:44 $
+ *@version   1.0
+ ***************************************/
+
+public class SizeAssertionGui extends AbstractAssertionGui implements FocusListener, ActionListener
+{
+	transient private static Logger log = Hierarchy.getDefaultHierarchy().getLoggerFor(
+			"jmeter.elements");
+
+	private JTextField size;
+	SizeAssertion sa = new SizeAssertion();
+
+	/****************************************
+	 * !ToDo (Constructor description)
+	 ***************************************/
+	public SizeAssertionGui()
+	{
+		init();
+	}
+
+	/**
+	 * Returns the label to be shown within the JTree-Component.
+	 */
+	public String getStaticLabel()
+	{
+		return JMeterUtils.getResString("size_assertion_title");
+	}
+
+	public String getSizeAttributesTitle()
+	{
+		return JMeterUtils.getResString("size_assertion_size_test");
+	}
+
+	public TestElement createTestElement()
+	{
+		//ResponseAssertion el = new ResponseAssertion();
+		SizeAssertion el = new SizeAssertion();
+		configureTestElement(el);
+		String sizeString = size.getText();
+		long assertionSize = 0;
+		try {
+			assertionSize = Long.parseLong(sizeString);
+		}
+		catch (NumberFormatException e) {
+			assertionSize = Long.MAX_VALUE;
+		}
+		el.setAllowedSize(assertionSize);
+		return el;
+	}
+
+	/****************************************
+	 * !ToDo (Method description)
+	 ***************************************/
+	public void configure(TestElement el)
+	{
+		super.configure(el);
+		SizeAssertion assertion = (SizeAssertion)el;
+		size.setText(String.valueOf(assertion.getAllowedSize()));
+	}
+
+	private void init()
+	{
+		this.setLayout(new VerticalLayout(5, VerticalLayout.LEFT, VerticalLayout.TOP));
+
+		// MAIN PANEL
+		JPanel mainPanel = new JPanel();
+		Border margin = new EmptyBorder(10, 10, 5, 10);
+		mainPanel.setBorder(margin);
+		mainPanel.setLayout(new VerticalLayout(5, VerticalLayout.LEFT));
+
+		// TITLE
+		JLabel panelTitleLabel = new JLabel(getStaticLabel());
+		Font curFont = panelTitleLabel.getFont();
+		int curFontSize = curFont.getSize();
+		curFontSize += 4;
+		panelTitleLabel.setFont(new Font(curFont.getFontName(), curFont.getStyle(), curFontSize));
+		mainPanel.add(panelTitleLabel);
+
+		// NAME
+		mainPanel.add(getNamePanel());
+
+		// USER_INPUT
+		JPanel sizePanel = new JPanel();
+		sizePanel.setBorder(BorderFactory.createTitledBorder(BorderFactory.createEtchedBorder(), getSizeAttributesTitle()));
+		FlowLayout layout = new FlowLayout();
+		sizePanel.setLayout(layout);
+
+		sizePanel.add(new JLabel(JMeterUtils.getResString("size_assertion_label")));
+		size = new JTextField(5);
+		size.addFocusListener(this);
+		sizePanel.add(size);
+		
+		ButtonGroup comparatorButtonGroup = new ButtonGroup();
+		
+		JRadioButton equalButton = new JRadioButton("=");
+		equalButton.setSelected(true);
+		equalButton.setActionCommand(new Integer(SizeAssertion.EQUAL).toString());
+		equalButton.addActionListener(this);
+		comparatorButtonGroup.add(equalButton);
+				
+		JRadioButton notequalButton = new JRadioButton("!=");
+		notequalButton.setActionCommand(new Integer(SizeAssertion.NOTEQUAL).toString());
+		notequalButton.addActionListener(this);
+		comparatorButtonGroup.add(notequalButton);
+		
+		JRadioButton greaterthanButton = new JRadioButton(">");
+		greaterthanButton.setActionCommand(new Integer(SizeAssertion.GREATERTHAN).toString());
+		greaterthanButton.addActionListener(this);
+		comparatorButtonGroup.add(greaterthanButton);
+		
+		JRadioButton lessthanButton = new JRadioButton("<");
+		lessthanButton.setActionCommand(new Integer(SizeAssertion.LESSTHAN).toString());
+		lessthanButton.addActionListener(this);
+		comparatorButtonGroup.add(lessthanButton);
+		
+		JRadioButton greaterthanequalButton = new JRadioButton(">=");
+		greaterthanequalButton.setActionCommand(new Integer(SizeAssertion.GREATERTHANEQUAL).toString());
+		greaterthanequalButton.addActionListener(this);
+		comparatorButtonGroup.add(greaterthanequalButton);
+		
+		JRadioButton lessthanequalButton = new JRadioButton("<=");
+		lessthanequalButton.setActionCommand(new Integer(SizeAssertion.LESSTHANEQUAL).toString());
+		lessthanequalButton.addActionListener(this);
+		comparatorButtonGroup.add(lessthanequalButton);
+		
+		//Put the check boxes in a column in a panel
+        JPanel checkPanel = new JPanel();
+        checkPanel.setLayout(new GridLayout(0, 1));
+        JLabel compareLabel = new JLabel(JMeterUtils.getResString("size_assertion_comparator_label"));
+        checkPanel.add(compareLabel);
+        checkPanel.add(equalButton);
+        checkPanel.add(notequalButton);
+        checkPanel.add(greaterthanButton);
+        checkPanel.add(lessthanButton);
+        checkPanel.add(greaterthanequalButton);
+        checkPanel.add(lessthanequalButton);
+        sizePanel.add(checkPanel);
+		
+		mainPanel.add(sizePanel);
+		this.add(mainPanel);
+
+	}
+
+	/****************************************
+	 * Description of the Method
+	 *
+	 *@param e  Description of Parameter
+	 ***************************************/
+	public void focusLost(FocusEvent e)
+	{
+		boolean isInvalid = false;
+		String sizeString = size.getText();
+		if (sizeString != null) {
+			try {
+				long assertionSize = Long.parseLong(sizeString);
+				if (assertionSize < 0) {
+					isInvalid = true;
+				}
+			}
+			catch (NumberFormatException ex) {
+				isInvalid = true;
+			}
+			if (isInvalid) {
+				log.warn("SizeAssertionGui: Not a valid number!");
+				JOptionPane.showMessageDialog(null, JMeterUtils.getResString("size_assertion_input_error"), "Error", JOptionPane.ERROR_MESSAGE);
+			}
+		}
+	}
+
+	/****************************************
+	 * Description of the Method
+	 *
+	 *@param e  Description of Parameter
+	 ***************************************/
+	public void focusGained(FocusEvent e) {
+	}
+	
+	/****************************************
+	 * Description of the Method
+	 *
+	 *@param e ActionEvent
+	 ***************************************/
+	public void actionPerformed(ActionEvent e) {
+		int comparator = new Integer(e.getActionCommand()).intValue(); 
+    	sa.setLogicalComparator(comparator);
+    }
+    
+}
diff --git a/jakarta-jmeter/src/components/org/apache/jmeter/config/CVS/Entries b/jakarta-jmeter/src/components/org/apache/jmeter/config/CVS/Entries
deleted file mode 100644
index 4060522..0000000
--- a/jakarta-jmeter/src/components/org/apache/jmeter/config/CVS/Entries
+++ /dev/null
@@ -1,4 +0,0 @@
-/Argument.java/1.3/Wed Aug 14 19:13:05 2002//Tv1_7_3
-/Arguments.java/1.1/Sun Aug 11 19:24:40 2002//Tv1_7_3
-/LoginConfig.java/1.1/Sun Aug 11 19:24:40 2002//Tv1_7_3
-D/gui////
diff --git a/jakarta-jmeter/src/components/org/apache/jmeter/config/CVS/Repository b/jakarta-jmeter/src/components/org/apache/jmeter/config/CVS/Repository
deleted file mode 100644
index 9fa0ab5..0000000
--- a/jakarta-jmeter/src/components/org/apache/jmeter/config/CVS/Repository
+++ /dev/null
@@ -1 +0,0 @@
-jakarta-jmeter/src/components/org/apache/jmeter/config
diff --git a/jakarta-jmeter/src/components/org/apache/jmeter/config/CVS/Tag b/jakarta-jmeter/src/components/org/apache/jmeter/config/CVS/Tag
deleted file mode 100644
index 5f312fe..0000000
--- a/jakarta-jmeter/src/components/org/apache/jmeter/config/CVS/Tag
+++ /dev/null
@@ -1 +0,0 @@
-Nv1_7_3
diff --git a/jakarta-jmeter/src/components/org/apache/jmeter/config/gui/CVS/Entries b/jakarta-jmeter/src/components/org/apache/jmeter/config/gui/CVS/Entries
deleted file mode 100644
index 678e52f..0000000
--- a/jakarta-jmeter/src/components/org/apache/jmeter/config/gui/CVS/Entries
+++ /dev/null
@@ -1,3 +0,0 @@
-/ArgumentsPanel.java/1.5/Fri Aug 16 13:05:35 2002//Tv1_7_3
-/LoginConfigGui.java/1.1/Sun Aug 11 19:24:40 2002//Tv1_7_3
-D
diff --git a/jakarta-jmeter/src/components/org/apache/jmeter/config/gui/CVS/Repository b/jakarta-jmeter/src/components/org/apache/jmeter/config/gui/CVS/Repository
deleted file mode 100644
index 8ff274b..0000000
--- a/jakarta-jmeter/src/components/org/apache/jmeter/config/gui/CVS/Repository
+++ /dev/null
@@ -1 +0,0 @@
-jakarta-jmeter/src/components/org/apache/jmeter/config/gui
diff --git a/jakarta-jmeter/src/components/org/apache/jmeter/config/gui/CVS/Tag b/jakarta-jmeter/src/components/org/apache/jmeter/config/gui/CVS/Tag
deleted file mode 100644
index 5f312fe..0000000
--- a/jakarta-jmeter/src/components/org/apache/jmeter/config/gui/CVS/Tag
+++ /dev/null
@@ -1 +0,0 @@
-Nv1_7_3
diff --git a/jakarta-jmeter/src/components/org/apache/jmeter/control/CVS/Entries b/jakarta-jmeter/src/components/org/apache/jmeter/control/CVS/Entries
index 21dfa46..becb5eb 100644
--- a/jakarta-jmeter/src/components/org/apache/jmeter/control/CVS/Entries
+++ b/jakarta-jmeter/src/components/org/apache/jmeter/control/CVS/Entries
@@ -1,7 +1,5 @@
-/GenericController.java/1.1/Sun Aug 11 19:24:40 2002//Tv1_7_3
-/InterleaveControl.java/1.1/Sun Aug 11 19:24:40 2002//Tv1_7_3
-/LoopController.java/1.1/Sun Aug 11 19:24:40 2002//Tv1_7_3
-/ModifyController.java/1.1/Sun Aug 11 19:24:40 2002//Tv1_7_3
-/OnceOnlyController.java/1.1/Sun Aug 11 19:24:40 2002//Tv1_7_3
-/RandomController.java/1.1/Sun Aug 11 19:24:40 2002//Tv1_7_3
+/InterleaveControl.java/1.5/Tue Jan 28 21:21:19 2003//Tv1_8_1
+/ModifyController.java/1.2/Tue Oct 15 18:53:24 2002//Tv1_8_1
+/OnceOnlyController.java/1.2/Sun Dec 29 14:20:55 2002//Tv1_8_1
+/RandomController.java/1.3/Tue Jan 28 21:21:19 2003//Tv1_8_1
 D/gui////
diff --git a/jakarta-jmeter/src/components/org/apache/jmeter/control/CVS/Tag b/jakarta-jmeter/src/components/org/apache/jmeter/control/CVS/Tag
index 5f312fe..e2fda28 100644
--- a/jakarta-jmeter/src/components/org/apache/jmeter/control/CVS/Tag
+++ b/jakarta-jmeter/src/components/org/apache/jmeter/control/CVS/Tag
@@ -1 +1 @@
-Nv1_7_3
+Nv1_8_1
diff --git a/jakarta-jmeter/src/components/org/apache/jmeter/control/InterleaveControl.java b/jakarta-jmeter/src/components/org/apache/jmeter/control/InterleaveControl.java
index 45afc53..50ccbf6 100644
--- a/jakarta-jmeter/src/components/org/apache/jmeter/control/InterleaveControl.java
+++ b/jakarta-jmeter/src/components/org/apache/jmeter/control/InterleaveControl.java
@@ -70,13 +70,18 @@ import org.apache.jmeter.util.JMeterUtils;
 public class InterleaveControl extends GenericController implements Serializable
 {
 
+	private static final String STYLE = "InterleaveControl.style";
+	public static final int DEFAULT_STYLE = 0;
+	public static final int NEW_STYLE = 1;
 	private boolean interleave;
+	private boolean doNotIncrement = false;
 
 	/****************************************
 	 * Constructor for the InterleaveControl object
 	 ***************************************/
 	public InterleaveControl()
 	{
+		
 	}
 
 	public void initialize()
@@ -93,22 +98,107 @@ public class InterleaveControl extends GenericController implements Serializable
 
 	public boolean hasNext()
 	{
-		if(!interleave)
+		boolean retVal;
+		Object controller = getCurrentController();
+		if(controller == null)
 		{
-			return super.hasNext();
+			retVal = hasNextAtEnd();
+		}
+		else if(controller instanceof Controller)
+		{
+			if(((Controller)controller).hasNext())
+			{
+				retVal = true;
+			}
+			else
+			{
+				currentHasNextIsFalse();
+				retVal = hasNext();
+			}
 		}
 		else
+		{
+			retVal = true;
+		}
+		if(controller == null)
+		{
+			reInitialize();
+		}
+		if(interleave)
 		{
 			interleave = false;
-			super.hasNext();
 			return false;
 		}
+		return retVal;
+	}
+	
+	protected void removeCurrentController()
+	{
+		setInterleave(NEW_STYLE);
+		super.removeCurrentController();
+	}
+
+	protected void incrementCurrent()
+	{
+		setInterleave(NEW_STYLE);
+		super.incrementCurrent();
+	}
+
+	protected void setInterleave(int style)
+	{
+		if(getStyle() == style)
+		{
+			interleave = true;
+		}
+	}
+	
+	public void setStyle(int style)
+	{
+		setProperty(STYLE,new Integer(style));
+	}
+	
+	public int getStyle()
+	{
+		return getPropertyAsInt(STYLE);
 	}
 
 	public Sampler next()
 	{
-		interleave = true;
-		return super.next();
+		setInterleave(DEFAULT_STYLE);
+		TestElement controller = getCurrentController();
+		if(controller == null)
+		{
+			nextAtEnd();
+			return next();
+		}
+		if(controller instanceof Sampler)
+		{
+			incrementCurrent();
+			return (Sampler)controller;
+		}
+		else
+		{
+			Controller c = (Controller)controller;
+			if(c.hasNext())
+			{
+				Sampler s = c.next();
+				if(getStyle() == DEFAULT_STYLE)
+				{
+					incrementCurrent();
+				}
+				return s;
+			}
+			else if(c.isDone())
+			{
+				removeCurrentController();
+				return next();
+			}
+			else
+			{
+				incrementCurrent();
+				return next();
+			}
+		}
 	}
 
 	public static class Test extends junit.framework.TestCase
@@ -121,7 +211,8 @@ public class InterleaveControl extends GenericController implements Serializable
 		public void testProcessing() throws Exception
 		{
 			GenericController controller = new GenericController();
-			GenericController sub_1 = new InterleaveControl();
+			InterleaveControl sub_1 = new InterleaveControl();
+			sub_1.setStyle(DEFAULT_STYLE);
 			sub_1.addTestElement(makeSampler("one"));
 			sub_1.addTestElement(makeSampler("two"));
 			controller.addTestElement(sub_1);
@@ -158,13 +249,137 @@ public class InterleaveControl extends GenericController implements Serializable
 				}
 			}
 		}
+		
+		public void testProcessing2() throws Exception
+		{
+			GenericController controller = new GenericController();
+			InterleaveControl sub_1 = new InterleaveControl();
+			sub_1.setStyle(DEFAULT_STYLE);
+			sub_1.addTestElement(makeSampler("one"));
+			sub_1.addTestElement(makeSampler("two"));
+			controller.addTestElement(sub_1);
+			controller.addTestElement(makeSampler("three"));
+			LoopController sub_2 = new LoopController();
+			sub_2.setLoops(3);
+			GenericController sub_3 = new GenericController();
+			sub_2.addTestElement(makeSampler("four"));
+			sub_3.addTestElement(makeSampler("five"));
+			sub_3.addTestElement(makeSampler("six"));
+			sub_2.addTestElement(sub_3);
+			sub_2.addTestElement(makeSampler("seven"));
+			sub_1.addTestElement(sub_2);
+			String[] order = new String[]{"one","three","two","three","four","three",
+						"one","three","two","three","five","three","one","three",
+						"two","three","six","three","one","three"};
+			int counter = 0;
+			while (counter < order.length)
+			{
+				while(controller.hasNext())
+				{
+					TestElement sampler = controller.next();
+					assertEquals("failed on "+counter,
+							order[counter],sampler.getProperty(TestElement.NAME));
+					counter++;
+				}
+			}
+		}
+		
+		public void testProcessing3() throws Exception
+		{
+			GenericController controller = new GenericController();
+			InterleaveControl sub_1 = new InterleaveControl();
+			sub_1.setStyle(NEW_STYLE);
+			sub_1.addTestElement(makeSampler("one"));
+			sub_1.addTestElement(makeSampler("two"));
+			controller.addTestElement(sub_1);
+			controller.addTestElement(makeSampler("three"));
+			LoopController sub_2 = new LoopController();
+			sub_2.setLoops(3);
+			GenericController sub_3 = new GenericController();
+			sub_2.addTestElement(makeSampler("four"));
+			sub_3.addTestElement(makeSampler("five"));
+			sub_3.addTestElement(makeSampler("six"));
+			sub_2.addTestElement(sub_3);
+			sub_2.addTestElement(makeSampler("seven"));
+			sub_1.addTestElement(sub_2);
+			String[] order = new String[]{"one","three","two","three","four","five",
+						"six","seven","four","five","six","seven","four","five",
+						"six","seven","three","one","three","two","three"};
+			int counter = 0;
+			while (counter < order.length)
+			{
+				while(controller.hasNext())
+				{
+					TestElement sampler = controller.next();
+					assertEquals("failed on "+counter,order[counter],sampler.getProperty(TestElement.NAME));
+					counter++;
+				}
+			}
+		}
+		
+		public void testProcessing4() throws Exception
+		{
+			GenericController controller = new GenericController();
+			InterleaveControl sub_1 = new InterleaveControl();
+			sub_1.setStyle(DEFAULT_STYLE);
+			controller.addTestElement(sub_1);
+			GenericController sub_2 = new GenericController();
+			sub_2.addTestElement(makeSampler("one"));
+			sub_2.addTestElement(makeSampler("two"));
+			sub_1.addTestElement(sub_2);
+			GenericController sub_3 = new GenericController();
+			sub_3.addTestElement(makeSampler("three"));
+			sub_3.addTestElement(makeSampler("four"));
+			sub_1.addTestElement(sub_3);
+			String[] order = new String[]{"one","three","two","four"};
+			int counter = 0;
+			while (counter < order.length)
+			{
+				while(controller.hasNext())
+				{
+					TestElement sampler = controller.next();
+					assertEquals("failed on "+counter,order[counter],sampler.getProperty(TestElement.NAME));
+					counter++;
+				}
+			}
+		}
+		
+		public void testProcessing5() throws Exception
+		{
+			GenericController controller = new GenericController();
+			InterleaveControl sub_1 = new InterleaveControl();
+			sub_1.setStyle(NEW_STYLE);
+			controller.addTestElement(sub_1);
+			GenericController sub_2 = new GenericController();
+			sub_2.addTestElement(makeSampler("one"));
+			sub_2.addTestElement(makeSampler("two"));
+			sub_1.addTestElement(sub_2);
+			GenericController sub_3 = new GenericController();
+			sub_3.addTestElement(makeSampler("three"));
+			sub_3.addTestElement(makeSampler("four"));
+			sub_1.addTestElement(sub_3);
+			String[] order = new String[]{"one","two","three","four"};
+			int counter = 0;
+			while (counter < order.length)
+			{
+				while(controller.hasNext())
+				{
+					TestElement sampler = controller.next();
+					assertEquals("failed on "+counter,order[counter],sampler.getProperty(TestElement.NAME));
+					counter++;
+				}
+			}
+		}
 
 		private TestElement makeSampler(String name)
 		{
-			org.apache.jmeter.protocol.http.sampler.HTTPSampler s = new
-					org.apache.jmeter.protocol.http.sampler.HTTPSampler();
+		  	TestSampler s= new TestSampler();
 			s.setName(name);
 			return s;
 		}
+		public class TestSampler extends AbstractSampler {
+		  public void addCustomTestElement(TestElement t) { }
+		  public org.apache.jmeter.samplers.SampleResult sample(org.apache.jmeter.samplers.Entry e) { return null; }
+		}
 	}
 }
diff --git a/jakarta-jmeter/src/components/org/apache/jmeter/control/ModifyController.java b/jakarta-jmeter/src/components/org/apache/jmeter/control/ModifyController.java
index 8adf8a6..b6375af 100644
--- a/jakarta-jmeter/src/components/org/apache/jmeter/control/ModifyController.java
+++ b/jakarta-jmeter/src/components/org/apache/jmeter/control/ModifyController.java
@@ -61,7 +61,6 @@ import org.apache.jmeter.config.ResponseBasedModifier;
 import org.apache.jmeter.gui.JMeterComponentModel;
 import org.apache.jmeter.gui.util.MenuFactory;
 import org.apache.jmeter.samplers.*;
-import org.apache.jmeter.util.ClassFinder;
 import org.apache.jmeter.util.JMeterUtils;
 import org.apache.jmeter.testelement.TestElement;
 
@@ -69,8 +68,8 @@ import org.apache.jmeter.testelement.TestElement;
  * !ToDo (Class description)
  *
  *@author    $Author: mstover1 $
- *@created   $Date: 2002/08/11 19:24:40 $
- *@version   $Revision: 1.1 $
+ *@created   $Date: 2002/10/15 18:53:24 $
+ *@version   $Revision: 1.2 $
  ***************************************/
 
 public class ModifyController extends GenericController implements SampleListener,
diff --git a/jakarta-jmeter/src/components/org/apache/jmeter/control/OnceOnlyController.java b/jakarta-jmeter/src/components/org/apache/jmeter/control/OnceOnlyController.java
index 5c3937a..b132302 100644
--- a/jakarta-jmeter/src/components/org/apache/jmeter/control/OnceOnlyController.java
+++ b/jakarta-jmeter/src/components/org/apache/jmeter/control/OnceOnlyController.java
@@ -146,10 +146,13 @@ public class OnceOnlyController extends GenericController implements Serializabl
 
 		private TestElement makeSampler(String name)
 		{
-			org.apache.jmeter.protocol.http.sampler.HTTPSampler s = new
-					org.apache.jmeter.protocol.http.sampler.HTTPSampler();
+		  	TestSampler s= new TestSampler();
 			s.setName(name);
 			return s;
 		}
+		public class TestSampler extends AbstractSampler {
+		  public void addCustomTestElement(TestElement t) { }
+		  public org.apache.jmeter.samplers.SampleResult sample(org.apache.jmeter.samplers.Entry e) { return null; }
+		}
 	}
 }
diff --git a/jakarta-jmeter/src/components/org/apache/jmeter/control/RandomController.java b/jakarta-jmeter/src/components/org/apache/jmeter/control/RandomController.java
index e7c8732..c9b00ab 100644
--- a/jakarta-jmeter/src/components/org/apache/jmeter/control/RandomController.java
+++ b/jakarta-jmeter/src/components/org/apache/jmeter/control/RandomController.java
@@ -58,6 +58,9 @@
 import java.io.Serializable;
 import java.util.Random;
 
+import org.apache.jmeter.testelement.ThreadListener;
+import org.apache.jmeter.threads.JMeterVariables;
+
 /**
  * @author Administrator
  *
@@ -66,22 +69,49 @@ import java.util.Random;
  */
 public class RandomController
 	extends InterleaveControl
-	implements Serializable 
+	implements Serializable,ThreadListener
 {
-	Random rand;
+	static Random rand = new Random();
 	
 	public RandomController()
 	{
-		rand = new Random();
+		
 	}
 	
 	protected void resetCurrent()
 	{
-		current = rand.nextInt(this.getSubControllers().size());
+		if(getSubControllers().size() > 0)
+		{
+			current = rand.nextInt(this.getSubControllers().size());
+		}
+		else
+		{
+			current = 0;
+		}
 	}
 	
 	protected void incrementCurrent()
 	{
+		setInterleave(NEW_STYLE);
 		current = rand.nextInt(this.getSubControllers().size());
 	}
+
+
+	/**
+	 * @see org.apache.jmeter.testelement.ThreadListener#iterationStarted(int)
+	 */
+	public void iterationStarted(int iterationCount)
+	{
+		if(iterationCount == 1)
+		{
+			resetCurrent();
+		}
+	}
+
+	/**
+	 * @see org.apache.jmeter.testelement.ThreadListener#setJMeterVariables(org.apache.jmeter.threads.JMeterVariables)
+	 */
+	public void setJMeterVariables(JMeterVariables jmVars)
+	{}
+
 }
diff --git a/jakarta-jmeter/src/components/org/apache/jmeter/control/gui/CVS/Entries b/jakarta-jmeter/src/components/org/apache/jmeter/control/gui/CVS/Entries
index 04deae8..459e899 100644
--- a/jakarta-jmeter/src/components/org/apache/jmeter/control/gui/CVS/Entries
+++ b/jakarta-jmeter/src/components/org/apache/jmeter/control/gui/CVS/Entries
@@ -1,7 +1,5 @@
-/InterleaveControlGui.java/1.1/Sun Aug 11 19:24:40 2002//Tv1_7_3
-/LogicControllerGui.java/1.1/Sun Aug 11 19:24:40 2002//Tv1_7_3
-/LoopControlPanel.java/1.1/Sun Aug 11 19:24:40 2002//Tv1_7_3
-/ModifyControllerGui.java/1.1/Sun Aug 11 19:24:40 2002//Tv1_7_3
-/OnceOnlyControllerGui.java/1.1/Sun Aug 11 19:24:40 2002//Tv1_7_3
-/RandomControlGui.java/1.1/Sun Aug 11 19:24:40 2002//Tv1_7_3
+/InterleaveControlGui.java/1.4/Thu Oct 17 19:47:14 2002//Tv1_8_1
+/ModifyControllerGui.java/1.3/Thu Oct 17 19:47:14 2002//Tv1_8_1
+/OnceOnlyControllerGui.java/1.3/Thu Oct 17 19:47:14 2002//Tv1_8_1
+/RandomControlGui.java/1.4/Thu Oct 17 19:47:14 2002//Tv1_8_1
 D
diff --git a/jakarta-jmeter/src/components/org/apache/jmeter/control/gui/CVS/Tag b/jakarta-jmeter/src/components/org/apache/jmeter/control/gui/CVS/Tag
index 5f312fe..e2fda28 100644
--- a/jakarta-jmeter/src/components/org/apache/jmeter/control/gui/CVS/Tag
+++ b/jakarta-jmeter/src/components/org/apache/jmeter/control/gui/CVS/Tag
@@ -1 +1 @@
-Nv1_7_3
+Nv1_8_1
diff --git a/jakarta-jmeter/src/components/org/apache/jmeter/control/gui/InterleaveControlGui.java b/jakarta-jmeter/src/components/org/apache/jmeter/control/gui/InterleaveControlGui.java
index 299c3c5..25f9193 100644
--- a/jakarta-jmeter/src/components/org/apache/jmeter/control/gui/InterleaveControlGui.java
+++ b/jakarta-jmeter/src/components/org/apache/jmeter/control/gui/InterleaveControlGui.java
@@ -53,29 +53,32 @@
  * <http://www.apache.org/>.
  */
 package org.apache.jmeter.control.gui;
-import java.awt.*;
-import java.awt.event.*;
-import javax.swing.*;
-import javax.swing.border.*;
-import javax.swing.table.*;
-import javax.swing.text.*;
+import java.awt.Font;
+
+import javax.swing.JCheckBox;
+import javax.swing.JLabel;
+import javax.swing.JPanel;
+import javax.swing.border.Border;
+import javax.swing.border.EmptyBorder;
+
 import org.apache.jmeter.control.InterleaveControl;
-import org.apache.jmeter.gui.*;
-import org.apache.jmeter.gui.util.VerticalLayout;
+import org.apache.jmeter.gui.NamePanel;
 import org.apache.jmeter.testelement.TestElement;
 import org.apache.jmeter.util.JMeterUtils;
+import org.apache.jorphan.gui.layout.VerticalLayout;
 
 /****************************************
  * Title: JMeter Description: Copyright: Copyright (c) 2000 Company: Apache
  *
  *@author    Kevin Hammond
- *@created   $Date: 2002/08/11 19:24:40 $
+ *@created   $Date: 2002/10/17 19:47:14 $
  *@version   1.0
  ***************************************/
 
 public class InterleaveControlGui extends AbstractControllerGui
 {
 	InterleaveControl model;
+	JCheckBox style;
 
 	/****************************************
 	 * !ToDo (Constructor description)
@@ -105,6 +108,19 @@ public class InterleaveControlGui extends AbstractControllerGui
 	{
 		return namePanel.getName();
 	}
+	
+	public void configure(TestElement el)
+	{
+		super.configure(el);
+		if(((InterleaveControl)el).getStyle() == InterleaveControl.DEFAULT_STYLE)
+		{
+			style.setSelected(true);
+		}
+		else
+		{
+			style.setSelected(false);
+		}
+	}
 
 	/****************************************
 	 * !ToDo (Method description)
@@ -115,6 +131,14 @@ public class InterleaveControlGui extends AbstractControllerGui
 	{
 		InterleaveControl ic = new InterleaveControl();
 		configureTestElement(ic);
+		if(style.isSelected())
+		{
+			ic.setStyle(ic.DEFAULT_STYLE);
+		}
+		else
+		{
+			ic.setStyle(ic.NEW_STYLE);
+		}
 		return ic;
 	}
 
@@ -151,5 +175,7 @@ public class InterleaveControlGui extends AbstractControllerGui
 		mainPanel.add(namePanel);
 
 		this.add(mainPanel);
+		style = new JCheckBox(JMeterUtils.getResString("ignore_subcontrollers"));
+		this.add(style);
 	}
 }
diff --git a/jakarta-jmeter/src/components/org/apache/jmeter/control/gui/ModifyControllerGui.java b/jakarta-jmeter/src/components/org/apache/jmeter/control/gui/ModifyControllerGui.java
index e3c1cfe..4b9316e 100644
--- a/jakarta-jmeter/src/components/org/apache/jmeter/control/gui/ModifyControllerGui.java
+++ b/jakarta-jmeter/src/components/org/apache/jmeter/control/gui/ModifyControllerGui.java
@@ -62,18 +62,19 @@ import javax.swing.JPanel;
 import javax.swing.JPopupMenu;
 import javax.swing.border.Border;
 import javax.swing.border.EmptyBorder;
+
 import org.apache.jmeter.control.ModifyController;
 import org.apache.jmeter.gui.NamePanel;
 import org.apache.jmeter.gui.util.MenuFactory;
-import org.apache.jmeter.gui.util.VerticalLayout;
 import org.apache.jmeter.testelement.TestElement;
 import org.apache.jmeter.util.JMeterUtils;
+import org.apache.jorphan.gui.layout.VerticalLayout;
 
 /****************************************
  * Title: JMeter Description: Copyright: Copyright (c) 2000 Company: Apache
  *
  *@author    Kevin Hammond
- *@created   $Date: 2002/08/11 19:24:40 $
+ *@created   $Date: 2002/10/17 19:47:14 $
  *@version   1.0
  ***************************************/
 
diff --git a/jakarta-jmeter/src/components/org/apache/jmeter/control/gui/OnceOnlyControllerGui.java b/jakarta-jmeter/src/components/org/apache/jmeter/control/gui/OnceOnlyControllerGui.java
index a67b774..dd30a39 100644
--- a/jakarta-jmeter/src/components/org/apache/jmeter/control/gui/OnceOnlyControllerGui.java
+++ b/jakarta-jmeter/src/components/org/apache/jmeter/control/gui/OnceOnlyControllerGui.java
@@ -53,23 +53,24 @@
  * <http://www.apache.org/>.
  */
 package org.apache.jmeter.control.gui;
-import java.awt.*;
-import java.awt.event.*;
-import javax.swing.*;
-import javax.swing.border.*;
-import javax.swing.table.*;
-import javax.swing.text.*;
+import java.awt.Font;
+
+import javax.swing.JLabel;
+import javax.swing.JPanel;
+import javax.swing.border.Border;
+import javax.swing.border.EmptyBorder;
+
 import org.apache.jmeter.control.OnceOnlyController;
-import org.apache.jmeter.gui.*;
-import org.apache.jmeter.gui.util.VerticalLayout;
+import org.apache.jmeter.gui.NamePanel;
 import org.apache.jmeter.testelement.TestElement;
 import org.apache.jmeter.util.JMeterUtils;
+import org.apache.jorphan.gui.layout.VerticalLayout;
 
 /****************************************
  * Title: JMeter Description: Copyright: Copyright (c) 2000 Company: Apache
  *
  *@author    Kevin Hammond
- *@created   $Date: 2002/08/11 19:24:40 $
+ *@created   $Date: 2002/10/17 19:47:14 $
  *@version   1.0
  ***************************************/
 
diff --git a/jakarta-jmeter/src/components/org/apache/jmeter/control/gui/RandomControlGui.java b/jakarta-jmeter/src/components/org/apache/jmeter/control/gui/RandomControlGui.java
index 62cff7e..81d0ddf 100644
--- a/jakarta-jmeter/src/components/org/apache/jmeter/control/gui/RandomControlGui.java
+++ b/jakarta-jmeter/src/components/org/apache/jmeter/control/gui/RandomControlGui.java
@@ -55,27 +55,30 @@
 package org.apache.jmeter.control.gui;
 import java.awt.Font;
 
+import javax.swing.JCheckBox;
 import javax.swing.JLabel;
 import javax.swing.JPanel;
 import javax.swing.border.Border;
 import javax.swing.border.EmptyBorder;
+
+import org.apache.jmeter.control.InterleaveControl;
 import org.apache.jmeter.control.RandomController;
-import org.apache.jmeter.gui.NamePanel;
-import org.apache.jmeter.gui.util.VerticalLayout;
 import org.apache.jmeter.testelement.TestElement;
 import org.apache.jmeter.util.JMeterUtils;
+import org.apache.jorphan.gui.layout.VerticalLayout;
 
 /****************************************
  * Title: JMeter Description: Copyright: Copyright (c) 2000 Company: Apache
  *
  *@author    Kevin Hammond
- *@created   $Date: 2002/08/11 19:24:40 $
+ *@created   $Date: 2002/10/17 19:47:14 $
  *@version   1.0
  ***************************************/
 
 public class RandomControlGui extends AbstractControllerGui
 {
 
+	JCheckBox style;
 	/****************************************
 	 * !ToDo (Constructor description)
 	 ***************************************/
@@ -93,8 +96,29 @@ public class RandomControlGui extends AbstractControllerGui
 	{
 		RandomController ic = new RandomController();
 		configureTestElement(ic);
+		if(style.isSelected())
+		{
+			ic.setStyle(ic.DEFAULT_STYLE);
+		}
+		else
+		{
+			ic.setStyle(ic.NEW_STYLE);
+		}
 		return ic;
 	}
+	
+	public void configure(TestElement el)
+	{
+		super.configure(el);
+		if(((RandomController)el).getStyle() == InterleaveControl.DEFAULT_STYLE)
+		{
+			style.setSelected(true);
+		}
+		else
+		{
+			style.setSelected(false);
+		}
+	}
 
 	/****************************************
 	 * !ToDoo (Method description)
@@ -128,5 +152,7 @@ public class RandomControlGui extends AbstractControllerGui
 		mainPanel.add(getNamePanel());
 
 		this.add(mainPanel);
+		style = new JCheckBox(JMeterUtils.getResString("ignore_subcontrollers"));
+		this.add(style);
 	}
 }
diff --git a/jakarta-jmeter/src/components/org/apache/jmeter/modifiers/CVS/Entries b/jakarta-jmeter/src/components/org/apache/jmeter/modifiers/CVS/Entries
new file mode 100644
index 0000000..65378e7
--- /dev/null
+++ b/jakarta-jmeter/src/components/org/apache/jmeter/modifiers/CVS/Entries
@@ -0,0 +1,3 @@
+/CounterConfig.java/1.3/Fri Dec 13 18:20:01 2002//Tv1_8_1
+/UserParameters.java/1.2/Thu Aug 29 18:17:37 2002//Tv1_8_1
+D/gui////
diff --git a/jakarta-jmeter/src/components/org/apache/jmeter/modifiers/CVS/Repository b/jakarta-jmeter/src/components/org/apache/jmeter/modifiers/CVS/Repository
new file mode 100644
index 0000000..9fe4f5c
--- /dev/null
+++ b/jakarta-jmeter/src/components/org/apache/jmeter/modifiers/CVS/Repository
@@ -0,0 +1 @@
+jakarta-jmeter/src/components/org/apache/jmeter/modifiers
diff --git a/jakarta-jmeter/src/components/org/apache/jmeter/config/CVS/Root b/jakarta-jmeter/src/components/org/apache/jmeter/modifiers/CVS/Root
similarity index 100%
rename from jakarta-jmeter/src/components/org/apache/jmeter/config/CVS/Root
rename to jakarta-jmeter/src/components/org/apache/jmeter/modifiers/CVS/Root
diff --git a/jakarta-jmeter/src/components/org/apache/jmeter/modifiers/CVS/Tag b/jakarta-jmeter/src/components/org/apache/jmeter/modifiers/CVS/Tag
new file mode 100644
index 0000000..e2fda28
--- /dev/null
+++ b/jakarta-jmeter/src/components/org/apache/jmeter/modifiers/CVS/Tag
@@ -0,0 +1 @@
+Nv1_8_1
diff --git a/jakarta-jmeter/src/components/org/apache/jmeter/modifiers/CounterConfig.java b/jakarta-jmeter/src/components/org/apache/jmeter/modifiers/CounterConfig.java
new file mode 100644
index 0000000..d28d879
--- /dev/null
+++ b/jakarta-jmeter/src/components/org/apache/jmeter/modifiers/CounterConfig.java
@@ -0,0 +1,155 @@
+package org.apache.jmeter.modifiers;
+import java.io.Serializable;
+
+import org.apache.jmeter.config.ConfigTestElement;
+import org.apache.jmeter.testelement.ThreadListener;
+import org.apache.jmeter.testelement.VariablesCollection;
+import org.apache.jmeter.threads.JMeterVariables;
+import org.apache.jmeter.util.JMeterUtils;
+import org.apache.jorphan.logging.LoggingManager;
+import org.apache.log.Logger;
+/**
+ * @author Administrator
+ *
+ * To change this generated comment edit the template variable "typecomment":
+ * Window>Preferences>Java>Templates.
+ */
+public class CounterConfig
+	extends ConfigTestElement
+	implements Serializable, ThreadListener
+{
+	private static Logger log = LoggingManager.getLoggerFor(JMeterUtils.ELEMENTS);
+	private final static String START = "CounterConfig.start";
+	private final static String END = "CounterConfig.end";
+	private final static String INCREMENT = "CounterConfig.incr";
+	private final static String PER_USER = "CounterConfig.per_user";
+	private final static String VAR_NAME = "CounterConfig.name";
+	
+	private boolean perUser = false;
+	private int globalCounter = -1;
+	private int increment = 1;
+	private int start = 0;
+	private int end = Integer.MAX_VALUE;
+	private VariablesCollection vars = new VariablesCollection();
+	private int currentIterationCount = -1;
+	/**
+	 * @see org.apache.jmeter.testelement.ThreadListener#iterationStarted(int)
+	 */
+	public synchronized void iterationStarted(int iterationCount)
+	{
+		JMeterVariables variables = vars.getVariables();
+		if(!perUser)
+		{
+			globalCounter++;
+			int value = start + (increment * globalCounter);
+			if(value > end)
+			{
+				globalCounter = 0;
+				value = start;
+			}
+			variables.put(getVarName(),Integer.toString(value));
+		}
+		else
+		{		
+			String value = variables.get(getVarName());
+			if(value == null)
+			{
+				variables.put(getVarName(),Integer.toString(start));
+			}
+			else
+			{
+				try
+				{
+					int current = Integer.parseInt(value);
+					current += increment;
+					if(current > end)
+					{
+						current = start;
+					}
+					variables.put(getVarName(),Integer.toString(current));
+				}
+				catch(NumberFormatException e)
+				{
+					log.info("Bad number in Counter config",e);
+				}		
+			}	
+		}			
+	}
+	
+	/**
+	 * @see org.apache.jmeter.testelement.ThreadListener#setJMeterVariables(JMeterVariables)
+	 */
+	public void setJMeterVariables(JMeterVariables jmVars)
+	{
+		vars.addJMeterVariables(jmVars);
+		start = getStart();
+		end = getEnd();
+		increment = getIncrement();
+		perUser = isPerUser();
+	}
+	
+	public void setStart(int start)
+	{
+		setProperty(START,new Integer(start));
+	}
+	
+	public void setStart(String start)
+	{
+		setProperty(START,start);
+	}
+	
+	public int getStart()
+	{
+		return getPropertyAsInt(START);
+	}
+	
+	public void setEnd(int end)
+	{
+		setProperty(END,new Integer(end));
+	}
+	
+	public void setEnd(String end)
+	{
+		setProperty(END,end);
+	}
+	
+	public int getEnd()
+	{
+		return getPropertyAsInt(END);
+	}
+	
+	public void setIncrement(int inc)
+	{
+		setProperty(INCREMENT,new Integer(inc));
+	}
+	
+	public void setIncrement(String incr)
+	{
+		setProperty(INCREMENT,incr);
+	}
+	
+	public int getIncrement()
+	{
+		return getPropertyAsInt(INCREMENT);
+	}
+	
+	public void setIsPerUser(boolean isPer)
+	{
+		setProperty(PER_USER,new Boolean(isPer));
+	}
+	
+	public boolean isPerUser()
+	{
+		return getPropertyAsBoolean(PER_USER);
+	}
+	
+	public void setVarName(String name)
+	{
+		setProperty(VAR_NAME,name);
+	}
+	
+	public String getVarName()
+	{
+		return getPropertyAsString(VAR_NAME);
+	}
+}
diff --git a/jakarta-jmeter/src/components/org/apache/jmeter/modifiers/UserParameters.java b/jakarta-jmeter/src/components/org/apache/jmeter/modifiers/UserParameters.java
new file mode 100644
index 0000000..5fddc08
--- /dev/null
+++ b/jakarta-jmeter/src/components/org/apache/jmeter/modifiers/UserParameters.java
@@ -0,0 +1,110 @@
+package org.apache.jmeter.modifiers;
+
+import java.io.Serializable;
+import java.util.Iterator;
+import java.util.LinkedList;
+import java.util.List;
+
+import org.apache.jmeter.config.ConfigTestElement;
+import org.apache.jmeter.samplers.Sampler;
+import org.apache.jmeter.testelement.ThreadListener;
+import org.apache.jmeter.testelement.VariablesCollection;
+import org.apache.jmeter.threads.JMeterVariables;
+
+/**
+ * @author Administrator
+ *
+ * To change this generated comment edit the template variable "typecomment":
+ * Window>Preferences>Java>Templates.
+ */
+public class UserParameters
+	extends ConfigTestElement
+	implements Serializable, ThreadListener {
+		
+		private static final String NAMES = "UserParameters.names";
+		private static final String THREAD_VALUES = "UserParameters.thread_values";
+
+	VariablesCollection vars = new VariablesCollection();
+	int counter = 0;
+	transient Iterator threadValues;
+	/**
+	 * @see org.apache.jmeter.config.Modifier#modifyEntry(Sampler)
+	 */
+	public boolean modifyEntry(Sampler Sampler) {
+		return false;
+	}
+	
+	public void iterationStarted(int iter)
+	{
+		if(iter == 1)
+		{
+			setVariables();
+		}
+	}
+	
+	public void setJMeterVariables(JMeterVariables vars)
+	{
+		this.vars.addJMeterVariables(vars);
+	}
+	
+	public List getNames()
+	{
+		return (List)getProperty(NAMES);
+	}
+	
+	public List getThreadLists()
+	{
+		return (List)getProperty(THREAD_VALUES);
+	}	
+	
+	/**
+	 * The list of names of the variables to hold values.  This list must come in
+	 * the same order as the sub lists that are given to setThreadLists(List).
+	 */
+	public void setNames(List list)
+	{
+		setProperty(NAMES,list);
+	}
+	
+	/**
+	 * The thread list is a list of lists.  Each list within the parent list is a
+	 * collection of values for a simulated user.  As many different sets of 
+	 * values can be supplied in this fashion to cause JMeter to set different 
+	 * values to variables for different test threads.
+	 */
+	public void setThreadLists(List threadLists)
+	{
+		setProperty(THREAD_VALUES,threadLists);
+	}
+	
+	private synchronized List getValues()
+	{
+		if(threadValues == null || !threadValues.hasNext())
+		{
+			threadValues = ((List)getProperty(THREAD_VALUES)).iterator();
+		}
+		if(threadValues.hasNext())
+		{
+			return (List)threadValues.next();
+		}
+		else
+		{
+			return new LinkedList();
+		}
+	}	
+		
+	
+	private void setVariables()
+	{
+		Iterator namesIter = getNames().iterator();
+		Iterator valueIter = getValues().iterator();
+		JMeterVariables jmvars = vars.getVariables();
+		while(namesIter.hasNext() && valueIter.hasNext())
+		{
+			String name = (String)namesIter.next();
+			String value = (String)valueIter.next();
+			jmvars.put(name,value);
+		}
+	}
+
+}
diff --git a/jakarta-jmeter/src/components/org/apache/jmeter/modifiers/gui/CVS/Entries b/jakarta-jmeter/src/components/org/apache/jmeter/modifiers/gui/CVS/Entries
new file mode 100644
index 0000000..74b9810
--- /dev/null
+++ b/jakarta-jmeter/src/components/org/apache/jmeter/modifiers/gui/CVS/Entries
@@ -0,0 +1,3 @@
+/CounterConfigGui.java/1.3/Thu Oct 17 19:47:14 2002//Tv1_8_1
+/UserParametersGui.java/1.2/Wed Aug 28 21:29:27 2002//Tv1_8_1
+D
diff --git a/jakarta-jmeter/src/components/org/apache/jmeter/modifiers/gui/CVS/Repository b/jakarta-jmeter/src/components/org/apache/jmeter/modifiers/gui/CVS/Repository
new file mode 100644
index 0000000..2b14817
--- /dev/null
+++ b/jakarta-jmeter/src/components/org/apache/jmeter/modifiers/gui/CVS/Repository
@@ -0,0 +1 @@
+jakarta-jmeter/src/components/org/apache/jmeter/modifiers/gui
diff --git a/jakarta-jmeter/src/components/org/apache/jmeter/config/gui/CVS/Root b/jakarta-jmeter/src/components/org/apache/jmeter/modifiers/gui/CVS/Root
similarity index 100%
rename from jakarta-jmeter/src/components/org/apache/jmeter/config/gui/CVS/Root
rename to jakarta-jmeter/src/components/org/apache/jmeter/modifiers/gui/CVS/Root
diff --git a/jakarta-jmeter/src/components/org/apache/jmeter/modifiers/gui/CVS/Tag b/jakarta-jmeter/src/components/org/apache/jmeter/modifiers/gui/CVS/Tag
new file mode 100644
index 0000000..e2fda28
--- /dev/null
+++ b/jakarta-jmeter/src/components/org/apache/jmeter/modifiers/gui/CVS/Tag
@@ -0,0 +1 @@
+Nv1_8_1
diff --git a/jakarta-jmeter/src/components/org/apache/jmeter/modifiers/gui/CounterConfigGui.java b/jakarta-jmeter/src/components/org/apache/jmeter/modifiers/gui/CounterConfigGui.java
new file mode 100644
index 0000000..b6ae69e
--- /dev/null
+++ b/jakarta-jmeter/src/components/org/apache/jmeter/modifiers/gui/CounterConfigGui.java
@@ -0,0 +1,82 @@
+package org.apache.jmeter.modifiers.gui;
+import javax.swing.BorderFactory;
+import javax.swing.JCheckBox;
+
+import org.apache.jmeter.config.gui.AbstractConfigGui;
+import org.apache.jmeter.modifiers.CounterConfig;
+import org.apache.jmeter.testelement.TestElement;
+import org.apache.jmeter.util.JMeterUtils;
+import org.apache.jorphan.gui.JLabeledTextField;
+import org.apache.jorphan.gui.layout.VerticalLayout;
+/**
+ * @author Administrator
+ *
+ * To change this generated comment edit the template variable "typecomment":
+ * Window>Preferences>Java>Templates.
+ */
+public class CounterConfigGui extends AbstractConfigGui
+{
+	private JLabeledTextField startField,incrField,endField,varNameField;
+	private JCheckBox perUserField;
+	
+	public CounterConfigGui()
+	{
+		super();
+		init();
+	}
+	
+	/**
+	 * @see org.apache.jmeter.gui.JMeterGUIComponent#getStaticLabel()
+	 */
+	public String getStaticLabel()
+	{
+		return JMeterUtils.getResString("counter_config_title");
+	}
+	/**
+	 * @see org.apache.jmeter.gui.JMeterGUIComponent#createTestElement()
+	 */
+	public TestElement createTestElement()
+	{
+		CounterConfig config = new CounterConfig();
+		config.setStart(startField.getText());
+		if(endField.getText().length() > 0)
+		{
+			config.setEnd(endField.getText());
+		}
+		config.setIncrement(incrField.getText());
+		config.setVarName(varNameField.getText());
+		config.setIsPerUser(perUserField.isSelected());
+		super.configureTestElement(config);
+		return config;
+	}
+	
+	public void configure(TestElement element)
+	{
+		super.configure(element);
+		CounterConfig config = (CounterConfig)element;
+		startField.setText(Integer.toString(config.getStart()));
+		endField.setText(Integer.toString(config.getEnd()));
+		incrField.setText(Integer.toString(config.getIncrement()));
+		varNameField.setText(config.getVarName());
+		perUserField.setSelected(config.isPerUser());
+	}
+	
+	private void init()
+	{
+		this.setBorder(BorderFactory.createTitledBorder(
+				BorderFactory.createEmptyBorder(5,10,5,5),
+				JMeterUtils.getResString("counter_config_title")));
+		this.setLayout(new VerticalLayout(5,VerticalLayout.LEFT));
+		startField = new JLabeledTextField(JMeterUtils.getResString("start"),5);
+		incrField = new JLabeledTextField(JMeterUtils.getResString("increment"),5);
+		endField = new JLabeledTextField(JMeterUtils.getResString("max"),5);
+		varNameField = new JLabeledTextField(JMeterUtils.getResString("var_name"));
+		perUserField = new JCheckBox(JMeterUtils.getResString("counter_per_user"));
+		add(getNamePanel());
+		add(startField);
+		add(incrField);
+		add(endField);
+		add(varNameField);
+		add(perUserField);
+	}
+}
diff --git a/jakarta-jmeter/src/components/org/apache/jmeter/modifiers/gui/UserParametersGui.java b/jakarta-jmeter/src/components/org/apache/jmeter/modifiers/gui/UserParametersGui.java
new file mode 100644
index 0000000..5534f98
--- /dev/null
+++ b/jakarta-jmeter/src/components/org/apache/jmeter/modifiers/gui/UserParametersGui.java
@@ -0,0 +1,281 @@
+package org.apache.jmeter.modifiers.gui;
+
+import java.awt.BorderLayout;
+import java.awt.Dimension;
+import java.awt.event.ActionEvent;
+import java.awt.event.ActionListener;
+import java.util.Iterator;
+import java.util.LinkedList;
+import java.util.List;
+
+import javax.swing.JButton;
+import javax.swing.JLabel;
+import javax.swing.JOptionPane;
+import javax.swing.JPanel;
+import javax.swing.JScrollPane;
+import javax.swing.JTable;
+import javax.swing.ListSelectionModel;
+import javax.swing.table.TableCellEditor;
+
+import org.apache.jmeter.config.gui.AbstractConfigGui;
+import org.apache.jmeter.gui.util.PowerTableModel;
+import org.apache.jmeter.modifiers.UserParameters;
+import org.apache.jmeter.testelement.TestElement;
+import org.apache.jmeter.util.JMeterUtils;
+
+/**
+ * @author Administrator
+ *
+ * To change this generated comment edit the template variable "typecomment":
+ * Window>Preferences>Java>Templates.
+ */
+public class UserParametersGui extends AbstractConfigGui {
+
+	private String THREAD_COLUMNS =
+		JMeterUtils.getResString("user");
+
+	JTable paramTable;
+	PowerTableModel tableModel;
+	private int numUserColumns = 1;
+	private JButton addParameterButton,
+		addUserButton,
+		deleteRowButton,
+		deleteColumnButton;
+
+	public UserParametersGui() {
+		super();
+		init();
+	}
+
+	/**
+	 * @see org.apache.jmeter.gui.JMeterGUIComponent#getStaticLabel()
+	 */
+	public String getStaticLabel() {
+		return JMeterUtils.getResString("user_parameters_title");
+	}
+	
+	public void configure(TestElement el)
+	{
+		tableModel.clearData();
+		UserParameters params = (UserParameters)el;
+		List names = params.getNames();
+		List threadValues = params.getThreadLists();
+		tableModel.setColumnData(0,names);
+		Iterator iter = threadValues.iterator();
+		if(iter.hasNext())
+		{
+			tableModel.setColumnData(1,(List)iter.next());
+		}
+		int count = 2;
+		while(iter.hasNext())
+		{
+			String colName = THREAD_COLUMNS+"_"+count;
+			tableModel.addNewColumn(colName,String.class);
+			tableModel.setColumnData(count,(List)iter.next());
+			count++;
+		}
+		super.configure(el);
+	}
+
+	/**
+	 * @see org.apache.jmeter.gui.JMeterGUIComponent#createTestElement()
+	 */
+	public TestElement createTestElement() {
+		UserParameters params = new UserParameters();
+		params.setNames(tableModel.getColumnData(JMeterUtils.getResString("name")));
+		List threadLists = new LinkedList();
+		for (int x = 1; x < tableModel.getColumnCount(); x++) {
+			threadLists.add(tableModel.getColumnData(THREAD_COLUMNS + "_" + x));
+		}
+		params.setThreadLists(threadLists);
+		super.configureTestElement(params);
+		return params;
+	}
+
+	private void init() {
+		this.setLayout(new BorderLayout());
+		add(makeTitlePanel(), BorderLayout.NORTH);
+		add(makeParameterPanel(), BorderLayout.CENTER);
+	}
+
+	private JPanel makeTitlePanel() {
+		JLabel title = new JLabel(JMeterUtils.getResString("user_parameters_title"));
+		JPanel titlePanel = new JPanel(new BorderLayout());
+		titlePanel.add(title, BorderLayout.NORTH);
+		titlePanel.add(getNamePanel(), BorderLayout.SOUTH);
+		return titlePanel;
+	}
+
+	private JPanel makeParameterPanel() {
+		JPanel paramPanel = new JPanel(new BorderLayout());
+		JLabel tableLabel =
+			new JLabel(JMeterUtils.getResString("user_parameters_table"));
+		tableModel =
+			new PowerTableModel(
+				new String[] {
+					JMeterUtils.getResString("name"),
+					THREAD_COLUMNS + "_" + numUserColumns },
+				new Class[] { String.class, String.class });
+		paramTable = new JTable(tableModel);
+		paramTable.setRowSelectionAllowed(true);
+		paramTable.setColumnSelectionAllowed(true);
+		paramTable.setSelectionMode(ListSelectionModel.SINGLE_SELECTION);
+		paramTable.setCellSelectionEnabled(true);
+		paramPanel.add(tableLabel, BorderLayout.NORTH);
+		JScrollPane scroller = new JScrollPane(paramTable);
+		Dimension tableDim = scroller.getPreferredSize();
+		tableDim.height = 70;
+		scroller.setPreferredSize(tableDim);
+		scroller.setColumnHeaderView(paramTable.getTableHeader());
+		paramPanel.add(scroller, BorderLayout.CENTER);
+		paramPanel.add(makeButtonPanel(), BorderLayout.SOUTH);
+		return paramPanel;
+	}
+
+	private JPanel makeButtonPanel() {
+		JPanel buttonPanel = new JPanel();
+		addParameterButton =
+			new JButton(JMeterUtils.getResString("add_parameter"));
+		addUserButton = new JButton(JMeterUtils.getResString("add_user"));
+		deleteRowButton =
+			new JButton(JMeterUtils.getResString("delete_parameter"));
+		deleteColumnButton =
+			new JButton(JMeterUtils.getResString("delete_user"));
+		buttonPanel.add(addParameterButton);
+		buttonPanel.add(addUserButton);
+		buttonPanel.add(deleteRowButton);
+		buttonPanel.add(deleteColumnButton);
+		addParameterButton.addActionListener(new AddParamAction());
+		addUserButton.addActionListener(new AddUserAction());
+		deleteRowButton.addActionListener(new DeleteRowAction());
+		deleteColumnButton.addActionListener(new DeleteColumnAction());
+		return buttonPanel;
+	}
+
+	private class AddParamAction implements ActionListener {
+		public void actionPerformed(ActionEvent e) {
+			if (paramTable.isEditing()) {
+				TableCellEditor cellEditor =
+					paramTable.getCellEditor(
+						paramTable.getEditingRow(),
+						paramTable.getEditingColumn());
+				cellEditor.stopCellEditing();
+			}
+
+			tableModel.addNewRow();
+			tableModel.fireTableDataChanged();
+
+			// Enable DELETE (which may already be enabled, but it won't hurt)
+			deleteRowButton.setEnabled(true);
+
+			// Highlight (select) the appropriate row.
+			int rowToSelect = tableModel.getRowCount() - 1;
+			paramTable.setRowSelectionInterval(rowToSelect, rowToSelect);
+		}
+	}
+
+	private class AddUserAction implements ActionListener {
+		public void actionPerformed(ActionEvent e) {
+			
+			if (paramTable.isEditing()) {
+				TableCellEditor cellEditor =
+					paramTable.getCellEditor(
+						paramTable.getEditingRow(),
+						paramTable.getEditingColumn());
+				cellEditor.stopCellEditing();
+			}
+
+			tableModel.addNewColumn(
+				THREAD_COLUMNS + "_" + tableModel.getColumnCount(),
+				String.class);
+			tableModel.fireTableDataChanged();
+
+			// Enable DELETE (which may already be enabled, but it won't hurt)
+			deleteColumnButton.setEnabled(true);
+
+			// Highlight (select) the appropriate row.
+			int colToSelect = tableModel.getColumnCount() - 1;
+			paramTable.setColumnSelectionInterval(colToSelect, colToSelect);
+		}
+	}
+
+	private class DeleteRowAction implements ActionListener {
+		public void actionPerformed(ActionEvent e) {
+			if (paramTable.isEditing()) {
+				TableCellEditor cellEditor =
+					paramTable.getCellEditor(
+						paramTable.getEditingRow(),
+						paramTable.getEditingColumn());
+				cellEditor.cancelCellEditing();
+			}
+
+			int rowSelected = paramTable.getSelectedRow();
+			if (rowSelected >= 0) {
+				tableModel.removeRow(rowSelected);
+				tableModel.fireTableDataChanged();
+
+				// Disable DELETE if there are no rows in the table to delete.
+				if (tableModel.getRowCount() == 0) {
+					deleteRowButton.setEnabled(false);
+				}
+
+				// Table still contains one or more rows, so highlight (select)
+				// the appropriate one.
+				else {
+					int rowToSelect = rowSelected;
+
+					if (rowSelected >= tableModel.getRowCount()) {
+						rowToSelect = rowSelected - 1;
+					}
+
+					paramTable.setRowSelectionInterval(
+						rowToSelect,
+						rowToSelect);
+				}
+			}
+		}
+	}
+
+	private class DeleteColumnAction implements ActionListener {
+		public void actionPerformed(ActionEvent e) {
+			if (paramTable.isEditing()) {
+				TableCellEditor cellEditor =
+					paramTable.getCellEditor(
+						paramTable.getEditingRow(),
+						paramTable.getEditingColumn());
+				cellEditor.cancelCellEditing();
+			}
+
+			int colSelected = paramTable.getSelectedColumn();
+			if(colSelected == 0 || colSelected == 1)
+			{
+				JOptionPane.showMessageDialog(null, 
+						JMeterUtils.getResString("column_delete_disallowed"), "Error", 
+						JOptionPane.ERROR_MESSAGE);
+				return;
+			}
+			if (colSelected >= 0) {
+				tableModel.removeColumn(colSelected);
+				tableModel.fireTableDataChanged();
+
+				// Disable DELETE if there are no rows in the table to delete.
+				if (tableModel.getColumnCount() == 0) {
+					deleteColumnButton.setEnabled(false);
+				}
+
+				// Table still contains one or more rows, so highlight (select)
+				// the appropriate one.
+				else {
+
+					if (colSelected >= tableModel.getColumnCount()) {
+						colSelected = colSelected - 1;
+					}
+
+					paramTable.setColumnSelectionInterval(
+						colSelected,
+						colSelected);
+				}
+			}
+		}
+	}
+}
diff --git a/jakarta-jmeter/src/components/org/apache/jmeter/reporters/CVS/Entries b/jakarta-jmeter/src/components/org/apache/jmeter/reporters/CVS/Entries
index 1936884..38fb77c 100644
--- a/jakarta-jmeter/src/components/org/apache/jmeter/reporters/CVS/Entries
+++ b/jakarta-jmeter/src/components/org/apache/jmeter/reporters/CVS/Entries
@@ -1,2 +1,2 @@
-/MailerResultCollector.java/1.1/Sun Aug 11 19:24:40 2002//Tv1_7_3
+/MailerResultCollector.java/1.3/Thu Aug 29 18:17:37 2002//Tv1_8_1
 D
diff --git a/jakarta-jmeter/src/components/org/apache/jmeter/reporters/CVS/Tag b/jakarta-jmeter/src/components/org/apache/jmeter/reporters/CVS/Tag
index 5f312fe..e2fda28 100644
--- a/jakarta-jmeter/src/components/org/apache/jmeter/reporters/CVS/Tag
+++ b/jakarta-jmeter/src/components/org/apache/jmeter/reporters/CVS/Tag
@@ -1 +1 @@
-Nv1_7_3
+Nv1_8_1
diff --git a/jakarta-jmeter/src/components/org/apache/jmeter/reporters/MailerResultCollector.java b/jakarta-jmeter/src/components/org/apache/jmeter/reporters/MailerResultCollector.java
index 7db50f3..9b976f0 100644
--- a/jakarta-jmeter/src/components/org/apache/jmeter/reporters/MailerResultCollector.java
+++ b/jakarta-jmeter/src/components/org/apache/jmeter/reporters/MailerResultCollector.java
@@ -1,13 +1,23 @@
 package org.apache.jmeter.reporters;
 
-import java.util.*;
-import java.io.*;
-import java.net.*;
-import javax.mail.*;
-import javax.mail.internet.*;
-
+import java.io.Serializable;
+import java.net.InetAddress;
+import java.net.UnknownHostException;
+import java.util.Properties;
+import java.util.StringTokenizer;
+import java.util.Vector;
+
+import javax.mail.Message;
+import javax.mail.Session;
+import javax.mail.Transport;
+import javax.mail.internet.InternetAddress;
+import javax.mail.internet.MimeMessage;
+
+import org.apache.jmeter.samplers.SampleEvent;
+import org.apache.jmeter.samplers.SampleResult;
 import org.apache.jmeter.util.JMeterUtils;
-import org.apache.jmeter.samplers.*;
+import org.apache.log.Hierarchy;
+import org.apache.log.Logger;
 
 /**
  * Title:        Apache JMeter
@@ -20,7 +30,8 @@ import org.apache.jmeter.samplers.*;
 
 public class MailerResultCollector extends ResultCollector implements Serializable
 {
-
+	transient private static Logger log = Hierarchy.getDefaultHierarchy().getLoggerFor(
+			"jmeter.elements");
 	String address;
 	String from;
 	String smtpHost;
@@ -161,7 +172,7 @@ public class MailerResultCollector extends ResultCollector implements Serializab
 
 	public void sendTestMessage()
 	{
-		System.out.println("### Test To:  " + this.address + ", " +
+		log.debug("### Test To:  " + this.address + ", " +
 						"Via:  " + this.smtpHost + ", " +
 						"Fail Subject:  " + this.failSubject + ", " +
 						"Success Subject:  " + this.successSubject);
@@ -266,16 +277,16 @@ public class MailerResultCollector extends ResultCollector implements Serializab
 			msg.setSubject(subject);
 			msg.setText(attText);
 			Transport.send(msg);
-			System.out.println("Mail sent successfully!!");
+			log.info("Mail sent successfully!!");
 		}
 		catch (UnknownHostException e1)
 		{
-			System.out.println("NxError:Invalid Mail Server " + e1);
+			log.fatalError("NxError:Invalid Mail Server ", e1);
 			System.exit(1);
 		}
 		catch (Exception e)
 		{
-			e.printStackTrace();
+			log.fatalError("",e);
 			System.exit(1);
 		}
 	}
diff --git a/jakarta-jmeter/src/components/org/apache/jmeter/timers/CVS/Entries b/jakarta-jmeter/src/components/org/apache/jmeter/timers/CVS/Entries
index 2a37260..3709cef 100644
--- a/jakarta-jmeter/src/components/org/apache/jmeter/timers/CVS/Entries
+++ b/jakarta-jmeter/src/components/org/apache/jmeter/timers/CVS/Entries
@@ -1,5 +1,6 @@
-/ConstantTimer.java/1.1/Sun Aug 11 19:24:41 2002//Tv1_7_3
-/GaussianRandomTimer.java/1.1/Sun Aug 11 19:24:41 2002//Tv1_7_3
-/RandomTimer.java/1.1/Sun Aug 11 19:24:41 2002//Tv1_7_3
-/UniformRandomTimer.java/1.1/Sun Aug 11 19:24:41 2002//Tv1_7_3
+/ConstantThroughputTimer.java/1.3/Fri Jan 10 13:59:51 2003//Tv1_8_1
+/ConstantTimer.java/1.4/Mon Jan 13 03:48:54 2003//Tv1_8_1
+/GaussianRandomTimer.java/1.2/Fri Jan 10 13:59:51 2003//Tv1_8_1
+/RandomTimer.java/1.2/Fri Jan 10 13:59:51 2003//Tv1_8_1
+/UniformRandomTimer.java/1.2/Fri Jan 10 13:59:51 2003//Tv1_8_1
 D/gui////
diff --git a/jakarta-jmeter/src/components/org/apache/jmeter/timers/CVS/Tag b/jakarta-jmeter/src/components/org/apache/jmeter/timers/CVS/Tag
index 5f312fe..e2fda28 100644
--- a/jakarta-jmeter/src/components/org/apache/jmeter/timers/CVS/Tag
+++ b/jakarta-jmeter/src/components/org/apache/jmeter/timers/CVS/Tag
@@ -1 +1 @@
-Nv1_7_3
+Nv1_8_1
diff --git a/jakarta-jmeter/src/components/org/apache/jmeter/timers/ConstantThroughputTimer.java b/jakarta-jmeter/src/components/org/apache/jmeter/timers/ConstantThroughputTimer.java
new file mode 100644
index 0000000..275c165
--- /dev/null
+++ b/jakarta-jmeter/src/components/org/apache/jmeter/timers/ConstantThroughputTimer.java
@@ -0,0 +1,200 @@
+/*
+ * ====================================================================
+ * The Apache Software License, Version 1.1
+ *
+ * Copyright (c) 2002 The Apache Software Foundation.  All rights
+ * reserved.
+ *
+ * Redistribution and use in source and binary forms, with or without
+ * modification, are permitted provided that the following conditions
+ * are met:
+ *
+ * 1. Redistributions of source code must retain the above copyright
+ * notice, this list of conditions and the following disclaimer.
+ *
+ * 2. Redistributions in binary form must reproduce the above copyright
+ * notice, this list of conditions and the following disclaimer in
+ * the documentation and/or other materials provided with the
+ * distribution.
+ *
+ * 3. The end-user documentation included with the redistribution,
+ * if any, must include the following acknowledgment:
+ * "This product includes software developed by the
+ * Apache Software Foundation (http://www.apache.org/)."
+ * Alternately, this acknowledgment may appear in the software itself,
+ * if and wherever such third-party acknowledgments normally appear.
+ *
+ * 4. The names "Apache" and "Apache Software Foundation" and
+ * "Apache JMeter" must not be used to endorse or promote products
+ * derived from this software without prior written permission. For
+ * written permission, please contact apache@apache.org.
+ *
+ * 5. Products derived from this software may not be called "Apache",
+ * "Apache JMeter", nor may "Apache" appear in their name, without
+ * prior written permission of the Apache Software Foundation.
+ *
+ * THIS SOFTWARE IS PROVIDED ``AS IS'' AND ANY EXPRESSED OR IMPLIED
+ * WARRANTIES, INCLUDING, BUT NOT LIMITED TO, THE IMPLIED WARRANTIES
+ * OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE ARE
+ * DISCLAIMED.  IN NO EVENT SHALL THE APACHE SOFTWARE FOUNDATION OR
+ * ITS CONTRIBUTORS BE LIABLE FOR ANY DIRECT, INDIRECT, INCIDENTAL,
+ * SPECIAL, EXEMPLARY, OR CONSEQUENTIAL DAMAGES (INCLUDING, BUT NOT
+ * LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES; LOSS OF
+ * USE, DATA, OR PROFITS; OR BUSINESS INTERRUPTION) HOWEVER CAUSED AND
+ * ON ANY THEORY OF LIABILITY, WHETHER IN CONTRACT, STRICT LIABILITY,
+ * OR TORT (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT
+ * OF THE USE OF THIS SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF
+ * SUCH DAMAGE.
+ * ====================================================================
+ *
+ * This software consists of voluntary contributions made by many
+ * individuals on behalf of the Apache Software Foundation.  For more
+ * information on the Apache Software Foundation, please see
+ * <http://www.apache.org/>.
+ */
+
+package org.apache.jmeter.timers;
+
+import java.util.*;
+import java.io.*;
+
+import org.apache.jmeter.util.JMeterUtils;
+import org.apache.jmeter.testelement.AbstractTestElement;
+
+/**
+ * This class implements a constant throughput timer. A Constant Throughtput
+ * Timer paces the samplers under it's influence so that the total number of
+ * samples per unit of time approaches a given constant as much as possible.
+ *
+ * @author <a href="mailto:jsalvata@atg.com">Jordi Salvat i Alabart</a>
+ * @author <a href="mailto:seade@backstagetech.com.au">Scott Eade</a>
+ * @version $Id: ConstantThroughputTimer.java,v 1.3 2003/01/10 13:59:51 seade Exp $
+ */
+public class ConstantThroughputTimer
+        extends AbstractTestElement
+        implements Timer, Serializable
+{
+    public final static String THROUGHPUT= "ConstantThroughputTimer.throughput";
+    private static List addableList= new LinkedList();
+
+    /**
+     * Target time for the start of the next request. The delay provided by
+     * the timer will be calculated so that the next request happens at this
+     * time.
+     */
+    private long targetTime= 0;
+
+    /**
+     * Inverse of the configured throughput, in milliseconds. It's the interval
+     * at which sampling should ideally occur to get that throughput.
+     */
+    private long delay;
+
+    /**
+     * Constructor for a non-configured ConstantThroughputTimer.
+     */
+    public ConstantThroughputTimer()
+    {
+    }
+
+    /**
+     * Sets the desired throughput.
+     *
+     * @param throughput Desired sampling rate, in samples per minute.
+     */
+    public void setThroughput(long throughput)
+    {
+		setProperty(THROUGHPUT,new Long(throughput));
+		delay= 60000/throughput;
+    }
+
+    /**
+     * Not implemented.
+     */
+    public void setRange(double range)
+    {
+    }
+
+    /**
+     * Not implemented.
+     */
+    public double getRange()
+    {
+        return (double)0;
+    }
+
+    /**
+     * Not implemented.
+     */
+    public void setDelay(String delay)
+    {
+    }
+
+    /**
+     * Not implemented.
+     */
+    public String getDelay()
+    {
+		return "";
+    }
+
+    /**
+     * Gets the configured desired throughput.
+     *
+     * @return the rate at which samples should occur, in samples per minute.
+     */
+    public long getThroughput()
+    {
+		Object throughput = getProperty(THROUGHPUT);
+		if(throughput instanceof Long)
+		{
+		    return ((Long)throughput).longValue();
+		}
+		else
+		{
+		    return Long.parseLong((String)throughput);
+		}
+    }
+
+	/**
+	 * Retrieve the delay to use during test execution.
+	 * 
+	 * @see org.apache.jmeter.timers.Timer#delay()
+	 */
+    public synchronized long delay()
+    {
+		long currentTime = System.currentTimeMillis();
+		long currentTarget = targetTime == 0 ? currentTime : targetTime;
+		targetTime = currentTarget + delay;
+		if (currentTime > currentTarget)
+		{
+		    // We're behind schedule -- try to catch up:
+		    return 0;
+		}
+		return currentTarget - currentTime;
+    }
+
+	/**
+	 * Provide a description of this timer class.
+	 * 
+	 * @return the description of this timer class.
+	 */
+    public String toString()
+    {
+	    return JMeterUtils.getResString("constant_throughput_timer_memo");
+    }
+
+    /**
+     * Creates a copy of this ConstantThroughputTimer, ready to start
+     * calculating delays for new samples. This is in assumption that cloning
+     * always happens just before a test starts running.
+     *
+     * @return a fresh copy of this ConstantThroughputTimer
+     */
+    public Object clone() {
+        ConstantThroughputTimer result = (ConstantThroughputTimer)super.clone();
+        result.targetTime = 0;
+        return result;
+    }
+    
+}
diff --git a/jakarta-jmeter/src/components/org/apache/jmeter/timers/ConstantTimer.java b/jakarta-jmeter/src/components/org/apache/jmeter/timers/ConstantTimer.java
index 8c24ace..a2bd879 100644
--- a/jakarta-jmeter/src/components/org/apache/jmeter/timers/ConstantTimer.java
+++ b/jakarta-jmeter/src/components/org/apache/jmeter/timers/ConstantTimer.java
@@ -55,97 +55,139 @@
 
 package org.apache.jmeter.timers;
 
-import java.util.*;
-import java.io.*;
+import java.io.Serializable;
+import java.util.LinkedList;
+import java.util.List;
 
 import org.apache.jmeter.util.JMeterUtils;
+import org.apache.log.Hierarchy;
+import org.apache.log.Logger;
 import org.apache.jmeter.testelement.AbstractTestElement;
+import org.apache.jmeter.testelement.ThreadListener;
+import org.apache.jmeter.testelement.VariablesCollection;
+import org.apache.jmeter.threads.JMeterVariables;
 
-/************************************************************
- *  This class implements a constant timer with its own panel and fields for
- *  value update and user interaction.
+/**
+ * This class implements a constant timer with its own panel and fields for
+ * value update and user interaction.
  *
- *@author     <a href="mailto:stefano@apache.org">Stefano Mazzocchi</a>
- *@created    $Date: 2002/08/11 19:24:41 $
- *@version    $Revision: 1.1 $ $Date: 2002/08/11 19:24:41 $
- ***********************************************************/
-
-public class ConstantTimer extends AbstractTestElement implements Timer, Serializable
+ * @author <a href="mailto:stefano@apache.org">Stefano Mazzocchi</a>
+ * @author <a href="mailto:seade@backstagetech.com.au">Scott Eade</a>
+ * @version $Revision: 1.4 $ $Date: 2003/01/13 03:48:54 $
+ */
+public class ConstantTimer
+    extends AbstractTestElement
+    implements Timer, Serializable, ThreadListener
 {
-	public final static String DELAY = "ConstantTimer.delay";
-	private static List addableList = new LinkedList();
-
-	/************************************************************
-	 *  !ToDo (Constructor description)
-	 ***********************************************************/
-	public ConstantTimer()
-	{
-	}
-
-	/************************************************************
-	 *  !ToDo (Method description)
-	 *
-	 *@param  delay  !ToDo (Parameter description)
-	 ***********************************************************/
-	public void setDelay(long delay)
-	{
-		setProperty(DELAY,new Long(delay));
-	}
-
-	/************************************************************
-	 *  !ToDo (Method description)
-	 *
-	 *@param  range  !ToDo (Parameter description)
-	 ***********************************************************/
-	public void setRange(double range)
-	{
-	}
-
-	/************************************************************
-	 *  !ToDoo (Method description)
-	 *
-	 *@return    !ToDo (Return description)
-	 ***********************************************************/
-	public long getDelay()
-	{
-		Object delay = getProperty(DELAY);
-		if(delay instanceof Long)
-		{
-			return ((Long)delay).longValue();
-		}
-		else
-		{
-			return Long.parseLong((String)delay);
-		}
-	}
-
-	/************************************************************
-	 *  !ToDoo (Method description)
-	 *
-	 *@return    !ToDo (Return description)
-	 ***********************************************************/
-	public double getRange()
-	{
-		return (double)0;
-	}
-
-	/************************************************************
-	 *  !ToDo (Method description)
-	 *
-	 *@return    !ToDo (Return description)
-	 ***********************************************************/
-	public long delay()
-	{
-		return getDelay();
-	}
-
-	/************************************************************
-	 *  !ToDo (Method description)
-	 *
-	 *@return    !ToDo (Return description)
-	 ***********************************************************/
-	public String toString()
-	{
-		return JMeterUtils.getResString("constant_timer_memo");
-	}
+    private static Logger log =
+        Hierarchy.getDefaultHierarchy().getLoggerFor("jmeter.elements");
+
+    public final static String DELAY = "ConstantTimer.delay";
+    private VariablesCollection vars = new VariablesCollection();
+    private JMeterVariables variables;
+    private static List addableList = new LinkedList();
+    private long delay = 0;
+
+    /**
+     * No-arg constructor.
+     */
+    public ConstantTimer()
+    {
+    }
+
+    /**
+     * Set the delay for this timer.
+     *  
+     * @see org.apache.jmeter.timers.Timer#setDelay(String)
+     */
+    public void setDelay(String delay)
+    {
+        setProperty(DELAY, delay);
+    }
+
+    /**
+     * Set the range (not used for this timer).
+     * 
+     * @see org.apache.jmeter.timers.Timer#setRange(double)
+     */
+    public void setRange(double range)
+    {
+    }
+
+    /**
+     * Get the delay value for display.
+     * 
+     * @return the delay value for display.
+     * @see org.apache.jmeter.timers.Timer#getDelay()
+     */
+    public String getDelay()
+    {
+        return (String) getProperty(DELAY);
+    }
+
+    /**
+     * Retrieve the range (not used for this timer).
+     * 
+     * @return the range (always zero for this timer).
+     * @see org.apache.jmeter.timers.Timer#getRange()
+     */
+    public double getRange()
+    {
+        return (double) 0;
+    }
+
+    /**
+     * Retrieve the delay to use during test execution.
+     * 
+     * @return the delay.
+     */
+    public long delay()
+    {
+        return delay;
+    }
+
+    /**
+     * Provide a description of this timer class.
+     * 
+     * @return the description of this timer class.
+     */
+    public String toString()
+    {
+        return JMeterUtils.getResString("constant_timer_memo");
+    }
+
+    /**
+     * Gain access to any variables that have been defined.
+     * 
+     * @see org.apache.jmeter.testelement.ThreadListener#iterationStarted(int)
+     */
+    public void iterationStarted(int iterationCount)
+    {
+        variables = vars.getVariables();
+
+        try
+        {
+            String delayString = (String) getProperty(DELAY);
+            delay = Long.parseLong(delayString);
+        }
+        catch (ClassCastException ex)
+        {
+            log.error(
+                "Unable to determine delay - you may have used an undefined "                    + "variable in the test element with the name: "
+                    + getName(),
+                ex);
+            delay = 0;
+        }
+    }
+
+    /**
+     * Make changes to variables available elsewhere.
+     * 
+     * @see org.apache.jmeter.testelement.ThreadListener#setJMeterVariables(JMeterVariables)
+     */
+    public void setJMeterVariables(JMeterVariables jmVars)
+    {
+        //vars.addJMeterVariables(jmVars);
+    }
+
 }
diff --git a/jakarta-jmeter/src/components/org/apache/jmeter/timers/GaussianRandomTimer.java b/jakarta-jmeter/src/components/org/apache/jmeter/timers/GaussianRandomTimer.java
index c312d80..4851757 100644
--- a/jakarta-jmeter/src/components/org/apache/jmeter/timers/GaussianRandomTimer.java
+++ b/jakarta-jmeter/src/components/org/apache/jmeter/timers/GaussianRandomTimer.java
@@ -55,8 +55,7 @@
 
 package org.apache.jmeter.timers;
 
-import java.util.*;
-import java.io.*;
+import java.io.Serializable;
 
 import org.apache.jmeter.util.JMeterUtils;
 
@@ -65,17 +64,19 @@ import org.apache.jmeter.util.JMeterUtils;
  * to be instantiable and implements a random delay with
  * an average value and a gaussian distributed variation.
  *
- * @author  <a href="mailto:stefano@apache.org">Stefano Mazzocchi</a>
- * @version $Revision: 1.1 $ $Date: 2002/08/11 19:24:41 $
+ * @author <a href="mailto:stefano@apache.org">Stefano Mazzocchi</a>
+ * @author <a href="mailto:seade@backstagetech.com.au">Scott Eade</a>
+ * @version $Id: GaussianRandomTimer.java,v 1.2 2003/01/10 13:59:51 seade Exp $
  */
 public class GaussianRandomTimer extends RandomTimer implements Serializable
 {
 
 	 public long delay() {
-		  return (long) Math.abs((this.random.nextGaussian() * getRange()) + getDelay());
+		  return (long) Math.abs((this.random.nextGaussian() * getRange()) + super.delay());
 	 }
 
 	 public String toString() {
 		  return JMeterUtils.getResString("gaussian_timer_memo");
 	 }
+	 
 }
diff --git a/jakarta-jmeter/src/components/org/apache/jmeter/timers/RandomTimer.java b/jakarta-jmeter/src/components/org/apache/jmeter/timers/RandomTimer.java
index 84bf906..291d936 100644
--- a/jakarta-jmeter/src/components/org/apache/jmeter/timers/RandomTimer.java
+++ b/jakarta-jmeter/src/components/org/apache/jmeter/timers/RandomTimer.java
@@ -55,52 +55,48 @@
 
 package org.apache.jmeter.timers;
 
-import java.util.*;
-import java.io.*;
+import java.io.Serializable;
+import java.util.Random;
 
-import org.apache.jmeter.testelement.AbstractTestElement;
-
-/************************************************************
- *  This class implements a random timer with its own panel and fields for value
- *  update and user interaction. Since this class does not define the delay()
- *  method, is abstract and must be extended to provide full functionality.
+/***
+ * This class implements a random timer with its own panel and fields for value
+ * update and user interaction. Since this class does not define the delay()
+ * method, is abstract and must be extended to provide full functionality.
  *
- *@author     <a href="mailto:stefano@apache.org">Stefano Mazzocchi</a>
- *@created    $Date: 2002/08/11 19:24:41 $
- *@version    $Revision: 1.1 $ $Date: 2002/08/11 19:24:41 $
- ***********************************************************/
-
-public abstract class RandomTimer extends ConstantTimer implements Timer,Serializable
+ * @author <a href="mailto:stefano@apache.org">Stefano Mazzocchi</a>
+ * @author <a href="mailto:seade@backstagetech.com.au">Scott Eade</a>
+ * @version $Id: RandomTimer.java,v 1.2 2003/01/10 13:59:51 seade Exp $
+ */
+public abstract class RandomTimer extends ConstantTimer implements Timer, Serializable
 {
 	public final static String RANGE = "RandomTimer.range";
 
 	protected Random random;
 
-	/************************************************************
-	 *  !ToDo (Constructor description)
-	 ***********************************************************/
+	/**
+	 * No-arg constructor.
+	 */
 	public RandomTimer()
 	{
 		this.random = new Random();
 	}
 
-	/************************************************************
-	 *  !ToDo (Method description)
-	 *
-	 *@param  range  !ToDo (Parameter description)
-	 ***********************************************************/
+	/**
+	 * Set the range value.
+	 */
 	public void setRange(double range)
 	{
 		setProperty(RANGE,new Double(range));
 	}
 
-	/************************************************************
-	 *  !ToDoo (Method description)
-	 *
-	 *@return    !ToDo (Return description)
-	 ***********************************************************/
+	/**
+	 * Get the range value.
+	 * 
+	 * @return double
+	 */
 	public double getRange()
 	{
 		return this.getPropertyAsDouble(RANGE);
 	}
+	
 }
diff --git a/jakarta-jmeter/src/components/org/apache/jmeter/timers/UniformRandomTimer.java b/jakarta-jmeter/src/components/org/apache/jmeter/timers/UniformRandomTimer.java
index 8157293..5527743 100644
--- a/jakarta-jmeter/src/components/org/apache/jmeter/timers/UniformRandomTimer.java
+++ b/jakarta-jmeter/src/components/org/apache/jmeter/timers/UniformRandomTimer.java
@@ -55,8 +55,7 @@
 
 package org.apache.jmeter.timers;
 
-import java.util.*;
-import java.io.*;
+import java.io.Serializable;
 
 import org.apache.jmeter.util.JMeterUtils;
 
@@ -66,17 +65,18 @@ import org.apache.jmeter.util.JMeterUtils;
  * an average value and a uniformly distributed variation.
  *
  * @author  <a href="mailto:stefano@apache.org">Stefano Mazzocchi</a>
- * @version $Revision: 1.1 $ $Date: 2002/08/11 19:24:41 $
+ * @version $Revision: 1.2 $ $Date: 2003/01/10 13:59:51 $
  */
 public class UniformRandomTimer extends RandomTimer implements Serializable
 {
 	public long delay()
 	{
-		return (long) Math.abs((this.random.nextDouble() * getRange()) + getDelay());
+		return (long) Math.abs((this.random.nextDouble() * getRange()) + super.delay());
 	}
 
 	public String toString()
 	{
 		return JMeterUtils.getResString("uniform_timer_memo");
 	}
+	
 }
diff --git a/jakarta-jmeter/src/components/org/apache/jmeter/timers/gui/CVS/Entries b/jakarta-jmeter/src/components/org/apache/jmeter/timers/gui/CVS/Entries
index 8dd9353..47316f8 100644
--- a/jakarta-jmeter/src/components/org/apache/jmeter/timers/gui/CVS/Entries
+++ b/jakarta-jmeter/src/components/org/apache/jmeter/timers/gui/CVS/Entries
@@ -1,4 +1,5 @@
-/ConstantTimerGui.java/1.1/Sun Aug 11 19:24:41 2002//Tv1_7_3
-/GaussianRandomTimerGui.java/1.1/Sun Aug 11 19:24:41 2002//Tv1_7_3
-/UniformRandomTimerGui.java/1.1/Sun Aug 11 19:24:41 2002//Tv1_7_3
+/ConstantThroughputTimerGui.java/1.3/Fri Jan 10 13:59:50 2003//Tv1_8_1
+/ConstantTimerGui.java/1.4/Fri Jan 10 13:59:50 2003//Tv1_8_1
+/GaussianRandomTimerGui.java/1.4/Fri Jan 10 13:59:50 2003//Tv1_8_1
+/UniformRandomTimerGui.java/1.4/Fri Jan 10 13:59:50 2003//Tv1_8_1
 D
diff --git a/jakarta-jmeter/src/components/org/apache/jmeter/timers/gui/CVS/Tag b/jakarta-jmeter/src/components/org/apache/jmeter/timers/gui/CVS/Tag
index 5f312fe..e2fda28 100644
--- a/jakarta-jmeter/src/components/org/apache/jmeter/timers/gui/CVS/Tag
+++ b/jakarta-jmeter/src/components/org/apache/jmeter/timers/gui/CVS/Tag
@@ -1 +1 @@
-Nv1_7_3
+Nv1_8_1
diff --git a/jakarta-jmeter/src/components/org/apache/jmeter/timers/gui/ConstantThroughputTimerGui.java b/jakarta-jmeter/src/components/org/apache/jmeter/timers/gui/ConstantThroughputTimerGui.java
new file mode 100644
index 0000000..8743bfb
--- /dev/null
+++ b/jakarta-jmeter/src/components/org/apache/jmeter/timers/gui/ConstantThroughputTimerGui.java
@@ -0,0 +1,227 @@
+/*
+ * ====================================================================
+ * The Apache Software License, Version 1.1
+ *
+ * Copyright (c) 2002 The Apache Software Foundation.  All rights
+ * reserved.
+ *
+ * Redistribution and use in source and binary forms, with or without
+ * modification, are permitted provided that the following conditions
+ * are met:
+ *
+ * 1. Redistributions of source code must retain the above copyright
+ * notice, this list of conditions and the following disclaimer.
+ *
+ * 2. Redistributions in binary form must reproduce the above copyright
+ * notice, this list of conditions and the following disclaimer in
+ * the documentation and/or other materials provided with the
+ * distribution.
+ *
+ * 3. The end-user documentation included with the redistribution,
+ * if any, must include the following acknowledgment:
+ * "This product includes software developed by the
+ * Apache Software Foundation (http://www.apache.org/)."
+ * Alternately, this acknowledgment may appear in the software itself,
+ * if and wherever such third-party acknowledgments normally appear.
+ *
+ * 4. The names "Apache" and "Apache Software Foundation" and
+ * "Apache JMeter" must not be used to endorse or promote products
+ * derived from this software without prior written permission. For
+ * written permission, please contact apache@apache.org.
+ *
+ * 5. Products derived from this software may not be called "Apache",
+ * "Apache JMeter", nor may "Apache" appear in their name, without
+ * prior written permission of the Apache Software Foundation.
+ *
+ * THIS SOFTWARE IS PROVIDED ``AS IS'' AND ANY EXPRESSED OR IMPLIED
+ * WARRANTIES, INCLUDING, BUT NOT LIMITED TO, THE IMPLIED WARRANTIES
+ * OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE ARE
+ * DISCLAIMED.  IN NO EVENT SHALL THE APACHE SOFTWARE FOUNDATION OR
+ * ITS CONTRIBUTORS BE LIABLE FOR ANY DIRECT, INDIRECT, INCIDENTAL,
+ * SPECIAL, EXEMPLARY, OR CONSEQUENTIAL DAMAGES (INCLUDING, BUT NOT
+ * LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES; LOSS OF
+ * USE, DATA, OR PROFITS; OR BUSINESS INTERRUPTION) HOWEVER CAUSED AND
+ * ON ANY THEORY OF LIABILITY, WHETHER IN CONTRACT, STRICT LIABILITY,
+ * OR TORT (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT
+ * OF THE USE OF THIS SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF
+ * SUCH DAMAGE.
+ * ====================================================================
+ *
+ * This software consists of voluntary contributions made by many
+ * individuals on behalf of the Apache Software Foundation.  For more
+ * information on the Apache Software Foundation, please see
+ * <http://www.apache.org/>.
+ */
+ 
+package org.apache.jmeter.timers.gui;
+
+import java.awt.Font;
+import java.awt.event.KeyEvent;
+import java.awt.event.KeyListener;
+
+import javax.swing.JLabel;
+import javax.swing.JOptionPane;
+import javax.swing.JPanel;
+import javax.swing.JTextField;
+import javax.swing.border.Border;
+import javax.swing.border.EmptyBorder;
+
+import org.apache.jmeter.testelement.TestElement;
+import org.apache.jmeter.timers.ConstantThroughputTimer;
+import org.apache.jmeter.util.JMeterUtils;
+import org.apache.jorphan.gui.layout.VerticalLayout;
+
+/**
+ * GUI for the Constant Throughput Timer.
+ *
+ * @author <a href="mailto:jsalvata@atg.com">Jordi Salvat i Alabart</a>
+ * @author <a href="mailto:seade@backstagetech.com.au">Scott Eade</a>
+ * @version $Id: ConstantThroughputTimerGui.java,v 1.3 2003/01/10 13:59:50 seade Exp $
+ */
+public class ConstantThroughputTimerGui
+	extends AbstractTimerGui
+	implements KeyListener
+{
+    private final String DEFAULT_THROUGHPUT = "60";
+    private final String THROUGHPUT_FIELD = "Throughput Field";
+
+    private JTextField throughputField;
+
+    /**
+     * Constructor for an initialized but unconfigured
+     * ConstantThroughputTimerGui.
+     */
+    public ConstantThroughputTimerGui()
+    {
+		init();
+    }
+
+	/**
+	 * Get the title to display for this component.
+	 * 
+	 * @see org.apache.jmeter.gui.JMeterGUIComponent#getStaticLabel()
+	 */
+    public String getStaticLabel()
+    {
+		return JMeterUtils.getResString("constant_throughput_timer_title");
+    }
+
+	/**
+	 * Create the test element underlying this GUI component.
+	 * 
+	 * @see org.apache.jmeter.gui.JMeterGUIComponent#createTestElement()
+	 */
+    public TestElement createTestElement()
+    {
+		ConstantThroughputTimer timer = new ConstantThroughputTimer();
+		this.configureTestElement(timer);
+		timer.setThroughput(Long.parseLong(throughputField.getText()));
+		return timer;
+    }
+
+	/**
+	 * Configure this GUI component from the underlying TestElement.
+	 * 
+	 * @see org.apache.jmeter.gui.JMeterGUIComponent#configure(TestElement)
+	 */
+    public void configure(TestElement el)
+    {
+		super.configure(el);
+		ConstantThroughputTimer e= (ConstantThroughputTimer)el;
+		throughputField.setText(String.valueOf(e.getThroughput()));
+    }
+
+    /**
+     * Checks the key just entered in the Throughput text input field makes a
+     * valid number, cleans the input field otherwise.
+     *
+     * @param e  KeyEvent - handled only if it happens in the Throughput field.
+     */
+    public void keyReleased(KeyEvent e)
+    {
+		String n = e.getComponent().getName();
+		if(n.equals(THROUGHPUT_FIELD))
+		{
+		    try
+		    {
+			Long.parseLong(throughputField.getText());
+		    }
+		    catch(NumberFormatException nfe)
+		    {
+			if(throughputField.getText().length() > 0)
+			{
+			    JOptionPane.showMessageDialog(this,
+				    "You must enter a valid number",
+				    "Invalid data", JOptionPane.WARNING_MESSAGE);
+			    // We reset the text to be an empty string instead
+			    // of the default value. If we reset it to the
+			    // default value, then the user has to delete
+			    // that value and reenter his/her own. That's
+			    // too much trouble for the user.
+			}
+		    }
+		}
+    }
+
+	/**
+	 * Process a KeyEvent.
+	 *
+	 * @param e the event to handle.
+	 */
+    public void keyPressed(KeyEvent e)
+    {
+    }
+
+	/**
+	 * Process a KeyEvent.
+	 *
+	 * @param e the event to handle.
+	 */
+    public void keyTyped(KeyEvent e)
+    {
+    }
+
+    /**
+     * Initializes this GUI component. Creates and lays out all GUI elements.
+     */
+    private void init()
+    {
+		this.setLayout(new VerticalLayout(5, VerticalLayout.LEFT,
+			    			  VerticalLayout.TOP));
+	
+		// MAIN PANEL
+		JPanel mainPanel = new JPanel();
+		Border margin = new EmptyBorder(10, 10, 5, 10);
+		mainPanel.setBorder(margin);
+		mainPanel.setLayout(new VerticalLayout(5, VerticalLayout.LEFT));
+	
+		// TITLE
+		JLabel panelTitleLabel = new JLabel(
+			JMeterUtils.getResString("constant_throughput_timer_title"));
+		Font curFont = panelTitleLabel.getFont();
+		int curFontSize = curFont.getSize();
+		curFontSize += 4;
+		panelTitleLabel.setFont(new Font(curFont.getFontName(),
+			    curFont.getStyle(), curFontSize));
+		mainPanel.add(panelTitleLabel);
+	
+		// NAME
+		mainPanel.add(getNamePanel());
+	
+		// throughput
+		JPanel throughputPanel = new JPanel();
+		JLabel throughputLabel = new JLabel(
+		      JMeterUtils.getResString("constant_throughput_timer_throughput"));
+		throughputPanel.add(throughputLabel);
+		throughputField = new JTextField(6);
+		throughputField.setText(DEFAULT_THROUGHPUT);
+		throughputPanel.add(throughputField);
+		mainPanel.add(throughputPanel);
+	
+		throughputField.addKeyListener(this);
+		throughputField.setName(THROUGHPUT_FIELD);
+	
+		this.add(mainPanel);
+    }
+    
+}
diff --git a/jakarta-jmeter/src/components/org/apache/jmeter/timers/gui/ConstantTimerGui.java b/jakarta-jmeter/src/components/org/apache/jmeter/timers/gui/ConstantTimerGui.java
index db56164..d2da54a 100644
--- a/jakarta-jmeter/src/components/org/apache/jmeter/timers/gui/ConstantTimerGui.java
+++ b/jakarta-jmeter/src/components/org/apache/jmeter/timers/gui/ConstantTimerGui.java
@@ -52,114 +52,98 @@
  * information on the Apache Software Foundation, please see
  * <http://www.apache.org/>.
  */
+
 package org.apache.jmeter.timers.gui;
-import java.awt.*;
-import java.awt.event.*;
-import javax.swing.*;
-import javax.swing.border.*;
-import org.apache.jmeter.gui.*;
-import org.apache.jmeter.gui.util.VerticalLayout;
-import org.apache.jmeter.timers.*;
-import org.apache.jmeter.util.*;
+
+import java.awt.Font;
+
+import javax.swing.JComponent;
+import javax.swing.JLabel;
+import javax.swing.JOptionPane;
+import javax.swing.JPanel;
+import javax.swing.JTextField;
+import javax.swing.border.Border;
+import javax.swing.border.EmptyBorder;
+
 import org.apache.jmeter.testelement.TestElement;
+import org.apache.jmeter.timers.ConstantTimer;
+import org.apache.jmeter.util.JMeterUtils;
+import org.apache.jorphan.gui.layout.VerticalLayout;
 
-/****************************************
- * Title: JMeter Description: Copyright: Copyright (c) 2000 Company: Apache
+/**
+ * The GUI for ConstantTimer. 
  *
- *@author    Michael Stover
- *@created   $Date: 2002/08/11 19:24:41 $
- *@version   1.0
- ***************************************/
-
-public class ConstantTimerGui extends AbstractTimerGui implements KeyListener
+ * @author Michael Stover
+ * @author <a href="mailto:seade@backstagetech.com.au">Scott Eade</a>
+ * @version $Id: ConstantTimerGui.java,v 1.4 2003/01/10 13:59:50 seade Exp $
+ */
+public class ConstantTimerGui extends AbstractTimerGui 
 {
+	/**
+	 * The default value for the delay.
+	 */
 	private final String DEFAULT_DELAY = "300";
 
 	private final String DELAY_FIELD = "Delay Field";
+
 	private JTextField delayField;
 
-	/****************************************
-	 * !ToDo (Constructor description)
-	 ***************************************/
+	/**
+	 * No-arg constructor.
+	 */
 	public ConstantTimerGui()
 	{
 		init();
 	}
 
-	/****************************************
-	 * !ToDo (Method description)
+	/**
+	 * Handle an error.
 	 *
-	 *@param e        !ToDo (Parameter description)
-	 *@param thrower  !ToDo (Parameter description)
-	 ***************************************/
+	 * @param e the Exception that was thrown.
+	 * @param thrower the JComponent that threw the Exception.
+	 */
 	public static void error(Exception e, JComponent thrower)
 	{
 		JOptionPane.showMessageDialog(thrower, e, "Error", JOptionPane.ERROR_MESSAGE);
 	}
 
+	/**
+	 * Get the title to display for this component.
+	 * 
+	 * @see org.apache.jmeter.gui.JMeterGUIComponent#getStaticLabel()
+	 */
 	public String getStaticLabel()
 	{
 		return JMeterUtils.getResString("constant_timer_title");
 	}
 
+	/**
+	 * Create the test element underlying this GUI component.
+	 * 
+	 * @see org.apache.jmeter.gui.JMeterGUIComponent#createTestElement()
+	 */
 	public TestElement createTestElement()
 	{
 		ConstantTimer timer = new ConstantTimer();
 		this.configureTestElement(timer);
-		timer.setDelay(Long.parseLong(delayField.getText()));
+		timer.setDelay(delayField.getText());
 		return timer;
 	}
 
+	/**
+	 * Configure this GUI component from the underlying TestElement.
+	 * 
+	 * @see org.apache.jmeter.gui.JMeterGUIComponent#configure(TestElement)
+	 */
 	public void configure(TestElement el)
 	{
 		super.configure(el);
-		delayField.setText(((ConstantTimer)el).getDelay()+"");
-	}
-
-	/****************************************
-	 * !ToDo (Method description)
-	 *
-	 *@param e  !ToDo (Parameter description)
-	 ***************************************/
-	public void keyReleased(KeyEvent e)
-	{
-		String n = e.getComponent().getName();
-		if(n.equals(DELAY_FIELD))
-		{
-			try
-			{
-				Long.parseLong(delayField.getText());
-			}
-			catch(NumberFormatException nfe)
-			{
-				if(delayField.getText().length() > 0)
-				{
-					JOptionPane.showMessageDialog(this, "You must enter a valid number",
-							"Invalid data", JOptionPane.WARNING_MESSAGE);
-					// We reset the text to be an empty string instead
-					// of the default value. If we reset it to the
-					// default value, then the user has to delete
-					// that value and reenter his/her own. That's
-					// too much trouble for the user.
-				}
-			}
-		}
+		delayField.setText(((ConstantTimer)el).getDelay());
 	}
 
-	/****************************************
-	 * !ToDo (Method description)
-	 *
-	 *@param e  !ToDo (Parameter description)
-	 ***************************************/
-	public void keyPressed(KeyEvent e) { }
-
-	/****************************************
-	 * !ToDo (Method description)
-	 *
-	 *@param e  !ToDo (Parameter description)
-	 ***************************************/
-	public void keyTyped(KeyEvent e) { }
-
+	/**
+	 * Initialize this component.
+	 */
 	private void init()
 	{
 		this.setLayout(new VerticalLayout(5, VerticalLayout.LEFT, VerticalLayout.TOP));
@@ -185,14 +169,13 @@ public class ConstantTimerGui extends AbstractTimerGui implements KeyListener
 		JPanel delayPanel = new JPanel();
 		JLabel delayLabel = new JLabel(JMeterUtils.getResString("constant_timer_delay"));
 		delayPanel.add(delayLabel);
-		delayField = new JTextField(6);
+		delayField = new JTextField(20);
 		delayField.setText(DEFAULT_DELAY);
 		delayPanel.add(delayField);
 		mainPanel.add(delayPanel);
-
-		delayField.addKeyListener(this);
 		delayField.setName(DELAY_FIELD);
 
 		this.add(mainPanel);
 	}
+	
 }
diff --git a/jakarta-jmeter/src/components/org/apache/jmeter/timers/gui/GaussianRandomTimerGui.java b/jakarta-jmeter/src/components/org/apache/jmeter/timers/gui/GaussianRandomTimerGui.java
index 44a98c4..28acce9 100644
--- a/jakarta-jmeter/src/components/org/apache/jmeter/timers/gui/GaussianRandomTimerGui.java
+++ b/jakarta-jmeter/src/components/org/apache/jmeter/timers/gui/GaussianRandomTimerGui.java
@@ -52,26 +52,37 @@
  * information on the Apache Software Foundation, please see
  * <http://www.apache.org/>.
  */
+ 
 package org.apache.jmeter.timers.gui;
-import java.awt.*;
-import java.awt.event.*;
-import javax.swing.*;
-import javax.swing.border.*;
-import org.apache.jmeter.gui.*;
+
+import java.awt.Font;
+import java.awt.event.KeyEvent;
+import java.awt.event.KeyListener;
+
+import javax.swing.BorderFactory;
+import javax.swing.JComponent;
+import javax.swing.JLabel;
+import javax.swing.JOptionPane;
+import javax.swing.JPanel;
+import javax.swing.JTextField;
+import javax.swing.border.Border;
+import javax.swing.border.CompoundBorder;
+import javax.swing.border.EmptyBorder;
+
 import org.apache.jmeter.gui.util.FocusRequester;
-import org.apache.jmeter.gui.util.VerticalLayout;
-import org.apache.jmeter.timers.*;
-import org.apache.jmeter.util.*;
 import org.apache.jmeter.testelement.TestElement;
+import org.apache.jmeter.timers.GaussianRandomTimer;
+import org.apache.jmeter.timers.RandomTimer;
+import org.apache.jmeter.util.JMeterUtils;
+import org.apache.jorphan.gui.layout.VerticalLayout;
 
-/****************************************
- * Title: JMeter Description: Copyright: Copyright (c) 2000 Company: Apache
+/**
+ * Implementation of a gaussian random timer.
  *
- *@author    Michael Stover
- *@created   $Date: 2002/08/11 19:24:41 $
- *@version   1.0
- ***************************************/
-
+ * @author    Michael Stover
+ * @author <a href="mailto:seade@backstagetech.com.au">Scott Eade</a>
+ * @version $Id: GaussianRandomTimerGui.java,v 1.4 2003/01/10 13:59:50 seade Exp $
+ */
 public class GaussianRandomTimerGui extends AbstractTimerGui implements KeyListener
 {
 
@@ -84,34 +95,44 @@ public class GaussianRandomTimerGui extends AbstractTimerGui implements KeyListe
 	private JTextField delayField;
 	private JTextField rangeField;
 
-	/****************************************
-	 * !ToDo (Constructor description)
-	 ***************************************/
+	/**
+	 * No-arg constructor.
+	 */
 	public GaussianRandomTimerGui()
 	{
 		init();
 	}
 
-	/****************************************
-	 * !ToDo (Method description)
+	/**
+	 * Handle an error.
 	 *
-	 *@param e        !ToDo (Parameter description)
-	 *@param thrower  !ToDo (Parameter description)
-	 ***************************************/
+	 * @param e the Exception that was thrown.
+	 * @param thrower the JComponent that threw the Exception.
+	 */
 	public static void error(Exception e, JComponent thrower)
 	{
 		JOptionPane.showMessageDialog(thrower, e, "Error", JOptionPane.ERROR_MESSAGE);
 	}
 
+	/**
+	 * Create the test element underlying this GUI component.
+	 * 
+	 * @see org.apache.jmeter.gui.JMeterGUIComponent#createTestElement()
+	 */
 	public TestElement createTestElement()
 	{
 		RandomTimer timer = new GaussianRandomTimer();
 		this.configureTestElement(timer);
-		timer.setDelay(Long.parseLong(delayField.getText()));
+		timer.setDelay(delayField.getText());
 		timer.setRange(Double.parseDouble(rangeField.getText()));
 		return timer;
 	}
 
+	/**
+	 * Configure this GUI component from the underlying TestElement.
+	 * 
+	 * @see org.apache.jmeter.gui.JMeterGUIComponent#configure(TestElement)
+	 */
 	public void configure(TestElement el)
 	{
 		super.configure(el);
@@ -119,36 +140,26 @@ public class GaussianRandomTimerGui extends AbstractTimerGui implements KeyListe
 		rangeField.setText(el.getProperty(RandomTimer.RANGE).toString());
 	}
 
+	/**
+	 * Get the title to display for this component.
+	 * 
+	 * @see org.apache.jmeter.gui.JMeterGUIComponent#getStaticLabel()
+	 */
 	public String getStaticLabel()
 	{
 		return JMeterUtils.getResString("gaussian_timer_title");
 	}
 
-	/****************************************
-	 * !ToDo (Method description)
+	/**
+	 * Process a KeyEvent.
 	 *
-	 *@param e  !ToDo (Parameter description)
-	 ***************************************/
+	 * @param e the event to handle.
+	 */
 	public void keyReleased(KeyEvent e)
 	{
 		String temp = e.getComponent().getName();
 
-		if(temp.equals(DELAY_FIELD))
-		{
-			try
-			{
-				Long.parseLong(delayField.getText());
-			}
-			catch(NumberFormatException nfe)
-			{
-				if(delayField.getText().length() > 0)
-				{
-					JOptionPane.showMessageDialog(this, "You must enter a valid number",
-							"Invalid data", JOptionPane.WARNING_MESSAGE);
-				}
-			}
-		}
-		else if(temp.equals(RANGE_FIELD))
+		if(temp.equals(RANGE_FIELD))
 		{
 			try
 			{
@@ -165,20 +176,27 @@ public class GaussianRandomTimerGui extends AbstractTimerGui implements KeyListe
 		}
 	}
 
-	/****************************************
-	 * !ToDo (Method description)
+	/**
+	 * Process a KeyEvent.
 	 *
-	 *@param e  !ToDo (Parameter description)
-	 ***************************************/
-	public void keyPressed(KeyEvent e) { }
+	 * @param e the event to handle.
+	 */
+	public void keyPressed(KeyEvent e) 
+	{ 
+	}
 
-	/****************************************
-	 * !ToDo (Method description)
+	/**
+	 * Process a KeyEvent.
 	 *
-	 *@param e  !ToDo (Parameter description)
-	 ***************************************/
-	public void keyTyped(KeyEvent e) { }
+	 * @param e the event to handle.
+	 */
+	public void keyTyped(KeyEvent e) 
+	{ 
+	}
 
+	/**
+	 * Initialize this component.
+	 */
 	private void init()
 	{
 		this.setLayout(new VerticalLayout(5, VerticalLayout.LEFT, VerticalLayout.TOP));
@@ -222,7 +240,7 @@ public class GaussianRandomTimerGui extends AbstractTimerGui implements KeyListe
 		JPanel avgDelayPanel = new JPanel();
 		JLabel delayLabel = new JLabel(JMeterUtils.getResString("gaussian_timer_delay"));
 		avgDelayPanel.add(delayLabel);
-		delayField = new JTextField(6);
+		delayField = new JTextField(20);
 		delayField.setText(DEFAULT_DELAY);
 		delayField.setName(DELAY_FIELD);
 		delayField.addKeyListener(this);
@@ -234,4 +252,5 @@ public class GaussianRandomTimerGui extends AbstractTimerGui implements KeyListe
 		// Set the initial focus to the delay field
 		new FocusRequester(rangeField);
 	}
+	
 }
diff --git a/jakarta-jmeter/src/components/org/apache/jmeter/timers/gui/UniformRandomTimerGui.java b/jakarta-jmeter/src/components/org/apache/jmeter/timers/gui/UniformRandomTimerGui.java
index 3c3bdfb..32edeb6 100644
--- a/jakarta-jmeter/src/components/org/apache/jmeter/timers/gui/UniformRandomTimerGui.java
+++ b/jakarta-jmeter/src/components/org/apache/jmeter/timers/gui/UniformRandomTimerGui.java
@@ -52,26 +52,37 @@
  * information on the Apache Software Foundation, please see
  * <http://www.apache.org/>.
  */
+ 
 package org.apache.jmeter.timers.gui;
-import java.awt.*;
-import java.awt.event.*;
-import javax.swing.*;
-import javax.swing.border.*;
-import org.apache.jmeter.gui.*;
+
+import java.awt.Font;
+import java.awt.event.KeyEvent;
+import java.awt.event.KeyListener;
+
+import javax.swing.BorderFactory;
+import javax.swing.JComponent;
+import javax.swing.JLabel;
+import javax.swing.JOptionPane;
+import javax.swing.JPanel;
+import javax.swing.JTextField;
+import javax.swing.border.Border;
+import javax.swing.border.CompoundBorder;
+import javax.swing.border.EmptyBorder;
+
 import org.apache.jmeter.gui.util.FocusRequester;
-import org.apache.jmeter.gui.util.VerticalLayout;
-import org.apache.jmeter.timers.*;
-import org.apache.jmeter.util.*;
 import org.apache.jmeter.testelement.TestElement;
+import org.apache.jmeter.timers.RandomTimer;
+import org.apache.jmeter.timers.UniformRandomTimer;
+import org.apache.jmeter.util.JMeterUtils;
+import org.apache.jorphan.gui.layout.VerticalLayout;
 
-/****************************************
- * Title: JMeter Description: Copyright: Copyright (c) 2000 Company: Apache
+/**
+ * Implementation of a uniform random timer.
  *
- *@author    Michael Stover
- *@created   $Date: 2002/08/11 19:24:41 $
- *@version   1.0
- ***************************************/
-
+ * @author    Michael Stover
+ * @author <a href="mailto:seade@backstagetech.com.au">Scott Eade</a>
+ * @version $Id: UniformRandomTimerGui.java,v 1.4 2003/01/10 13:59:50 seade Exp $
+ */
 public class UniformRandomTimerGui extends AbstractTimerGui implements KeyListener
 {
 
@@ -84,39 +95,54 @@ public class UniformRandomTimerGui extends AbstractTimerGui implements KeyListen
 	private JTextField delayField;
 	private JTextField rangeField;
 
-	/****************************************
-	 * !ToDo (Constructor description)
-	 ***************************************/
+	/**
+	 * No-arg constructor.
+	 */
 	public UniformRandomTimerGui()
 	{
 		init();
 	}
 
-	/****************************************
-	 * !ToDo (Method description)
+	/**
+	 * Handle an error.
 	 *
-	 *@param e        !ToDo (Parameter description)
-	 *@param thrower  !ToDo (Parameter description)
-	 ***************************************/
+	 * @param e the Exception that was thrown.
+	 * @param thrower the JComponent that threw the Exception.
+	 */
 	public static void error(Exception e, JComponent thrower)
 	{
 		JOptionPane.showMessageDialog(thrower, e, "Error", JOptionPane.ERROR_MESSAGE);
 	}
 
+	/**
+	 * Get the title to display for this component.
+	 * 
+	 * @see org.apache.jmeter.gui.JMeterGUIComponent#getStaticLabel()
+	 */
 	public String getStaticLabel()
 	{
 		return JMeterUtils.getResString("uniform_timer_title");
 	}
 
+	/**
+	 * Create the test element underlying this GUI component.
+	 * 
+	 * @see org.apache.jmeter.gui.JMeterGUIComponent#createTestElement()
+	 */
 	public TestElement createTestElement()
 	{
 		RandomTimer timer = new UniformRandomTimer();
 		this.configureTestElement(timer);
-		timer.setDelay(Long.parseLong(delayField.getText()));
+		timer.setDelay(delayField.getText());
 		timer.setRange(Double.parseDouble(rangeField.getText()));
 		return timer;
 	}
 
+	/**
+	 * Configure this GUI component from the underlying TestElement.
+	 * 
+	 * @see org.apache.jmeter.gui.JMeterGUIComponent#configure(TestElement)
+	 */
 	public void configure(TestElement el)
 	{
 		super.configure(el);
@@ -124,32 +150,16 @@ public class UniformRandomTimerGui extends AbstractTimerGui implements KeyListen
 		rangeField.setText(el.getProperty(RandomTimer.RANGE).toString());
 	}
 
-
-	/****************************************
-	 * !ToDo (Method description)
+	/**
+	 * Process a KeyEvent.
 	 *
-	 *@param e  !ToDo (Parameter description)
-	 ***************************************/
+	 * @param e the event to handle.
+	 */
 	public void keyReleased(KeyEvent e)
 	{
 		String temp = e.getComponent().getName();
 
-		if(temp.equals(DELAY_FIELD))
-		{
-			try
-			{
-				Long.parseLong(delayField.getText());
-			}
-			catch(NumberFormatException nfe)
-			{
-				if(delayField.getText().length() > 0)
-				{
-					JOptionPane.showMessageDialog(this, "You must enter a valid number",
-							"Invalid data", JOptionPane.WARNING_MESSAGE);
-				}
-			}
-		}
-		else if(temp.equals(RANGE_FIELD))
+		if (temp.equals(RANGE_FIELD))
 		{
 			try
 			{
@@ -166,20 +176,27 @@ public class UniformRandomTimerGui extends AbstractTimerGui implements KeyListen
 		}
 	}
 
-	/****************************************
-	 * !ToDo (Method description)
+	/**
+	 * Process a KeyEvent.
 	 *
-	 *@param e  !ToDo (Parameter description)
-	 ***************************************/
-	public void keyPressed(KeyEvent e) { }
+	 * @param e the event to handle.
+	 */
+	public void keyPressed(KeyEvent e) 
+	{ 
+	}
 
-	/****************************************
-	 * !ToDo (Method description)
+	/**
+	 * Process a KeyEvent.
 	 *
-	 *@param e  !ToDo (Parameter description)
-	 ***************************************/
-	public void keyTyped(KeyEvent e) { }
+	 * @param e the event to handle.
+	 */
+	public void keyTyped(KeyEvent e) 
+	{ 
+	}
 
+	/**
+	 * Initialize this component.
+	 */
 	private void init()
 	{
 		this.setLayout(new VerticalLayout(5, VerticalLayout.LEFT, VerticalLayout.TOP));
@@ -223,7 +240,7 @@ public class UniformRandomTimerGui extends AbstractTimerGui implements KeyListen
 		JPanel avgDelayPanel = new JPanel();
 		JLabel delayLabel = new JLabel(JMeterUtils.getResString("uniform_timer_delay"));
 		avgDelayPanel.add(delayLabel);
-		delayField = new JTextField(6);
+		delayField = new JTextField(20);
 		delayField.setText(DEFAULT_DELAY);
 		delayField.setName(DELAY_FIELD);
 		delayField.addKeyListener(this);
@@ -235,4 +252,5 @@ public class UniformRandomTimerGui extends AbstractTimerGui implements KeyListen
 		// Set the initial focus to the range field
 		new FocusRequester(rangeField);
 	}
+	
 }
diff --git a/jakarta-jmeter/src/components/org/apache/jmeter/visualizers/AccumListener.java b/jakarta-jmeter/src/components/org/apache/jmeter/visualizers/AccumListener.java
new file mode 100644
index 0000000..1a2d6d0
--- /dev/null
+++ b/jakarta-jmeter/src/components/org/apache/jmeter/visualizers/AccumListener.java
@@ -0,0 +1,12 @@
+package org.apache.jmeter.visualizers;
+/**
+ * @author Administrator
+ *
+ * To change this generated comment edit the template variable "typecomment":
+ * Window>Preferences>Java>Templates.
+ */
+public interface AccumListener
+{
+	
+	public void updateGui(RunningSample s);
+}
diff --git a/jakarta-jmeter/src/components/org/apache/jmeter/visualizers/AssertionVisualizer.java b/jakarta-jmeter/src/components/org/apache/jmeter/visualizers/AssertionVisualizer.java
index 94c9269..7ca8d7f 100644
--- a/jakarta-jmeter/src/components/org/apache/jmeter/visualizers/AssertionVisualizer.java
+++ b/jakarta-jmeter/src/components/org/apache/jmeter/visualizers/AssertionVisualizer.java
@@ -53,26 +53,32 @@
  * <http://www.apache.org/>.
  */
 package org.apache.jmeter.visualizers;
+import java.awt.BorderLayout;
 import java.awt.Font;
-import java.util.*;
-import javax.swing.*;
-import javax.swing.border.*;
+import java.util.Arrays;
+import java.util.Iterator;
+import java.util.List;
+
+import javax.swing.JLabel;
+import javax.swing.JPanel;
+import javax.swing.JScrollPane;
+import javax.swing.JTextArea;
+import javax.swing.border.Border;
+import javax.swing.border.EmptyBorder;
+
 import org.apache.jmeter.assertions.AssertionResult;
-import org.apache.jmeter.gui.*;
-import org.apache.jmeter.gui.util.VerticalLayout;
-import org.apache.jmeter.reporters.ResultCollector;
 import org.apache.jmeter.samplers.Clearable;
 import org.apache.jmeter.samplers.SampleResult;
-import org.apache.jmeter.testelement.TestElement;
 import org.apache.jmeter.util.JMeterUtils;
 import org.apache.jmeter.visualizers.gui.AbstractVisualizer;
+import org.apache.jorphan.gui.layout.VerticalLayout;
 
 /****************************************
  * Title: Jakarta-JMeter Description: Copyright: Copyright (c) 2001 Company:
  * Apache
  *
  *@author    Michael Stover
- *@created   $Date: 2002/08/12 13:18:10 $
+ *@created   $Date: 2002/10/17 19:47:15 $
  *@version   1.0
  ***************************************/
 
@@ -147,7 +153,7 @@ public class AssertionVisualizer extends AbstractVisualizer implements Clearable
 
 	private void init()
 	{
-		this.setLayout(new VerticalLayout(5, VerticalLayout.LEFT, VerticalLayout.TOP));
+		this.setLayout(new BorderLayout());
 
 		// MAIN PANEL
 		JPanel mainPanel = new JPanel();
@@ -179,8 +185,8 @@ public class AssertionVisualizer extends AbstractVisualizer implements Clearable
 		areaScrollPane.setVerticalScrollBarPolicy(JScrollPane.VERTICAL_SCROLLBAR_ALWAYS);
 		areaScrollPane.setHorizontalScrollBarPolicy(JScrollPane.HORIZONTAL_SCROLLBAR_AS_NEEDED);
 		//areaScrollPane.setPreferredSize(new Dimension(250, 250));
-		mainPanel.add(areaScrollPane);
 
-		this.add(mainPanel);
+		this.add(mainPanel,BorderLayout.NORTH);
+		this.add(areaScrollPane,BorderLayout.CENTER);
 	}
 }
diff --git a/jakarta-jmeter/src/components/org/apache/jmeter/visualizers/CVS/Entries b/jakarta-jmeter/src/components/org/apache/jmeter/visualizers/CVS/Entries
index 2d9e13f..db3bf04 100644
--- a/jakarta-jmeter/src/components/org/apache/jmeter/visualizers/CVS/Entries
+++ b/jakarta-jmeter/src/components/org/apache/jmeter/visualizers/CVS/Entries
@@ -1,22 +1,27 @@
-/AssertionVisualizer.java/1.2/Mon Aug 12 13:18:10 2002//Tv1_7_3
-/BarVisualizer.java/1.1/Sun Aug 11 19:24:41 2002//Tv1_7_3
-/Graph.java/1.1/Sun Aug 11 19:24:41 2002//Tv1_7_3
-/GraphAccum.java/1.1/Sun Aug 11 19:24:41 2002//Tv1_7_3
-/GraphAccumModel.java/1.1/Sun Aug 11 19:24:41 2002//Tv1_7_3
-/GraphAccumVisualizer.java/1.1/Sun Aug 11 19:24:41 2002//Tv1_7_3
-/GraphModel.java/1.1/Sun Aug 11 19:24:41 2002//Tv1_7_3
-/GraphVisualizer.java/1.1/Sun Aug 11 19:24:41 2002//Tv1_7_3
-/MailerVisualizer.java/1.1/Sun Aug 11 19:24:41 2002//Tv1_7_3
-/RunningSample.java/1.2/Wed Aug 14 16:38:44 2002//Tv1_7_3
-/Sample.java/1.1/Sun Aug 11 19:24:41 2002//Tv1_7_3
-/Spline3.java/1.1/Sun Aug 11 19:24:41 2002//Tv1_7_3
-/SplineModel.java/1.1/Sun Aug 11 19:24:41 2002//Tv1_7_3
-/SplineVisualizer.java/1.1/Sun Aug 11 19:24:41 2002//Tv1_7_3
-/StatVisualizer.java/1.1/Sun Aug 11 19:24:41 2002//Tv1_7_3
-/StatVisualizerModel.java/1.2/Wed Aug 14 16:38:44 2002//Tv1_7_3
-/TableDataModel.java/1.1/Sun Aug 11 19:24:41 2002//Tv1_7_3
-/TableVisualizer.java/1.1/Sun Aug 11 19:24:41 2002//Tv1_7_3
-/TreeVisualizer.java/1.1/Sun Aug 11 19:24:41 2002//Tv1_7_3
-/ViewResultsFullVisualizer.java/1.1/Sun Aug 11 19:24:41 2002//Tv1_7_3
-/WindowedVisualizer.java/1.1/Sun Aug 11 19:24:41 2002//Tv1_7_3
+/AccumListener.java/1.1/Sun Dec 29 15:31:45 2002//Tv1_8_1
+/AssertionVisualizer.java/1.5/Thu Oct 17 19:47:15 2002//Tv1_8_1
+/BarVisualizer.java/1.1/Sun Aug 11 19:24:41 2002//Tv1_8_1
+/Graph.java/1.1/Sun Aug 11 19:24:41 2002//Tv1_8_1
+/GraphAccum.java/1.3/Thu Aug 29 18:17:37 2002//Tv1_8_1
+/GraphAccumListener.java/1.1/Sun Dec 29 15:31:45 2002//Tv1_8_1
+/GraphAccumModel.java/1.4/Fri Aug 30 14:43:19 2002//Tv1_8_1
+/GraphAccumVisualizer.java/1.6/Thu Oct 17 19:47:15 2002//Tv1_8_1
+/GraphListener.java/1.1/Sun Dec 29 15:31:45 2002//Tv1_8_1
+/GraphModel.java/1.2/Fri Aug 30 14:43:19 2002//Tv1_8_1
+/GraphVisualizer.java/1.4/Thu Oct 17 19:47:15 2002//Tv1_8_1
+/MailerModel.java/1.3/Thu Aug 29 18:17:37 2002//Tv1_8_1
+/MailerVisualizer.java/1.7/Thu Oct 17 19:47:15 2002//Tv1_8_1
+/ModelListener.java/1.1/Wed Aug 21 23:35:48 2002//Tv1_8_1
+/RunningSample.java/1.6/Thu Dec 26 00:19:31 2002//Tv1_8_1
+/Sample.java/1.2/Fri Aug 30 14:43:19 2002//Tv1_8_1
+/Spline3.java/1.3/Thu Aug 29 18:17:37 2002//Tv1_8_1
+/SplineModel.java/1.1/Sun Aug 11 19:24:41 2002//Tv1_8_1
+/SplineVisualizer.java/1.4/Thu Oct 17 19:47:15 2002//Tv1_8_1
+/StatVisualizer.java/1.8/Tue Jan  7 02:54:50 2003//Tv1_8_1
+/StatVisualizerModel.java/1.6/Thu Dec 26 00:19:31 2002//Tv1_8_1
+/TableDataModel.java/1.7/Thu Jan  2 01:15:32 2003//Tv1_8_1
+/TableVisualizer.java/1.4/Thu Oct 17 19:47:15 2002//Tv1_8_1
+/TreeVisualizer.java/1.3/Thu Aug 29 18:17:37 2002//Tv1_8_1
+/ViewResultsFullVisualizer.java/1.14/Fri Jan 17 21:00:09 2003//Tv1_8_1
+/WindowedVisualizer.java/1.1/Sun Aug 11 19:24:41 2002//Tv1_8_1
 D
diff --git a/jakarta-jmeter/src/components/org/apache/jmeter/visualizers/CVS/Tag b/jakarta-jmeter/src/components/org/apache/jmeter/visualizers/CVS/Tag
index 5f312fe..e2fda28 100644
--- a/jakarta-jmeter/src/components/org/apache/jmeter/visualizers/CVS/Tag
+++ b/jakarta-jmeter/src/components/org/apache/jmeter/visualizers/CVS/Tag
@@ -1 +1 @@
-Nv1_7_3
+Nv1_8_1
diff --git a/jakarta-jmeter/src/components/org/apache/jmeter/visualizers/GraphAccum.java b/jakarta-jmeter/src/components/org/apache/jmeter/visualizers/GraphAccum.java
index 80cf2f6..9af1ae5 100644
--- a/jakarta-jmeter/src/components/org/apache/jmeter/visualizers/GraphAccum.java
+++ b/jakarta-jmeter/src/components/org/apache/jmeter/visualizers/GraphAccum.java
@@ -54,17 +54,26 @@
  */
 package org.apache.jmeter.visualizers;
 
-import javax.swing.*;
-import java.awt.*;
-import java.util.*;
-
-import org.apache.jmeter.gui.*;
-import org.apache.jmeter.samplers.*;
-import org.apache.jmeter.util.*;
-
-import org.apache.jmeter.protocol.http.sampler.HTTPSamplerFull;
-
-import org.apache.log4j.*;
+import java.awt.Color;
+import java.awt.Dimension;
+import java.awt.Graphics;
+import java.awt.GridBagConstraints;
+import java.awt.GridBagLayout;
+import java.awt.Insets;
+import java.awt.Point;
+import java.awt.Rectangle;
+import java.util.Iterator;
+
+import javax.swing.JComponent;
+import javax.swing.JLabel;
+import javax.swing.JPanel;
+import javax.swing.Scrollable;
+import javax.swing.SwingUtilities;
+
+import org.apache.jmeter.samplers.SampleResult;
+import org.apache.jmeter.util.ColorHelper;
+import org.apache.log.Hierarchy;
+import org.apache.log.Logger;
 /**
  *  Draws the graph
  *
@@ -112,8 +121,7 @@ public class GraphAccum extends JComponent implements Scrollable,
 	 *  Description of the Field
 	 */
 	protected final static int PLOT_X_WIDTH = 10;
-	private static Category catClass =
-			Category.getInstance(GraphAccum.class.getName());
+	transient private static Logger log = Hierarchy.getDefaultHierarchy().getLoggerFor("jmeter.gui");
 
 	// Ensure that previousPts is allocated
 
@@ -127,9 +135,9 @@ public class GraphAccum extends JComponent implements Scrollable,
 	 */
 	public GraphAccum()
 	{
-		catClass.debug("Start : GraphAnnum1");
+		log.debug("Start : GraphAnnum1");
 		this.setPreferredSize(new Dimension(width, 800));
-		catClass.debug("End : GraphAnnum1");
+		log.debug("End : GraphAnnum1");
 	}
 
 
@@ -141,9 +149,9 @@ public class GraphAccum extends JComponent implements Scrollable,
 	public GraphAccum(GraphAccumModel model)
 	{
 		this();
-		catClass.debug("Start : GraphAnnum2");
+		log.debug("Start : GraphAnnum2");
 		setModel(model);
-		catClass.debug("End : GraphAnnum2");
+		log.debug("End : GraphAnnum2");
 	}
 
 
@@ -154,11 +162,11 @@ public class GraphAccum extends JComponent implements Scrollable,
 	 */
 	private void setModel(Object model)
 	{
-		catClass.debug("Start : setModel1");
+		log.debug("Start : setModel1");
 		this.model = (GraphAccumModel) model;
 		this.model.addGraphAccumListener(this);
 		repaint();
-		catClass.debug("End : setModel1");
+		log.debug("End : setModel1");
 	}
 
 
@@ -169,9 +177,9 @@ public class GraphAccum extends JComponent implements Scrollable,
 	 */
 	public void setVisualizer(Object visualizer)
 	{
-		if (catClass.isDebugEnabled())
+		if (log.isDebugEnabled())
 		{
-			catClass.debug("setVisualizer1 : Setting visualizer - " + visualizer);
+			log.debug("setVisualizer1 : Setting visualizer - " + visualizer);
 		}
 		this.visualizer = (GraphAccumVisualizer) visualizer;
 	}
@@ -269,9 +277,9 @@ public class GraphAccum extends JComponent implements Scrollable,
 	 */
 	public void updateGui()
 	{
-		catClass.debug("Start : updateGui1");
+		log.debug("Start : updateGui1");
 		repaint();
-		catClass.debug("End : updateGui1");
+		log.debug("End : updateGui1");
 	}
 
 
@@ -282,7 +290,7 @@ public class GraphAccum extends JComponent implements Scrollable,
 	 */
 	public void updateGui(final SampleResult oneSample)
 	{
-		catClass.debug("Start : updateGui2");
+		log.debug("Start : updateGui2");
 		final int xPos = model.getSampleCount();
 		SwingUtilities.invokeLater(
 			new Runnable()
@@ -297,7 +305,7 @@ public class GraphAccum extends JComponent implements Scrollable,
 				}
 			}
 				);
-		catClass.debug("End : updateGui2");
+		log.debug("End : updateGui2");
 	}
 
 
@@ -309,7 +317,7 @@ public class GraphAccum extends JComponent implements Scrollable,
 	public void paintComponent(Graphics g)
 	{
 		super.paintComponent(g);
-		catClass.debug("Start : paintComponent1");
+		log.debug("Start : paintComponent1");
 		Dimension d = this.getSize();
 		synchronized (model.getList())
 		{
@@ -323,7 +331,7 @@ public class GraphAccum extends JComponent implements Scrollable,
 				drawSample(i * PLOT_X_WIDTH, s, g);
 			}
 		}
-		catClass.debug("End : paintComponent1");
+		log.debug("End : paintComponent1");
 	}
 
 
@@ -347,7 +355,7 @@ public class GraphAccum extends JComponent implements Scrollable,
 	 */
 	private void drawSample(int x, SampleResult oneSample, Graphics g)
 	{
-		catClass.debug("Start : drawSample1");
+		log.debug("Start : drawSample1");
 		int lastLevel = 0;
 		// used to keep track of accumulated load times of
 		// components
@@ -378,9 +386,9 @@ public class GraphAccum extends JComponent implements Scrollable,
 		long totalTime = oneSample.getTime();
 		// if the page has other components then set the total time to be that including
 		// all its components' load time
-		if (catClass.isDebugEnabled())
+		if (log.isDebugEnabled())
 		{
-			catClass.debug("drawSample1 : total time - " + totalTime);
+			log.debug("drawSample1 : total time - " + totalTime);
 		}
 		int data = (int) (totalTime * d.height / model.getMax());
 		g.setColor(currColor);
@@ -409,9 +417,9 @@ public class GraphAccum extends JComponent implements Scrollable,
 			legendPanel.add(totalTimeLabel);
 		}
 		// plot the time of the page itself without all its components
-		if (catClass.isDebugEnabled())
+		if (log.isDebugEnabled())
 		{
-			catClass.debug("drawSample1 : main page load time - "
+			log.debug("drawSample1 : main page load time - "
 					 + oneSample.getTime());
 		}
 		data = (int) (oneSample.getTime()
@@ -450,9 +458,9 @@ public class GraphAccum extends JComponent implements Scrollable,
 			for(int i = 0;i < resultList.length;i++)
 			{
 				SampleResult componentRes = (SampleResult) resultList[i];
-				if (catClass.isDebugEnabled())
+				if (log.isDebugEnabled())
 				{
-					catClass.debug("drawSample1 : componentRes - " +
+					log.debug("drawSample1 : componentRes - " +
 							componentRes.getSampleLabel() + " loading time - " +
 							componentRes.getTime());
 				}
@@ -502,6 +510,6 @@ public class GraphAccum extends JComponent implements Scrollable,
 		{
 			previousPtsAlloc = true;
 		}
-		catClass.debug("End : drawSample1");
+		log.debug("End : drawSample1");
 	}
 }
diff --git a/jakarta-jmeter/src/core/org/apache/jmeter/visualizers/GraphAccumListener.java b/jakarta-jmeter/src/components/org/apache/jmeter/visualizers/GraphAccumListener.java
similarity index 100%
rename from jakarta-jmeter/src/core/org/apache/jmeter/visualizers/GraphAccumListener.java
rename to jakarta-jmeter/src/components/org/apache/jmeter/visualizers/GraphAccumListener.java
diff --git a/jakarta-jmeter/src/components/org/apache/jmeter/visualizers/GraphAccumModel.java b/jakarta-jmeter/src/components/org/apache/jmeter/visualizers/GraphAccumModel.java
index 50b223c..1ce6cd0 100644
--- a/jakarta-jmeter/src/components/org/apache/jmeter/visualizers/GraphAccumModel.java
+++ b/jakarta-jmeter/src/components/org/apache/jmeter/visualizers/GraphAccumModel.java
@@ -53,14 +53,16 @@
  */
 package org.apache.jmeter.visualizers;
 
-import org.apache.jmeter.gui.*;
-import java.util.*;
+import java.io.Serializable;
+import java.util.Collections;
+import java.util.Iterator;
+import java.util.LinkedList;
+import java.util.List;
 
-import org.apache.jmeter.samplers.*;
-import org.apache.jmeter.util.JMeterUtils;
-import org.apache.jmeter.protocol.http.sampler.HTTPSamplerFull;
-
-import org.apache.log4j.*;
+import org.apache.jmeter.samplers.Clearable;
+import org.apache.jmeter.samplers.SampleResult;
+import org.apache.log.Hierarchy;
+import org.apache.log.Logger;
 /**
  *  The model that collects the average of the set of pages to be sampled
  *
@@ -69,7 +71,7 @@ import org.apache.log4j.*;
  *@version    1.0
  */
 
-public class GraphAccumModel implements Clearable
+public class GraphAccumModel implements Clearable,Serializable
 {
 	/**
 	 *  Description of the Field
@@ -111,8 +113,7 @@ public class GraphAccumModel implements Clearable
 	 *  Description of the Field
 	 */
 	protected SampleResult current;
-	private Category catClass =
-			Category.getInstance(GraphAccumModel.class.getName());
+	transient private static Logger log = Hierarchy.getDefaultHierarchy().getLoggerFor("jmeter.gui");
 
 
 	/**
@@ -120,10 +121,10 @@ public class GraphAccumModel implements Clearable
 	 */
 	public GraphAccumModel()
 	{
-		catClass.debug("Start : GraphAccumModel1");
+		log.debug("Start : GraphAccumModel1");
 		listeners = new LinkedList();
 		samples = Collections.synchronizedList(new LinkedList());
-		catClass.debug("End : GraphAccumModel1");
+		log.debug("End : GraphAccumModel1");
 	}
 
 
@@ -178,7 +179,7 @@ public class GraphAccumModel implements Clearable
 	 */
 	public long getMax()
 	{
-		catClass.debug("getMax1 : Returning - " + max);
+		log.debug("getMax1 : Returning - " + max);
 		return max;
 	}
 
@@ -200,12 +201,12 @@ public class GraphAccumModel implements Clearable
 	 */
 	public void clear()
 	{
-		catClass.debug("Start : clear1");
+		log.debug("Start : clear1");
 		samples.clear();
 		max = 1;
 		bigChange = true;
 		this.fireDataChanged();
-		catClass.debug("End : clear1");
+		log.debug("End : clear1");
 	}
 
 	/**
@@ -215,14 +216,14 @@ public class GraphAccumModel implements Clearable
 	 */
 	public void addNewSample(SampleResult res)
 	{
-		catClass.debug("Start : addNewSample1");
+		log.debug("Start : addNewSample1");
 		// set time to time taken to load this url without components (e.g. images etc)
 		long totalTime = res.getTime();
 	
-		if (catClass.isDebugEnabled())
+		if (log.isDebugEnabled())
 		{
-			catClass.debug("addNewSample1 : time - " + totalTime);
-			catClass.debug("addNewSample1 : max - " + max);
+			log.debug("addNewSample1 : time - " + totalTime);
+			log.debug("addNewSample1 : max - " + max);
 		}
 		if (totalTime > max)
 		{
@@ -231,7 +232,7 @@ public class GraphAccumModel implements Clearable
 		}
 		current = res;
 		samples.add(res);
-		catClass.debug("End : addNewSample1");
+		log.debug("End : addNewSample1");
 		fireDataChanged();
 	}
 
@@ -242,7 +243,7 @@ public class GraphAccumModel implements Clearable
 	 */
 	protected void fireDataChanged()
 	{
-		catClass.debug("Start : fireDataChanged1");
+		log.debug("Start : fireDataChanged1");
 		Iterator iter = listeners.iterator();
 		if (bigChange)
 		{
@@ -255,7 +256,7 @@ public class GraphAccumModel implements Clearable
 		{
 			quickUpdate(current);
 		}
-		catClass.debug("End : fireDataChanged1");
+		log.debug("End : fireDataChanged1");
 	}
 
 
diff --git a/jakarta-jmeter/src/components/org/apache/jmeter/visualizers/GraphAccumVisualizer.java b/jakarta-jmeter/src/components/org/apache/jmeter/visualizers/GraphAccumVisualizer.java
index 638581e..5320a66 100644
--- a/jakarta-jmeter/src/components/org/apache/jmeter/visualizers/GraphAccumVisualizer.java
+++ b/jakarta-jmeter/src/components/org/apache/jmeter/visualizers/GraphAccumVisualizer.java
@@ -53,18 +53,25 @@
  * <http://www.apache.org/>.
  */
 package org.apache.jmeter.visualizers;
-import java.awt.*;
-import java.awt.event.*;
-import java.util.*;
-import javax.swing.*;
-import javax.swing.border.*;
-import org.apache.jmeter.gui.*;
-import org.apache.jmeter.gui.util.VerticalLayout;
-import org.apache.jmeter.samplers.SampleResult;
+import java.awt.BorderLayout;
+import java.awt.Font;
+import java.awt.Image;
+
+import javax.swing.BorderFactory;
+import javax.swing.JLabel;
+import javax.swing.JPanel;
+import javax.swing.JScrollPane;
+import javax.swing.JSplitPane;
+import javax.swing.border.Border;
+import javax.swing.border.EmptyBorder;
+
 import org.apache.jmeter.samplers.Clearable;
+import org.apache.jmeter.samplers.SampleResult;
 import org.apache.jmeter.util.JMeterUtils;
 import org.apache.jmeter.visualizers.gui.AbstractVisualizer;
-import org.apache.log4j.*;
+import org.apache.log.Hierarchy;
+import org.apache.log.Logger;
+import org.apache.jorphan.gui.layout.VerticalLayout;
 /****************************************
  * This class implements a statistical analyser that plots the accumulated time
  * taken to load each set of pages. The number of plots is equivalent to the
@@ -72,7 +79,7 @@ import org.apache.log4j.*;
  *
  *@author    Khor Soon Hin
  *@created   2001/08/11
- *@version   $Revision: 1.1 $ $Date: 2002/08/11 19:24:41 $
+ *@version   $Revision: 1.6 $ $Date: 2002/10/17 19:47:15 $
  ***************************************/
 public class GraphAccumVisualizer extends AbstractVisualizer
 		 implements ImageVisualizer, GraphAccumListener,Clearable
@@ -81,18 +88,17 @@ public class GraphAccumVisualizer extends AbstractVisualizer
 	/****************************************
 	 * !ToDo (Field description)
 	 ***************************************/
-	protected GraphAccumModel model;
+	protected transient GraphAccumModel model;
 	/****************************************
 	 * !ToDo (Field description)
 	 ***************************************/
-	protected GraphAccum graph;
+	protected transient GraphAccum graph;
 
 	/****************************************
 	 * !ToDo (Field description)
 	 ***************************************/
-	protected JPanel legendPanel;
-	private static Category catClass =
-			Category.getInstance(GraphAccumVisualizer.class.getName());
+	transient protected JPanel legendPanel;
+	transient private static Logger log = Hierarchy.getDefaultHierarchy().getLoggerFor("jmeter.gui");
 
 
 	/****************************************
@@ -104,8 +110,8 @@ public class GraphAccumVisualizer extends AbstractVisualizer
 		model = new GraphAccumModel();
 		model.addGraphAccumListener(this);
 		init();
-		catClass.debug("Start : GraphAccumVisualizer1");
-		catClass.debug("End : GraphAccumVisualizer1");
+		log.debug("Start : GraphAccumVisualizer1");
+		log.debug("End : GraphAccumVisualizer1");
 	}
 
 	/****************************************
@@ -147,10 +153,10 @@ public class GraphAccumVisualizer extends AbstractVisualizer
 	 ***************************************/
 	public Image getImage()
 	{
-		catClass.debug("Start : getImage1");
+		log.debug("Start : getImage1");
 		Image result = graph.createImage(graph.getWidth(), graph.getHeight());
 		graph.paintComponent(result.getGraphics());
-		catClass.debug("End : getImage1");
+		log.debug("End : getImage1");
 		return result;
 	}
 
@@ -160,9 +166,9 @@ public class GraphAccumVisualizer extends AbstractVisualizer
 	 ***************************************/
 	public void updateGui()
 	{
-		catClass.debug("Start : updateGui1");
+		log.debug("Start : updateGui1");
 		graph.updateGui();
-		catClass.debug("End : updateGui1");
+		log.debug("End : updateGui1");
 	}
 
 
@@ -173,8 +179,8 @@ public class GraphAccumVisualizer extends AbstractVisualizer
 	 ***************************************/
 	public void updateGui(SampleResult s)
 	{
-		catClass.debug("Start : updateGui2");
-		catClass.debug("End : updateGui2");
+		log.debug("Start : updateGui2");
+		log.debug("End : updateGui2");
 	}
 
 
@@ -185,9 +191,9 @@ public class GraphAccumVisualizer extends AbstractVisualizer
 	{
 		model.clear();
 		graph.clear();
-		catClass.debug("Start : clear1");
+		log.debug("Start : clear1");
 		repaint();
-		catClass.debug("End : clear1");
+		log.debug("End : clear1");
 	}
 
 
@@ -199,7 +205,7 @@ public class GraphAccumVisualizer extends AbstractVisualizer
 	public String toString()
 	{
 		String toString = "Show the samples analysys as dot plots";
-		catClass.debug("toString1 : Returning - " + toString);
+		log.debug("toString1 : Returning - " + toString);
 		return toString;
 	}
 
@@ -209,7 +215,7 @@ public class GraphAccumVisualizer extends AbstractVisualizer
 	 ***************************************/
 	private void init()
 	{
-		catClass.debug("Start : init1");
+		log.debug("Start : init1");
 		graph = new GraphAccum(model);
 		graph.setVisualizer(this);
 
@@ -245,6 +251,6 @@ public class GraphAccumVisualizer extends AbstractVisualizer
 
 		this.add(mainPanel, BorderLayout.NORTH);
 		this.add(graphSplitPane, BorderLayout.CENTER);
-		catClass.debug("End : init1");
+		log.debug("End : init1");
 	}
 }
diff --git a/jakarta-jmeter/src/core/org/apache/jmeter/visualizers/GraphListener.java b/jakarta-jmeter/src/components/org/apache/jmeter/visualizers/GraphListener.java
similarity index 100%
rename from jakarta-jmeter/src/core/org/apache/jmeter/visualizers/GraphListener.java
rename to jakarta-jmeter/src/components/org/apache/jmeter/visualizers/GraphListener.java
diff --git a/jakarta-jmeter/src/components/org/apache/jmeter/visualizers/GraphModel.java b/jakarta-jmeter/src/components/org/apache/jmeter/visualizers/GraphModel.java
index 4afec67..d0a319e 100644
--- a/jakarta-jmeter/src/components/org/apache/jmeter/visualizers/GraphModel.java
+++ b/jakarta-jmeter/src/components/org/apache/jmeter/visualizers/GraphModel.java
@@ -55,13 +55,14 @@
 package org.apache.jmeter.visualizers;
 
 
-import org.apache.jmeter.gui.*;
+import java.io.Serializable;
+import java.util.Collections;
+import java.util.Iterator;
+import java.util.LinkedList;
+import java.util.List;
 
-import java.util.*;
-
-
-import org.apache.jmeter.samplers.*;
-import org.apache.jmeter.util.JMeterUtils;
+import org.apache.jmeter.samplers.Clearable;
+import org.apache.jmeter.samplers.SampleResult;
 
 /**
  *  Title: Apache JMeter Description: Copyright: Copyright (c) 2000 Company:
@@ -73,7 +74,7 @@ import org.apache.jmeter.util.JMeterUtils;
  */
 
 
-public class GraphModel implements Clearable
+public class GraphModel implements Clearable,Serializable
 {
 
 	private String name;
diff --git a/jakarta-jmeter/src/components/org/apache/jmeter/visualizers/GraphVisualizer.java b/jakarta-jmeter/src/components/org/apache/jmeter/visualizers/GraphVisualizer.java
index 29f38fd..e2356af 100644
--- a/jakarta-jmeter/src/components/org/apache/jmeter/visualizers/GraphVisualizer.java
+++ b/jakarta-jmeter/src/components/org/apache/jmeter/visualizers/GraphVisualizer.java
@@ -72,11 +72,11 @@ import javax.swing.border.Border;
 import javax.swing.border.EmptyBorder;
 
 import org.apache.jmeter.gui.util.JMeterColor;
-import org.apache.jmeter.gui.util.VerticalLayout;
 import org.apache.jmeter.samplers.Clearable;
 import org.apache.jmeter.samplers.SampleResult;
 import org.apache.jmeter.util.JMeterUtils;
 import org.apache.jmeter.visualizers.gui.AbstractVisualizer;
+import org.apache.jorphan.gui.layout.VerticalLayout;
 
 /****************************************
  * This class implements a statistical analyser that calculates both the average
@@ -85,7 +85,7 @@ import org.apache.jmeter.visualizers.gui.AbstractVisualizer;
  *
  *@author    <a href="mailto:stefano@apache.org">Stefano Mazzocchi</a>
  *@created   February 8, 2001
- *@version   $Revision: 1.1 $ $Date: 2002/08/11 19:24:41 $
+ *@version   $Revision: 1.4 $ $Date: 2002/10/17 19:47:15 $
  ***************************************/
 public class GraphVisualizer extends AbstractVisualizer
 		 implements ImageVisualizer, ItemListener, GraphListener,Clearable
@@ -157,6 +157,7 @@ public class GraphVisualizer extends AbstractVisualizer
 	public void updateGui(Sample s)
 	{
 		// We have received one more sample
+		graph.updateGui(s);
 		noSamplesField.setText(Long.toString(model.getSampleCount()));
 		dataField.setText(Long.toString(s.data));
 		averageField.setText(Long.toString(s.average));
diff --git a/jakarta-jmeter/src/components/org/apache/jmeter/visualizers/MailerModel.java b/jakarta-jmeter/src/components/org/apache/jmeter/visualizers/MailerModel.java
new file mode 100644
index 0000000..74f0234
--- /dev/null
+++ b/jakarta-jmeter/src/components/org/apache/jmeter/visualizers/MailerModel.java
@@ -0,0 +1,486 @@
+/*
+ * ====================================================================
+ * The Apache Software License, Version 1.1
+ *
+ * Copyright (c) 2001 The Apache Software Foundation.  All rights
+ * reserved.
+ *
+ * Redistribution and use in source and binary forms, with or without
+ * modification, are permitted provided that the following conditions
+ * are met:
+ *
+ * 1. Redistributions of source code must retain the above copyright
+ * notice, this list of conditions and the following disclaimer.
+ *
+ * 2. Redistributions in binary form must reproduce the above copyright
+ * notice, this list of conditions and the following disclaimer in
+ * the documentation and/or other materials provided with the
+ * distribution.
+ *
+ * 3. The end-user documentation included with the redistribution,
+ * if any, must include the following acknowledgment:
+ * "This product includes software developed by the
+ * Apache Software Foundation (http://www.apache.org/)."
+ * Alternately, this acknowledgment may appear in the software itself,
+ * if and wherever such third-party acknowledgments normally appear.
+ *
+ * 4. The names "Apache" and "Apache Software Foundation" and
+ * "Apache JMeter" must not be used to endorse or promote products
+ * derived from this software without prior written permission. For
+ * written permission, please contact apache@apache.org.
+ *
+ * 5. Products derived from this software may not be called "Apache",
+ * "Apache JMeter", nor may "Apache" appear in their name, without
+ * prior written permission of the Apache Software Foundation.
+ *
+ * THIS SOFTWARE IS PROVIDED ``AS IS'' AND ANY EXPRESSED OR IMPLIED
+ * WARRANTIES, INCLUDING, BUT NOT LIMITED TO, THE IMPLIED WARRANTIES
+ * OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE ARE
+ * DISCLAIMED.  IN NO EVENT SHALL THE APACHE SOFTWARE FOUNDATION OR
+ * ITS CONTRIBUTORS BE LIABLE FOR ANY DIRECT, INDIRECT, INCIDENTAL,
+ * SPECIAL, EXEMPLARY, OR CONSEQUENTIAL DAMAGES (INCLUDING, BUT NOT
+ * LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES; LOSS OF
+ * USE, DATA, OR PROFITS; OR BUSINESS INTERRUPTION) HOWEVER CAUSED AND
+ * ON ANY THEORY OF LIABILITY, WHETHER IN CONTRACT, STRICT LIABILITY,
+ * OR TORT (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT
+ * OF THE USE OF THIS SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF
+ * SUCH DAMAGE.
+ * ====================================================================
+ *
+ * This software consists of voluntary contributions made by many
+ * individuals on behalf of the Apache Software Foundation.  For more
+ * information on the Apache Software Foundation, please see
+ * <http://www.apache.org/>.
+ */
+ package org.apache.jmeter.visualizers;
+
+import java.io.Serializable;
+import java.net.InetAddress;
+import java.net.UnknownHostException;
+import java.util.Properties;
+import java.util.StringTokenizer;
+import java.util.Vector;
+
+import javax.mail.Message;
+import javax.mail.MessagingException;
+import javax.mail.Session;
+import javax.mail.Transport;
+import javax.mail.internet.AddressException;
+import javax.mail.internet.InternetAddress;
+import javax.mail.internet.MimeMessage;
+
+import org.apache.jmeter.samplers.SampleResult;
+import org.apache.jmeter.testelement.AbstractTestElement;
+import org.apache.jmeter.testelement.TestElement;
+import org.apache.jmeter.util.JMeterUtils;
+import org.apache.log.Hierarchy;
+import org.apache.log.Logger;
+
+
+/**
+ * The model for a MailerVisualizer.
+ *
+ * @author     <a href="mailto:wolfram.rittmeyer@web.de">Wolfram Rittmeyer</a>
+ * @version    $Revision: 1.3 $ $Date: 2002/08/29 18:17:37 $
+ */
+public class MailerModel extends AbstractTestElement implements Serializable {
+
+	private String addressie;
+	private String fromAddress;
+	private String smtpHost;
+	private String failureSubject;
+	private String successSubject;
+	private long failureCount = 0;
+	private long successCount = 0;
+	private long failureLimit = 2;
+	private long successLimit = 2;
+	private boolean failureMsgSent = false;
+	private boolean siteDown = false;
+	private boolean successMsgSent = false;
+
+	private Properties appProperties;
+
+	private static final String FROM_KEY = "MailerModel.fromAddress";
+	private static final String TO_KEY = "MailerModel.addressie";
+	private static final String HOST_KEY = "MailerModel.smtpHost";
+	private static final String SUCCESS_KEY = "MailerModel.successSubject";
+	private static final String FAILURE_KEY = "MailerModel.failureSubject";
+	private static final String FAILURE_LIMIT_KEY = "MailerModel.failureLimit";
+	private static final String SUCCESS_LIMIT_KEY = "MailerModel.successLimit";
+
+	transient private static Logger log = Hierarchy.getDefaultHierarchy().getLoggerFor("jmeter.gui");
+
+	/** The listener for changes. */
+	ModelListener changeListener;
+
+	/**
+	 * Constructs a MailerModel.
+	 */
+	public MailerModel() {
+		super();
+
+		// Properties connection.
+		this.appProperties = JMeterUtils.getJMeterProperties();
+
+		// retrieve successLimit from properties
+		try {
+			successLimit =	Long.parseLong(appProperties.getProperty("mailer.successlimit"));
+		}
+		catch (Exception ex) {
+			// Ignore any garbage
+		}
+
+		// retrieve failureLimit from properties
+		try {
+			failureLimit =	Long.parseLong(appProperties.getProperty("mailer.failurelimit"));
+		}
+		catch (Exception ex) {
+			// Ignore any garbage
+		}
+	}
+
+	/**
+	 * Returns wether there had been more failures than acceptable.
+	 *
+	 * @return A boolean value indicating wether the limit of acceptable failures has been reached.
+	 */
+	public synchronized boolean isFailing()
+	{
+		return (failureCount > failureLimit);
+	}
+
+	/**
+	 * Gets a Vector of String-objects. Each String is one mail-address
+	 * of the addresses-String set by <code>setToAddress(str)</code>.
+	 * The addresses must be seperated by commas. Only String-objects
+	 * containing a "@" are added to the returned Vector.
+	 *
+	 * @return A Vector of String-objects wherein each String represents a mail-address.
+	 */
+	public synchronized Vector getAddressVector()
+	{
+		String theAddressie = getToAddress();
+		Vector addressVector = new Vector();
+		if (theAddressie != null) {
+			String addressSep = ",";
+
+			StringTokenizer next = new StringTokenizer(theAddressie, addressSep);
+
+			while (next.hasMoreTokens())
+			{
+				String theToken = next.nextToken().trim();
+
+				if (theToken.indexOf("@") > 0)
+				{
+					addressVector.addElement(theToken);
+				}
+			}
+		}
+		else {
+			return new Vector(0);
+		}
+
+		return addressVector;
+	}
+
+
+	/**
+	 * Adds a SampleResult. If SampleResult represents a change concerning
+	 * the failure/success of the sampling a message might be send to the
+	 * addressies according to the settings of <code>successCount</code>
+	 * and <code>failureCount</code>.
+	 *
+	 * @param sample The SampleResult encapsulating informations about the last sample.
+	 */
+	public synchronized void add(SampleResult sample)
+	{
+
+		// -1 is the code for a failed sample.
+		//
+		if (!sample.isSuccessful())
+		{
+			failureCount++;
+		}
+		else
+		{
+			successCount++;
+		}
+
+		if (this.isFailing() && !siteDown && !failureMsgSent)
+		{
+			// Send the mail ...
+			Vector addressVector = getAddressVector();
+			if (addressVector.size() != 0) {
+				try {
+					sendMail(fromAddress, addressVector, failureSubject, "URL Failed: " +
+						sample.getSampleLabel(), smtpHost);
+				}
+				catch (Exception e) {
+					log.error("Problem sending mail",e);
+				}
+				siteDown = true;
+				failureMsgSent = true;
+				successCount = 0;
+			}
+		}
+
+		if (siteDown && (sample.getTime() != -1) & !successMsgSent)
+		{
+			// Send the mail ...
+			if (successCount > successLimit)
+			{
+				Vector addressVector = getAddressVector();
+				try {
+					sendMail(fromAddress, addressVector, successSubject, "URL Restarted: " +
+							sample.getSampleLabel(), smtpHost);
+				}
+				catch (Exception e) {
+					log.error("Problem sending mail",e);
+				}
+				siteDown = false;
+				successMsgSent = true;
+			}
+		}
+
+		if (successMsgSent && failureMsgSent)
+		{
+			clear();
+		}
+		notifyChangeListeners();
+	}
+
+	/**
+	 * Resets the state of this object to its default. But: This method does not
+	 * reset any mail-specific attributes (like sender, mail-subject...)
+	 * since they are independent of the sampling.
+	 */
+	public synchronized void clear()
+	{
+		failureCount = 0;
+		successCount = 0;
+		siteDown = false;
+		successMsgSent = false;
+		failureMsgSent = false;
+		notifyChangeListeners();
+	}
+
+	/**
+	 * Returns a String-representation of this object. Returns always
+	 * "E-Mail-Notification". Might be enhanced in future versions to return
+	 * some kind of String-representation of the mail-parameters (like
+	 * sender, addressies, smtpHost...).
+	 *
+	 * @return A String-representation of this object.
+	 */
+	public String toString()
+	{
+		return "E-Mail Notification";
+	}
+
+	/**
+	 * Sends a mail with the given parameters using SMTP.
+	 *
+	 * @param  from The sender of the mail as shown in the mail-client.
+	 * @param  vEmails All receivers of the mail. The receivers are seperated by commas.
+	 * @param  subject The subject of the mail.
+	 * @param  attText The message-body.
+	 * @param  smtpHost The smtp-server used to send the mail.
+	 */
+	public synchronized void sendMail(String from,
+			Vector vEmails,
+			String subject,
+			String attText,
+			String smtpHost) throws UnknownHostException, AddressException, MessagingException
+	{
+		String host = smtpHost;
+		boolean debug = Boolean.valueOf(host).booleanValue();
+		InetAddress remote = InetAddress.getByName(host);
+
+		InternetAddress[] address = new InternetAddress[vEmails.size()];
+		for (int k = 0; k < vEmails.size(); k++)
+		{
+			address[k] = new InternetAddress(vEmails.elementAt(k).toString());
+		}
+
+		// create some properties and get the default Session
+		Properties props = new Properties();
+		props.put("mail.smtp.host", host);
+		Session session = Session.getDefaultInstance(props, null);
+		session.setDebug(debug);
+
+		// create a message
+		Message msg = new MimeMessage(session);
+		msg.setFrom(new InternetAddress(from));
+		msg.setRecipients(Message.RecipientType.TO, address);
+		msg.setSubject(subject);
+		msg.setText(attText);
+		Transport.send(msg);
+	}
+
+
+	/**
+	 * Returns a String for the title of the attributes-panel
+	 * as set up in the properties-file using the lookup-constant
+	 * "mailer_attributes_panel".
+	 *
+	 * @return  The title of the component.
+	 */
+	public String getAttributesTitle()
+	{
+		return JMeterUtils.getResString("mailer_attributes_panel");
+	}
+
+	//////////////////////////////////////////////////////////////
+	//
+	// setter/getter - JavaDoc-Comments not needed...
+	//
+	//////////////////////////////////////////////////////////////
+
+	public void setToAddress(String str) {
+		this.addressie = str;
+	}
+
+	public void setFromAddress(String str) {
+		this.fromAddress = str;
+	}
+
+	public void setSmtpHost(String str) {
+		this.smtpHost = str;
+	}
+
+	public void setFailureSubject(String str) {
+		this.failureSubject = str;
+	}
+
+	public void setSuccessSubject(String str) {
+		this.successSubject = str;
+	}
+
+	public void setSuccessLimit(long limit) {
+		this.successLimit = limit;
+	}
+
+	public void setSuccessCount(long count) {
+		this.successCount = count;
+	}
+
+	public void setFailureLimit(long limit) {
+		this.failureLimit = limit;
+	}
+
+	public void setFailureCount(long count) {
+		this.failureCount = count;
+	}
+
+	public String getToAddress() {
+		return this.addressie;
+	}
+
+	public String getFromAddress() {
+		return this.fromAddress;
+	}
+
+	public String getSmtpHost() {
+		return this.smtpHost;
+	}
+
+	public String getFailureSubject() {
+		return this.failureSubject;
+	}
+
+	public String getSuccessSubject() {
+		return this.successSubject;
+	}
+
+	public long getSuccessLimit() {
+		return this.successLimit;
+	}
+
+	public long getSuccessCount() {
+		return this.successCount;
+	}
+
+	public long getFailureLimit() {
+		return this.failureLimit;
+	}
+
+	public long getFailureCount() {
+		return this.failureCount;
+	}
+
+	//////////////////////////////////////////////////////////////
+	//
+	// Storing and retrieving of model...
+	//
+	//////////////////////////////////////////////////////////////
+
+	/**
+	 * Stores the attributes of the model as elements of the
+	 * given TestElement-object.
+	 *
+	 * @param element The TestElement to collect the model-attributes.
+	 */
+	public void storeModel(TestElement element) {
+		element.setProperty(TO_KEY, getToAddress());
+		element.setProperty(FROM_KEY, getFromAddress());
+		element.setProperty(HOST_KEY, getSmtpHost());
+		element.setProperty(SUCCESS_KEY, getSuccessSubject());
+		element.setProperty(FAILURE_KEY, getFailureSubject());
+		element.setProperty(FAILURE_LIMIT_KEY, new Long(getFailureLimit()));
+		element.setProperty(SUCCESS_LIMIT_KEY, new Long(getSuccessLimit()));
+	}
+
+	/**
+	 * Retrieves the attribute of the model as elements of the
+	 * given TestElement-object.
+	 *
+	 * @param element The TestElement to collect the model-attributes.
+	 */
+	public void retrieveModel(TestElement element) {
+		try {
+			setToAddress(element.getPropertyAsString(TO_KEY));
+			setFromAddress(element.getPropertyAsString(FROM_KEY));
+			setSmtpHost(element.getPropertyAsString(HOST_KEY));
+			setSuccessSubject(element.getPropertyAsString(SUCCESS_KEY));
+			setFailureSubject(element.getPropertyAsString(FAILURE_KEY));
+			setFailureLimit(Long.parseLong((String)element.getProperty(FAILURE_LIMIT_KEY)));
+			setSuccessLimit(Long.parseLong((String)element.getProperty(SUCCESS_LIMIT_KEY)));
+		}
+		catch (Exception e) {
+			log.error("Couldn't load MailerVisualizer...");
+		}
+	}
+
+	//////////////////////////////////////////////////////////////
+	//
+	// Notification of GUI.
+	//
+	//////////////////////////////////////////////////////////////
+
+	/**
+	 * Adds a ModelListener that is to be notified if model changes.
+	 *
+	 * @param listener The callback-object to receive notifications if state changes.
+	 */
+	public void addModelListener(ModelListener listener) {
+		this.changeListener = listener;
+	}
+
+	/**
+	 * Notify the assoziated ModelListener that the model has changed.
+	 */
+	private void notifyChangeListeners() {
+		this.changeListener.updateVisualizer();
+	}
+
+	/**
+	 * Notify the assoziated ModelListener that the model has changed.
+	 *
+	 * @param messageString The message to be displayed.
+	 */
+	private void notifyChangeListenersAboutMessage(String messageString) {
+		this.changeListener.displayMessage(messageString, true);
+	}
+}
+
+
diff --git a/jakarta-jmeter/src/components/org/apache/jmeter/visualizers/MailerVisualizer.java b/jakarta-jmeter/src/components/org/apache/jmeter/visualizers/MailerVisualizer.java
index d0e87ac..3a1b146 100644
--- a/jakarta-jmeter/src/components/org/apache/jmeter/visualizers/MailerVisualizer.java
+++ b/jakarta-jmeter/src/components/org/apache/jmeter/visualizers/MailerVisualizer.java
@@ -54,22 +54,35 @@
  */
  package org.apache.jmeter.visualizers;
 
-import java.io.*;
-import java.awt.*;
-import java.awt.event.*;
-import javax.swing.*;
-import javax.swing.border.*;
-import javax.swing.event.*;
-import java.util.*;
-import java.net.*;
-import javax.mail.*;
-import javax.mail.internet.*;
-//import javax.activation.* ;
-import java.util.Properties;
-import org.apache.jmeter.util.*;
-import org.apache.jmeter.gui.util.*;
-import org.apache.jmeter.samplers.*;
+import java.awt.BorderLayout;
+import java.awt.Font;
+import java.awt.GridBagConstraints;
+import java.awt.GridBagLayout;
+import java.awt.Insets;
+import java.awt.event.ActionEvent;
+import java.awt.event.ActionListener;
+import java.awt.event.FocusEvent;
+import java.awt.event.FocusListener;
+import java.net.UnknownHostException;
+
+import javax.swing.BorderFactory;
+import javax.swing.JButton;
+import javax.swing.JComponent;
+import javax.swing.JLabel;
+import javax.swing.JOptionPane;
+import javax.swing.JPanel;
+import javax.swing.JTextField;
+import javax.swing.border.Border;
+import javax.swing.border.EmptyBorder;
+
+import org.apache.jmeter.samplers.Clearable;
+import org.apache.jmeter.samplers.SampleResult;
+import org.apache.jmeter.testelement.TestElement;
+import org.apache.jmeter.util.JMeterUtils;
 import org.apache.jmeter.visualizers.gui.AbstractVisualizer;
+import org.apache.log.Hierarchy;
+import org.apache.log.Logger;
+import org.apache.jorphan.gui.layout.VerticalLayout;
 
 /*
  * TODO :
@@ -86,34 +99,18 @@ import org.apache.jmeter.visualizers.gui.AbstractVisualizer;
  *  occurs.
  *
  *@author     <a href="mailto:stuart@personalmd.com">Stuart Schmukler</a> and <a href="mailto:wolfram.rittmeyer@web.de">Wolfram Rittmeyer</a>
- *@created    $Date: 2002/08/11 19:24:41 $
- *@version    $Revision: 1.1 $ $Date: 2002/08/11 19:24:41 $
+ *@created    $Date: 2002/10/17 19:47:15 $
+ *@version    $Revision: 1.7 $ $Date: 2002/10/17 19:47:15 $
  ***********************************************************/
-//public class MailerVisualizer extends JPanel implements Visualizer, ActionListener
-public class MailerVisualizer extends AbstractVisualizer 
-		implements ActionListener, FocusListener, Clearable {
-
-	private String addressie;
-	private String from;
-	private String smtpHost;
-	private String failsubject;
-	private String successsubject;
-	private long failureCount = 0;
-	private long successCount = 0;
-	private long failureLimit = 2;
-	private long successLimit = 2;
-	private boolean failureMsgSent = false;
-	private boolean siteDown = false;
-	private boolean successMsgSent = false;
-
-	private Properties appProperties;
+public class MailerVisualizer extends AbstractVisualizer
+		implements ActionListener, FocusListener, Clearable, ModelListener {
 
 	private JButton testerButton;
 	private JTextField addressField;
 	private JTextField fromField;
 	private JTextField smtpHostField;
-	private JTextField failsubjectField;
-	private JTextField successsubjectField;
+	private JTextField failureSubjectField;
+	private JTextField successSubjectField;
 	private JTextField failureField;
 	private JTextField failureLimitField;
 	private JTextField successLimitField;
@@ -121,48 +118,24 @@ public class MailerVisualizer extends AbstractVisualizer
 	private JPanel mainPanel;
 	private JLabel panelTitleLabel;
 
+	private MailerModel model;
 
-	//-----------
+	transient private static Logger log = Hierarchy.getDefaultHierarchy().getLoggerFor("jmeter.gui");
 
-	/************************************************************
-	 *  !ToDo (Constructor description)
-	 ***********************************************************/
+	/**
+	 * Constructs the MailerVisualizer and initializes its GUI.
+	 */
 	public MailerVisualizer() {
 		super();
 
-		// Properties connection.
-		this.appProperties = JMeterUtils.getJMeterProperties();
-
-		// retrieve successLimit from properties
-		try {
-			successLimit =	Long.parseLong(appProperties.getProperty("mailer.successlimit"));
-		}
-		catch (Exception ex) {
-			// Ignore any garbage
-		}
-
-		// retrieve failureLimit from properties
-		try {
-			failureLimit =	Long.parseLong(appProperties.getProperty("mailer.failurelimit"));
-		}
-		catch (Exception ex) {
-			// Ignore any garbage
-		}
+		// construct the model
+		model = new MailerModel();
+		model.addModelListener(this);
 
 		// initialize GUI.
 		initGui();
 	}
 
-	/************************************************************
-	 *  !ToDoo (Method description)
-	 *
-	 *@return    !ToDo (Return description)
-	 ***********************************************************/
-	public synchronized boolean isFailing()
-	{
-		return (failureCount > failureLimit);
-	}
-
 	/************************************************************
 	 *  !ToDoo (Method description)
 	 *
@@ -173,111 +146,23 @@ public class MailerVisualizer extends AbstractVisualizer
 		return this;
 	}
 
-
-	/************************************************************
-	 *  !ToDo (Method description)
-	 *
-	 *@param  theAddressie  !ToDo (Parameter description)
-	 *@return               !ToDo (Return description)
-	 ***********************************************************/
-	public synchronized Vector newAddressVector(String theAddressie)
-	{
-		Vector addressVector = new Vector();
-		if (theAddressie != null) {
-			String addressSep = ", ";
-	
-			StringTokenizer next = new StringTokenizer(theAddressie, addressSep);
-	
-			while (next.hasMoreTokens())
-			{
-				String theToken = next.nextToken();
-	
-				if (theToken.indexOf("@") > 0)
-				{
-					addressVector.addElement(theToken);
-				}
-			}
-		}
-		else {
-			return new Vector(0);
-		}
-
-		return addressVector;
-	}
-
-
-	/************************************************************
-	 *  !ToDo (Method description)
+	/**
+	 * Adds a SampleResult. Actually this method just delegates calls
+	 * to the ActionModel.
 	 *
-	 *@param  sample  !ToDo (Parameter description)
-	 ***********************************************************/
+	 * @param sample The SampleResult encapsulating informations about the last sample.
+	 */
 	public synchronized void add(SampleResult sample)
 	{
-
-		// -1 is the code for a failed sample.
-		//
-		if (!sample.isSuccessful())
-		{
-			failureCount++;
-		}
-		else
-		{
-			successCount++;
-		}
-
-		if (this.isFailing() && !siteDown && !failureMsgSent)
-		{
-			// Display ...
-			failureField.setText(Long.toString(failureCount));
-			repaint();
-
-			// Send the mail ...
-			Vector addressVector = newAddressVector(addressie);
-			if (addressVector.size() != 0) {
-				sendMail(from, addressVector, failsubject, "URL Failed: " +
-						sample.getSampleLabel(), smtpHost);
-				siteDown = true;
-				failureMsgSent = true;
-				successCount = 0;
-			}
-		}
-
-		if (siteDown && (sample.getTime() != -1) & !successMsgSent)
-		{
-			// Display ...
-			failureField.setText(Long.toString(failureCount));
-			repaint();
-
-			// Send the mail ...
-			if (successCount > successLimit)
-			{
-				Vector addressVector = newAddressVector(addressie);
-				sendMail(from, addressVector, successsubject, "URL Restarted: " +
-						sample.getSampleLabel(), smtpHost);
-				siteDown = false;
-				successMsgSent = true;
-			}
-		}
-
-		if (successMsgSent && failureMsgSent)
-		{
-			clear();
-		}
+		model.add(sample);
 	}
 
-	/************************************************************
-	 *  !ToDo (Method description)
-	 ***********************************************************/
+	/**
+	 * Clears any stored sampling-informations.
+	 */
 	public synchronized void clear()
 	{
-		failureCount = 0;
-		successCount = 0;
-		siteDown = false;
-		successMsgSent = false;
-		failureMsgSent = false;
-
-		failureField.setText(Long.toString(failureCount));
-		repaint();
+		model.clear();
 	}
 
 	/************************************************************
@@ -290,63 +175,6 @@ public class MailerVisualizer extends AbstractVisualizer
 		return "E-Mail Notification";
 	}
 
-	//-----------
-	//function to send a mail to list mailaddresses
-
-	/************************************************************
-	 *  !ToDo (Method description)
-	 *
-	 *@param  from      !ToDo (Parameter description)
-	 *@param  vEmails   !ToDo (Parameter description)
-	 *@param  subject   !ToDo (Parameter description)
-	 *@param  attText   !ToDo (Parameter description)
-	 *@param  SMTPHost  !ToDo (Parameter description)
-	 ***********************************************************/
-	public static synchronized void sendMail(String from,
-			Vector vEmails,
-			String subject,
-			String attText,
-			String SMTPHost)
-	{
-		try
-		{
-			String host = SMTPHost;
-			boolean debug = Boolean.valueOf(host).booleanValue();
-			InetAddress remote = InetAddress.getByName(host);
-
-			InternetAddress[] address = new InternetAddress[vEmails.size()];
-			for (int k = 0; k < vEmails.size(); k++)
-			{
-				address[k] = new InternetAddress(vEmails.elementAt(k).toString());
-			}
-
-			// create some properties and get the default Session
-			Properties props = new Properties();
-			props.put("mail.smtp.host", host);
-			Session session = Session.getDefaultInstance(props, null);
-			session.setDebug(debug);
-
-			// create a message
-			Message msg = new MimeMessage(session);
-			msg.setFrom(new InternetAddress(from));
-			msg.setRecipients(Message.RecipientType.TO, address);
-			msg.setSubject(subject);
-			msg.setText(attText);
-			Transport.send(msg);
-			System.out.println("Mail sent successfully!!");
-		}
-		catch (UnknownHostException e1)
-		{
-			System.out.println("NxError:Invalid Mail Server " + e1);
-			System.exit(1);
-		}
-		catch (Exception e)
-		{
-			e.printStackTrace();
-			System.exit(1);
-		}
-	}
-
 	/**
 	 * Initializes the GUI. Lays out components and adds them to the
 	 * container.
@@ -373,7 +201,7 @@ public class MailerVisualizer extends AbstractVisualizer
 
 		// mailer panel
 		JPanel mailerPanel = new JPanel();
-		mailerPanel.setBorder(BorderFactory.createTitledBorder(BorderFactory.createEtchedBorder(), getAttributesTitle()));
+		mailerPanel.setBorder(BorderFactory.createTitledBorder(BorderFactory.createEtchedBorder(), model.getAttributesTitle()));
 		GridBagLayout g = new GridBagLayout();
 		mailerPanel.setLayout(g);
 		GridBagConstraints c = new GridBagConstraints();
@@ -383,8 +211,7 @@ public class MailerVisualizer extends AbstractVisualizer
 		c.gridwidth = 1;
 		mailerPanel.add(new JLabel("From:"));
 
-		from = appProperties.getProperty("mailer.from");
-		fromField = new JTextField(from, 25);
+		fromField = new JTextField(model.getFromAddress(), 25);
 		fromField.setEditable(true);
 		fromField.addActionListener(this);
 		fromField.addFocusListener(this);
@@ -397,8 +224,7 @@ public class MailerVisualizer extends AbstractVisualizer
 		c.gridwidth = 1;
 		mailerPanel.add(new JLabel("Addressie(s):"));
 
-		addressie = appProperties.getProperty("mailer.addressies");
-		addressField = new JTextField(addressie, 25);
+		addressField = new JTextField(model.getToAddress(), 25);
 		addressField.setEditable(true);
 		addressField.addActionListener(this);
 		addressField.addFocusListener(this);
@@ -409,8 +235,7 @@ public class MailerVisualizer extends AbstractVisualizer
 		c.gridwidth = 1;
 		mailerPanel.add(new JLabel("SMTP Host:"));
 
-		smtpHost = appProperties.getProperty("mailer.smtphost");
-		smtpHostField = new JTextField(smtpHost, 25);
+		smtpHostField = new JTextField(model.getSmtpHost(), 25);
 		smtpHostField.setEditable(true);
 		smtpHostField.addActionListener(this);
 		smtpHostField.addFocusListener(this);
@@ -421,31 +246,29 @@ public class MailerVisualizer extends AbstractVisualizer
 		c.gridwidth = 1;
 		mailerPanel.add(new JLabel("Failure Subject:"));
 
-		failsubject = appProperties.getProperty("mailer.failsubject");
-		failsubjectField = new JTextField(failsubject, 25);
-		failsubjectField.setEditable(true);
-		failsubjectField.addActionListener(this);
-		failsubjectField.addFocusListener(this);
+		failureSubjectField = new JTextField(model.getFailureSubject(), 25);
+		failureSubjectField.setEditable(true);
+		failureSubjectField.addActionListener(this);
+		failureSubjectField.addFocusListener(this);
 		c.gridwidth = GridBagConstraints.REMAINDER;
-		g.setConstraints(failsubjectField, c);
-		mailerPanel.add(failsubjectField);
+		g.setConstraints(failureSubjectField, c);
+		mailerPanel.add(failureSubjectField);
 
 		c.gridwidth = 1;
 		mailerPanel.add(new JLabel("Success Subject:"));
 
-		successsubject = appProperties.getProperty("mailer.successsubject");
-		successsubjectField = new JTextField(successsubject, 25);
-		successsubjectField.setEditable(true);
-		successsubjectField.addActionListener(this);
-		successsubjectField.addFocusListener(this);
+		successSubjectField = new JTextField(model.getSuccessSubject(), 25);
+		successSubjectField.setEditable(true);
+		successSubjectField.addActionListener(this);
+		successSubjectField.addFocusListener(this);
 		c.gridwidth = GridBagConstraints.REMAINDER;
-		g.setConstraints(successsubjectField, c);
-		mailerPanel.add(successsubjectField);
+		g.setConstraints(successSubjectField, c);
+		mailerPanel.add(successSubjectField);
 
 		c.gridwidth = 1;
 		mailerPanel.add(new JLabel("Failure Limit:"));
 
-		failureLimitField = new JTextField(Long.toString(failureLimit), 6);
+		failureLimitField = new JTextField(Long.toString(model.getFailureLimit()), 6);
 		failureLimitField.setEditable(true);
 		failureLimitField.addActionListener(this);
 		failureLimitField.addFocusListener(this);
@@ -456,7 +279,7 @@ public class MailerVisualizer extends AbstractVisualizer
 		c.gridwidth = 1;
 		mailerPanel.add(new JLabel("Success Limit:"));
 
-		successLimitField = new JTextField(Long.toString(successLimit), 6);
+		successLimitField = new JTextField(Long.toString(model.getSuccessLimit()), 6);
 		successLimitField.setEditable(true);
 		successLimitField.addActionListener(this);
 		successLimitField.addFocusListener(this);
@@ -490,13 +313,11 @@ public class MailerVisualizer extends AbstractVisualizer
 	 * as set up in the properties-file using the lookup-constant
 	 * "mailer_visualizer_title".
 	 *
-	 *@return  The title of the component.
+	 * @return  The title of the component.
 	 */
 	public String getStaticLabel()
 	{
-		// should be something like this:
-		//	return JMeterUtils.getResString("mailer_visualizer_title");
-		return "Mailer Visualizer";
+		return JMeterUtils.getResString("mailer_visualizer_title");
 	}
 
 	/**
@@ -508,23 +329,9 @@ public class MailerVisualizer extends AbstractVisualizer
 	 */
 	public String getAttributesTitle()
 	{
-		// should be something like this:
-		//	return JMeterUtils.getResString("mailer_attributes_panel")
-		return "Mailing attributes";
-	}
-	/**
-	* Method used to log a String.
-	*
-	* @param str String to be logged.
-	*/
-	private static void log(String str) {
-		// this is just a tewmporary solution
-		// will be replaced by a call to the logging-API
-		// of the commons-project.
-		System.out.println("MailerVisualizer - " + str);
+		return JMeterUtils.getResString("mailer_attributes_panel");
 	}
 
-
 	/**
 	 * Does the actual EventHandling. Gets called by EventHandlers
 	 * for either ActionEvents or FocusEvents.
@@ -533,32 +340,37 @@ public class MailerVisualizer extends AbstractVisualizer
 	 */
 	private void doEventHandling(Object source) {
 		if (source == addressField) {
-			this.addressie = this.addressField.getText();
-			log("AddressField=" + addressField.getText());
+			model.setToAddress(this.addressField.getText());
 		}
 		else if (source == fromField) {
-			this.from = this.fromField.getText();
-			log("FromField=" + fromField.getText());
+			model.setFromAddress(this.fromField.getText());
 		}
 		else if (source == smtpHostField) {
-			this.smtpHost = this.smtpHostField.getText();
-			log("smtpHostField=" + smtpHostField.getText());
+			model.setSmtpHost(this.smtpHostField.getText());
 		}
-		else if (source == failsubjectField) {
-			this.failsubject = this.failsubjectField.getText();
-			log("failsubjectField=" + failsubjectField.getText());
+		else if (source == failureSubjectField) {
+			model.setFailureSubject(this.failureSubjectField.getText());
 		}
-		else if (source == successsubjectField) {
-			this.successsubject = this.successsubjectField.getText();
-			log("successsubjectField=" + successsubjectField.getText());
+		else if (source == successSubjectField) {
+			model.setSuccessSubject(this.successSubjectField.getText());
 		}
 		else if (source == failureLimitField) {
-			this.failureLimit = Long.parseLong(this.failureLimitField.getText());
-			log("failureLimitField=" + failureLimitField.getText());
+			try {
+				model.setFailureLimit(Long.parseLong(this.failureLimitField.getText()));
+			}
+			catch (NumberFormatException e) {
+				log.warn("failureLimitField=" + failureLimitField.getText(),e);
+				JOptionPane.showMessageDialog(null, JMeterUtils.getResString("you_must_enter_a_valid_number"), "Error", JOptionPane.ERROR_MESSAGE);
+			}
 		}
 		else if (source == successLimitField) {
-			this.successLimit = Long.parseLong(this.successLimitField.getText());
-			log("successLimitField=" + successLimitField.getText());
+			try {
+				model.setSuccessLimit(Long.parseLong(this.successLimitField.getText()));
+			}
+			catch (NumberFormatException e) {
+			log.warn("successLimitField=" + successLimitField.getText(),e);
+			JOptionPane.showMessageDialog(null, JMeterUtils.getResString("you_must_enter_a_valid_number"), "Error", JOptionPane.ERROR_MESSAGE);
+			}
 		}
 	}
 
@@ -569,34 +381,37 @@ public class MailerVisualizer extends AbstractVisualizer
 	//
 	//////////////////////////////////////////////////////////////
 
-	/************************************************************
-	 *  !ToDo (Method description)
+	/**
+	 * Reacts on an ActionEvent (like pressing a button).
 	 *
-	 *@param  e  !ToDo (Parameter description)
-	 ***********************************************************/
+	 * @param e The ActionEvent with information about the event and its source.
+	 */
 	public void actionPerformed(ActionEvent e) {
 		try {
 			JComponent c = (JComponent)e.getSource();
 			if (c == testerButton) {
-				log("### Test To:  " + this.addressie + ", " +
-						"Via:  " + this.smtpHost + ", " +
-						"Fail Subject:  " + this.failsubject + ", " +
-						"Success Subject:  " + this.successsubject);
-
-				String testMessage = ("### Test To:  " + this.addressie + ", " +
-						"Via:  " + this.smtpHost + ", " +
-						"Fail Subject:  " + this.failsubject + ", " +
-						"Success Subject:  " + this.successsubject);
-
-				Vector addressVector = newAddressVector(addressie);
-				sendMail(from, addressVector, "Testing addressies", testMessage, smtpHost);
+				String testString = "JMeter-Testmail" + "\n" +
+									"To:  " + model.getToAddress() + "\n" +
+									"Via:  " + model.getSmtpHost() + "\n" +
+									"Fail Subject:  " + model.getFailureSubject() + "\n" +
+									"Success Subject:  " + model.getSuccessSubject();
+				log.debug(testString);
+				model.sendMail(model.getFromAddress(), model.getAddressVector(), "Testing mail-addresses", testString, model.getSmtpHost());
+				log.info("Mail sent successfully!!");
 			}
 			else {
 				doEventHandling(c);
 			}
 		}
-		catch (Exception ex)	{
-			JOptionPane.showMessageDialog(this, ex, "Error", JOptionPane.ERROR_MESSAGE);
+		catch (UnknownHostException e1)
+		{
+			log.error("Invalid Mail Server ",e1);
+			displayMessage(JMeterUtils.getResString("invalid_mail_server"), true);
+		}
+		catch (Exception ex)
+		{
+			log.error("Couldn't send mail...",ex);
+			displayMessage(JMeterUtils.getResString("invalid_mail_server"), true);
 		}
 	}
 
@@ -625,9 +440,67 @@ public class MailerVisualizer extends AbstractVisualizer
 		doEventHandling(source);
 	}
 
+	//////////////////////////////////////////////////////////////
+	//
+	// Methods used to store and retrieve the MailerVisualizer.
+	//
+	//////////////////////////////////////////////////////////////
+
+	/**
+	 * Restores MailerVisualizer.
+	 */
+	public void configure(TestElement el)
+	{
+		super.configure(el);
+		model.retrieveModel(el);
+		updateVisualizer();
+	}
+
+	/**
+	 * Makes MailerVisualizer storable.
+	 */
+	public TestElement createTestElement()
+	{
+		TestElement element = super.createTestElement();
+		model.storeModel(element);
+		return element;
+	}
+
+	//////////////////////////////////////////////////////////////
+	//
+	// Methods to implement the ModelListener.
+	//
+	//////////////////////////////////////////////////////////////
+
+	/**
+	 * Notifies this Visualizer about model-changes. Causes the Visualizer to
+	 * query the model about its new state.
+	 */
+	public void updateVisualizer() {
+		addressField.setText(model.getToAddress());
+		fromField.setText(model.getFromAddress());
+		smtpHostField.setText(model.getSmtpHost());
+		successSubjectField.setText(model.getSuccessSubject());
+		failureSubjectField.setText(model.getFailureSubject());
+		failureLimitField.setText(String.valueOf(model.getFailureLimit()));
+		failureField.setText(String.valueOf(model.getFailureCount()));
+		successLimitField.setText(String.valueOf(model.getSuccessLimit()));
+		repaint();
+	}
+
+	/**
+	 * Shows a message using a DialogBox.
+	 */
+	public void displayMessage(String message, boolean isError) {
+		int type = 0;
+		if (isError) {
+			type = JOptionPane.ERROR_MESSAGE;
+		}
+		else {
+			type = JOptionPane.INFORMATION_MESSAGE;
+		}
+		JOptionPane.showMessageDialog(null, message, "Error", type);
+	}
 }
 
-// new ressource_strings:
-// mailer_visualizer_title - used as the title of this Visualizer
-// mailer_attributes_panel - used as the title of the JPanel (EtchedBorder - title) where the attributes are entered
 
diff --git a/jakarta-jmeter/src/core/org/apache/jmeter/save/old/SaveHandler.java b/jakarta-jmeter/src/components/org/apache/jmeter/visualizers/ModelListener.java
similarity index 81%
rename from jakarta-jmeter/src/core/org/apache/jmeter/save/old/SaveHandler.java
rename to jakarta-jmeter/src/components/org/apache/jmeter/visualizers/ModelListener.java
index 45cb713..f47f8fd 100644
--- a/jakarta-jmeter/src/core/org/apache/jmeter/save/old/SaveHandler.java
+++ b/jakarta-jmeter/src/components/org/apache/jmeter/visualizers/ModelListener.java
@@ -52,29 +52,25 @@
  * information on the Apache Software Foundation, please see
  * <http://www.apache.org/>.
  */
- package org.apache.jmeter.save.old;
-
-import java.io.*;
+ package org.apache.jmeter.visualizers;
 
 /**
- * Title:        JMeter
- * Description:
- * Copyright:    Copyright (c) 2000
- * Company:      Apache
- * @author Michael Stover
- * @version 1.0
+ * The Interface to be implemented by any class that wants to be notified by
+ * model which makes use of this callback-Interface.
+ *
+ * @author     <a href="mailto:wolfram.rittmeyer@web.de">Wolfram Rittmeyer</a>
+ * @version    $Revision: 1.1 $ $Date: 2002/08/21 23:35:48 $
  */
-
-public interface SaveHandler
+public interface ModelListener
 {
 
-	  /**
-	* Gets the tag name that will trigger the use of this object's TagHandler.
-	*/
-	public String getPrimaryTagName();
+	/**
+	 * Informs the Visualizer that the model has changed.
+	 */
+	public void updateVisualizer();
 
-  /**
-	* Tells the object to save itself to the given output stream.
-	*/
-  public void save(Saveable objectToSave,Writer out) throws IOException;
+	/**
+	 * Informs the Visualizer that a message should be displayed.
+	 */
+	public void displayMessage(String messageString, boolean isError);
 }
\ No newline at end of file
diff --git a/jakarta-jmeter/src/components/org/apache/jmeter/visualizers/RunningSample.java b/jakarta-jmeter/src/components/org/apache/jmeter/visualizers/RunningSample.java
index a38cb98..e1a1135 100644
--- a/jakarta-jmeter/src/components/org/apache/jmeter/visualizers/RunningSample.java
+++ b/jakarta-jmeter/src/components/org/apache/jmeter/visualizers/RunningSample.java
@@ -86,12 +86,15 @@ public class RunningSample {
     private long errorCount;
     private long firstTime;
     private long lastTime;
-    private Set threadNames;
+    private String label;
+    private int index;
 
     /**
      * use this constructor.
      */
-    public RunningSample() {
+    public RunningSample(String label, int index) {
+        this.label= label;
+	this.index = index;
         counter = 0L;
         runningSum = 0L;
         max = Long.MIN_VALUE;
@@ -99,17 +102,39 @@ public class RunningSample {
         errorCount = 0L;
         firstTime = 0L;
         lastTime = 0L;
-        threadNames = new HashSet();
     }
 
     /**
-     * Returns a String that represents the idealized throughput for that
-     * sample.  Uses the following equation:<p>
-     * Rn = (TotalTime * NumberOfThreads) / averageTime
-     * <p>
-     * Where Rn = # requests per TotalTime period.
+     * Returns the throughput associated to this sampler in requests per second.
+     * May be slightly skewed because it takes the timestamps of the first and
+     * last samples as the total time passed, and the test may actually have
+     * started before that start time and ended after that end time.
+     **/
+    public double getRate() {
+      long howLongRunning = lastTime - firstTime;
+
+      if (howLongRunning == 0) return Double.MAX_VALUE;
+      return (double)counter / howLongRunning * 1000.0;
+    }
+
+    /**
+     * Returns the throughput associated to this sampler in requests per min.
+     * May be slightly skewed because it takes the timestamps of the first and
+     * last samples as the total time passed, and the test may actually have
+     * started before that start time and ended after that end time.
+     **/
+    public double getRatePerMin() {
+      long howLongRunning = lastTime - firstTime;
+
+      if (howLongRunning == 0) return Double.MAX_VALUE;
+      return (double)counter / howLongRunning * 60000.0;
+    }
+
+    /**
+     * Returns a String that represents the throughput associated for this
+     * sampler, in units appropriate to its dimension:
      * <p>
-     * This number is then represented in requests/second or requests/minute or requests/hour.
+     * The number is represented in requests/second or requests/minute or requests/hour.
      * <p>
      * Examples:
      *      "34.2/sec"
@@ -119,27 +144,33 @@ public class RunningSample {
      * @return a String representation of the rate the samples are being taken at.
      */
     public String getRateString() {
-        long howLongRunning = lastTime - firstTime;
-
-        if (howLongRunning == 0) return ("N/A");
-        double samplesPerSecond = (double)((double)howLongRunning * threadNames.size()) / (double)getAverage();
-        double factor = (double)((double)1000 / (double)howLongRunning);
-        samplesPerSecond = samplesPerSecond * factor;
-//        System.out.println("Running for " + howLongRunning + " seconds - " + samplesPerSecond + " samples per second.");
-        String perString = "/sec";
-        if (samplesPerSecond < 1.0) {
-            samplesPerSecond *= 60;
-            perString = "/min";
+        double rate= getRate();
+
+        if (rate == Double.MAX_VALUE) return "N/A";
+ 
+        String unit="sec";
+        if (rate < 1.0) {
+	    rate *= 60.0;
+	    unit = "min";
         }
-        if (samplesPerSecond < 1.0) {
-            samplesPerSecond *= 60;
-            perString = "/hour";
+        if (rate < 1.0) {
+	    rate *= 60.0;
+	    unit = "/hour";
         }
-        
-        String rval = rateFormatter.format(samplesPerSecond) + perString;
+
+        String rval = rateFormatter.format(rate) + "/" + unit;
         return (rval);
     }
 
+    public String getLabel()
+    {
+    	return label;
+    }
+
+    public int getIndex()
+    {
+        return index;
+    }
 
     /**
      * Records a sample.
@@ -147,11 +178,9 @@ public class RunningSample {
      * @arg aSuccessFlag Flag for if this sample was successful or not
      */
     public synchronized void addSample(SampleResult res) {
-    	threadNames.add(res.getThreadName());
 		long aTimeInMillis = res.getTime();
 		boolean aSuccessFlag = res.isSuccessful();
 		lastTime = res.getTimeStamp();
-
         counter++;
         if (firstTime == 0L) {
             // this is our first sample, set the start time to current timestamp
@@ -169,7 +198,7 @@ public class RunningSample {
      */
     public long getMin() {
         long rval = 0;
-        if (min != Long.MIN_VALUE) rval = min;
+        if (min != Long.MAX_VALUE) rval = min;
         return (rval);
     }
 
@@ -179,7 +208,7 @@ public class RunningSample {
      */
     public long getMax() {
         long rval = 0;
-        if (max != Long.MAX_VALUE) rval = max;
+        if (max != Long.MIN_VALUE) rval = max;
         return (rval);
     }
 
diff --git a/jakarta-jmeter/src/components/org/apache/jmeter/visualizers/Sample.java b/jakarta-jmeter/src/components/org/apache/jmeter/visualizers/Sample.java
index e1d3df5..54fc37e 100644
--- a/jakarta-jmeter/src/components/org/apache/jmeter/visualizers/Sample.java
+++ b/jakarta-jmeter/src/components/org/apache/jmeter/visualizers/Sample.java
@@ -54,6 +54,8 @@
  */
  package org.apache.jmeter.visualizers;
 
+import java.io.Serializable;
+
 /**
  * Title:        Apache JMeter
  * Description:
@@ -63,7 +65,7 @@
  * @version 1.0
  */
 
-	public class Sample
+	public class Sample implements Serializable
 	{
 
 		/**
@@ -98,4 +100,8 @@
 			this.throughput = throughput;
 			this.error = error;
 		}
+		
+		public Sample()
+		{
+		}
 	}
\ No newline at end of file
diff --git a/jakarta-jmeter/src/components/org/apache/jmeter/visualizers/Spline3.java b/jakarta-jmeter/src/components/org/apache/jmeter/visualizers/Spline3.java
index 4f07eeb..f34bf3d 100644
--- a/jakarta-jmeter/src/components/org/apache/jmeter/visualizers/Spline3.java
+++ b/jakarta-jmeter/src/components/org/apache/jmeter/visualizers/Spline3.java
@@ -55,10 +55,8 @@
 
 package org.apache.jmeter.visualizers;
 
-import java.awt.*;
-import java.io.*;
-import java.lang.*;
-import javax.swing.*;
+import org.apache.log.Hierarchy;
+import org.apache.log.Logger;
 //import Acme.JPM.Encoders.*;
 
 /*
@@ -134,8 +132,9 @@ import javax.swing.*;
  *  @version 1.0 - 199903202000
  */
 public class Spline3 {
+	transient private static Logger log = Hierarchy.getDefaultHierarchy().getLoggerFor(
+			"jmeter.gui");
 
-	 private final boolean DEBUG = false;
 	 protected float[][] _coefficients;
 	 protected float[][] _A;
 	 protected float[] _B;
@@ -172,17 +171,15 @@ public class Spline3 {
 		  try {
 				long startTime = System.currentTimeMillis();
 				this.interpolation();
-				if (DEBUG) {
+				if (log.isDebugEnabled()) {
 					 long endTime = System.currentTimeMillis();
 					 long elapsedTime = endTime - startTime;
-					 System.out.print("New Spline curve interpolated in ");
-					 System.out.println(elapsedTime + " ms");
+					 log.debug("New Spline curve interpolated in ");
+					 log.debug(elapsedTime + " ms");
 				}
 		  }
 		  catch (Exception e) {
-				System.err.print("Error when interpolating : ");
-				System.err.println(e);
-				e.printStackTrace();
+				log.error("Error when interpolating : ",e);
 		  }
 
 	 }
@@ -253,8 +250,8 @@ public class Spline3 {
 		  float[] oldX = new float[_n];
 		  // Jacobi convergence test
 		  if (!converge()) {
-				if (DEBUG) {
-					 System.err.println("Warning : "
+				if (log.isDebugEnabled()) {
+					 log.debug("Warning : "
 											  + "equation system resolving is unstable");
 				}
 		  }
@@ -282,19 +279,19 @@ public class Spline3 {
 				iterations++;
 		  }
 		  if (this.precision(oldX, newX) < this._minPrecision) {
-				if (DEBUG) {
-					 System.out.print("Minimal precision (");
-					 System.out.print(this._minPrecision + ") reached after ");
-					 System.out.println(iterations + " iterations");
+				if (log.isDebugEnabled()) {
+					 log.debug("Minimal precision (");
+					 log.debug(this._minPrecision + ") reached after ");
+					 log.debug(iterations + " iterations");
 				}
 		  }
 		  else if (iterations > this._maxIterations) {
-				if (DEBUG) {
-					 System.out.print("Maximal number of iterations (");
-					 System.out.println(this._maxIterations + ") reached");
-					 System.out.print("Warning : precision is only ");
-					 System.out.print(this.precision(oldX, newX));
-					 System.out.println(", divergence is possible");
+				if (log.isDebugEnabled()) {
+					 log.debug("Maximal number of iterations (");
+					 log.debug(this._maxIterations + ") reached");
+					log.debug("Warning : precision is only ");
+					 log.debug(""+this.precision(oldX, newX));
+					 log.debug(", divergence is possible");
 				}
 		  }
 		  for (i = 0; i < _n; i++) {
@@ -354,8 +351,8 @@ public class Spline3 {
 		  float abscissa = 0F, result = 0F;
 		  // verify t belongs to the curve (range [0, _m-1])
 		  if ((t < 0) || (t > (_m - 1))) {
-				if (DEBUG) {
-					 System.err.println("Warning : abscissa " + t
+				if (log.isDebugEnabled()) {
+					 log.debug("Warning : abscissa " + t
 											  + " out of bounds [0, " + (_m - 1) + "]");
 				}
 				// silent error, consider the curve is constant outside its range
@@ -390,8 +387,8 @@ public class Spline3 {
 	 public void debugCheck() {
 		  int i = 0;
 		  for (i = 0; i < _m; i++) {
-				System.out.print("Point " + i + " : ");
-				System.out.println(_r[i] + " =? " + value(i));
+				log.info("Point " + i + " : ");
+				log.info(_r[i] + " =? " + value(i));
 		  }
 	 }
 
@@ -457,27 +454,6 @@ public class Spline3 {
 		  return DEFAULT_MAX_ITERATIONS;
 	 }
 
-	 public static void main(String[] args) {
-		  /* test
-			  OutputStream output = null;
-			  float[] echantillons = {1, 3, 4, 0, 2};
-			  Spline3 essai = new Spline3 (echantillons);
-			  essai.check();
-
-			  try {
-			  output = new FileOutputStream("/tmp/essai.gif");
-			  ImageEncoder encoder = new GifEncoder(essai.draw(300, 200), output);
-			  encoder.encode();
-			  output.close();
-			  }
-			  catch (IOException e) {
-			  System.err.println(e);
-			  e.printStackTrace();
-			  }
-			  //System.exit(0);
-		  */
-	 }
-
 }
 
 
diff --git a/jakarta-jmeter/src/components/org/apache/jmeter/visualizers/SplineVisualizer.java b/jakarta-jmeter/src/components/org/apache/jmeter/visualizers/SplineVisualizer.java
index e7b6a2e..ed5244e 100644
--- a/jakarta-jmeter/src/components/org/apache/jmeter/visualizers/SplineVisualizer.java
+++ b/jakarta-jmeter/src/components/org/apache/jmeter/visualizers/SplineVisualizer.java
@@ -53,16 +53,26 @@
  * <http://www.apache.org/>.
  */
 package org.apache.jmeter.visualizers;
-import java.awt.*;
-import java.util.Vector;
-import javax.swing.*;
-import javax.swing.border.*;
-import org.apache.jmeter.gui.*;
-import org.apache.jmeter.gui.util.VerticalLayout;
+import java.awt.BorderLayout;
+import java.awt.Color;
+import java.awt.Dimension;
+import java.awt.Font;
+import java.awt.Graphics;
+import java.awt.GridLayout;
+import java.awt.Image;
+
+import javax.swing.BorderFactory;
+import javax.swing.JComponent;
+import javax.swing.JLabel;
+import javax.swing.JPanel;
+import javax.swing.border.Border;
+import javax.swing.border.EmptyBorder;
+
+import org.apache.jmeter.samplers.Clearable;
 import org.apache.jmeter.samplers.SampleResult;
 import org.apache.jmeter.util.JMeterUtils;
 import org.apache.jmeter.visualizers.gui.AbstractVisualizer;
-import org.apache.jmeter.samplers.Clearable;
+import org.apache.jorphan.gui.layout.VerticalLayout;
 
 /****************************************
  * This class implements a statistical analyser that takes samples to process a
@@ -70,7 +80,7 @@ import org.apache.jmeter.samplers.Clearable;
  * GraphVisualizer.
  *
  *@author    <a href="mailto:norguet@bigfoot.com">Jean-Pierre Norguet</a>
- *@created   $Date: 2002/08/11 19:24:41 $
+ *@created   $Date: 2002/10/17 19:47:15 $
  *@version   0.9.1
  ***************************************/
 public class SplineVisualizer extends AbstractVisualizer implements ImageVisualizer,
@@ -107,7 +117,7 @@ public class SplineVisualizer extends AbstractVisualizer implements ImageVisuali
 	 ***************************************/
 	protected final boolean FILL_UP_WITH_ZEROS = false;
 
-	private SplineGraph graph = null;
+	transient private SplineGraph graph = null;
 
 	private JLabel minimumLabel = null;
 	private JLabel maximumLabel = null;
@@ -118,7 +128,7 @@ public class SplineVisualizer extends AbstractVisualizer implements ImageVisuali
 	private JLabel maximumNumberLabel = null;
 	private JLabel averageNumberLabel = null;
 	private JLabel incomingNumberLabel = null;
-	private SplineModel model;
+	transient private SplineModel model;
 
 	/****************************************
 	 * !ToDo (Constructor description)
@@ -359,8 +369,8 @@ public class SplineVisualizer extends AbstractVisualizer implements ImageVisuali
 	 * Component showing a Spline curve.
 	 *
 	 *@author    $Author: mstover1 $
-	 *@created   $Date: 2002/08/11 19:24:41 $
-	 *@version   $Revision: 1.1 $
+	 *@created   $Date: 2002/10/17 19:47:15 $
+	 *@version   $Revision: 1.4 $
 	 ***************************************/
 	public class SplineGraph extends JComponent
 	{
diff --git a/jakarta-jmeter/src/components/org/apache/jmeter/visualizers/StatVisualizer.java b/jakarta-jmeter/src/components/org/apache/jmeter/visualizers/StatVisualizer.java
index 0d6ddd6..d426663 100644
--- a/jakarta-jmeter/src/components/org/apache/jmeter/visualizers/StatVisualizer.java
+++ b/jakarta-jmeter/src/components/org/apache/jmeter/visualizers/StatVisualizer.java
@@ -53,27 +53,31 @@
  * <http://www.apache.org/>.
  */
 package org.apache.jmeter.visualizers;
-import java.awt.*;
+import java.awt.BorderLayout;
+import java.awt.Dimension;
+import java.awt.Font;
+import java.awt.Rectangle;
 import java.awt.event.MouseAdapter;
 import java.awt.event.MouseEvent;
 import java.util.Arrays;
-import java.util.Iterator;
-import java.util.Map;
-import java.util.Vector;// java
-import javax.swing.*;
+
+import javax.swing.JLabel;
+import javax.swing.JPanel;
+import javax.swing.JScrollPane;
+import javax.swing.JTable;
+import javax.swing.Scrollable;
 import javax.swing.border.Border;
 import javax.swing.border.EmptyBorder;
 import javax.swing.event.TableModelEvent;
 import javax.swing.table.AbstractTableModel;
 import javax.swing.table.TableModel;
-import org.apache.jmeter.gui.util.VerticalLayout;
+
+import org.apache.jmeter.samplers.Clearable;
 import org.apache.jmeter.samplers.SampleResult;
+import org.apache.jmeter.testelement.TestElement;
 import org.apache.jmeter.util.JMeterUtils;
 import org.apache.jmeter.visualizers.gui.AbstractVisualizer;
-import org.apache.jmeter.samplers.Clearable;
-import org.apache.jmeter.testelement.TestElement;
-
-
+import org.apache.jorphan.gui.layout.VerticalLayout;
 /****************************************
  * Title: StatVisualizer.java Description: Aggregrate Table-Based Reporting
  * Visualizer for JMeter Props to the people who've done the other visualizers
@@ -82,59 +86,44 @@ import org.apache.jmeter.testelement.TestElement;
  * Company: Apache Foundation
  *
  *@author    James Boutcher
- *@created   $Date: 2002/08/11 19:24:41 $
+ *@created   $Date: 2003/01/07 02:54:50 $
  *@version   1.0
  ***************************************/
-
-public class StatVisualizer extends AbstractVisualizer implements Scrollable, GraphListener,Clearable
+public class StatVisualizer
+	extends AbstractVisualizer
+	implements Scrollable, AccumListener, Clearable
 {
-//    protected NamePanel namePanel;
-
-//    protected GraphAccum graph;
-
-//    protected JPanel legendPanel;
-
+	//    protected NamePanel namePanel;
+	//    protected GraphAccum graph;
+	//    protected JPanel legendPanel;
 	/****************************************
 	 * !ToDo (Field description)
 	 ***************************************/
 	protected JTable myJTable;
-
 	/****************************************
 	 * !ToDo (Field description)
 	 ***************************************/
 	protected JScrollPane myScrollPane;
-
-	private final static String VISUALIZER_NAME = JMeterUtils.getResString("Aggregate Report");
-
+	private final static String VISUALIZER_NAME =
+		JMeterUtils.getResString("aggregate_report");
 	private long sleepTill = 0;
-
 	private static int width = 2000;
-
-//    private boolean data = true;
-
-//    private boolean average = true;
-
-//    private boolean deviation = true;
-
-	private StatVisualizerModel model;
-
-	private StatTableModel myStatTableModel;
-
-
+	//    private boolean data = true;
+	//    private boolean average = true;
+	//    private boolean deviation = true;
+	transient private StatVisualizerModel model;
+	transient private StatTableModel myStatTableModel;
 	/****************************************
 	 * Constructor for the Graph object
 	 ***************************************/
-
 	public StatVisualizer()
 	{
-
 		super();
 		model = new StatVisualizerModel();
-		model.addGraphListener(this);
+		model.addAccumListener(this);
 		this.setPreferredSize(new Dimension(width, 800));
 		init();
 	}
-
 	/****************************************
 	 * !ToDoo (Method description)
 	 *
@@ -144,7 +133,6 @@ public class StatVisualizer extends AbstractVisualizer implements Scrollable, Gr
 	{
 		return VISUALIZER_NAME;
 	}
-
 	/****************************************
 	 * !ToDo (Method description)
 	 *
@@ -154,21 +142,15 @@ public class StatVisualizer extends AbstractVisualizer implements Scrollable, Gr
 	{
 		model.addNewSample(res);
 	}
-
-
 	/****************************************
 	 * Gets the PreferredScrollableViewportSize attribute of this Visualizer
 	 *
 	 *@return   The PreferredScrollableViewportSize value
 	 ***************************************/
-
 	public Dimension getPreferredScrollableViewportSize()
 	{
-
 		return this.getPreferredSize();
 	}
-
-
 	/****************************************
 	 * Gets the ScrollableUnitIncrement attribute of the Visualizer
 	 *
@@ -177,16 +159,14 @@ public class StatVisualizer extends AbstractVisualizer implements Scrollable, Gr
 	 *@param direction    Description of Parameter
 	 *@return             The ScrollableUnitIncrement value
 	 ***************************************/
-
-	public int getScrollableUnitIncrement(Rectangle visibleRect, int orientation, int direction)
+	public int getScrollableUnitIncrement(
+		Rectangle visibleRect,
+		int orientation,
+		int direction)
 	{
-
 		// yanked this from some other visualizer - along with most of the core GUI stuff. not my bag.
-
 		return 5;
 	}
-
-
 	/****************************************
 	 * Gets the ScrollableBlockIncrement attribute of the Visualizer
 	 *
@@ -195,25 +175,22 @@ public class StatVisualizer extends AbstractVisualizer implements Scrollable, Gr
 	 *@param direction    Description of Parameter
 	 *@return             The ScrollableBlockIncrement value
 	 ***************************************/
-
-	public int getScrollableBlockIncrement(Rectangle visibleRect, int orientation, int direction)
+	public int getScrollableBlockIncrement(
+		Rectangle visibleRect,
+		int orientation,
+		int direction)
 	{
-
-		return (int)(visibleRect.width * .9);
+		return (int) (visibleRect.width * .9);
 	}
-
-
 	/****************************************
 	 * Gets the ScrollableTracksViewportWidth attribute of the Visualizer
 	 *
 	 *@return   The ScrollableTracksViewportWidth value
 	 ***************************************/
-
 	public boolean getScrollableTracksViewportWidth()
 	{
 		return false;
 	}
-
 	/****************************************
 	 * Gets the ScrollableTracksViewportHeight attribute of the Visualizer
 	 *
@@ -223,203 +200,200 @@ public class StatVisualizer extends AbstractVisualizer implements Scrollable, Gr
 	{
 		return true;
 	}
-
 	/****************************************
 	 * Clears this visualizer, it model, and forces a repaint of the table
 	 ***************************************/
 	public void clear()
 	{
 		myStatTableModel.clear();
-		myJTable.tableChanged(new TableModelEvent(myStatTableModel));
 		model.clear();
 	}
 
-	/****************************************
-	 * Called by the model when the model has changed, and probably called by the
-	 * GUI when componets are resized, I'm guessing.
-	 ***************************************/
-	public void updateGui()
-	{
-		if(updateChart(myJTable, model.getURLStats()))
-		{
-			myJTable.tableChanged(new TableModelEvent(myStatTableModel));
-		}
-	}
-
 	/****************************************
 	 * !ToDo (Method description)
 	 *
 	 *@param s  !ToDo (Parameter description)
 	 ***************************************/
-	public void updateGui(Sample s)
+	public void updateGui(RunningSample s)
 	{
-		updateGui();
+		myStatTableModel.rowChanged(s.getIndex());
 	}
-
 	// overrides AbstractVisualizer
 	// forces GUI update after sample file has been read
 	public TestElement createTestElement()
 	{
 		TestElement t = super.createTestElement();
 		sleepTill = 0;
-		updateGui();
 		return t;
 	}
-
-	/****************************************
-	 * Main method to update the chart with data contained in the passed-in-map. No
-	 * matter how quickly you repeatedly call this method, the table will only be
-	 * updated at most once per second.
-	 *
-	 *@param aTable   !ToDo (Parameter description)
-	 *@param dataset  !ToDo (Parameter description)
-	 *@return         A flag whether or not the graph was updated at all
-	 ***************************************/
-	public boolean updateChart(JTable aTable, Map dataset)
-	{
-		// some logic here so that if we're getting calls to update the chart 5000x/sec, we only do it once a second.
-
-		// it's too busy otherwise.
-
-		if(System.currentTimeMillis() < sleepTill)
-		{
-
-			// Sleeping.. won't update yet
-
-			return false;
-		}
-		else
-		{
-
-			sleepTill = System.currentTimeMillis() + 1000L;
-
-		}
-
-		// go through the dataset and plop values in the table
-
-		Iterator e = dataset.keySet().iterator();
-
-		int ridx = -1;
-
-		while(e.hasNext())
-		{
-
-			ridx++;
-
-			String thisKey = (String)e.next();
-
-			RunningSample rs = (RunningSample)dataset.get(thisKey);
-
-			aTable.setValueAt((String)thisKey, ridx, 0);
-
-			aTable.setValueAt(new Long(rs.getNumSamples()), ridx, 1);
-
-			aTable.setValueAt(new Long(rs.getAverage()), ridx, 2);
-
-			aTable.setValueAt(new Long(rs.getMin()), ridx, 3);
-
-			aTable.setValueAt(new Long(rs.getMax()), ridx, 4);
-
-			aTable.setValueAt(rs.getErrorPercentageString(), ridx, 5);
-
-			aTable.setValueAt(rs.getRateString(), ridx, 6);
-
-			if(rs.getErrorPercentage() > .5)
-			{
-
-				// have some fun with cell renderers later, change this text to red or something.
-
-				// here is where the logic would be.
-
-			}
-
-		}
-		// while
-
-		// we ended up updating the data in the table, so we'll return true so our caller can force a repaint
-
-		// of components
-
-		return (true);
-	}
-
-
 	/****************************************
 	 * Main visualizer setup..
 	 ***************************************/
-
 	private void init()
 	{
-
 		this.setLayout(new BorderLayout());
-
 		// MAIN PANEL
-
 		JPanel mainPanel = new JPanel();
-
 		Border margin = new EmptyBorder(10, 10, 5, 10);
-
 		mainPanel.setBorder(margin);
-
 		mainPanel.setLayout(new VerticalLayout(5, VerticalLayout.LEFT));
-
 		// TITLE
-
-		JLabel panelTitleLabel = new JLabel("Aggregate Report");
-
+		JLabel panelTitleLabel = new JLabel(VISUALIZER_NAME);
 		Font curFont = panelTitleLabel.getFont();
-
 		int curFontSize = curFont.getSize();
-
 		curFontSize += 4;
-
-		panelTitleLabel.setFont(new Font(curFont.getFontName(), curFont.getStyle(), curFontSize));
-
+		panelTitleLabel.setFont(
+			new Font(curFont.getFontName(), curFont.getStyle(), curFontSize));
 		mainPanel.add(panelTitleLabel);
 		mainPanel.add(getFilePanel());
-
-		myStatTableModel = new StatTableModel();
-
-//        SortFilterModel mySortedModel = new SortFilterModel(myStatTableModel);
-
+		myStatTableModel = new StatTableModel(model);
+		//        SortFilterModel mySortedModel = new SortFilterModel(myStatTableModel);
 		myJTable = new JTable(myStatTableModel);
+		myJTable.setPreferredScrollableViewportSize(new Dimension(500, 70));
+		myScrollPane = new JScrollPane(myJTable);
+		this.add(mainPanel, BorderLayout.NORTH);
+		this.add(myScrollPane, BorderLayout.CENTER);
+	}
+	/****************************************
+	 * Class which implements the model for our main table in this
+	 * visualizer.
+	 *
+	 * @author    $Author: seade $
+	 * @created   $Date: 2003/01/07 02:54:50 $
+	 * @version   $Revision: 1.8 $
+	 ***************************************/
+	class StatTableModel extends AbstractTableModel
+	{
+		private final String[] columnNames =
+			{ "URL", "Count", "Average", "Min", "Max", "Error%", "Rate" };
+		private final Class[] columnClasses =
+			{ String.class, Long.class, Long.class, Long.class, Long.class, String.class, String.class };
+		private final String TOTAL_LABEL= JMeterUtils.getResString("aggregate_report_total_label");
 
-		myJTable.setPreferredScrollableViewportSize(
-				new Dimension(500, 70));
+		private transient StatVisualizerModel model;
+		private int currentRowCount= 0;
 
-		myScrollPane = new JScrollPane(myJTable);
+		/****************************************
+		 * !ToDo (Constructor description)
+		 ***************************************/
+		public StatTableModel(StatVisualizerModel model)
+		{
+			super();
+			this.model= model;
+		}
+		
+		public void rowChanged(int index) {
+			TableModelEvent event;
+
+			// Create the table changed event, carefully handling the case where the
+			// table grows beyond its current known size:
+			synchronized(this) {
+			  if (index >= currentRowCount-1) {
+			    event= new TableModelEvent(this, currentRowCount-1, index, TableModelEvent.ALL_COLUMNS, TableModelEvent.INSERT);
+			    currentRowCount= index+2;
+			  }
+			  else event= new TableModelEvent(this, index);
+			}
+			// Fire the event:
+			fireTableChanged(event);
+			// No matter which row changes, the totals row will have changed too:
+			fireTableChanged(new TableModelEvent(this, currentRowCount));
+		}
 
-		this.add(mainPanel, BorderLayout.NORTH);
+		/****************************************
+		 * !ToDoo (Method description)
+		 *
+		 *@return   !ToDo (Return description)
+		 ***************************************/
+		public int getColumnCount()
+		{
+			return columnNames.length;
+		}
+		/****************************************
+		 * !ToDoo (Method description)
+		 *
+		 *@return   !ToDo (Return description)
+		 ***************************************/
+		public int getRowCount()
+		{
+			currentRowCount= model.getRunningSampleCount() + 1;
+			return currentRowCount;
+		}
+		/****************************************
+		 * !ToDoo (Method description)
+		 *
+		 *@param col  !ToDo (Parameter description)
+		 *@return     !ToDo (Return description)
+		 ***************************************/
+		public String getColumnName(int col)
+		{
+			return columnNames[col];
+		}
+		/****************************************
+		 * !ToDoo (Method description)
+		 *
+		 *@param row  !ToDo (Parameter description)
+		 *@param col  !ToDo (Parameter description)
+		 *@return     !ToDo (Return description)
+		 ***************************************/
+		public Object getValueAt(int row, int col)
+		{
+			RunningSample s;
 
-		this.add(myScrollPane, BorderLayout.CENTER);
+			if (row==model.getRunningSampleCount()) {
+			  if (col==0) return TOTAL_LABEL;
+			  s= model.getRunningSampleTotal();
+			}
+			else {
+			  s= model.getRunningSample(row);
+			}
 
+			switch (col) {
+			  case 0: return s.getLabel();
+			  case 1: return new Long(s.getNumSamples());
+			  case 2: return new Long(s.getAverage());
+			  case 3: return new Long(s.getMin());
+			  case 4: return new Long(s.getMax());
+			  case 5: return s.getErrorPercentageString();
+			  case 6: return s.getRateString();
+			  default: return "__ERROR__";
+			}
+		}
+		/****************************************
+		 * !ToDoo (Method description)
+		 *
+		 *@param c  !ToDo (Parameter description)
+		 *@return   !ToDo (Return description)
+		 ***************************************/
+		public Class getColumnClass(int c)
+		{
+			return columnClasses[c];
+		}
+		/****************************************
+		 * !ToDo (Method description)
+		 ***************************************/
+		public void clear()
+		{
+			fireTableDataChanged();
+		}
 	}
-
+	// class StatTableModel
 }
 // class StatVisualizer
-
-
 /****************************************
  * Pulled this mainly out of a Core Java book to implement a sorted table -
  * haven't implemented this yet, it needs some non-trivial work done to it to
  * support our dynamically-sizing TableModel for this visualizer.
  *
- *@author    $Author: mstover1 $
- *@created   $Date: 2002/08/11 19:24:41 $
- *@version   $Revision: 1.1 $
+ *@author    $Author: seade $
+ *@created   $Date: 2003/01/07 02:54:50 $
+ *@version   $Revision: 1.8 $
  ***************************************/
-
 class SortFilterModel extends AbstractTableModel
 {
-
-
 	private TableModel model;
-
 	private int sortColumn;
-
 	private Row[] rows;
-
-
 	/****************************************
 	 * !ToDo (Constructor description)
 	 *
@@ -427,23 +401,18 @@ class SortFilterModel extends AbstractTableModel
 	 ***************************************/
 	public SortFilterModel(TableModel m)
 	{
-
 		model = m;
-
 		rows = new Row[model.getRowCount()];
-
-		for(int i = 0; i < rows.length; i++)
+		for (int i = 0; i < rows.length; i++)
 		{
-
 			rows[i] = new Row();
-
 			rows[i].index = i;
-
 		}
-
 	}
-
-
+	
+	public SortFilterModel()
+	{
+	}
 	/****************************************
 	 * !ToDo (Method description)
 	 *
@@ -453,12 +422,8 @@ class SortFilterModel extends AbstractTableModel
 	 ***************************************/
 	public void setValueAt(Object aValue, int r, int c)
 	{
-
 		model.setValueAt(aValue, rows[r].index, c);
-
 	}
-
-
 	/****************************************
 	 * !ToDoo (Method description)
 	 *
@@ -468,11 +433,8 @@ class SortFilterModel extends AbstractTableModel
 	 ***************************************/
 	public Object getValueAt(int r, int c)
 	{
-
 		return model.getValueAt(rows[r].index, c);
 	}
-
-
 	/****************************************
 	 * !ToDoo (Method description)
 	 *
@@ -482,11 +444,8 @@ class SortFilterModel extends AbstractTableModel
 	 ***************************************/
 	public boolean isCellEditable(int r, int c)
 	{
-
 		return model.isCellEditable(rows[r].index, c);
 	}
-
-
 	/****************************************
 	 * !ToDoo (Method description)
 	 *
@@ -494,11 +453,8 @@ class SortFilterModel extends AbstractTableModel
 	 ***************************************/
 	public int getRowCount()
 	{
-
 		return model.getRowCount();
 	}
-
-
 	/****************************************
 	 * !ToDoo (Method description)
 	 *
@@ -506,11 +462,8 @@ class SortFilterModel extends AbstractTableModel
 	 ***************************************/
 	public int getColumnCount()
 	{
-
 		return model.getColumnCount();
 	}
-
-
 	/****************************************
 	 * !ToDoo (Method description)
 	 *
@@ -519,11 +472,8 @@ class SortFilterModel extends AbstractTableModel
 	 ***************************************/
 	public String getColumnName(int c)
 	{
-
 		return model.getColumnName(c);
 	}
-
-
 	/****************************************
 	 * !ToDoo (Method description)
 	 *
@@ -532,11 +482,8 @@ class SortFilterModel extends AbstractTableModel
 	 ***************************************/
 	public Class getColumnClass(int c)
 	{
-
 		return model.getColumnClass(c);
 	}
-
-
 	/****************************************
 	 * !ToDo (Method description)
 	 *
@@ -544,16 +491,10 @@ class SortFilterModel extends AbstractTableModel
 	 ***************************************/
 	public void sort(int c)
 	{
-
 		sortColumn = c;
-
 		Arrays.sort(rows);
-
 		fireTableDataChanged();
-
 	}
-
-
 	/****************************************
 	 * !ToDo
 	 *
@@ -561,48 +502,33 @@ class SortFilterModel extends AbstractTableModel
 	 ***************************************/
 	public void addMouseListener(final JTable table)
 	{
-
-		table.getTableHeader().addMouseListener(
-			new MouseAdapter()
+		table.getTableHeader().addMouseListener(new MouseAdapter()
+		{
+			public void mouseClicked(MouseEvent event)
 			{
-
-				public void mouseClicked(MouseEvent event)
+				if (event.getClickCount() < 2)
 				{
-
-					if(event.getClickCount() < 2)
-					{
-						return;
-					}
-
-					int tableColumn = table.columnAtPoint(event.getPoint());
-
-					int modelColumn = table.convertColumnIndexToModel(tableColumn);
-
-					sort(modelColumn);
-
+					return;
 				}
-
-			});
-
+				int tableColumn = table.columnAtPoint(event.getPoint());
+				int modelColumn = table.convertColumnIndexToModel(tableColumn);
+				sort(modelColumn);
+			}
+		});
 	}
-
-
 	/****************************************
 	 * !ToDo (Class description)
 	 *
-	 *@author    $Author: mstover1 $
-	 *@created   $Date: 2002/08/11 19:24:41 $
-	 *@version   $Revision: 1.1 $
+	 *@author    $Author: seade $
+	 *@created   $Date: 2003/01/07 02:54:50 $
+	 *@version   $Revision: 1.8 $
 	 ***************************************/
 	private class Row implements Comparable
 	{
-
 		/****************************************
 		 * !ToDo (Field description)
 		 ***************************************/
 		public int index;
-
-
 		/****************************************
 		 * !ToDo (Method description)
 		 *
@@ -611,212 +537,18 @@ class SortFilterModel extends AbstractTableModel
 		 ***************************************/
 		public int compareTo(Object other)
 		{
-
-			Row otherRow = (Row)other;
-
+			Row otherRow = (Row) other;
 			Object a = model.getValueAt(index, sortColumn);
-
 			Object b = model.getValueAt(otherRow.index, sortColumn);
-
-			if(a instanceof Comparable)
+			if (a instanceof Comparable)
 			{
-
-				return ((Comparable)a).compareTo(b);
+				return ((Comparable) a).compareTo(b);
 			}
 			else
 			{
-
 				return index - otherRow.index;
 			}
-
 		}
-
 	}
-
 }
 // class SortFilterModel
-
-
-/****************************************
- * Class which implements the model for our main table in this visualizer.
- *
- *@author    $Author: mstover1 $
- *@created   $Date: 2002/08/11 19:24:41 $
- *@version   $Revision: 1.1 $
- ***************************************/
-
-class StatTableModel extends AbstractTableModel
-{
-
-
-	final String[] columnNames = {"URL",
-			"Count",
-			"Average",
-			"Min",
-			"Max",
-			"Error%",
-			"Rate"};
-
-	Vector data;
-
-
-	/****************************************
-	 * !ToDo (Constructor description)
-	 ***************************************/
-	public StatTableModel()
-	{
-
-		super();
-
-		data = new Vector();
-
-	}
-
-
-	/****************************************
-	 * !ToDo (Method description)
-	 *
-	 *@param value  !ToDo (Parameter description)
-	 *@param row    !ToDo (Parameter description)
-	 *@param col    !ToDo (Parameter description)
-	 ***************************************/
-	public void setValueAt(Object value, int row, int col)
-	{
-
-		Object[] temp;
-
-		//Extends the size of the vector as needed (can be used for append)
-
-		if(row >= data.size())
-		{
-
-			data.setSize(row + 1);
-
-		}
-
-		//Check if the line is not empty
-
-		if((Object[])(data.get(row)) == null)
-		{
-
-			temp = new Object[this.getColumnCount()];
-
-		}
-		else
-		{
-
-			temp = (Object[])(data.get(row));
-
-		}
-
-		temp[col] = value;
-
-		//Columns are stored as an array
-
-		data.set(row, temp);
-
-	}
-
-
-	/****************************************
-	 * !ToDoo (Method description)
-	 *
-	 *@return   !ToDo (Return description)
-	 ***************************************/
-	public int getColumnCount()
-	{
-
-		return columnNames.length;
-	}
-
-
-	/****************************************
-	 * !ToDoo (Method description)
-	 *
-	 *@return   !ToDo (Return description)
-	 ***************************************/
-	public int getRowCount()
-	{
-
-		return data.size();
-	}
-
-
-	/****************************************
-	 * !ToDoo (Method description)
-	 *
-	 *@param col  !ToDo (Parameter description)
-	 *@return     !ToDo (Return description)
-	 ***************************************/
-	public String getColumnName(int col)
-	{
-
-		return columnNames[col];
-	}
-
-
-	/****************************************
-	 * !ToDoo (Method description)
-	 *
-	 *@param row  !ToDo (Parameter description)
-	 *@param col  !ToDo (Parameter description)
-	 *@return     !ToDo (Return description)
-	 ***************************************/
-	public Object getValueAt(int row, int col)
-	{
-
-		//When created, rows are null, need to check that
-
-		if((((Object[])data.get(row))[col]) != null)
-		{
-
-			return (((Object[])(data.get(row)))[col]);
-		}
-		else
-		{
-
-			return (" ");
-		}
-
-	}
-
-
-	/****************************************
-	 * !ToDoo (Method description)
-	 *
-	 *@param c  !ToDo (Parameter description)
-	 *@return   !ToDo (Return description)
-	 ***************************************/
-	public Class getColumnClass(int c)
-	{
-
-		return getValueAt(0, c).getClass();
-	}
-
-
-	/****************************************
-	 * !ToDo (Method description)
-	 ***************************************/
-	public void clear()
-	{
-
-		data.clear();
-
-	}
-
-
-	/****************************************
-	 * !ToDo (Method description)
-	 *
-	 *@param row  !ToDo (Parameter description)
-	 ***************************************/
-	public void insertRowAt(int row)
-	{
-
-		data.insertElementAt(new Object[this.getColumnCount()], row);
-
-	}
-
-}
-// class StatTableModel
-
diff --git a/jakarta-jmeter/src/components/org/apache/jmeter/visualizers/StatVisualizerModel.java b/jakarta-jmeter/src/components/org/apache/jmeter/visualizers/StatVisualizerModel.java
index 274596a..a6ddfc7 100644
--- a/jakarta-jmeter/src/components/org/apache/jmeter/visualizers/StatVisualizerModel.java
+++ b/jakarta-jmeter/src/components/org/apache/jmeter/visualizers/StatVisualizerModel.java
@@ -52,14 +52,13 @@
  * information on the Apache Software Foundation, please see
  * <http://www.apache.org/>.
  */
-package org.apache.jmeter.visualizers;// java
-import java.util.*;// apache
+package org.apache.jmeter.visualizers; // java
+import java.util.*; // apache
+import junit.framework.TestCase;
 import org.apache.jmeter.samplers.Clearable;
 import org.apache.jmeter.samplers.SampleListener;
 import org.apache.jmeter.samplers.SampleResult;
 import org.apache.jmeter.util.JMeterUtils;
-
-
 /****************************************
  * Title: StatVisualizerModel.java Description: Aggregrate Table-Based Reporting
  * Model for JMeter Props to the people who've done the other visualizers ahead
@@ -71,49 +70,32 @@ import org.apache.jmeter.util.JMeterUtils;
  *@created   March 21, 2002
  *@version   1.0
  ***************************************/
-
 public class StatVisualizerModel implements Clearable
 {
-
 	private String name;
-
 	private List listeners;
+	private Vector runningSamples;
 	private Map labelMap;
+	private RunningSample total;
 
 	/****************************************
 	 * Default Constuctor
 	 ***************************************/
-
 	public StatVisualizerModel()
 	{
 		listeners = new LinkedList();
+		runningSamples = new Vector(0, 10);
 		labelMap = Collections.synchronizedMap(new HashMap(10));
+		total = new RunningSample("__TOTAL__", -1);
 	}
-
 	/****************************************
 	 * Sets the Name attribute of the StatVisualizerModel object
 	 *
 	 *@param name  The new Name value
 	 ***************************************/
-
 	public void setName(String name)
 	{
-
 		this.name = name;
-
-	}
-
-	/****************************************
-	 * Returns the Map containing the Samples we've collected and their
-	 * corresponding RunningSample instance.
-	 *
-	 *@return   The URLStats value
-	 ***************************************/
-
-	public Map getURLStats()
-	{
-
-		return (labelMap);
 	}
 
 	/****************************************
@@ -121,37 +103,52 @@ public class StatVisualizerModel implements Clearable
 	 *
 	 *@return   The GuiClass value
 	 ***************************************/
-
 	public Class getGuiClass()
 	{
-
 		return StatVisualizer.class;
 	}
-
-
-
 	/****************************************
 	 * Gets the Name attribute of the StatVisualizerModel object
 	 *
 	 *@return   The Name value
 	 ***************************************/
-
 	public String getName()
 	{
 		return name;
 	}
-
 	/****************************************
 	 * Registers a listener (a visualizer, graph, etc) to this model. This will
 	 * allow the model to fire GUI updates to anyone when data changes, etc.
 	 *
 	 *@param listener       !ToDo
 	 ***************************************/
-
 	public void addGraphListener(GraphListener listener)
 	{
 		listeners.add(listener);
 	}
+	
+	public void addAccumListener(AccumListener listener)
+	{
+		listeners.add(listener);
+	}
+
+	public int getRunningSampleCount() {
+	  	return runningSamples.size();
+	}
+
+	public RunningSample getRunningSample(int index)
+	{
+		return (RunningSample)runningSamples.get(index);
+	}
+
+	public RunningSample getRunningSample(String label)
+	{
+		return (RunningSample)labelMap.get(label);
+	}
+
+	public RunningSample getRunningSampleTotal() {
+	  	return total;
+	}
 
 	/****************************************
 	 * !ToDo
@@ -162,35 +159,30 @@ public class StatVisualizerModel implements Clearable
 	{
 		String aLabel = res.getSampleLabel();
 		String responseCode = res.getResponseCode();
-		RunningSample myRS;
-
-		if (labelMap.containsKey(aLabel))
-		{
-			myRS = (RunningSample)labelMap.get(aLabel);
+		RunningSample s;
+		synchronized(labelMap) {
+		  s= (RunningSample)labelMap.get(aLabel);
+		  if (s == null) {
+			  s = new RunningSample(aLabel, runningSamples.size());
+			  runningSamples.add(s);
+			  labelMap.put(aLabel, s);
+		  }
 		}
-		else
-		{
-			// put a new one there..
-			myRS = new RunningSample();
-			labelMap.put(aLabel, myRS);
-		}
-
-		myRS.addSample(res);
-		this.fireDataChanged();
+		s.addSample(res);
+		total.addSample(res);
+		this.fireDataChanged(s);
 	}
-
 	/****************************************
 	 * Reset everything we can in the model.
 	 ***************************************/
-
 	public void clear()
 	{
-//        System.out.println("StatVisualizerModel.clear() called");
 		// clear the data structures
+		runningSamples.clear();
 		labelMap.clear();
+		total= new RunningSample("__TOTAL__", -1);
 		this.fireDataChanged();
 	}
-
 	/****************************************
 	 * Called when the model changes - then we call out to all registered listeners
 	 * and tell them to update themselves.
@@ -198,16 +190,85 @@ public class StatVisualizerModel implements Clearable
 	protected void fireDataChanged()
 	{
 		Iterator iter = listeners.iterator();
-		while(iter.hasNext())
+		while (iter.hasNext())
+		{
+			Object myObj = iter.next();
+			if (!(myObj instanceof GraphListener))
+			{
+				continue;
+			}
+			((GraphListener) myObj).updateGui();
+		}
+	}
+	
+	protected void fireDataChanged(RunningSample s)
+	{
+		Iterator iter = listeners.iterator();
+		while (iter.hasNext())
 		{
 			Object myObj = iter.next();
-			if(!(myObj instanceof GraphListener))
+			if (!(myObj instanceof AccumListener))
 			{
 				continue;
 			}
-			((GraphListener)myObj).updateGui();
+			((AccumListener) myObj).updateGui(s);
 		}
 	}
 
-}
+	public static class Test extends junit.framework.TestCase
+	{
+	  public Test(String name)
+	  {
+	    super(name);
+	  }
+
+	  private SampleResult sample(String label, long timestamp,
+	      				long time, boolean ok)
+	  {
+	    SampleResult res= new SampleResult();
+	    res.setSampleLabel(label);
+	    res.setTimeStamp(timestamp);
+	    res.setTime(time);
+	    res.setSuccessful(ok);
+	    return res;
+	  }
+
+	  public void testStatisticsCalculation() {
+	    StatVisualizerModel m= new StatVisualizerModel();
+	    long t0= System.currentTimeMillis();
+	    m.addNewSample(sample("1", t0+0, 100, true));
+	    m.addNewSample(sample("2", t0+250, 200, true));
+	    m.addNewSample(sample("1", t0+500, 300, true));
+	    assertEquals(2, m.getRunningSampleCount());
+	    assertEquals(2, m.labelMap.size());
 
+	    {
+	    RunningSample s= m.getRunningSample("1");
+	    assertEquals("1", s.getLabel());
+	    assertEquals(2, s.getNumSamples());
+	    assertEquals(100, s.getMin());
+	    assertEquals(300, s.getMax());
+	    assertEquals(200, s.getAverage());
+	    assertEquals(4.0, s.getRate(), 1e-6);
+	    }
+
+	    {
+	    RunningSample s= m.getRunningSample("2");
+	    assertEquals("2", s.getLabel());
+	    assertEquals(1, s.getNumSamples());
+	    assertEquals(200, s.getMin());
+	    assertEquals(200, s.getMax());
+	    assertEquals(200, s.getAverage());
+	    }
+
+	    {
+	    RunningSample s= m.getRunningSampleTotal();
+	    assertEquals(3, s.getNumSamples());
+	    assertEquals(100, s.getMin());
+	    assertEquals(300, s.getMax());
+	    assertEquals(200, s.getAverage());
+	    assertEquals(6.0, s.getRate(), 1e-6);
+	    }
+	  }
+	}
+}
diff --git a/jakarta-jmeter/src/components/org/apache/jmeter/visualizers/TableDataModel.java b/jakarta-jmeter/src/components/org/apache/jmeter/visualizers/TableDataModel.java
index 66247d9..998cfda 100644
--- a/jakarta-jmeter/src/components/org/apache/jmeter/visualizers/TableDataModel.java
+++ b/jakarta-jmeter/src/components/org/apache/jmeter/visualizers/TableDataModel.java
@@ -1,3 +1,5 @@
+package org.apache.jmeter.visualizers;
+
 /*
  * ====================================================================
  * The Apache Software License, Version 1.1
@@ -53,26 +55,29 @@
  * <http://www.apache.org/>.
  */
 
-package org.apache.jmeter.visualizers;
+import java.util.ArrayList;
+import java.util.List;
 
-import org.apache.jmeter.gui.*;
-import java.util.*;
-import javax.swing.table.TableModel;
 import javax.swing.event.TableModelListener;
+import javax.swing.table.TableModel;
 
-import org.apache.jmeter.samplers.*;
+import org.apache.jmeter.samplers.SampleResult;
 import org.apache.jmeter.util.JMeterUtils;
+import org.apache.log.Hierarchy;
+import org.apache.log.Logger;
 
 /**
  *  This class implements the TableModel for the information kept
  *  by the GraphModel.
  *
- *@author     <a href="mailto:alf@i100.no">Alf Hogemark</a>Hogemark
- *@created    March 10, 2002
- *@version    1.0
+ * @author     <a href="mailto:alf@i100.no">Alf Hogemark</a>Hogemark
+ * @created    March 10, 2002
+ * @version    1.0
  */
 public class TableDataModel extends GraphModel implements TableModel
 {
+	transient private static Logger log = Hierarchy.getDefaultHierarchy().getLoggerFor(
+			"jmeter.gui");
 	List urlList = new ArrayList();
 
 	/**
@@ -92,6 +97,12 @@ public class TableDataModel extends GraphModel implements TableModel
 	{
 		return TableVisualizer.class;
 	}
+	
+	public void clear()
+	{
+		super.clear();
+		urlList.clear();
+	}
 
 	/**
 	 * Gets the ClassLabel attribute of the GraphModel object
@@ -100,7 +111,7 @@ public class TableDataModel extends GraphModel implements TableModel
 	 */
 	public String getClassLabel()
 	{
-		return "View Results in Table";
+		return JMeterUtils.getResString("view_results_in_table");
 	}
 
 	public Sample addNewSample(long time,long timeStamp,boolean success,String url)
@@ -115,6 +126,7 @@ public class TableDataModel extends GraphModel implements TableModel
 		Sample s = addNewSample(e.getTime(),e.getTimeStamp(),e.isSuccessful(),
 				(String)e.getSampleLabel());
 		fireDataChanged();
+		
 		return s;
 	}
 
@@ -182,15 +194,15 @@ public class TableDataModel extends GraphModel implements TableModel
 		{
 			if((rowIndex >= 0) && (rowIndex < getSampleCount()))
 			{
-				return new Integer(rowIndex);
+				return new Integer(rowIndex+1);
 			}
 		}
 		else if(columnIndex == 1)
 		{
-			System.out.print("rowIndex = "+rowIndex);
+			log.info("rowIndex = "+rowIndex);
 			if((rowIndex >= 0) && (rowIndex < urlList.size()))
 			{
-				System.out.println(" url = "+urlList.get(rowIndex));
+				log.info(" url = "+urlList.get(rowIndex));
 				return urlList.get(rowIndex);
 			}
 		}
@@ -231,6 +243,7 @@ public class TableDataModel extends GraphModel implements TableModel
 	public void removeTableModelListener(TableModelListener l)
 	{
 	}
+
 }
 
 
diff --git a/jakarta-jmeter/src/components/org/apache/jmeter/visualizers/TableVisualizer.java b/jakarta-jmeter/src/components/org/apache/jmeter/visualizers/TableVisualizer.java
index b11dd12..d719c94 100644
--- a/jakarta-jmeter/src/components/org/apache/jmeter/visualizers/TableVisualizer.java
+++ b/jakarta-jmeter/src/components/org/apache/jmeter/visualizers/TableVisualizer.java
@@ -53,17 +53,26 @@
  * <http://www.apache.org/>.
  */
 package org.apache.jmeter.visualizers;
-import java.awt.*;
-import java.awt.event.*;
-import java.util.*;
-import javax.swing.*;
-import javax.swing.border.*;
-import org.apache.jmeter.gui.*;
-import org.apache.jmeter.gui.util.VerticalLayout;
+import java.awt.BorderLayout;
+import java.awt.Color;
+import java.awt.FlowLayout;
+import java.awt.Font;
+
+import javax.swing.BorderFactory;
+import javax.swing.JLabel;
+import javax.swing.JPanel;
+import javax.swing.JScrollPane;
+import javax.swing.JTable;
+import javax.swing.JTextField;
+import javax.swing.border.Border;
+import javax.swing.border.EmptyBorder;
+import javax.swing.event.TableModelEvent;
+
 import org.apache.jmeter.samplers.Clearable;
 import org.apache.jmeter.samplers.SampleResult;
 import org.apache.jmeter.util.JMeterUtils;
 import org.apache.jmeter.visualizers.gui.AbstractVisualizer;
+import org.apache.jorphan.gui.layout.VerticalLayout;
 
 /****************************************
  * This class implements a statistical analyser that calculates both the average
@@ -72,7 +81,7 @@ import org.apache.jmeter.visualizers.gui.AbstractVisualizer;
  *
  *@author    <a href="mailto:alf@i100.no">Alf Hogemark</a>
  *@created   March 10, 2002
- *@version   $Revision: 1.1 $
+ *@version   $Revision: 1.4 $
  ***************************************/
 public class TableVisualizer extends AbstractVisualizer
 		 implements GraphListener, Clearable
@@ -104,7 +113,7 @@ public class TableVisualizer extends AbstractVisualizer
 	 ***************************************/
 	public String getStaticLabel()
 	{
-		return JMeterUtils.getResString("View Results in Table");
+		return JMeterUtils.getResString("view_results_in_table");
 	}
 
 	/****************************************
@@ -113,6 +122,7 @@ public class TableVisualizer extends AbstractVisualizer
 	public void updateGui()
 	{
 		// Not completely sure if this is the correct way of updating the table
+		table.tableChanged(new TableModelEvent(model));
 		tableScrollPanel.revalidate();
 		tableScrollPanel.repaint();
 		noSamplesField.setText(Long.toString(model.getSampleCount()));
@@ -140,6 +150,7 @@ public class TableVisualizer extends AbstractVisualizer
 	{
 		// We have received one more sample
 		// Not completely sure if this is the correct way of updating the table
+		table.tableChanged(new TableModelEvent(model));
 		tableScrollPanel.revalidate();
 		tableScrollPanel.repaint();
 		noSamplesField.setText(Long.toString(model.getSampleCount()));
@@ -185,7 +196,7 @@ public class TableVisualizer extends AbstractVisualizer
 		mainPanel.setLayout(new VerticalLayout(5, VerticalLayout.LEFT));
 
 		// TITLE
-		JLabel panelTitleLabel = new JLabel(JMeterUtils.getResString("View Results in Table"));
+		JLabel panelTitleLabel = new JLabel(JMeterUtils.getResString("view_results_in_table"));
 		Font curFont = panelTitleLabel.getFont();
 		int curFontSize = curFont.getSize();
 		curFontSize += 4;
diff --git a/jakarta-jmeter/src/components/org/apache/jmeter/visualizers/TreeVisualizer.java b/jakarta-jmeter/src/components/org/apache/jmeter/visualizers/TreeVisualizer.java
index 53fe256..d09788c 100644
--- a/jakarta-jmeter/src/components/org/apache/jmeter/visualizers/TreeVisualizer.java
+++ b/jakarta-jmeter/src/components/org/apache/jmeter/visualizers/TreeVisualizer.java
@@ -53,21 +53,26 @@
  * <http://www.apache.org/>.
  */
 package org.apache.jmeter.visualizers;
-import java.awt.*;
-import java.awt.event.*;
-import java.util.*;
-import javax.swing.*;
-import javax.swing.event.*;
-import javax.swing.tree.*;
-import junit.framework.*;
-import org.apache.jmeter.gui.*;
-import org.apache.jmeter.gui.tree.*;
-import org.apache.jmeter.protocol.http.sampler.HTTPSamplerFull;
+import java.awt.Dimension;
+import java.awt.GridBagConstraints;
+import java.awt.GridBagLayout;
+import java.awt.GridLayout;
+
+import javax.swing.JPanel;
+import javax.swing.JScrollPane;
+import javax.swing.JSplitPane;
+import javax.swing.JTree;
+import javax.swing.event.TreeSelectionEvent;
+import javax.swing.event.TreeSelectionListener;
+import javax.swing.tree.DefaultMutableTreeNode;
+import javax.swing.tree.DefaultTreeModel;
+import javax.swing.tree.TreeSelectionModel;
+
 import org.apache.jmeter.reporters.ResultCollector;
 import org.apache.jmeter.samplers.Clearable;
 import org.apache.jmeter.samplers.SampleResult;
-import org.apache.jmeter.samplers.Sampler;
-import org.apache.log4j.*;
+import org.apache.log.Hierarchy;
+import org.apache.log.Logger;
 /****************************************
  * Allows the tester to view the textual response from sampling an Entry. This
  * also allows to "single step through" the sampling process via a nice
@@ -123,8 +128,7 @@ public abstract class TreeVisualizer extends JPanel
 
 	ResultCollector model;
 
-	private static Category catClass =
-			Category.getInstance(TreeVisualizer.class.getName());
+	transient private static Logger log = Hierarchy.getDefaultHierarchy().getLoggerFor("jmeter.gui");
 
 	//----- TreeSelectionListener interface : end -----
 
@@ -135,8 +139,8 @@ public abstract class TreeVisualizer extends JPanel
 	{
 		super();
 		this.setLayout(new GridLayout(1, 1));
-		catClass.debug("Start : TreeVisualizer1");
-		catClass.debug("End : TreeVisualizer1");
+		log.debug("Start : TreeVisualizer1");
+		log.debug("End : TreeVisualizer1");
 	}
 
 	//----- ModelSupported interface : start -----
@@ -148,11 +152,11 @@ public abstract class TreeVisualizer extends JPanel
 	 ***************************************/
 	public void setModel(Object model)
 	{
-		catClass.debug("Start : setModel1");
+		log.debug("Start : setModel1");
 		this.model = (ResultCollector)model;
 		this.model.setListener(this);
 		init();
-		catClass.debug("End : setModel1");
+		log.debug("End : setModel1");
 	}
 
 	/****************************************
@@ -176,11 +180,11 @@ public abstract class TreeVisualizer extends JPanel
 	 ***************************************/
 	public void clear()
 	{
-		catClass.debug("Start : clear1");
+		log.debug("Start : clear1");
 		int totalChild = root.getChildCount();
-		if(catClass.isDebugEnabled())
+		if(log.isDebugEnabled())
 		{
-			catClass.debug("clear1 : total child - " + totalChild);
+			log.debug("clear1 : total child - " + totalChild);
 		}
 		for(int i = 0; i < totalChild; i++)
 		{
@@ -193,7 +197,7 @@ public abstract class TreeVisualizer extends JPanel
 		resultPanel.repaint();
 		// reset the child index
 		childIndex = 0;
-		catClass.debug("End : clear1");
+		log.debug("End : clear1");
 	}
 
 	/****************************************
@@ -208,7 +212,7 @@ public abstract class TreeVisualizer extends JPanel
 	 ***************************************/
 	protected void init()
 	{
-		catClass.debug("Start : init1");
+		log.debug("Start : init1");
 		SampleResult rootSampleResult = new SampleResult();
 		rootSampleResult.setSampleLabel("Root");
 		root = new DefaultMutableTreeNode(rootSampleResult);
@@ -226,6 +230,6 @@ public abstract class TreeVisualizer extends JPanel
 		treeSplitPane = new JSplitPane(JSplitPane.VERTICAL_SPLIT,
 				treePane, resultPane);
 		add(treeSplitPane);
-		catClass.debug("End : init1");
+		log.debug("End : init1");
 	}
 }
diff --git a/jakarta-jmeter/src/components/org/apache/jmeter/visualizers/ViewResultsFullVisualizer.java b/jakarta-jmeter/src/components/org/apache/jmeter/visualizers/ViewResultsFullVisualizer.java
index a5aeadb..e57c3f4 100644
--- a/jakarta-jmeter/src/components/org/apache/jmeter/visualizers/ViewResultsFullVisualizer.java
+++ b/jakarta-jmeter/src/components/org/apache/jmeter/visualizers/ViewResultsFullVisualizer.java
@@ -2,7 +2,7 @@
  * ====================================================================
  * The Apache Software License, Version 1.1
  *
- * Copyright (c) 2001 The Apache Software Foundation.  All rights
+ * Copyright (c) 2002 The Apache Software Foundation.  All rights
  * reserved.
  *
  * Redistribution and use in source and binary forms, with or without
@@ -55,12 +55,17 @@
 package org.apache.jmeter.visualizers;
 import java.awt.BorderLayout;
 import java.awt.Color;
+import java.awt.Component;
 import java.awt.GridBagConstraints;
 import java.awt.GridBagLayout;
 import java.awt.Insets;
+import java.awt.event.ActionEvent;
+import java.awt.event.ActionListener;
 import java.io.UnsupportedEncodingException;
 
 import javax.swing.ImageIcon;
+import javax.swing.JButton;
+import javax.swing.JEditorPane;
 import javax.swing.JLabel;
 import javax.swing.JPanel;
 import javax.swing.JScrollPane;
@@ -69,17 +74,19 @@ import javax.swing.JTextArea;
 import javax.swing.JTree;
 import javax.swing.event.TreeSelectionEvent;
 import javax.swing.event.TreeSelectionListener;
+import javax.swing.text.html.HTMLEditorKit;
 import javax.swing.tree.DefaultMutableTreeNode;
+import javax.swing.tree.DefaultTreeCellRenderer;
 import javax.swing.tree.DefaultTreeModel;
 import javax.swing.tree.TreeSelectionModel;
 
-import org.apache.jmeter.gui.util.JLabeledTextArea;
 import org.apache.jmeter.samplers.Clearable;
 import org.apache.jmeter.samplers.SampleResult;
 import org.apache.jmeter.util.JMeterUtils;
 import org.apache.jmeter.visualizers.gui.AbstractVisualizer;
-import org.apache.log4j.Category;
-
+import org.apache.log.Hierarchy;
+import org.apache.log.Logger;
+import org.apache.jorphan.gui.JLabeledTextArea;
 /****************************************
  * Allows the tester to view the textual response from sampling an Entry. This
  * also allows to "single step through" the sampling process via a nice
@@ -87,265 +94,412 @@ import org.apache.log4j.Category;
  *
  *@author    Khor Soon Hin
  *@created   2001/07/25
- *@version   $Revision: 1.1 $ $Date: 2002/08/11 19:24:41 $
+ *@version   $Revision: 1.14 $ $Date: 2003/01/17 21:00:09 $
  ***************************************/
-public class ViewResultsFullVisualizer extends AbstractVisualizer implements
-		TreeSelectionListener,Clearable
+public class ViewResultsFullVisualizer
+        extends AbstractVisualizer
+        implements ActionListener, TreeSelectionListener, Clearable
 {
+        public final static Color SERVER_ERROR_COLOR = Color.red;
+        public final static Color CLIENT_ERROR_COLOR = Color.blue;
+        public final static Color REDIRECT_COLOR = Color.green;
+        protected static final String HTML_BUTTON_LABEL = "Render HTML";
+        protected static final String TEXT_BUTTON_LABEL = "Show Text";
+        protected DefaultMutableTreeNode root;
+        protected DefaultTreeModel treeModel;
+        protected GridBagLayout gridBag;
+        protected GridBagConstraints gbc;
 
-	public final static Color SERVER_ERROR_COLOR = Color.red;
-	public final static Color CLIENT_ERROR_COLOR = Color.blue;
-	public final static Color REDIRECT_COLOR = Color.green;
-	protected DefaultMutableTreeNode root;
-	protected DefaultTreeModel treeModel;
-	protected GridBagLayout gridBag;
-	protected GridBagConstraints gbc;
-	protected JPanel resultPanel;
-	protected JScrollPane treePane;
-	protected JScrollPane resultPane;
-	protected JSplitPane treeSplitPane;
-	protected JTree jTree;
-	protected int childIndex;
+        /** The button that will pop up the response as rendered HTML or
+            text.  **/
+        protected JButton htmlOrTextButton;
 
-	private static Category catClass =
-			Category.getInstance(ViewResultsFullVisualizer.class.getName());
+        /** The response to be displayed.  **/
+        protected String response;
 
-	/****************************************
-	 * !ToDo (Constructor description)
-	 ***************************************/
-	public ViewResultsFullVisualizer()
-	{
-		super();
-		init();
-		catClass.debug("Start : ViewResultsFullVisualizer1");
-		catClass.debug("End : ViewResultsFullVisualizer1");
-	}
+        /** The pane where the rendered HTML response is displayed.  **/
+        transient protected JEditorPane htmlEditPane;
 
-	public void add(SampleResult res)
-	{
-		updateGui(res);
-	}
+        protected JPanel resultPanel;
+        protected JScrollPane treePane;
+        protected JScrollPane resultPane;
+        protected JSplitPane treeSplitPane;
+        /** The text area where the response is displayed.  **/
+        protected JTextArea textArea;
+        protected JTree jTree;
+        protected int childIndex;
+        transient private static Logger log =
+                Hierarchy.getDefaultHierarchy().getLoggerFor("jmeter.gui");
+        /****************************************
+         * !ToDo (Constructor description)
+         ***************************************/
+        public ViewResultsFullVisualizer()
+        {
+                super();
+                init();
+                log.debug("Start : ViewResultsFullVisualizer1");
+                log.debug("End : ViewResultsFullVisualizer1");
+        }
+        public void add(SampleResult res)
+        {
+                updateGui(res);
+        }
+        public String getStaticLabel()
+        {
+                return JMeterUtils.getResString("view_results_tree_title");
+        }
+        /****************************************
+         * Update the visualizer with new data
+         ***************************************/
+        public void updateGui(SampleResult res)
+        {
+                log.debug("Start : updateGui1");
+                if (log.isDebugEnabled())
+                        log.debug("updateGui1 : sample result - " + res);
+                DefaultMutableTreeNode currNode = new DefaultMutableTreeNode(res);
+                treeModel.insertNodeInto(currNode, root, root.getChildCount());
+                addSubResults(currNode, res);
+                log.debug("End : updateGui1");
+       }
 
-	public String getStaticLabel()
-	{
-		return JMeterUtils.getResString("view_results_tree_title");
-	}
+       private void addSubResults(DefaultMutableTreeNode currNode,
+                                  SampleResult res) {
+                SampleResult[] subResults = res.getSubResults();
+                if (subResults != null)
+                {
+                        int leafIndex = 0;
+                        for (int i = 0; i < subResults.length; i++)
+                        {
+                                SampleResult child = subResults[i];
+                                if (log.isDebugEnabled())
+                                        log.debug("updateGui1 : child sample result - " + child);
+                                DefaultMutableTreeNode leafNode = new DefaultMutableTreeNode(child);
+                                treeModel.insertNodeInto(leafNode, currNode, leafIndex++);
+                                addSubResults(leafNode, child);
+                        }
+                }
+        }
+        /****************************************
+         * Clears the visualizer
+         ***************************************/
+        public void clear()
+        {
+                log.debug("Start : clear1");
+                int totalChild = root.getChildCount();
+                if (log.isDebugEnabled())
+                        log.debug("clear1 : total child - " + totalChild);
+                for (int i = 0; i < totalChild; i++)                    // the child to be removed will always be 0 'cos as the nodes are removed
+                        // the nth node will become (n-1)th
+                        treeModel.removeNodeFromParent(
+                                (DefaultMutableTreeNode) root.getChildAt(0));
+                resultPanel.removeAll();
+                resultPanel.revalidate();
+                // reset the child index
+                childIndex = 0;
+                log.debug("End : clear1");
+        }
+        /****************************************
+         * Returns the description of this visualizer
+         *
+         *@return   description of this visualizer
+         ***************************************/
+        public String toString()
+        {
+                String desc = "Shows the text results of sampling in tree form";
+                if (log.isDebugEnabled())
+                        log.debug("toString1 : Returning description - " + desc);
+                return desc;
+        }
+        /****************************************
+         * Sets the bottom pane to correspond to the selected node of the top tree
+         *
+         *@param e  !ToDo (Parameter description)
+         ***************************************/
+        public void valueChanged(TreeSelectionEvent e)
+        {
+                log.debug("Start : valueChanged1");
+                DefaultMutableTreeNode node =
+                        (DefaultMutableTreeNode) jTree.getLastSelectedPathComponent();
+                if (log.isDebugEnabled())
+                        log.debug("valueChanged : selected node - " + node);
+                if (node != null)
+                {
+                        SampleResult res = (SampleResult) node.getUserObject();
+                        if (log.isDebugEnabled())
+                                log.debug("valueChanged1 : sample result - " + res);
+                        if (res != null)
+                        {
+                                resultPanel.removeAll();
+                                // load time label
+                                JLabel loadTime = new JLabel();
+                                log.debug("valueChanged1 : load time - " + res.getTime());
+                                loadTime.setText("Load time : " + res.getTime());
+                                gbc.gridx = 0;
+                                gbc.gridy = 0;
+                                // keep all of the labels to the left
+                                gbc.anchor = GridBagConstraints.WEST;
+                                // with weightx != 0.0, components won't clump in the center
+                                gbc.weightx = 1.0;
+                                // pad a bit from the display area
+                                gbc.insets = new Insets(0, 10, 0, 0);
+                                if (res != null && res.getSamplerData() != null)
+                                {
+                                        JLabeledTextArea postData =
+                                                new JLabeledTextArea(
+                                                        JMeterUtils.getResString("request_data"),
+                                                        null);
+                                        postData.setText(res.getSamplerData().toString());
+                                        resultPanel.add(postData, gbc.clone());
+                                        gbc.gridy++;
+                                }
+                                resultPanel.add(loadTime, gbc.clone());
+                                // response code label
+                                JLabel httpResponseCode = new JLabel();
+                                String responseCode = res.getResponseCode();
+                                log.debug("valueChanged1 : response code - " + responseCode);
+                                int responseLevel = 0;
+                                if (responseCode != null)
+                                        try
+                                        {
+                                                responseLevel = Integer.parseInt(responseCode) / 100;
+                                        }
+                                        catch (NumberFormatException numberFormatException)
+                                        {
+                                                // no need to change the foreground color
+                                        }
+                                switch (responseLevel)
+                                {
+                                        case 3 :
+                                                httpResponseCode.setForeground(REDIRECT_COLOR);
+                                        case 4 :
+                                                httpResponseCode.setForeground(CLIENT_ERROR_COLOR);
+                                        case 5 :
+                                                httpResponseCode.setForeground(SERVER_ERROR_COLOR);
+                                }
+                                httpResponseCode.setText(
+                                        JMeterUtils.getResString("HTTP response code")
+                                                + " : "
+                                                + responseCode);
+                                gbc.gridx = 0;
+                                gbc.gridy++;
+                                gridBag.setConstraints(httpResponseCode, gbc);
+                                resultPanel.add(httpResponseCode);
+                                // response message label
+                                JLabel httpResponseMsg = new JLabel();
+                                String responseMsgStr = res.getResponseMessage();
+                                log.debug("valueChanged1 : response message - " + responseMsgStr);
+                                httpResponseMsg.setText("HTTP response message : " + responseMsgStr);
+                                gbc.gridx = 0;
+                                gbc.gridy++;
+                                gridBag.setConstraints(httpResponseMsg, gbc);
+                                resultPanel.add(httpResponseMsg);
+                                gbc.gridy++;
+                                // get the text response and image icon
+                                // to determine which is NOT null
+                                byte[] responseBytes = (byte[]) res.getResponseData();
+                                ImageIcon icon = null;
+                                if (res.getDataType() != null
+                                        && res.getDataType().equals(SampleResult.TEXT))
+                                {
+                                        try
+                                        {
+                                                response = new String(responseBytes, "utf-8");
+                                        }
+                                        catch (UnsupportedEncodingException err)
+                                        {
+                                                response = new String(responseBytes);
+                                        }
+                                }
+                                else if (responseBytes != null)
+                                {
+                                        icon = new ImageIcon(responseBytes);
+                                }
+                                if (response != null)
+                                {
+                                        gbc.gridx = 0;
+                                        gbc.gridy++;
+                                        gridBag.setConstraints(htmlOrTextButton,
+                                                               gbc);
+                                        resultPanel.add(htmlOrTextButton);
 
-	/****************************************
-	 * Update the visualizer with new data
-	 ***************************************/
-	public void updateGui(SampleResult res)
-	{
-		catClass.debug("Start : updateGui1");
+                                        // Text display <=> HTML labeled button
+                                        if (HTML_BUTTON_LABEL.equals(htmlOrTextButton.getText()))
+                                        {
+                                                showTextResponse(response);
+                                        }
+                                        // HTML display <=> Text labeled button
+                                        else
+                                        {
+                                                showRenderedResponse(response);
+                                        }
+                                }
+                                else if (icon != null)
+                                {
+                                        JLabel image = new JLabel();
+                                        image.setIcon(icon);
+                                        gbc.gridx = 0;
+                                        gridBag.setConstraints(image, gbc);
+                                        resultPanel.add(image);
+                                }
+                                resultPanel.repaint();
+                                resultPanel.revalidate();
+                        }
+                }
+                log.debug("End : valueChanged1");
+        }
 
-		if(catClass.isDebugEnabled())
-			catClass.debug("updateGui1 : sample result - " + res);
+        protected void initTextArea()
+        {
+                textArea = new JTextArea();
+                textArea.setColumns(70);
+                textArea.setLineWrap(true);
+                textArea.setWrapStyleWord(true);
+                textArea.setTabSize(4);
+                gridBag.setConstraints(textArea, gbc);
+                resultPanel.add(textArea);
+                gbc.gridy++;
+        }
 
-		DefaultMutableTreeNode currNode = new DefaultMutableTreeNode(res);
-		treeModel.insertNodeInto(currNode, root, root.getChildCount());
-		SampleResult[] subResults= res.getSubResults();
-		if(subResults != null)
-		{
-			int leafIndex = 0;
-			for(int i = 0;i < subResults.length;i++)
-			{
-				SampleResult child = subResults[i];
-				if(catClass.isDebugEnabled())
-					catClass.debug("updateGui1 : child sample result - " + child);
+        protected void showTextResponse(String response)
+        {
+                resultPanel.remove(htmlEditPane);
 
-				DefaultMutableTreeNode leafNode =
-						new DefaultMutableTreeNode(child);
-				treeModel.insertNodeInto(leafNode, currNode, leafIndex++);
-			}
-		}
-		catClass.debug("End : updateGui1");
-	}
+                gbc.gridx = 0;
+                gbc.gridy++;
+                gridBag.setConstraints(textArea, gbc);
+                textArea.setText(response);
+                textArea.setCaretPosition(0);
+                resultPanel.add(textArea);
+        }
 
-	/****************************************
-	 * Clears the visualizer
-	 ***************************************/
-	public void clear()
-	{
-		catClass.debug("Start : clear1");
-		int totalChild = root.getChildCount();
-		if(catClass.isDebugEnabled())
-			catClass.debug("clear1 : total child - " + totalChild);
 
-		for(int i = 0; i < totalChild; i++)
-			// the child to be removed will always be 0 'cos as the nodes are removed
-			// the nth node will become (n-1)th
-			treeModel.removeNodeFromParent(
-					(DefaultMutableTreeNode)root.getChildAt(0));
+        /**********************************************************************
+         * Display the response as text or as rendered HTML.  Change the
+         * text on the button appropriate to the current display.
+         * @param e the ActionEvent being processed
+         *********************************************************************/
 
-		resultPanel.removeAll();
-		resultPanel.revalidate();
-		// reset the child index
-		childIndex = 0;
-		catClass.debug("End : clear1");
-	}
+        public void actionPerformed(ActionEvent e)
+        {
+                // If the htmlOrTextButton is clicked, show the response in the
+                // appropriate way, and change the button label
+                if (htmlOrTextButton.equals(e.getSource()))
+                {
+                        // Show rendered HTML
+                        if (HTML_BUTTON_LABEL.equals(htmlOrTextButton.getText()))
+                        {
+                                showRenderedResponse(response);
+                                htmlOrTextButton.setText(TEXT_BUTTON_LABEL);
+                        }
+                        // Show the textual response
+                        else
+                        {
+                                showTextResponse(response);
+                                htmlOrTextButton.setText(HTML_BUTTON_LABEL);
+                        }
+                }
+        }
 
-	/****************************************
-	 * Returns the description of this visualizer
-	 *
-	 *@return   description of this visualizer
-	 ***************************************/
-	public String toString()
-	{
-		String desc = "Shows the text results of sampling in tree form";
-		if(catClass.isDebugEnabled())
-			catClass.debug("toString1 : Returning description - " + desc);
 
-		return desc;
-	}
+        protected void initHtmlEditPane()
+        {
+                htmlEditPane = new JEditorPane();
+                HTMLEditorKit htmlKit = new HTMLEditorKit();
+                htmlEditPane.setEditorKit(htmlKit);
+        }
 
-	/****************************************
-	 * Sets the bottom pane to correspond to the selected node of the top tree
-	 *
-	 *@param e  !ToDo (Parameter description)
-	 ***************************************/
-	public void valueChanged(TreeSelectionEvent e)
-	{
-		catClass.debug("Start : valueChanged1");
-		DefaultMutableTreeNode node = (DefaultMutableTreeNode)jTree.getLastSelectedPathComponent();
-		if(catClass.isDebugEnabled())
-			catClass.debug("valueChanged : selected node - " + node);
+        protected void showRenderedResponse(String response)
+        {
+                int htmlIndex = response.indexOf("<HTML>");
 
-		if(node != null)
-		{
-			SampleResult res = (SampleResult)node.getUserObject();
-			if(catClass.isDebugEnabled())
-				catClass.debug("valueChanged1 : sample result - " + res);
+                // Look for a case variation
+                if (htmlIndex < 0)
+                {
+                        htmlIndex = response.indexOf("<html>");
+                }
 
-			if(res != null)
-			{
-				resultPanel.removeAll();
-				// load time label
-				JLabel loadTime = new JLabel();
-				catClass.debug("valueChanged1 : load time - " + res.getTime());
-				loadTime.setText("Load time : " + res.getTime());
-				gbc.gridx = 0;
-				gbc.gridy = 0;
-				// keep all of the labels to the left
-				gbc.anchor = GridBagConstraints.WEST;
-				// with weightx != 0.0, components won't clump in the center
-				gbc.weightx = 1.0;
-				// pad a bit from the display area
-				gbc.insets = new Insets(0, 10, 0, 0);
-				if(res != null && res.getSamplerData() != null)
-				{
-					JLabeledTextArea postData = new JLabeledTextArea(JMeterUtils.getResString("request_data"),null);
-					postData.setText(res.getSamplerData().toString());
-					resultPanel.add(postData,gbc.clone());
-					gbc.gridy++;
-				}
-				resultPanel.add(loadTime,gbc.clone());
-				// response code label
-				JLabel httpResponseCode = new JLabel();
-				String responseCode = res.getResponseCode();
-				catClass.debug("valueChanged1 : response code - " + responseCode);
-				int responseLevel = 0;
-				if(responseCode != null)
-					try
-					{
-						responseLevel = Integer.parseInt(responseCode) / 100;
-					}
-					catch(NumberFormatException numberFormatException)
-					{
-						// no need to change the foreground color
-					}
+                // If there is text, render it
+                if (htmlIndex > -1)
+                {
+                        resultPanel.remove(textArea);
+                        String html = response.substring(htmlIndex, response.length());
+                        htmlEditPane.setText(html);
+                }
+                // No HTML tag, so try to render what's there
+                else
+                {
+                        htmlEditPane.setText(response);
+                }
+                htmlEditPane.setCaretPosition(0);
+                gbc.gridx = 0;
+                gbc.gridy++;
+                gridBag.setConstraints(htmlEditPane, gbc);
+                resultPanel.add(htmlEditPane);
 
-				switch (responseLevel)
-				{
-					case 3:
-						httpResponseCode.setForeground(REDIRECT_COLOR);
-					case 4:
-						httpResponseCode.setForeground(CLIENT_ERROR_COLOR);
-					case 5:
-						httpResponseCode.setForeground(SERVER_ERROR_COLOR);
-				}
-				httpResponseCode.setText(JMeterUtils.getResString("HTTP response code")+" : " +
-						responseCode);
-				gbc.gridx = 0;
-				gbc.gridy++;
-				gridBag.setConstraints(httpResponseCode, gbc);
-				resultPanel.add(httpResponseCode);
-				// response message label
-				JLabel httpResponseMsg = new JLabel();
-										  String responseMsgStr = res.getResponseMessage();
-										  catClass.debug("valueChanged1 : response message - " + responseMsgStr);
-				httpResponseMsg.setText("HTTP response message : " +
-						responseMsgStr);
-				gbc.gridx = 0;
-				gbc.gridy++;
-				gridBag.setConstraints(httpResponseMsg, gbc);
-				resultPanel.add(httpResponseMsg);
-				gbc.gridy++;
+        }
 
-				// get the text response and image icon
-				// to determine which is NOT null
-										  byte[] responseBytes = (byte[])res.getResponseData();
-				String response = null;
-				ImageIcon icon = null;
-										  if(res.getDataType() != null && res.getDataType().equals(SampleResult.TEXT))
-										  {
-											 try {
-												response = new String(responseBytes,"utf-8");
-											} catch(UnsupportedEncodingException err) {
-												response = new String(responseBytes);
-											}
-										  }
-										  else if(responseBytes != null)
-										  {
-											icon = new ImageIcon(responseBytes);
-										  }
-				if(response != null)
-				{
-					JTextArea textArea = new JTextArea();
-					textArea.setText(response);
-					gbc.gridx = 0;
-					gridBag.setConstraints(textArea, gbc);
-					resultPanel.add(textArea);
-				}
-				else if(icon != null)
-				{
-					JLabel image = new JLabel();
-					image.setIcon(icon);
-					gbc.gridx = 0;
-					gridBag.setConstraints(image, gbc);
-					resultPanel.add(image);
-				}
-				resultPanel.repaint();
-				resultPanel.revalidate();
-			}
-		}
-		catClass.debug("End : valueChanged1");
-	}
+        protected void initHtmlOrTextButton()
+        {
+                htmlOrTextButton = new JButton(HTML_BUTTON_LABEL);
+                htmlOrTextButton.addActionListener(this);
+        }
 
-	/****************************************
-	 * Initialize this visualizer
-	 ***************************************/
-	protected void init()
-	{
-		this.setLayout(new BorderLayout());
-		catClass.debug("Start : init1");
-		SampleResult rootSampleResult = new SampleResult();
-		rootSampleResult.setSampleLabel("Root");
-		root = new DefaultMutableTreeNode(rootSampleResult);
-		treeModel = new DefaultTreeModel(root);
-		jTree = new JTree(treeModel);
-		jTree.getSelectionModel().setSelectionMode(
-				TreeSelectionModel.SINGLE_TREE_SELECTION);
-		jTree.addTreeSelectionListener(this);
-		treePane = new JScrollPane(jTree);
-		gridBag = new GridBagLayout();
-		gbc = new GridBagConstraints();
-		resultPanel = new JPanel(gridBag);
-		resultPane = new JScrollPane(resultPanel);
-		treeSplitPane = new JSplitPane(JSplitPane.VERTICAL_SPLIT,
-				treePane, resultPane);
-		add(getFilePanel(),BorderLayout.NORTH);
-		add(treeSplitPane,BorderLayout.CENTER);
-		catClass.debug("End : init1");
-	}
-}
 
+        /****************************************
+         * Initialize this visualizer
+         ***************************************/
+        protected void init()
+        {
+                this.setLayout(new BorderLayout());
+                SampleResult rootSampleResult = new SampleResult();
+                rootSampleResult.setSampleLabel("Root");
+                rootSampleResult.setSuccessful(true);
+                root = new DefaultMutableTreeNode(rootSampleResult);
+                treeModel = new DefaultTreeModel(root);
+                jTree = new JTree(treeModel);
+                jTree.setCellRenderer(new ResultsNodeRenderer());
+                jTree.getSelectionModel().setSelectionMode(
+                        TreeSelectionModel.SINGLE_TREE_SELECTION);
+                jTree.addTreeSelectionListener(this);
+                treePane = new JScrollPane(jTree);
+                gridBag = new GridBagLayout();
+                gbc = new GridBagConstraints();
+                resultPanel = new JPanel(gridBag);
+                resultPane = new JScrollPane(resultPanel);
+                initHtmlOrTextButton();
+                initTextArea();
+                initHtmlEditPane();
+                treeSplitPane =
+                        new JSplitPane(JSplitPane.VERTICAL_SPLIT, treePane, resultPane);
+                getFilePanel().add(getErrorLoggingCheckbox());
+                add(getFilePanel(), BorderLayout.NORTH);
+                add(treeSplitPane, BorderLayout.CENTER);
+        }
+        private class ResultsNodeRenderer extends DefaultTreeCellRenderer
+        {
+                public Component getTreeCellRendererComponent(
+                        JTree tree,
+                        Object value,
+                        boolean sel,
+                        boolean expanded,
+                        boolean leaf,
+                        int row,
+                        boolean hasFocus)
+                {
+                        super.getTreeCellRendererComponent(
+                                tree,
+                                value,
+                                sel,
+                                expanded,
+                                leaf,
+                                row,
+                                hasFocus);
+                        if (!((SampleResult) ((DefaultMutableTreeNode) value).getUserObject())
+                                .isSuccessful())
+                        {
+                                this.setForeground(Color.red);
+                        }
+                        return this;
+                }
+        }
+}
diff --git a/jakarta-jmeter/src/core/CVS/Entries b/jakarta-jmeter/src/core/CVS/Entries
index 7509378..096477c 100644
--- a/jakarta-jmeter/src/core/CVS/Entries
+++ b/jakarta-jmeter/src/core/CVS/Entries
@@ -1,2 +1,2 @@
-/MANIFEST/1.1/Sun Aug 11 19:24:42 2002//Tv1_7_3
+/MANIFEST/1.1/Sun Aug 11 19:24:42 2002//Tv1_8_1
 D/org////
diff --git a/jakarta-jmeter/src/core/CVS/Tag b/jakarta-jmeter/src/core/CVS/Tag
index 5f312fe..e2fda28 100644
--- a/jakarta-jmeter/src/core/CVS/Tag
+++ b/jakarta-jmeter/src/core/CVS/Tag
@@ -1 +1 @@
-Nv1_7_3
+Nv1_8_1
diff --git a/jakarta-jmeter/src/core/org/CVS/Tag b/jakarta-jmeter/src/core/org/CVS/Tag
index f4b6a59..75ba187 100644
--- a/jakarta-jmeter/src/core/org/CVS/Tag
+++ b/jakarta-jmeter/src/core/org/CVS/Tag
@@ -1 +1 @@
-Tv1_7_3
+Tv1_8_1
diff --git a/jakarta-jmeter/src/core/org/apache/CVS/Tag b/jakarta-jmeter/src/core/org/apache/CVS/Tag
index f4b6a59..75ba187 100644
--- a/jakarta-jmeter/src/core/org/apache/CVS/Tag
+++ b/jakarta-jmeter/src/core/org/apache/CVS/Tag
@@ -1 +1 @@
-Tv1_7_3
+Tv1_8_1
diff --git a/jakarta-jmeter/src/core/org/apache/jmeter/CVS/Entries b/jakarta-jmeter/src/core/org/apache/jmeter/CVS/Entries
index bba5b7d..1dddf91 100644
--- a/jakarta-jmeter/src/core/org/apache/jmeter/CVS/Entries
+++ b/jakarta-jmeter/src/core/org/apache/jmeter/CVS/Entries
@@ -1,7 +1,7 @@
-/JMeter.java/1.1/Sun Aug 11 19:24:42 2002//Tv1_7_3
-/NewDriver.java/1.1/Sun Aug 11 19:24:42 2002//Tv1_7_3
-/ProxyAuthenticator.java/1.1/Sun Aug 11 19:24:42 2002//Tv1_7_3
-/help.txt/1.1/Sun Aug 11 19:24:42 2002//Tv1_7_3
+/JMeter.java/1.8/Sat Jan 11 11:21:07 2003//Tv1_8_1
+/NewDriver.java/1.3/Tue Oct 15 18:53:26 2002//Tv1_8_1
+/ProxyAuthenticator.java/1.1/Sun Aug 11 19:24:42 2002//Tv1_8_1
+/help.txt/1.1/Sun Aug 11 19:24:42 2002//Tv1_8_1
 D/assertions////
 D/config////
 D/control////
@@ -11,10 +11,12 @@ D/functions////
 D/gui////
 D/images////
 D/junit////
+D/plugin////
 D/reporters////
 D/resources////
 D/samplers////
 D/save////
+D/swing////
 D/testelement////
 D/threads////
 D/timers////
diff --git a/jakarta-jmeter/src/core/org/apache/jmeter/CVS/Tag b/jakarta-jmeter/src/core/org/apache/jmeter/CVS/Tag
index 5f312fe..e2fda28 100644
--- a/jakarta-jmeter/src/core/org/apache/jmeter/CVS/Tag
+++ b/jakarta-jmeter/src/core/org/apache/jmeter/CVS/Tag
@@ -1 +1 @@
-Nv1_7_3
+Nv1_8_1
diff --git a/jakarta-jmeter/src/core/org/apache/jmeter/JMeter.java b/jakarta-jmeter/src/core/org/apache/jmeter/JMeter.java
index 6f4922a..7284458 100644
--- a/jakarta-jmeter/src/core/org/apache/jmeter/JMeter.java
+++ b/jakarta-jmeter/src/core/org/apache/jmeter/JMeter.java
@@ -70,14 +70,29 @@ import org.apache.jmeter.exceptions.IllegalUserActionException;
 import org.apache.jmeter.gui.GuiPackage;
 import org.apache.jmeter.gui.action.ActionRouter;
 import org.apache.jmeter.gui.action.CheckDirty;
+import org.apache.jmeter.gui.action.Load;
 import org.apache.jmeter.gui.tree.JMeterTreeListener;
 import org.apache.jmeter.gui.tree.JMeterTreeModel;
-import org.apache.jmeter.gui.util.ComponentUtil;
 import org.apache.jmeter.reporters.ResultCollector;
 import org.apache.jmeter.save.SaveService;
 import org.apache.jmeter.testelement.TestListener;
 import org.apache.jmeter.util.JMeterUtils;
-import org.apache.jmeter.util.ListedHashTree;
+import org.apache.jmeter.plugin.JMeterPlugin;
+import org.apache.jmeter.plugin.PluginManager;
+import org.apache.jmeter.control.gui.TestPlanGui;
+import org.apache.jmeter.control.gui.AbstractControllerGui;
+import org.apache.jmeter.control.gui.WorkBenchGui;
+import org.apache.jmeter.threads.gui.ThreadGroupGui;
+import org.apache.jmeter.timers.gui.AbstractTimerGui;
+import org.apache.jmeter.visualizers.gui.AbstractVisualizer;
+import org.apache.jmeter.config.gui.AbstractModifierGui;
+import org.apache.jmeter.config.gui.AbstractConfigGui;
+import org.apache.jmeter.config.gui.AbstractResponseBasedModifierGui;
+import org.apache.jmeter.samplers.gui.AbstractSamplerGui;
+import org.apache.log.Hierarchy;
+import org.apache.log.Logger;
+import org.apache.jorphan.collections.HashTree;
+import org.apache.jorphan.gui.ComponentUtil;
 
 /**
  * @author mstover
@@ -85,7 +100,9 @@ import org.apache.jmeter.util.ListedHashTree;
  * To change this generated comment edit the template variable "typecomment":
  * Window>Preferences>Java>Templates.
  */
-public class JMeter {
+public class JMeter implements JMeterPlugin {
+	transient private static Logger log = Hierarchy.getDefaultHierarchy().getLoggerFor(
+			"jmeter");
 
 	private final static int PROPFILE_OPT = 'p';
 	private final static int TESTFILE_OPT = 't';
@@ -173,8 +190,9 @@ public class JMeter {
 	/**
 	 * Starts up JMeter in GUI mode
 	 */
-	public void startGui() throws IllegalUserActionException {
+	public void startGui(CLOption testFile) throws IllegalUserActionException, IllegalAccessException, ClassNotFoundException, InstantiationException {
 
+        PluginManager.install(this, true);
 		JMeterTreeModel treeModel = new JMeterTreeModel();
 		JMeterTreeListener treeLis = new JMeterTreeListener(treeModel);
 		treeLis.setActionHandler(ActionRouter.getInstance());
@@ -190,6 +208,20 @@ public class JMeter {
 		main.show();
 		ActionRouter.getInstance().actionPerformed(
 			new ActionEvent(main, 1, CheckDirty.ADD_ALL));
+		if(testFile != null)
+		{
+			try
+			{
+				File f = new File(testFile.getArgument());
+				FileInputStream reader = new FileInputStream(f);
+				HashTree tree = SaveService.loadSubTree(reader);
+				new Load().insertLoadedTree(1,tree);
+			}
+			catch (Exception e)
+			{
+				log.error("Failure loading test file",e);
+			}
+		}
 	}
 
 	/**
@@ -215,7 +247,7 @@ public class JMeter {
 			} else if (parser.getArgumentById(SERVER_OPT) != null) {
 				startServer();
 			} else if (parser.getArgumentById(NONGUI_OPT) == null) {
-				startGui();
+				startGui(parser.getArgumentById(TESTFILE_OPT));
 			} else {
 				startNonGui(
 					parser.getArgumentById(TESTFILE_OPT),
@@ -225,7 +257,11 @@ public class JMeter {
 			System.out.println(e.getMessage());
 			System.out.println("Incorrect Usage");
 			System.out.println(CLUtil.describeOptions(options).toString());
-		}
+		} catch (Exception e) {
+            e.printStackTrace();
+            System.out.println("An error occurred: " + e.getMessage());
+            System.exit(-1);
+        }
 	}
 
 	/**
@@ -286,13 +322,15 @@ public class JMeter {
 				Thread.sleep(Long.MAX_VALUE);
 			}
 		} catch (Exception ex) {
-			ex.printStackTrace();
+			log.error("",ex);
 		}
 	}
 
 	public void startNonGui(CLOption testFile, CLOption logFile)
-		throws IllegalUserActionException {
+		throws IllegalUserActionException, IllegalAccessException, ClassNotFoundException, InstantiationException {
 		JMeter driver = new JMeter();
+        PluginManager.install(this, false);
+
 		if (testFile == null) {
 			throw new IllegalUserActionException();
 		}
@@ -314,7 +352,7 @@ public class JMeter {
 
 			reader = new FileInputStream(f);
 
-			ListedHashTree tree = SaveService.loadSubTree(reader);
+			HashTree tree = SaveService.loadSubTree(reader);
 			if(logFile != null)
 			{
 				ResultCollector logger = new ResultCollector();
@@ -330,7 +368,7 @@ public class JMeter {
 
 		} catch (Exception e) {
 			System.out.println("Error in NonGUIDriver" + e.getMessage());
-			e.printStackTrace();
+			log.error("",e);
 		}
 	}
 	
@@ -356,7 +394,7 @@ public class JMeter {
 		
 		public void testStarted()
 		{
-			System.out.println(JMeterUtils.getResString("running_test"));
+			log.info(JMeterUtils.getResString("running_test"));
 		}
 		
 		/**
@@ -378,4 +416,27 @@ public class JMeter {
 	private static void println(String str) {
 		System.out.println(str);
 	}
+
+
+    public String[][] getIconMappings()
+    {
+        return new String[][] {
+            { TestPlanGui.class.getName(), "org/apache/jmeter/images/beaker.gif"},
+            { AbstractTimerGui.class.getName(), "org/apache/jmeter/images/timer.gif"},
+            { ThreadGroupGui.class.getName(), "org/apache/jmeter/images/thread.gif"},
+            { AbstractVisualizer.class.getName(), "org/apache/jmeter/images/meter.png"},
+            { AbstractConfigGui.class.getName(), "org/apache/jmeter/images/testtubes.png"},
+            { AbstractModifierGui.class.getName(), "org/apache/jmeter/images/testtubes.gif"},
+            { AbstractResponseBasedModifierGui.class.getName(), "org/apache/jmeter/images/testtubes.gif"},
+            { AbstractControllerGui.class.getName(), "org/apache/jmeter/images/knob.gif"},
+            { WorkBenchGui.class.getName(), "org/apache/jmeter/images/clipboard.gif"},
+            { AbstractSamplerGui.class.getName(), "org/apache/jmeter/images/pipet.png"}
+        };
+    }
+
+
+    public String[][] getResourceBundles()
+    {
+        return new String[0][];
+    }
 }
\ No newline at end of file
diff --git a/jakarta-jmeter/src/core/org/apache/jmeter/NewDriver.java b/jakarta-jmeter/src/core/org/apache/jmeter/NewDriver.java
index 8d4b7af..605d580 100644
--- a/jakarta-jmeter/src/core/org/apache/jmeter/NewDriver.java
+++ b/jakarta-jmeter/src/core/org/apache/jmeter/NewDriver.java
@@ -131,22 +131,7 @@ public class NewDriver
 		
 		System.setProperty("java.class.path",System.getProperty("java.class.path")+classpath.toString());
 		loader = new URLClassLoader((URL[])jars.toArray(new URL[0]));
-		try {
-			loader.loadClass("org.apache.jmeter.gui.GuiPackage");
-			loader.loadClass("org.apache.jmeter.gui.JMeterFileFilter");
-			loader.loadClass("org.apache.jmeter.gui.MainFrame");
-			loader.loadClass("org.apache.jmeter.gui.action.ActionRouter");
-			loader.loadClass("org.apache.jmeter.gui.action.CheckDirty");
-			loader.loadClass("org.apache.jmeter.gui.tree.JMeterTreeListener");
-			loader.loadClass("org.apache.jmeter.gui.tree.JMeterTreeModel");
-			loader.loadClass("org.apache.jmeter.gui.util.ComponentUtil");
-			loader.loadClass("org.apache.jmeter.util.JMeterUtils");
-			loader.loadClass("javax.xml.parsers.SAXParserFactory");
-			loader.loadClass("org.apache.xerces.jaxp.SAXParserFactoryImpl");
 		
-		} catch(ClassNotFoundException e) {
-			e.printStackTrace();
-		}
 	}
 	
 	public static String getJMeterDir()
diff --git a/jakarta-jmeter/src/core/org/apache/jmeter/assertions/CVS/Entries b/jakarta-jmeter/src/core/org/apache/jmeter/assertions/CVS/Entries
index ed12904..203d041 100644
--- a/jakarta-jmeter/src/core/org/apache/jmeter/assertions/CVS/Entries
+++ b/jakarta-jmeter/src/core/org/apache/jmeter/assertions/CVS/Entries
@@ -1,3 +1,3 @@
-/Assertion.java/1.1/Sun Aug 11 19:24:42 2002//Tv1_7_3
-/AssertionResult.java/1.1/Sun Aug 11 19:24:42 2002//Tv1_7_3
+/Assertion.java/1.1/Sun Aug 11 19:24:42 2002//Tv1_8_1
+/AssertionResult.java/1.1/Sun Aug 11 19:24:42 2002//Tv1_8_1
 D/gui////
diff --git a/jakarta-jmeter/src/core/org/apache/jmeter/assertions/CVS/Tag b/jakarta-jmeter/src/core/org/apache/jmeter/assertions/CVS/Tag
index 5f312fe..e2fda28 100644
--- a/jakarta-jmeter/src/core/org/apache/jmeter/assertions/CVS/Tag
+++ b/jakarta-jmeter/src/core/org/apache/jmeter/assertions/CVS/Tag
@@ -1 +1 @@
-Nv1_7_3
+Nv1_8_1
diff --git a/jakarta-jmeter/src/core/org/apache/jmeter/assertions/gui/CVS/Entries b/jakarta-jmeter/src/core/org/apache/jmeter/assertions/gui/CVS/Entries
index 7b2076f..99f5c37 100644
--- a/jakarta-jmeter/src/core/org/apache/jmeter/assertions/gui/CVS/Entries
+++ b/jakarta-jmeter/src/core/org/apache/jmeter/assertions/gui/CVS/Entries
@@ -1,2 +1,2 @@
-/AbstractAssertionGui.java/1.1/Sun Aug 11 19:24:42 2002//Tv1_7_3
+/AbstractAssertionGui.java/1.1/Sun Aug 11 19:24:42 2002//Tv1_8_1
 D
diff --git a/jakarta-jmeter/src/core/org/apache/jmeter/assertions/gui/CVS/Tag b/jakarta-jmeter/src/core/org/apache/jmeter/assertions/gui/CVS/Tag
index 5f312fe..e2fda28 100644
--- a/jakarta-jmeter/src/core/org/apache/jmeter/assertions/gui/CVS/Tag
+++ b/jakarta-jmeter/src/core/org/apache/jmeter/assertions/gui/CVS/Tag
@@ -1 +1 @@
-Nv1_7_3
+Nv1_8_1
diff --git a/jakarta-jmeter/src/components/org/apache/jmeter/config/Argument.java b/jakarta-jmeter/src/core/org/apache/jmeter/config/Argument.java
similarity index 100%
rename from jakarta-jmeter/src/components/org/apache/jmeter/config/Argument.java
rename to jakarta-jmeter/src/core/org/apache/jmeter/config/Argument.java
diff --git a/jakarta-jmeter/src/components/org/apache/jmeter/config/Arguments.java b/jakarta-jmeter/src/core/org/apache/jmeter/config/Arguments.java
similarity index 97%
rename from jakarta-jmeter/src/components/org/apache/jmeter/config/Arguments.java
rename to jakarta-jmeter/src/core/org/apache/jmeter/config/Arguments.java
index bd5a7e1..5e23bbe 100644
--- a/jakarta-jmeter/src/components/org/apache/jmeter/config/Arguments.java
+++ b/jakarta-jmeter/src/core/org/apache/jmeter/config/Arguments.java
@@ -60,7 +60,6 @@ import java.util.Iterator;
 import java.util.List;
 import java.util.Map;
 
-import org.apache.jmeter.testelement.AbstractTestElement;
 import org.apache.jmeter.util.JMeterUtils;
 
 // Mark Walsh, 2002-08-03 add method addArgument(String name, Object value, Object metadata)
@@ -70,11 +69,11 @@ import org.apache.jmeter.util.JMeterUtils;
  * Apache Foundation
  *
  *@author    Michael Stover
- *@created   $Date: 2002/08/11 19:24:40 $
+ *@created   $Date: 2002/12/29 15:31:45 $
  *@version   1.0
  ***************************************/
 
-public class Arguments extends AbstractTestElement implements Serializable
+public class Arguments extends ConfigTestElement implements Serializable
 {
 	/****************************************
 	 * !ToDo (Field description)
diff --git a/jakarta-jmeter/src/core/org/apache/jmeter/config/CVS/Entries b/jakarta-jmeter/src/core/org/apache/jmeter/config/CVS/Entries
index f0fc18c..de3974b 100644
--- a/jakarta-jmeter/src/core/org/apache/jmeter/config/CVS/Entries
+++ b/jakarta-jmeter/src/core/org/apache/jmeter/config/CVS/Entries
@@ -1,6 +1,9 @@
-/ConfigElement.java/1.1/Sun Aug 11 19:24:42 2002//Tv1_7_3
-/ConfigTestElement.java/1.1/Sun Aug 11 19:24:42 2002//Tv1_7_3
-/ExtensionsFileFilter.java/1.1/Sun Aug 11 19:24:42 2002//Tv1_7_3
-/Modifier.java/1.1/Sun Aug 11 19:24:42 2002//Tv1_7_3
-/ResponseBasedModifier.java/1.1/Sun Aug 11 19:24:42 2002//Tv1_7_3
+/Argument.java/1.1/Sun Dec 29 15:31:45 2002//Tv1_8_1
+/Arguments.java/1.1/Sun Dec 29 15:31:45 2002//Tv1_8_1
+/ConfigElement.java/1.1/Sun Aug 11 19:24:42 2002//Tv1_8_1
+/ConfigTestElement.java/1.1/Sun Aug 11 19:24:42 2002//Tv1_8_1
+/ExtensionsFileFilter.java/1.1/Sun Aug 11 19:24:42 2002//Tv1_8_1
+/LoginConfig.java/1.1/Sun Dec 29 15:31:45 2002//Tv1_8_1
+/Modifier.java/1.1/Sun Aug 11 19:24:42 2002//Tv1_8_1
+/ResponseBasedModifier.java/1.1/Sun Aug 11 19:24:42 2002//Tv1_8_1
 D/gui////
diff --git a/jakarta-jmeter/src/core/org/apache/jmeter/config/CVS/Tag b/jakarta-jmeter/src/core/org/apache/jmeter/config/CVS/Tag
index 5f312fe..e2fda28 100644
--- a/jakarta-jmeter/src/core/org/apache/jmeter/config/CVS/Tag
+++ b/jakarta-jmeter/src/core/org/apache/jmeter/config/CVS/Tag
@@ -1 +1 @@
-Nv1_7_3
+Nv1_8_1
diff --git a/jakarta-jmeter/src/components/org/apache/jmeter/config/LoginConfig.java b/jakarta-jmeter/src/core/org/apache/jmeter/config/LoginConfig.java
similarity index 96%
rename from jakarta-jmeter/src/components/org/apache/jmeter/config/LoginConfig.java
rename to jakarta-jmeter/src/core/org/apache/jmeter/config/LoginConfig.java
index f1f3145..1b2d887 100644
--- a/jakarta-jmeter/src/components/org/apache/jmeter/config/LoginConfig.java
+++ b/jakarta-jmeter/src/core/org/apache/jmeter/config/LoginConfig.java
@@ -54,9 +54,7 @@
  */
 package org.apache.jmeter.config;
 
-import java.util.*;
-import java.io.*;
-import org.apache.jmeter.testelement.AbstractTestElement;
+import java.io.Serializable;
 
 /************************************************************
  *  Title: JMeter Description: Copyright: Copyright (c) 2000 Company: Apache
@@ -66,7 +64,7 @@ import org.apache.jmeter.testelement.AbstractTestElement;
  *@version    1.0
  ***********************************************************/
 
-public class LoginConfig extends AbstractTestElement implements Serializable
+public class LoginConfig extends ConfigTestElement implements Serializable
 {
 
 	/************************************************************
diff --git a/jakarta-jmeter/src/components/org/apache/jmeter/config/gui/ArgumentsPanel.java b/jakarta-jmeter/src/core/org/apache/jmeter/config/gui/ArgumentsPanel.java
similarity index 93%
rename from jakarta-jmeter/src/components/org/apache/jmeter/config/gui/ArgumentsPanel.java
rename to jakarta-jmeter/src/core/org/apache/jmeter/config/gui/ArgumentsPanel.java
index 14ca469..12e0217 100644
--- a/jakarta-jmeter/src/components/org/apache/jmeter/config/gui/ArgumentsPanel.java
+++ b/jakarta-jmeter/src/core/org/apache/jmeter/config/gui/ArgumentsPanel.java
@@ -73,16 +73,17 @@ import javax.swing.ListSelectionModel;
 import javax.swing.event.CellEditorListener;
 import javax.swing.event.ChangeEvent;
 import javax.swing.table.TableCellEditor;
+
 import junit.framework.TestCase;
 
 import org.apache.jmeter.config.Argument;
 import org.apache.jmeter.config.Arguments;
 import org.apache.jmeter.gui.util.PowerTableModel;
-import org.apache.jmeter.gui.util.TextAreaCellRenderer;
-import org.apache.jmeter.gui.util.TextAreaTableCellEditor;
 import org.apache.jmeter.testelement.TestElement;
-import org.apache.jmeter.util.Data;
 import org.apache.jmeter.util.JMeterUtils;
+import org.apache.jorphan.collections.Data;
+import org.apache.log.Hierarchy;
+import org.apache.log.Logger;
 
 /****************************************
  * Title: JMeter Description: Copyright: Copyright (c) 2000 Company: Apache
@@ -95,6 +96,8 @@ import org.apache.jmeter.util.JMeterUtils;
 public class ArgumentsPanel extends AbstractConfigGui implements FocusListener,
 		ActionListener,CellEditorListener
 {
+	transient private static Logger log = Hierarchy.getDefaultHierarchy().getLoggerFor(
+			JMeterUtils.GUI);
 	JTable table;
 	JButton add;
 	JButton delete;
@@ -209,6 +212,8 @@ public class ArgumentsPanel extends AbstractConfigGui implements FocusListener,
 	 ***************************************/
 	public void focusLost(FocusEvent e)
 	{
+		log.debug("Focus lost on table");
+		stopTableEditing();
 	}
 
 	/****************************************
@@ -276,11 +281,7 @@ public class ArgumentsPanel extends AbstractConfigGui implements FocusListener,
 	protected void addArgument() {
 		// If a table cell is being edited, we should accept the current value
 		// and stop the editing before adding a new row.
-		if(table.isEditing())
-		{
-			TableCellEditor cellEditor = table.getCellEditor(table.getEditingRow(), table.getEditingColumn());
-			cellEditor.stopCellEditing();
-		}
+		stopTableEditing();
 		
 		tableModel.addNewRow();
 		tableModel.fireTableDataChanged();
@@ -293,6 +294,15 @@ public class ArgumentsPanel extends AbstractConfigGui implements FocusListener,
 		table.setRowSelectionInterval(rowToSelect, rowToSelect);
 	}
 
+	private void stopTableEditing()
+	{
+		if(table.isEditing())
+		{
+			TableCellEditor cellEditor = table.getCellEditor(table.getEditingRow(), table.getEditingColumn());
+			cellEditor.stopCellEditing();
+		}
+	}
+
 	/****************************************
 	 * !ToDo
 	 ***************************************/
@@ -302,13 +312,14 @@ public class ArgumentsPanel extends AbstractConfigGui implements FocusListener,
 		table = new JTable(tableModel);
 		table.setEnabled(true);
 		table.addFocusListener(this);
-		TextAreaTableCellEditor editor = new TextAreaTableCellEditor();
-		table.setDefaultEditor(String.class,
-				editor);
-		editor.addCellEditorListener(this);
-		TextAreaCellRenderer renderer = new TextAreaCellRenderer();
-		table.setRowHeight(renderer.getPreferredHeight());
-		table.setDefaultRenderer(String.class,renderer);
+        // use default editor/renderer to fix bug #16058
+//		TextAreaTableCellEditor editor = new TextAreaTableCellEditor();
+//		table.setDefaultEditor(String.class,
+//				editor);
+//		editor.addCellEditorListener(this);
+//		TextAreaCellRenderer renderer = new TextAreaCellRenderer();
+//		table.setRowHeight(renderer.getPreferredHeight());
+//		table.setDefaultRenderer(String.class,renderer);
 		table.setCellSelectionEnabled(true);
 		table.setRowSelectionAllowed(true);
 		table.setColumnSelectionAllowed(false);
diff --git a/jakarta-jmeter/src/core/org/apache/jmeter/config/gui/CVS/Entries b/jakarta-jmeter/src/core/org/apache/jmeter/config/gui/CVS/Entries
index 7bbded6..d49308e 100644
--- a/jakarta-jmeter/src/core/org/apache/jmeter/config/gui/CVS/Entries
+++ b/jakarta-jmeter/src/core/org/apache/jmeter/config/gui/CVS/Entries
@@ -1,4 +1,6 @@
-/AbstractConfigGui.java/1.1/Sun Aug 11 19:24:42 2002//Tv1_7_3
-/AbstractModifierGui.java/1.1/Sun Aug 11 19:24:42 2002//Tv1_7_3
-/AbstractResponseBasedModifierGui.java/1.1/Sun Aug 11 19:24:42 2002//Tv1_7_3
+/AbstractConfigGui.java/1.1/Sun Aug 11 19:24:42 2002//Tv1_8_1
+/AbstractModifierGui.java/1.1/Sun Aug 11 19:24:42 2002//Tv1_8_1
+/AbstractResponseBasedModifierGui.java/1.1/Sun Aug 11 19:24:42 2002//Tv1_8_1
+/ArgumentsPanel.java/1.3/Fri Jan 31 19:05:50 2003//Tv1_8_1
+/LoginConfigGui.java/1.1/Sun Dec 29 15:31:45 2002//Tv1_8_1
 D
diff --git a/jakarta-jmeter/src/core/org/apache/jmeter/config/gui/CVS/Tag b/jakarta-jmeter/src/core/org/apache/jmeter/config/gui/CVS/Tag
index 5f312fe..e2fda28 100644
--- a/jakarta-jmeter/src/core/org/apache/jmeter/config/gui/CVS/Tag
+++ b/jakarta-jmeter/src/core/org/apache/jmeter/config/gui/CVS/Tag
@@ -1 +1 @@
-Nv1_7_3
+Nv1_8_1
diff --git a/jakarta-jmeter/src/components/org/apache/jmeter/config/gui/LoginConfigGui.java b/jakarta-jmeter/src/core/org/apache/jmeter/config/gui/LoginConfigGui.java
similarity index 96%
rename from jakarta-jmeter/src/components/org/apache/jmeter/config/gui/LoginConfigGui.java
rename to jakarta-jmeter/src/core/org/apache/jmeter/config/gui/LoginConfigGui.java
index fd7f4ae..70d22c0 100644
--- a/jakarta-jmeter/src/components/org/apache/jmeter/config/gui/LoginConfigGui.java
+++ b/jakarta-jmeter/src/core/org/apache/jmeter/config/gui/LoginConfigGui.java
@@ -53,14 +53,15 @@
  * <http://www.apache.org/>.
  */
 package org.apache.jmeter.config.gui;
-import java.awt.event.*;
-import javax.swing.*;
-import org.apache.jmeter.config.LoginConfig;
-import org.apache.jmeter.gui.*;
-import org.apache.jmeter.gui.util.VerticalLayout;
-import org.apache.jmeter.util.JMeterUtils;
-import org.apache.jmeter.testelement.TestElement;
+import javax.swing.JLabel;
+import javax.swing.JPanel;
+import javax.swing.JPasswordField;
+import javax.swing.JTextField;
+
 import org.apache.jmeter.config.ConfigTestElement;
+import org.apache.jmeter.testelement.TestElement;
+import org.apache.jmeter.util.JMeterUtils;
+import org.apache.jorphan.gui.layout.VerticalLayout;
 
 /****************************************
  * Title: JMeter Description: Copyright: Copyright (c) 2000 Company: Apache
diff --git a/jakarta-jmeter/src/core/org/apache/jmeter/control/CVS/Entries b/jakarta-jmeter/src/core/org/apache/jmeter/control/CVS/Entries
index 00986eb..375bc49 100644
--- a/jakarta-jmeter/src/core/org/apache/jmeter/control/CVS/Entries
+++ b/jakarta-jmeter/src/core/org/apache/jmeter/control/CVS/Entries
@@ -1,3 +1,5 @@
-/Controller.java/1.1/Sun Aug 11 19:24:42 2002//Tv1_7_3
-/NoEntryException.java/1.1/Sun Aug 11 19:24:42 2002//Tv1_7_3
+/Controller.java/1.2/Fri Dec 13 21:37:28 2002//Tv1_8_1
+/GenericController.java/1.2/Tue Jan 28 21:21:19 2003//Tv1_8_1
+/LoopController.java/1.1/Sun Dec 29 15:31:45 2002//Tv1_8_1
+/NoEntryException.java/1.1/Sun Aug 11 19:24:42 2002//Tv1_8_1
 D/gui////
diff --git a/jakarta-jmeter/src/core/org/apache/jmeter/control/CVS/Tag b/jakarta-jmeter/src/core/org/apache/jmeter/control/CVS/Tag
index 5f312fe..e2fda28 100644
--- a/jakarta-jmeter/src/core/org/apache/jmeter/control/CVS/Tag
+++ b/jakarta-jmeter/src/core/org/apache/jmeter/control/CVS/Tag
@@ -1 +1 @@
-Nv1_7_3
+Nv1_8_1
diff --git a/jakarta-jmeter/src/core/org/apache/jmeter/control/Controller.java b/jakarta-jmeter/src/core/org/apache/jmeter/control/Controller.java
index e92d187..cb7399d 100644
--- a/jakarta-jmeter/src/core/org/apache/jmeter/control/Controller.java
+++ b/jakarta-jmeter/src/core/org/apache/jmeter/control/Controller.java
@@ -71,7 +71,7 @@ import org.apache.jmeter.samplers.Sampler;
  * }
  *
  *@author    Michael Stover
- *@created   $Date: 2002/08/11 19:24:42 $
+ *@created   $Date: 2002/12/13 21:37:28 $
  *@version   1.0
  ***************************************/
 public interface Controller extends TestElement
@@ -92,4 +92,9 @@ public interface Controller extends TestElement
 	 * of the test.
 	 */
 	public boolean isDone();
+	
+	/**
+	 * By using this method, one can ask the controller if the next Sampler is the
+	 * first in the Controller's list.	 * @return boolean	 */
+	public boolean isNextFirst();
 }
diff --git a/jakarta-jmeter/src/components/org/apache/jmeter/control/GenericController.java b/jakarta-jmeter/src/core/org/apache/jmeter/control/GenericController.java
similarity index 95%
rename from jakarta-jmeter/src/components/org/apache/jmeter/control/GenericController.java
rename to jakarta-jmeter/src/core/org/apache/jmeter/control/GenericController.java
index 83c945e..1058d99 100644
--- a/jakarta-jmeter/src/components/org/apache/jmeter/control/GenericController.java
+++ b/jakarta-jmeter/src/core/org/apache/jmeter/control/GenericController.java
@@ -69,7 +69,7 @@ import org.apache.jmeter.testelement.PerThreadClonable;
  * Title: JMeter Description: Copyright: Copyright (c) 2000 Company: Apache
  *
  *@author    Michael Stover
- *@created   $Date: 2002/08/11 19:24:40 $
+ *@created   $Date: 2003/01/28 21:21:19 $
  *@version   1.0
  ***************************************/
 
@@ -98,6 +98,16 @@ public class GenericController extends AbstractTestElement implements Controller
 	 ***************************************/
 	public GenericController()
 	{
+		
+	}
+	
+	public boolean isNextFirst()
+	{
+		if(current == 0)
+		{
+			return true;
+		}
+		return false;
 	}
 
 	/****************************************
@@ -350,10 +360,13 @@ public class GenericController extends AbstractTestElement implements Controller
 
 		private TestElement makeSampler(String name)
 		{
-			org.apache.jmeter.protocol.http.sampler.HTTPSampler s = new
-					org.apache.jmeter.protocol.http.sampler.HTTPSampler();
+			TestSampler s = new TestSampler();
 			s.setName(name);
 			return s;
 		}
+		class TestSampler extends AbstractSampler {
+		  public void addCustomTestElement(TestElement t) { }
+		  public org.apache.jmeter.samplers.SampleResult sample(org.apache.jmeter.samplers.Entry e) { return null; }
+		}
 	}
 }
diff --git a/jakarta-jmeter/src/components/org/apache/jmeter/control/LoopController.java b/jakarta-jmeter/src/core/org/apache/jmeter/control/LoopController.java
similarity index 94%
rename from jakarta-jmeter/src/components/org/apache/jmeter/control/LoopController.java
rename to jakarta-jmeter/src/core/org/apache/jmeter/control/LoopController.java
index 9867698..48541c0 100644
--- a/jakarta-jmeter/src/components/org/apache/jmeter/control/LoopController.java
+++ b/jakarta-jmeter/src/core/org/apache/jmeter/control/LoopController.java
@@ -56,11 +56,12 @@ package org.apache.jmeter.control;
 import java.io.Serializable;
 import org.apache.jmeter.util.JMeterUtils;
 import org.apache.jmeter.testelement.TestElement;
+import org.apache.jmeter.samplers.AbstractSampler;
 /****************************************
  * Title: JMeter Description: Copyright: Copyright (c) 2000 Company: Apache
  *
  *@author    Michael Stover
- *@created   $Date: 2002/08/11 19:24:40 $
+ *@created   $Date: 2002/12/29 15:31:45 $
  *@version   1.0
  ***************************************/
 
@@ -214,10 +215,13 @@ public class LoopController extends GenericController implements Serializable
 
 		private TestElement makeSampler(String name)
 		{
-			org.apache.jmeter.protocol.http.sampler.HTTPSampler s = new
-					org.apache.jmeter.protocol.http.sampler.HTTPSampler();
+		  	TestSampler s= new TestSampler();
 			s.setName(name);
 			return s;
 		}
+		class TestSampler extends AbstractSampler {
+		  public void addCustomTestElement(TestElement t) { }
+		  public org.apache.jmeter.samplers.SampleResult sample(org.apache.jmeter.samplers.Entry e) { return null; }
+		}
 	}
 }
diff --git a/jakarta-jmeter/src/core/org/apache/jmeter/control/gui/CVS/Entries b/jakarta-jmeter/src/core/org/apache/jmeter/control/gui/CVS/Entries
index 07854b8..38089ae 100644
--- a/jakarta-jmeter/src/core/org/apache/jmeter/control/gui/CVS/Entries
+++ b/jakarta-jmeter/src/core/org/apache/jmeter/control/gui/CVS/Entries
@@ -1,4 +1,6 @@
-/AbstractControllerGui.java/1.1/Sun Aug 11 19:24:42 2002//Tv1_7_3
-/TestPlanGui.java/1.1/Sun Aug 11 19:24:42 2002//Tv1_7_3
-/WorkBenchGui.java/1.1/Sun Aug 11 19:24:42 2002//Tv1_7_3
+/AbstractControllerGui.java/1.1/Sun Aug 11 19:24:42 2002//Tv1_8_1
+/LogicControllerGui.java/1.1/Sun Dec 29 15:31:45 2002//Tv1_8_1
+/LoopControlPanel.java/1.1/Sun Dec 29 15:31:45 2002//Tv1_8_1
+/TestPlanGui.java/1.1/Sun Aug 11 19:24:42 2002//Tv1_8_1
+/WorkBenchGui.java/1.4/Tue Dec 31 18:05:54 2002//Tv1_8_1
 D
diff --git a/jakarta-jmeter/src/core/org/apache/jmeter/control/gui/CVS/Tag b/jakarta-jmeter/src/core/org/apache/jmeter/control/gui/CVS/Tag
index 5f312fe..e2fda28 100644
--- a/jakarta-jmeter/src/core/org/apache/jmeter/control/gui/CVS/Tag
+++ b/jakarta-jmeter/src/core/org/apache/jmeter/control/gui/CVS/Tag
@@ -1 +1 @@
-Nv1_7_3
+Nv1_8_1
diff --git a/jakarta-jmeter/src/components/org/apache/jmeter/control/gui/LogicControllerGui.java b/jakarta-jmeter/src/core/org/apache/jmeter/control/gui/LogicControllerGui.java
similarity index 94%
rename from jakarta-jmeter/src/components/org/apache/jmeter/control/gui/LogicControllerGui.java
rename to jakarta-jmeter/src/core/org/apache/jmeter/control/gui/LogicControllerGui.java
index 778ec5a..cb62692 100644
--- a/jakarta-jmeter/src/components/org/apache/jmeter/control/gui/LogicControllerGui.java
+++ b/jakarta-jmeter/src/core/org/apache/jmeter/control/gui/LogicControllerGui.java
@@ -53,23 +53,24 @@
  * <http://www.apache.org/>.
  */
 package org.apache.jmeter.control.gui;
-import java.awt.*;
-import java.awt.event.*;
-import javax.swing.*;
-import javax.swing.border.*;
-import javax.swing.table.*;
-import javax.swing.text.*;
+import java.awt.Font;
+
+import javax.swing.JLabel;
+import javax.swing.JPanel;
+import javax.swing.border.Border;
+import javax.swing.border.EmptyBorder;
+
 import org.apache.jmeter.control.GenericController;
-import org.apache.jmeter.gui.*;
-import org.apache.jmeter.gui.util.VerticalLayout;
+import org.apache.jmeter.gui.NamePanel;
 import org.apache.jmeter.testelement.TestElement;
 import org.apache.jmeter.util.JMeterUtils;
+import org.apache.jorphan.gui.layout.VerticalLayout;
 
 /****************************************
  * Title: JMeter Description: Copyright: Copyright (c) 2000 Company: Apache
  *
  *@author    Kevin Hammond
- *@created   $Date: 2002/08/11 19:24:40 $
+ *@created   $Date: 2002/12/29 15:31:45 $
  *@version   1.0
  ***************************************/
 
diff --git a/jakarta-jmeter/src/components/org/apache/jmeter/control/gui/LoopControlPanel.java b/jakarta-jmeter/src/core/org/apache/jmeter/control/gui/LoopControlPanel.java
similarity index 92%
rename from jakarta-jmeter/src/components/org/apache/jmeter/control/gui/LoopControlPanel.java
rename to jakarta-jmeter/src/core/org/apache/jmeter/control/gui/LoopControlPanel.java
index 1c050d4..c6390e3 100644
--- a/jakarta-jmeter/src/components/org/apache/jmeter/control/gui/LoopControlPanel.java
+++ b/jakarta-jmeter/src/core/org/apache/jmeter/control/gui/LoopControlPanel.java
@@ -1,21 +1,29 @@
 package org.apache.jmeter.control.gui;
-import java.awt.*;
-import java.awt.event.*;
-import java.util.*;
-import javax.swing.*;
-import javax.swing.border.*;
+import java.awt.Font;
+import java.awt.event.ActionEvent;
+import java.awt.event.ActionListener;
+import java.awt.event.KeyEvent;
+import java.awt.event.KeyListener;
+
+import javax.swing.JCheckBox;
+import javax.swing.JLabel;
+import javax.swing.JOptionPane;
+import javax.swing.JPanel;
+import javax.swing.JTextField;
+import javax.swing.border.Border;
+import javax.swing.border.EmptyBorder;
+
 import org.apache.jmeter.control.LoopController;
-import org.apache.jmeter.gui.NamePanel;
 import org.apache.jmeter.gui.util.FocusRequester;
-import org.apache.jmeter.gui.util.VerticalLayout;
 import org.apache.jmeter.testelement.TestElement;
 import org.apache.jmeter.util.JMeterUtils;
+import org.apache.jorphan.gui.layout.VerticalLayout;
 
 /****************************************
  * Title: JMeter Description: Copyright: Copyright (c) 2000 Company: Apache
  *
  *@author    Michael Stover
- *@created   $Date: 2002/08/11 19:24:40 $
+ *@created   $Date: 2002/12/29 15:31:45 $
  *@version   1.0
  ***************************************/
 
diff --git a/jakarta-jmeter/src/core/org/apache/jmeter/control/gui/WorkBenchGui.java b/jakarta-jmeter/src/core/org/apache/jmeter/control/gui/WorkBenchGui.java
index abfdcf8..45e38c4 100644
--- a/jakarta-jmeter/src/core/org/apache/jmeter/control/gui/WorkBenchGui.java
+++ b/jakarta-jmeter/src/core/org/apache/jmeter/control/gui/WorkBenchGui.java
@@ -2,7 +2,7 @@
  * ====================================================================
  * The Apache Software License, Version 1.1
  *
- * Copyright (c) 2001 The Apache Software Foundation.  All rights
+ * Copyright (c) 2001-2002 The Apache Software Foundation.  All rights
  * reserved.
  *
  * Redistribution and use in source and binary forms, with or without
@@ -53,33 +53,40 @@
  * <http://www.apache.org/>.
  */
 package org.apache.jmeter.control.gui;
-import java.awt.*;
-import java.awt.event.*;
-import java.util.*;
-import javax.swing.*;
-import javax.swing.border.*;
-import javax.swing.table.*;
-import javax.swing.text.*;
-import org.apache.jmeter.gui.*;
+import java.awt.Font;
+import java.util.Collection;
+
+import javax.swing.JLabel;
+import javax.swing.JMenu;
+import javax.swing.JPanel;
+import javax.swing.JPopupMenu;
+import javax.swing.border.Border;
+import javax.swing.border.EmptyBorder;
+
+import org.apache.jmeter.gui.JMeterGUIComponent;
+import org.apache.jmeter.gui.NamePanel;
+import org.apache.jmeter.gui.tree.JMeterTreeNode;
 import org.apache.jmeter.gui.util.MenuFactory;
-import org.apache.jmeter.gui.util.VerticalLayout;
 import org.apache.jmeter.testelement.TestElement;
 import org.apache.jmeter.testelement.WorkBench;
 import org.apache.jmeter.util.JMeterUtils;
+import org.apache.jorphan.gui.layout.VerticalLayout;
 
 /****************************************
  * Title: JMeter Description: Copyright: Copyright (c) 2000 Company: Apache
  *
  *@author    Kevin Hammond
- *@created   $Date: 2002/08/11 19:24:42 $
+ *@created   $Date: 2002/12/31 18:05:54 $
  *@version   1.0
  ***************************************/
 
 public class WorkBenchGui extends JPanel implements JMeterGUIComponent
 {
-	NamePanel namePanel;
+    NamePanel namePanel;
+    private JMeterTreeNode node;
 
-	/****************************************
+
+        /****************************************
 	 * !ToDo (Constructor description)
 	 ***************************************/
 	public WorkBenchGui()
@@ -195,4 +202,11 @@ public class WorkBenchGui extends JPanel implements JMeterGUIComponent
 
 		this.add(mainPanel);
 	}
+
+
+    public void setNode(JMeterTreeNode node)
+    {
+        this.node = node;
+        namePanel.setNode(node);
+    }
 }
diff --git a/jakarta-jmeter/src/core/org/apache/jmeter/engine/CVS/Entries b/jakarta-jmeter/src/core/org/apache/jmeter/engine/CVS/Entries
index b5b29c0..1967cfe 100644
--- a/jakarta-jmeter/src/core/org/apache/jmeter/engine/CVS/Entries
+++ b/jakarta-jmeter/src/core/org/apache/jmeter/engine/CVS/Entries
@@ -1,11 +1,11 @@
-/ClientJMeterEngine.java/1.1/Sun Aug 11 19:24:43 2002//Tv1_7_3
-/ConvertListeners.java/1.1/Sun Aug 11 19:24:43 2002//Tv1_7_3
-/JMeterEngine.java/1.1/Sun Aug 11 19:24:43 2002//Tv1_7_3
-/JMeterEngineException.java/1.1/Sun Aug 11 19:24:43 2002//Tv1_7_3
-/LagDetector.java/1.1/Sun Aug 11 19:24:43 2002//Tv1_7_3
-/PreCompiler.java/1.2/Tue Aug 13 18:17:50 2002//Tv1_7_3
-/RemoteJMeterEngine.java/1.1/Sun Aug 11 19:24:43 2002//Tv1_7_3
-/RemoteJMeterEngineImpl.java/1.1/Sun Aug 11 19:24:43 2002//Tv1_7_3
-/StandardJMeterEngine.java/1.1/Sun Aug 11 19:24:43 2002//Tv1_7_3
-/TreeCloner.java/1.1/Sun Aug 11 19:24:43 2002//Tv1_7_3
+/ClientJMeterEngine.java/1.5/Thu Oct 17 19:47:15 2002//Tv1_8_1
+/ConvertListeners.java/1.5/Thu Oct 17 19:47:15 2002//Tv1_8_1
+/JMeterEngine.java/1.3/Thu Oct 17 19:47:15 2002//Tv1_8_1
+/JMeterEngineException.java/1.1/Sun Aug 11 19:24:43 2002//Tv1_8_1
+/LagDetector.java/1.1/Sun Aug 11 19:24:43 2002//Tv1_8_1
+/PreCompiler.java/1.7/Thu Oct 17 19:47:15 2002//Tv1_8_1
+/RemoteJMeterEngine.java/1.3/Thu Oct 17 19:47:15 2002//Tv1_8_1
+/RemoteJMeterEngineImpl.java/1.6/Thu Oct 17 19:47:15 2002//Tv1_8_1
+/StandardJMeterEngine.java/1.15/Thu Oct 17 19:47:15 2002//Tv1_8_1
+/TreeCloner.java/1.3/Thu Oct 17 19:47:15 2002//Tv1_8_1
 D
diff --git a/jakarta-jmeter/src/core/org/apache/jmeter/engine/CVS/Tag b/jakarta-jmeter/src/core/org/apache/jmeter/engine/CVS/Tag
index 5f312fe..e2fda28 100644
--- a/jakarta-jmeter/src/core/org/apache/jmeter/engine/CVS/Tag
+++ b/jakarta-jmeter/src/core/org/apache/jmeter/engine/CVS/Tag
@@ -1 +1 @@
-Nv1_7_3
+Nv1_8_1
diff --git a/jakarta-jmeter/src/core/org/apache/jmeter/engine/ClientJMeterEngine.java b/jakarta-jmeter/src/core/org/apache/jmeter/engine/ClientJMeterEngine.java
index 78c4e6b..3217aa0 100644
--- a/jakarta-jmeter/src/core/org/apache/jmeter/engine/ClientJMeterEngine.java
+++ b/jakarta-jmeter/src/core/org/apache/jmeter/engine/ClientJMeterEngine.java
@@ -58,23 +58,27 @@ import java.rmi.Naming;
 import java.rmi.NotBoundException;
 import java.rmi.RemoteException;
 
-import org.apache.jmeter.samplers.SampleListener;
 import org.apache.jmeter.testelement.TestListener;
-import org.apache.jmeter.util.ListedHashTree;
-import org.apache.jmeter.util.SearchByClass;
+import org.apache.log.Hierarchy;
+import org.apache.log.Logger;
+import org.apache.jorphan.collections.HashTree;
+import org.apache.jorphan.collections.ListedHashTree;
+import org.apache.jorphan.collections.SearchByClass;
 
 
 /************************************************************
  *  !ToDo (Class description)
  *
  *@author     $Author: mstover1 $
- *@created    $Date: 2002/08/11 19:24:43 $
- *@version    $Revision: 1.1 $
+ *@created    $Date: 2002/10/17 19:47:15 $
+ *@version    $Revision: 1.5 $
  ***********************************************************/
 public class ClientJMeterEngine implements JMeterEngine
 {
+	transient private static Logger log = Hierarchy.getDefaultHierarchy().getLoggerFor(
+			"jmeter.engine");
 	RemoteJMeterEngine remote;
-	ListedHashTree test;
+	HashTree test;
 	SearchByClass testListeners;
 	ConvertListeners sampleListeners;
 	private String host;
@@ -104,12 +108,12 @@ public class ClientJMeterEngine implements JMeterEngine
 		this.remote = remote;
 	}
 	
-	protected ListedHashTree getTestTree()
+	protected HashTree getTestTree()
 	{
 		return test;
 	}
 
-	public void configure(ListedHashTree testTree)
+	public void configure(HashTree testTree)
 	{
 		test = testTree;
 	}
@@ -136,7 +140,7 @@ public class ClientJMeterEngine implements JMeterEngine
 		}
 		catch(Exception ex)
 		{
-			ex.printStackTrace();
+			log.error("",ex);
 		}
 	}
 
@@ -151,7 +155,7 @@ public class ClientJMeterEngine implements JMeterEngine
 		}
 		catch(Exception ex)
 		{
-			ex.printStackTrace();
+			log.error("",ex);
 		}
 	}
 
@@ -166,7 +170,7 @@ public class ClientJMeterEngine implements JMeterEngine
 		}
 		catch(Exception ex)
 		{
-			ex.printStackTrace();
+			log.error("",ex);
 		}
 	}
 
diff --git a/jakarta-jmeter/src/core/org/apache/jmeter/engine/ConvertListeners.java b/jakarta-jmeter/src/core/org/apache/jmeter/engine/ConvertListeners.java
index e2b2340..17015c6 100644
--- a/jakarta-jmeter/src/core/org/apache/jmeter/engine/ConvertListeners.java
+++ b/jakarta-jmeter/src/core/org/apache/jmeter/engine/ConvertListeners.java
@@ -3,17 +3,19 @@ package org.apache.jmeter.engine;
 import java.rmi.RemoteException;
 import java.util.Iterator;
 
+import org.apache.jmeter.samplers.RemoteListenerWrapper;
 import org.apache.jmeter.samplers.RemoteSampleListener;
 import org.apache.jmeter.samplers.RemoteSampleListenerImpl;
-import org.apache.jmeter.samplers.Remoteable;
-import org.apache.jmeter.samplers.SampleListener;
-import org.apache.jmeter.samplers.RemoteListenerWrapper;
 import org.apache.jmeter.samplers.RemoteSampleListenerWrapper;
 import org.apache.jmeter.samplers.RemoteTestListenerWrapper;
+import org.apache.jmeter.samplers.Remoteable;
+import org.apache.jmeter.samplers.SampleListener;
 import org.apache.jmeter.testelement.TestListener;
-import org.apache.jmeter.util.ListedHashTree;
-import org.apache.jmeter.util.ListedHashTreeVisitor;
 import org.apache.jmeter.threads.ThreadGroup;
+import org.apache.log.Hierarchy;
+import org.apache.log.Logger;
+import org.apache.jorphan.collections.HashTree;
+import org.apache.jorphan.collections.HashTreeTraverser;
 
 /**
  * @author mstover
@@ -21,15 +23,17 @@ import org.apache.jmeter.threads.ThreadGroup;
  * To change this generated comment edit the template variable "typecomment":
  * Window>Preferences>Java>Templates.
  */
-public class ConvertListeners implements ListedHashTreeVisitor {
+public class ConvertListeners implements HashTreeTraverser {
 
+	transient private static Logger log = Hierarchy.getDefaultHierarchy().getLoggerFor(
+			"jmeter.engine");
 	/**
 	 * @see ListedHashTreeVisitor#addNode(Object, ListedHashTree)
 	 */
-	public void addNode(Object node, ListedHashTree subTree) {
+	public void addNode(Object node, HashTree subTree) {
 		if(node instanceof ThreadGroup)
 			{
-				System.out.println("num threads = "+((ThreadGroup)node).getNumThreads());
+				log.info("num threads = "+((ThreadGroup)node).getNumThreads());
 			}
 		Iterator iter = subTree.list().iterator();
 		while(iter.hasNext())
@@ -37,7 +41,7 @@ public class ConvertListeners implements ListedHashTreeVisitor {
 			Object item = iter.next();
 			if(item instanceof ThreadGroup)
 			{
-				System.out.println("num threads = "+((ThreadGroup)item).getNumThreads());
+				log.info("num threads = "+((ThreadGroup)item).getNumThreads());
 			}
 			if(item instanceof Remoteable && (item instanceof TestListener || item instanceof SampleListener))
 			{
@@ -59,7 +63,7 @@ public class ConvertListeners implements ListedHashTreeVisitor {
 						subTree.replace(item,wrap);
 					}
 				} catch(RemoteException e) {
-					e.printStackTrace();
+					log.error("",e);
 				}
 			}
 		}
diff --git a/jakarta-jmeter/src/core/org/apache/jmeter/engine/JMeterEngine.java b/jakarta-jmeter/src/core/org/apache/jmeter/engine/JMeterEngine.java
index b81659c..b539db6 100644
--- a/jakarta-jmeter/src/core/org/apache/jmeter/engine/JMeterEngine.java
+++ b/jakarta-jmeter/src/core/org/apache/jmeter/engine/JMeterEngine.java
@@ -54,21 +54,20 @@
  */
 package org.apache.jmeter.engine;
 
-import org.apache.jmeter.threads.ThreadGroup;
-import org.apache.jmeter.util.ListedHashTree;
+import org.apache.jorphan.collections.HashTree;
 
 /************************************************************
  *  Title: JMeter Description: Copyright: Copyright (c) 2000 Company: Apache
  *
  *@author     Michael Stover
- *@created    $Date: 2002/08/11 19:24:43 $
+ *@created    $Date: 2002/10/17 19:47:15 $
  *@version    1.0
  ***********************************************************/
 
 public interface JMeterEngine
 {
 
-	void configure(ListedHashTree testPlan);
+	void configure(HashTree testPlan);
 
 	void runTest() throws JMeterEngineException;
 
diff --git a/jakarta-jmeter/src/core/org/apache/jmeter/engine/PreCompiler.java b/jakarta-jmeter/src/core/org/apache/jmeter/engine/PreCompiler.java
index 27e44bc..f0f5665 100644
--- a/jakarta-jmeter/src/core/org/apache/jmeter/engine/PreCompiler.java
+++ b/jakarta-jmeter/src/core/org/apache/jmeter/engine/PreCompiler.java
@@ -1,131 +1,65 @@
 package org.apache.jmeter.engine;
-
-import java.util.Collection;
-import java.util.Iterator;
 import java.util.Map;
 
-import org.apache.jmeter.functions.CompoundFunction;
 import org.apache.jmeter.functions.InvalidVariableException;
+import org.apache.jmeter.functions.ValueReplacer;
 import org.apache.jmeter.testelement.TestElement;
 import org.apache.jmeter.testelement.TestPlan;
-import org.apache.jmeter.util.ListedHashTree;
-import org.apache.jmeter.util.ListedHashTreeVisitor;
-
+import org.apache.jmeter.util.JMeterUtils;
+import org.apache.log.Hierarchy;
+import org.apache.log.Logger;
+import org.apache.jorphan.collections.HashTree;
+import org.apache.jorphan.collections.HashTreeTraverser;
 /**
  * @author mstover
  *
  * To change this generated comment edit the template variable "typecomment":
  * Window>Preferences>Java>Templates.
  */
-public class PreCompiler implements ListedHashTreeVisitor {
-	
+public class PreCompiler implements HashTreeTraverser
+{
+	transient private static Logger log =
+		Hierarchy.getDefaultHierarchy().getLoggerFor(JMeterUtils.ENGINE);
 	private Map userDefinedVariables;
-	private CompoundFunction masterFunction = new CompoundFunction();
 	private boolean testValid = true;
-	
+	private ValueReplacer replacer;
 	public PreCompiler()
 	{
+		replacer = new ValueReplacer();
 	}
-
 	/**
 	 * @see ListedHashTreeVisitor#addNode(Object, ListedHashTree)
 	 */
-	public void addNode(Object node, ListedHashTree subTree) {
-		if(node instanceof TestPlan)
+	public void addNode(Object node, HashTree subTree)
+	{
+		if (node instanceof TestPlan)
 		{
-			masterFunction.setUserDefinedVariables(((TestPlan)node).getUserDefinedVariables());
+			replacer.setUserDefinedVariables(
+				((TestPlan) node).getUserDefinedVariables());
 		}
-		if(node instanceof TestElement)
+		if (node instanceof TestElement)
 		{
-			replaceValues((TestElement)node);
+			try
+			{
+				replacer.replaceValues((TestElement) node);
+			}
+			catch (InvalidVariableException e)
+			{
+				log.error("invalid variables",e);
+				testValid = false;
+			}
 		}
 	}
-
 	/**
 	 * @see ListedHashTreeVisitor#subtractNode()
 	 */
-	public void subtractNode() {
+	public void subtractNode()
+	{
 	}
-
 	/**
 	 * @see ListedHashTreeVisitor#processPath()
 	 */
-	public void processPath() {
-	}
-	
-	private void replaceValues(TestElement el)
+	public void processPath()
 	{
-		Iterator iter = el.getPropertyNames().iterator();
-		while(iter.hasNext())
-		{
-			String propName = (String)iter.next();
-			Object propValue = el.getProperty(propName);
-			if(propValue instanceof String)
-			{
-				Object newValue = getNewValue((String)propValue);
-				el.setProperty(propName,newValue);
-			}
-			else if(propValue instanceof TestElement)
-			{
-				replaceValues((TestElement)propValue);
-			}
-			else if(propValue instanceof Collection)
-			{
-				el.setProperty(propName,replaceValues((Collection)propValue));
-			}
-		}
-	}
-	
-	private Object getNewValue(String propValue)
-	{
-		Object newValue = propValue;
-				masterFunction.clear();
-				try {
-					masterFunction.setParameters((String)propValue);
-				} catch(InvalidVariableException e) {
-					testValid = false;
-				}
-				if(masterFunction.hasFunction())
-				{
-					newValue = masterFunction.getFunction();
-				}
-				else if(masterFunction.hasStatics())
-				{
-					newValue = masterFunction.getStaticSubstitution();
-				}
-				return newValue;
-	}
-	
-	private Collection replaceValues(Collection values)
-	{
-		Collection newColl = null;
-		try {
-			newColl = (Collection)values.getClass().newInstance();
-		} catch(Exception e) {
-			e.printStackTrace();
-			return values;
-		} 
-		Iterator iter = values.iterator();
-		while(iter.hasNext())
-		{
-			Object val = iter.next();
-			if(val instanceof TestElement)
-			{
-				replaceValues((TestElement)val);
-			}
-			else if(val instanceof String)
-			{
-				val = getNewValue((String)val);
-			}
-			else if(val instanceof Collection)
-			{
-				val = replaceValues((Collection)val);
-			}
-			newColl.add(val);
-		}
-		return newColl;
 	}
-	
-	
-
 }
diff --git a/jakarta-jmeter/src/core/org/apache/jmeter/engine/RemoteJMeterEngine.java b/jakarta-jmeter/src/core/org/apache/jmeter/engine/RemoteJMeterEngine.java
index e808ec8..5fd425c 100644
--- a/jakarta-jmeter/src/core/org/apache/jmeter/engine/RemoteJMeterEngine.java
+++ b/jakarta-jmeter/src/core/org/apache/jmeter/engine/RemoteJMeterEngine.java
@@ -57,7 +57,7 @@ package org.apache.jmeter.engine;
 import java.rmi.Remote;
 import java.rmi.RemoteException;
 
-import org.apache.jmeter.util.ListedHashTree;
+import org.apache.jorphan.collections.HashTree;
 
 /************************************************************
  *  Description of the Interface
@@ -67,7 +67,7 @@ import org.apache.jmeter.util.ListedHashTree;
  ***********************************************************/
 public interface RemoteJMeterEngine extends Remote
 {
-	void configure(ListedHashTree testTree) throws RemoteException;
+	void configure(HashTree testTree) throws RemoteException;
 
 	void runTest() throws RemoteException,JMeterEngineException;
 
diff --git a/jakarta-jmeter/src/core/org/apache/jmeter/engine/RemoteJMeterEngineImpl.java b/jakarta-jmeter/src/core/org/apache/jmeter/engine/RemoteJMeterEngineImpl.java
index 6a36f66..cfc32ab 100644
--- a/jakarta-jmeter/src/core/org/apache/jmeter/engine/RemoteJMeterEngineImpl.java
+++ b/jakarta-jmeter/src/core/org/apache/jmeter/engine/RemoteJMeterEngineImpl.java
@@ -57,7 +57,9 @@ import java.net.InetAddress;
 import java.rmi.Naming;
 import java.rmi.RemoteException;
 
-import org.apache.jmeter.util.ListedHashTree;
+import org.apache.log.Hierarchy;
+import org.apache.log.Logger;
+import org.apache.jorphan.collections.HashTree;
 
 
 /************************************************************
@@ -70,6 +72,8 @@ public class RemoteJMeterEngineImpl
 		 extends java.rmi.server.UnicastRemoteObject
 		 implements RemoteJMeterEngine
 {
+	transient private static Logger log = Hierarchy.getDefaultHierarchy().getLoggerFor(
+			"jmeter.engine");
 	JMeterEngine backingEngine;
 
 	/************************************************************
@@ -86,7 +90,7 @@ public class RemoteJMeterEngineImpl
 		}
 		catch(Exception ex)
 		{
-			ex.printStackTrace();
+			log.error("rmiregistry needs to be running to start JMeter in server mode",ex);
 		}
 	}
 	
@@ -103,7 +107,7 @@ public class RemoteJMeterEngineImpl
 	 *      attribute
 	 *@exception  RemoteException  Description of Exception
 	 ***********************************************************/
-	public void configure(ListedHashTree testTree) throws RemoteException
+	public void configure(HashTree testTree) throws RemoteException
 	{
 		backingEngine.configure(testTree);
 	}
@@ -155,7 +159,7 @@ public class RemoteJMeterEngineImpl
 		}
 		catch(Exception ex)
 		{
-			ex.printStackTrace();
+			log.error("",ex);
 		}
 
 	}
diff --git a/jakarta-jmeter/src/core/org/apache/jmeter/engine/StandardJMeterEngine.java b/jakarta-jmeter/src/core/org/apache/jmeter/engine/StandardJMeterEngine.java
index 453b20c..4dc771c 100644
--- a/jakarta-jmeter/src/core/org/apache/jmeter/engine/StandardJMeterEngine.java
+++ b/jakarta-jmeter/src/core/org/apache/jmeter/engine/StandardJMeterEngine.java
@@ -55,43 +55,56 @@
 package org.apache.jmeter.engine;
 
 import java.io.PrintWriter;
+import java.io.Serializable;
 import java.io.StringWriter;
+import java.util.HashMap;
 import java.util.HashSet;
 import java.util.Iterator;
-import java.util.Set;
+import java.util.LinkedList;
+import java.util.List;
+import java.util.Map;
 
 import org.apache.jmeter.reporters.ResultCollector;
+import org.apache.jmeter.testelement.TestElement;
 import org.apache.jmeter.testelement.TestListener;
 import org.apache.jmeter.testelement.TestPlan;
 import org.apache.jmeter.threads.JMeterThread;
 import org.apache.jmeter.threads.JMeterThreadMonitor;
-import org.apache.jmeter.threads.JMeterVariables;
+import org.apache.jmeter.threads.ListenerNotifier;
 import org.apache.jmeter.threads.TestCompiler;
 import org.apache.jmeter.threads.ThreadGroup;
-import org.apache.jmeter.util.ListedHashTree;
-import org.apache.jmeter.util.SearchByClass;
+import org.apache.log.Hierarchy;
+import org.apache.log.Logger;
+import org.apache.jorphan.collections.HashTree;
+import org.apache.jorphan.collections.ListedHashTree;
+import org.apache.jorphan.collections.SearchByClass;
 
 /************************************************************
  *  !ToDo (Class description)
  *
  *@author     $Author: mstover1 $
- *@created    $Date: 2002/08/11 19:24:43 $
- *@version    $Revision: 1.1 $
+ *@created    $Date: 2002/10/17 19:47:15 $
+ *@version    $Revision: 1.15 $
  ***********************************************************/
-public class StandardJMeterEngine implements JMeterEngine,JMeterThreadMonitor
+public class StandardJMeterEngine implements JMeterEngine,JMeterThreadMonitor,
+		Runnable,Serializable
 {
-	Set allThreads;
+	transient private static Logger log = Hierarchy.getDefaultHierarchy().getLoggerFor(
+			"jmeter.engine");
+	private static long WAIT_TO_DIE = 5 * 1000; //5 seconds
+	Map allThreads;
 	boolean running = false;
-	ListedHashTree test;
+	HashTree test;
 	SearchByClass testListeners;
 	String host = null;
+	ListenerNotifier notifier;
 
 	/************************************************************
 	 *  !ToDo (Constructor description)
 	 ***********************************************************/
 	public StandardJMeterEngine()
 	{
-		allThreads = new HashSet();
+		allThreads = new HashMap();
 	}
 
 	public StandardJMeterEngine(String host)
@@ -100,7 +113,7 @@ public class StandardJMeterEngine implements JMeterEngine,JMeterThreadMonitor
 		this.host = host;
 	}
 
-	public void configure(ListedHashTree testTree)
+	public void configure(HashTree testTree)
 	{
 		test = testTree;
 	}
@@ -110,7 +123,7 @@ public class StandardJMeterEngine implements JMeterEngine,JMeterThreadMonitor
 		this.host = host;
 	}
 
-	protected ListedHashTree getTestTree()
+	protected HashTree getTestTree()
 	{
 		return test;
 	}
@@ -128,9 +141,11 @@ public class StandardJMeterEngine implements JMeterEngine,JMeterThreadMonitor
 	{
 		try
 		{
-			System.out.println("Running the test!");
+			log.info("Running the test!");
 			running = true;
 			compileTree();
+			List testLevelElements = new LinkedList(getTestTree().list(getTestTree().getArray()[0]));
+			removeThreadGroups(testLevelElements);
 			SearchByClass searcher = new SearchByClass(ThreadGroup.class);
 			testListeners = new SearchByClass(TestListener.class);
 			setMode();
@@ -146,20 +161,23 @@ public class StandardJMeterEngine implements JMeterEngine,JMeterThreadMonitor
 			{
 				notifyTestListenersOfStart();
 			}
-			JMeterVariables.initialize();
+			notifier = new ListenerNotifier();
+			notifier.start();
 			while(iter.hasNext())
 			{
 				ThreadGroup group = (ThreadGroup)iter.next();
 				threads = new JMeterThread[group.getNumThreads()];
 				for(int i = 0;running && i < threads.length; i++)
 				{
-					threads[i] = new JMeterThread(cloneTree(searcher.getSubTree(group)),this);
+					ListedHashTree threadGroupTree = (ListedHashTree)searcher.getSubTree(group);
+					threadGroupTree.add(group,testLevelElements);
+					threads[i] = new JMeterThread(cloneTree(threadGroupTree),this,notifier);
 					threads[i].setInitialDelay((int)(((float)(group.getRampUp() * 1000) /
 							(float)group.getNumThreads()) * (float)i));
 					threads[i].setThreadName(group.getName()+"-"+(i+1));
 					Thread newThread = new Thread(threads[i]);
 					newThread.setName(group.getName()+"-"+(i+1));
-					allThreads.add(threads[i]);
+					allThreads.put(threads[i],newThread);
 					newThread.start();
 				}
 			}
@@ -174,6 +192,23 @@ public class StandardJMeterEngine implements JMeterEngine,JMeterThreadMonitor
 		}
 	}
 	
+	private void removeThreadGroups(List elements)
+	{
+		Iterator iter = elements.iterator();
+		while(iter.hasNext())
+		{
+			Object item = iter.next();
+			if(item instanceof ThreadGroup)
+			{
+				iter.remove();
+			}
+			else if(!(item instanceof TestElement))
+			{
+				iter.remove();
+			}
+		}
+	}
+	
 	protected void setMode()
 	{
 		SearchByClass testPlan = new SearchByClass(TestPlan.class);
@@ -201,7 +236,19 @@ public class StandardJMeterEngine implements JMeterEngine,JMeterThreadMonitor
 
 	protected void notifyTestListenersOfEnd()
 	{
+		notifier.stop();
 		Iterator iter = testListeners.getSearchResults().iterator();
+		while(!notifier.isStopped())
+		{
+			try
+			{
+				Thread.sleep(1000);
+			}
+			catch (InterruptedException e)
+			{
+			}
+			log.debug("Waiting for notifier thread to stop");
+		}
 		while(iter.hasNext())
 		{
 			if(host == null)
@@ -234,26 +281,87 @@ public class StandardJMeterEngine implements JMeterEngine,JMeterThreadMonitor
 		}
 	}
 
-	public void threadFinished(JMeterThread thread)
+	public synchronized void threadFinished(JMeterThread thread)
 	{
 		allThreads.remove(thread);
 		if(allThreads.size() == 0)
 		{
-			notifyTestListenersOfEnd();
+			stopTest();
 		}
+		/*if(allThreads.size() == 0)
+		{
+			notifyTestListenersOfEnd();
+		}*/
 	}
 
 	/************************************************************
 	 *  !ToDo (Method description)
 	 ***********************************************************/
-	public void stopTest()
+	public synchronized void stopTest()
 	{
-		running = false;
-		Iterator iter = new HashSet(allThreads).iterator();
+		if(running)
+		{
+			running = false;		
+			Thread stopThread = new Thread(this);
+			stopThread.start();
+		}
+	}
+	
+	public void run()
+	{
+		tellThreadsToStop();
+		try
+		{
+			Thread.sleep(10 * allThreads.size());
+		}
+		catch (InterruptedException e)
+		{
+		}
+		verifyThreadsStopped();
+		notifyTestListenersOfEnd();	
+	}
+
+	private void verifyThreadsStopped()
+	{
+		Iterator iter = new HashSet(allThreads.keySet()).iterator();
+		while(iter.hasNext())
+		{
+			Thread t = (Thread)allThreads.get(iter.next());
+			if(t != null && t.isAlive())
+			{
+				try
+				{
+					t.join(WAIT_TO_DIE);
+				}
+				catch (InterruptedException e)
+				{
+				}
+				if(t.isAlive())
+				{
+					log.info("Thread won't die: "+t.getName());
+				}
+			}
+			log.debug("finished thread");
+		}
+	}
+
+	private void tellThreadsToStop()
+	{
+		Iterator iter = new HashSet(allThreads.keySet()).iterator();
 		while(iter.hasNext())
 		{
 			JMeterThread item = (JMeterThread)iter.next();
 			item.stop();
+			Thread t = (Thread)allThreads.get(item);
+			if(t != null)
+			{
+				t.interrupt();
+			}
+			else
+			{
+				log.warn("Lost thread: "+item.getThreadName());
+				allThreads.remove(item);
+			}
 		}
 	}
 
diff --git a/jakarta-jmeter/src/core/org/apache/jmeter/engine/TreeCloner.java b/jakarta-jmeter/src/core/org/apache/jmeter/engine/TreeCloner.java
index 5f6053d..cec6113 100644
--- a/jakarta-jmeter/src/core/org/apache/jmeter/engine/TreeCloner.java
+++ b/jakarta-jmeter/src/core/org/apache/jmeter/engine/TreeCloner.java
@@ -2,11 +2,12 @@ package org.apache.jmeter.engine;
 
 import java.util.LinkedList;
 
-import org.apache.jmeter.testelement.PerThreadClonable;
-import org.apache.jmeter.util.ListedHashTree;
-import org.apache.jmeter.util.ListedHashTreeVisitor;
-import org.apache.jmeter.control.GenericController;
 import org.apache.jmeter.config.Arguments;
+import org.apache.jmeter.control.GenericController;
+import org.apache.jmeter.testelement.PerThreadClonable;
+import org.apache.jorphan.collections.HashTree;
+import org.apache.jorphan.collections.HashTreeTraverser;
+import org.apache.jorphan.collections.ListedHashTree;
 
 /**
  * <p>Title: </p>
@@ -17,7 +18,7 @@ import org.apache.jmeter.config.Arguments;
  * @version 1.0
  */
 
-public class TreeCloner implements ListedHashTreeVisitor
+public class TreeCloner implements HashTreeTraverser
 {
 	ListedHashTree newTree;
 	LinkedList objects = new LinkedList();
@@ -26,7 +27,7 @@ public class TreeCloner implements ListedHashTreeVisitor
 	{
 		newTree = new ListedHashTree();
 	}
-	public void addNode(Object node,ListedHashTree subTree)
+	public void addNode(Object node,HashTree subTree)
 	{
 		if(node instanceof PerThreadClonable)
 		{
@@ -73,13 +74,13 @@ public class TreeCloner implements ListedHashTreeVisitor
 			ListedHashTree newTree = cloner.getClonedTree();
 			this.assertTrue(original != newTree);
 			assertEquals(original.size(),newTree.size());
-			assertEquals(original.get(original.getArray()[0]).size(),
-					newTree.get(newTree.getArray()[0]).size());
+			assertEquals(original.getTree(original.getArray()[0]).size(),
+					newTree.getTree(newTree.getArray()[0]).size());
 			assertTrue(original.getArray()[0] != newTree.getArray()[0]);
 			assertEquals(((GenericController)original.getArray()[0]).getName(),
 					((GenericController)newTree.getArray()[0]).getName());
-			assertSame(original.get(original.getArray()[0]).getArray()[0],
-							newTree.get(newTree.getArray()[0]).getArray()[0]);
+			assertSame(original.getTree(original.getArray()[0]).getArray()[0],
+							newTree.getTree(newTree.getArray()[0]).getArray()[0]);
 		}
 
 	}
diff --git a/jakarta-jmeter/src/core/org/apache/jmeter/exceptions/CVS/Entries b/jakarta-jmeter/src/core/org/apache/jmeter/exceptions/CVS/Entries
index 24f32a0..5b83227 100644
--- a/jakarta-jmeter/src/core/org/apache/jmeter/exceptions/CVS/Entries
+++ b/jakarta-jmeter/src/core/org/apache/jmeter/exceptions/CVS/Entries
@@ -1,2 +1,2 @@
-/IllegalUserActionException.java/1.1/Sun Aug 11 19:24:43 2002//Tv1_7_3
+/IllegalUserActionException.java/1.1/Sun Aug 11 19:24:43 2002//Tv1_8_1
 D
diff --git a/jakarta-jmeter/src/core/org/apache/jmeter/exceptions/CVS/Tag b/jakarta-jmeter/src/core/org/apache/jmeter/exceptions/CVS/Tag
index 5f312fe..e2fda28 100644
--- a/jakarta-jmeter/src/core/org/apache/jmeter/exceptions/CVS/Tag
+++ b/jakarta-jmeter/src/core/org/apache/jmeter/exceptions/CVS/Tag
@@ -1 +1 @@
-Nv1_7_3
+Nv1_8_1
diff --git a/jakarta-jmeter/src/core/org/apache/jmeter/functions/AbstractFunction.java b/jakarta-jmeter/src/core/org/apache/jmeter/functions/AbstractFunction.java
index 7c7e22f..447ab89 100644
--- a/jakarta-jmeter/src/core/org/apache/jmeter/functions/AbstractFunction.java
+++ b/jakarta-jmeter/src/core/org/apache/jmeter/functions/AbstractFunction.java
@@ -2,13 +2,15 @@ package org.apache.jmeter.functions;
 
 import java.net.URLDecoder;
 import java.util.Collection;
+import java.util.HashMap;
 import java.util.LinkedList;
 import java.util.List;
+import java.util.Map;
 import java.util.StringTokenizer;
 
-import org.apache.jmeter.functions.*;
 import org.apache.jmeter.samplers.SampleResult;
 import org.apache.jmeter.samplers.Sampler;
+import org.apache.jmeter.threads.JMeterVariables;
 
 /**
  * @author mstover
@@ -17,6 +19,7 @@ import org.apache.jmeter.samplers.Sampler;
  * Window>Preferences>Java>Templates.
  */
 public abstract class AbstractFunction implements Function {
+	private Map threadVariables = new HashMap();
 
 	/**
 	 * @see Function#execute(SampleResult, Sampler)
@@ -59,5 +62,17 @@ public abstract class AbstractFunction implements Function {
 		}
 		return arguments;
 	}
+	
+	protected JMeterVariables getVariables()
+	{
+		return (JMeterVariables)threadVariables.get(Thread.currentThread().getName());
+	}
+	
+	/**
+	 * @see org.apache.jmeter.functions.Function#setJMeterVariables(JMeterVariables)
+	 */
+	public void setJMeterVariables(JMeterVariables jmv) {
+		threadVariables.put(jmv.getThreadName(),jmv);
+	}
 
 }
diff --git a/jakarta-jmeter/src/core/org/apache/jmeter/functions/CVS/Entries b/jakarta-jmeter/src/core/org/apache/jmeter/functions/CVS/Entries
index c925cee..6479257 100644
--- a/jakarta-jmeter/src/core/org/apache/jmeter/functions/CVS/Entries
+++ b/jakarta-jmeter/src/core/org/apache/jmeter/functions/CVS/Entries
@@ -1,5 +1,7 @@
-/AbstractFunction.java/1.1/Sun Aug 11 19:24:43 2002//Tv1_7_3
-/CompoundFunction.java/1.1/Sun Aug 11 19:24:43 2002//Tv1_7_3
-/Function.java/1.1/Sun Aug 11 19:24:43 2002//Tv1_7_3
-/InvalidVariableException.java/1.1/Sun Aug 11 19:24:43 2002//Tv1_7_3
+/AbstractFunction.java/1.2/Fri Aug 16 21:10:20 2002//Tv1_8_1
+/CompoundFunction.java/1.9/Tue Jan 28 19:49:52 2003//Tv1_8_1
+/Function.java/1.1/Sun Aug 11 19:24:43 2002//Tv1_8_1
+/InvalidVariableException.java/1.1/Sun Aug 11 19:24:43 2002//Tv1_8_1
+/UnknownFunction.java/1.2/Sat Dec 14 01:23:44 2002//Tv1_8_1
+/ValueReplacer.java/1.4/Tue Oct 15 18:53:26 2002//Tv1_8_1
 D/gui////
diff --git a/jakarta-jmeter/src/core/org/apache/jmeter/functions/CVS/Tag b/jakarta-jmeter/src/core/org/apache/jmeter/functions/CVS/Tag
index 5f312fe..e2fda28 100644
--- a/jakarta-jmeter/src/core/org/apache/jmeter/functions/CVS/Tag
+++ b/jakarta-jmeter/src/core/org/apache/jmeter/functions/CVS/Tag
@@ -1 +1 @@
-Nv1_7_3
+Nv1_8_1
diff --git a/jakarta-jmeter/src/core/org/apache/jmeter/functions/CompoundFunction.java b/jakarta-jmeter/src/core/org/apache/jmeter/functions/CompoundFunction.java
index 0ce1d67..2a86aad 100644
--- a/jakarta-jmeter/src/core/org/apache/jmeter/functions/CompoundFunction.java
+++ b/jakarta-jmeter/src/core/org/apache/jmeter/functions/CompoundFunction.java
@@ -1,3 +1,58 @@
+/*
+ * ====================================================================
+ * The Apache Software License, Version 1.1
+ *
+ * Copyright (c) 2001-2003 The Apache Software Foundation.  All rights 
+ * reserved.
+ *
+ * Redistribution and use in source and binary forms, with or without
+ * modification, are permitted provided that the following conditions
+ * are met:
+ *
+ * 1. Redistributions of source code must retain the above copyright
+ * notice, this list of conditions and the following disclaimer.
+ *
+ * 2. Redistributions in binary form must reproduce the above copyright
+ * notice, this list of conditions and the following disclaimer in
+ * the documentation and/or other materials provided with the
+ * distribution.
+ *
+ * 3. The end-user documentation included with the redistribution,
+ * if any, must include the following acknowledgment:
+ * "This product includes software developed by the
+ * Apache Software Foundation (http://www.apache.org/)."
+ * Alternately, this acknowledgment may appear in the software itself,
+ * if and wherever such third-party acknowledgments normally appear.
+ *
+ * 4. The names "Apache" and "Apache Software Foundation" and
+ * "Apache JMeter" must not be used to endorse or promote products
+ * derived from this software without prior written permission. For
+ * written permission, please contact apache@apache.org.
+ *
+ * 5. Products derived from this software may not be called "Apache",
+ * "Apache JMeter", nor may "Apache" appear in their name, without
+ * prior written permission of the Apache Software Foundation.
+ *
+ * THIS SOFTWARE IS PROVIDED ``AS IS'' AND ANY EXPRESSED OR IMPLIED
+ * WARRANTIES, INCLUDING, BUT NOT LIMITED TO, THE IMPLIED WARRANTIES
+ * OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE ARE
+ * DISCLAIMED.  IN NO EVENT SHALL THE APACHE SOFTWARE FOUNDATION OR
+ * ITS CONTRIBUTORS BE LIABLE FOR ANY DIRECT, INDIRECT, INCIDENTAL,
+ * SPECIAL, EXEMPLARY, OR CONSEQUENTIAL DAMAGES (INCLUDING, BUT NOT
+ * LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES; LOSS OF
+ * USE, DATA, OR PROFITS; OR BUSINESS INTERRUPTION) HOWEVER CAUSED AND
+ * ON ANY THEORY OF LIABILITY, WHETHER IN CONTRACT, STRICT LIABILITY,
+ * OR TORT (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT
+ * OF THE USE OF THIS SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF
+ * SUCH DAMAGE.
+ * ====================================================================
+ *
+ * This software consists of voluntary contributions made by many
+ * individuals on behalf of the Apache Software Foundation.  For more
+ * information on the Apache Software Foundation, please see
+ * <http://www.apache.org/>.
+ */
+
 package org.apache.jmeter.functions;
 
 import java.net.URLEncoder;
@@ -11,406 +66,497 @@ import junit.framework.TestCase;
 
 import org.apache.jmeter.samplers.SampleResult;
 import org.apache.jmeter.samplers.Sampler;
-import org.apache.jmeter.testelement.PerThreadClonable;
 import org.apache.jmeter.threads.JMeterVariables;
-import org.apache.jmeter.util.ClassFinder;
+import org.apache.jmeter.util.JMeterUtils;
+import org.apache.log.Hierarchy;
+import org.apache.log.Logger;
 import org.apache.oro.text.perl.Perl5Util;
 import org.apache.oro.text.regex.PatternCompiler;
 import org.apache.oro.text.regex.Perl5Compiler;
+import org.apache.jorphan.reflect.ClassFinder;
 
 /**
- * @author mstover
+ * CompoundFunction
  *
- * To change this generated comment edit the template variable "typecomment":
- * Window>Preferences>Java>Templates.
+ * @author mstover
+ * @version $Id: CompoundFunction.java,v 1.9 2003/01/28 19:49:52 mstover1 Exp $
  */
 public class CompoundFunction implements Function
 {
-	
-	private JMeterVariables threadVars;
-	
-	static Map functions = new HashMap();
-	private Map definedValues;
-	private boolean hasFunction,hasStatics;
-	private String staticSubstitution;
-	private static Perl5Util util = new Perl5Util();
-	
-	static private PatternCompiler compiler = new Perl5Compiler();
-	static private String variableSplitter = "/(\\${)/"; 
-	
-	LinkedList compiledComponents = new LinkedList();
-	
-	static
-	{
-		try
-		{
-			List classes = ClassFinder.findClassesThatExtend(new Class[]{Function.class},true);
-			Iterator iter = classes.iterator();
-			while(iter.hasNext())
-			{
-					Function tempFunc = (Function)Class.forName((String)iter.next()).newInstance();
-					functions.put(tempFunc.getReferenceKey(),tempFunc.getClass());
-			}
-		}
-		catch(Exception err)
-		{
-			err.printStackTrace();
-		}
-	}
-	
-	public CompoundFunction()
-	{
-		hasFunction = false;
-		hasStatics = false;
-		definedValues = new HashMap();
-		staticSubstitution = "";
-	}
-
-	/**
-	 * @see Function#execute(SampleResult)
-	 */
-	public String execute(SampleResult previousResult,Sampler currentSampler) {
-		if(compiledComponents == null || compiledComponents.size() == 0)
-		{
-			return "";
-		}
-		StringBuffer results = new StringBuffer();
-		Iterator iter = compiledComponents.iterator();
-		while(iter.hasNext())
-		{
-			Object item = iter.next();
-			if(item instanceof Function)
-			{
-				try {
-					results.append(((Function)item).execute(previousResult,currentSampler));
-				} catch(InvalidVariableException e) {
-				}
-			}
-			else
-			{
-				results.append(item);
-			}
-		}
-		return results.toString();
-	}
-	
-	public CompoundFunction getFunction()
-	{
-		CompoundFunction func = new CompoundFunction();
-		func.compiledComponents = (LinkedList)compiledComponents.clone();
-		return func;
-	}
-	
-	public List getArgumentDesc()
-	{
-		return new LinkedList();
-	}
-	
-	public void clear()
-	{
-		hasFunction = false;
-		hasStatics = false;
-		compiledComponents.clear();
-		staticSubstitution = "";
-	}
-	
-	public void setJMeterVariables(JMeterVariables threadVars)
-	{
-		Iterator iter = compiledComponents.iterator();
-		while(iter.hasNext())
-		{
-			Object item = iter.next();
-			if(item instanceof Function)
-			{
-				((Function)item).setJMeterVariables(threadVars);
-			}
-		}
-		this.threadVars = threadVars;
-	}
-
-	/**
-	 * @see Function#setParameters(String)
-	 */
-	public void setParameters(String parameters) throws InvalidVariableException 
-	{
-		if(parameters == null || parameters.length() == 0)
-		{
-			return;
-		}
-		List components = new LinkedList();
-		util.split(components,variableSplitter,parameters);
-		Iterator iter = components.iterator();
-		String previous = "";
-		while(iter.hasNext())
-		{
-			String part = (String)iter.next();
-			int index = getFunctionEndIndex(part);
-			if(index > -1 && previous.equals("${"))
-			{
-				String function = part.substring(0,index);
-				String functionName = parseFunctionName(function);
-				if(definedValues.containsKey(functionName))
-				{
-					Object replacement = definedValues.get(functionName);
-					if(replacement instanceof Class)
-					{
-						try {
-							hasFunction = true;
-							Function func = (Function)((Class)replacement).newInstance();
-							func.setParameters(extractParams(function));
-							compiledComponents.addLast(func);
-						} catch(Exception e) {
-							e.printStackTrace();
-							throw new InvalidVariableException();
-						} 
-					}
-					else
-					{
-						hasStatics = true;
-						addStringToComponents(compiledComponents,(String)replacement);
-					}
-				}
-				else
-				{
-					addStringToComponents(compiledComponents,"${"+function+"}");
-				}
-				if((index+1) < part.length())
-				{
-					addStringToComponents(compiledComponents,part.substring(index+1));
-				}
-			}
-			else if(previous.equals("${"))
-			{
-				addStringToComponents(compiledComponents,"${");
-				addStringToComponents(compiledComponents,part);
-			}
-			else if(!part.equals("${"))
-			{
-				addStringToComponents(compiledComponents, part);
-			}
-			previous = part;
-		}
-		if(!hasFunction)
-		{
-			staticSubstitution = compiledComponents.getLast().toString();
-			if(hasStatics())
-			{
-				compiledComponents.clear();
-				hasStatics = false;
-				setParameters(staticSubstitution);
-				hasStatics = true;
-			}
-		}
-		else if(hasStatics())
-		{
-			iter = new LinkedList(compiledComponents).iterator();
-			while(iter.hasNext())
-			{
-				Object item = iter.next();
-				if(item instanceof StringBuffer)
-				{
-					CompoundFunction nestedFunc = new CompoundFunction();
-					nestedFunc.setUserDefinedVariables(new HashMap());
-					nestedFunc.setParameters(item.toString());
-					if(nestedFunc.hasFunction())
-					{
-						int index = compiledComponents.indexOf(item);
-						compiledComponents.remove(index);
-						compiledComponents.add(index,nestedFunc);
-					}
-				}
-			} 
-		}
-	}
-
-	private void addStringToComponents(LinkedList refinedComponents, String part) {
-		if(part == null || part.length() == 0)
-		{
-			return;
-		}
-		if(refinedComponents.size() == 0)
-		{
-			refinedComponents.addLast(new StringBuffer(part));
-		}
-		else
-		{
-			if(refinedComponents.getLast() instanceof StringBuffer)
-			{
-				((StringBuffer)refinedComponents.getLast()).append(part);
-			}
-			else
-			{
-				refinedComponents.addLast(new StringBuffer(part));
-			}
-		}
-	}
-	
-	private String extractParams(String function)
-	{
-		if(function.indexOf("(") > -1)
-		{
-			return function.substring(function.indexOf("(")+1,function.lastIndexOf(")"));
-		}
-		else
-		{
-			return "";
-		}
-	}
-
-	private int getFunctionEndIndex(String part) {
-		int index = part.indexOf("}");
-		return index;
-	}
-
-	private String parseFunctionName(String function) {
-		String functionName = function;
-		int parenIndex = -1;
-		if((parenIndex = function.indexOf("(")) > -1)
-		{
-			functionName = function.substring(0,parenIndex);
-		}
-		return functionName;
-	}
-	
-	public boolean hasFunction()
-	{
-		return hasFunction;
-	}
-	
-	public boolean hasStatics()
-	{
-		return hasStatics;
-	}
-	
-	public String getStaticSubstitution()
-	{
-		return staticSubstitution;
-	}
-	
-	public void setUserDefinedVariables(Map userVariables)
-	{
-		definedValues.clear();
-		definedValues.putAll(functions);
-		definedValues.putAll(userVariables);
-	}
-
-	/**
-	 * @see Function#getReferenceKey()
-	 */
-	public String getReferenceKey() {
-		return "";
-	}
-	
-	public static class Test extends TestCase
-	{
-		CompoundFunction function;
-		SampleResult result;
-		
-		public Test(String name)
-		{
-			super(name);
-		}
-		
-		public void setUp()
-		{
-			Map userDefinedVariables = new HashMap();
-			userDefinedVariables.put("my_regex",".*");
-			userDefinedVariables.put("server","jakarta.apache.org");
-			function = new CompoundFunction();
-			function.setUserDefinedVariables(userDefinedVariables);
-			result = new SampleResult();
-			result.setResponseData("<html>hello world</html>".getBytes());
-		}
-		
-		public void testParseExample1() throws Exception
-		{
-			function.setParameters("${__regexFunction(<html>(.*)</html>,$1$)}");
-			assertEquals(1,function.compiledComponents.size());
-			assertTrue(function.compiledComponents.getFirst() instanceof RegexFunction);
-			assertTrue(function.hasFunction());
-			assertTrue(!function.hasStatics());
-			assertEquals("hello world",((Function)function.compiledComponents.getFirst()).execute(result,null));
-			assertEquals("hello world",function.execute(result,null));
-		}
-		
-		public void testParseExample2() throws Exception
-		{
-			function.setParameters("It should say:${${__regexFunction("+URLEncoder.encode("<html>(.*)</html>")+",$1$)}}");
-			assertEquals(3,function.compiledComponents.size());
-			assertEquals("It should say:${",function.compiledComponents.getFirst().toString());
-			assertTrue(function.hasFunction());
-			assertTrue(!function.hasStatics());
-			assertEquals("hello world",((Function)function.compiledComponents.get(1)).execute(result,null));
-			assertEquals("}",function.compiledComponents.get(2).toString());
-			assertEquals("It should say:${hello world}",function.execute(result,null));
-			assertEquals("It should say:${<html>(.*)</html>,$1$}",function.execute(null,null));
-		}
-		
-		public void testParseExample3() throws Exception
-		{
-			function.setParameters("${__regexFunction(<html>(.*)</html>,$1$)}${__regexFunction(<html>(.*o)(.*o)(.*)</html>,$1$$3$)}");
-			assertEquals(2,function.compiledComponents.size());
-			assertTrue(function.hasFunction());
-			assertTrue(!function.hasStatics());
-			assertEquals("hello world",((Function)function.compiledComponents.get(0)).execute(result,null));
-			assertEquals("hellorld",((Function)function.compiledComponents.get(1)).execute(result,null));
-			assertEquals("hello worldhellorld",function.execute(result,null));
-			assertEquals("<html>(.*)</html>,$1$<html>(.*o)(.*o)(.*)</html>,$1$$3$",
-					function.execute(null,null));
-		}
-		
-		public void testParseExample4() throws Exception
-		{
-			function.setParameters("${non-existing function}");
-			assertEquals(1,function.compiledComponents.size());
-			assertTrue(!function.hasFunction());
-			assertTrue(!function.hasStatics());
-			assertEquals("${non-existing function}",
-					function.compiledComponents.getFirst().toString());
-			assertEquals("${non-existing function}",function.execute(result,null));
-			assertEquals("${non-existing function}",function.execute(null,null));
-		}
-		
-		public void testParseExample6() throws Exception
-		{
-			function.setParameters("${server}");
-			assertEquals(1,function.compiledComponents.size());
-			assertTrue(!function.hasFunction());
-			assertTrue(function.hasStatics());
-			assertEquals("jakarta.apache.org",function.execute(null,null));
-		}
-		
-		public void testParseExample5() throws Exception
-		{
-			function.setParameters("");
-			assertEquals(0,function.compiledComponents.size());
-			assertTrue(!function.hasFunction());
-			assertTrue(!function.hasStatics());
-		}
-		
-		public void testNestedExample1() throws Exception
-		{
-			function.setParameters("${__regexFunction(<html>(${my_regex})</html>,$1$)}${__regexFunction(<html>(.*o)(.*o)(.*)</html>,$1$$3$)}");
-			assertEquals(2,function.compiledComponents.size());
-			assertTrue(function.hasFunction());
-			assertTrue(function.hasStatics());
-			assertEquals("hello world",((Function)function.compiledComponents.get(0)).execute(result,null));
-			assertEquals("hellorld",((Function)function.compiledComponents.get(1)).execute(result,null));
-			assertEquals("hello worldhellorld",function.execute(result,null));
-			assertEquals("<html>(.*)</html>,$1$<html>(.*o)(.*o)(.*)</html>,$1$$3$",
-					function.execute(null,null));
-		}
-		
-		public void testNestedExample2() throws Exception
-		{
-			function.setParameters("${__regexFunction(<html>(${my_regex})</html>,$1$)}");
-			assertEquals(1,function.compiledComponents.size());
-			assertTrue(function.compiledComponents.getFirst() instanceof RegexFunction);
-			assertTrue(function.hasFunction());
-			assertTrue(function.hasStatics());
-			assertEquals("hello world",((Function)function.compiledComponents.getFirst()).execute(result,null));
-			assertEquals("hello world",function.execute(result,null));
-		}
-	}
+    transient private static Logger log =
+        Hierarchy.getDefaultHierarchy().getLoggerFor("jmeter.elements");
+    private JMeterVariables threadVars;
+
+    static Map functions = new HashMap();
+    private Map definedValues;
+    private boolean hasFunction, hasStatics, hasUnknowns;
+    private String staticSubstitution;
+    private static Perl5Util util = new Perl5Util();
+
+    static private PatternCompiler compiler = new Perl5Compiler();
+    static private String variableSplitter = "/(\\${)/";
+
+    LinkedList compiledComponents = new LinkedList();
+
+    static {
+        try
+        {
+            List classes =
+                ClassFinder.findClassesThatExtend(
+                    JMeterUtils.getSearchPaths(),
+                    new Class[] { Function.class },
+                    true);
+            Iterator iter = classes.iterator();
+            while (iter.hasNext())
+            {
+                Function tempFunc =
+                    (Function) Class.forName((String) iter.next()).newInstance();
+                functions.put(tempFunc.getReferenceKey(), tempFunc.getClass());
+            }
+        }
+        catch (Exception err)
+        {
+            log.error("", err);
+        }
+    }
+
+    public CompoundFunction()
+    {
+        hasFunction = false;
+        hasStatics = false;
+        hasUnknowns = false;
+        definedValues = new HashMap();
+        staticSubstitution = "";
+    }
+
+    /**
+     * @see Function#execute(SampleResult)
+     */
+    public String execute(SampleResult previousResult, Sampler currentSampler)
+    {
+        if (compiledComponents == null || compiledComponents.size() == 0)
+        {
+            return "";
+        }
+        StringBuffer results = new StringBuffer();
+        Iterator iter = compiledComponents.iterator();
+        while (iter.hasNext())
+        {
+            Object item = iter.next();
+            if (item instanceof Function)
+            {
+                try
+                {
+                    results.append(
+                        ((Function) item).execute(
+                            previousResult,
+                            currentSampler));
+                }
+                catch (InvalidVariableException e)
+                {
+                }
+            }
+            else
+            {
+                results.append(item);
+            }
+        }
+        return results.toString();
+    }
+
+    public CompoundFunction getFunction()
+    {
+        CompoundFunction func = new CompoundFunction();
+        func.compiledComponents = (LinkedList) compiledComponents.clone();
+        return func;
+    }
+
+    public List getArgumentDesc()
+    {
+        return new LinkedList();
+    }
+
+    public void clear()
+    {
+        hasFunction = false;
+        hasStatics = false;
+        compiledComponents.clear();
+        staticSubstitution = "";
+    }
+
+    public void setJMeterVariables(JMeterVariables threadVars)
+    {
+        Iterator iter = compiledComponents.iterator();
+        while (iter.hasNext())
+        {
+            Object item = iter.next();
+            if (item instanceof Function)
+            {
+                ((Function) item).setJMeterVariables(threadVars);
+            }
+        }
+        this.threadVars = threadVars;
+    }
+
+    /**
+     * @see Function#setParameters(String)
+     */
+    public void setParameters(String parameters)
+        throws InvalidVariableException
+    {
+        if (parameters == null || parameters.length() == 0)
+        {
+            return;
+        }
+        List components = new LinkedList();
+        util.split(components, variableSplitter, parameters);
+        Iterator iter = components.iterator();
+        String previous = "";
+        while (iter.hasNext())
+        {
+            String part = (String) iter.next();
+            int index = getFunctionEndIndex(part);
+            if (index > -1 && previous.equals("${"))
+            {
+                String function = part.substring(0, index);
+                String functionName = parseFunctionName(function);
+                if (definedValues.containsKey(functionName))
+                {
+                    Object replacement = definedValues.get(functionName);
+                    if (replacement instanceof Class)
+                    {
+                        try
+                        {
+                            hasFunction = true;
+                            Function func =
+                                (Function) ((Class) replacement).newInstance();
+                            func.setParameters(extractParams(function));
+                            compiledComponents.addLast(func);
+                        }
+                        catch (Exception e)
+                        {
+                            log.error("", e);
+                            throw new InvalidVariableException();
+                        }
+                    }
+                    else
+                    {
+                        hasStatics = true;
+                        addStringToComponents(
+                            compiledComponents,
+                            (String) replacement);
+                    }
+                }
+                else
+                {
+                    UnknownFunction unknown = new UnknownFunction(functionName);
+                    compiledComponents.addLast(unknown);
+                    hasFunction = true;
+                    hasUnknowns = true;
+                }
+                if ((index + 1) < part.length())
+                {
+                    addStringToComponents(
+                        compiledComponents,
+                        part.substring(index + 1));
+                }
+            }
+            else if (previous.equals("${"))
+            {
+                addStringToComponents(compiledComponents, "${");
+                addStringToComponents(compiledComponents, part);
+            }
+            else if (!part.equals("${"))
+            {
+                addStringToComponents(compiledComponents, part);
+            }
+            previous = part;
+        }
+        if (!hasFunction)
+        {
+            staticSubstitution = compiledComponents.getLast().toString();
+            if (hasStatics())
+            {
+                compiledComponents.clear();
+                hasStatics = false;
+                setParameters(staticSubstitution);
+                hasStatics = true;
+            }
+        }
+        else if (hasStatics())
+        {
+            iter = new LinkedList(compiledComponents).iterator();
+            while (iter.hasNext())
+            {
+                Object item = iter.next();
+                if (item instanceof StringBuffer)
+                {
+                    CompoundFunction nestedFunc = new CompoundFunction();
+                    nestedFunc.setUserDefinedVariables(new HashMap());
+                    nestedFunc.setParameters(item.toString());
+                    if (nestedFunc.hasFunction())
+                    {
+                        int index = compiledComponents.indexOf(item);
+                        compiledComponents.remove(index);
+                        compiledComponents.add(index, nestedFunc);
+                    }
+                }
+            }
+        }
+    }
+
+    private void addStringToComponents(
+        LinkedList refinedComponents,
+        String part)
+    {
+        if (part == null || part.length() == 0)
+        {
+            return;
+        }
+        if (refinedComponents.size() == 0)
+        {
+            refinedComponents.addLast(new StringBuffer(part));
+        }
+        else
+        {
+            if (refinedComponents.getLast() instanceof StringBuffer)
+            {
+                ((StringBuffer) refinedComponents.getLast()).append(part);
+            }
+            else
+            {
+                refinedComponents.addLast(new StringBuffer(part));
+            }
+        }
+    }
+
+    private String extractParams(String function)
+    {
+        if (function.indexOf("(") > -1)
+        {
+            return function.substring(
+                function.indexOf("(") + 1,
+                function.lastIndexOf(")"));
+        }
+        else
+        {
+            return "";
+        }
+    }
+
+    private int getFunctionEndIndex(String part)
+    {
+        int index = part.indexOf("}");
+        return index;
+    }
+
+    private String parseFunctionName(String function)
+    {
+        String functionName = function;
+        int parenIndex = -1;
+        if ((parenIndex = function.indexOf("(")) > -1)
+        {
+            functionName = function.substring(0, parenIndex);
+        }
+        return functionName;
+    }
+
+    public boolean hasFunction()
+    {
+        return hasFunction;
+    }
+
+    public boolean hasStatics()
+    {
+        return hasStatics;
+    }
+
+    public String getStaticSubstitution()
+    {
+        return staticSubstitution;
+    }
+
+    public void setUserDefinedVariables(Map userVariables)
+    {
+        definedValues.clear();
+        definedValues.putAll(functions);
+        definedValues.putAll(userVariables);
+    }
+
+    /**
+     * @see Function#getReferenceKey()
+     */
+    public String getReferenceKey()
+    {
+        return "";
+    }
+
+    public static class Test extends TestCase
+    {
+        CompoundFunction function;
+        SampleResult result;
+
+        public Test(String name)
+        {
+            super(name);
+        }
+
+        public void setUp()
+        {
+            Map userDefinedVariables = new HashMap();
+            userDefinedVariables.put("my_regex", ".*");
+            userDefinedVariables.put("server", "jakarta.apache.org");
+            function = new CompoundFunction();
+            function.setUserDefinedVariables(userDefinedVariables);
+            result = new SampleResult();
+            result.setResponseData("<html>hello world</html>".getBytes());
+        }
+
+        public void testParseExample1() throws Exception
+        {
+            function.setParameters("${__regexFunction(<html>(.*)</html>,$1$)}");
+            function.setJMeterVariables(new JMeterVariables());
+            assertEquals(1, function.compiledComponents.size());
+            assertEquals(
+                "org.apache.jmeter.functions.RegexFunction",
+                function.compiledComponents.getFirst().getClass().getName());
+            assertTrue(function.hasFunction());
+            assertTrue(!function.hasStatics());
+            assertEquals(
+                "hello world",
+                ((Function) function.compiledComponents.getFirst()).execute(
+                    result,
+                    null));
+            assertEquals("hello world", function.execute(result, null));
+        }
+
+        public void testParseExample2() throws Exception
+        {
+            function.setParameters(
+                "It should say:${${__regexFunction("
+                    + URLEncoder.encode("<html>(.*)</html>")
+                    + ",$1$)}}");
+            function.setJMeterVariables(new JMeterVariables());
+            assertEquals(3, function.compiledComponents.size());
+            assertEquals(
+                "It should say:${",
+                function.compiledComponents.getFirst().toString());
+            assertTrue(function.hasFunction());
+            assertTrue(!function.hasStatics());
+            assertEquals(
+                "hello world",
+                ((Function) function.compiledComponents.get(1)).execute(
+                    result,
+                    null));
+            assertEquals("}", function.compiledComponents.get(2).toString());
+            assertEquals(
+                "It should say:${hello world}",
+                function.execute(result, null));
+            assertEquals(
+                "It should say:${<html>(.*)</html>,$1$}",
+                function.execute(null, null));
+        }
+
+        public void testParseExample3() throws Exception
+        {
+            function.setParameters(
+                "${__regexFunction(<html>(.*)</html>,$1$)}${__regexFunction(<html>(.*o)(.*o)(.*)</html>,$1$$3$)}");
+            function.setJMeterVariables(new JMeterVariables());
+            assertEquals(2, function.compiledComponents.size());
+            assertTrue(function.hasFunction());
+            assertTrue(!function.hasStatics());
+            assertEquals(
+                "hello world",
+                ((Function) function.compiledComponents.get(0)).execute(
+                    result,
+                    null));
+            assertEquals(
+                "hellorld",
+                ((Function) function.compiledComponents.get(1)).execute(
+                    result,
+                    null));
+            assertEquals("hello worldhellorld", function.execute(result, null));
+            assertEquals(
+                "<html>(.*)</html>,$1$<html>(.*o)(.*o)(.*)</html>,$1$$3$",
+                function.execute(null, null));
+        }
+
+        public void testParseExample4() throws Exception
+        {
+            function.setParameters("${non-existing function}");
+            function.setJMeterVariables(new JMeterVariables());
+            assertEquals(1, function.compiledComponents.size());
+            assertTrue(function.hasFunction());
+            assertTrue(!function.hasStatics());
+            assertEquals(
+                "${non-existing function}",
+                function.execute(result, null));
+            assertEquals(
+                "${non-existing function}",
+                function.execute(null, null));
+        }
+
+        public void testParseExample6() throws Exception
+        {
+            function.setParameters("${server}");
+            function.setJMeterVariables(new JMeterVariables());
+            assertEquals(1, function.compiledComponents.size());
+            assertTrue(!function.hasFunction());
+            assertTrue(function.hasStatics());
+            assertEquals("jakarta.apache.org", function.execute(null, null));
+        }
+
+        public void testParseExample5() throws Exception
+        {
+            function.setParameters("");
+            function.setJMeterVariables(new JMeterVariables());
+            assertEquals(0, function.compiledComponents.size());
+            assertTrue(!function.hasFunction());
+            assertTrue(!function.hasStatics());
+        }
+
+        public void testNestedExample1() throws Exception
+        {
+            function.setParameters(
+                "${__regexFunction(<html>(${my_regex})</html>,$1$)}${__regexFunction(<html>(.*o)(.*o)(.*)</html>,$1$$3$)}");
+            function.setJMeterVariables(new JMeterVariables());
+            assertEquals(2, function.compiledComponents.size());
+            assertTrue(function.hasFunction());
+            assertTrue(function.hasStatics());
+            assertEquals(
+                "hello world",
+                ((Function) function.compiledComponents.get(0)).execute(
+                    result,
+                    null));
+            assertEquals(
+                "hellorld",
+                ((Function) function.compiledComponents.get(1)).execute(
+                    result,
+                    null));
+            assertEquals("hello worldhellorld", function.execute(result, null));
+            assertEquals(
+                "<html>(.*)</html>,$1$<html>(.*o)(.*o)(.*)</html>,$1$$3$",
+                function.execute(null, null));
+        }
+
+        public void testNestedExample2() throws Exception
+        {
+            function.setParameters(
+                "${__regexFunction(<html>(${my_regex})</html>,$1$)}");
+            function.setJMeterVariables(new JMeterVariables());
+            assertEquals(1, function.compiledComponents.size());
+            assertEquals(
+                "org.apache.jmeter.functions.RegexFunction",
+                function.compiledComponents.getFirst().getClass().getName());
+            assertTrue(function.hasFunction());
+            assertTrue(function.hasStatics());
+            assertEquals(
+                "hello world",
+                ((Function) function.compiledComponents.getFirst()).execute(
+                    result,
+                    null));
+            assertEquals("hello world", function.execute(result, null));
+        }
+    }
 
 }
diff --git a/jakarta-jmeter/src/core/org/apache/jmeter/functions/UnknownFunction.java b/jakarta-jmeter/src/core/org/apache/jmeter/functions/UnknownFunction.java
new file mode 100644
index 0000000..39877e3
--- /dev/null
+++ b/jakarta-jmeter/src/core/org/apache/jmeter/functions/UnknownFunction.java
@@ -0,0 +1,80 @@
+package org.apache.jmeter.functions;
+
+import java.util.HashMap;
+import java.util.List;
+import java.util.Map;
+
+import org.apache.jmeter.samplers.SampleResult;
+import org.apache.jmeter.samplers.Sampler;
+import org.apache.jmeter.threads.JMeterVariables;
+
+/**
+ * @author Administrator
+ *
+ * To change this generated comment edit the template variable "typecomment":
+ * Window>Preferences>Java>Templates.
+ */
+public class UnknownFunction implements Function {
+	
+	private static final String KEY = "__unknownFunction";
+	private Map varMap = new HashMap();
+	private String name;
+	
+	public UnknownFunction(String name)
+	{
+		this.name = name;
+	}
+	
+	public UnknownFunction()
+	{
+		this.name = "";
+	}
+
+	/**
+	 * @see org.apache.jmeter.functions.Function#execute(SampleResult, Sampler)
+	 */
+	public String execute(SampleResult previousResult, Sampler currentSampler)
+		throws InvalidVariableException {
+		String ret = getVariables().get(name);
+		if(ret == null  || ret.length() == 0)
+		{
+			return "${"+name+"}";
+		}
+		return ret;
+	}
+	
+	private JMeterVariables getVariables()
+	{
+		return (JMeterVariables)varMap.get(Thread.currentThread().getName());
+	}
+
+	/**
+	 * @see org.apache.jmeter.functions.Function#setParameters(String)
+	 */
+	public void setParameters(String parameters)
+		throws InvalidVariableException {
+			
+	}
+
+	/**
+	 * @see org.apache.jmeter.functions.Function#getReferenceKey()
+	 */
+	public String getReferenceKey() {
+		return KEY;
+	}
+
+	/**
+	 * @see org.apache.jmeter.functions.Function#getArgumentDesc()
+	 */
+	public List getArgumentDesc() {
+		return null;
+	}
+
+	/**
+	 * @see org.apache.jmeter.functions.Function#setJMeterVariables(JMeterVariables)
+	 */
+	public void setJMeterVariables(JMeterVariables jmv) {
+		varMap.put(Thread.currentThread().getName(),jmv);
+	}
+
+}
diff --git a/jakarta-jmeter/src/core/org/apache/jmeter/functions/ValueReplacer.java b/jakarta-jmeter/src/core/org/apache/jmeter/functions/ValueReplacer.java
new file mode 100644
index 0000000..bd1b48d
--- /dev/null
+++ b/jakarta-jmeter/src/core/org/apache/jmeter/functions/ValueReplacer.java
@@ -0,0 +1,219 @@
+package org.apache.jmeter.functions;
+
+import java.util.Collection;
+import java.util.HashMap;
+import java.util.Iterator;
+import java.util.LinkedList;
+import java.util.List;
+import java.util.Map;
+
+import junit.framework.TestCase;
+
+import org.apache.jmeter.testelement.TestElement;
+import org.apache.jmeter.testelement.TestPlan;
+import org.apache.jmeter.util.JMeterUtils;
+import org.apache.jmeter.util.StringUtilities;
+import org.apache.log.Hierarchy;
+import org.apache.log.Logger;
+
+/**
+ * @author Administrator
+ *
+ * To change this generated comment edit the template variable "typecomment":
+ * Window>Preferences>Java>Templates.
+ */
+public class ValueReplacer
+{
+	transient private static Logger log = Hierarchy.getDefaultHierarchy().getLoggerFor(JMeterUtils.ELEMENTS);
+	CompoundFunction masterFunction = new CompoundFunction();
+	Map variables = new HashMap();
+	
+	public ValueReplacer()
+	{
+	}
+
+	public ValueReplacer(Map variables)
+	{
+		setUserDefinedVariables(variables);
+	}
+	
+	public void setUserDefinedVariables(Map variables)
+	{
+		masterFunction.setUserDefinedVariables(variables);
+		this.variables = variables;
+	}
+	
+	public void replaceValues(TestElement el) throws InvalidVariableException
+	{
+		Iterator iter = el.getPropertyNames().iterator();
+		while(iter.hasNext())
+		{
+			String propName = (String)iter.next();
+			Object propValue = el.getProperty(propName);
+			if(propValue instanceof String)
+			{
+				Object newValue = getNewValue((String)propValue);
+				el.setProperty(propName,newValue);
+			}
+			else if(propValue instanceof TestElement)
+			{
+				replaceValues((TestElement)propValue);
+			}
+			else if(propValue instanceof Collection)
+			{
+				el.setProperty(propName,replaceValues((Collection)propValue));
+			}
+		}
+	}
+	
+	private Object getNewValue(String propValue) throws InvalidVariableException
+	{
+		Object newValue = propValue;
+				masterFunction.clear();
+				masterFunction.setParameters((String)propValue);
+				if(masterFunction.hasFunction())
+				{
+					newValue = masterFunction.getFunction();
+				}
+				else if(masterFunction.hasStatics())
+				{
+					newValue = masterFunction.getStaticSubstitution();
+				}
+				return newValue;
+	}
+	
+	public Collection replaceValues(Collection values) throws InvalidVariableException
+	{
+		Collection newColl = null;
+		try {
+			newColl = (Collection)values.getClass().newInstance();
+		} catch(Exception e) {
+			log.error("",e);
+			return values;
+		} 
+		Iterator iter = values.iterator();
+		while(iter.hasNext())
+		{
+			Object val = iter.next();
+			if(val instanceof TestElement)
+			{
+				replaceValues((TestElement)val);
+			}
+			else if(val instanceof String)
+			{
+				val = getNewValue((String)val);
+			}
+			else if(val instanceof Collection)
+			{
+				val = replaceValues((Collection)val);
+			}
+			newColl.add(val);
+		}
+		return newColl;
+	}
+	
+	/**
+	 * Replaces raw values with user-defined variable names.
+	 */
+	public Collection reverseReplace(Collection values)
+	{
+		Collection newColl = null;
+		try {
+			newColl = (Collection)values.getClass().newInstance();
+		} catch(Exception e) {
+			log.error("",e);
+			return values;
+		} 
+		Iterator iter = values.iterator();
+		while(iter.hasNext())
+		{
+			Object val = iter.next();
+			if(val instanceof TestElement)
+			{
+				reverseReplace((TestElement)val);
+			}
+			else if(val instanceof String)
+			{
+				val = substituteValues((String)val);
+			}
+			else if(val instanceof Collection)
+			{
+				val = reverseReplace((Collection)val);
+			}
+			newColl.add(val);
+		}
+		return newColl;
+	} 
+	
+	/**
+	 * Replaces raw values with user-defined variable names.
+	 */
+	public void reverseReplace(TestElement el)
+	{
+		Iterator iter = el.getPropertyNames().iterator();
+		while(iter.hasNext())
+		{
+			String propName = (String)iter.next();
+			Object propValue = el.getProperty(propName);
+			if(propValue instanceof String)
+			{
+				Object newValue = substituteValues((String)propValue);
+				el.setProperty(propName,newValue);
+			}
+			else if(propValue instanceof TestElement)
+			{
+				reverseReplace((TestElement)propValue);
+			}
+			else if(propValue instanceof Collection)
+			{
+				el.setProperty(propName,reverseReplace((Collection)propValue));
+			}
+		}
+	}
+	
+	private String substituteValues(String input)
+	{
+		Iterator iter = variables.keySet().iterator();
+		while(iter.hasNext())
+		{
+			String key = (String)iter.next();
+			String value = (String)variables.get(key);
+			input = StringUtilities.substitute(input,value,"${"+key+"}");
+		}
+		return input;
+	}
+			
+			
+	
+	public static class Test extends TestCase
+	{
+		Map variables;
+		
+		public Test(String name)
+		{
+			super(name);
+		}
+		
+		public void setUp()
+		{
+			variables = new HashMap();
+			variables.put("server","jakarta.apache.org");
+			variables.put("username","jack");
+			variables.put("password","jacks_password");
+			variables.put("regex",".*");
+		}
+		
+		public void testReverseReplacement() throws Exception
+		{
+			ValueReplacer replacer = new ValueReplacer(variables);
+			TestElement element = new TestPlan();
+			element.setProperty("domain","jakarta.apache.org");
+			List args = new LinkedList();
+			args.add("username is jack");
+			args.add("jacks_password");
+			element.setProperty("args",args);
+			replacer.reverseReplace(element);
+			assertEquals("${server}",element.getProperty("domain"));
+		}
+	}
+}
diff --git a/jakarta-jmeter/src/core/org/apache/jmeter/functions/gui/CVS/Entries b/jakarta-jmeter/src/core/org/apache/jmeter/functions/gui/CVS/Entries
index dae6570..4fc7ec3 100644
--- a/jakarta-jmeter/src/core/org/apache/jmeter/functions/gui/CVS/Entries
+++ b/jakarta-jmeter/src/core/org/apache/jmeter/functions/gui/CVS/Entries
@@ -1,2 +1,2 @@
-/FunctionHelper.java/1.1/Sun Aug 11 19:24:43 2002//Tv1_7_3
+/FunctionHelper.java/1.4/Thu Oct 17 19:47:16 2002//Tv1_8_1
 D
diff --git a/jakarta-jmeter/src/core/org/apache/jmeter/functions/gui/CVS/Tag b/jakarta-jmeter/src/core/org/apache/jmeter/functions/gui/CVS/Tag
index 5f312fe..e2fda28 100644
--- a/jakarta-jmeter/src/core/org/apache/jmeter/functions/gui/CVS/Tag
+++ b/jakarta-jmeter/src/core/org/apache/jmeter/functions/gui/CVS/Tag
@@ -1 +1 @@
-Nv1_7_3
+Nv1_8_1
diff --git a/jakarta-jmeter/src/core/org/apache/jmeter/functions/gui/FunctionHelper.java b/jakarta-jmeter/src/core/org/apache/jmeter/functions/gui/FunctionHelper.java
index 8565797..c694677 100644
--- a/jakarta-jmeter/src/core/org/apache/jmeter/functions/gui/FunctionHelper.java
+++ b/jakarta-jmeter/src/core/org/apache/jmeter/functions/gui/FunctionHelper.java
@@ -17,15 +17,17 @@ import javax.swing.JFrame;
 import javax.swing.JPanel;
 import javax.swing.event.ChangeEvent;
 import javax.swing.event.ChangeListener;
+
 import org.apache.jmeter.config.Argument;
 import org.apache.jmeter.config.Arguments;
 import org.apache.jmeter.config.gui.ArgumentsPanel;
 import org.apache.jmeter.functions.Function;
-import org.apache.jmeter.gui.util.ComponentUtil;
-import org.apache.jmeter.gui.util.JLabeledChoice;
-import org.apache.jmeter.gui.util.JLabeledTextField;
-import org.apache.jmeter.util.ClassFinder;
+import org.apache.jmeter.gui.action.ActionRouter;
 import org.apache.jmeter.util.JMeterUtils;
+import org.apache.jorphan.gui.ComponentUtil;
+import org.apache.jorphan.gui.JLabeledChoice;
+import org.apache.jorphan.gui.JLabeledTextField;
+import org.apache.jorphan.reflect.ClassFinder;
 
 /**
  * @author Administrator
@@ -56,6 +58,9 @@ public class FunctionHelper extends JDialog implements
 		this.getContentPane().setLayout(new BorderLayout(10,10));
 		JPanel comboPanel = new JPanel(new FlowLayout(FlowLayout.CENTER));
 		comboPanel.add(functionList);
+		JButton helpButton = new JButton(JMeterUtils.getResString("help"));
+		helpButton.addActionListener(new HelpListener());
+		comboPanel.add(helpButton);
 		this.getContentPane().add(comboPanel,BorderLayout.NORTH);
 		this.getContentPane().add(parameterPanel,BorderLayout.CENTER);
 		JPanel resultsPanel = new JPanel(new FlowLayout(FlowLayout.CENTER));
@@ -74,6 +79,7 @@ public class FunctionHelper extends JDialog implements
 	{
 		try {
 			List functionClasses = ClassFinder.findClassesThatExtend(
+					JMeterUtils.getSearchPaths(),
 					new Class[]{Function.class},true);
 			Iterator iter = functionClasses.iterator();
 			String[] functionNames = new String[functionClasses.size()];
@@ -148,5 +154,15 @@ public class FunctionHelper extends JDialog implements
 		cutPasteFunction.setText(functionCall.toString());
 	}
 	
+	private class HelpListener implements ActionListener
+	{
+		public void actionPerformed(ActionEvent e)
+		{
+			String[] source = new String[]{JMeterUtils.getJMeterHome()+"/docs/usermanual/component_index.html",functionList.getText()};
+			ActionEvent helpEvent = new ActionEvent(source,e.getID(),"help");
+			ActionRouter.getInstance().actionPerformed(helpEvent);
+		}
+	}
+	
 
 }
diff --git a/jakarta-jmeter/src/core/org/apache/jmeter/gui/AbstractJMeterGuiComponent.java b/jakarta-jmeter/src/core/org/apache/jmeter/gui/AbstractJMeterGuiComponent.java
index 2f18691..d0e4535 100644
--- a/jakarta-jmeter/src/core/org/apache/jmeter/gui/AbstractJMeterGuiComponent.java
+++ b/jakarta-jmeter/src/core/org/apache/jmeter/gui/AbstractJMeterGuiComponent.java
@@ -1,62 +1,183 @@
+/*
+ * ====================================================================
+ * The Apache Software License, Version 1.1
+ *
+ * Copyright (c) 2002 The Apache Software Foundation.  All rights
+ * reserved.
+ *
+ * Redistribution and use in source and binary forms, with or without
+ * modification, are permitted provided that the following conditions
+ * are met:
+ *
+ * 1. Redistributions of source code must retain the above copyright
+ * notice, this list of conditions and the following disclaimer.
+ *
+ * 2. Redistributions in binary form must reproduce the above copyright
+ * notice, this list of conditions and the following disclaimer in
+ * the documentation and/or other materials provided with the
+ * distribution.
+ *
+ * 3. The end-user documentation included with the redistribution,
+ * if any, must include the following acknowledgment:
+ * "This product includes software developed by the
+ * Apache Software Foundation (http://www.apache.org/)."
+ * Alternately, this acknowledgment may appear in the software itself,
+ * if and wherever such third-party acknowledgments normally appear.
+ *
+ * 4. The names "Apache" and "Apache Software Foundation" and
+ * "Apache JMeter" must not be used to endorse or promote products
+ * derived from this software without prior written permission. For
+ * written permission, please contact apache@apache.org.
+ *
+ * 5. Products derived from this software may not be called "Apache",
+ * "Apache JMeter", nor may "Apache" appear in their name, without
+ * prior written permission of the Apache Software Foundation.
+ *
+ * THIS SOFTWARE IS PROVIDED ``AS IS'' AND ANY EXPRESSED OR IMPLIED
+ * WARRANTIES, INCLUDING, BUT NOT LIMITED TO, THE IMPLIED WARRANTIES
+ * OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE ARE
+ * DISCLAIMED.  IN NO EVENT SHALL THE APACHE SOFTWARE FOUNDATION OR
+ * ITS CONTRIBUTORS BE LIABLE FOR ANY DIRECT, INDIRECT, INCIDENTAL,
+ * SPECIAL, EXEMPLARY, OR CONSEQUENTIAL DAMAGES (INCLUDING, BUT NOT
+ * LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES; LOSS OF
+ * USE, DATA, OR PROFITS; OR BUSINESS INTERRUPTION) HOWEVER CAUSED AND
+ * ON ANY THEORY OF LIABILITY, WHETHER IN CONTRACT, STRICT LIABILITY,
+ * OR TORT (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT
+ * OF THE USE OF THIS SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF
+ * SUCH DAMAGE.
+ * ====================================================================
+ *
+ * This software consists of voluntary contributions made by many
+ * individuals on behalf of the Apache Software Foundation.  For more
+ * information on the Apache Software Foundation, please see
+ * <http://www.apache.org/>.
+ */
 package org.apache.jmeter.gui;
-
 import java.util.Collection;
-
 import javax.swing.JPanel;
 import javax.swing.JPopupMenu;
 import org.apache.jmeter.testelement.TestElement;
-
+import org.apache.jmeter.gui.tree.JMeterTreeNode;
 /**
+ * This abstract class takes care of the most basic functions necessary to create a viable
+ * JMeter GUI component.  It extends JPanel and implements JMeterGUIComponent.  This
+ * abstract is, in turn, extended by several other abstract classes that create different
+ * classes of GUI components for JMeter (ie Visualizers, Timers, Samplers, Modifiers, Controllers, etc).
+ * 
  * @author mstover
  *
- * To change this generated comment edit the template variable "typecomment":
- * Window>Preferences>Java>Templates.
+ * @see JMeterGuiComponent
+ * @see org.apache.jmeter.config.gui.AbstractConfigGui
+ * @see org.apache.jmeter.config.gui.AbstractModifierGui
+ * @see org.apache.jmeter.config.gui.AbstractResponseBasedModifierGui
+ * @see org.apache.jmeter.assertions.gui.AbstractAssertionGui
+ * @see org.apache.jmeter.control.gui.AbstractControllerGui
+ * @see org.apache.jmeter.timers.gui.AbstractTimerGui
+ * @see org.apache.jmeter.visualizers.gui.AbstractVisualizer
+ * @see org.apache.jmeter.samplers.gui.AbstractSamplerGui
  */
 public abstract class AbstractJMeterGuiComponent
 	extends JPanel
-	implements JMeterGUIComponent {
-
-	public AbstractJMeterGuiComponent() {
+	implements JMeterGUIComponent
+{
+	private boolean enabled = true;
+	private JMeterTreeNode node;
+	
+	
+	/**
+	 * When constructing a new component, this takes care of basic tasks like
+	 * setting up the Name Panel and assigning the class's static label as
+	 * the name to start.	 * @see java.lang.Object#Object()	 */
+	public AbstractJMeterGuiComponent()
+	{
 		namePanel = new NamePanel();
 		setName(getStaticLabel());
 	}
-
+	
 	/**
 	 * @see JMeterGUIComponent#setName(String)
 	 */
-	public void setName(String name) {
+	public void setName(String name)
+	{
 		namePanel.setName(name);
 	}
-
+	
+	/**
+	 * @see java.awt.Component#isEnabled()
+	 */
+	public boolean isEnabled()
+	{
+		return enabled;
+	}
+	
+	/**
+	 * @see java.awt.Component#setEnabled(boolean)
+	 */
+	public void setEnabled(boolean e)
+	{
+		enabled = e;
+	}
+	
 	/**
 	 * @see JMeterGUIComponent#getName()
 	 */
-	public String getName() {
+	public String getName()
+	{
 		return getNamePanel().getName();
 	}
-
-	protected NamePanel getNamePanel() {
+	
+	/**
+	 * Provides the Name Panel for extending classes.  Extending classes are free to
+	 * place it as desired within the component, or not at all.
+	 * 	 * @return NamePanel	 */
+	protected NamePanel getNamePanel()
+	{
 		return namePanel;
 	}
-
+	
 	protected NamePanel namePanel;
 	
-	/****************************************
-	 * !ToDo (Method description)
-	 *
-	 *@param element  !ToDo (Parameter description)
-	 ***************************************/
+
+	/**
+	 * This method should be overriden, but the extending class should also still call it, as
+	 * it does the work necessary to configure the name of the component from the
+	 * given Test Element.  Otherwise, the component can do this itself.
+	 * 
+	 * @see org.apache.jmeter.gui.JMeterGUIComponent#configure(org.apache.jmeter.testelement.TestElement)
+	 */
 	public void configure(TestElement element)
 	{
-		setName((String)element.getProperty(TestElement.NAME));
+		setName((String) element.getProperty(TestElement.NAME));
 	}
-
-	  protected void configureTestElement(TestElement mc)
+	
+	/**
+	 * This provides a convenience for extenders when they implement the createTestElement()
+	 * method.  This method will set the name, gui class, and test class for the created
+	 * Test Element.  It should be called by every extending class when creating Test
+	 * Elements, as that will best assure consistent behavior.
+	 * @param The Test Element being created.
+	 */
+	protected void configureTestElement(TestElement mc)
 	{
 		mc.setProperty(TestElement.NAME, getName());
 		mc.setProperty(TestElement.GUI_CLASS, this.getClass().getName());
 		mc.setProperty(TestElement.TEST_CLASS, mc.getClass().getName());
 	}
-
-
-}
\ No newline at end of file
+	
+	/**
+	 * @see org.apache.jmeter.gui.JMeterGUIComponent#setNode(org.apache.jmeter.gui.tree.JMeterTreeNode)
+	 */
+	public void setNode(JMeterTreeNode node)
+	{
+		this.node = node;
+		getNamePanel().setNode(node);
+	}
+	/**
+	 * Method getNode.
+	 * @return JMeterTreeNode
+	 */
+	protected JMeterTreeNode getNode()
+	{
+		return node;
+	}
+}
diff --git a/jakarta-jmeter/src/core/org/apache/jmeter/gui/CVS/Entries b/jakarta-jmeter/src/core/org/apache/jmeter/gui/CVS/Entries
index 922aff3..b7e718c 100644
--- a/jakarta-jmeter/src/core/org/apache/jmeter/gui/CVS/Entries
+++ b/jakarta-jmeter/src/core/org/apache/jmeter/gui/CVS/Entries
@@ -1,14 +1,14 @@
-/AbstractJMeterGuiComponent.java/1.1/Sun Aug 11 19:24:43 2002//Tv1_7_3
-/GuiFactory.java/1.1/Sun Aug 11 19:24:43 2002//Tv1_7_3
-/GuiPackage.java/1.1/Sun Aug 11 19:24:43 2002//Tv1_7_3
-/GuiReady.java/1.1/Sun Aug 11 19:24:43 2002//Tv1_7_3
-/JMeterComponentModel.java/1.1/Sun Aug 11 19:24:43 2002//Tv1_7_3
-/JMeterFileFilter.java/1.1/Sun Aug 11 19:24:43 2002//Tv1_7_3
-/JMeterGUIComponent.java/1.1/Sun Aug 11 19:24:43 2002//Tv1_7_3
-/JMeterJListModel.java/1.1/Sun Aug 11 19:24:43 2002//Tv1_7_3
-/ListDialog.java/1.1/Sun Aug 11 19:24:43 2002//Tv1_7_3
-/MainFrame.java/1.1/Sun Aug 11 19:24:43 2002//Tv1_7_3
-/NamePanel.java/1.1/Sun Aug 11 19:24:43 2002//Tv1_7_3
+/AbstractJMeterGuiComponent.java/1.4/Mon Jan  6 23:30:10 2003//Tv1_8_1
+/GUIFactory.java/1.1/Tue Dec 31 18:05:54 2002//Tv1_8_1
+/GuiPackage.java/1.6/Mon Jan  6 23:30:10 2003//Tv1_8_1
+/GuiReady.java/1.1/Sun Aug 11 19:24:43 2002//Tv1_8_1
+/JMeterComponentModel.java/1.2/Mon Jan  6 23:30:10 2003//Tv1_8_1
+/JMeterFileFilter.java/1.1/Sun Aug 11 19:24:43 2002//Tv1_8_1
+/JMeterGUIComponent.java/1.4/Mon Jan  6 23:30:10 2003//Tv1_8_1
+/JMeterJListModel.java/1.1/Sun Aug 11 19:24:43 2002//Tv1_8_1
+/ListDialog.java/1.2/Fri Aug 30 14:43:19 2002//Tv1_8_1
+/MainFrame.java/1.8/Fri Jan 31 18:25:09 2003//Tv1_8_1
+/NamePanel.java/1.2/Tue Dec 31 18:05:54 2002//Tv1_8_1
 D/action////
 D/tree////
 D/util////
diff --git a/jakarta-jmeter/src/core/org/apache/jmeter/gui/CVS/Tag b/jakarta-jmeter/src/core/org/apache/jmeter/gui/CVS/Tag
index 5f312fe..e2fda28 100644
--- a/jakarta-jmeter/src/core/org/apache/jmeter/gui/CVS/Tag
+++ b/jakarta-jmeter/src/core/org/apache/jmeter/gui/CVS/Tag
@@ -1 +1 @@
-Nv1_7_3
+Nv1_8_1
diff --git a/jakarta-jmeter/src/core/org/apache/jmeter/gui/GuiFactory.java b/jakarta-jmeter/src/core/org/apache/jmeter/gui/GuiFactory.java
index 4abc378..83ceec0 100644
--- a/jakarta-jmeter/src/core/org/apache/jmeter/gui/GuiFactory.java
+++ b/jakarta-jmeter/src/core/org/apache/jmeter/gui/GuiFactory.java
@@ -2,7 +2,7 @@
  * ====================================================================
  * The Apache Software License, Version 1.1
  *
- * Copyright (c) 2001 The Apache Software Foundation.  All rights
+ * Copyright (c) 2002 The Apache Software Foundation.  All rights
  * reserved.
  *
  * Redistribution and use in source and binary forms, with or without
@@ -52,29 +52,68 @@
  * information on the Apache Software Foundation, please see
  * <http://www.apache.org/>.
  */
+
 package org.apache.jmeter.gui;
+
 import java.util.*;
-import javax.swing.ImageIcon;
-import javax.swing.JComponent;
-import org.apache.jmeter.control.Controller;
-import org.apache.jmeter.testelement.TestPlan;
-import org.apache.jmeter.testelement.WorkBench;
-import org.apache.jmeter.util.JMeterUtils;
-
-/****************************************
- * Title: JMeter Description: Copyright: Copyright (c) 2000 Company: Apache
- *
- *@author    Michael Stover
- *@created   $Date: 2002/08/11 19:24:43 $
- *@version   1.0
- ***************************************/
 
-public class GuiFactory
-{
+import javax.swing.*;
+
+
+/**
+ * @author Oliver Rossmueller
+ */
+public class GUIFactory {
+
+    private static final Map guiMap = new HashMap();
+    private static final Map iconMap = new HashMap();
+
+
+    public static ImageIcon getIcon(Class elementClass)
+    {
+        String key = elementClass.getName();
+        ImageIcon icon = (ImageIcon)iconMap.get(key);
+
+        if (icon != null)
+	{
+            return icon;
+        }
+        if (elementClass.getSuperclass() != null)
+	{
+            return getIcon(elementClass.getSuperclass());
+        }
+        return null;
+    }
+
+
+    public static JComponent getGUI(Class elementClass)
+    {
+        String key = elementClass.getName();
+        JComponent gui = (JComponent)guiMap.get(key);
+
+        if (gui != null)
+	{
+            return gui;
+        }
+        if (elementClass.getSuperclass() != null)
+	{
+            return getGUI(elementClass.getSuperclass());
+        }
+        return null;
+    }
+
 
-	private static Map guiComponents = new HashMap();
-	private static Map icons = new HashMap();
+    public static void registerIcon(String key, ImageIcon icon)
+    {
+        iconMap.put(key, icon);
+    }
 
-	private GuiFactory() { }
 
+    public static void registerGUI(String key, Class guiClass)
+            throws InstantiationException, IllegalAccessException
+    {
+        JMeterGUIComponent gui = (JMeterGUIComponent)guiClass.newInstance();
+        JComponent component = (JComponent)gui;
+        guiMap.put(key, gui);
+    }
 }
diff --git a/jakarta-jmeter/src/core/org/apache/jmeter/gui/GuiPackage.java b/jakarta-jmeter/src/core/org/apache/jmeter/gui/GuiPackage.java
index 4170c88..d7a1434 100644
--- a/jakarta-jmeter/src/core/org/apache/jmeter/gui/GuiPackage.java
+++ b/jakarta-jmeter/src/core/org/apache/jmeter/gui/GuiPackage.java
@@ -54,17 +54,20 @@
  */
  package org.apache.jmeter.gui;
 
-import java.util.HashSet;
-import java.util.Set;
-
 import org.apache.jmeter.exceptions.IllegalUserActionException;
+import org.apache.jmeter.functions.ValueReplacer;
 import org.apache.jmeter.gui.tree.JMeterTreeListener;
 import org.apache.jmeter.gui.tree.JMeterTreeModel;
-import org.apache.jmeter.samplers.Remoteable;
-import org.apache.jmeter.testelement.TestListener;
-import org.apache.jmeter.util.ListedHashTree;
+import org.apache.jmeter.testelement.TestPlan;
+import org.apache.jorphan.collections.HashTree;
 
 /**
+ * GuiPackage is a static class that provides convenient access to information about the 
+ * current state of JMeter's GUI.  Any GUI class can grab a handle to GuiPackage by 
+ * calling the static method 'getInstance()' and then use it to query the GUI about
+ * it's state.  When actions, for instance, need to affect the GUI, they
+ * typically use GuiPackage to get access to different parts of the GUI.
+ * 
  * Title:        JMeter
  * Description:
  * Copyright:    Copyright (c) 2000
@@ -79,6 +82,8 @@ public class GuiPackage
 	private static GuiPackage guiPack;
 	private boolean dirty = false;
 
+	/**
+	 * GuiPackage is a Singleton class.	 * @see java.lang.Object#Object()	 */
 	private GuiPackage()
 	{
 	}
@@ -87,6 +92,9 @@ public class GuiPackage
 	private org.apache.jmeter.gui.MainFrame mainFrame;
 	private org.apache.jmeter.gui.tree.JMeterTreeListener treeListener;
 
+	/**
+	 * When GuiPackage is requested for the first time, it should be given handles to
+	 * JMeter's Tree Listener and TreeModel.  	 * @param listener The TreeListener for JMeter's test tree.	 * @param treeModel The model for JMeter's test tree.	 * @return GuiPackage	 */
 	public static GuiPackage getInstance(JMeterTreeListener listener,
 							JMeterTreeModel treeModel)
 	{
@@ -99,22 +107,29 @@ public class GuiPackage
 		return guiPack;
 	}
 
+	/**
+	 * The dirty property is a flag that indicates whether there are parts of JMeter's test tree
+	 * that the user has not saved since last modification.  Various (@link Command actions) set
+	 * this property when components are modified/created/saved.	 * @param d	 */
 	public void setDirty(boolean d)
 	{
 		dirty = d;
 	}
 
+	/**
+	 * Retrieves the state of the 'dirty' property, a flag that indicates if there are test
+	 * tree components that have been modified since they were last saved.	 * @return boolean	 */
 	public boolean isDirty()
 	{
 		return dirty;
 	}
 
-	public void addSubTree(ListedHashTree subTree) throws IllegalUserActionException
+	public boolean addSubTree(HashTree subTree) throws IllegalUserActionException
 	{
-		treeModel.addSubTree(subTree,treeListener.getCurrentNode());
+		return treeModel.addSubTree(subTree,treeListener.getCurrentNode());
 	}
 
-	public ListedHashTree getCurrentSubTree()
+	public HashTree getCurrentSubTree()
 	{
 		return treeModel.getCurrentSubTree(treeListener.getCurrentNode());
 	}
@@ -128,6 +143,15 @@ public class GuiPackage
 	{
 		return treeModel;
 	}
+	
+	public ValueReplacer getReplacer()
+	{
+		ValueReplacer replacer = new ValueReplacer(
+				((TestPlan)((JMeterGUIComponent)
+				getTreeModel().getTestPlan().getArray()
+				[0]).createTestElement()).getUserDefinedVariables());
+		return replacer;
+	}
 
 	public void setTreeModel(JMeterTreeModel newTreeModel)
 	{
diff --git a/jakarta-jmeter/src/core/org/apache/jmeter/gui/JMeterComponentModel.java b/jakarta-jmeter/src/core/org/apache/jmeter/gui/JMeterComponentModel.java
index 30a6514..614c630 100644
--- a/jakarta-jmeter/src/core/org/apache/jmeter/gui/JMeterComponentModel.java
+++ b/jakarta-jmeter/src/core/org/apache/jmeter/gui/JMeterComponentModel.java
@@ -57,12 +57,10 @@
 import java.util.*;
 
 /**
- * Title:        JMeter
- * Description:
- * Copyright:    Copyright (c) 2000
- * Company:      Apache
+ * This class is obsolete.
  * @author Michael Stover
  * @version 1.0
+ * 
  */
 
 public interface JMeterComponentModel
diff --git a/jakarta-jmeter/src/core/org/apache/jmeter/gui/JMeterGUIComponent.java b/jakarta-jmeter/src/core/org/apache/jmeter/gui/JMeterGUIComponent.java
index c4f5206..25d0e7b 100644
--- a/jakarta-jmeter/src/core/org/apache/jmeter/gui/JMeterGUIComponent.java
+++ b/jakarta-jmeter/src/core/org/apache/jmeter/gui/JMeterGUIComponent.java
@@ -1,65 +1,155 @@
-package org.apache.jmeter.gui;
-import java.util.Collection;
-import javax.swing.JPopupMenu;
-import org.apache.jmeter.testelement.TestElement;
-/****************************************
- * <p>
+/*
+ * ====================================================================
+ * The Apache Software License, Version 1.1
+ *
+ * Copyright (c) 2002 The Apache Software Foundation.  All rights
+ * reserved.
  *
- * Title: Jakarta JMeter</p> <p>
+ * Redistribution and use in source and binary forms, with or without
+ * modification, are permitted provided that the following conditions
+ * are met:
  *
- * Description: Load testing software</p> <p>
+ * 1. Redistributions of source code must retain the above copyright
+ * notice, this list of conditions and the following disclaimer.
  *
- * Copyright: Copyright (c) 2002</p> <p>
+ * 2. Redistributions in binary form must reproduce the above copyright
+ * notice, this list of conditions and the following disclaimer in
+ * the documentation and/or other materials provided with the
+ * distribution.
  *
- * Company: Apache Foundation</p>
+ * 3. The end-user documentation included with the redistribution,
+ * if any, must include the following acknowledgment:
+ * "This product includes software developed by the
+ * Apache Software Foundation (http://www.apache.org/)."
+ * Alternately, this acknowledgment may appear in the software itself,
+ * if and wherever such third-party acknowledgments normally appear.
  *
+ * 4. The names "Apache" and "Apache Software Foundation" and
+ * "Apache JMeter" must not be used to endorse or promote products
+ * derived from this software without prior written permission. For
+ * written permission, please contact apache@apache.org.
+ *
+ * 5. Products derived from this software may not be called "Apache",
+ * "Apache JMeter", nor may "Apache" appear in their name, without
+ * prior written permission of the Apache Software Foundation.
+ *
+ * THIS SOFTWARE IS PROVIDED ``AS IS'' AND ANY EXPRESSED OR IMPLIED
+ * WARRANTIES, INCLUDING, BUT NOT LIMITED TO, THE IMPLIED WARRANTIES
+ * OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE ARE
+ * DISCLAIMED.  IN NO EVENT SHALL THE APACHE SOFTWARE FOUNDATION OR
+ * ITS CONTRIBUTORS BE LIABLE FOR ANY DIRECT, INDIRECT, INCIDENTAL,
+ * SPECIAL, EXEMPLARY, OR CONSEQUENTIAL DAMAGES (INCLUDING, BUT NOT
+ * LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES; LOSS OF
+ * USE, DATA, OR PROFITS; OR BUSINESS INTERRUPTION) HOWEVER CAUSED AND
+ * ON ANY THEORY OF LIABILITY, WHETHER IN CONTRACT, STRICT LIABILITY,
+ * OR TORT (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT
+ * OF THE USE OF THIS SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF
+ * SUCH DAMAGE.
+ * ====================================================================
+ *
+ * This software consists of voluntary contributions made by many
+ * individuals on behalf of the Apache Software Foundation.  For more
+ * information on the Apache Software Foundation, please see
+ * <http://www.apache.org/>.
+ */
+
+package org.apache.jmeter.gui;
+import java.util.Collection;
+import javax.swing.JPopupMenu;
+import org.apache.jmeter.testelement.TestElement;
+import org.apache.jmeter.gui.tree.JMeterTreeNode;
+/****************************************
+ * Implementing this interface indicates that the class is
+ * a JMeter GUI Component.  A JMeter GUI Component is essentially 
+ * the GUI display code associated with a JMeter Test Element.  The writer of
+ * the component must take care to make the component be consistent with the
+ * rest of JMeter's GUI look and feel and behavior.  Use of the provided abstract
+ * classes is highly recommended to make this task easier.
+ * 
  *@author    Michael Stover
- *@created   $Date: 2002/08/11 19:24:43 $
+ *@created   $Date: 2003/01/06 23:30:10 $
  *@version   1.0
+ * 
+ * 
+ * 
+ * @see AbstractJMeterGuiComponent
+ * @see org.apache.jmeter.config.gui.AbstractConfigGui
+ * @see org.apache.jmeter.config.gui.AbstractModifierGui
+ * @see org.apache.jmeter.config.gui.AbstractResponseBasedModifierGui
+ * @see org.apache.jmeter.assertions.gui.AbstractAssertionGui
+ * @see org.apache.jmeter.control.gui.AbstractControllerGui
+ * @see org.apache.jmeter.timers.gui.AbstractTimerGui
+ * @see org.apache.jmeter.visualizers.gui.AbstractVisualizer
+ * @see org.apache.jmeter.samplers.gui.AbstractSamplerGui
  ***************************************/
 
 public interface JMeterGUIComponent
 {
 
 	/****************************************
-	 * !ToDo (Method description)
+	 * Sets the name of the JMeter GUI Component.  The name
+	 * of the component is used in the Test Tree as the name of the
+	 * tree node.
 	 *
-	 *@param name  !ToDo (Parameter description)
+	 *@param name  )
 	 ***************************************/
 	public void setName(String name);
 
 	/****************************************
-	 * !ToDoo (Method description)
+	 * Gets the name of the JMeter GUI component.  The name
+	 * of the component is used in the Test Tree as the name of the tree node.
 	 *
-	 *@return   !ToDo (Return description)
+	 *@return   The name of the component)
 	 ***************************************/
 	public String getName();
 
 	/****************************************
-	 * !ToDoo (Method description)
+	 * Get the component's label.  This label is used in drop down
+	 * lists that give the user the option of choosing one type of
+	 * component in a list of many.  It should therefore be a descriptive
+	 * name for the end user to see.
 	 *
-	 *@return   !ToDo (Return description)
+	 *@return   GUI label for the component.
 	 ***************************************/
 	public String getStaticLabel();
 
 	/****************************************
-	 * !ToDo (Method description)
+	 * When a test is started, GUI components are converted into
+	 * test elements.  This is the method called on each component
+	 * to get the test element equivalent.  
 	 *
-	 *@return   !ToDo (Return description)
+	 *@return  The Test Element object that the GUI component 
+	 * represents.
 	 ***************************************/
 	public TestElement createTestElement();
 
+	/**
+	 * Test GUI elements can be  disabled, in which case
+	 * they do not become part of the test when run.
+	 */
+	public boolean isEnabled();
+
+	/**
+	 * Set whether this component is enabled.	 * @param enabled true for enabled, false for disabled.	 */
+	public void setEnabled(boolean enabled);
+
 	/****************************************
-	 * !ToDo (Method description)
+	 * When a user right-clicks on the component in the test tree, or
+	 * selects the edit menu when the component is selected, the 
+	 * component will be asked to return a JPopupMenu that provides
+	 * all the options available to the user from this component.
 	 *
-	 *@return   !ToDo (Return description)
+	 *@return   A JPopupMenu appropriate for the component.
 	 ***************************************/
 	public JPopupMenu createPopupMenu();
 
 	/****************************************
-	 * !ToDo (Method description)
+	 * A newly created component can be initialized with the contents of
+	 * a Test Element object by calling this method.  The component is
+	 * responsible for querying the Test Element object for the
+	 * relevant information to display in its GUI.
 	 *
-	 *@param element  !ToDo (Parameter description)
+	 *@param element 
 	 ***************************************/
 	public void configure(TestElement element);
 
@@ -71,4 +161,8 @@ public interface JMeterGUIComponent
 	 *@return   !ToDo (Return description)
 	 ***************************************/
 	public Collection getMenuCategories();
+
+	/**
+	 * 	 *@param node	 */
+    public void setNode(JMeterTreeNode node);
 }
diff --git a/jakarta-jmeter/src/core/org/apache/jmeter/gui/ListDialog.java b/jakarta-jmeter/src/core/org/apache/jmeter/gui/ListDialog.java
index 4ac3412..9850044 100644
--- a/jakarta-jmeter/src/core/org/apache/jmeter/gui/ListDialog.java
+++ b/jakarta-jmeter/src/core/org/apache/jmeter/gui/ListDialog.java
@@ -66,7 +66,7 @@ import org.apache.jmeter.util.JMeterUtils;
  *  value may be a list of values.
  *
  *@author     $Author: mstover1 $
- *@created    $Date: 2002/08/11 19:24:43 $
+ *@created    $Date: 2002/08/30 14:43:19 $
  *@version    $Version: 1.0 10/14/1998$
  ************************/
 
@@ -85,6 +85,9 @@ public class ListDialog extends JPanel implements ActionListener, KeyListener
 
 	Vector listData;
 
+	public ListDialog()
+	{
+	}
 
 	/*************************
 	 *  Constructor takes a label for instructions to the user, and a list of items
diff --git a/jakarta-jmeter/src/core/org/apache/jmeter/gui/MainFrame.java b/jakarta-jmeter/src/core/org/apache/jmeter/gui/MainFrame.java
index e897946..b6aefe3 100644
--- a/jakarta-jmeter/src/core/org/apache/jmeter/gui/MainFrame.java
+++ b/jakarta-jmeter/src/core/org/apache/jmeter/gui/MainFrame.java
@@ -2,7 +2,7 @@
  * ====================================================================
  * The Apache Software License, Version 1.1
  *
- * Copyright (c) 2001 The Apache Software Foundation.  All rights
+ * Copyright (c) 2002 The Apache Software Foundation.  All rights
  * reserved.
  *
  * Redistribution and use in source and binary forms, with or without
@@ -53,30 +53,65 @@
  * <http://www.apache.org/>.
  */
 package org.apache.jmeter.gui;
-import java.awt.*;
-import java.awt.event.*;
-import java.util.*;
-import javax.swing.*;
-import javax.swing.tree.*;
+import java.awt.Component;
+import java.awt.Dimension;
+import java.awt.Font;
+import java.awt.GridBagConstraints;
+import java.awt.GridBagLayout;
+import java.awt.GridLayout;
+import java.awt.Insets;
+import java.awt.Rectangle;
+import java.awt.event.ActionEvent;
+import java.awt.event.ActionListener;
+import java.awt.event.WindowAdapter;
+import java.awt.event.WindowEvent;
+import java.util.HashSet;
+import java.util.Set;
+
+import javax.swing.BorderFactory;
+import javax.swing.Box;
+import javax.swing.BoxLayout;
+import javax.swing.ImageIcon;
+import javax.swing.JButton;
+import javax.swing.JComponent;
+import javax.swing.JDialog;
+import javax.swing.JFrame;
+import javax.swing.JLabel;
+import javax.swing.JMenu;
+import javax.swing.JPanel;
+import javax.swing.JPopupMenu;
+import javax.swing.JScrollPane;
+import javax.swing.JSplitPane;
+import javax.swing.JTree;
+import javax.swing.MenuElement;
+import javax.swing.SwingUtilities;
+import javax.swing.tree.DefaultTreeCellRenderer;
+import javax.swing.tree.TreeCellRenderer;
+import javax.swing.tree.TreeModel;
+
 import org.apache.jmeter.gui.action.ActionRouter;
-import org.apache.jmeter.gui.tree.*;
+import org.apache.jmeter.gui.action.GlobalMouseListener;
+import org.apache.jmeter.gui.tree.JMeterCellRenderer;
+import org.apache.jmeter.gui.tree.JMeterTreeListener;
 import org.apache.jmeter.gui.util.JMeterMenuBar;
-import org.apache.jmeter.util.JMeterUtils;
-import org.apache.jmeter.gui.action.Start;
-import org.apache.jmeter.gui.action.CheckDirty;
-import org.apache.jmeter.testelement.TestListener;
 import org.apache.jmeter.samplers.Remoteable;
-import org.apache.jmeter.gui.util.ComponentUtil;
+import org.apache.jmeter.testelement.TestListener;
+import org.apache.jmeter.util.JMeterUtils;
+import org.apache.jorphan.gui.ComponentUtil;
+import org.apache.log.Hierarchy;
+import org.apache.log.Logger;
 /****************************************
  * Title: JMeter Description: Copyright: Copyright (c) 2000 Company: Apache
  *
  *@author    Michael Stover
- *@created   $Date: 2002/08/11 19:24:43 $
+ *@created   $Date: 2003/01/31 18:25:09 $
  *@version   1.0
  ***************************************/
 
 public class MainFrame extends JFrame implements TestListener,Remoteable
 {
+	transient private static Logger log =
+			Hierarchy.getDefaultHierarchy().getLoggerFor("jmeter.gui");
 	JPanel all, mainPanel;
 	Box toolPanel;
 	JScrollPane treePanel;
@@ -112,9 +147,14 @@ public class MainFrame extends JFrame implements TestListener,Remoteable
 		this.treeModel = treeModel;
 		GuiPackage.getInstance().setMainFrame(this);
 		init();
-		this.setDefaultCloseOperation(this.DO_NOTHING_ON_CLOSE);
+		this.setDefaultCloseOperation(DO_NOTHING_ON_CLOSE);
+	}
+
+	public MainFrame()
+	{
 	}
 
+
 	/****************************************
 	 * !ToDo (Method description)
 	 *
@@ -124,17 +164,26 @@ public class MainFrame extends JFrame implements TestListener,Remoteable
 	{
 		menuBar.setFileSaveEnabled(enabled);
 	}
-	
-	public void showStoppingMessage()
+
+	public void showStoppingMessage(String host)
 	{
 		stoppingMessage = new JDialog(this,
 				JMeterUtils.getResString("stopping_test_title"),true);
-		JLabel stopLabel = new JLabel(JMeterUtils.getResString("stopping_test"));
+		JLabel stopLabel = new JLabel(JMeterUtils.getResString("stopping_test")+": "+host);
 		stopLabel.setBorder(BorderFactory.createEmptyBorder(20,20,20,20));
 		stoppingMessage.getContentPane().add(stopLabel);
 		stoppingMessage.pack();
 		ComponentUtil.centerComponentInComponent(this,stoppingMessage);
-		stoppingMessage.show();
+		SwingUtilities.invokeLater(new Runnable()
+			{
+				public void run()
+				{
+					if(stoppingMessage != null)
+					{
+						stoppingMessage.show();
+					}
+				}
+			});
 	}
 
 	/****************************************
@@ -256,6 +305,7 @@ public class MainFrame extends JFrame implements TestListener,Remoteable
 
 	public void testStarted(String host)
 	{
+		hosts.add(host);
 		runningIndicator.setIcon(runningIcon);
 		menuBar.setRunning(true,host);
 	}
@@ -268,13 +318,13 @@ public class MainFrame extends JFrame implements TestListener,Remoteable
 
 	public void testEnded()
 	{
+		testEnded("local");
+		menuBar.setEnabled(false);
 		if(stoppingMessage != null)
 		{
 			stoppingMessage.dispose();
 			stoppingMessage = null;
 		}
-		testEnded("local");
-		menuBar.setEnabled(false);
 	}
 
 	public void testEnded(String host)
@@ -285,6 +335,11 @@ public class MainFrame extends JFrame implements TestListener,Remoteable
 			runningIndicator.setIcon(stoppedIcon);
 		}
 		menuBar.setRunning(false,host);
+		if(stoppingMessage != null)
+		{
+			stoppingMessage.dispose();
+			stoppingMessage = null;
+		}
 	}
 
 	private void init()
@@ -296,6 +351,7 @@ public class MainFrame extends JFrame implements TestListener,Remoteable
 		addThemAll();
 		addWindowListener(new WindowHappenings());
 		tree.setSelectionRow(1);
+		this.addMouseListener(new GlobalMouseListener());
 	}
 
 	private TreeCellRenderer getCellRenderer()
@@ -373,6 +429,8 @@ public class MainFrame extends JFrame implements TestListener,Remoteable
 	{
 		tree = new JTree(this.treeModel);
 		tree.setCellRenderer(getCellRenderer());
+		tree.setRootVisible(false);
+		tree.setShowsRootHandles(true);
 		treeListener.setJTree(tree);
 		tree.addTreeSelectionListener(treeListener);
 		tree.addMouseListener(treeListener);
@@ -385,8 +443,8 @@ public class MainFrame extends JFrame implements TestListener,Remoteable
 	 * !ToDo (Class description)
 	 *
 	 *@author    $Author: mstover1 $
-	 *@created   $Date: 2002/08/11 19:24:43 $
-	 *@version   $Revision: 1.1 $
+	 *@created   $Date: 2003/01/31 18:25:09 $
+	 *@version   $Revision: 1.8 $
 	 ***************************************/
 	private class WindowHappenings extends WindowAdapter
 	{
@@ -401,4 +459,5 @@ public class MainFrame extends JFrame implements TestListener,Remoteable
 					this, event.getID(), "exit"));
 		}
 	}
+	
 }
diff --git a/jakarta-jmeter/src/core/org/apache/jmeter/gui/NamePanel.java b/jakarta-jmeter/src/core/org/apache/jmeter/gui/NamePanel.java
index 036e826..0c572d9 100644
--- a/jakarta-jmeter/src/core/org/apache/jmeter/gui/NamePanel.java
+++ b/jakarta-jmeter/src/core/org/apache/jmeter/gui/NamePanel.java
@@ -2,7 +2,7 @@
  * ====================================================================
  * The Apache Software License, Version 1.1
  *
- * Copyright (c) 2001 The Apache Software Foundation.  All rights
+ * Copyright (c) 2002 The Apache Software Foundation.  All rights
  * reserved.
  *
  * Redistribution and use in source and binary forms, with or without
@@ -60,24 +60,30 @@ import javax.swing.JLabel;
 import javax.swing.JPanel;
 import javax.swing.JPopupMenu;
 import javax.swing.JTextField;
+import javax.swing.event.DocumentListener;
+import javax.swing.event.DocumentEvent;
+
 import org.apache.jmeter.testelement.TestElement;
 import org.apache.jmeter.testelement.WorkBench;
 import org.apache.jmeter.util.JMeterUtils;
+import org.apache.jmeter.util.LocaleChangeEvent;
+import org.apache.jmeter.gui.tree.JMeterTreeNode;
 /****************************************
  * Title: JMeter Description: Copyright: Copyright (c) 2000 Company: Apache
  *
  *@author    Michael Stover
- *@created   $Date: 2002/08/11 19:24:43 $
+ *@created   $Date: 2002/12/31 18:05:54 $
  *@version   1.0
  ***************************************/
 
 public class NamePanel extends JPanel implements JMeterGUIComponent
 {
-	private JTextField nameField = new JTextField(30);
-
+    private JTextField nameField = new JTextField(30);
+    private JLabel nameLabel;
+    private JMeterTreeNode node;
 
 
-	/****************************************
+        /****************************************
 	 * !ToDo (Constructor description)
 	 ***************************************/
 	public NamePanel()
@@ -161,11 +167,52 @@ public class NamePanel extends JPanel implements JMeterGUIComponent
 		return nameField.getText();
 	}
 
-	private void init()
-	{
-		this.setLayout(new FlowLayout(FlowLayout.LEFT));
-		this.add(new JLabel(JMeterUtils.getResString("name")));
-		this.add(nameField);
-	}
+    private void init() {
+        this.setLayout(new FlowLayout(FlowLayout.LEFT));
+        nameLabel = new JLabel(JMeterUtils.getResString("name"));
+        nameLabel.setName("name");
+
+        this.add(nameLabel);
+        this.add(nameField);
+        nameLabel.setLabelFor(nameField);
+        nameField.setName("name");
+        nameField.getDocument().addDocumentListener(new DocumentListener() {
+            public void insertUpdate(DocumentEvent e) {
+                updateName(nameField.getText());
+            }
+
+
+            public void removeUpdate(DocumentEvent e) {
+                updateName(nameField.getText());
+            }
+
+
+            public void changedUpdate(DocumentEvent e) {
+                // not for text fields
+            }
+        });
+    }
+
+
+    private void updateName(String newValue) {
+        if (getNode() != null) {
+            getNode().nameChanged();
+        }
+    }
+
+
+    public void localeChanged(LocaleChangeEvent event) {
+        nameLabel.setText(JMeterUtils.getResString(nameLabel.getName()));
+    }
+
+    public void setNode(JMeterTreeNode node)
+    {
+        this.node = node;
+    }
+
 
+    protected JMeterTreeNode getNode()
+    {
+        return node;
+    }
 }
diff --git a/jakarta-jmeter/src/core/org/apache/jmeter/gui/action/AbstractAction.java b/jakarta-jmeter/src/core/org/apache/jmeter/gui/action/AbstractAction.java
index ae57faf..25130e7 100644
--- a/jakarta-jmeter/src/core/org/apache/jmeter/gui/action/AbstractAction.java
+++ b/jakarta-jmeter/src/core/org/apache/jmeter/gui/action/AbstractAction.java
@@ -5,11 +5,9 @@ import java.util.Iterator;
 import java.util.LinkedList;
 import java.util.Set;
 
-import org.apache.jmeter.engine.StandardJMeterEngine;
-import org.apache.jmeter.gui.GuiPackage;
 import org.apache.jmeter.gui.JMeterGUIComponent;
 import org.apache.jmeter.testelement.TestElement;
-import org.apache.jmeter.util.ListedHashTree;
+import org.apache.jorphan.collections.HashTree;
 
 /**
  * @author mstover
@@ -30,15 +28,22 @@ public abstract class AbstractAction implements Command {
 	 */
 	abstract public Set getActionNames();
 
-	protected void convertSubTree(ListedHashTree tree)
+	protected void convertSubTree(HashTree tree)
 	{
 		Iterator iter = new LinkedList(tree.list()).iterator();
 		while (iter.hasNext())
 		{
 			JMeterGUIComponent item = (JMeterGUIComponent)iter.next();
-			convertSubTree(tree.get(item));
-			TestElement testElement = item.createTestElement();
-			tree.replace(item,testElement);
+			if(item.isEnabled())
+			{
+				convertSubTree(tree.getTree(item));
+				TestElement testElement = item.createTestElement();
+				tree.replace(item,testElement);
+			}
+			else
+			{
+				tree.remove(item);
+			}
 			
 		}
 	}
diff --git a/jakarta-jmeter/src/core/org/apache/jmeter/gui/action/ActionRouter.java b/jakarta-jmeter/src/core/org/apache/jmeter/gui/action/ActionRouter.java
index 4759361..b0ab54d 100644
--- a/jakarta-jmeter/src/core/org/apache/jmeter/gui/action/ActionRouter.java
+++ b/jakarta-jmeter/src/core/org/apache/jmeter/gui/action/ActionRouter.java
@@ -54,14 +54,20 @@
  */
  package org.apache.jmeter.gui.action;
 
-import java.awt.event.ActionListener;
 import java.awt.event.ActionEvent;
-import java.util.*;
+import java.awt.event.ActionListener;
 import java.lang.reflect.Modifier;
+import java.util.HashMap;
+import java.util.HashSet;
+import java.util.Iterator;
+import java.util.List;
+import java.util.Map;
+import java.util.Set;
 
-import org.apache.jmeter.gui.*;
-import org.apache.jmeter.util.ClassFinder;
 import org.apache.jmeter.util.JMeterUtils;
+import org.apache.log.Hierarchy;
+import org.apache.log.Logger;
+import org.apache.jorphan.reflect.ClassFinder;
 
 /**
  *  Title: JMeter Description: Copyright: Copyright (c) 2000 Company: Apache
@@ -76,6 +82,8 @@ public class ActionRouter implements ActionListener
 	private Map commands = new HashMap();
 	private static ActionRouter router;
 	private static AddToTree add = new AddToTree();
+	transient private static Logger log = Hierarchy.getDefaultHierarchy().getLoggerFor(
+			"jmeter.gui");
 
 
 	private ActionRouter()
@@ -101,17 +109,58 @@ public class ActionRouter implements ActionListener
 				}
 				catch(Exception err)
 				{
-					err.printStackTrace();
+					log.error("",err);
 				}
 			}
 		}
 		catch (NullPointerException er)
 		{
-			er.printStackTrace();
+			log.error("",er);
 			JMeterUtils.reportErrorToUser("Sorry, this feature (" + e.getActionCommand() +
 					") not yet implemented");
 		}
 	}
+	
+	public Set getAction(String actionName)
+	{
+		Set set = new HashSet();
+		Set commandObjects = (Set)commands.get(actionName);
+		Iterator iter = commandObjects.iterator();
+		while(iter.hasNext())
+		{
+			try
+			{
+				set.add(iter.next());
+			}
+			catch(Exception err)
+			{
+				log.error("",err);
+			}
+		}
+		return set;
+	}
+	
+	public Command getAction(String actionName,String className)
+	{
+		Set commandObjects = (Set)commands.get(actionName);
+		Iterator iter = commandObjects.iterator();
+		while(iter.hasNext())
+		{
+			try
+			{
+				Command com = (Command)iter.next();
+				if(com.getClass().getName().equals(className))
+				{
+					return com;
+				}
+			}
+			catch(Exception err)
+			{
+				log.error("",err);
+			}
+		}
+		return null;
+	}
 
 	private void populateCommandMap()
 	{
@@ -122,11 +171,12 @@ public class ActionRouter implements ActionListener
 		try
 		{
 			listClasses = ClassFinder.findClassesThatExtend(
+					JMeterUtils.getSearchPaths(),
 					new Class[]{Class.forName("org.apache.jmeter.gui.action.Command")});
 			commands = new HashMap(listClasses.size());
 			if (listClasses.size() == 0)
 			{
-				System.out.println("!!!!!Uh-oh, didn't find any action handlers!!!!!");
+				log.warn("!!!!!Uh-oh, didn't find any action handlers!!!!!");
 			}
 			iterClasses = listClasses.iterator();
 			while (iterClasses.hasNext())
@@ -153,8 +203,7 @@ public class ActionRouter implements ActionListener
 		}
 		catch (Exception e)
 		{
-			System.out.println("exception finding action handlers");
-			e.printStackTrace();
+			log.error("exception finding action handlers",e);
 		}
 	}
 
diff --git a/jakarta-jmeter/src/core/org/apache/jmeter/gui/action/AddParent.java b/jakarta-jmeter/src/core/org/apache/jmeter/gui/action/AddParent.java
index 50f3e47..0c7a528 100644
--- a/jakarta-jmeter/src/core/org/apache/jmeter/gui/action/AddParent.java
+++ b/jakarta-jmeter/src/core/org/apache/jmeter/gui/action/AddParent.java
@@ -1,21 +1,82 @@
+/*
+ * ====================================================================
+ * The Apache Software License, Version 1.1
+ *
+ * Copyright (c) 2002 The Apache Software Foundation.  All rights
+ * reserved.
+ *
+ * Redistribution and use in source and binary forms, with or without
+ * modification, are permitted provided that the following conditions
+ * are met:
+ *
+ * 1. Redistributions of source code must retain the above copyright
+ * notice, this list of conditions and the following disclaimer.
+ *
+ * 2. Redistributions in binary form must reproduce the above copyright
+ * notice, this list of conditions and the following disclaimer in
+ * the documentation and/or other materials provided with the
+ * distribution.
+ *
+ * 3. The end-user documentation included with the redistribution,
+ * if any, must include the following acknowledgment:
+ * "This product includes software developed by the
+ * Apache Software Foundation (http://www.apache.org/)."
+ * Alternately, this acknowledgment may appear in the software itself,
+ * if and wherever such third-party acknowledgments normally appear.
+ *
+ * 4. The names "Apache" and "Apache Software Foundation" and
+ * "Apache JMeter" must not be used to endorse or promote products
+ * derived from this software without prior written permission. For
+ * written permission, please contact apache@apache.org.
+ *
+ * 5. Products derived from this software may not be called "Apache",
+ * "Apache JMeter", nor may "Apache" appear in their name, without
+ * prior written permission of the Apache Software Foundation.
+ *
+ * THIS SOFTWARE IS PROVIDED ``AS IS'' AND ANY EXPRESSED OR IMPLIED
+ * WARRANTIES, INCLUDING, BUT NOT LIMITED TO, THE IMPLIED WARRANTIES
+ * OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE ARE
+ * DISCLAIMED.  IN NO EVENT SHALL THE APACHE SOFTWARE FOUNDATION OR
+ * ITS CONTRIBUTORS BE LIABLE FOR ANY DIRECT, INDIRECT, INCIDENTAL,
+ * SPECIAL, EXEMPLARY, OR CONSEQUENTIAL DAMAGES (INCLUDING, BUT NOT
+ * LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES; LOSS OF
+ * USE, DATA, OR PROFITS; OR BUSINESS INTERRUPTION) HOWEVER CAUSED AND
+ * ON ANY THEORY OF LIABILITY, WHETHER IN CONTRACT, STRICT LIABILITY,
+ * OR TORT (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT
+ * OF THE USE OF THIS SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF
+ * SUCH DAMAGE.
+ * ====================================================================
+ *
+ * This software consists of voluntary contributions made by many
+ * individuals on behalf of the Apache Software Foundation.  For more
+ * information on the Apache Software Foundation, please see
+ * <http://www.apache.org/>.
+ */
+
 package org.apache.jmeter.gui.action;
 import java.awt.Component;
 import java.awt.event.ActionEvent;
-import java.util.*;
+import java.util.HashSet;
+import java.util.Set;
+
 import org.apache.jmeter.gui.GuiPackage;
 import org.apache.jmeter.gui.JMeterGUIComponent;
 import org.apache.jmeter.gui.tree.JMeterTreeNode;
+import org.apache.log.Hierarchy;
+import org.apache.log.Logger;
 
 /****************************************
  * Title: JMeter Description: Copyright: Copyright (c) 2000 Company: Apache
  *
  *@author    Michael Stover
- *@created   $Date: 2002/08/11 19:24:43 $
+ *@created   $Date: 2002/12/31 18:05:54 $
  *@version   1.0
  ***************************************/
 
 public class AddParent implements Command
 {
+	transient private static Logger log = Hierarchy.getDefaultHierarchy().getLoggerFor(
+			"jmeter.gui");
 	private static Set commands = new HashSet();
 	static
 	{
@@ -42,7 +103,7 @@ public class AddParent implements Command
 		}
 		catch(Exception err)
 		{
-			err.printStackTrace();
+			log.error("",err);
 		}
 
 	}
@@ -65,7 +126,7 @@ public class AddParent implements Command
 	protected void addParentToTree(JMeterGUIComponent newParent)
 	{
 		GuiPackage guiPackage = GuiPackage.getInstance();
-		JMeterTreeNode newNode = new JMeterTreeNode(newParent);
+		JMeterTreeNode newNode = new JMeterTreeNode(newParent, guiPackage.getTreeModel());
 		JMeterTreeNode currentNode = guiPackage.getTreeListener().getCurrentNode();
 		JMeterTreeNode parentNode = (JMeterTreeNode)currentNode.getParent();
 		int index = parentNode.getIndex(currentNode);
diff --git a/jakarta-jmeter/src/core/org/apache/jmeter/gui/action/AddToTree.java b/jakarta-jmeter/src/core/org/apache/jmeter/gui/action/AddToTree.java
index 9883f40..28f1819 100644
--- a/jakarta-jmeter/src/core/org/apache/jmeter/gui/action/AddToTree.java
+++ b/jakarta-jmeter/src/core/org/apache/jmeter/gui/action/AddToTree.java
@@ -2,7 +2,7 @@
  * ====================================================================
  * The Apache Software License, Version 1.1
  *
- * Copyright (c) 2001 The Apache Software Foundation.  All rights
+ * Copyright (c) 2002 The Apache Software Foundation.  All rights
  * reserved.
  *
  * Redistribution and use in source and binary forms, with or without
@@ -54,24 +54,32 @@
  */
 
 package org.apache.jmeter.gui.action;
-import org.apache.jmeter.gui.*;
-import org.apache.jmeter.threads.ThreadGroup;
-import org.apache.jmeter.gui.tree.JMeterTreeNode;
-import org.apache.jmeter.util.ClassFinder;
+import java.awt.event.ActionEvent;
+import java.util.HashMap;
+import java.util.List;
+import java.util.Map;
+import java.util.Set;
+
+import javax.swing.JComponent;
+import javax.swing.tree.TreePath;
 
-import java.awt.event.*;
-import java.util.*;
-import javax.swing.*;
+import org.apache.jmeter.gui.GuiPackage;
+import org.apache.jmeter.gui.JMeterGUIComponent;
+import org.apache.jmeter.gui.tree.JMeterTreeNode;
+import org.apache.log.Hierarchy;
+import org.apache.log.Logger;
 
 /**
  *  !ToDo (Class description)
  *
- *@author     $Author: mstover1 $
- *@created    $Date: 2002/08/11 19:24:44 $
- *@version    $Revision: 1.1 $
+ *@author     $Author: jsalvata $
+ *@created    $Date: 2002/12/31 18:05:54 $
+ *@version    $Revision: 1.5 $
  */
 public class AddToTree implements Command
 {
+	transient private static Logger log = Hierarchy.getDefaultHierarchy().getLoggerFor(
+			"jmeter.gui");
 	private Map allJMeterComponentCommands;
 
 	public AddToTree()
@@ -79,7 +87,7 @@ public class AddToTree implements Command
 		allJMeterComponentCommands = new HashMap();
 		allJMeterComponentCommands.put("Add","Add");
 		List classes;
-		
+
 	}
 
 
@@ -101,7 +109,7 @@ public class AddToTree implements Command
 	 *@param  guiPackage  Description of Parameter
 	 */
 	public void doAction(ActionEvent e)
-	{		
+	{
 		try
 		{
 			JMeterGUIComponent gui = (JMeterGUIComponent) Class.forName(((JComponent)e.getSource()).getName()).newInstance();
@@ -109,16 +117,19 @@ public class AddToTree implements Command
 		}
 		catch(Exception err)
 		{
-			err.printStackTrace();
+			log.error("",err);
 		}
 	}
 
 	protected void addObjectToTree(JMeterGUIComponent guiObject)
 	{
 		GuiPackage guiPackage = GuiPackage.getInstance();
-		guiPackage.getTreeModel().insertNodeInto(new JMeterTreeNode(guiObject),
+		JMeterTreeNode node = new JMeterTreeNode(guiObject, guiPackage.getTreeModel());
+		guiPackage.getTreeModel().insertNodeInto(node,
 				guiPackage.getTreeListener().getCurrentNode(),
 				guiPackage.getTreeListener().getCurrentNode().getChildCount());
+		guiPackage.getMainFrame().getTree().setSelectionPath(
+				new TreePath(node.getPath()));
 	}
 
 
diff --git a/jakarta-jmeter/src/core/org/apache/jmeter/gui/action/CVS/Entries b/jakarta-jmeter/src/core/org/apache/jmeter/gui/action/CVS/Entries
index 732c47f..b7b4634 100644
--- a/jakarta-jmeter/src/core/org/apache/jmeter/gui/action/CVS/Entries
+++ b/jakarta-jmeter/src/core/org/apache/jmeter/gui/action/CVS/Entries
@@ -1,22 +1,26 @@
-/AboutCommand.java/1.1/Sun Aug 11 19:24:43 2002//Tv1_7_3
-/AbstractAction.java/1.1/Sun Aug 11 19:24:43 2002//Tv1_7_3
-/ActionRouter.java/1.1/Sun Aug 11 19:24:43 2002//Tv1_7_3
-/AddParent.java/1.1/Sun Aug 11 19:24:43 2002//Tv1_7_3
-/AddToTree.java/1.1/Sun Aug 11 19:24:44 2002//Tv1_7_3
-/Analyze.java/1.1/Sun Aug 11 19:24:44 2002//Tv1_7_3
-/CheckDirty.java/1.1/Sun Aug 11 19:24:44 2002//Tv1_7_3
-/Clear.java/1.1/Sun Aug 11 19:24:44 2002//Tv1_7_3
-/Command.java/1.1/Sun Aug 11 19:24:44 2002//Tv1_7_3
-/CreateFunctionDialog.java/1.1/Sun Aug 11 19:24:44 2002//Tv1_7_3
-/DragNDrop.java/1.1/Sun Aug 11 19:24:44 2002//Tv1_7_3
-/EditCommand.java/1.1/Sun Aug 11 19:24:44 2002//Tv1_7_3
-/ExitCommand.java/1.1/Sun Aug 11 19:24:44 2002//Tv1_7_3
-/Load.java/1.1/Sun Aug 11 19:24:44 2002//Tv1_7_3
-/LookAndFeelCommand.java/1.1/Sun Aug 11 19:24:44 2002//Tv1_7_3
-/New.java/1.1/Sun Aug 11 19:24:44 2002//Tv1_7_3
-/RemoteStart.java/1.1/Sun Aug 11 19:24:44 2002//Tv1_7_3
-/Remove.java/1.1/Sun Aug 11 19:24:44 2002//Tv1_7_3
-/SSLManagerCommand.java/1.1/Sun Aug 11 19:24:44 2002//Tv1_7_3
-/Save.java/1.1/Sun Aug 11 19:24:44 2002//Tv1_7_3
-/Start.java/1.1/Sun Aug 11 19:24:44 2002//Tv1_7_3
+/AboutCommand.java/1.1/Sun Aug 11 19:24:43 2002//Tv1_8_1
+/AbstractAction.java/1.4/Thu Oct 17 19:47:16 2002//Tv1_8_1
+/ActionRouter.java/1.7/Thu Oct 17 19:47:16 2002//Tv1_8_1
+/AddParent.java/1.4/Tue Dec 31 18:05:54 2002//Tv1_8_1
+/AddToTree.java/1.5/Tue Dec 31 18:05:54 2002//Tv1_8_1
+/Analyze.java/1.1/Sun Aug 11 19:24:44 2002//Tv1_8_1
+/ChangeLanguage.java/1.5/Mon Dec 30 05:08:28 2002//Tv1_8_1
+/CheckDirty.java/1.4/Thu Oct 17 19:47:16 2002//Tv1_8_1
+/Clear.java/1.3/Thu Aug 29 18:17:38 2002//Tv1_8_1
+/Command.java/1.1/Sun Aug 11 19:24:44 2002//Tv1_8_1
+/CreateFunctionDialog.java/1.1/Sun Aug 11 19:24:44 2002//Tv1_8_1
+/DragNDrop.java/1.1/Sun Aug 11 19:24:44 2002//Tv1_8_1
+/EditCommand.java/1.2/Sun Aug 25 19:42:20 2002//Tv1_8_1
+/EnableComponent.java/1.1/Mon Aug 19 22:33:13 2002//Tv1_8_1
+/ExitCommand.java/1.1/Sun Aug 11 19:24:44 2002//Tv1_8_1
+/GlobalMouseListener.java/1.3/Thu Oct 17 19:47:16 2002//Tv1_8_1
+/Help.java/1.8/Sat Jan 18 16:46:44 2003//Tv1_8_1
+/Load.java/1.10/Sun Dec 29 14:20:56 2002//Tv1_8_1
+/LookAndFeelCommand.java/1.1/Sun Aug 11 19:24:44 2002//Tv1_8_1
+/New.java/1.2/Tue Jan  7 01:32:00 2003//Tv1_8_1
+/RemoteStart.java/1.6/Thu Oct 17 19:47:16 2002//Tv1_8_1
+/Remove.java/1.2/Sun Aug 25 19:42:20 2002//Tv1_8_1
+/SSLManagerCommand.java/1.1/Sun Aug 11 19:24:44 2002//Tv1_8_1
+/Save.java/1.7/Sun Dec 29 14:20:56 2002//Tv1_8_1
+/Start.java/1.5/Thu Oct 17 19:47:16 2002//Tv1_8_1
 D
diff --git a/jakarta-jmeter/src/core/org/apache/jmeter/gui/action/CVS/Tag b/jakarta-jmeter/src/core/org/apache/jmeter/gui/action/CVS/Tag
index 5f312fe..e2fda28 100644
--- a/jakarta-jmeter/src/core/org/apache/jmeter/gui/action/CVS/Tag
+++ b/jakarta-jmeter/src/core/org/apache/jmeter/gui/action/CVS/Tag
@@ -1 +1 @@
-Nv1_7_3
+Nv1_8_1
diff --git a/jakarta-jmeter/src/core/org/apache/jmeter/gui/action/ChangeLanguage.java b/jakarta-jmeter/src/core/org/apache/jmeter/gui/action/ChangeLanguage.java
new file mode 100644
index 0000000..b652e5a
--- /dev/null
+++ b/jakarta-jmeter/src/core/org/apache/jmeter/gui/action/ChangeLanguage.java
@@ -0,0 +1,98 @@
+/*
+ * ====================================================================
+ * The Apache Software License, Version 1.1
+ *
+ * Copyright (c) 2002 The Apache Software Foundation.  All rights
+ * reserved.
+ *
+ * Redistribution and use in source and binary forms, with or without
+ * modification, are permitted provided that the following conditions
+ * are met:
+ *
+ * 1. Redistributions of source code must retain the above copyright
+ * notice, this list of conditions and the following disclaimer.
+ *
+ * 2. Redistributions in binary form must reproduce the above copyright
+ * notice, this list of conditions and the following disclaimer in
+ * the documentation and/or other materials provided with the
+ * distribution.
+ *
+ * 3. The end-user documentation included with the redistribution,
+ * if any, must include the following acknowledgment:
+ * "This product includes software developed by the
+ * Apache Software Foundation (http://www.apache.org/)."
+ * Alternately, this acknowledgment may appear in the software itself,
+ * if and wherever such third-party acknowledgments normally appear.
+ *
+ * 4. The names "Apache" and "Apache Software Foundation" and
+ * "Apache JMeter" must not be used to endorse or promote products
+ * derived from this software without prior written permission. For
+ * written permission, please contact apache@apache.org.
+ *
+ * 5. Products derived from this software may not be called "Apache",
+ * "Apache JMeter", nor may "Apache" appear in their name, without
+ * prior written permission of the Apache Software Foundation.
+ *
+ * THIS SOFTWARE IS PROVIDED ``AS IS'' AND ANY EXPRESSED OR IMPLIED
+ * WARRANTIES, INCLUDING, BUT NOT LIMITED TO, THE IMPLIED WARRANTIES
+ * OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE ARE
+ * DISCLAIMED.  IN NO EVENT SHALL THE APACHE SOFTWARE FOUNDATION OR
+ * ITS CONTRIBUTORS BE LIABLE FOR ANY DIRECT, INDIRECT, INCIDENTAL,
+ * SPECIAL, EXEMPLARY, OR CONSEQUENTIAL DAMAGES (INCLUDING, BUT NOT
+ * LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES; LOSS OF
+ * USE, DATA, OR PROFITS; OR BUSINESS INTERRUPTION) HOWEVER CAUSED AND
+ * ON ANY THEORY OF LIABILITY, WHETHER IN CONTRACT, STRICT LIABILITY,
+ * OR TORT (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT
+ * OF THE USE OF THIS SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF
+ * SUCH DAMAGE.
+ * ====================================================================
+ *
+ * This software consists of voluntary contributions made by many
+ * individuals on behalf of the Apache Software Foundation.  For more
+ * information on the Apache Software Foundation, please see
+ * <http://www.apache.org/>.
+ */
+
+package org.apache.jmeter.gui.action;
+import java.awt.Component;
+import java.awt.event.ActionEvent;
+import java.util.HashSet;
+import java.util.Locale;
+import java.util.Set;
+
+import org.apache.jmeter.util.JMeterUtils;
+import org.apache.log.Logger;
+import org.apache.jorphan.logging.LoggingManager;
+/**
+ * @author Administrator
+ *
+ * To change this generated comment edit the template variable "typecomment":
+ * Window>Preferences>Java>Templates.
+ */
+public class ChangeLanguage implements Command
+{
+	private static final Set commands = new HashSet();
+	public final static String CHANGE_LANGUAGE = "change_language";
+	private Logger log = LoggingManager.getLoggerFor(JMeterUtils.GUI);
+	
+	static
+	{
+		commands.add(CHANGE_LANGUAGE);
+	}
+	/**
+	 * @see org.apache.jmeter.gui.action.Command#doAction(ActionEvent)
+	 */
+	public void doAction(ActionEvent e)
+	{
+		Locale loc =new Locale(((Component)e.getSource()).getName(),"");
+		log.debug("Changing language to "+loc.getLanguage());
+		JMeterUtils.setLocale(loc);
+	}
+	/**
+	 * @see org.apache.jmeter.gui.action.Command#getActionNames()
+	 */
+	public Set getActionNames()
+	{
+		return commands;
+	}
+}
diff --git a/jakarta-jmeter/src/core/org/apache/jmeter/gui/action/CheckDirty.java b/jakarta-jmeter/src/core/org/apache/jmeter/gui/action/CheckDirty.java
index 89afbc0..bc031db 100644
--- a/jakarta-jmeter/src/core/org/apache/jmeter/gui/action/CheckDirty.java
+++ b/jakarta-jmeter/src/core/org/apache/jmeter/gui/action/CheckDirty.java
@@ -9,9 +9,9 @@ import java.util.Set;
 import org.apache.jmeter.gui.GuiPackage;
 import org.apache.jmeter.gui.JMeterGUIComponent;
 import org.apache.jmeter.gui.tree.JMeterTreeNode;
-import org.apache.jmeter.util.JMeterUtils;
-import org.apache.jmeter.util.ListedHashTree;
-import org.apache.jmeter.util.ListedHashTreeVisitor;
+import org.apache.jorphan.collections.HashTree;
+import org.apache.jorphan.collections.HashTreeTraverser;
+import org.apache.jorphan.collections.ListedHashTree;
 
 /**
  * @author mstover
@@ -20,15 +20,16 @@ import org.apache.jmeter.util.ListedHashTreeVisitor;
  * Window>Preferences>Java>Templates.
  */
 public class CheckDirty extends AbstractAction implements 
-		ListedHashTreeVisitor 
+		HashTreeTraverser 
 {
 	private Map previousGuiItems;
 	public static final String CHECK_DIRTY = "check_dirty";
 	public static final String SUB_TREE_SAVED = "sub_tree_saved";
 	public static final String SUB_TREE_LOADED = "sub_tree_loaded";
 	public static final String ADD_ALL = "add_all";
-	public static final String SAVE = "save";
+	public static final String SAVE = "save_as";
 	public static final String SAVE_ALL = "save_all";
+	public static final String SAVE_TO_PREVIOUS = "save";
 	public static final String REMOVE = "check_remove";
 	
 	boolean checkMode = false;
@@ -45,6 +46,7 @@ public class CheckDirty extends AbstractAction implements
 		commands.add(SAVE);
 		commands.add(SAVE_ALL);
 		commands.add(REMOVE);
+		commands.add(SAVE_TO_PREVIOUS);
 	}
 	
 	public CheckDirty()
@@ -60,12 +62,12 @@ public class CheckDirty extends AbstractAction implements
 		String action = e.getActionCommand();
 		if(action.equals(SUB_TREE_SAVED) || action.equals(SAVE))
 		{
-			ListedHashTree subTree = GuiPackage.getInstance().getCurrentSubTree();
+			HashTree subTree = GuiPackage.getInstance().getCurrentSubTree();
 			subTree.traverse(this);
 		}
-		else if(action.equals(SAVE_ALL))
+		else if(action.equals(SAVE_ALL) || action.equals(SAVE_TO_PREVIOUS))
 		{
-			ListedHashTree subTree = GuiPackage.getInstance().getTreeModel().getTestPlan();
+			HashTree subTree = GuiPackage.getInstance().getTreeModel().getTestPlan();
 			subTree.traverse(this);
 		}
 		else if(action.equals(SUB_TREE_LOADED))
@@ -93,7 +95,7 @@ public class CheckDirty extends AbstractAction implements
 		{
 			checkMode = true;
 			dirty = false;
-			ListedHashTree wholeTree = GuiPackage.getInstance().getTreeModel().getTestPlan();
+			HashTree wholeTree = GuiPackage.getInstance().getTreeModel().getTestPlan();
 			wholeTree.traverse(this);
 			GuiPackage.getInstance().setDirty(dirty);
 			checkMode = false;
@@ -104,7 +106,7 @@ public class CheckDirty extends AbstractAction implements
 	 * The tree traverses itself depth-first, calling processNode for each object
 	 * it encounters as it goes.
 	 */
-	public void addNode(Object node,ListedHashTree subTree)
+	public void addNode(Object node,HashTree subTree)
 	{
 		JMeterGUIComponent treeNode = (JMeterGUIComponent)node;
 		if(checkMode)
diff --git a/jakarta-jmeter/src/core/org/apache/jmeter/gui/action/Clear.java b/jakarta-jmeter/src/core/org/apache/jmeter/gui/action/Clear.java
index f4eefa3..4b3c34b 100644
--- a/jakarta-jmeter/src/core/org/apache/jmeter/gui/action/Clear.java
+++ b/jakarta-jmeter/src/core/org/apache/jmeter/gui/action/Clear.java
@@ -55,24 +55,29 @@
 package org.apache.jmeter.gui.action;
 
 import java.awt.event.ActionEvent;
-import java.util.*;
-import java.lang.reflect.*;
+import java.util.HashSet;
+import java.util.Iterator;
+import java.util.Set;
 
-import org.apache.jmeter.gui.*;
-import org.apache.jmeter.gui.tree.*;
+import org.apache.jmeter.gui.GuiPackage;
+import org.apache.jmeter.gui.JMeterGUIComponent;
+import org.apache.jmeter.gui.tree.JMeterTreeNode;
 import org.apache.jmeter.samplers.Clearable;
+import org.apache.log.Hierarchy;
+import org.apache.log.Logger;
 
 /************************************************************
  *  Title: JMeter Description: Copyright: Copyright (c) 2000 Company: Apache
  *
  *@author     Michael Stover
- *@created    $Date: 2002/08/11 19:24:44 $
+ *@created    $Date: 2002/08/29 18:17:38 $
  *@version    1.0
  ***********************************************************/
 
 public class Clear implements Command
 {
-
+	transient private static Logger log = Hierarchy.getDefaultHierarchy().getLoggerFor(
+			"jmeter.gui");
 	public final static String CLEAR = "action.clear";
 	public final static String CLEAR_ALL = "action.clear_all";
 
@@ -112,7 +117,7 @@ public class Clear implements Command
 			}
 			catch (Throwable ex)
 			{
-				ex.printStackTrace();
+				log.error("",ex);
 			}
 		}
 		else
@@ -127,7 +132,7 @@ public class Clear implements Command
 				}
 				catch (Exception ex)
 				{
-					ex.printStackTrace();
+					log.error("",ex);
 				}
 			}
 		}
diff --git a/jakarta-jmeter/src/core/org/apache/jmeter/gui/action/EditCommand.java b/jakarta-jmeter/src/core/org/apache/jmeter/gui/action/EditCommand.java
index ad919ac..ca5b7a4 100644
--- a/jakarta-jmeter/src/core/org/apache/jmeter/gui/action/EditCommand.java
+++ b/jakarta-jmeter/src/core/org/apache/jmeter/gui/action/EditCommand.java
@@ -8,7 +8,7 @@ import org.apache.jmeter.util.JMeterUtils;
  * Title: JMeter Description: Copyright: Copyright (c) 2000 Company: Apache
  *
  *@author    Michael Stover
- *@created   $Date: 2002/08/11 19:24:44 $
+ *@created   $Date: 2002/08/25 19:42:20 $
  *@version   1.0
  ***************************************/
 
@@ -18,7 +18,7 @@ public class EditCommand implements Command
 	private static Set commands = new HashSet();
 	static
 	{
-		commands.add(JMeterUtils.getResString("edit"));
+		commands.add("edit");
 	}
 
 	/****************************************
diff --git a/jakarta-jmeter/src/core/org/apache/jmeter/gui/action/EnableComponent.java b/jakarta-jmeter/src/core/org/apache/jmeter/gui/action/EnableComponent.java
new file mode 100644
index 0000000..cd828c6
--- /dev/null
+++ b/jakarta-jmeter/src/core/org/apache/jmeter/gui/action/EnableComponent.java
@@ -0,0 +1,48 @@
+package org.apache.jmeter.gui.action;
+
+import java.awt.event.ActionEvent;
+import java.util.HashSet;
+import java.util.Set;
+
+import org.apache.jmeter.gui.GuiPackage;
+
+/**
+ * @author Administrator
+ *
+ * To change this generated comment edit the template variable "typecomment":
+ * Window>Preferences>Java>Templates.
+ */
+public class EnableComponent implements Command {
+	
+	public static final String ENABLE = "enable";
+	public static final String DISABLE = "disable";
+	
+	private static Set commands = new HashSet();
+	static
+	{
+		commands.add(ENABLE);
+		commands.add(DISABLE);
+	}
+
+	/**
+	 * @see org.apache.jmeter.gui.action.Command#doAction(ActionEvent)
+	 */
+	public void doAction(ActionEvent e) {
+		if(e.getActionCommand().equals(ENABLE))
+		{
+			GuiPackage.getInstance().getTreeListener().getCurrentNode().setEnabled(true);
+		}
+		else if(e.getActionCommand().equals(DISABLE))
+		{
+			GuiPackage.getInstance().getTreeListener().getCurrentNode().setEnabled(false);
+		}
+	}
+
+	/**
+	 * @see org.apache.jmeter.gui.action.Command#getActionNames()
+	 */
+	public Set getActionNames() {
+		return commands;
+	}
+
+}
diff --git a/jakarta-jmeter/src/core/org/apache/jmeter/gui/action/GlobalMouseListener.java b/jakarta-jmeter/src/core/org/apache/jmeter/gui/action/GlobalMouseListener.java
new file mode 100644
index 0000000..132def6
--- /dev/null
+++ b/jakarta-jmeter/src/core/org/apache/jmeter/gui/action/GlobalMouseListener.java
@@ -0,0 +1,22 @@
+package org.apache.jmeter.gui.action;
+import java.awt.event.MouseAdapter;
+import java.awt.event.MouseEvent;
+
+import org.apache.jmeter.util.JMeterUtils;
+import org.apache.log.Logger;
+import org.apache.jorphan.logging.LoggingManager;
+/**
+ * @author Administrator
+ *
+ * To change this generated comment edit the template variable "typecomment":
+ * Window>Preferences>Java>Templates.
+ */
+public class GlobalMouseListener extends MouseAdapter
+{
+	transient private static Logger log = LoggingManager.getLoggerFor(JMeterUtils.GUI);
+	
+	public void mousePressed(MouseEvent e)
+	{
+		log.debug("global mouse event");
+	}
+}
diff --git a/jakarta-jmeter/src/core/org/apache/jmeter/gui/action/Help.java b/jakarta-jmeter/src/core/org/apache/jmeter/gui/action/Help.java
new file mode 100644
index 0000000..ce33250
--- /dev/null
+++ b/jakarta-jmeter/src/core/org/apache/jmeter/gui/action/Help.java
@@ -0,0 +1,109 @@
+package org.apache.jmeter.gui.action;
+import java.awt.GridLayout;
+import java.awt.event.ActionEvent;
+import java.io.IOException;
+import java.util.HashSet;
+import java.util.Set;
+
+import javax.swing.JDialog;
+import javax.swing.JOptionPane;
+import javax.swing.JScrollPane;
+
+import org.apache.jmeter.gui.GuiPackage;
+import org.apache.jmeter.swing.HtmlPane;
+import org.apache.jmeter.util.JMeterUtils;
+import org.apache.log.Logger;
+import org.apache.jorphan.gui.ComponentUtil;
+import org.apache.jorphan.logging.LoggingManager;
+/**
+ * @author Administrator
+ *
+ * To change this generated comment edit the template variable "typecomment":
+ * Window>Preferences>Java>Templates.
+ */
+public class Help implements Command
+{
+	transient private static Logger log =
+		LoggingManager.getLoggerFor(JMeterUtils.GUI);
+	private static Set commands = new HashSet();
+	public final static String HELP = "help";
+	private static String helpPage =
+		"file:///"
+			+ JMeterUtils.getJMeterHome()
+			+ "/docs/usermanual/component_reference.html";
+	private static JDialog helpWindow;
+	private static HtmlPane helpDoc;
+	private static JScrollPane scroller;
+	private static String currentPage;
+	static {
+		commands.add(HELP);
+		helpDoc = new HtmlPane();
+		scroller = new JScrollPane(helpDoc);
+		helpDoc.setEditable(false);
+		try
+		{
+			helpDoc.setPage(helpPage);
+			currentPage = helpPage;
+		}
+		catch (IOException err)
+		{
+			log.error("Couldn't load " + helpPage, err);
+		}
+	}
+	/**
+	 * @see org.apache.jmeter.gui.action.Command#doAction(ActionEvent)
+	 */
+	public void doAction(ActionEvent e)
+	{
+		if (helpWindow == null)
+		{
+			helpWindow =
+				new JDialog(
+					GuiPackage.getInstance().getMainFrame(),
+					JMeterUtils.getResString("help"),
+					false);
+			helpWindow.getContentPane().setLayout(new GridLayout(1, 1));
+			ComponentUtil.centerComponentInWindow(helpWindow, 60);
+		}
+		if(e.getSource() instanceof String[])
+		{
+			String[] source = (String[])e.getSource();
+			resetPage(source[0]);
+			helpDoc.scrollToReference(source[1]);
+		}
+		else
+		{
+			resetPage(helpPage);
+			helpDoc.scrollToReference(GuiPackage
+				.getInstance()
+				.getTreeListener()
+				.getCurrentNode()
+				.getStaticLabel().replace(' ','_'));
+		}		
+		helpWindow.getContentPane().removeAll();
+		helpWindow.getContentPane().add(scroller);
+		helpWindow.show();
+	}
+	private void resetPage(String source)
+	{
+		if(!currentPage.equals(source))
+		{
+			try
+			{
+				helpDoc.setPage(source);
+				currentPage = source;
+			}
+			catch (IOException err)
+			{
+				log.error("Couldn't load page: "+source,err);
+			}				
+		}
+	}
+	/**
+	 * @see org.apache.jmeter.gui.action.Command#getActionNames()
+	 */
+	public Set getActionNames()
+	{
+		return commands;
+	}
+}
diff --git a/jakarta-jmeter/src/core/org/apache/jmeter/gui/action/Load.java b/jakarta-jmeter/src/core/org/apache/jmeter/gui/action/Load.java
index 35e68e5..29112dd 100644
--- a/jakarta-jmeter/src/core/org/apache/jmeter/gui/action/Load.java
+++ b/jakarta-jmeter/src/core/org/apache/jmeter/gui/action/Load.java
@@ -66,20 +66,18 @@ import java.util.Set;
 import javax.swing.JFileChooser;
 import junit.framework.TestCase;
 
-import org.apache.jmeter.control.GenericController;
-import org.apache.jmeter.control.gui.LogicControllerGui;
 import org.apache.jmeter.control.gui.WorkBenchGui;
 import org.apache.jmeter.exceptions.IllegalUserActionException;
 import org.apache.jmeter.gui.GuiPackage;
 import org.apache.jmeter.gui.JMeterGUIComponent;
 import org.apache.jmeter.gui.util.FileDialoger;
-import org.apache.jmeter.protocol.http.sampler.HTTPSampler;
 import org.apache.jmeter.save.SaveService;
-import org.apache.jmeter.save.old.JMeterNameSpaceHandler;
-import org.apache.jmeter.save.old.xml.XmlHandler;
 import org.apache.jmeter.testelement.TestElement;
 import org.apache.jmeter.util.JMeterUtils;
-import org.apache.jmeter.util.ListedHashTree;
+import org.apache.log.Hierarchy;
+import org.apache.log.Logger;
+import org.apache.jorphan.collections.HashTree;
+import org.apache.jorphan.collections.ListedHashTree;
 import org.xml.sax.InputSource;
 import org.xml.sax.XMLReader;
 
@@ -87,16 +85,18 @@ import org.xml.sax.XMLReader;
  * Title: JMeter Description: Copyright: Copyright (c) 2000 Company: Apache
  *
  *@author    Michael Stover
- *@created   $Date: 2002/08/11 19:24:44 $
+ *@created   $Date: 2002/12/29 14:20:56 $
  *@version   1.0
  ***************************************/
 public class Load implements Command
 {
+	transient private static Logger log = Hierarchy.getDefaultHierarchy().getLoggerFor(
+			"jmeter.gui");
 	private static Set commands = new HashSet();
 
 	static
 	{
-		commands.add(JMeterUtils.getResString("open"));
+		commands.add("open");
 	}
 
 	/****************************************
@@ -126,6 +126,7 @@ public class Load implements Command
 		{
 			return;
 		}
+		boolean isTestPlan = false;
 		InputStream reader = null;
 		File f = null;
 		try
@@ -134,48 +135,44 @@ public class Load implements Command
 			if(f != null)
 			{
 				reader = new FileInputStream(f);
-				ListedHashTree tree = SaveService.loadSubTree(reader);
-				insertLoadedTree(e.getID(), tree);
+				HashTree tree = SaveService.loadSubTree(reader);
+				isTestPlan = insertLoadedTree(e.getID(), tree);
 			}
 		}
-		catch(IllegalUserActionException ex)
+		catch(Exception ex)
 		{
 			JMeterUtils.reportErrorToUser(ex.getMessage());
 		}
-		catch(Throwable ex)
-		{
-			try
-			{
-				legacyLoad(f);
-			}
-			catch(Throwable err)
-			{
-				//ex.printStackTrace();
-				err.printStackTrace();
-				JMeterUtils.reportErrorToUser("Couldn't load JMX file.  May have been corrupted");
-			}
-		}
 		finally
 		{
 			GuiPackage.getInstance().getMainFrame().repaint();
 		}
+		if(isTestPlan && f != null)
+		{
+			((Save)ActionRouter.getInstance().getAction("save",
+					"org.apache.jmeter.gui.action.Save")).setTestPlanFile(f.getAbsolutePath());
+		}
 	}
 
-	private void insertLoadedTree(int id, ListedHashTree tree) throws Exception, IllegalUserActionException {
+	/**
+	 * Returns a boolean indicating whether the loaded tree was a full test plan
+	 * */
+	public boolean insertLoadedTree(int id, HashTree tree) throws Exception, IllegalUserActionException {
 		convertTree(tree);
-		GuiPackage.getInstance().addSubTree(tree);
+		boolean isTestPlan = GuiPackage.getInstance().addSubTree(tree);
 		tree = GuiPackage.getInstance().getCurrentSubTree();				
 		ActionRouter.getInstance().actionPerformed(new ActionEvent(
 			tree.get(tree.getArray()[tree.size()-1]),id,CheckDirty.SUB_TREE_LOADED));
+		return isTestPlan;
 	}
 
-	private void convertTree(ListedHashTree tree) throws Exception
+	private void convertTree(HashTree tree) throws Exception
 	{
 		Iterator iter = new LinkedList(tree.list()).iterator();
 		while (iter.hasNext())
 		{
 			TestElement item = (TestElement)iter.next();
-			convertTree(tree.get(item));
+			convertTree(tree.getTree(item));
 			JMeterGUIComponent comp = generateGUIComponent(item);
 			tree.replace(item,comp);
 		}
@@ -187,78 +184,20 @@ public class Load implements Command
 			try {
 				gui = (JMeterGUIComponent)Class.forName((String)item.getProperty(TestElement.GUI_CLASS)).newInstance();
 			} catch(Exception e) {
-				System.out.println("Couldn't get gui for "+item);
-				e.printStackTrace();
+				log.warn("Couldn't get gui for "+item,e);
 				gui = new WorkBenchGui();
 			} 
 			gui.configure(item);
 			return gui;
 	}
 	
-	private void legacyLoad(File f) throws Exception
-	{
-		FileInputStream reader = new FileInputStream(f);
-				XmlHandler handler = new XmlHandler(new JMeterNameSpaceHandler());
-				XMLReader parser = JMeterUtils.getXMLParser();
-				parser.setContentHandler(handler);
-				parser.setErrorHandler(handler);
-				parser.parse(new InputSource(reader));
-				ListedHashTree tree = handler.getDataTree();
-				updateTree(tree);
-				insertLoadedTree(443,tree);
-	}
-
 	
-	/**
-	 * For loading a 1.6 version test tree
-	 * */
-	private void updateTree(ListedHashTree tree) {
-			List items = new LinkedList(tree.list());
-			Iterator iter = items.iterator();
-
-			while (iter.hasNext()) {
-				Object item = iter.next();
-				if (item instanceof HTTPSampler) {
-					List subItems = new LinkedList(tree.list(item));
-					boolean replaced = false;
-					Iterator iter2 = subItems.iterator();
-					while (iter2.hasNext()) {
-						TestElement config = (TestElement)iter2.next();
-						if (config.getPropertyAsString(TestElement.TEST_CLASS).equals(
-								"org.apache.jmeter.protocol.http.config.UrlConfig")) {
-							replaced = true;
-							HTTPSampler newControl = new HTTPSampler();
-							newControl.setName((String)((TestElement)item).getProperty(TestElement.NAME));
-							newControl.addTestElement( config);	
-							newControl.setProperty(TestElement.GUI_CLASS,
-									"org.apache.jmeter.protocol.http.control.gui.HttpTestSampleGui");
-							tree.get(item).replace(config, newControl);
-						}
-					}
-
-					if (replaced) {
-						((TestElement)item).setProperty(TestElement.GUI_CLASS,
-								"org.apache.jmeter.protocol.http.config.gui.UrlConfigGui");
-						((TestElement)item).setProperty(TestElement.NAME,"HTTP Request Defaults");
-						GenericController newControl = new GenericController();
-						newControl.setProperty(TestElement.GUI_CLASS,
-								"org.apache.jmeter.control.gui.LogicControllerGui");
-						newControl.setName("Simple Controller");
-						tree.replace(item, newControl);
-						tree.add(newControl, item);
-					}
-				} else {
-					updateTree(tree.get(item));
-				}
-			}
-		}
-		
 	/************************************************************
 	 *  !ToDo (Class description)
 	 *
-	 *@author     $Author: mstover1 $
-	 *@created    $Date: 2002/08/11 19:24:44 $
-	 *@version    $Revision: 1.1 $
+	 *@author     $Author: jsalvata $
+	 *@created    $Date: 2002/12/29 14:20:56 $
+	 *@version    $Revision: 1.10 $
 	 ***********************************************************/
 	public static class Test extends TestCase {
 		File testFile1, testFile2, testFile3,testFile4,testFile5,testFile6,testFile7,
@@ -308,103 +247,91 @@ public class Load implements Command
 		 *
 		 *@exception  Exception  !ToDo (Exception description)
 		 ***********************************************************/
-		public void testUpdateTree() throws Exception {
-			ListedHashTree tree = getTree(testFile2);
-			loader.updateTree(tree);
-			assertTrue(tree.list(tree.list().get(0)).get(0) instanceof GenericController);
-			loader.convertTree(tree);
-			assertEquals(new LogicControllerGui().getStaticLabel(),
-					((JMeterGUIComponent)tree.list(tree.list().get(0)).get(0)).getStaticLabel());
-		}
 
 		public void testFile3() throws Exception {
-			ListedHashTree tree = getTree(testFile3);
+			HashTree tree = getTree(testFile3);
 			//loader.updateTree(tree);
-			assertTrue(tree.list().get(0) instanceof org.apache.jmeter.threads.ThreadGroup);
+			log.debug("tree contents: "+tree.list());
+			assertTrue(tree.getArray()[0] instanceof org.apache.jmeter.testelement.TestPlan);
 			loader.convertTree(tree);
-			assertTrue(tree.list().get(0) instanceof org.apache.jmeter.threads.gui.ThreadGroupGui);
+			assertTrue(tree.getArray()[0] instanceof org.apache.jmeter.control.gui.TestPlanGui);
 		}
 		
 		public void testFile4() throws Exception {
-			ListedHashTree tree = getTree(testFile4);
+			HashTree tree = getTree(testFile4);
 			//loader.updateTree(tree);
-			assertTrue(tree.list().get(0) instanceof org.apache.jmeter.testelement.TestPlan);
+			assertTrue(tree.getArray()[0] instanceof org.apache.jmeter.testelement.TestPlan);
 			loader.convertTree(tree);
-			assertTrue(tree.list().get(0) instanceof org.apache.jmeter.control.gui.TestPlanGui);
+			assertTrue(tree.getArray()[0] instanceof org.apache.jmeter.control.gui.TestPlanGui);
 		}
 		
 		public void testFile5() throws Exception {
-			ListedHashTree tree = getTree(testFile5);
+			HashTree tree = getTree(testFile5);
 			//loader.updateTree(tree);
-			assertTrue(tree.list().get(0) instanceof org.apache.jmeter.testelement.TestPlan);
+			assertTrue(tree.getArray()[0] instanceof org.apache.jmeter.testelement.TestPlan);
 			loader.convertTree(tree);
-			assertTrue(tree.list().get(0) instanceof org.apache.jmeter.control.gui.TestPlanGui);
+			assertTrue(tree.getArray()[0] instanceof org.apache.jmeter.control.gui.TestPlanGui);
 		}
 		
 		public void testFile6() throws Exception {
-			ListedHashTree tree = getTree(testFile6);
+			HashTree tree = getTree(testFile6);
 			//loader.updateTree(tree);
-			assertTrue(tree.list().get(0) instanceof org.apache.jmeter.testelement.TestPlan);
+			assertTrue(tree.getArray()[0] instanceof org.apache.jmeter.testelement.TestPlan);
 			loader.convertTree(tree);
-			assertTrue(tree.list().get(0) instanceof org.apache.jmeter.control.gui.TestPlanGui);
+			assertTrue(tree.getArray()[0] instanceof org.apache.jmeter.control.gui.TestPlanGui);
 		}
 		
 		public void testFile7() throws Exception {
-			ListedHashTree tree = getTree(testFile7);
+			HashTree tree = getTree(testFile7);
 			//loader.updateTree(tree);
-			assertTrue(tree.list().get(0) instanceof org.apache.jmeter.testelement.TestPlan);
+			assertTrue(tree.getArray()[0] instanceof org.apache.jmeter.testelement.TestPlan);
 			loader.convertTree(tree);
-			assertTrue(tree.list().get(0) instanceof org.apache.jmeter.control.gui.TestPlanGui);
+			assertTrue(tree.getArray()[0] instanceof org.apache.jmeter.control.gui.TestPlanGui);
 		}
 		
 		public void testFile8() throws Exception {
-			ListedHashTree tree = getTree(testFile8);
+			HashTree tree = getTree(testFile8);
 			//loader.updateTree(tree);
-			assertTrue(tree.list().get(0) instanceof org.apache.jmeter.testelement.TestPlan);
+			assertTrue(tree.getArray()[0] instanceof org.apache.jmeter.testelement.TestPlan);
 			loader.convertTree(tree);
-			assertTrue(tree.list().get(0) instanceof org.apache.jmeter.control.gui.TestPlanGui);
+			assertTrue(tree.getArray()[0] instanceof org.apache.jmeter.control.gui.TestPlanGui);
 		}
 		
 		public void testFile9() throws Exception {
-			ListedHashTree tree = getTree(testFile9);
+			HashTree tree = getTree(testFile9);
 			//loader.updateTree(tree);
-			assertTrue(tree.list().get(0) instanceof org.apache.jmeter.testelement.TestPlan);
+			assertTrue(tree.getArray()[0] instanceof org.apache.jmeter.testelement.TestPlan);
 			loader.convertTree(tree);
-			assertTrue(tree.list().get(0) instanceof org.apache.jmeter.control.gui.TestPlanGui);
+			assertTrue(tree.getArray()[0] instanceof org.apache.jmeter.control.gui.TestPlanGui);
 		}
 		
 		public void testFile10() throws Exception {
-			ListedHashTree tree = getTree(testFile10);
+			HashTree tree = getTree(testFile10);
 			//loader.updateTree(tree);
-			assertTrue(tree.list().get(0) instanceof org.apache.jmeter.testelement.TestPlan);
+			assertTrue(tree.getArray()[0] instanceof org.apache.jmeter.testelement.TestPlan);
 			loader.convertTree(tree);
-			assertTrue(tree.list().get(0) instanceof org.apache.jmeter.control.gui.TestPlanGui);
+			assertTrue(tree.getArray()[0] instanceof org.apache.jmeter.control.gui.TestPlanGui);
 		}
 		
 		public void testFile11() throws Exception {
-			ListedHashTree tree = getTree(testFile11);
+			HashTree tree = getTree(testFile11);
 			//loader.updateTree(tree);
-			assertTrue(tree.list().get(0) instanceof org.apache.jmeter.testelement.TestPlan);
+			assertTrue(tree.getArray()[0] instanceof org.apache.jmeter.testelement.TestPlan);
 			loader.convertTree(tree);
-			assertTrue(tree.list().get(0) instanceof org.apache.jmeter.control.gui.TestPlanGui);
+			assertTrue(tree.getArray()[0] instanceof org.apache.jmeter.control.gui.TestPlanGui);
 		}
 		
 		public void testFile12() throws Exception {
-			ListedHashTree tree = getTree(testFile12);
+			HashTree tree = getTree(testFile12);
 			//loader.updateTree(tree);
-			assertTrue(tree.list().get(0) instanceof org.apache.jmeter.testelement.TestPlan);
+			assertTrue(tree.getArray()[0] instanceof org.apache.jmeter.testelement.TestPlan);
 			loader.convertTree(tree);
-			assertTrue(tree.list().get(0) instanceof org.apache.jmeter.control.gui.TestPlanGui);
+			assertTrue(tree.getArray()[0] instanceof org.apache.jmeter.control.gui.TestPlanGui);
 		}
 
-		private ListedHashTree getTree(File f) throws Exception {
+		private HashTree getTree(File f) throws Exception {
 				FileInputStream reader = new FileInputStream(f);
-				XmlHandler handler = new XmlHandler(new JMeterNameSpaceHandler());
-				XMLReader parser = JMeterUtils.getXMLParser();
-				parser.setContentHandler(handler);
-				parser.setErrorHandler(handler);
-				parser.parse(new InputSource(reader));
-				ListedHashTree tree = handler.getDataTree();
+				HashTree tree = SaveService.loadSubTree(reader);
 				return tree;
 		}
 	}
diff --git a/jakarta-jmeter/src/core/org/apache/jmeter/gui/action/New.java b/jakarta-jmeter/src/core/org/apache/jmeter/gui/action/New.java
index 5c333e1..56cd42b 100644
--- a/jakarta-jmeter/src/core/org/apache/jmeter/gui/action/New.java
+++ b/jakarta-jmeter/src/core/org/apache/jmeter/gui/action/New.java
@@ -118,6 +118,11 @@ public class New implements Command
 		}
 		guiPackage.getTreeModel().clearTestPlan();
 		guiPackage.getTreeListener().getJTree().setSelectionRow(1);
+
+		// Clear the name of the test plan file
+		Save save = (Save) ActionRouter.getInstance().getAction("save", "org.apache.jmeter.gui.action.Save");
+		save.setTestPlanFile(null);
+		
 		ActionRouter.getInstance().actionPerformed(new ActionEvent(
 				e.getSource(),e.getID(),CheckDirty.ADD_ALL));
 	}
diff --git a/jakarta-jmeter/src/core/org/apache/jmeter/gui/action/RemoteStart.java b/jakarta-jmeter/src/core/org/apache/jmeter/gui/action/RemoteStart.java
index 9ab8c64..c6d3942 100644
--- a/jakarta-jmeter/src/core/org/apache/jmeter/gui/action/RemoteStart.java
+++ b/jakarta-jmeter/src/core/org/apache/jmeter/gui/action/RemoteStart.java
@@ -55,27 +55,34 @@
 package org.apache.jmeter.gui.action;
 import java.awt.Component;
 import java.awt.event.ActionEvent;
-import java.rmi.RemoteException;
-import java.util.*;
-import org.apache.jmeter.engine.*;
-import org.apache.jmeter.gui.*;
-import org.apache.jmeter.testelement.TestPlan;
-import org.apache.jmeter.threads.ThreadGroup;
-import org.apache.jmeter.util.JMeterUtils;
-import org.apache.jmeter.util.ListedHashTree;
+import java.util.HashMap;
+import java.util.HashSet;
+import java.util.Map;
+import java.util.Set;
+
 import javax.swing.JOptionPane;
 
+import org.apache.jmeter.engine.ClientJMeterEngine;
+import org.apache.jmeter.engine.JMeterEngine;
+import org.apache.jmeter.engine.JMeterEngineException;
+import org.apache.jmeter.gui.GuiPackage;
+import org.apache.jmeter.util.JMeterUtils;
+import org.apache.log.Hierarchy;
+import org.apache.log.Logger;
+import org.apache.jorphan.collections.HashTree;
+
 /****************************************
  * Title: Description: Copyright: Copyright (c) 2001 Company:
  *
  *@author    Michael Stover
- *@created   $Date: 2002/08/11 19:24:44 $
+ *@created   $Date: 2002/10/17 19:47:16 $
  *@version   1.0
  ***************************************/
 
 public class RemoteStart extends AbstractAction
 {
-
+	transient private static Logger log = Hierarchy.getDefaultHierarchy().getLoggerFor(
+			"jmeter.gui");
 	private Map remoteEngines = new HashMap();
 
 	private static Set commands = new HashSet();
@@ -101,6 +108,7 @@ public class RemoteStart extends AbstractAction
 		String action = e.getActionCommand();
 		if(action.equals("remote_stop"))
 		{
+			GuiPackage.getInstance().getMainFrame().showStoppingMessage(name);
 			JMeterEngine engine = (JMeterEngine)remoteEngines.get(name);
 			engine.stopTest();
 		}
@@ -116,7 +124,7 @@ public class RemoteStart extends AbstractAction
 				}
 				catch(Exception ex)
 				{
-					ex.printStackTrace();
+					log.error("",ex);
 					JMeterUtils.reportErrorToUser("Bad call to remote host");
 					return;
 				}
@@ -148,7 +156,7 @@ public class RemoteStart extends AbstractAction
 	private void startEngine(JMeterEngine engine, String host)
 	{
 		GuiPackage gui = GuiPackage.getInstance();
-		ListedHashTree testTree = gui.getTreeModel().getTestPlan();
+		HashTree testTree = gui.getTreeModel().getTestPlan();
 		convertSubTree(testTree);
 		testTree.add(testTree.getArray()[0],gui.getMainFrame());
 		engine.configure(testTree);
diff --git a/jakarta-jmeter/src/core/org/apache/jmeter/gui/action/Remove.java b/jakarta-jmeter/src/core/org/apache/jmeter/gui/action/Remove.java
index 59188a4..034340e 100644
--- a/jakarta-jmeter/src/core/org/apache/jmeter/gui/action/Remove.java
+++ b/jakarta-jmeter/src/core/org/apache/jmeter/gui/action/Remove.java
@@ -113,6 +113,6 @@ public class Remove implements Command
 	}
 	static
 	{
-		commands.add(JMeterUtils.getResString("remove"));
+		commands.add("remove");
 	}
 }
diff --git a/jakarta-jmeter/src/core/org/apache/jmeter/gui/action/Save.java b/jakarta-jmeter/src/core/org/apache/jmeter/gui/action/Save.java
index 020feee..ed6f034 100644
--- a/jakarta-jmeter/src/core/org/apache/jmeter/gui/action/Save.java
+++ b/jakarta-jmeter/src/core/org/apache/jmeter/gui/action/Save.java
@@ -54,15 +54,24 @@
  */
 package org.apache.jmeter.gui.action;
 import java.awt.event.ActionEvent;
-import java.io.*;
-import java.util.*;
-import javax.swing.*;
-import org.apache.jmeter.gui.*;
+import java.io.FileOutputStream;
+import java.io.OutputStream;
+import java.util.HashSet;
+import java.util.Iterator;
+import java.util.LinkedList;
+import java.util.Set;
+
+import javax.swing.JFileChooser;
+
+import org.apache.jmeter.gui.GuiPackage;
+import org.apache.jmeter.gui.JMeterGUIComponent;
 import org.apache.jmeter.gui.util.FileDialoger;
-import org.apache.jmeter.save.*;
-import org.apache.jmeter.util.*;
-import org.apache.jmeter.testelement.TestElement;
 import org.apache.jmeter.save.SaveService;
+import org.apache.jmeter.testelement.TestElement;
+import org.apache.log.Hierarchy;
+import org.apache.log.Logger;
+import org.apache.jorphan.collections.HashTree;
+import org.apache.jorphan.collections.ListedHashTree;
 
 /****************************************
  * Title: JMeter Description: Copyright: Copyright (c) 2000 Company: Apache
@@ -74,14 +83,20 @@ import org.apache.jmeter.save.SaveService;
 
 public class Save implements Command
 {
+	transient private static Logger log = Hierarchy.getDefaultHierarchy().getLoggerFor(
+			"jmeter.gui");
 	private final static String SAVE_ALL = "save_all";
-	private final static String SAVE = "save";
+	private final static String SAVE = "save_as";
+	private final static String SAVE_TO_PREVIOUS = "save";
+	private String chosenFile;
+	private String testPlanFile;
 
 	private static Set commands = new HashSet();
 	static
 	{
 		commands.add(SAVE);
 		commands.add(SAVE_ALL);
+		commands.add(SAVE_TO_PREVIOUS);
 	}
 
 
@@ -100,6 +115,11 @@ public class Save implements Command
 	{
 		return commands;
 	}
+	
+	public void setTestPlanFile(String f)
+	{
+		testPlanFile = f;
+	}
 
 
 	/****************************************
@@ -109,12 +129,12 @@ public class Save implements Command
 	 ***************************************/
 	public void doAction(ActionEvent e)
 	{
-		ListedHashTree subTree = null;
+		HashTree subTree = null;
 		if(e.getActionCommand().equals(SAVE))
 		{
 			subTree = GuiPackage.getInstance().getCurrentSubTree();
 		}
-		else if(e.getActionCommand().equals(SAVE_ALL))
+		else if(e.getActionCommand().equals(SAVE_ALL) || e.getActionCommand().equals(SAVE_TO_PREVIOUS))
 		{
 			subTree = GuiPackage.getInstance().getTreeModel().getTestPlan();
 		}
@@ -123,21 +143,38 @@ public class Save implements Command
 			convertSubTree(subTree);
 		}catch(Exception err)
 		{}
-		JFileChooser chooser = FileDialoger.promptToSaveFile(
-				GuiPackage.getInstance().getTreeListener().getCurrentNode().getName() + ".jmx");
-		if(chooser == null)
+		if(!SAVE_TO_PREVIOUS.equals(e.getActionCommand()) || testPlanFile == null)
+		{
+			JFileChooser chooser = FileDialoger.promptToSaveFile(
+					GuiPackage.getInstance().getTreeListener().getCurrentNode().getName() + ".jmx");
+			if(chooser == null)
+			{
+				return;
+			}
+			if(e.getActionCommand().equals(SAVE_ALL) || e.getActionCommand().equals(SAVE_TO_PREVIOUS))
+			{
+				testPlanFile = chooser.getSelectedFile().getAbsolutePath();
+				chosenFile = testPlanFile;
+			}
+			else
+			{
+				chosenFile = chooser.getSelectedFile().getAbsolutePath();
+			}
+		}
+		else
 		{
-			return;
+			chosenFile = testPlanFile;
 		}
+		
 		OutputStream writer = null;
 		try
 		{
-			writer = new FileOutputStream(chooser.getSelectedFile());
+			writer = new FileOutputStream(chosenFile);
 			SaveService.saveSubTree(subTree,writer);
 		}
 		catch(Throwable ex)
 		{
-			ex.printStackTrace();
+			log.error("",ex);
 		}
 		finally
 		{
@@ -146,13 +183,13 @@ public class Save implements Command
 		}
 	}
 
-	private void convertSubTree(ListedHashTree tree)
+	private void convertSubTree(HashTree tree)
 	{
 		Iterator iter = new LinkedList(tree.list()).iterator();
 		while (iter.hasNext())
 		{
 			JMeterGUIComponent item = (JMeterGUIComponent)iter.next();
-			convertSubTree(tree.get(item));
+			convertSubTree(tree.getTree(item));
 			TestElement testElement = item.createTestElement();
 			tree.replace(item,testElement);
 		}
@@ -173,16 +210,16 @@ public class Save implements Command
 
 		public void testTreeConversion() throws Exception
 		{
-			ListedHashTree tree = new ListedHashTree();
-			JMeterGUIComponent root = new org.apache.jmeter.protocol.http.control.gui.HttpTestSampleGui();
+			HashTree tree = new ListedHashTree();
+			JMeterGUIComponent root = new org.apache.jmeter.config.gui.ArgumentsPanel();
 			tree.add(root,root);
-			tree.get(root).add(root,root);
+			tree.getTree(root).add(root,root);
 			save.convertSubTree(tree);
 			assertEquals(tree.getArray()[0].getClass().getName(),root.createTestElement().getClass().getName());
-			tree = tree.get(tree.getArray()[0]);
+			tree = tree.getTree(tree.getArray()[0]);
 			assertEquals(tree.getArray()[0].getClass().getName(),
 					root.createTestElement().getClass().getName());
-			assertEquals(tree.get(tree.getArray()[0]).getArray()[0].getClass().getName(),
+			assertEquals(tree.getTree(tree.getArray()[0]).getArray()[0].getClass().getName(),
 					root.createTestElement().getClass().getName());
 		}
 	}
@@ -203,7 +240,7 @@ public class Save implements Command
 			}
 			catch(Exception ex)
 			{
-				ex.printStackTrace();
+				log.error("",ex);
 			}
 		}
 	}
diff --git a/jakarta-jmeter/src/core/org/apache/jmeter/gui/action/Start.java b/jakarta-jmeter/src/core/org/apache/jmeter/gui/action/Start.java
index 79a1738..4df484b 100644
--- a/jakarta-jmeter/src/core/org/apache/jmeter/gui/action/Start.java
+++ b/jakarta-jmeter/src/core/org/apache/jmeter/gui/action/Start.java
@@ -58,11 +58,12 @@ import java.util.HashSet;
 import java.util.Set;
 
 import javax.swing.JOptionPane;
+
 import org.apache.jmeter.engine.JMeterEngineException;
 import org.apache.jmeter.engine.StandardJMeterEngine;
 import org.apache.jmeter.gui.GuiPackage;
 import org.apache.jmeter.util.JMeterUtils;
-import org.apache.jmeter.util.ListedHashTree;
+import org.apache.jorphan.collections.HashTree;
 
 /****************************************
  * Title: Apache JMeter Description: Copyright: Copyright (c) 2000 Company:
@@ -115,9 +116,9 @@ public class Start extends AbstractAction
 		}
 		else if(e.getActionCommand().equals("stop"))
 		{
+			GuiPackage.getInstance().getMainFrame().showStoppingMessage("");
 			engine.stopTest();
 			engine = null;
-			GuiPackage.getInstance().getMainFrame().showStoppingMessage();
 		}
 	}
 
@@ -129,7 +130,7 @@ public class Start extends AbstractAction
 	{
 		GuiPackage gui = GuiPackage.getInstance();
 		engine = new StandardJMeterEngine();
-		ListedHashTree testTree = gui.getTreeModel().getTestPlan();
+		HashTree testTree = gui.getTreeModel().getTestPlan();
 		convertSubTree(testTree);
 		testTree.add(testTree.getArray()[0],gui.getMainFrame());
 		engine.configure(testTree);
diff --git a/jakarta-jmeter/src/core/org/apache/jmeter/gui/tree/CVS/Entries b/jakarta-jmeter/src/core/org/apache/jmeter/gui/tree/CVS/Entries
index 42dfe7b..fa73ebc 100644
--- a/jakarta-jmeter/src/core/org/apache/jmeter/gui/tree/CVS/Entries
+++ b/jakarta-jmeter/src/core/org/apache/jmeter/gui/tree/CVS/Entries
@@ -1,5 +1,5 @@
-/JMeterCellRenderer.java/1.1/Sun Aug 11 19:24:44 2002//Tv1_7_3
-/JMeterTreeListener.java/1.1/Sun Aug 11 19:24:44 2002//Tv1_7_3
-/JMeterTreeModel.java/1.1/Sun Aug 11 19:24:44 2002//Tv1_7_3
-/JMeterTreeNode.java/1.1/Sun Aug 11 19:24:44 2002//Tv1_7_3
+/JMeterCellRenderer.java/1.3/Tue Dec 31 18:05:54 2002//Tv1_8_1
+/JMeterTreeListener.java/1.5/Tue Jan 28 19:49:52 2003//Tv1_8_1
+/JMeterTreeModel.java/1.7/Tue Dec 31 18:05:54 2002//Tv1_8_1
+/JMeterTreeNode.java/1.5/Thu Jan  2 01:00:12 2003//Tv1_8_1
 D
diff --git a/jakarta-jmeter/src/core/org/apache/jmeter/gui/tree/CVS/Tag b/jakarta-jmeter/src/core/org/apache/jmeter/gui/tree/CVS/Tag
index 5f312fe..e2fda28 100644
--- a/jakarta-jmeter/src/core/org/apache/jmeter/gui/tree/CVS/Tag
+++ b/jakarta-jmeter/src/core/org/apache/jmeter/gui/tree/CVS/Tag
@@ -1 +1 @@
-Nv1_7_3
+Nv1_8_1
diff --git a/jakarta-jmeter/src/core/org/apache/jmeter/gui/tree/JMeterCellRenderer.java b/jakarta-jmeter/src/core/org/apache/jmeter/gui/tree/JMeterCellRenderer.java
index ca4876f..45b6f67 100644
--- a/jakarta-jmeter/src/core/org/apache/jmeter/gui/tree/JMeterCellRenderer.java
+++ b/jakarta-jmeter/src/core/org/apache/jmeter/gui/tree/JMeterCellRenderer.java
@@ -2,7 +2,7 @@
  * ====================================================================
  * The Apache Software License, Version 1.1
  *
- * Copyright (c) 2001 The Apache Software Foundation.  All rights
+ * Copyright (c) 2001-2002 The Apache Software Foundation.  All rights
  * reserved.
  *
  * Redistribution and use in source and binary forms, with or without
@@ -52,14 +52,13 @@
  * information on the Apache Software Foundation, please see
  * <http://www.apache.org/>.
  */
- package org.apache.jmeter.gui.tree;
+package org.apache.jmeter.gui.tree;
+
 
 import javax.swing.tree.*;
 import javax.swing.*;
+
 import java.awt.Component;
-import org.apache.jmeter.gui.JMeterGUIComponent;
-import org.apache.jmeter.gui.GuiFactory;
-import org.apache.jmeter.gui.GuiPackage;
 
 /**
  * Title:        JMeter
@@ -73,27 +72,26 @@ import org.apache.jmeter.gui.GuiPackage;
 public class JMeterCellRenderer extends DefaultTreeCellRenderer
 {
 
-	 ImageIcon timer;
+    public JMeterCellRenderer()
+    {
+    }
 
-	public JMeterCellRenderer()
-	{
-		 timer = org.apache.jmeter.util.JMeterUtils.getImage("timer.gif");
-	}
 
-	public Component getTreeCellRendererComponent(JTree tree,
-															 Object value,
-															 boolean sel,
-															 boolean expanded,
-															 boolean leaf,
-															 int row,
-															 boolean hasFocus)
-	{
-		super.getTreeCellRendererComponent(tree,((JMeterGUIComponent)value).getName(),
-				sel,expanded,leaf,row,hasFocus);
-		ImageIcon ic = ((JMeterTreeNode)value).getIcon();
-		if (ic!=null)
-			 setIcon(ic);
-		return this;
-	}
+    public Component getTreeCellRendererComponent(JTree tree,
+                                                  Object value,
+                                                  boolean sel,
+                                                  boolean expanded,
+                                                  boolean leaf,
+                                                  int row,
+                                                  boolean hasFocus)
+    {
+        super.getTreeCellRendererComponent(tree, ((JMeterTreeNode)value).getName(), sel, expanded, leaf, row, hasFocus);
+        this.setEnabled(((JMeterTreeNode)value).isEnabled());
+        ImageIcon ic = ((JMeterTreeNode)value).getIcon();
+        if (ic != null) {
+            setIcon(ic);
+        }
+        return this;
+    }
 }
 
diff --git a/jakarta-jmeter/src/core/org/apache/jmeter/gui/tree/JMeterTreeListener.java b/jakarta-jmeter/src/core/org/apache/jmeter/gui/tree/JMeterTreeListener.java
index 458959a..ef4a6af 100644
--- a/jakarta-jmeter/src/core/org/apache/jmeter/gui/tree/JMeterTreeListener.java
+++ b/jakarta-jmeter/src/core/org/apache/jmeter/gui/tree/JMeterTreeListener.java
@@ -68,12 +68,18 @@ import javax.swing.JPopupMenu;
 import javax.swing.JTree;
 import javax.swing.event.TreeSelectionEvent;
 import javax.swing.event.TreeSelectionListener;
+import javax.swing.tree.TreeNode;
 import javax.swing.tree.TreePath;
+
+import org.apache.jmeter.control.gui.TestPlanGui;
+import org.apache.jmeter.control.gui.WorkBenchGui;
 import org.apache.jmeter.gui.GuiPackage;
 import org.apache.jmeter.gui.JMeterGUIComponent;
 import org.apache.jmeter.gui.MainFrame;
 import org.apache.jmeter.gui.action.DragNDrop;
 import org.apache.jmeter.util.JMeterUtils;
+import org.apache.log.Hierarchy;
+import org.apache.log.Logger;
 
 /****************************************
  * Title: JMeter Description: Copyright: Copyright (c) 2000 Company: Apache
@@ -86,6 +92,8 @@ import org.apache.jmeter.util.JMeterUtils;
 public class JMeterTreeListener implements TreeSelectionListener, MouseListener, 
 		KeyListener,MouseMotionListener
 {
+	transient private static Logger log = Hierarchy.getDefaultHierarchy().getLoggerFor(
+			"jmeter.gui");
 	Container endWindow;
 	JPopupMenu pop;
 	TreePath currentPath;
@@ -226,7 +234,7 @@ public class JMeterTreeListener implements TreeSelectionListener, MouseListener,
 	public void valueChanged(TreeSelectionEvent e)
 	{
 		currentPath = e.getNewLeadSelectionPath();
-		actionHandler.actionPerformed(new ActionEvent(this, 3333, JMeterUtils.getResString("edit")));
+		actionHandler.actionPerformed(new ActionEvent(this, 3333, "edit"));
 	}
 
 
@@ -245,7 +253,7 @@ public class JMeterTreeListener implements TreeSelectionListener, MouseListener,
 	 ***************************************/
 	public void mouseReleased(MouseEvent e) 
 	{ 
-		if(dragging && draggedNode != getCurrentNode())
+		if(dragging && isValidDragAction(draggedNode,getCurrentNode()))
 		{
 			dragging = false;
 			JPopupMenu dragNdrop = new JPopupMenu();
@@ -266,6 +274,10 @@ public class JMeterTreeListener implements TreeSelectionListener, MouseListener,
 			dragNdrop.add(item);
 			displayPopUp(e,dragNdrop);
 		}
+		else
+		{
+			GuiPackage.getInstance().getMainFrame().repaint();
+		}
 		dragging = false;
 	}
 	
@@ -273,6 +285,24 @@ public class JMeterTreeListener implements TreeSelectionListener, MouseListener,
 	{
 		return draggedNode;
 	}
+	
+	/**
+	 * Tests if the node is being dragged into one of it's own sub-nodes, or into
+	 * itself.
+	 */
+	private boolean isValidDragAction(JMeterTreeNode source,JMeterTreeNode dest)
+	{
+		boolean isValid = true;
+		TreeNode[] path = dest.getPath();
+		for (int i = 0; i < path.length; i++)
+		{
+			if(path[i] == source)
+			{
+				isValid = false;
+			}			
+		}
+		return isValid;
+	}
 
 
 	/****************************************
@@ -341,6 +371,11 @@ public class JMeterTreeListener implements TreeSelectionListener, MouseListener,
 		{
 			dragging = true;
 			draggedNode = getCurrentNode();
+			if(draggedNode.getUserObject() instanceof TestPlanGui || 
+					draggedNode.getUserObject() instanceof WorkBenchGui)
+			{
+				dragging = false;
+			}
 			
 		}
 		changeSelectionIfDragging(e);
@@ -408,8 +443,8 @@ public class JMeterTreeListener implements TreeSelectionListener, MouseListener,
 		}
 		catch(NullPointerException e)
 		{
-			System.out.println("Null pointer: JMeterTreeListener.updateMenuItem()");
-			e.printStackTrace();
+			log.error("Null pointer: JMeterTreeListener.updateMenuItem()",e);
+			log.error("",e);
 		}
 	}
 
diff --git a/jakarta-jmeter/src/core/org/apache/jmeter/gui/tree/JMeterTreeModel.java b/jakarta-jmeter/src/core/org/apache/jmeter/gui/tree/JMeterTreeModel.java
index a9c1e64..4e59583 100644
--- a/jakarta-jmeter/src/core/org/apache/jmeter/gui/tree/JMeterTreeModel.java
+++ b/jakarta-jmeter/src/core/org/apache/jmeter/gui/tree/JMeterTreeModel.java
@@ -2,7 +2,7 @@
  * ====================================================================
  * The Apache Software License, Version 1.1
  *
- * Copyright (c) 2001 The Apache Software Foundation.  All rights
+ * Copyright (c) 2002 The Apache Software Foundation.  All rights
  * reserved.
  *
  * Redistribution and use in source and binary forms, with or without
@@ -53,43 +53,43 @@
  * <http://www.apache.org/>.
  */
 package org.apache.jmeter.gui.tree;
-import java.util.*;
-import javax.swing.tree.*;
-import org.apache.jmeter.config.ConfigElement;
+import java.util.Enumeration;
+import java.util.Iterator;
+import java.util.LinkedList;
+import java.util.List;
+
+import javax.swing.tree.DefaultTreeModel;
+
+import org.apache.jmeter.config.gui.AbstractConfigGui;
 import org.apache.jmeter.control.gui.TestPlanGui;
 import org.apache.jmeter.control.gui.WorkBenchGui;
-import org.apache.jmeter.config.gui.AbstractConfigGui;
-import org.apache.jmeter.threads.gui.ThreadGroupGui;
-import org.apache.jmeter.gui.JMeterGUIComponent;
 import org.apache.jmeter.exceptions.IllegalUserActionException;
+import org.apache.jmeter.gui.JMeterGUIComponent;
 import org.apache.jmeter.gui.NamePanel;
-import org.apache.jmeter.samplers.SampleListener;
 import org.apache.jmeter.testelement.TestPlan;
 import org.apache.jmeter.testelement.WorkBench;
-import org.apache.jmeter.threads.ThreadGroup;
-import org.apache.jmeter.timers.Timer;
-import org.apache.jmeter.util.ListedHashTree;
+import org.apache.jorphan.collections.HashTree;
+import org.apache.jorphan.collections.ListedHashTree;
 /****************************************
  * Title: JMeter Description: Copyright: Copyright (c) 2000 Company: Apache
  *
  *@author    Michael Stover
- *@created   $Date: 2002/08/11 19:24:44 $
+ *@created   $Date: 2002/12/31 18:05:54 $
  *@version   1.0
  ***************************************/
 
 public class JMeterTreeModel extends DefaultTreeModel
 {
-	private static ResourceBundle rb = ResourceBundle.getBundle("org.apache.jmeter.resources.messages");
 
 	/****************************************
 	 * !ToDo (Constructor description)
 	 ***************************************/
 	public JMeterTreeModel()
 	{
-		super(new JMeterTreeNode(new NamePanel()));
-		this.insertNodeInto(new JMeterTreeNode(new TestPlanGui()),
+		super(new JMeterTreeNode(new NamePanel(), null));
+		this.insertNodeInto(new JMeterTreeNode(new TestPlanGui(), this),
 				(JMeterTreeNode)getRoot(), 0);
-		this.insertNodeInto(new JMeterTreeNode(new WorkBenchGui()),
+		this.insertNodeInto(new JMeterTreeNode(new WorkBenchGui(), this),
 				(JMeterTreeNode)getRoot(), 1);
 	}
 
@@ -107,15 +107,17 @@ public class JMeterTreeModel extends DefaultTreeModel
 	}
 
 	/****************************************
-	 * !ToDo
+	 * Adds the sub tree at the given node.  Returns a boolean indicating
+	 * whether the added sub tree was a full test plan.
 	 *
 	 *@param subTree                         !ToDo
 	 *@param current                         !ToDo
 	 *@exception IllegalUserActionException  !ToDo (Exception description)
 	 ***************************************/
-	public void addSubTree(ListedHashTree subTree, JMeterTreeNode current)
+	public boolean addSubTree(HashTree subTree, JMeterTreeNode current)
 			 throws IllegalUserActionException
 	{
+		boolean ret = false;
 		Iterator iter = subTree.list().iterator();
 		while(iter.hasNext())
 		{
@@ -124,13 +126,15 @@ public class JMeterTreeModel extends DefaultTreeModel
 			{
 				current = (JMeterTreeNode)((JMeterTreeNode)getRoot()).getChildAt(0);
 				current.configure(item.createTestElement());
-				addSubTree(subTree.get(item), current);
+				addSubTree(subTree.getTree(item), current);
+				ret = true;
 			}
 			else
 			{
-				addSubTree(subTree.get(item), addComponent(item, current));
+				addSubTree(subTree.getTree(item), addComponent(item, current));
 			}
 		}
+		return ret;
 	}
 
 	/****************************************
@@ -144,15 +148,11 @@ public class JMeterTreeModel extends DefaultTreeModel
 	public JMeterTreeNode addComponent(Object component, JMeterTreeNode node)
 			 throws IllegalUserActionException
 	{
-		if((node.getUserObject() instanceof TestPlanGui) && !(component instanceof ThreadGroupGui))
-		{
-			throw new IllegalUserActionException("Only ThreadGroups can be added to Test Plan nodes");
-		}
 		if(node.getUserObject() instanceof AbstractConfigGui)
 		{
 			throw new IllegalUserActionException("This node cannot hold sub-elements");
 		}
-		JMeterTreeNode newNode = new JMeterTreeNode((JMeterGUIComponent)component);
+		JMeterTreeNode newNode = new JMeterTreeNode((JMeterGUIComponent)component, this);
 		this.insertNodeInto(newNode, node, node.getChildCount());
 		return newNode;
 	}
@@ -185,7 +185,7 @@ public class JMeterTreeModel extends DefaultTreeModel
 		}
 	}
 
-	public ListedHashTree getCurrentSubTree(JMeterTreeNode node)
+	public HashTree getCurrentSubTree(JMeterTreeNode node)
 	{
 		ListedHashTree hashTree = new ListedHashTree(node);
 		Enumeration enum = node.children();
@@ -197,18 +197,18 @@ public class JMeterTreeModel extends DefaultTreeModel
 		return hashTree;
 	}
 
-	public ListedHashTree getTestPlan()
+	public HashTree getTestPlan()
 	{
 		return getCurrentSubTree((JMeterTreeNode)((JMeterTreeNode)this.getRoot()).getChildAt(0));
 	}
-	
+
 	public void clearTestPlan()
 	{
 		super.removeNodeFromParent((JMeterTreeNode)getChild(getRoot(), 0));
-		this.insertNodeInto(new JMeterTreeNode(new TestPlanGui()),
+		this.insertNodeInto(new JMeterTreeNode(new TestPlanGui(), this),
 				(JMeterTreeNode)getRoot(), 0);
 		super.removeNodeFromParent((JMeterTreeNode)getChild(getRoot(), 1));
-		this.insertNodeInto(new JMeterTreeNode(new WorkBenchGui()),
+		this.insertNodeInto(new JMeterTreeNode(new WorkBenchGui(), this),
 				(JMeterTreeNode)getRoot(), 1);
 	}
 }
diff --git a/jakarta-jmeter/src/core/org/apache/jmeter/gui/tree/JMeterTreeNode.java b/jakarta-jmeter/src/core/org/apache/jmeter/gui/tree/JMeterTreeNode.java
index 2ffa00f..cf4d333 100644
--- a/jakarta-jmeter/src/core/org/apache/jmeter/gui/tree/JMeterTreeNode.java
+++ b/jakarta-jmeter/src/core/org/apache/jmeter/gui/tree/JMeterTreeNode.java
@@ -2,7 +2,7 @@
  * ====================================================================
  * The Apache Software License, Version 1.1
  *
- * Copyright (c) 2001 The Apache Software Foundation.  All rights
+ * Copyright (c) 2002 The Apache Software Foundation.  All rights
  * reserved.
  *
  * Redistribution and use in source and binary forms, with or without
@@ -59,6 +59,8 @@ import javax.swing.tree.TreeNode;
 import javax.swing.JPopupMenu;
 import java.util.Collection;
 import org.apache.jmeter.gui.JMeterGUIComponent;
+import org.apache.jmeter.gui.GUIFactory;
+
 import java.awt.event.MouseListener;
 import java.awt.event.MouseEvent;
 import org.apache.jmeter.testelement.TestElement;
@@ -68,26 +70,36 @@ import javax.swing.ImageIcon;
  *  Title: JMeter Description: Copyright: Copyright (c) 2000 Company: Apache
  *
  *@author     Michael Stover
- *@created    $Date: 2002/08/11 19:24:44 $
+ *@created    $Date: 2003/01/02 01:00:12 $
  *@version    1.0
  ***********************************************************/
 
-public class JMeterTreeNode extends DefaultMutableTreeNode implements JMeterGUIComponent
+public class JMeterTreeNode extends DefaultMutableTreeNode
+	implements JMeterGUIComponent
 {
+    JMeterTreeModel treeModel;
+
 
-	public JMeterTreeNode()
+	public JMeterTreeNode(JMeterGUIComponent userObj, JMeterTreeModel treeModel)
 	{
-		this.setUserObject(new org.apache.jmeter.control.gui.WorkBenchGui());
+		super(userObj);
+		this.treeModel = treeModel;
+		userObj.setNode(this);
 	}
 
-	public JMeterTreeNode(JMeterGUIComponent userObj)
+	public boolean isEnabled()
 	{
-		super(userObj);
+		return ((JMeterGUIComponent)getUserObject()).isEnabled();
+	}
+
+	public void setEnabled(boolean enabled)
+	{
+		((JMeterGUIComponent)getUserObject()).setEnabled(enabled);
 	}
-	
+
 	public ImageIcon getIcon()
 	{
-		return null;
+		return GUIFactory.getIcon(getUserObject().getClass());
 	}
 
 	public Collection getMenuCategories()
@@ -122,8 +134,7 @@ public class JMeterTreeNode extends DefaultMutableTreeNode implements JMeterGUIC
 	 ***********************************************************/
 	public void setName(String name)
 	{
-		Object userObj = getUserObject();
-		((JMeterGUIComponent)userObj).setName(name);
+		((JMeterGUIComponent)getUserObject()).setName(name);
 	}
 
 	/************************************************************
@@ -133,7 +144,18 @@ public class JMeterTreeNode extends DefaultMutableTreeNode implements JMeterGUIC
 	 ***********************************************************/
 	public String getName()
 	{
-		Object userObj = getUserObject();
-		return ((JMeterGUIComponent)userObj).getName();
+		return ((JMeterGUIComponent)getUserObject()).getName();
 	}
+
+
+    public void setNode(JMeterTreeNode node)
+    {
+        ((JMeterGUIComponent)getUserObject()).setNode(node);
+    }
+
+
+    public void nameChanged()
+    {
+        treeModel.nodeChanged(this);
+    }
 }
diff --git a/jakarta-jmeter/src/core/org/apache/jmeter/gui/util/CVS/Entries b/jakarta-jmeter/src/core/org/apache/jmeter/gui/util/CVS/Entries
index deadb3f..bf82062 100644
--- a/jakarta-jmeter/src/core/org/apache/jmeter/gui/util/CVS/Entries
+++ b/jakarta-jmeter/src/core/org/apache/jmeter/gui/util/CVS/Entries
@@ -1,21 +1,14 @@
-/ButtonPanel.java/1.1/Sun Aug 11 19:24:44 2002//Tv1_7_3
-/ComponentUtil.java/1.1/Sun Aug 11 19:24:44 2002//Tv1_7_3
-/FileDialoger.java/1.1/Sun Aug 11 19:24:44 2002//Tv1_7_3
-/FilePanel.java/1.1/Sun Aug 11 19:24:44 2002//Tv1_7_3
-/FocusRequester.java/1.1/Sun Aug 11 19:24:44 2002//Tv1_7_3
-/JLabeledChoice.java/1.1/Sun Aug 11 19:24:44 2002//Tv1_7_3
-/JLabeledField.java/1.1/Sun Aug 11 19:24:44 2002//Tv1_7_3
-/JLabeledPasswordField.java/1.1/Sun Aug 11 19:24:44 2002//Tv1_7_3
-/JLabeledTextArea.java/1.1/Sun Aug 11 19:24:44 2002//Tv1_7_3
-/JLabeledTextField.java/1.1/Sun Aug 11 19:24:44 2002//Tv1_7_3
-/JLabeledTextField.java_old/1.1/Sun Aug 11 19:24:44 2002//Tv1_7_3
-/JMeterColor.java/1.1/Sun Aug 11 19:24:44 2002//Tv1_7_3
-/JMeterMenuBar.java/1.1/Sun Aug 11 19:24:44 2002//Tv1_7_3
-/MenuFactory.java/1.1/Sun Aug 11 19:24:44 2002//Tv1_7_3
-/MenuInfo.java/1.1/Sun Aug 11 19:24:44 2002//Tv1_7_3
-/NumberFieldErrorListener.java/1.1/Sun Aug 11 19:24:44 2002//Tv1_7_3
-/PowerTableModel.java/1.2/Wed Aug 14 02:52:18 2002//Tv1_7_3
-/TextAreaCellRenderer.java/1.1/Sun Aug 11 19:24:44 2002//Tv1_7_3
-/TextAreaTableCellEditor.java/1.2/Wed Aug 14 02:52:18 2002//Tv1_7_3
-/VerticalLayout.java/1.1/Sun Aug 11 19:24:44 2002//Tv1_7_3
+/ButtonPanel.java/1.1/Sun Aug 11 19:24:44 2002//Tv1_8_1
+/FileDialoger.java/1.2/Sat Aug 24 16:51:13 2002//Tv1_8_1
+/FilePanel.java/1.2/Fri Aug 30 15:51:21 2002//Tv1_8_1
+/FocusRequester.java/1.3/Thu Aug 29 18:17:39 2002//Tv1_8_1
+/JLabeledTextField.java_old/1.1/Sun Aug 11 19:24:44 2002//Tv1_8_1
+/JMeterColor.java/1.2/Fri Aug 30 14:43:20 2002//Tv1_8_1
+/JMeterMenuBar.java/1.8/Mon Dec 30 05:08:28 2002//Tv1_8_1
+/MenuFactory.java/1.11/Fri Dec 27 15:51:17 2002//Tv1_8_1
+/MenuInfo.java/1.1/Sun Aug 11 19:24:44 2002//Tv1_8_1
+/NumberFieldErrorListener.java/1.1/Sun Aug 11 19:24:44 2002//Tv1_8_1
+/PowerTableModel.java/1.6/Thu Oct 17 19:47:16 2002//Tv1_8_1
+/TextAreaCellRenderer.java/1.1/Sun Aug 11 19:24:44 2002//Tv1_8_1
+/TextAreaTableCellEditor.java/1.2/Wed Aug 14 02:52:18 2002//Tv1_8_1
 D
diff --git a/jakarta-jmeter/src/core/org/apache/jmeter/gui/util/CVS/Tag b/jakarta-jmeter/src/core/org/apache/jmeter/gui/util/CVS/Tag
index 5f312fe..e2fda28 100644
--- a/jakarta-jmeter/src/core/org/apache/jmeter/gui/util/CVS/Tag
+++ b/jakarta-jmeter/src/core/org/apache/jmeter/gui/util/CVS/Tag
@@ -1 +1 @@
-Nv1_7_3
+Nv1_8_1
diff --git a/jakarta-jmeter/src/core/org/apache/jmeter/gui/util/FileDialoger.java b/jakarta-jmeter/src/core/org/apache/jmeter/gui/util/FileDialoger.java
index 131b9f3..54869c7 100644
--- a/jakarta-jmeter/src/core/org/apache/jmeter/gui/util/FileDialoger.java
+++ b/jakarta-jmeter/src/core/org/apache/jmeter/gui/util/FileDialoger.java
@@ -52,8 +52,11 @@
  * information on the Apache Software Foundation, please see
  * <http://www.apache.org/>.
  */package org.apache.jmeter.gui.util;
-import java.io.*;
-import javax.swing.*;
+import java.io.File;
+
+import javax.swing.JFileChooser;
+import javax.swing.filechooser.FileFilter;
+
 import org.apache.jmeter.gui.GuiPackage;
 import org.apache.jmeter.gui.JMeterFileFilter;
 import org.apache.jmeter.util.JMeterUtils;
@@ -62,7 +65,7 @@ import org.apache.jmeter.util.JMeterUtils;
  * Title: JMeter Description: Copyright: Copyright (c) 2000 Company: Apache
  *
  *@author    Michael Stover
- *@created   $Date: 2002/08/11 19:24:44 $
+ *@created   $Date: 2002/08/24 16:51:13 $
  *@version   1.0
  ***************************************/
 
@@ -72,6 +75,7 @@ public class FileDialoger
 	 * The last directory visited by the user while choosing Files.
 	 ***************************************/
 	public static String lastJFCDirectory = null;
+	public static JFileChooser jfc = new JFileChooser();
 
 	/****************************************
 	 * !ToDo (Constructor description)
@@ -91,7 +95,7 @@ public class FileDialoger
 	 ***************************************/
 	public static JFileChooser promptToOpenFile(String[] exts)
 	{
-		JFileChooser jfc = null;
+		//JFileChooser jfc = null;
 
 		if(lastJFCDirectory == null)
 		{
@@ -99,18 +103,10 @@ public class FileDialoger
 
 			if(!start.equals(""))
 			{
-				jfc = new JFileChooser(start);
-			}
-			else
-			{
-				jfc = new JFileChooser();
+				jfc.setCurrentDirectory(new File(start));
 			}
 		}
-		else
-		{
-			jfc = new JFileChooser(lastJFCDirectory);
-		}
-
+		clearFileFilters();
 		jfc.addChoosableFileFilter(new JMeterFileFilter(exts));
 		int retVal = jfc.showOpenDialog(GuiPackage.getInstance().getMainFrame());
 		lastJFCDirectory = jfc.getCurrentDirectory().getAbsolutePath();
@@ -124,6 +120,15 @@ public class FileDialoger
 			return null;
 		}
 	}
+
+	private static void clearFileFilters()
+	{
+		FileFilter[] filters = jfc.getChoosableFileFilters();
+		for(int x = 0;x < filters.length;x++)
+		{
+			jfc.removeChoosableFileFilter(filters[x]);
+		}
+	}
 	
 	public static JFileChooser promptToOpenFile()
 	{
@@ -145,22 +150,14 @@ public class FileDialoger
 	 ***************************************/
 	public static JFileChooser promptToSaveFile(String filename)
 	{
-		JFileChooser jfc = null;
 		if(lastJFCDirectory == null)
 		{
 			String start = JMeterUtils.getPropDefault("user.dir", "");
 			if(!start.equals(""))
 			{
-				jfc = new JFileChooser(start);
+				jfc = new JFileChooser(new File(start));
 			}
-			else
-			{
-				jfc = new JFileChooser();
-			}
-		}
-		else
-		{
-			jfc = new JFileChooser(lastJFCDirectory);
+			lastJFCDirectory = jfc.getCurrentDirectory().getAbsolutePath();
 		}
 		String ext = ".jmx";
 		if(filename != null)
@@ -172,7 +169,7 @@ public class FileDialoger
 				ext = filename.substring(i);
 			}
 		}		
-		
+		clearFileFilters();
 		jfc.addChoosableFileFilter(new JMeterFileFilter(new String[]{ext}));
 
 
diff --git a/jakarta-jmeter/src/core/org/apache/jmeter/gui/util/FilePanel.java b/jakarta-jmeter/src/core/org/apache/jmeter/gui/util/FilePanel.java
index b2a61d0..803e18e 100644
--- a/jakarta-jmeter/src/core/org/apache/jmeter/gui/util/FilePanel.java
+++ b/jakarta-jmeter/src/core/org/apache/jmeter/gui/util/FilePanel.java
@@ -52,11 +52,22 @@
  * information on the Apache Software Foundation, please see
  * <http://www.apache.org/>.
  */package org.apache.jmeter.gui.util;
-import javax.swing.*;
+import java.awt.FlowLayout;
 import java.awt.event.ActionEvent;
 import java.awt.event.ActionListener;
-import java.util.*;
-import javax.swing.event.*;
+import java.util.Iterator;
+import java.util.LinkedList;
+import java.util.List;
+
+import javax.swing.BorderFactory;
+import javax.swing.JButton;
+import javax.swing.JFileChooser;
+import javax.swing.JLabel;
+import javax.swing.JPanel;
+import javax.swing.JTextField;
+import javax.swing.event.ChangeEvent;
+import javax.swing.event.ChangeListener;
+
 import org.apache.jmeter.util.JMeterUtils;
 
 /**
@@ -71,24 +82,33 @@ import org.apache.jmeter.util.JMeterUtils;
 public class FilePanel extends JPanel implements ActionListener
 {
 
-	JTextField filename = new JTextField(30);
+	JTextField filename = new JTextField(20);
 	JLabel label = new JLabel(JMeterUtils.getResString("file_visualizer_filename"));
 	JButton browse = new JButton(JMeterUtils.getResString("browse"));
 	List listeners = new LinkedList();
+	String title;
 	
 	/**
 	 *  Constructor for the FilePanel object
 	 */
 	public FilePanel()
 	{
+		title = "";
+		init();
+	}
+	
+	public FilePanel(String title)
+	{
+		this.title = title;
 		init();
 	}
 
 	/**
 	 *  Constructor for the FilePanel object
 	 */
-	public FilePanel(ChangeListener l)
+	public FilePanel(ChangeListener l,String title)
 	{
+		this.title = title;
 		init();
 		listeners.add(l);
 	}
@@ -103,6 +123,8 @@ public class FilePanel extends JPanel implements ActionListener
 	 */
 	private void init()
 	{
+		this.setLayout(new FlowLayout(FlowLayout.LEFT));
+		setBorder(BorderFactory.createTitledBorder(title));
 		add(label);
 		add(filename);
 		filename.addActionListener(this);
diff --git a/jakarta-jmeter/src/core/org/apache/jmeter/gui/util/FocusRequester.java b/jakarta-jmeter/src/core/org/apache/jmeter/gui/util/FocusRequester.java
index e025d95..400cae1 100644
--- a/jakarta-jmeter/src/core/org/apache/jmeter/gui/util/FocusRequester.java
+++ b/jakarta-jmeter/src/core/org/apache/jmeter/gui/util/FocusRequester.java
@@ -1,8 +1,10 @@
 package org.apache.jmeter.gui.util;
-import java.awt.*;
-import java.awt.event.*;
-import java.util.*;
-import javax.swing.*;
+import java.awt.Component;
+
+import javax.swing.SwingUtilities;
+
+import org.apache.log.Hierarchy;
+import org.apache.log.Logger;
 
 /****************************************
  * Title: JMeter Description: Copyright: Copyright (c) 2000 Company: Apache
@@ -16,6 +18,8 @@ import javax.swing.*;
 
 public class FocusRequester implements Runnable
 {
+	transient private static Logger log = Hierarchy.getDefaultHierarchy().getLoggerFor(
+			"jmeter.gui");
 	private Component comp;
 
 	/****************************************
@@ -32,7 +36,7 @@ public class FocusRequester implements Runnable
 		}
 		catch(Exception e)
 		{
-			e.printStackTrace();
+			log.error("",e);
 		}
 	}
 
diff --git a/jakarta-jmeter/src/core/org/apache/jmeter/gui/util/JMeterColor.java b/jakarta-jmeter/src/core/org/apache/jmeter/gui/util/JMeterColor.java
index 4592ccf..923b129 100644
--- a/jakarta-jmeter/src/core/org/apache/jmeter/gui/util/JMeterColor.java
+++ b/jakarta-jmeter/src/core/org/apache/jmeter/gui/util/JMeterColor.java
@@ -72,5 +72,10 @@ public class JMeterColor extends Color {
 	{
 		super(r,g,b);
 	}
+	
+	public JMeterColor()
+	{
+		super(0,0,0);
+	}
 
 }
diff --git a/jakarta-jmeter/src/core/org/apache/jmeter/gui/util/JMeterMenuBar.java b/jakarta-jmeter/src/core/org/apache/jmeter/gui/util/JMeterMenuBar.java
index a22ee79..bb77af6 100644
--- a/jakarta-jmeter/src/core/org/apache/jmeter/gui/util/JMeterMenuBar.java
+++ b/jakarta-jmeter/src/core/org/apache/jmeter/gui/util/JMeterMenuBar.java
@@ -51,7 +51,8 @@
  * individuals on behalf of the Apache Software Foundation.  For more
  * information on the Apache Software Foundation, please see
  * <http://www.apache.org/>.
- */package org.apache.jmeter.gui.util;
+ */
+package org.apache.jmeter.gui.util;
 import java.awt.Component;
 import java.awt.event.KeyEvent;
 import java.util.Collection;
@@ -59,27 +60,35 @@ import java.util.Iterator;
 import java.util.LinkedList;
 
 import javax.swing.JMenu;
+import javax.swing.MenuElement;
 import javax.swing.JMenuBar;
 import javax.swing.JMenuItem;
 import javax.swing.JPopupMenu;
 import javax.swing.KeyStroke;
-import javax.swing.MenuElement;
 import javax.swing.UIManager;
+
 import org.apache.jmeter.gui.action.ActionRouter;
+import org.apache.jmeter.gui.action.ChangeLanguage;
 import org.apache.jmeter.util.JMeterUtils;
+import org.apache.jmeter.util.LocaleChangeEvent;
+import org.apache.jmeter.util.LocaleChangeListener;
 import org.apache.jmeter.util.SSLManager;
+import org.apache.log.Hierarchy;
+import org.apache.log.Logger;
+import org.apache.jorphan.util.JOrphanUtils;
 
 /****************************************
  * Title: Apache JMeter Description: Copyright: Copyright (c) 2000 Company:
  * Apache Foundation
  *
  *@author    Michael Stover
- *@created   $Date: 2002/08/11 19:24:44 $
+ *@created   $Date: 2002/12/30 05:08:28 $
  *@version   1.0
  ***************************************/
-
-public class JMeterMenuBar extends JMenuBar
+public class JMeterMenuBar extends JMenuBar implements LocaleChangeListener
 {
+	transient private static Logger log =
+		Hierarchy.getDefaultHierarchy().getLoggerFor("jmeter.gui");
 	JMenu fileMenu;
 	JMenuItem file_save_all;
 	JMenuItem file_load;
@@ -105,9 +114,7 @@ public class JMeterMenuBar extends JMenuBar
 	JMenuItem sslManager;
 	JMenu helpMenu;
 	JMenuItem help_about;
-
 	String[] remoteHosts;
-
 	/****************************************
 	 * !ToDo (Constructor description)
 	 ***************************************/
@@ -115,17 +122,15 @@ public class JMeterMenuBar extends JMenuBar
 	{
 		remote_engine_start = new LinkedList();
 		remote_engine_stop = new LinkedList();
-		remoteHosts = JMeterUtils.split(
-				JMeterUtils.getPropDefault("remote_hosts", ""), ",");
-		if(remoteHosts.length == 1 && remoteHosts[0].equals(""))
+		remoteHosts =
+			JOrphanUtils.split(JMeterUtils.getPropDefault("remote_hosts", ""), ",");
+		if (remoteHosts.length == 1 && remoteHosts[0].equals(""))
 		{
 			remoteHosts = new String[0];
 		}
 		this.getRemoteItems();
-
 		createMenuBar();
 	}
-
 	/****************************************
 	 * !ToDo (Method description)
 	 *
@@ -135,7 +140,6 @@ public class JMeterMenuBar extends JMenuBar
 	{
 		file_save_all.setEnabled(enabled);
 	}
-
 	/****************************************
 	 * !ToDo (Method description)
 	 *
@@ -143,12 +147,11 @@ public class JMeterMenuBar extends JMenuBar
 	 ***************************************/
 	public void setFileLoadEnabled(boolean enabled)
 	{
-		if(file_load != null)
+		if (file_load != null)
 		{
 			file_load.setEnabled(enabled);
 		}
 	}
-
 	/****************************************
 	 * !ToDo (Method description)
 	 *
@@ -156,12 +159,11 @@ public class JMeterMenuBar extends JMenuBar
 	 ***************************************/
 	public void setEditEnabled(boolean enabled)
 	{
-		if(editMenu != null)
+		if (editMenu != null)
 		{
 			editMenu.setEnabled(enabled);
 		}
 	}
-
 	/****************************************
 	 * !ToDo (Method description)
 	 *
@@ -170,23 +172,21 @@ public class JMeterMenuBar extends JMenuBar
 	public void setEditAddMenu(JMenu menu)
 	{
 		// If the Add menu already exists, remove it.
-		if(edit_add != null)
+		if (edit_add != null)
 		{
 			editMenu.remove(edit_add);
 		}
-
 		// Insert the Add menu as the first menu item in the Edit menu.
 		edit_add = menu;
 		editMenu.insert(edit_add, 0);
 	}
-
 	public void setEditMenu(JPopupMenu menu)
 	{
-		if(menu != null)
+		if (menu != null)
 		{
 			editMenu.removeAll();
 			Component[] comps = menu.getComponents();
-			for(int i = 0;i < comps.length;i++)
+			for (int i = 0; i < comps.length; i++)
 			{
 				editMenu.add(comps[i]);
 			}
@@ -197,7 +197,6 @@ public class JMeterMenuBar extends JMenuBar
 			editMenu.setEnabled(false);
 		}
 	}
-
 	/****************************************
 	 * !ToDo (Method description)
 	 *
@@ -206,15 +205,14 @@ public class JMeterMenuBar extends JMenuBar
 	public void setEditAddEnabled(boolean enabled)
 	{
 		// There was a NPE being thrown without the null check here.. JKB
-		if(edit_add != null)
+		if (edit_add != null)
 		{
 			edit_add.setEnabled(enabled);
 		}
-
 		// If we are enabling the Edit-->Add menu item, then we also need to
 		// enable the Edit menu. The Edit menu may already be enabled, but
 		// there's no harm it trying to enable it again.
-		if(enabled)
+		if (enabled)
 		{
 			setEditEnabled(true);
 		}
@@ -224,13 +222,12 @@ public class JMeterMenuBar extends JMenuBar
 			// menu item is disabled, then we also need to disable the Edit menu.
 			// The Java Look and Feel Guidelines say to disable a menu if all
 			// menu items are disabled.
-			if(!edit_remove.isEnabled())
+			if (!edit_remove.isEnabled())
 			{
 				editMenu.setEnabled(false);
 			}
 		}
 	}
-
 	/****************************************
 	 * !ToDo (Method description)
 	 *
@@ -239,11 +236,10 @@ public class JMeterMenuBar extends JMenuBar
 	public void setEditRemoveEnabled(boolean enabled)
 	{
 		edit_remove.setEnabled(enabled);
-
 		// If we are enabling the Edit-->Remove menu item, then we also need to
 		// enable the Edit menu. The Edit menu may already be enabled, but
 		// there's no harm it trying to enable it again.
-		if(enabled)
+		if (enabled)
 		{
 			setEditEnabled(true);
 		}
@@ -253,70 +249,123 @@ public class JMeterMenuBar extends JMenuBar
 			// menu item is disabled, then we also need to disable the Edit menu.
 			// The Java Look and Feel Guidelines say to disable a menu if all
 			// menu items are disabled.
-			if(!edit_add.isEnabled())
+			if (!edit_add.isEnabled())
 			{
 				editMenu.setEnabled(false);
 			}
 		}
 	}
-
 	/****************************************
 	 * Creates the MenuBar for this application. I believe in my heart that this
 	 * should be defined in a file somewhere, but that is for later.
 	 ***************************************/
 	public void createMenuBar()
 	{
-		// FILE MENU
-		fileMenu = new JMenu(JMeterUtils.getResString("file"));
-		fileMenu.setMnemonic('F');
-
-		file_save_all = new JMenuItem(JMeterUtils.getResString("save_all"), 'A');
-		file_save_all.setAccelerator(KeyStroke.getKeyStroke(KeyEvent.VK_A, KeyEvent.CTRL_MASK));
-		file_save_all.setActionCommand("save_all");
-		file_save_all.addActionListener(ActionRouter.getInstance());
-		// Currently, SAVE ALL is not implemented. It actually generates
-		// a nasty exception when selected. Therefore, for now, always
-		// make the SAVE ALL menu item disabled.
-		file_save_all.setEnabled(true);
-
-		file_load = new JMenuItem(JMeterUtils.getResString("open"), 'O');
-		file_load.setAccelerator(KeyStroke.getKeyStroke(KeyEvent.VK_O, KeyEvent.CTRL_MASK));
-		file_load.addActionListener(ActionRouter.getInstance());
-
-		// Set default SAVE menu item to disabled since the default node that is selected
-		// is ROOT, which does not allow items to be inserted.
-		file_load.setEnabled(false);
-		
-		file_new = new JMenuItem(JMeterUtils.getResString("new"), 'N');
-		file_new.setAccelerator(KeyStroke.getKeyStroke(KeyEvent.VK_N, KeyEvent.CTRL_MASK));
-		file_new.setActionCommand("new");
-		file_new.addActionListener(ActionRouter.getInstance());
-
-		file_exit = new JMenuItem(JMeterUtils.getResString("exit"), 'X');
-		file_exit.setAccelerator(KeyStroke.getKeyStroke(KeyEvent.VK_Q, KeyEvent.CTRL_MASK));
-		file_exit.setActionCommand("exit");
-		file_exit.addActionListener(ActionRouter.getInstance());
-		fileMenu.add(file_new);
-		fileMenu.add(file_load);
-		fileMenu.add(file_save_all);
-		fileMenu.addSeparator();
-		fileMenu.add(file_exit);
-
-		// EDIT MENU
-		editMenu = new JMenu(JMeterUtils.getResString("edit"));
-		// From the Java Look and Feel Guidelines: If all items in a menu
-		// are disabled, then disable the menu.  Makes sense.
-		editMenu.setEnabled(false);
-
+		createFileMenu();
+		makeEditMenu();
+		makeRunMenu();
+		makeOptionsMenu();
+		makeHelpMenu();
+		this.add(fileMenu);
+		this.add(editMenu);
+		this.add(runMenu);
+		this.add(optionsMenu);
+		this.add(helpMenu);
+	}
+	private void makeHelpMenu()
+	{
+		// HELP MENU
+		helpMenu = new JMenu(JMeterUtils.getResString("help"));
+		helpMenu.setMnemonic('H');
+		JMenuItem contextHelp = new JMenuItem(JMeterUtils.getResString("help"),'H');
+		contextHelp.setActionCommand("help");
+		contextHelp.setAccelerator(KeyStroke.getKeyStroke(KeyEvent.VK_H,KeyEvent.CTRL_MASK));
+		contextHelp.addActionListener(ActionRouter.getInstance());
+		help_about = new JMenuItem(JMeterUtils.getResString("about"), 'A');
+		help_about.setActionCommand("about");
+		help_about.addActionListener(ActionRouter.getInstance());
+		helpMenu.add(contextHelp);
+		helpMenu.add(help_about);
+	}
+	private void makeOptionsMenu()
+	{
+		// OPTIONS MENU
+		optionsMenu = new JMenu(JMeterUtils.getResString("option"));
+		JMenuItem functionHelper =
+			new JMenuItem(JMeterUtils.getResString("function_dialog_menu_item"), 'F');
+		functionHelper.addActionListener(ActionRouter.getInstance());
+		functionHelper.setActionCommand("functions");
+		functionHelper.setAccelerator(
+			KeyStroke.getKeyStroke(KeyEvent.VK_F, KeyEvent.CTRL_MASK));
+		lafMenu = new JMenu(JMeterUtils.getResString("appearance"));
+		UIManager.LookAndFeelInfo lafs[] = UIManager.getInstalledLookAndFeels();
+		for (int i = 0; i < lafs.length; ++i)
+		{
+			JMenuItem laf = new JMenuItem(lafs[i].getName());
+			laf.addActionListener(ActionRouter.getInstance());
+			laf.setActionCommand("laf:" + lafs[i].getClassName());
+			lafMenu.setMnemonic('L');
+			lafMenu.add(laf);
+		}
+		optionsMenu.setMnemonic('O');
+		optionsMenu.add(functionHelper);
+		optionsMenu.add(lafMenu);
+		if (SSLManager.isSSLSupported())
+		{
+			sslManager = new JMenuItem(JMeterUtils.getResString("sslManager"));
+			sslManager.addActionListener(ActionRouter.getInstance());
+			sslManager.setActionCommand("sslManager");
+			sslManager.setMnemonic('S');
+			sslManager.setAccelerator(
+				KeyStroke.getKeyStroke(KeyEvent.VK_M, KeyEvent.CTRL_MASK));
+			optionsMenu.add(sslManager);
+		}
+		optionsMenu.add(makeLanguageMenu());
+	}
+	private JMenu makeLanguageMenu()
+	{
+		JMenu languageMenu = new JMenu(JMeterUtils.getResString("choose_language"));
+		languageMenu.setMnemonic('C');
+		//add english
+		JMenuItem english = new JMenuItem(JMeterUtils.getResString("en"),'E');
+		english.addActionListener(ActionRouter.getInstance());
+		english.setActionCommand(ChangeLanguage.CHANGE_LANGUAGE);
+		english.setName("en");
+		languageMenu.add(english);
+		//add Japanese
+		JMenuItem japanese = new JMenuItem(JMeterUtils.getResString("jp"),'J');
+		japanese.addActionListener(ActionRouter.getInstance());
+		japanese.setActionCommand(ChangeLanguage.CHANGE_LANGUAGE);
+		japanese.setName("ja");
+		languageMenu.add(japanese);
+		//add Norwegian
+		JMenuItem norway = new JMenuItem(JMeterUtils.getResString("no"),'N');
+		norway.addActionListener(ActionRouter.getInstance());
+		norway.setActionCommand(ChangeLanguage.CHANGE_LANGUAGE);
+		norway.setName("no");
+		languageMenu.add(norway);
+		//add German
+		JMenuItem german = new JMenuItem(JMeterUtils.getResString("de"),'G');
+		german.addActionListener(ActionRouter.getInstance());
+		german.setActionCommand(ChangeLanguage.CHANGE_LANGUAGE);
+		german.setName("de");
+		languageMenu.add(german);
+		return languageMenu;
+	}
+	
+	private void makeRunMenu()
+	{
 		// RUN MENU
 		runMenu = new JMenu(JMeterUtils.getResString("run"));
 		runMenu.setMnemonic('R');
 		run_start = new JMenuItem(JMeterUtils.getResString("start"), 'S');
-		run_start.setAccelerator(KeyStroke.getKeyStroke(KeyEvent.VK_R, KeyEvent.CTRL_MASK));
+		run_start.setAccelerator(
+			KeyStroke.getKeyStroke(KeyEvent.VK_R, KeyEvent.CTRL_MASK));
 		run_start.addActionListener(ActionRouter.getInstance());
 		run_start.setActionCommand("start");
 		run_stop = new JMenuItem(JMeterUtils.getResString("stop"), 'T');
-		run_stop.setAccelerator(KeyStroke.getKeyStroke(KeyEvent.VK_PERIOD, KeyEvent.CTRL_MASK));
+		run_stop.setAccelerator(
+			KeyStroke.getKeyStroke(KeyEvent.VK_PERIOD, KeyEvent.CTRL_MASK));
 		run_stop.setEnabled(false);
 		run_stop.addActionListener(ActionRouter.getInstance());
 		run_stop.setActionCommand("stop");
@@ -327,67 +376,70 @@ public class JMeterMenuBar extends JMenuBar
 		run_clearAll.addActionListener(ActionRouter.getInstance());
 		run_clearAll.setActionCommand(org.apache.jmeter.gui.action.Clear.CLEAR_ALL);
 		runMenu.add(run_start);
-		if(remote_start != null)
+		if (remote_start != null)
 		{
 			runMenu.add(remote_start);
 		}
 		runMenu.add(run_stop);
-		if(remote_stop != null)
+		if (remote_stop != null)
 		{
 			runMenu.add(remote_stop);
 		}
-
 		runMenu.addSeparator();
-
 		runMenu.add(run_clear);
 		runMenu.add(run_clearAll);
-
-		// OPTIONS MENU
-		optionsMenu = new JMenu(JMeterUtils.getResString("option"));
-		JMenuItem functionHelper = new JMenuItem(JMeterUtils.getResString(
-				"function_dialog_menu_item"),'F');
-		functionHelper.addActionListener(ActionRouter.getInstance());
-		functionHelper.setActionCommand("functions");
-		functionHelper.setAccelerator(KeyStroke.getKeyStroke(KeyEvent.VK_F,
-				KeyEvent.CTRL_MASK));
-		lafMenu = new JMenu(JMeterUtils.getResString("appearance"));
-		UIManager.LookAndFeelInfo lafs[] = UIManager.getInstalledLookAndFeels();
-		for(int i = 0; i < lafs.length; ++i)
-		{
-			JMenuItem laf = new JMenuItem(lafs[i].getName());
-			laf.addActionListener(ActionRouter.getInstance());
-			laf.setActionCommand("laf:" + lafs[i].getClassName());
-			lafMenu.setMnemonic('L');
-			lafMenu.add(laf);
-		}
-		optionsMenu.setMnemonic('O');
-		optionsMenu.add(functionHelper);
-		optionsMenu.add(lafMenu);
-		if(SSLManager.isSSLSupported())
-		{
-			sslManager = new JMenuItem(JMeterUtils.getResString("sslManager"));
-			sslManager.addActionListener(ActionRouter.getInstance());
-			sslManager.setActionCommand("sslManager");
-			sslManager.setMnemonic('S');
-			sslManager.setAccelerator(KeyStroke.getKeyStroke(KeyEvent.VK_M, KeyEvent.CTRL_MASK));
-			optionsMenu.add(sslManager);
-		}
-
-		// HELP MENU
-		helpMenu = new JMenu(JMeterUtils.getResString("help"));
-		helpMenu.setMnemonic('H');
-		help_about = new JMenuItem(JMeterUtils.getResString("about"), 'A');
-		help_about.setActionCommand("about");
-		help_about.addActionListener(ActionRouter.getInstance());
-		helpMenu.add(help_about);
-
-		this.add(fileMenu);
-		this.add(editMenu);
-		this.add(runMenu);
-		this.add(optionsMenu);
-		this.add(helpMenu);
 	}
-
+	private void makeEditMenu()
+	{
+		// EDIT MENU
+		editMenu = new JMenu(JMeterUtils.getResString("edit"));
+		// From the Java Look and Feel Guidelines: If all items in a menu
+		// are disabled, then disable the menu.  Makes sense.
+		editMenu.setEnabled(false);
+	}
+	private void createFileMenu()
+	{
+		// FILE MENU
+		fileMenu = new JMenu(JMeterUtils.getResString("file"));
+		fileMenu.setMnemonic('F');
+		JMenuItem file_save = new JMenuItem(JMeterUtils.getResString("save_all"), 'S');
+		file_save.setAccelerator(
+			KeyStroke.getKeyStroke(KeyEvent.VK_S, KeyEvent.CTRL_MASK));
+		file_save.setActionCommand("save");
+		file_save.addActionListener(ActionRouter.getInstance());
+		file_save.setEnabled(true);
+		
+		file_save_all = new JMenuItem(JMeterUtils.getResString("save_all_as"), 'A');
+		file_save_all.setAccelerator(
+			KeyStroke.getKeyStroke(KeyEvent.VK_A, KeyEvent.CTRL_MASK));
+		file_save_all.setActionCommand("save_all");
+		file_save_all.addActionListener(ActionRouter.getInstance());
+		file_save_all.setEnabled(true);
+		file_load = new JMenuItem(JMeterUtils.getResString("open"), 'O');
+		file_load.setAccelerator(
+			KeyStroke.getKeyStroke(KeyEvent.VK_O, KeyEvent.CTRL_MASK));
+		file_load.addActionListener(ActionRouter.getInstance());
+		// Set default SAVE menu item to disabled since the default node that is selected
+		// is ROOT, which does not allow items to be inserted.
+		file_load.setEnabled(false);
+		file_load.setActionCommand("open");
+		file_new = new JMenuItem(JMeterUtils.getResString("new"), 'N');
+		file_new.setAccelerator(
+			KeyStroke.getKeyStroke(KeyEvent.VK_N, KeyEvent.CTRL_MASK));
+		file_new.setActionCommand("new");
+		file_new.addActionListener(ActionRouter.getInstance());
+		file_exit = new JMenuItem(JMeterUtils.getResString("exit"), 'X');
+		file_exit.setAccelerator(
+			KeyStroke.getKeyStroke(KeyEvent.VK_Q, KeyEvent.CTRL_MASK));
+		file_exit.setActionCommand("exit");
+		file_exit.addActionListener(ActionRouter.getInstance());
+		fileMenu.add(file_new);
+		fileMenu.add(file_load);
+		fileMenu.add(file_save);
+		fileMenu.add(file_save_all);
+		fileMenu.addSeparator();
+		fileMenu.add(file_exit);
+	}
 	/****************************************
 	 * !ToDo (Method description)
 	 *
@@ -398,23 +450,21 @@ public class JMeterMenuBar extends JMenuBar
 	{
 		Iterator iter = remote_engine_start.iterator();
 		Iterator iter2 = remote_engine_stop.iterator();
-		while(iter.hasNext() && iter2.hasNext())
+		while (iter.hasNext() && iter2.hasNext())
 		{
-			JMenuItem start = (JMenuItem)iter.next();
-			JMenuItem stop = (JMenuItem)iter2.next();
-			System.out.println("host = "+host+" start = "+start.getText());
-			if(start.getText().equals(host))
+			JMenuItem start = (JMenuItem) iter.next();
+			JMenuItem stop = (JMenuItem) iter2.next();
+			log.info("host = " + host + " start = " + start.getText());
+			if (start.getText().equals(host))
 			{
 				start.setEnabled(!running);
 			}
-			if(stop.getText().equals(host))
+			if (stop.getText().equals(host))
 			{
 				stop.setEnabled(running);
 			}
 		}
 	}
-
-
 	/****************************************
 	 * !ToDo (Method description)
 	 *
@@ -425,14 +475,13 @@ public class JMeterMenuBar extends JMenuBar
 		run_start.setEnabled(!enable);
 		run_stop.setEnabled(enable);
 	}
-
 	private void getRemoteItems()
 	{
-		if(remoteHosts.length > 0)
+		if (remoteHosts.length > 0)
 		{
 			remote_start = new JMenu(JMeterUtils.getResString("remote_start"));
 			remote_stop = new JMenu(JMeterUtils.getResString("remote_stop"));
-			for(int i = 0; i < remoteHosts.length; i++)
+			for (int i = 0; i < remoteHosts.length; i++)
 			{
 				JMenuItem item = new JMenuItem(remoteHosts[i]);
 				item.setActionCommand("remote_start");
@@ -440,7 +489,6 @@ public class JMeterMenuBar extends JMenuBar
 				item.addActionListener(ActionRouter.getInstance());
 				remote_engine_start.add(item);
 				remote_start.add(item);
-
 				item = new JMenuItem(remoteHosts[i]);
 				item.setActionCommand("remote_stop");
 				item.setName(remoteHosts[i]);
@@ -451,4 +499,44 @@ public class JMeterMenuBar extends JMenuBar
 			}
 		}
 	}
+
+	/**
+	 * Processes a locale change notification. Changes the texts in all
+	 * menus to the new language.
+	 */
+        public void localeChanged(LocaleChangeEvent event) {
+            updateMenuElement(fileMenu);
+            updateMenuElement(editMenu);
+            updateMenuElement(runMenu);
+            updateMenuElement(optionsMenu);
+            updateMenuElement(helpMenu);
+        }
+   
+   
+	/**
+	 * Refreshes all texts in the menu and all submenus to a new locale.
+	 */
+        private void updateMenuElement(MenuElement menu)
+	{
+            Component component = menu.getComponent();
+   
+            if (component.getName() != null)
+	    {
+                if (component instanceof JMenu)
+		{
+                    ((JMenu)component).setText(JMeterUtils.getResString(component.getName()));
+                }
+		else
+		{
+                    ((JMenuItem)component).setText(JMeterUtils.getResString(component.getName()));
+                }
+            }
+   
+            MenuElement[] subelements = menu.getSubElements();
+   
+            for (int i = 0; i < subelements.length; i++)
+	    {
+                updateMenuElement(subelements[i]);
+            }
+        }
 }
diff --git a/jakarta-jmeter/src/core/org/apache/jmeter/gui/util/MenuFactory.java b/jakarta-jmeter/src/core/org/apache/jmeter/gui/util/MenuFactory.java
index 6319b48..39309fb 100644
--- a/jakarta-jmeter/src/core/org/apache/jmeter/gui/util/MenuFactory.java
+++ b/jakarta-jmeter/src/core/org/apache/jmeter/gui/util/MenuFactory.java
@@ -52,29 +52,43 @@
  * information on the Apache Software Foundation, please see
  * <http://www.apache.org/>.
  */package org.apache.jmeter.gui.util;
-import java.util.*;
-import javax.swing.*;
+import java.util.Collection;
+import java.util.Collections;
+import java.util.HashMap;
+import java.util.HashSet;
+import java.util.Iterator;
+import java.util.LinkedList;
+import java.util.List;
+import java.util.Map;
+import java.util.Set;
+
+import javax.swing.JMenu;
+import javax.swing.JMenuItem;
+import javax.swing.JPopupMenu;
+import javax.swing.MenuElement;
+
+import org.apache.jmeter.gui.GuiPackage;
 import org.apache.jmeter.gui.JMeterGUIComponent;
 import org.apache.jmeter.gui.action.ActionRouter;
-import org.apache.jmeter.util.*;
-import org.apache.log4j.*;
+import org.apache.jmeter.util.JMeterUtils;
+import org.apache.log.Hierarchy;
+import org.apache.log.Logger;
+import org.apache.jorphan.reflect.ClassFinder;
+import org.apache.jorphan.util.JOrphanUtils;
 
 /****************************************
  * Title: JMeter Description: Copyright: Copyright (c) 2000 Company: Apache
  *
  *@author    Michael Stover
- *@created   $Date: 2002/08/11 19:24:44 $
+ *@created   $Date: 2002/12/27 15:51:17 $
  *@version   1.0
  ***************************************/
 
 public class MenuFactory
 {
-	/****************************************
-	 * !ToDo (Field description)
-	 ***************************************/
-	public static Category catClass =
-			Category.getInstance(MenuFactory.class.getName());
 
+	transient private static Logger log = Hierarchy.getDefaultHierarchy().getLoggerFor(
+			"jmeter.gui");
 	/****************************************
 	 * !ToDo (Field description)
 	 ***************************************/
@@ -129,7 +143,9 @@ public class MenuFactory
 	private static JMenu insertControllerMenu;
 	static
 	{
-		String[] classesToSkip = JMeterUtils.split(
+		try
+		{
+		String[] classesToSkip = JOrphanUtils.split(
 				JMeterUtils.getPropDefault("not_in_menu", ""), ",");
 		for(int i = 0; i < classesToSkip.length; i++)
 		{
@@ -137,6 +153,11 @@ public class MenuFactory
 		}
 
 		initializeMenus();
+		}
+		catch(Throwable e)
+		{
+			log.error("",e);
+		}
 	}
 
 
@@ -172,7 +193,7 @@ public class MenuFactory
 		addSeparator(menu);
 		if(removable)
 		{
-			menu.add(makeMenuItem(JMeterUtils.getResString("remove"), "Remove", JMeterUtils.getResString("remove")));
+			menu.add(makeMenuItem(JMeterUtils.getResString("remove"), "Remove","remove"));
 		}
 		menu.add(makeMenuItem(JMeterUtils.getResString("cut"), "Cut", "Cut"));
 		menu.add(makeMenuItem(JMeterUtils.getResString("copy"), "Copy", "Copy"));
@@ -188,8 +209,25 @@ public class MenuFactory
 	public static void addFileMenu(JPopupMenu menu)
 	{
 		addSeparator(menu);
-		menu.add(makeMenuItem(JMeterUtils.getResString("open"), "Open", JMeterUtils.getResString("open")));
-		menu.add(makeMenuItem(JMeterUtils.getResString("save"), "Save", "save"));
+		menu.add(makeMenuItem(JMeterUtils.getResString("open"), "Open", "open"));
+		menu.add(makeMenuItem(JMeterUtils.getResString("save"), "Save", "save_as"));
+		JMenuItem disabled = makeMenuItem(JMeterUtils.getResString("disable"),"Disable","disable");
+		JMenuItem enabled = makeMenuItem(JMeterUtils.getResString("enable"),"Enable","enable");
+		boolean isEnabled = GuiPackage.getInstance().getTreeListener().getCurrentNode().isEnabled();
+		if(isEnabled)
+		{
+			disabled.setEnabled(true);
+			enabled.setEnabled(false);
+		}
+		else
+		{
+			disabled.setEnabled(false);
+			enabled.setEnabled(true);
+		}
+		menu.add(enabled);
+		menu.add(disabled);
+		addSeparator(menu);
+		menu.add(makeMenuItem(JMeterUtils.getResString("help"),"Help","help"));
 	}
 
 	/****************************************
@@ -387,7 +425,9 @@ public class MenuFactory
 	{
 		try
 		{
-			List guiClasses = ClassFinder.findClassesThatExtend(new Class[]
+			List guiClasses = ClassFinder.findClassesThatExtend(
+					JMeterUtils.getSearchPaths(),
+					new Class[]
 					{JMeterGUIComponent.class});
 			timers = new LinkedList();
 			controllers = new LinkedList();
@@ -411,8 +451,16 @@ public class MenuFactory
 			Iterator iter = guiClasses.iterator();
 			while(iter.hasNext())
 			{
-				JMeterGUIComponent item = (JMeterGUIComponent)Class.forName(
+				JMeterGUIComponent item;
+				try
+				{
+					item = (JMeterGUIComponent)Class.forName(
 						(String)iter.next()).newInstance();
+				}
+				catch(Throwable e)
+				{
+					continue;
+				}
 				if(elementsToSkip.contains(item.getClass().getName()) ||
 						elementsToSkip.contains(item.getStaticLabel()))
 				{
@@ -480,7 +528,7 @@ public class MenuFactory
 		}
 		catch(Exception e)
 		{
-			e.printStackTrace();
+			log.error("",e);
 		}
 	}
 
diff --git a/jakarta-jmeter/src/core/org/apache/jmeter/gui/util/PowerTableModel.java b/jakarta-jmeter/src/core/org/apache/jmeter/gui/util/PowerTableModel.java
index ff1409c..729946d 100644
--- a/jakarta-jmeter/src/core/org/apache/jmeter/gui/util/PowerTableModel.java
+++ b/jakarta-jmeter/src/core/org/apache/jmeter/gui/util/PowerTableModel.java
@@ -1,9 +1,11 @@
 package org.apache.jmeter.gui.util;
 
 import java.lang.reflect.Constructor;
+import java.util.List;
 
 import javax.swing.table.DefaultTableModel;
-import org.apache.jmeter.util.Data;
+
+import org.apache.jorphan.collections.Data;
 /**
  * @author mstover
  *
@@ -18,6 +20,10 @@ public class PowerTableModel extends DefaultTableModel {
 		model.setHeaders(headers);
 		columnClasses = cc;
 	}
+	
+	public PowerTableModel()
+	{
+	}
 
 	public void setRowValues(int row, Object[] values) {
 		model.setCurrentPos(row);
@@ -29,6 +35,18 @@ public class PowerTableModel extends DefaultTableModel {
 	public Data getData() {
 		return model;
 	}
+	
+	public void addNewColumn(String colName,Class colClass)
+	{
+		model.addHeader(colName);
+		Class[] newClasses = new Class[columnClasses.length+1];
+		System.arraycopy(columnClasses,0,newClasses,0,columnClasses.length);
+		newClasses[newClasses.length-1] = colClass;
+		columnClasses = newClasses;
+		Object defaultValue = createDefaultValue(columnClasses.length-1);
+		model.setColumnData(colName,defaultValue);
+		this.fireTableStructureChanged();
+	}
 
 	/****************************************
 		 * Description of the Method
@@ -41,6 +59,23 @@ public class PowerTableModel extends DefaultTableModel {
 		}
 	}
 	
+	public void removeColumn(int col)
+	{
+		model.removeColumn(col);
+		this.fireTableStructureChanged();
+	}
+	
+	public void setColumnData(int col,List data)
+	{
+		model.setColumnData(col,data);
+	}
+	
+	
+	public List getColumnData(String colName)
+	{
+		return model.getColumnAsObjectArray(colName);
+	}
+	
 	public void clearData()
 	{
 		String[] headers = model.getHeaders();
diff --git a/jakarta-jmeter/src/core/org/apache/jmeter/images/CVS/Entries b/jakarta-jmeter/src/core/org/apache/jmeter/images/CVS/Entries
index 6301f71..b3d06aa 100644
--- a/jakarta-jmeter/src/core/org/apache/jmeter/images/CVS/Entries
+++ b/jakarta-jmeter/src/core/org/apache/jmeter/images/CVS/Entries
@@ -1,57 +1,60 @@
-/Delete24.down.gif/1.1/Sun Aug 11 19:24:45 2002/-kb/Tv1_7_3
-/Delete24.gif/1.1/Sun Aug 11 19:24:45 2002/-kb/Tv1_7_3
-/Delete24.off.gif/1.1/Sun Aug 11 19:24:45 2002/-kb/Tv1_7_3
-/Delete24.on.gif/1.1/Sun Aug 11 19:24:45 2002/-kb/Tv1_7_3
-/Delete24.over.gif/1.1/Sun Aug 11 19:24:45 2002/-kb/Tv1_7_3
-/Edit24.down.gif/1.1/Sun Aug 11 19:24:45 2002/-kb/Tv1_7_3
-/Edit24.gif/1.1/Sun Aug 11 19:24:45 2002/-kb/Tv1_7_3
-/Edit24.off.gif/1.1/Sun Aug 11 19:24:45 2002/-kb/Tv1_7_3
-/Edit24.on.gif/1.1/Sun Aug 11 19:24:45 2002/-kb/Tv1_7_3
-/Edit24.over.gif/1.1/Sun Aug 11 19:24:45 2002/-kb/Tv1_7_3
-/New24.down.gif/1.1/Sun Aug 11 19:24:45 2002/-kb/Tv1_7_3
-/New24.gif/1.1/Sun Aug 11 19:24:45 2002/-kb/Tv1_7_3
-/New24.off.gif/1.1/Sun Aug 11 19:24:45 2002/-kb/Tv1_7_3
-/New24.on.gif/1.1/Sun Aug 11 19:24:45 2002/-kb/Tv1_7_3
-/New24.over.gif/1.1/Sun Aug 11 19:24:45 2002/-kb/Tv1_7_3
-/Open24.down.gif/1.1/Sun Aug 11 19:24:45 2002/-kb/Tv1_7_3
-/Open24.gif/1.1/Sun Aug 11 19:24:45 2002/-kb/Tv1_7_3
-/Open24.off.gif/1.1/Sun Aug 11 19:24:45 2002/-kb/Tv1_7_3
-/Open24.on.gif/1.1/Sun Aug 11 19:24:45 2002/-kb/Tv1_7_3
-/Open24.over.gif/1.1/Sun Aug 11 19:24:45 2002/-kb/Tv1_7_3
-/SaveAll24.down.gif/1.1/Sun Aug 11 19:24:45 2002/-kb/Tv1_7_3
-/SaveAll24.gif/1.1/Sun Aug 11 19:24:45 2002/-kb/Tv1_7_3
-/SaveAll24.off.gif/1.1/Sun Aug 11 19:24:45 2002/-kb/Tv1_7_3
-/SaveAll24.on.gif/1.1/Sun Aug 11 19:24:45 2002/-kb/Tv1_7_3
-/SaveAll24.over.gif/1.1/Sun Aug 11 19:24:45 2002/-kb/Tv1_7_3
-/about.down.gif/1.1/Sun Aug 11 19:24:45 2002/-kb/Tv1_7_3
-/about.off.gif/1.1/Sun Aug 11 19:24:45 2002/-kb/Tv1_7_3
-/about.on.gif/1.1/Sun Aug 11 19:24:45 2002/-kb/Tv1_7_3
-/about.over.gif/1.1/Sun Aug 11 19:24:45 2002/-kb/Tv1_7_3
-/beaker.gif/1.1/Sun Aug 11 19:24:45 2002/-kb/Tv1_7_3
-/clear.down.gif/1.1/Sun Aug 11 19:24:45 2002/-kb/Tv1_7_3
-/clear.off.gif/1.1/Sun Aug 11 19:24:45 2002/-kb/Tv1_7_3
-/clear.on.gif/1.1/Sun Aug 11 19:24:45 2002/-kb/Tv1_7_3
-/clear.over.gif/1.1/Sun Aug 11 19:24:45 2002/-kb/Tv1_7_3
-/clipboard.gif/1.1/Sun Aug 11 19:24:45 2002/-kb/Tv1_7_3
-/ear.gif/1.1/Sun Aug 11 19:24:45 2002/-kb/Tv1_7_3
-/feather.gif/1.1/Sun Aug 11 19:24:45 2002/-kb/Tv1_7_3
-/jmeter.jpg/1.1/Sun Aug 11 19:24:45 2002/-kb/Tv1_7_3
-/knob.gif/1.1/Sun Aug 11 19:24:45 2002/-kb/Tv1_7_3
-/leafnode.gif/1.1/Sun Aug 11 19:24:45 2002/-kb/Tv1_7_3
-/smallthread.disabled.gif/1.1/Sun Aug 11 19:24:45 2002/-kb/Tv1_7_3
-/smallthread.enabled.gif/1.1/Sun Aug 11 19:24:45 2002/-kb/Tv1_7_3
-/smallthread.idle.gif/1.1/Sun Aug 11 19:24:45 2002/-kb/Tv1_7_3
-/start.down.gif/1.1/Sun Aug 11 19:24:45 2002/-kb/Tv1_7_3
-/start.off.gif/1.1/Sun Aug 11 19:24:45 2002/-kb/Tv1_7_3
-/start.on.gif/1.1/Sun Aug 11 19:24:45 2002/-kb/Tv1_7_3
-/start.over.gif/1.1/Sun Aug 11 19:24:45 2002/-kb/Tv1_7_3
-/stop.down.gif/1.1/Sun Aug 11 19:24:45 2002/-kb/Tv1_7_3
-/stop.off.gif/1.1/Sun Aug 11 19:24:45 2002/-kb/Tv1_7_3
-/stop.on.gif/1.1/Sun Aug 11 19:24:45 2002/-kb/Tv1_7_3
-/stop.over.gif/1.1/Sun Aug 11 19:24:45 2002/-kb/Tv1_7_3
-/thread.disabled.gif/1.1/Sun Aug 11 19:24:45 2002/-kb/Tv1_7_3
-/thread.enabled.gif/1.1/Sun Aug 11 19:24:45 2002/-kb/Tv1_7_3
-/thread.gif/1.1/Sun Aug 11 19:24:45 2002/-kb/Tv1_7_3
-/thread.idle.gif/1.1/Sun Aug 11 19:24:45 2002/-kb/Tv1_7_3
-/timer.gif/1.1/Sun Aug 11 19:24:45 2002/-kb/Tv1_7_3
+/Delete24.down.gif/1.1/Sun Aug 11 19:24:45 2002/-kb/Tv1_8_1
+/Delete24.gif/1.1/Sun Aug 11 19:24:45 2002/-kb/Tv1_8_1
+/Delete24.off.gif/1.1/Sun Aug 11 19:24:45 2002/-kb/Tv1_8_1
+/Delete24.on.gif/1.1/Sun Aug 11 19:24:45 2002/-kb/Tv1_8_1
+/Delete24.over.gif/1.1/Sun Aug 11 19:24:45 2002/-kb/Tv1_8_1
+/Edit24.down.gif/1.1/Sun Aug 11 19:24:45 2002/-kb/Tv1_8_1
+/Edit24.gif/1.1/Sun Aug 11 19:24:45 2002/-kb/Tv1_8_1
+/Edit24.off.gif/1.1/Sun Aug 11 19:24:45 2002/-kb/Tv1_8_1
+/Edit24.on.gif/1.1/Sun Aug 11 19:24:45 2002/-kb/Tv1_8_1
+/Edit24.over.gif/1.1/Sun Aug 11 19:24:45 2002/-kb/Tv1_8_1
+/New24.down.gif/1.1/Sun Aug 11 19:24:45 2002/-kb/Tv1_8_1
+/New24.gif/1.1/Sun Aug 11 19:24:45 2002/-kb/Tv1_8_1
+/New24.off.gif/1.1/Sun Aug 11 19:24:45 2002/-kb/Tv1_8_1
+/New24.on.gif/1.1/Sun Aug 11 19:24:45 2002/-kb/Tv1_8_1
+/New24.over.gif/1.1/Sun Aug 11 19:24:45 2002/-kb/Tv1_8_1
+/Open24.down.gif/1.1/Sun Aug 11 19:24:45 2002/-kb/Tv1_8_1
+/Open24.gif/1.1/Sun Aug 11 19:24:45 2002/-kb/Tv1_8_1
+/Open24.off.gif/1.1/Sun Aug 11 19:24:45 2002/-kb/Tv1_8_1
+/Open24.on.gif/1.1/Sun Aug 11 19:24:45 2002/-kb/Tv1_8_1
+/Open24.over.gif/1.1/Sun Aug 11 19:24:45 2002/-kb/Tv1_8_1
+/SaveAll24.down.gif/1.1/Sun Aug 11 19:24:45 2002/-kb/Tv1_8_1
+/SaveAll24.gif/1.1/Sun Aug 11 19:24:45 2002/-kb/Tv1_8_1
+/SaveAll24.off.gif/1.1/Sun Aug 11 19:24:45 2002/-kb/Tv1_8_1
+/SaveAll24.on.gif/1.1/Sun Aug 11 19:24:45 2002/-kb/Tv1_8_1
+/SaveAll24.over.gif/1.1/Sun Aug 11 19:24:45 2002/-kb/Tv1_8_1
+/about.down.gif/1.1/Sun Aug 11 19:24:45 2002/-kb/Tv1_8_1
+/about.off.gif/1.1/Sun Aug 11 19:24:45 2002/-kb/Tv1_8_1
+/about.on.gif/1.1/Sun Aug 11 19:24:45 2002/-kb/Tv1_8_1
+/about.over.gif/1.1/Sun Aug 11 19:24:45 2002/-kb/Tv1_8_1
+/beaker.gif/1.1/Sun Aug 11 19:24:45 2002/-kb/Tv1_8_1
+/clear.down.gif/1.1/Sun Aug 11 19:24:45 2002/-kb/Tv1_8_1
+/clear.off.gif/1.1/Sun Aug 11 19:24:45 2002/-kb/Tv1_8_1
+/clear.on.gif/1.1/Sun Aug 11 19:24:45 2002/-kb/Tv1_8_1
+/clear.over.gif/1.1/Sun Aug 11 19:24:45 2002/-kb/Tv1_8_1
+/clipboard.gif/1.1/Sun Aug 11 19:24:45 2002/-kb/Tv1_8_1
+/ear.gif/1.1/Sun Aug 11 19:24:45 2002/-kb/Tv1_8_1
+/feather.gif/1.1/Sun Aug 11 19:24:45 2002/-kb/Tv1_8_1
+/jmeter.jpg/1.1/Sun Aug 11 19:24:45 2002/-kb/Tv1_8_1
+/knob.gif/1.1/Sun Aug 11 19:24:45 2002/-kb/Tv1_8_1
+/leafnode.gif/1.1/Sun Aug 11 19:24:45 2002/-kb/Tv1_8_1
+/meter.png/1.1/Wed Jan 15 12:46:20 2003/-kb/Tv1_8_1
+/pipet.png/1.1/Wed Jan 15 12:46:20 2003/-kb/Tv1_8_1
+/smallthread.disabled.gif/1.1/Sun Aug 11 19:24:45 2002/-kb/Tv1_8_1
+/smallthread.enabled.gif/1.1/Sun Aug 11 19:24:45 2002/-kb/Tv1_8_1
+/smallthread.idle.gif/1.1/Sun Aug 11 19:24:45 2002/-kb/Tv1_8_1
+/start.down.gif/1.1/Sun Aug 11 19:24:45 2002/-kb/Tv1_8_1
+/start.off.gif/1.1/Sun Aug 11 19:24:45 2002/-kb/Tv1_8_1
+/start.on.gif/1.1/Sun Aug 11 19:24:45 2002/-kb/Tv1_8_1
+/start.over.gif/1.1/Sun Aug 11 19:24:45 2002/-kb/Tv1_8_1
+/stop.down.gif/1.1/Sun Aug 11 19:24:45 2002/-kb/Tv1_8_1
+/stop.off.gif/1.1/Sun Aug 11 19:24:45 2002/-kb/Tv1_8_1
+/stop.on.gif/1.1/Sun Aug 11 19:24:45 2002/-kb/Tv1_8_1
+/stop.over.gif/1.1/Sun Aug 11 19:24:45 2002/-kb/Tv1_8_1
+/testtubes.png/1.1/Wed Jan 15 12:46:20 2003/-kb/Tv1_8_1
+/thread.disabled.gif/1.1/Sun Aug 11 19:24:45 2002/-kb/Tv1_8_1
+/thread.enabled.gif/1.1/Sun Aug 11 19:24:45 2002/-kb/Tv1_8_1
+/thread.gif/1.1/Sun Aug 11 19:24:45 2002/-kb/Tv1_8_1
+/thread.idle.gif/1.1/Sun Aug 11 19:24:45 2002/-kb/Tv1_8_1
+/timer.gif/1.1/Sun Aug 11 19:24:45 2002/-kb/Tv1_8_1
 D
diff --git a/jakarta-jmeter/src/core/org/apache/jmeter/images/CVS/Tag b/jakarta-jmeter/src/core/org/apache/jmeter/images/CVS/Tag
index 5f312fe..e2fda28 100644
--- a/jakarta-jmeter/src/core/org/apache/jmeter/images/CVS/Tag
+++ b/jakarta-jmeter/src/core/org/apache/jmeter/images/CVS/Tag
@@ -1 +1 @@
-Nv1_7_3
+Nv1_8_1
diff --git a/jakarta-jmeter/src/core/org/apache/jmeter/images/meter.png b/jakarta-jmeter/src/core/org/apache/jmeter/images/meter.png
new file mode 100644
index 0000000..6a86d2d
Binary files /dev/null and b/jakarta-jmeter/src/core/org/apache/jmeter/images/meter.png differ
diff --git a/jakarta-jmeter/src/core/org/apache/jmeter/images/pipet.png b/jakarta-jmeter/src/core/org/apache/jmeter/images/pipet.png
new file mode 100644
index 0000000..65555c9
Binary files /dev/null and b/jakarta-jmeter/src/core/org/apache/jmeter/images/pipet.png differ
diff --git a/jakarta-jmeter/src/core/org/apache/jmeter/images/testtubes.png b/jakarta-jmeter/src/core/org/apache/jmeter/images/testtubes.png
new file mode 100644
index 0000000..ffa5caf
Binary files /dev/null and b/jakarta-jmeter/src/core/org/apache/jmeter/images/testtubes.png differ
diff --git a/jakarta-jmeter/src/core/org/apache/jmeter/junit/AllTests.java b/jakarta-jmeter/src/core/org/apache/jmeter/junit/AllTests.java
deleted file mode 100644
index 6b2492c..0000000
--- a/jakarta-jmeter/src/core/org/apache/jmeter/junit/AllTests.java
+++ /dev/null
@@ -1,146 +0,0 @@
-/*
- * ====================================================================
- * The Apache Software License, Version 1.1
- *
- * Copyright (c) 2001 The Apache Software Foundation.  All rights
- * reserved.
- *
- * Redistribution and use in source and binary forms, with or without
- * modification, are permitted provided that the following conditions
- * are met:
- *
- * 1. Redistributions of source code must retain the above copyright
- * notice, this list of conditions and the following disclaimer.
- *
- * 2. Redistributions in binary form must reproduce the above copyright
- * notice, this list of conditions and the following disclaimer in
- * the documentation and/or other materials provided with the
- * distribution.
- *
- * 3. The end-user documentation included with the redistribution,
- * if any, must include the following acknowledgment:
- * "This product includes software developed by the
- * Apache Software Foundation (http://www.apache.org/)."
- * Alternately, this acknowledgment may appear in the software itself,
- * if and wherever such third-party acknowledgments normally appear.
- *
- * 4. The names "Apache" and "Apache Software Foundation" and
- * "Apache JMeter" must not be used to endorse or promote products
- * derived from this software without prior written permission. For
- * written permission, please contact apache@apache.org.
- *
- * 5. Products derived from this software may not be called "Apache",
- * "Apache JMeter", nor may "Apache" appear in their name, without
- * prior written permission of the Apache Software Foundation.
- *
- * THIS SOFTWARE IS PROVIDED ``AS IS'' AND ANY EXPRESSED OR IMPLIED
- * WARRANTIES, INCLUDING, BUT NOT LIMITED TO, THE IMPLIED WARRANTIES
- * OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE ARE
- * DISCLAIMED.  IN NO EVENT SHALL THE APACHE SOFTWARE FOUNDATION OR
- * ITS CONTRIBUTORS BE LIABLE FOR ANY DIRECT, INDIRECT, INCIDENTAL,
- * SPECIAL, EXEMPLARY, OR CONSEQUENTIAL DAMAGES (INCLUDING, BUT NOT
- * LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES; LOSS OF
- * USE, DATA, OR PROFITS; OR BUSINESS INTERRUPTION) HOWEVER CAUSED AND
- * ON ANY THEORY OF LIABILITY, WHETHER IN CONTRACT, STRICT LIABILITY,
- * OR TORT (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT
- * OF THE USE OF THIS SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF
- * SUCH DAMAGE.
- * ====================================================================
- *
- * This software consists of voluntary contributions made by many
- * individuals on behalf of the Apache Software Foundation.  For more
- * information on the Apache Software Foundation, please see
- * <http://www.apache.org/>.
- */
-package org.apache.jmeter.junit;
-
-import java.io.*;
-import java.util.*;
-import junit.framework.*;
-import org.apache.jmeter.util.ClassFinder;
-import org.apache.jmeter.util.JMeterUtils;
-
-/************************************************************
- *  Title: Apache JMeter Description: Copyright: Copyright (c) 2000 Company:
- *  Apache Foundation
- *
- *@author     Michael Stover
- *@created    $Date: 2002/08/11 19:24:46 $
- *@version    1.0
- ***********************************************************/
-public class AllTests
-{
-	/************************************************************
-	 *  Constructor for the AllTests object
-	 ***********************************************************/
-	public AllTests()
-	{
-	}
-
-	/************************************************************
-	 *  The main program for the AllTests class
-	 *
-	 *@param  args  The command line arguments
-	 ***********************************************************/
-	public static void main(String[] args)
-	{
-		if (args.length < 1)
-		{
-			System.out.println("Need an argument specifying the jmeter property file");
-			System.exit(0);
-		}
-		JMeterUtils.getProperties(args[0]);
-		JMeterUtils.setJMeterHome(new File(System.getProperty("user.dir")).getParent());
-		// end : added - 11 July 2001
-		try
-		{
-			TestSuite suite = suite();
-			PrintStream out = new PrintStream(new FileOutputStream("testresults.txt"));
-			junit.textui.TestRunner runner = new junit.textui.TestRunner(out);
-			runner.run(suite);
-			out.close();
-		}
-		catch (FileNotFoundException e)
-		{
-			e.printStackTrace();
-		}
-		System.exit(0);
-	}
-
-	/************************************************************
-	 *  A unit test suite for JUnit
-	 *
-	 *@return    The test suite
-	 ***********************************************************/
-	public static TestSuite suite()
-	{
-		TestSuite suite = new TestSuite();
-		try
-		{
-			Iterator classes = ClassFinder.findClassesThatExtend(new Class[]{TestCase.class},true).iterator();
-			while (classes.hasNext())
-			{
-				String name = (String)classes.next();
-				try
-				{
-					suite.addTest(new TestSuite(Class.forName(name)));
-				}
-				catch (Exception ex)
-				{
-					System.out.println("error adding test :"+ex);
-				}
-			}
-		}
-		catch (IOException e)
-		{
-			e.printStackTrace();
-		}
-		catch (ClassNotFoundException e)
-		{
-			e.printStackTrace();
-		}
-		return suite;
-	}
-}
-
-
diff --git a/jakarta-jmeter/src/core/org/apache/jmeter/junit/CVS/Entries b/jakarta-jmeter/src/core/org/apache/jmeter/junit/CVS/Entries
index 1c265e3..1fd7a05 100644
--- a/jakarta-jmeter/src/core/org/apache/jmeter/junit/CVS/Entries
+++ b/jakarta-jmeter/src/core/org/apache/jmeter/junit/CVS/Entries
@@ -1,3 +1,2 @@
-/AllTests.java/1.1/Sun Aug 11 19:24:46 2002//Tv1_7_3
-/JMeterTest.java/1.1/Sun Aug 11 19:24:46 2002//Tv1_7_3
+/JMeterTest.java/1.6/Tue Dec 31 18:26:08 2002//Tv1_8_1
 D
diff --git a/jakarta-jmeter/src/core/org/apache/jmeter/junit/CVS/Tag b/jakarta-jmeter/src/core/org/apache/jmeter/junit/CVS/Tag
index 5f312fe..e2fda28 100644
--- a/jakarta-jmeter/src/core/org/apache/jmeter/junit/CVS/Tag
+++ b/jakarta-jmeter/src/core/org/apache/jmeter/junit/CVS/Tag
@@ -1 +1 @@
-Nv1_7_3
+Nv1_8_1
diff --git a/jakarta-jmeter/src/core/org/apache/jmeter/junit/JMeterTest.java b/jakarta-jmeter/src/core/org/apache/jmeter/junit/JMeterTest.java
index fc04a64..d4b5735 100644
--- a/jakarta-jmeter/src/core/org/apache/jmeter/junit/JMeterTest.java
+++ b/jakarta-jmeter/src/core/org/apache/jmeter/junit/JMeterTest.java
@@ -1,23 +1,36 @@
 package org.apache.jmeter.junit;
-import java.util.*;
+import java.io.ByteArrayInputStream;
+import java.io.ByteArrayOutputStream;
+import java.io.ObjectInputStream;
+import java.io.ObjectOutputStream;
+import java.io.Serializable;
+import java.util.Collection;
+import java.util.Iterator;
+import java.util.LinkedList;
+import java.util.List;
+
 import junit.framework.TestCase;
+
 import org.apache.jmeter.gui.JMeterGUIComponent;
-import org.apache.jmeter.testelement.TestElement;
-import org.apache.jmeter.util.ClassFinder;
-import java.io.Serializable;
 import org.apache.jmeter.gui.tree.JMeterTreeNode;
 import org.apache.jmeter.save.SaveService;
+import org.apache.jmeter.testelement.TestElement;
+import org.apache.jmeter.util.JMeterUtils;
+import org.apache.log.Logger;
+import org.apache.jorphan.logging.LoggingManager;
+import org.apache.jorphan.reflect.ClassFinder;
 
 /****************************************
  * Title: JMeter Description: Copyright: Copyright (c) 2000 Company: Apache
  *
  *@author    Michael Stover
- *@created   $Date: 2002/08/11 19:24:46 $
+ *@created   $Date: 2002/12/31 18:26:08 $
  *@version   1.0
  ***************************************/
 
 public class JMeterTest extends TestCase
 {
+	private static Logger log = LoggingManager.getLoggerFor(JMeterUtils.TEST);
 
 	/****************************************
 	 * !ToDo (Constructor description)
@@ -65,6 +78,38 @@ public class JMeterTest extends TestCase
 					el.getProperty(TestElement.NAME), item.getName());
 		}
 	}
+	
+	public void testSerializableElements() throws Exception
+	{
+		Iterator iter = getObjects(Serializable.class).iterator();
+		while(iter.hasNext())
+		{
+			Serializable serObj = (Serializable)iter.next();
+			if(serObj.getClass().getName().endsWith("_Stub"))
+			{
+				continue;
+			}
+			try
+			{
+				log.debug("serializing class: "+serObj.getClass().getName());
+				ByteArrayOutputStream bytes = new ByteArrayOutputStream();
+				ObjectOutputStream out = new ObjectOutputStream(bytes);
+				out.writeObject(serObj);
+				out.close();
+				ObjectInputStream in = new ObjectInputStream(new ByteArrayInputStream(bytes.toByteArray()));
+				Object readObject = in.readObject();
+				in.close();
+				assertEquals("deserializing class: "+serObj.getClass().getName(),
+						serObj.getClass(),readObject.getClass());
+			}
+			catch (Exception e)
+			{
+				log.error("Trying to serialize object: "+serObj.getClass().getName(),
+						e);
+				throw e;
+			}
+		}
+	}
 
 	/****************************************
 	 * !ToDo
@@ -93,11 +138,40 @@ public class JMeterTest extends TestCase
 	 ***************************************/
 	protected Collection getObjects(Class extendsClass) throws Exception
 	{
-		Iterator classes = ClassFinder.findClassesThatExtend(new Class[]{extendsClass}).iterator();
+		Iterator classes = ClassFinder.findClassesThatExtend(
+				JMeterUtils.getSearchPaths(),
+				new Class[]{extendsClass}).iterator();
 		List objects = new LinkedList();
 		while(classes.hasNext())
 		{
-			objects.add(Class.forName((String)classes.next()).newInstance());
+		    Class c= Class.forName((String)classes.next());
+		    try
+		    {
+			try
+			{
+			    // Try with a parameter-less constructor first
+			    objects.add(c.newInstance());
+			}
+			catch (InstantiationException e)
+			{
+			    try
+			    {
+			        // Events often have this constructor
+			        objects.add(c.getConstructor(
+				      new Class[] {Object.class}).newInstance(
+				      new Object[] {this} ));
+			    }
+			    catch (NoSuchMethodException f)
+			    {
+			        // no luck. Ignore this class
+			    }
+			}
+		    }
+		    catch (IllegalAccessException e)
+		    {
+		      // We won't test serialization of restricted-access
+		      // classes.
+		    }
 		}
 		return objects;
 	}
diff --git a/jakarta-jmeter/src/core/org/apache/jmeter/plugin/CVS/Entries b/jakarta-jmeter/src/core/org/apache/jmeter/plugin/CVS/Entries
new file mode 100644
index 0000000..7fb6fb6
--- /dev/null
+++ b/jakarta-jmeter/src/core/org/apache/jmeter/plugin/CVS/Entries
@@ -0,0 +1,3 @@
+/JMeterPlugin.java/1.1/Tue Dec 31 18:05:54 2002//Tv1_8_1
+/PluginManager.java/1.2/Sat Jan 11 11:21:07 2003//Tv1_8_1
+D
diff --git a/jakarta-jmeter/src/core/org/apache/jmeter/plugin/CVS/Repository b/jakarta-jmeter/src/core/org/apache/jmeter/plugin/CVS/Repository
new file mode 100644
index 0000000..2104e32
--- /dev/null
+++ b/jakarta-jmeter/src/core/org/apache/jmeter/plugin/CVS/Repository
@@ -0,0 +1 @@
+jakarta-jmeter/src/core/org/apache/jmeter/plugin
diff --git a/jakarta-jmeter/src/core/org/apache/jmeter/save/old/CVS/Root b/jakarta-jmeter/src/core/org/apache/jmeter/plugin/CVS/Root
similarity index 100%
rename from jakarta-jmeter/src/core/org/apache/jmeter/save/old/CVS/Root
rename to jakarta-jmeter/src/core/org/apache/jmeter/plugin/CVS/Root
diff --git a/jakarta-jmeter/src/core/org/apache/jmeter/plugin/CVS/Tag b/jakarta-jmeter/src/core/org/apache/jmeter/plugin/CVS/Tag
new file mode 100644
index 0000000..e2fda28
--- /dev/null
+++ b/jakarta-jmeter/src/core/org/apache/jmeter/plugin/CVS/Tag
@@ -0,0 +1 @@
+Nv1_8_1
diff --git a/jakarta-jmeter/src/core/org/apache/jmeter/save/old/xml/NoCurrentHandlerException.java b/jakarta-jmeter/src/core/org/apache/jmeter/plugin/JMeterPlugin.java
similarity index 89%
rename from jakarta-jmeter/src/core/org/apache/jmeter/save/old/xml/NoCurrentHandlerException.java
rename to jakarta-jmeter/src/core/org/apache/jmeter/plugin/JMeterPlugin.java
index 0f482f6..a5775cb 100644
--- a/jakarta-jmeter/src/core/org/apache/jmeter/save/old/xml/NoCurrentHandlerException.java
+++ b/jakarta-jmeter/src/core/org/apache/jmeter/plugin/JMeterPlugin.java
@@ -2,7 +2,7 @@
  * ====================================================================
  * The Apache Software License, Version 1.1
  *
- * Copyright (c) 2001 The Apache Software Foundation.  All rights
+ * Copyright (c) 2002 The Apache Software Foundation.  All rights
  * reserved.
  *
  * Redistribution and use in source and binary forms, with or without
@@ -52,21 +52,15 @@
  * information on the Apache Software Foundation, please see
  * <http://www.apache.org/>.
  */
- package org.apache.jmeter.save.old.xml;
+
+package org.apache.jmeter.plugin;
 
 /**
- * Title:
- * Description:
- * Copyright:    Copyright (c) 2000
- * Company:
- * @author
- * @version 1.0
+ * @author Oliver Rossmueller
  */
+public interface JMeterPlugin {
 
-public class NoCurrentHandlerException extends Exception
-{
+    public String[][] getIconMappings();
 
-	public NoCurrentHandlerException()
-	{
-	}
-}
\ No newline at end of file
+    public String[][] getResourceBundles();
+}
diff --git a/jakarta-jmeter/src/core/org/apache/jmeter/plugin/PluginManager.java b/jakarta-jmeter/src/core/org/apache/jmeter/plugin/PluginManager.java
new file mode 100644
index 0000000..c7b9401
--- /dev/null
+++ b/jakarta-jmeter/src/core/org/apache/jmeter/plugin/PluginManager.java
@@ -0,0 +1,120 @@
+/*
+ * ====================================================================
+ * The Apache Software License, Version 1.1
+ *
+ * Copyright (c) 2002 The Apache Software Foundation.  All rights
+ * reserved.
+ *
+ * Redistribution and use in source and binary forms, with or without
+ * modification, are permitted provided that the following conditions
+ * are met:
+ *
+ * 1. Redistributions of source code must retain the above copyright
+ * notice, this list of conditions and the following disclaimer.
+ *
+ * 2. Redistributions in binary form must reproduce the above copyright
+ * notice, this list of conditions and the following disclaimer in
+ * the documentation and/or other materials provided with the
+ * distribution.
+ *
+ * 3. The end-user documentation included with the redistribution,
+ * if any, must include the following acknowledgment:
+ * "This product includes software developed by the
+ * Apache Software Foundation (http://www.apache.org/)."
+ * Alternately, this acknowledgment may appear in the software itself,
+ * if and wherever such third-party acknowledgments normally appear.
+ *
+ * 4. The names "Apache" and "Apache Software Foundation" and
+ * "Apache JMeter" must not be used to endorse or promote products
+ * derived from this software without prior written permission. For
+ * written permission, please contact apache@apache.org.
+ *
+ * 5. Products derived from this software may not be called "Apache",
+ * "Apache JMeter", nor may "Apache" appear in their name, without
+ * prior written permission of the Apache Software Foundation.
+ *
+ * THIS SOFTWARE IS PROVIDED ``AS IS'' AND ANY EXPRESSED OR IMPLIED
+ * WARRANTIES, INCLUDING, BUT NOT LIMITED TO, THE IMPLIED WARRANTIES
+ * OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE ARE
+ * DISCLAIMED.  IN NO EVENT SHALL THE APACHE SOFTWARE FOUNDATION OR
+ * ITS CONTRIBUTORS BE LIABLE FOR ANY DIRECT, INDIRECT, INCIDENTAL,
+ * SPECIAL, EXEMPLARY, OR CONSEQUENTIAL DAMAGES (INCLUDING, BUT NOT
+ * LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES; LOSS OF
+ * USE, DATA, OR PROFITS; OR BUSINESS INTERRUPTION) HOWEVER CAUSED AND
+ * ON ANY THEORY OF LIABILITY, WHETHER IN CONTRACT, STRICT LIABILITY,
+ * OR TORT (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT
+ * OF THE USE OF THIS SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF
+ * SUCH DAMAGE.
+ * ====================================================================
+ *
+ * This software consists of voluntary contributions made by many
+ * individuals on behalf of the Apache Software Foundation.  For more
+ * information on the Apache Software Foundation, please see
+ * <http://www.apache.org/>.
+ */
+
+package org.apache.jmeter.plugin;
+
+
+import java.net.URL;
+
+import javax.swing.*;
+
+import org.apache.jmeter.gui.GUIFactory;
+
+
+/**
+ * @author Oliver Rossmueller
+ */
+public class PluginManager
+{
+
+    private static final PluginManager instance = new PluginManager();
+
+
+    private PluginManager()
+    {
+    }
+
+	/**
+	 * Installs a plugin.
+	 * @param plugin The plugin to install.
+	 * @param useGui Indication of whether or not the gui will be used.
+	 * @throws ClassNotFoundException
+	 * @throws InstantiationException
+	 * @throws IllegalAccessException
+	 */
+    public static void install(JMeterPlugin plugin, boolean useGui)
+            throws ClassNotFoundException, InstantiationException,
+		    IllegalAccessException
+    {
+    	if (useGui)
+    	{
+            instance.installPlugin(plugin);
+    	}
+    }
+
+
+    private void installPlugin(JMeterPlugin plugin)
+            throws ClassNotFoundException, InstantiationException,
+		    IllegalAccessException
+    {
+        String[][] icons = plugin.getIconMappings();
+        ClassLoader classloader = plugin.getClass().getClassLoader();
+
+        for (int i = 0; i < icons.length; i++)
+		{
+            URL resource = classloader.getResource(icons[i][1].trim());
+
+            if (resource == null)
+		    {
+                // todo: log or throw exception
+            }
+	    	else
+	    	{
+                GUIFactory.registerIcon(icons[i][0], new ImageIcon(resource));
+            }
+        }
+    }
+    
+}
diff --git a/jakarta-jmeter/src/core/org/apache/jmeter/reporters/AssertionReporter.java b/jakarta-jmeter/src/core/org/apache/jmeter/reporters/AssertionReporter.java
deleted file mode 100644
index 5fe7c89..0000000
--- a/jakarta-jmeter/src/core/org/apache/jmeter/reporters/AssertionReporter.java
+++ /dev/null
@@ -1,20 +0,0 @@
-package org.apache.jmeter.reporters;
-import java.io.*;
-import java.util.*;
-import org.apache.jmeter.assertions.*;
-import org.apache.jmeter.samplers.*;
-import org.apache.jmeter.util.JMeterUtils;
-
-/****************************************
- * Title: Jakarta-JMeter Description: Copyright: Copyright (c) 2001 Company:
- * Apache
- *
- *@author    Michael Stover
- *@created   $Date: 2002/08/11 19:24:47 $
- *@version   1.0
- ***************************************/
-
-public class AssertionReporter extends ResultCollector implements Serializable
-{
-
-}
diff --git a/jakarta-jmeter/src/core/org/apache/jmeter/reporters/CVS/Entries b/jakarta-jmeter/src/core/org/apache/jmeter/reporters/CVS/Entries
index 5c0e996..01f9383 100644
--- a/jakarta-jmeter/src/core/org/apache/jmeter/reporters/CVS/Entries
+++ b/jakarta-jmeter/src/core/org/apache/jmeter/reporters/CVS/Entries
@@ -1,5 +1,4 @@
-/AbstractListenerElement.java/1.1/Sun Aug 11 19:24:47 2002//Tv1_7_3
-/AssertionReporter.java/1.1/Sun Aug 11 19:24:47 2002//Tv1_7_3
-/FileReporter.java/1.1/Sun Aug 11 19:24:47 2002//Tv1_7_3
-/ResultCollector.java/1.1/Sun Aug 11 19:24:47 2002//Tv1_7_3
+/AbstractListenerElement.java/1.1/Sun Aug 11 19:24:47 2002//Tv1_8_1
+/FileReporter.java/1.4/Fri Aug 30 14:43:20 2002//Tv1_8_1
+/ResultCollector.java/1.10/Mon Jan 27 06:01:04 2003//Tv1_8_1
 D
diff --git a/jakarta-jmeter/src/core/org/apache/jmeter/reporters/CVS/Tag b/jakarta-jmeter/src/core/org/apache/jmeter/reporters/CVS/Tag
index 5f312fe..e2fda28 100644
--- a/jakarta-jmeter/src/core/org/apache/jmeter/reporters/CVS/Tag
+++ b/jakarta-jmeter/src/core/org/apache/jmeter/reporters/CVS/Tag
@@ -1 +1 @@
-Nv1_7_3
+Nv1_8_1
diff --git a/jakarta-jmeter/src/core/org/apache/jmeter/reporters/FileReporter.java b/jakarta-jmeter/src/core/org/apache/jmeter/reporters/FileReporter.java
index 613d339..f8c424d 100644
--- a/jakarta-jmeter/src/core/org/apache/jmeter/reporters/FileReporter.java
+++ b/jakarta-jmeter/src/core/org/apache/jmeter/reporters/FileReporter.java
@@ -55,13 +55,28 @@
 
 package org.apache.jmeter.reporters;
 
-import java.awt.*;
-import java.util.*;
-import java.awt.event.*;
-import java.io.*;
-import java.text.*;
-import javax.swing.*;
-import javax.swing.event.*;
+import java.awt.BorderLayout;
+import java.awt.Color;
+import java.awt.Graphics;
+import java.awt.GridBagConstraints;
+import java.awt.GridBagLayout;
+import java.awt.Insets;
+import java.io.BufferedReader;
+import java.io.File;
+import java.io.FileReader;
+import java.io.IOException;
+import java.text.DecimalFormat;
+import java.util.Enumeration;
+import java.util.Hashtable;
+import java.util.Vector;
+
+import javax.swing.JFrame;
+import javax.swing.JLabel;
+import javax.swing.JOptionPane;
+import javax.swing.JPanel;
+
+import org.apache.log.Hierarchy;
+import org.apache.log.Logger;
 
 /**
  * This class loads data from a saved file and displays
@@ -71,6 +86,8 @@ import javax.swing.event.*;
  * @author  Tom Schneider
  */
 public class FileReporter extends JPanel  {
+	transient private static Logger log = Hierarchy.getDefaultHierarchy().getLoggerFor(
+			"jmeter.elements");
 	Hashtable data = new Hashtable();
 	/**  initalize a file reporter from a file */
 	public void init(String file) throws IOException {
@@ -108,11 +125,10 @@ public class FileReporter extends JPanel  {
 				}
 				v.addElement(value);
 			} catch (NumberFormatException nfe) {
-				System.out.println(nfe.toString());
-				System.out.println("This line could not be parsed: "
-					+ line);
+				log.error("This line could not be parsed: "
+					+ line,nfe);
 			} catch (Exception e) {
-				System.out.println(e.toString());
+				log.error("This line caused a problem: "+line,e);
 			}
 		}
 		reader.close();
@@ -144,6 +160,7 @@ class graphPanel extends JPanel {
 	Hashtable data;
 	Vector keys = new Vector();
 	Vector colorList = new Vector();
+	public graphPanel(){}
 	public graphPanel(Hashtable data) {
 		this.data = data;
 		Enumeration e = data.keys();
diff --git a/jakarta-jmeter/src/core/org/apache/jmeter/reporters/ResultCollector.java b/jakarta-jmeter/src/core/org/apache/jmeter/reporters/ResultCollector.java
index dd4b70b..7e4dd1f 100644
--- a/jakarta-jmeter/src/core/org/apache/jmeter/reporters/ResultCollector.java
+++ b/jakarta-jmeter/src/core/org/apache/jmeter/reporters/ResultCollector.java
@@ -2,7 +2,7 @@
  *  ====================================================================
  *  The Apache Software License, Version 1.1
  *
- *  Copyright (c) 2001 The Apache Software Foundation.  All rights
+ *  Copyright  (c) 2001-2003 The Apache Software Foundation.  All rights
  *  reserved.
  *
  *  Redistribution and use in source and binary forms, with or without
@@ -53,6 +53,7 @@
  *  <http://www.apache.org/>.
  */
 package org.apache.jmeter.reporters;
+
 import java.io.BufferedOutputStream;
 import java.io.ByteArrayOutputStream;
 import java.io.File;
@@ -62,11 +63,8 @@ import java.io.IOException;
 import java.io.OutputStreamWriter;
 import java.io.PrintWriter;
 import java.io.Serializable;
-import java.util.ArrayList;
-import java.util.Collections;
 import java.util.HashMap;
 import java.util.HashSet;
-import java.util.List;
 import java.util.Map;
 import java.util.Set;
 
@@ -83,351 +81,362 @@ import org.apache.jmeter.samplers.SampleResult;
 import org.apache.jmeter.save.SaveService;
 import org.apache.jmeter.testelement.TestListener;
 import org.apache.jmeter.util.JMeterUtils;
-import org.apache.jmeter.util.TextFile;
+import org.apache.log.Hierarchy;
+import org.apache.log.Logger;
+import org.apache.jorphan.io.TextFile;
 import org.xml.sax.SAXException;
 
 /**
- *  Title: Description: Copyright: Copyright (c) 2001 Company:
+ * Title: Description: Copyright: Copyright (c) 2001 Company:
  *
- *@author     Michael Stover
- *@created    $Date: 2002/08/11 19:24:47 $
- *@version    1.0
+ * @author Michael Stover
+ * @version $Id: ResultCollector.java,v 1.10 2003/01/27 06:01:04 seade Exp $
  */
-
-public class ResultCollector extends AbstractListenerElement implements SampleListener, Clearable,
-		Serializable,TestListener,Remoteable
+public class ResultCollector
+    extends AbstractListenerElement
+    implements SampleListener, Clearable, Serializable, TestListener, Remoteable
 {
-	private final static String COLLECTED = "collected";
-	public final static String FILENAME = "filename";
-	private static boolean functionalMode = false;
-
-	/**
-	 *  !ToDo (Field description)
-	 */
-	//protected List results = Collections.synchronizedList(new ArrayList());
-	private int current;
-	private DefaultConfigurationSerializer serializer;
-	private boolean inLoading = false;
-	private PrintWriter out;
-	private boolean inTest = false;
-	private static Map files = new HashMap();
-	private Set hosts = new HashSet();
-	
-
-	/**
-	 *  !ToDo (Constructor description)
-	 */
-	public ResultCollector()
-	{
-		current = -1;
-		serializer = new DefaultConfigurationSerializer();
-	}
-	
-	private void setFilenameProperty(String f)
-	{
-		setProperty(FILENAME,f);
-	}
-	
-	public String getFilename()
-	{
-		return getPropertyAsString(FILENAME);
-	}
-
-	/**
-	 *  Sets the filename attribute of the ResultCollector object
-	 *
-	 *@param  f  The new filename value`
-	 */
-	public void setFilename(String f) throws IOException,IllegalUserActionException
-	{
-		if(inTest)
-		{
-			throw new IllegalUserActionException(JMeterUtils.getResString("busy_testing"));
-		}
-		try
-		{
-			setFilenameProperty(f);
-			loadExistingFile();
-		}
-		catch(SAXException e)
-		{
-			e.printStackTrace();
-			throw new IOException("File "+f+" was improperly formatted");
-		}
-		catch(ConfigurationException e)
-		{
-			throw new IOException("File "+f+" was improperly formatted");
-		}
-	}
-	
-	public void testEnded(String host)
-	{
-		hosts.remove(host);
-		if(hosts.size() == 0)
-		{
-			finalizeFileOutput();
-			inTest = false;
-		}
-	}
-	
-	public void testStarted(String host)
-	{
-		hosts.add(host);
-		try {
-			initializeFileOutput();
-		} catch(Exception e) {
-			e.printStackTrace();
-		} 
-		inTest = true;
-	}
-	
-	public void testEnded()
-	{
-		testEnded("local");
-	}
-	
-	public void testStarted()
-	{
-		testStarted("local");		
-	}
-
-	public void loadExistingFile()
-		throws SAXException, IOException, ConfigurationException {
-			inLoading = true;
-		if(new File(getFilename()).exists())
-		{
-			clear();
-			try {
-				Configuration savedSamples = getConfiguration(getFilename());
-				readSamples(savedSamples);
-			} catch(Exception e) {
-				e.printStackTrace();
-			}
-		}
-		inLoading = false;
-	}
-
-	/**
-	 *  Description of the Method
-	 */
-	private static void writeFileStart(PrintWriter writer)
-	{		
-			writer.println("<?xml version=\"1.0\" encoding=\"UTF-8\"?>");
-			writer.println("<testResults>");
-	}
-
-	/**
-	 *  Description of the Method
-	 */
-	private void writeFileEnd()
-	{
-		out.print("</testResults>");
-	}
-	
-	private static synchronized PrintWriter getFileWriter(String filename) throws IOException
-	{
-		PrintWriter writer = (PrintWriter)files.get(filename);
-		boolean trimmed = true;
-		if(writer == null)
-		{
-			trimmed = trimLastLine(filename);
-			writer = new PrintWriter(new OutputStreamWriter(
-					new BufferedOutputStream(new FileOutputStream(
-					filename,trimmed)),"UTF-8"));
-			files.put(filename,writer);
-		}
-		if(!trimmed)
-		{
-			writeFileStart(writer);
-		}
-		return writer;
-	}
-	
-	private static boolean trimLastLine(String filename)
-	{
-		try
-		{
-			TextFile text = new TextFile(filename);
-			String xml = text.getText();
-			xml = xml.substring(0,xml.indexOf("</testResults>"));
-			text.setText(xml);
-		}
-		catch(Exception e)
-		{
-			return false;
-		}
-		return true;
-	}
-	
-	public static void enableFunctionalMode(boolean mode)
-	{
-		functionalMode = mode;
-	}
-
-	/**
-	 *  Gets the serializedSampleResult attribute of the ResultCollector object
-	 *
-	 *@param  result  Description of the Parameter
-	 *@return         The serializedSampleResult value
-	 */
-	private String getSerializedSampleResult(SampleResult result) throws SAXException,
-			IOException,ConfigurationException
-	{
-		ByteArrayOutputStream tempOut = new ByteArrayOutputStream();
-		serializer.serialize(tempOut, SaveService.getConfiguration(result,functionalMode));
-		String serVer = tempOut.toString();
-		return serVer.substring(serVer.indexOf(System.getProperty("line.separator")));
-	}
-
-	/**
-	 *  Description of the Method
-	 *
-	 *@param  testResults  Description of the Parameter
-	 */
-	private void readSamples(Configuration testResults) throws
-			IOException,SAXException,ConfigurationException
-	{
-		Configuration[] samples = testResults.getChildren();
-		for(int i = 0; i < samples.length; i++)
-		{
-			SampleResult result = SaveService.getSampleResult(samples[i]);
-			sendToVisualizer(result);
-			recordResult(result);
-		}
-	}
-
-	/**
-	 *  Gets the configuration attribute of the ResultCollector object
-	 *
-	 *@param  filename  Description of the Parameter
-	 *@return           The configuration value
-	 */
-	private Configuration getConfiguration(String filename) throws SAXException,
-			IOException,ConfigurationException
-	{
-		DefaultConfigurationBuilder builder = new DefaultConfigurationBuilder();
-		return builder.buildFromFile(filename);
-	}
-
-	/**
-	 *  !ToDo (Method description)
-	 */
-	public void clear()
-	{
-		current = -1;
-		if(getVisualizer() != null && getVisualizer() instanceof Clearable)
-		{
-			((Clearable)getVisualizer()).clear();
-		}
-		finalizeFileOutput();
-	}
-
-	/**
-	 *  !ToDo (Method description)
-	 *
-	 *@param  l  !ToDo (Parameter description)
-	 */
-	public void setListener(Object l) { }
-
-	
-
-	/**
-	 *  !ToDo (Method description)
-	 *
-	 *@param  e  !ToDo (Parameter description)
-	 */
-	public void sampleStarted(SampleEvent e) { }
-
-	/**
-	 *  !ToDo (Method description)
-	 *
-	 *@param  e  !ToDo (Parameter description)
-	 */
-	public void sampleStopped(SampleEvent e) { }
-
-	/**
-	 *  !ToDo (Method description)
-	 *
-	 *@param  e  !ToDo (Parameter description)
-	 */
-	public void sampleOccurred(SampleEvent e)
-	{
-		sendToVisualizer(e.getResult());
-		try
-		{
-			recordResult(e.getResult());
-		}
-		catch(Exception err)
-		{
-			err.printStackTrace(); //should throw exception back to caller
-		}
-	}
-
-	protected void sendToVisualizer(SampleResult r) {
-		if(getVisualizer() != null)
-		{
-			getVisualizer().add(r);
-		}
-	}
-
-	/**
-	 *  Description of the Method
-	 *
-	 *@param  result  Description of the Parameter
-	 */
-	private void recordResult(SampleResult result) throws SAXException,IOException,
-			ConfigurationException
-	{
-		if(out != null)
-		{
-			if(!isResultMarked(result))
-			{
-				out.print(getSerializedSampleResult(result));
-			}
-		}
-	}
-	
-	private synchronized boolean isResultMarked(SampleResult res)
-	{
-		boolean marked = res.isMarked(getFilename());
-		if(!marked)
-		{
-			res.setMarked(getFilename());
-		}
-		return marked;
-	}
-
-	private void initializeFileOutput() throws IOException,
-			ConfigurationException,SAXException
-	{
-		
-		if(out == null && getFilename() != null)
-		{
-			if(out == null)
-			{
-				try
-				{
-					out = getFileWriter(getFilename());
-				}
-				catch(FileNotFoundException e)
-				{
-					out = null;
-				}
-			}
-		}
-	}
-
-	/**
-	 *  Description of the Method
-	 */
-	private synchronized void finalizeFileOutput()
-	{
-		if(out != null)
-		{
-			writeFileEnd();
-			out.close();
-			files.remove(getFilename());
-			out = null;
-		}
-	}
+    transient private static Logger log =
+        Hierarchy.getDefaultHierarchy().getLoggerFor("jmeter.elements");
+    private final static String COLLECTED = "collected";
+    public final static String FILENAME = "filename";
+    private static boolean functionalMode = false;
+    public static final String ERROR_LOGGING = "ResultCollector.error_logging";
+
+    //protected List results = Collections.synchronizedList(new ArrayList());
+    private int current;
+    transient private DefaultConfigurationSerializer serializer;
+    private boolean inLoading = false;
+    transient private PrintWriter out;
+    private boolean inTest = false;
+    private static Map files = new HashMap();
+    private Set hosts = new HashSet();
+
+    /**
+     * No-arg constructor.
+     */
+    public ResultCollector()
+    {
+        current = -1;
+        serializer = new DefaultConfigurationSerializer();
+        setErrorLogging(false);
+    }
+
+    private void setFilenameProperty(String f)
+    {
+        setProperty(FILENAME, f);
+    }
+
+    public String getFilename()
+    {
+        return getPropertyAsString(FILENAME);
+    }
+
+    public boolean isErrorLogging()
+    {
+        return getPropertyAsBoolean(ERROR_LOGGING);
+    }
+
+    public void setErrorLogging(boolean errorLogging)
+    {
+        setProperty(ERROR_LOGGING, new Boolean(errorLogging));
+    }
+
+    /**
+     * Sets the filename attribute of the ResultCollector object
+     *
+     * @param f The new filename value.
+     */
+    public void setFilename(String f) throws IOException, IllegalUserActionException
+    {
+        if (inTest)
+        {
+            throw new IllegalUserActionException(JMeterUtils.getResString("busy_testing"));
+        }
+        try
+        {
+            setFilenameProperty(f);
+            loadExistingFile();
+        }
+        catch (SAXException e)
+        {
+            log.error("", e);
+            throw new IOException("File " + f + " was improperly formatted");
+        }
+        catch (ConfigurationException e)
+        {
+            throw new IOException("File " + f + " was improperly formatted");
+        }
+    }
+
+    public void testEnded(String host)
+    {
+        hosts.remove(host);
+        if (hosts.size() == 0)
+        {
+            finalizeFileOutput();
+            inTest = false;
+        }
+    }
+
+    public void testStarted(String host)
+    {
+        hosts.add(host);
+        try
+        {
+            initializeFileOutput();
+        }
+        catch (Exception e)
+        {
+            log.error("", e);
+        }
+        inTest = true;
+    }
+
+    public void testEnded()
+    {
+        testEnded("local");
+    }
+
+    public void testStarted()
+    {
+        testStarted("local");
+    }
+
+    public void loadExistingFile() throws SAXException, IOException, ConfigurationException
+    {
+        inLoading = true;
+        if (new File(getFilename()).exists())
+        {
+            clear();
+            try
+            {
+                Configuration savedSamples = getConfiguration(getFilename());
+                readSamples(savedSamples);
+            }
+            catch (Exception e)
+            {
+                log.error("", e);
+            }
+        }
+        inLoading = false;
+    }
+
+    private static void writeFileStart(PrintWriter writer)
+    {
+        writer.println("<?xml version=\"1.0\" encoding=\"UTF-8\"?>");
+        writer.println("<testResults>");
+    }
+
+    private void writeFileEnd()
+    {
+        out.print("</testResults>");
+    }
+
+    private static synchronized PrintWriter getFileWriter(String filename) throws IOException
+    {
+        if (filename == null || filename.length() == 0)
+        {
+            return null;
+        }
+        PrintWriter writer = (PrintWriter) files.get(filename);
+        boolean trimmed = true;
+        if (writer == null)
+        {
+            trimmed = trimLastLine(filename);
+            writer =
+                new PrintWriter(
+                    new OutputStreamWriter(
+                        new BufferedOutputStream(new FileOutputStream(filename, trimmed)),
+                        "UTF-8"));
+            files.put(filename, writer);
+        }
+        if (!trimmed)
+        {
+            writeFileStart(writer);
+        }
+        return writer;
+    }
+
+    private static boolean trimLastLine(String filename)
+    {
+        try
+        {
+            TextFile text = new TextFile(filename);
+            if (!text.exists())
+            {
+                return false;
+            }
+            String xml = text.getText();
+            xml = xml.substring(0, xml.indexOf("</testResults>"));
+            text.setText(xml);
+        }
+        catch (Exception e)
+        {
+            return false;
+        }
+        return true;
+    }
+
+    public static void enableFunctionalMode(boolean mode)
+    {
+        functionalMode = mode;
+    }
+
+    public boolean getFunctionalMode()
+    {
+        return functionalMode || isErrorLogging();
+    }
+
+    /**
+     * Gets the serializedSampleResult attribute of the ResultCollector object
+     *
+     * @param result Description of the Parameter
+     * @return The serializedSampleResult value
+     */
+    private String getSerializedSampleResult(SampleResult result)
+        throws SAXException, IOException, ConfigurationException
+    {
+        ByteArrayOutputStream tempOut = new ByteArrayOutputStream();
+        serializer.serialize(tempOut, SaveService.getConfiguration(result, getFunctionalMode()));
+        String serVer = tempOut.toString();
+        return serVer.substring(serVer.indexOf(System.getProperty("line.separator")));
+    }
+
+    /**
+     * Description of the Method
+     *
+     * @param testResults Description of the Parameter
+     */
+    private void readSamples(Configuration testResults)
+        throws IOException, SAXException, ConfigurationException
+    {
+        Configuration[] samples = testResults.getChildren();
+        for (int i = 0; i < samples.length; i++)
+        {
+            SampleResult result = SaveService.getSampleResult(samples[i]);
+            sendToVisualizer(result);
+            recordResult(result);
+        }
+    }
+
+    /**
+     * Gets the configuration attribute of the ResultCollector object
+     *
+     * @param filename Description of the Parameter
+     * @return The configuration value
+     */
+    private Configuration getConfiguration(String filename)
+        throws SAXException, IOException, ConfigurationException
+    {
+        DefaultConfigurationBuilder builder = new DefaultConfigurationBuilder();
+        return builder.buildFromFile(filename);
+    }
+
+    public void clear()
+    {
+        current = -1;
+        if (getVisualizer() != null && getVisualizer() instanceof Clearable)
+        {
+            ((Clearable) getVisualizer()).clear();
+        }
+        finalizeFileOutput();
+    }
+
+    public void setListener(Object l)
+    {
+    }
+
+    public void sampleStarted(SampleEvent e)
+    {
+    }
+
+    public void sampleStopped(SampleEvent e)
+    {
+    }
+
+    public void sampleOccurred(SampleEvent e)
+    {
+        if (!isErrorLogging() || !e.getResult().isSuccessful())
+        {
+            sendToVisualizer(e.getResult());
+            try
+            {
+                recordResult(e.getResult());
+            }
+            catch (Exception err)
+            {
+                log.error("", err); //should throw exception back to caller
+            }
+        }
+    }
+
+    protected void sendToVisualizer(SampleResult r)
+    {
+        if (getVisualizer() != null)
+        {
+            getVisualizer().add(r);
+        }
+    }
+
+    /**
+     * Description of the Method
+     *
+     * @param result Description of the Parameter
+     */
+    private void recordResult(SampleResult result)
+        throws SAXException, IOException, ConfigurationException
+    {
+        if (out != null)
+        {
+            if (!isResultMarked(result))
+            {
+                out.print(getSerializedSampleResult(result));
+            }
+        }
+    }
+
+    private synchronized boolean isResultMarked(SampleResult res)
+    {
+        boolean marked = res.isMarked(getFilename());
+        if (!marked)
+        {
+            res.setMarked(getFilename());
+        }
+        return marked;
+    }
+
+    private void initializeFileOutput() throws IOException, ConfigurationException, SAXException
+    {
+
+        if (out == null && getFilename() != null)
+        {
+            if (out == null)
+            {
+                try
+                {
+                    out = getFileWriter(getFilename());
+                }
+                catch (FileNotFoundException e)
+                {
+                    out = null;
+                }
+            }
+        }
+    }
+
+    /**
+     * Description of the Method
+     */
+    private synchronized void finalizeFileOutput()
+    {
+        if (out != null)
+        {
+            writeFileEnd();
+            out.close();
+            files.remove(getFilename());
+            out = null;
+        }
+    }
+    
 }
diff --git a/jakarta-jmeter/src/core/org/apache/jmeter/resources/CVS/Entries b/jakarta-jmeter/src/core/org/apache/jmeter/resources/CVS/Entries
index 1b697fb..e9a06ab 100644
--- a/jakarta-jmeter/src/core/org/apache/jmeter/resources/CVS/Entries
+++ b/jakarta-jmeter/src/core/org/apache/jmeter/resources/CVS/Entries
@@ -1,5 +1,5 @@
-/messages.properties/1.2/Wed Aug 14 02:52:19 2002//Tv1_7_3
-/messages_de.properties/1.3/Wed Aug 14 02:52:19 2002//Tv1_7_3
-/messages_ja.properties/1.2/Wed Aug 14 02:52:19 2002//Tv1_7_3
-/messages_no.properties/1.2/Wed Aug 14 02:52:19 2002//Tv1_7_3
+/messages.properties/1.24/Fri Jan 10 13:52:04 2003//Tv1_8_1
+/messages_de.properties/1.21/Fri Jan 10 13:52:04 2003//Tv1_8_1
+/messages_ja.properties/1.18/Fri Jan 10 13:52:04 2003//Tv1_8_1
+/messages_no.properties/1.18/Fri Jan 10 13:52:04 2003//Tv1_8_1
 D
diff --git a/jakarta-jmeter/src/core/org/apache/jmeter/resources/CVS/Tag b/jakarta-jmeter/src/core/org/apache/jmeter/resources/CVS/Tag
index 5f312fe..e2fda28 100644
--- a/jakarta-jmeter/src/core/org/apache/jmeter/resources/CVS/Tag
+++ b/jakarta-jmeter/src/core/org/apache/jmeter/resources/CVS/Tag
@@ -1 +1 @@
-Nv1_7_3
+Nv1_8_1
diff --git a/jakarta-jmeter/src/core/org/apache/jmeter/resources/messages.properties b/jakarta-jmeter/src/core/org/apache/jmeter/resources/messages.properties
index 46bb7ab..0f07a8b 100644
--- a/jakarta-jmeter/src/core/org/apache/jmeter/resources/messages.properties
+++ b/jakarta-jmeter/src/core/org/apache/jmeter/resources/messages.properties
@@ -2,6 +2,7 @@ file=File
 run=Run
 save=Save As...
 save_all=Save Test Plan
+save_all_as=Save Test Plan as
 load=Load
 open=Open...
 edit=Edit
@@ -69,6 +70,7 @@ field_name=Field name
 looping_control=Looping Control
 browse=Browse...
 constant_timer_memo=Add a constant delay between sampling
+constant_throughput_timer_memo=Add a delay between sampling to attain constant throughput
 gaussian_timer_memo=Adds a random delay with a gaussian distribution
 uniform_timer_memo=Adds a random delay with a uniform distribution
 modification_controller_title=Modification Manager
@@ -78,7 +80,9 @@ patterns_to_exclude=Patterns to Exclude
 add_pattern=Add Pattern:
 ramp_up=Ramp-Up Period (in seconds):
 constant_timer_title=Constant Timer
+constant_throughput_timer_title=Constant Throughput Timer
 constant_timer_delay=Thread Delay (in milliseconds):
+constant_throughput_timer_throughput=Target Throughput (in samples per minute):
 gaussian_timer_title=Gaussian Random Timer
 gaussian_timer_delay=Constant Delay Offset (in milliseconds):
 gaussian_timer_range=Deviation (in milliseconds):
@@ -97,7 +101,7 @@ modification_controller_title=Modification Controller
 workbench_title=WorkBench
 root_title=Root
 menu_edit=Edit
-graph_full_results_title=GraphFull Results
+graph_full_results_title=Graph Full Results
 graph_results_title=Graph Results
 graph_results_data=Data
 graph_results_average=Average
@@ -154,13 +158,12 @@ file_visualizer_submit_data=Include Submitted Data
 file_visualizer_open=Open
 file_visualizer_flush=Flush
 file_visualizer_close=Close
-file_visualizer_filename=Enter a new filename, or browse to an existing file.
+file_visualizer_filename=Filename
 file_visualizer_file_options=File Options
 file_visualizer_missing_filename=No output filename specified.
 url_config_post=POST
 url_config_get=GET
-url_config_http=HTTP
-url_config_https=HTTPS
+url_config_protocol=Protocol:
 url_config_title=HTTP Request Defaults
 url_full_config_title=UrlFull Sample
 web_server=Web Server
@@ -187,7 +190,7 @@ headers_stored=Headers Stored in the Header Manager
 auth_manager_title=HTTP Authorization Manager
 auth_base_url=Base URL
 auths_stored=Authorizations Stored in the Authorization Manager
-anchor_modifier_title=HTTP HTML Link Parser
+anchor_modifier_title=HTML Link Parser
 jndi_config_title=JNDI Configuration
 jndi_url_jndi_props=JNDI Properties
 jndi_lookup_title=JNDI Lookup Configuration
@@ -219,6 +222,7 @@ url_multipart_config_title=HTTP Multipart Request Defaults
 view_results_in_table=View Results in Table
 http_response_code=HTTP response code
 aggregate_report=Aggregate Report
+aggregate_report_total_label=TOTAL
 login_config_element=Login Config Element
 menu_non_test_elements=Non-Test Elements
 file_already_in_use=That file is already in use
@@ -242,7 +246,7 @@ java_request_defaults=Java Request Defaults
 second=second
 graph_results_throughput=Throughput
 minute=minute
-http_url_rewriting_modifier_title=HTTP URL-Rewriting Modifier
+http_url_rewriting_modifier_title=HTTP URL Re-writing Modifier
 session_argument_name=Session Argument Name
 path_extension_choice=Path Extension (use ";" as separator)
 you_must_enter_a_valid_number=You must enter a valid number
@@ -253,7 +257,7 @@ functional_mode=Functional Test Mode
 functional_mode_explanation=Select functional test mode only if you need \nto record to file the data received from the server for each request.  \n\nSelecting this option impacts performance considerably.
 stopping_test_title=Stopping Test
 stopping_test=Shutting down all test threads.  Please be patient.
-soap_sampler_title=Soap/XML-RPC Sampler (Alpha code)
+soap_sampler_title=SOAP/XML-RPC Request
 soap_data_title=Soap/XML-RPC Data
 user_defined_variables=User Defined Variables
 regexfunc_param_1=Regular expression used to search results from previous request
@@ -271,4 +275,55 @@ iteration_counter_arg_1=TRUE, for each user to have own counter, FALSE for a glo
 request_data=Request Data
 restart=Restart
 encoded_value=URL Encoded Value
-encode?=Encode?
\ No newline at end of file
+encode?=Encode?
+mailer_error=Couldn't send mail. Please correct any misentries.
+invalid_mail_server=The mail-server is unknown.
+mailer_visualizer_title=Mailer Visualizer
+mailer_attributes_panel=Mailing attributes
+duration_assertion_input_error=Please enter a valid positive integer.
+function_name_param=Name of function.  Used to store values for use elsewhere in the testplan.
+user_parameters_title=User Parameters
+user=User
+user_parameters_table=Parameters
+add_parameter=Add Variable
+add_user=Add User
+delete_parameter=Delete Variable
+delete_user=Delete User
+column_delete_disallowed=Deleting this column is not permitted
+enable=Activate
+disable=Disable
+ignore_subcontrollers=Ignore sub-controller blocks
+choose_language=Choose Language
+en=English
+jp=Japanese
+de=German
+no=Norwegian
+record_controller_title=Recording Controller
+counter_config_title=Counter
+var_name=Reference Name
+counter_per_user=Track counter independently for each user
+max=Maximum
+error_loading_help=Error loading help page
+log_errors_only=Log Errors Only
+size_assertion_comparator_error_equal=been equal to
+size_assertion_comparator_error_notequal=not been equal to
+size_assertion_comparator_error_greater=been greater than
+size_assertion_comparator_error_less=been less then
+size_assertion_comparator_error_greaterequal=been greater or equal to
+size_assertion_comparator_error_lessequal=been less than or equal to
+size_assertion_failure=The result was the wrong size: It was {0} bytes, but should have {1} {2} bytes.
+size_assertion_input_error=Please enter a valid positive integer.
+size_assertion_label=Size in bytes:
+size_assertion_size_test=Size to Assert
+size_assertion_title=Size Assertion
+size_assertion_equal=1
+size_assertion_notequal=2
+size_assertion_greaterthan=3
+size_assertion_lessthan=4
+size_assertion_greaterthanequal=5
+size_assertion_lessthanequal=6
+size_assertion_size=99999999
+size_assertion_comparator_label=Type of Comparison
+intsum_param_1=First int to add.
+intsum_param_2=Second int to add - further ints can be summed by adding further arguments.
+running_test=Running test
diff --git a/jakarta-jmeter/src/core/org/apache/jmeter/resources/messages_de.properties b/jakarta-jmeter/src/core/org/apache/jmeter/resources/messages_de.properties
index 583e270..9c44f81 100644
--- a/jakarta-jmeter/src/core/org/apache/jmeter/resources/messages_de.properties
+++ b/jakarta-jmeter/src/core/org/apache/jmeter/resources/messages_de.properties
@@ -1,7 +1,8 @@
 file=Datei
 run=Start
-save=Speichern als
+save=Speichern unter
 save_all=Speichern Test Plan
+save_all_as=Speichern Test Plan unter
 load=Laden
 open=Öffnen
 edit=Bearbeiten
@@ -44,14 +45,14 @@ delete=L
 threadgroup=Thread Gruppe
 controller=Controller
 config_element=Konfigurations Element
-protocol=Protocol:
+protocol=Protokol:
 domain=Domain
 port=Port:
 path=Path:
 follow_redirects=Folge Redirects
 use_keepalive=Benutze KeepAlive
 method=Method:
-default_parameters=Standard Parameters
+default_parameters=Standard Parameter
 name=Name:
 value=Wert
 metadata=MetaData
@@ -60,7 +61,7 @@ expiration=Expiration
 username=Benutzername
 password=Passwort
 number_of_threads=Anzahl von Threads:
-infinite=Endloswiederholen
+infinite=endlos Wiederholen
 iterator_num=Wiederholanzahl:
 add_value=Wert addieren
 paramtable=Parameter die mit dem Request gesendet werden:
@@ -87,7 +88,7 @@ uniform_timer_delay=Constant Delay Offset (in milliseconds):
 uniform_timer_range=Random Delay Maximum (in milliseconds):
 thread_delay_properties=Thread Delay Properties
 thread_group_title=Thread Gruppe
-loop_controller_title=Wiederhollungs Kontroller
+loop_controller_title=Wiederholungs Kontroller
 modification_manager_title=Modifikations Manager
 interleave_control_title=Aus Controller
 random_control_title=Zufalls Kontroller
@@ -110,19 +111,24 @@ spline_visualizer_title=Spline Visualizer
 spline_visualizer_maximum=Maximum
 spline_visualizer_minimum=Minimum
 spline_visualizer_average=Durchschnitt
-spline_visualizer_incoming=hereinkommened
-spline_visualizer_waitingmessage=Waiting for samples
+spline_visualizer_incoming=hereinkommend
+spline_visualizer_waitingmessage=Warte auf Proben
 ftp_testing_title=FTP Request
 server=Server Name oder IP:
 file_to_retrieve=Dateien die vom Server geholt werden sollen:
 ftp_sample_title=FTP Request Defaults
-assertion_title=Assertion
+argument_must_not_be_negative=The Argument must not be negative!
+duration_assertion_failure=The operation lasted to long: It took {0} milliseconds, but should not have lasted longer than {1} milliseconds.
+duration_assertion_title=Duration Assertion
+duration_assertion_duration_test=Duration to Assert
+duration_assertion_label=Duration in milliseconds:
+assertion_title=Response Assertion
 assertion_visualizer_title=Assertion Results
 assertion_resp_field=zu testendes Response Feld
 assertion_text_resp=Text Response
 assertion_url_samp=URL Sampled
 assertion_pattern_match_rules=Pattern Matching Rules
-assertion_contains=Einhält
+assertion_contains=Enthält
 assertion_matches=Matches/Muster
 assertion_not=Nicht
 assertion_patterns_to_test=zu testende Muster
@@ -140,12 +146,12 @@ database_conn_pool_max_usage=Max Verbrauch f
 database_sql_query_title=JDBC SQL Query Defaults
 database_sql_query_string=SQL Query String:
 file_visualizer_title=Datei Reporter
-file_visualizer_output_file=Schreibe alle daten in eine Datei
+file_visualizer_output_file=Schreibe alle Daten in eine Datei
 file_visualizer_browse=Datei laden...
 file_visualizer_append=Anhängen an eine existierende Daten Datei
 file_visualizer_verbose=wortreiche Ausgabe
-file_visualizer_auto_flush=automatischer Fulsh nach jedem Daten Sample
-file_visualizer_submit_data=Einschliesslich übermittelten Daten
+file_visualizer_auto_flush=automatischer Flush nach jedem Daten Sample
+file_visualizer_submit_data=Einschliesslich übermittelter Daten
 file_visualizer_open=Öffnen
 file_visualizer_flush=Flush
 file_visualizer_close=Schliessen
@@ -156,10 +162,10 @@ url_config_post=POST
 url_config_get=GET
 url_config_http=HTTP
 url_config_https=HTTPS
-url_config_title=HTTP Request Standard Einstellungen
+url_config_title=HTTP Request Default Einstellungen
 url_full_config_title=UrlFull Sample
 web_server=Web Server
-web_server_domain=Server Name or IP:
+web_server_domain=Server Name oder IP:
 web_server_port=Port Number:
 web_request=HTTP Request
 web_testing_title=HTTP Request
@@ -219,10 +225,10 @@ menu_non_test_elements=Non-Test Elements
 file_already_in_use=Die Datei ist bereits geöffnet
 busy_testing=Ich bin mit dem Testen beschäftigt, bitte stoppen sie den Test bevor sie die Einstellungen ändern.
 http_user_parameter_modifier=HTTP User Parameter Modifier
-user_param_mod_help_note=(Änder Sie dies nicht. Stattdessen, bitte die Datei mit dem Namen in JMeter's /bin Ordner ändern.)
+user_param_mod_help_note=(Ändern Sie dies nicht. Stattdessen, bitte die Datei mit dem Namen in JMeter's /bin Ordner ändern.)
 filename=Dateiname
-cancel_exit_to_save=Es gibt Test die noch nicht gespeichert wurden.  Wollen Sie diese vor dem Beenden speichern?
-cancel_new_to_save=Es gibt Test die noch nicht gespeichert wurden.  Wollen Sie diese vor dem Bereinigen speichern?
+cancel_exit_to_save=Es gibt Tests die noch nicht gespeichert wurden.  Wollen Sie diese vor dem Beenden speichern?
+cancel_new_to_save=Es gibt Tests die noch nicht gespeichert wurden.  Wollen Sie diese vor dem Bereinigen speichern?
 save?=Speichern?
 insert_before=Davor einfügen
 insert_after=Danach einfügen
@@ -251,19 +257,70 @@ stopping_test=Stoppe alle Tests. Bitte warten ...
 soap_sampler_title=Soap/XML-RPC Sampler (Alpha code)
 soap_data_title=Soap/XML-RPC Data
 user_defined_variables=Benutzer definierte Variablen
-regexfunc_param_1=Reguläre Ausdrücke zum suchen in den Resultsder vorherigen Requests
+regexfunc_param_1=Reguläre Ausdrücke zum Suchen in den Results der vorherigen Requests
 regexfunc_param_2=Beispiel für Ersetzungs Strings, benuzte Gruppen von den regulären Ausdrücken
-regexfunc_param_3=Which match to use.  Einen Integer 1 oder grösser, RAND damit JMeter eine zufällige auswahl trifft, eine Fliesskommazahl, oder ALL wenn alle matches benutzt werden
-regexfunc_param_4=Zwischen Text.  Wenn ALL ausgeählt ist, wird der zwischen Test benutzt um das Ergebnis zu generieren
-regexfunc_param_5=Standard text.  Wird benutzt anstatt der Vorlage, falls der Reguläre Ausdruck keine Treffer findet
+regexfunc_param_3=Which match to use.  Einen Integer 1 oder grösser, RAND damit JMeter eine zufällige Auswahl trifft, eine Fliesskommazahl, oder ALL wenn alle Treffer benutzt werden
+regexfunc_param_4=Zwischen Text.  Wenn ALL ausgewählt ist, wird der zwischen Test benutzt um das Ergebnis zu generieren
+regexfunc_param_5=Standard Text.  Wird benutzt anstatt der Vorlage, falls der Reguläre Ausdruck keine Treffer findet
 function_dialog_menu_item=Funktions Helfer Dialog
 function_params=Funktions Parameter
 cut_paste_function=Kopieren und Einfügen des Funktions Strings
 choose_function=Wählen Sie eine Funktion
 function_helper_title=Funktions Helfer
 generate=Generiere
-iteration_counter_arg_1=TRUE, damit jeder Benutzer einen eingenem Zähler hat, FALSE für eine gesamten Zähler
+iteration_counter_arg_1=TRUE, damit jeder Benutzer einen eingenen Zähler hat, FALSE für eine gesamten Zähler
 request_data=Request Daten
 restart=Restart
 encoded_value=URL Encoded Value
-encode?=Encode?
\ No newline at end of file
+encode?=Encodieren?
+mailer_error=Konnte die Mail nicht senden. Bitte korrigieren Sie jede fehl Eingabe.
+invalid_mail_server=Der Mail-Server ist unbekannt.
+mailer_visualizer_title=Mailer Visualizer
+mailer_attributes_panel=Mailing Eigenschaften
+duration_assertion_input_error=Bitte einen gültigen positive Integer eingeben.
+function_name_param=Name der Funktion.  Wird zum speichern von Werten irgendwo im Testplan benutzt.
+user_parameters_title=User Parameter
+user=User
+user_parameters_table=Parameter
+add_parameter=Variable hinzufügen
+add_user=User hinzufügen
+delete_parameter=Lösche Variable
+delete_user=Lösche User
+column_delete_disallowed=Das löschen dieser Spalte ist nicht erlaubt
+enable=Aktivieren
+disable=Deaktivieren
+ignore_subcontrollers=Ignoriere Sub-Controller Blöcke
+choose_language=Sprache wählen
+en=English
+ja=Japanese
+de=Deutsch
+no=Norwegian
+record_controller_title=Recording Controller
+counter_config_title=Counter
+var_name=Reference Name
+counter_per_user=Track counter independently for each user
+max=Maximum
+error_loading_help=Error loading help page
+log_errors_only=Log Errors Only
+size_assertion_comparator_error_equal=been equal to
+size_assertion_comparator_error_notequal=not been equal to
+size_assertion_comparator_error_greater=been greater than
+size_assertion_comparator_error_less=been less then
+size_assertion_comparator_error_greaterequal=been greater or equal to
+size_assertion_comparator_error_lessequal=been less than or equal to
+size_assertion_failure=The result was the wrong size: It was {0} bytes, but should have {1} {2} bytes.
+size_assertion_input_error=Please enter a valid positive integer.
+size_assertion_label=Size in bytes:
+size_assertion_size_test=Size to Assert
+size_assertion_title=Size Assertion
+size_assertion_equal=1
+size_assertion_notequal=2
+size_assertion_greaterthan=3
+size_assertion_lessthan=4
+size_assertion_greaterthanequal=5
+size_assertion_lessthanequal=6
+size_assertion_size=99999999
+size_assertion_comparator_label=Type of Comparison
+intsum_param_1=First int to add.
+intsum_param_2=Second int to add - further ints can be summed by adding further arguments.
+running_test=Running test
diff --git a/jakarta-jmeter/src/core/org/apache/jmeter/resources/messages_ja.properties b/jakarta-jmeter/src/core/org/apache/jmeter/resources/messages_ja.properties
index 3e25861..904d763 100644
--- a/jakarta-jmeter/src/core/org/apache/jmeter/resources/messages_ja.properties
+++ b/jakarta-jmeter/src/core/org/apache/jmeter/resources/messages_ja.properties
@@ -2,6 +2,7 @@ file=\u30d5\u30a1\u30a4\u30eb
 run=\u5b9f\u884c
 save=\u4fdd\u5b58
 save_all=\u5168\u3066\u4fdd\u5b58
+save_all_as=\u5168\u3066\u4fdd\u5b58 as
 load=\u8aad\u8fbc
 open=\u958B\u304F...
 edit=\u7de8\u96c6
@@ -266,4 +267,55 @@ iteration_counter_arg_1=TRUE, for each user to have own counter, FALSE for a glo
 request_data=Request Data
 restart=Restart
 encoded_value=URL Encoded Value
-encode?=Encode?
\ No newline at end of file
+encode?=Encode?
+mailer_error=Couldn't send mail. Please correct any misentries.
+invalid_mail_server=The mail-server is unknown.
+mailer_visualizer_title=Mailer Visualizer
+mailer_attributes_panel=Mailing attributes
+duration_assertion_input_error=Please enter a valid positive integer.
+function_name_param=Name of function.  Used to store values for use elsewhere in the testplan.
+user_parameters_title=User Parameters
+user=User
+user_parameters_table=Parameters
+add_parameter=Add Variable
+add_user=Add User
+delete_parameter=Delete Variable
+delete_user=Delete User
+column_delete_disallowed=Deleting this column is not permitted
+enable=Activate
+disable=Disable
+ignore_subcontrollers=Ignore sub-controller blocks
+choose_language=Choose Language
+en=English
+ja=Japanese
+de=German
+no=Norwegian
+record_controller_title=Recording Controller
+counter_config_title=Counter
+var_name=Reference Name
+counter_per_user=Track counter independently for each user
+max=Maximum
+error_loading_help=Error loading help page
+log_errors_only=Log Errors Only
+size_assertion_comparator_error_equal=been equal to
+size_assertion_comparator_error_notequal=not been equal to
+size_assertion_comparator_error_greater=been greater than
+size_assertion_comparator_error_less=been less then
+size_assertion_comparator_error_greaterequal=been greater or equal to
+size_assertion_comparator_error_lessequal=been less than or equal to
+size_assertion_failure=The result was the wrong size: It was {0} bytes, but should have {1} {2} bytes.
+size_assertion_input_error=Please enter a valid positive integer.
+size_assertion_label=Size in bytes:
+size_assertion_size_test=Size to Assert
+size_assertion_title=Size Assertion
+size_assertion_equal=1
+size_assertion_notequal=2
+size_assertion_greaterthan=3
+size_assertion_lessthan=4
+size_assertion_greaterthanequal=5
+size_assertion_lessthanequal=6
+size_assertion_size=99999999
+size_assertion_comparator_label=Type of Comparison
+intsum_param_1=First int to add.
+intsum_param_2=Second int to add - further ints can be summed by adding further arguments.
+running_test=Running test
diff --git a/jakarta-jmeter/src/core/org/apache/jmeter/resources/messages_no.properties b/jakarta-jmeter/src/core/org/apache/jmeter/resources/messages_no.properties
index 85e2197..aa9e30f 100644
--- a/jakarta-jmeter/src/core/org/apache/jmeter/resources/messages_no.properties
+++ b/jakarta-jmeter/src/core/org/apache/jmeter/resources/messages_no.properties
@@ -2,6 +2,7 @@ file=Fil
 run=Kjør
 save=Lagre som...
 save_all=Lagre alle
+save_all_as=Lagre alle som...
 load=Hent
 open=Åpne...
 edit=Rediger
@@ -258,4 +259,55 @@ iteration_counter_arg_1=TRUE, for each user to have own counter, FALSE for a glo
 request_data=Request Data
 restart=Restart
 encoded_value=URL Encoded Value
-encode?=Encode?
\ No newline at end of file
+encode?=Encode?
+mailer_error=Couldn't send mail. Please correct any misentries.
+invalid_mail_server=The mail-server is unknown.
+mailer_visualizer_title=Mailer Visualizer
+mailer_attributes_panel=Mailing attributes
+duration_assertion_input_error=Please enter a valid positive integer.
+function_name_param=Name of function.  Used to store values for use elsewhere in the testplan.
+user_parameters_title=User Parameters
+user=User
+user_parameters_table=Parameters
+add_parameter=Add Variable
+add_user=Add User
+delete_parameter=Delete Variable
+delete_user=Delete User
+column_delete_disallowed=Deleting this column is not permitted
+enable=Activate
+disable=Disable
+ignore_subcontrollers=Ignore sub-controller blocks
+choose_language=Choose Language
+en=English
+ja=Japanese
+de=German
+no=Norwegian
+record_controller_title=Recording Controller
+counter_config_title=Counter
+var_name=Reference Name
+counter_per_user=Track counter independently for each user
+max=Maximum
+error_loading_help=Error loading help page
+log_errors_only=Log Errors Only
+size_assertion_comparator_error_equal=been equal to
+size_assertion_comparator_error_notequal=not been equal to
+size_assertion_comparator_error_greater=been greater than
+size_assertion_comparator_error_less=been less then
+size_assertion_comparator_error_greaterequal=been greater or equal to
+size_assertion_comparator_error_lessequal=been less than or equal to
+size_assertion_failure=The result was the wrong size: It was {0} bytes, but should have {1} {2} bytes.
+size_assertion_input_error=Please enter a valid positive integer.
+size_assertion_label=Size in bytes:
+size_assertion_size_test=Size to Assert
+size_assertion_title=Size Assertion
+size_assertion_equal=1
+size_assertion_notequal=2
+size_assertion_greaterthan=3
+size_assertion_lessthan=4
+size_assertion_greaterthanequal=5
+size_assertion_lessthanequal=6
+size_assertion_size=99999999
+size_assertion_comparator_label=Type of Comparison
+intsum_param_1=First int to add.
+intsum_param_2=Second int to add - further ints can be summed by adding further arguments.
+running_test=Running test
diff --git a/jakarta-jmeter/src/core/org/apache/jmeter/samplers/CVS/Entries b/jakarta-jmeter/src/core/org/apache/jmeter/samplers/CVS/Entries
index 85ed43f..31cb96d 100644
--- a/jakarta-jmeter/src/core/org/apache/jmeter/samplers/CVS/Entries
+++ b/jakarta-jmeter/src/core/org/apache/jmeter/samplers/CVS/Entries
@@ -1,15 +1,15 @@
-/AbstractSampler.java/1.1/Sun Aug 11 19:24:47 2002//Tv1_7_3
-/Clearable.java/1.1/Sun Aug 11 19:24:47 2002//Tv1_7_3
-/CycleEntry.java/1.1/Sun Aug 11 19:24:47 2002//Tv1_7_3
-/Entry.java/1.1/Sun Aug 11 19:24:47 2002//Tv1_7_3
-/RemoteListenerWrapper.java/1.1/Sun Aug 11 19:24:47 2002//Tv1_7_3
-/RemoteSampleListener.java/1.1/Sun Aug 11 19:24:47 2002//Tv1_7_3
-/RemoteSampleListenerImpl.java/1.1/Sun Aug 11 19:24:47 2002//Tv1_7_3
-/RemoteSampleListenerWrapper.java/1.1/Sun Aug 11 19:24:47 2002//Tv1_7_3
-/RemoteTestListenerWrapper.java/1.1/Sun Aug 11 19:24:47 2002//Tv1_7_3
-/Remoteable.java/1.1/Sun Aug 11 19:24:47 2002//Tv1_7_3
-/SampleEvent.java/1.1/Sun Aug 11 19:24:47 2002//Tv1_7_3
-/SampleListener.java/1.1/Sun Aug 11 19:24:47 2002//Tv1_7_3
-/SampleResult.java/1.1/Sun Aug 11 19:24:47 2002//Tv1_7_3
-/Sampler.java/1.1/Sun Aug 11 19:24:47 2002//Tv1_7_3
+/AbstractSampler.java/1.1/Sun Aug 11 19:24:47 2002//Tv1_8_1
+/Clearable.java/1.1/Sun Aug 11 19:24:47 2002//Tv1_8_1
+/CycleEntry.java/1.1/Sun Aug 11 19:24:47 2002//Tv1_8_1
+/Entry.java/1.3/Thu Aug 29 18:17:39 2002//Tv1_8_1
+/RemoteListenerWrapper.java/1.3/Thu Aug 29 18:17:39 2002//Tv1_8_1
+/RemoteSampleListener.java/1.2/Fri Aug 30 14:43:20 2002//Tv1_8_1
+/RemoteSampleListenerImpl.java/1.2/Fri Aug 30 14:43:20 2002//Tv1_8_1
+/RemoteSampleListenerWrapper.java/1.3/Thu Aug 29 18:17:39 2002//Tv1_8_1
+/RemoteTestListenerWrapper.java/1.3/Thu Aug 29 18:17:39 2002//Tv1_8_1
+/Remoteable.java/1.1/Sun Aug 11 19:24:47 2002//Tv1_8_1
+/SampleEvent.java/1.1/Sun Aug 11 19:24:47 2002//Tv1_8_1
+/SampleListener.java/1.2/Fri Aug 30 14:43:20 2002//Tv1_8_1
+/SampleResult.java/1.3/Thu Aug 29 18:17:39 2002//Tv1_8_1
+/Sampler.java/1.1/Sun Aug 11 19:24:47 2002//Tv1_8_1
 D/gui////
diff --git a/jakarta-jmeter/src/core/org/apache/jmeter/samplers/CVS/Tag b/jakarta-jmeter/src/core/org/apache/jmeter/samplers/CVS/Tag
index 5f312fe..e2fda28 100644
--- a/jakarta-jmeter/src/core/org/apache/jmeter/samplers/CVS/Tag
+++ b/jakarta-jmeter/src/core/org/apache/jmeter/samplers/CVS/Tag
@@ -1 +1 @@
-Nv1_7_3
+Nv1_8_1
diff --git a/jakarta-jmeter/src/core/org/apache/jmeter/samplers/Entry.java b/jakarta-jmeter/src/core/org/apache/jmeter/samplers/Entry.java
index ecb497c..72a0d54 100644
--- a/jakarta-jmeter/src/core/org/apache/jmeter/samplers/Entry.java
+++ b/jakarta-jmeter/src/core/org/apache/jmeter/samplers/Entry.java
@@ -54,22 +54,31 @@
  */
  package org.apache.jmeter.samplers;
 
-import java.util.*;
-import org.apache.jmeter.config.*;
+import java.util.HashMap;
+import java.util.HashSet;
+import java.util.LinkedList;
+import java.util.List;
+import java.util.Map;
+import java.util.Set;
+
 import org.apache.jmeter.assertions.Assertion;
+import org.apache.jmeter.config.ConfigElement;
+import org.apache.log.Hierarchy;
+import org.apache.log.Logger;
 
 /************************************************************
  *  Title: Apache JMeter Description: Copyright: Copyright (c) 2000 Company:
  *  Apache Foundation
  *
  *@author     Michael Stover
- *@created    $Date: 2002/08/11 19:24:47 $
+ *@created    $Date: 2002/08/29 18:17:39 $
  *@version    1.0
  ***********************************************************/
 
 public class Entry
 {
-
+	transient private static Logger log = Hierarchy.getDefaultHierarchy().getLoggerFor(
+			"jmeter.elements");
 	Map configSet;
 	Set clonedSet;
 	Class sampler;
@@ -181,7 +190,7 @@ public class Entry
 		}
 		catch (Exception ex)
 		{
-			ex.printStackTrace();
+			log.error("",ex);
 		}
 		return null;
 	}
diff --git a/jakarta-jmeter/src/core/org/apache/jmeter/samplers/RemoteListenerWrapper.java b/jakarta-jmeter/src/core/org/apache/jmeter/samplers/RemoteListenerWrapper.java
index a91cdde..28f1cfb 100644
--- a/jakarta-jmeter/src/core/org/apache/jmeter/samplers/RemoteListenerWrapper.java
+++ b/jakarta-jmeter/src/core/org/apache/jmeter/samplers/RemoteListenerWrapper.java
@@ -1,9 +1,12 @@
 package org.apache.jmeter.samplers;
 
+import java.io.Serializable;
 import java.rmi.RemoteException;
-import org.apache.jmeter.testelement.TestListener;
+
 import org.apache.jmeter.testelement.AbstractTestElement;
-import java.io.Serializable;
+import org.apache.jmeter.testelement.TestListener;
+import org.apache.log.Hierarchy;
+import org.apache.log.Logger;
 
 /**
  * <p>Title: </p>
@@ -17,6 +20,8 @@ import java.io.Serializable;
 public class RemoteListenerWrapper extends AbstractTestElement implements
 		SampleListener,TestListener,Serializable
 {
+	transient private static Logger log = Hierarchy.getDefaultHierarchy().getLoggerFor(
+			"jmeter.elements");
 	RemoteSampleListener listener;
 
 	public RemoteListenerWrapper(RemoteSampleListener l)
@@ -36,7 +41,7 @@ public class RemoteListenerWrapper extends AbstractTestElement implements
 		}
 		catch (Exception ex)
 		{
-			ex.printStackTrace();
+			log.error("",ex);
 		}
 
 	}
@@ -48,7 +53,7 @@ public class RemoteListenerWrapper extends AbstractTestElement implements
 		}
 		catch (Exception ex)
 		{
-			ex.printStackTrace();
+			log.error("",ex);
 		}
 	}
 	public void testStarted(String host)
@@ -59,7 +64,7 @@ public class RemoteListenerWrapper extends AbstractTestElement implements
 		}
 		catch (Exception ex)
 		{
-			ex.printStackTrace();
+			log.error("",ex);
 		}
 	}
 	public void testEnded(String host)
@@ -70,7 +75,7 @@ public class RemoteListenerWrapper extends AbstractTestElement implements
 		}
 		catch (Exception ex)
 		{
-			ex.printStackTrace();
+			log.error("",ex);
 		}
 	}
 
@@ -82,7 +87,7 @@ public class RemoteListenerWrapper extends AbstractTestElement implements
 		}
 		catch(RemoteException err)
 		{
-			err.printStackTrace();
+			log.error("",err);
 		}
 	}
 	public void sampleStarted(SampleEvent e)
@@ -93,7 +98,7 @@ public class RemoteListenerWrapper extends AbstractTestElement implements
 		}
 		catch(RemoteException err)
 		{
-			err.printStackTrace();
+			log.error("",err);
 		}
 	}
 	public void sampleStopped(SampleEvent e)
@@ -104,7 +109,7 @@ public class RemoteListenerWrapper extends AbstractTestElement implements
 		}
 		catch(RemoteException err)
 		{
-			err.printStackTrace();
+			log.error("",err);
 		}
 	}
 }
\ No newline at end of file
diff --git a/jakarta-jmeter/src/core/org/apache/jmeter/samplers/RemoteSampleListener.java b/jakarta-jmeter/src/core/org/apache/jmeter/samplers/RemoteSampleListener.java
index 8955504..9ea3df6 100644
--- a/jakarta-jmeter/src/core/org/apache/jmeter/samplers/RemoteSampleListener.java
+++ b/jakarta-jmeter/src/core/org/apache/jmeter/samplers/RemoteSampleListener.java
@@ -63,7 +63,7 @@ import java.rmi.RemoteException;
  * and when sampling is stopped.
  */
 public interface RemoteSampleListener
-	 extends java.rmi.Remote, java.io.Serializable
+	 extends java.rmi.Remote
 {
 	
 	public void testStarted() throws RemoteException;
diff --git a/jakarta-jmeter/src/core/org/apache/jmeter/samplers/RemoteSampleListenerImpl.java b/jakarta-jmeter/src/core/org/apache/jmeter/samplers/RemoteSampleListenerImpl.java
index 970a263..a865093 100644
--- a/jakarta-jmeter/src/core/org/apache/jmeter/samplers/RemoteSampleListenerImpl.java
+++ b/jakarta-jmeter/src/core/org/apache/jmeter/samplers/RemoteSampleListenerImpl.java
@@ -61,8 +61,8 @@ import org.apache.jmeter.testelement.TestListener;
  *  !ToDo (Class description)
  *
  *@author     $Author: mstover1 $
- *@created    $Date: 2002/08/11 19:24:47 $
- *@version    $Revision: 1.1 $
+ *@created    $Date: 2002/08/30 14:43:20 $
+ *@version    $Revision: 1.2 $
  ***********************************************************/
 public class RemoteSampleListenerImpl
 		 extends java.rmi.server.UnicastRemoteObject
@@ -70,16 +70,14 @@ public class RemoteSampleListenerImpl
 {
 	TestListener testListener;
 	SampleListener sampleListener;
-
-	/************************************************************
-	 *  !ToDo (Constructor description)
-	 *
-	 *@param  listeners            !ToDo (Parameter description)
-	 *@exception  RemoteException  !ToDo (Exception description)
-	 ***********************************************************/
-	public RemoteSampleListenerImpl(Object listener) throws RemoteException
+	
+	public RemoteSampleListenerImpl() throws RemoteException
 	{
 		super();
+	}
+	
+	public void setListener(Object listener)
+	{
 		if(listener instanceof TestListener)
 		{
 			testListener = (TestListener)listener;
@@ -90,6 +88,18 @@ public class RemoteSampleListenerImpl
 		}
 	}
 
+	/************************************************************
+	 *  !ToDo (Constructor description)
+	 *
+	 *@param  listeners            !ToDo (Parameter description)
+	 *@exception  RemoteException  !ToDo (Exception description)
+	 ***********************************************************/
+	public RemoteSampleListenerImpl(Object listener) throws RemoteException
+	{
+		super();
+		setListener(listener);
+	}
+
 	public void testStarted()
 	{
 		if(testListener != null)
diff --git a/jakarta-jmeter/src/core/org/apache/jmeter/samplers/RemoteSampleListenerWrapper.java b/jakarta-jmeter/src/core/org/apache/jmeter/samplers/RemoteSampleListenerWrapper.java
index 621caa7..6f36b32 100644
--- a/jakarta-jmeter/src/core/org/apache/jmeter/samplers/RemoteSampleListenerWrapper.java
+++ b/jakarta-jmeter/src/core/org/apache/jmeter/samplers/RemoteSampleListenerWrapper.java
@@ -1,8 +1,11 @@
 package org.apache.jmeter.samplers;
 
+import java.io.Serializable;
 import java.rmi.RemoteException;
+
 import org.apache.jmeter.testelement.AbstractTestElement;
-import java.io.Serializable;
+import org.apache.log.Hierarchy;
+import org.apache.log.Logger;
 
 /**
  * <p>Title: </p>
@@ -16,6 +19,8 @@ import java.io.Serializable;
 public class RemoteSampleListenerWrapper extends AbstractTestElement implements
 		SampleListener,Serializable
 {
+	transient private static Logger log = Hierarchy.getDefaultHierarchy().getLoggerFor(
+			"jmeter.elements");
 	RemoteSampleListener listener;
 
 	public RemoteSampleListenerWrapper(RemoteSampleListener l)
@@ -35,7 +40,7 @@ public class RemoteSampleListenerWrapper extends AbstractTestElement implements
 		}
 		catch(RemoteException err)
 		{
-			err.printStackTrace();
+			log.error("",err);
 		}
 	}
 	public void sampleStarted(SampleEvent e)
@@ -46,7 +51,7 @@ public class RemoteSampleListenerWrapper extends AbstractTestElement implements
 		}
 		catch(RemoteException err)
 		{
-			err.printStackTrace();
+			log.error("",err);
 		}
 	}
 	public void sampleStopped(SampleEvent e)
@@ -57,7 +62,7 @@ public class RemoteSampleListenerWrapper extends AbstractTestElement implements
 		}
 		catch(RemoteException err)
 		{
-			err.printStackTrace();
+			log.error("",err);
 		}
 	}
 }
\ No newline at end of file
diff --git a/jakarta-jmeter/src/core/org/apache/jmeter/samplers/RemoteTestListenerWrapper.java b/jakarta-jmeter/src/core/org/apache/jmeter/samplers/RemoteTestListenerWrapper.java
index 3ddf3bb..e4b7719 100644
--- a/jakarta-jmeter/src/core/org/apache/jmeter/samplers/RemoteTestListenerWrapper.java
+++ b/jakarta-jmeter/src/core/org/apache/jmeter/samplers/RemoteTestListenerWrapper.java
@@ -1,9 +1,12 @@
 package org.apache.jmeter.samplers;
 
-import org.apache.jmeter.testelement.TestListener;
-import org.apache.jmeter.testelement.AbstractTestElement;
 import java.io.Serializable;
 
+import org.apache.jmeter.testelement.AbstractTestElement;
+import org.apache.jmeter.testelement.TestListener;
+import org.apache.log.Hierarchy;
+import org.apache.log.Logger;
+
 /**
  * <p>Title: </p>
  * <p>Description: </p>
@@ -16,7 +19,8 @@ import java.io.Serializable;
 public class RemoteTestListenerWrapper extends AbstractTestElement implements
 		TestListener,Serializable
 {
-
+	transient private static Logger log = Hierarchy.getDefaultHierarchy().getLoggerFor(
+			"jmeter.elements");
 	RemoteSampleListener listener;
 
 	public RemoteTestListenerWrapper()
@@ -35,7 +39,7 @@ public class RemoteTestListenerWrapper extends AbstractTestElement implements
 		}
 		catch (Exception ex)
 		{
-			ex.printStackTrace();
+			log.error("",ex);
 		}
 
 	}
@@ -47,7 +51,7 @@ public class RemoteTestListenerWrapper extends AbstractTestElement implements
 		}
 		catch (Exception ex)
 		{
-			ex.printStackTrace();
+			log.error("",ex);
 		}
 	}
 	public void testStarted(String host)
@@ -58,7 +62,7 @@ public class RemoteTestListenerWrapper extends AbstractTestElement implements
 		}
 		catch (Exception ex)
 		{
-			ex.printStackTrace();
+			log.error("",ex);
 		}
 	}
 	public void testEnded(String host)
@@ -69,7 +73,7 @@ public class RemoteTestListenerWrapper extends AbstractTestElement implements
 		}
 		catch (Exception ex)
 		{
-			ex.printStackTrace();
+			log.error("",ex);
 		}
 	}
 }
\ No newline at end of file
diff --git a/jakarta-jmeter/src/core/org/apache/jmeter/samplers/SampleListener.java b/jakarta-jmeter/src/core/org/apache/jmeter/samplers/SampleListener.java
index 9f96771..184c60b 100644
--- a/jakarta-jmeter/src/core/org/apache/jmeter/samplers/SampleListener.java
+++ b/jakarta-jmeter/src/core/org/apache/jmeter/samplers/SampleListener.java
@@ -60,7 +60,7 @@ package org.apache.jmeter.samplers;
  * when a specific sample is obtained,
  * and when sampling is stopped.
  */
-public interface SampleListener extends java.io.Serializable {
+public interface SampleListener {
 	 /**
 	  * A sample has started and stopped.
 	  **/
diff --git a/jakarta-jmeter/src/core/org/apache/jmeter/samplers/SampleResult.java b/jakarta-jmeter/src/core/org/apache/jmeter/samplers/SampleResult.java
index 5068e79..cf0f152 100644
--- a/jakarta-jmeter/src/core/org/apache/jmeter/samplers/SampleResult.java
+++ b/jakarta-jmeter/src/core/org/apache/jmeter/samplers/SampleResult.java
@@ -53,22 +53,27 @@
  *  <http://www.apache.org/>.
  */
 package org.apache.jmeter.samplers;
-import java.util.*;
-import java.io.*;
-import org.apache.avalon.framework.configuration.*;
-import org.apache.log4j.*;
+import java.io.Serializable;
+import java.util.ArrayList;
+import java.util.HashMap;
+import java.util.HashSet;
+import java.util.List;
+import java.util.Map;
+import java.util.Set;
 
+import org.apache.avalon.framework.configuration.Configuration;
 import org.apache.jmeter.assertions.AssertionResult;
-import org.apache.jmeter.save.SaveService;
 import org.apache.jmeter.testelement.TestElement;
+import org.apache.log.Hierarchy;
+import org.apache.log.Logger;
 
 /**
  *  This is a nice packaging for the various information returned from taking a
  *  sample of an entry.
  *
  *@author     $Author: mstover1 $
- *@created    $Date: 2002/08/11 19:24:47 $
- *@version    $Revision: 1.1 $
+ *@created    $Date: 2002/08/29 18:17:39 $
+ *@version    $Revision: 1.3 $
  */
 public class SampleResult implements Serializable
 {
@@ -122,8 +127,7 @@ public class SampleResult implements Serializable
 	 */
 	private final static String TOTAL_TIME = "totalTime";
 
-	private static transient Category catClass =
-			Category.getInstance(SampleResult.class.getName());
+	transient private static Logger log = Hierarchy.getDefaultHierarchy().getLoggerFor("jmeter.engine");
 
 
 	/**
diff --git a/jakarta-jmeter/src/core/org/apache/jmeter/samplers/gui/CVS/Entries b/jakarta-jmeter/src/core/org/apache/jmeter/samplers/gui/CVS/Entries
index 10515fb..1079733 100644
--- a/jakarta-jmeter/src/core/org/apache/jmeter/samplers/gui/CVS/Entries
+++ b/jakarta-jmeter/src/core/org/apache/jmeter/samplers/gui/CVS/Entries
@@ -1,2 +1,2 @@
-/AbstractSamplerGui.java/1.1/Sun Aug 11 19:24:47 2002//Tv1_7_3
+/AbstractSamplerGui.java/1.1/Sun Aug 11 19:24:47 2002//Tv1_8_1
 D
diff --git a/jakarta-jmeter/src/core/org/apache/jmeter/samplers/gui/CVS/Tag b/jakarta-jmeter/src/core/org/apache/jmeter/samplers/gui/CVS/Tag
index 5f312fe..e2fda28 100644
--- a/jakarta-jmeter/src/core/org/apache/jmeter/samplers/gui/CVS/Tag
+++ b/jakarta-jmeter/src/core/org/apache/jmeter/samplers/gui/CVS/Tag
@@ -1 +1 @@
-Nv1_7_3
+Nv1_8_1
diff --git a/jakarta-jmeter/src/core/org/apache/jmeter/save/CVS/Entries b/jakarta-jmeter/src/core/org/apache/jmeter/save/CVS/Entries
index c3a8f70..ad00679 100644
--- a/jakarta-jmeter/src/core/org/apache/jmeter/save/CVS/Entries
+++ b/jakarta-jmeter/src/core/org/apache/jmeter/save/CVS/Entries
@@ -1,2 +1,4 @@
-/SaveService.java/1.1/Sun Aug 11 19:24:47 2002//Tv1_7_3
-D/old////
+/DataSource.java/1.1/Tue Oct 22 04:13:46 2002//Tv1_8_1
+/SaveService.java/1.11/Wed Jan 29 19:16:16 2003//Tv1_8_1
+/SaveServiceConstants.java/1.1/Wed Jan 29 19:13:54 2003//Tv1_8_1
+D
diff --git a/jakarta-jmeter/src/core/org/apache/jmeter/save/CVS/Tag b/jakarta-jmeter/src/core/org/apache/jmeter/save/CVS/Tag
index 5f312fe..e2fda28 100644
--- a/jakarta-jmeter/src/core/org/apache/jmeter/save/CVS/Tag
+++ b/jakarta-jmeter/src/core/org/apache/jmeter/save/CVS/Tag
@@ -1 +1 @@
-Nv1_7_3
+Nv1_8_1
diff --git a/jakarta-jmeter/src/core/org/apache/jmeter/save/DataSource.java b/jakarta-jmeter/src/core/org/apache/jmeter/save/DataSource.java
new file mode 100644
index 0000000..b9f7647
--- /dev/null
+++ b/jakarta-jmeter/src/core/org/apache/jmeter/save/DataSource.java
@@ -0,0 +1,59 @@
+package org.apache.jmeter.save;
+
+import java.io.IOException;
+import java.util.Collection;
+
+import org.apache.jmeter.samplers.SampleResult;
+import org.apache.jorphan.collections.HashTree;
+
+/**
+ * @author Administrator
+ *
+ * To change this generated comment edit the template variable "typecomment":
+ * Window>Preferences>Java>Templates.
+ */
+public interface DataSource
+{
+	public final static int BASE_INFO_MASK = 1;
+	public final static int EXTRA_INFO_MASK = 1 << 1;
+	public final static int SUB_RESULTS_MASK = 1 << 2;
+	public final static int RESPONSE_MASK = 1 << 3;
+	public final static int REQUEST_DATA_MASK = 1 << 4;
+	public final static int ASSERTION_RESULTS_MASK = 1 << 5;
+	
+	public final static int APPEND = 1;
+	public final static int OVERWRITE = 2;
+	
+	/**
+	 * Opens a file for recording sample results.	 * @param filename The name of the file to record to.  Any attempt to open a file that's
+	 * already been opened will result in an exception	 * @param mode Mode indicates whether the file is opened for appending data to the
+	 * end of the file or overwriting the file contents.	 * @param contentMask - A mask defining what data is recorded.  The options are:<br>
+	 * BASE_INFO_MASK = all the basic data points (label, time, success)<br>
+	 * EXTRA_INFO_MASK = Various miscellaneous data (thread_name, timestamp, response code,
+	 * response message, data type)<br>
+	 * SUB_RESULTS_MASK = Whether to include sub results in the recording.  The level of detail 
+	 * of the sub results will match that chosen for the main result<br>
+	 * RESPONSE_MASK = Whether to store the response data<br>
+	 * REQUEST_DATA_MASK = Records the request data<br>
+	 * ASSERTION_RESULTS_MASK = Record the messages from assertions
+	 * 		 */
+	public void openSource(int mode,int contentMask) throws IOException;
+	
+	/**
+	 * Closes a file that had been opened for recording.  	 * @param filename Name of file to close.	 */
+	public void closeSource() throws IOException;
+	
+	/**
+	 * Load a file of previously recorded sample results and return them all in a collection.	 * @return Collection	 * @throws JMeterSaveException	 */
+	public Collection loadLog() throws IOException;
+	
+	/**
+	 * Load a number of samples from the data source, starting from the next sample.	 * @param length	 * @return Collection	 * @throws IOException	 */
+	public Collection loadLog(int length) throws IOException;
+	
+	/**
+	 * Save a SampleResult object to the specified file.  The file must have been initialized
+	 * with a {@link beginRecording(String,int,int,int)} call.	 * @param filename	 * @param result	 * @throws JMeterSaveException	 */
+	public void recordSample(SampleResult result) throws IOException;
+
+}
diff --git a/jakarta-jmeter/src/core/org/apache/jmeter/save/SaveService.java b/jakarta-jmeter/src/core/org/apache/jmeter/save/SaveService.java
index 46b4aee..8cb4cdd 100644
--- a/jakarta-jmeter/src/core/org/apache/jmeter/save/SaveService.java
+++ b/jakarta-jmeter/src/core/org/apache/jmeter/save/SaveService.java
@@ -1,420 +1,688 @@
+/*
+ * ====================================================================
+ * The Apache Software License, Version 1.1
+ *
+ * Copyright (c) 2001 The Apache Software Foundation.  All rights
+ * reserved.
+ *
+ * Redistribution and use in source and binary forms, with or without
+ * modification, are permitted provided that the following conditions
+ * are met:
+ *
+ * 1. Redistributions of source code must retain the above copyright
+ * notice, this list of conditions and the following disclaimer.
+ *
+ * 2. Redistributions in binary form must reproduce the above copyright
+ * notice, this list of conditions and the following disclaimer in
+ * the documentation and/or other materials provided with the
+ * distribution.
+ *
+ * 3. The end-user documentation included with the redistribution,
+ * if any, must include the following acknowledgment:
+ * "This product includes software developed by the
+ * Apache Software Foundation (http://www.apache.org/)."
+ * Alternately, this acknowledgment may appear in the software itself,
+ * if and wherever such third-party acknowledgments normally appear.
+ *
+ * 4. The names "Apache" and "Apache Software Foundation" and
+ * "Apache JMeter" must not be used to endorse or promote products
+ * derived from this software without prior written permission. For
+ * written permission, please contact apache@apache.org.
+ *
+ * 5. Products derived from this software may not be called "Apache",
+ * "Apache JMeter", nor may "Apache" appear in their name, without
+ * prior written permission of the Apache Software Foundation.
+ *
+ * THIS SOFTWARE IS PROVIDED ``AS IS'' AND ANY EXPRESSED OR IMPLIED
+ * WARRANTIES, INCLUDING, BUT NOT LIMITED TO, THE IMPLIED WARRANTIES
+ * OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE ARE
+ * DISCLAIMED.  IN NO EVENT SHALL THE APACHE SOFTWARE FOUNDATION OR
+ * ITS CONTRIBUTORS BE LIABLE FOR ANY DIRECT, INDIRECT, INCIDENTAL,
+ * SPECIAL, EXEMPLARY, OR CONSEQUENTIAL DAMAGES (INCLUDING, BUT NOT
+ * LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES; LOSS OF
+ * USE, DATA, OR PROFITS; OR BUSINESS INTERRUPTION) HOWEVER CAUSED AND
+ * ON ANY THEORY OF LIABILITY, WHETHER IN CONTRACT, STRICT LIABILITY,
+ * OR TORT (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT
+ * OF THE USE OF THIS SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF
+ * SUCH DAMAGE.
+ * ====================================================================
+ *
+ * This software consists of voluntary contributions made by many
+ * individuals on behalf of the Apache Software Foundation.  For more
+ * information on the Apache Software Foundation, please see
+ * <http://www.apache.org/>.
+ */
 package org.apache.jmeter.save;
 
-import java.io.File;
-import java.io.FileWriter;
-import java.io.IOException;
-import java.io.InputStream;
-import java.io.OutputStream;
-import java.io.PrintWriter;
-import java.io.UnsupportedEncodingException;
+import java.io.*;
+import java.text.SimpleDateFormat;
 import java.util.Collection;
+import java.util.Date;
 import java.util.Iterator;
 import java.util.LinkedList;
 import java.util.List;
+import java.util.Properties;
 
 import junit.framework.TestCase;
+
 import org.apache.avalon.framework.configuration.Configuration;
 import org.apache.avalon.framework.configuration.ConfigurationException;
 import org.apache.avalon.framework.configuration.DefaultConfiguration;
 import org.apache.avalon.framework.configuration.DefaultConfigurationBuilder;
 import org.apache.avalon.framework.configuration.DefaultConfigurationSerializer;
-import org.apache.jmeter.assertions.ResponseAssertion;
 import org.apache.jmeter.assertions.AssertionResult;
 import org.apache.jmeter.samplers.SampleResult;
 import org.apache.jmeter.testelement.TestElement;
-import org.apache.jmeter.util.ListedHashTree;
+import org.apache.jmeter.util.JMeterUtils;
+import org.apache.log.Hierarchy;
+import org.apache.log.Logger;
+import org.apache.jorphan.collections.HashTree;
+import org.apache.jorphan.collections.ListedHashTree;
 import org.xml.sax.SAXException;
-/**
- * <p>Title: </p>
- * <p>Description: </p>
- * <p>Copyright: Copyright (c) 2001</p>
- * <p>Company: </p>
- * @author unascribed
- * @version 1.0
- */
 
-public class SaveService
+/************************************************************
+ *  This class provides a means for saving test results.  Test
+ *  results are typically saved in an XML file, but other
+ *  storage mechanisms may also be used, for instance, CSV
+ *  files or databases.
+ *
+ *@author     <a href="mailto:kcassell&#X0040;apache.org">Keith Cassell</a>
+ *@created    $Date: 2003/01/29 19:16:16 $
+ *@version    $Revision: 1.11 $ $Date: 2003/01/29 19:16:16 $
+ ***********************************************************/
+
+public class SaveService implements SaveServiceConstants
 {
-	private static final String ASSERTION_RESULT_TAG_NAME = "assertionResult";
-	private static final String SAMPLE_RESULT_TAG_NAME = "sampleResult";
-	private static final String TIME = "time";
-	private static final String LABEL = "label";
-	private static final String RESPONSE_CODE = "responseCode";
-	private static final String RESPONSE_MESSAGE = "responseMessage";
-	private static final String THREAD_NAME = "threadName";
-	private static final String DATA_TYPE = "dataType";
-	private static final String TIME_STAMP = "timeStamp";
-	private static final String BINARY = "binary";
-	private static final String FAILURE_MESSAGE = "failureMessage";
-	private static final String ERROR = "error";
-	private static final String FAILURE = "failure";
-	private static final String SUCCESSFUL = "success";
-	
-	private static DefaultConfigurationBuilder builder = new DefaultConfigurationBuilder();
-
-	public SaveService()
-	{
-	}
-
-	public static void saveSubTree(ListedHashTree subTree,OutputStream writer) throws
-			IOException
-	{
-		Configuration config = (Configuration)getConfigsFromTree(subTree).get(0);
-		DefaultConfigurationSerializer saver = new DefaultConfigurationSerializer();
-		saver.setIndent(true);
-		try
-		{
-			saver.serialize(writer,config);
-		}
-		catch(SAXException e)
-		{
-			throw new IOException("SAX implementation problem");
-		}
-		catch(ConfigurationException e)
-		{
-			throw new IOException("Problem using Avalon Configuration tools");
-		}
-	}
-	
-	public static SampleResult getSampleResult(Configuration config)
-	{
-		SampleResult result = new SampleResult();
-		result.setThreadName(config.getAttribute(THREAD_NAME,""));
-		result.setDataType(config.getAttribute(DATA_TYPE,""));
-		result.setResponseCode(config.getAttribute(RESPONSE_CODE,""));
-		result.setResponseMessage(config.getAttribute(RESPONSE_MESSAGE,""));
-		result.setTime(config.getAttributeAsLong(TIME,0L));
-		result.setTimeStamp(config.getAttributeAsLong(TIME_STAMP,0L));
-		result.setSuccessful(config.getAttributeAsBoolean(SUCCESSFUL,false));
-		result.setSampleLabel(config.getAttribute(LABEL,""));
-		result.setResponseData(getBinaryData(config.getChild(BINARY)));
-		Configuration[] subResults = config.getChildren(SAMPLE_RESULT_TAG_NAME);
-		for(int i = 0;i < subResults.length;i++)
-		{
-			result.addSubResult(getSampleResult(subResults[i]));
-		}
-		Configuration[] assResults = config.getChildren(ASSERTION_RESULT_TAG_NAME);
-		for(int i = 0;i < assResults.length;i++)
-		{
-			result.addAssertionResult(getAssertionResult(assResults[i]));
-		}
-		return result;
-	}
-
-	private static List getConfigsFromTree(ListedHashTree subTree)
-	{
-		Iterator iter = subTree.list().iterator();
-		List configs = new LinkedList();
-		while (iter.hasNext())
-		{
-			TestElement item = (TestElement)iter.next();
-			DefaultConfiguration config = new DefaultConfiguration("node","node");
-			config.addChild(getConfigForTestElement(null,item));
-			List configList = getConfigsFromTree(subTree.get(item));
-			Iterator iter2 = configList.iterator();
-			while(iter2.hasNext())
-			{
-				config.addChild((Configuration)iter2.next());
-			}
-			configs.add(config);
-		}
-		return configs;
-	}
-	
-	public static Configuration getConfiguration(byte[] bin)
-	{
-		DefaultConfiguration config = new DefaultConfiguration(BINARY,"JMeter Save Service");
-		try {
-			config.setValue(new String(bin,"utf-8"));
-		} catch(UnsupportedEncodingException e) {
-			e.printStackTrace();
-		}
-		return config;
-	}
-	
-	public static byte[] getBinaryData(Configuration config)
-	{
-		if(config == null)
-		{
-			return new byte[0];
-		}
-		try {
-			return config.getValue("").getBytes("utf-8");
-		} catch(UnsupportedEncodingException e) {
-			return new byte[0];
-		}
-	}
-	
-	public static AssertionResult getAssertionResult(Configuration config)
-	{
-		AssertionResult result = new AssertionResult();
-		result.setError(config.getAttributeAsBoolean(ERROR,false));
-		result.setFailure(config.getAttributeAsBoolean(FAILURE,false));
-		result.setFailureMessage(config.getAttribute(FAILURE_MESSAGE,""));
-		return result;		
-	}
-	
-	public static Configuration getConfiguration(AssertionResult assResult)
-	{
-		DefaultConfiguration config = new DefaultConfiguration(ASSERTION_RESULT_TAG_NAME,
-				"JMeter Save Service");
-		config.setAttribute(FAILURE_MESSAGE,assResult.getFailureMessage());
-		config.setAttribute(ERROR,""+assResult.isError());
-		config.setAttribute(FAILURE,""+assResult.isFailure());
-		return config;		
-	}
-	
-	public static Configuration getConfiguration(SampleResult result,boolean funcTest)
-	{
-		DefaultConfiguration config = new DefaultConfiguration(SAMPLE_RESULT_TAG_NAME,"JMeter Save Service");
-		config.setAttribute(TIME,""+result.getTime());
-		config.setAttribute(LABEL,result.getSampleLabel());
-		config.setAttribute(RESPONSE_CODE,result.getResponseCode());
-		config.setAttribute(RESPONSE_MESSAGE,result.getResponseMessage());
-		config.setAttribute(THREAD_NAME,result.getThreadName());
-		config.setAttribute(DATA_TYPE,result.getDataType());
-		config.setAttribute(TIME_STAMP,""+result.getTimeStamp());
-		config.setAttribute(SUCCESSFUL,new Boolean(result.isSuccessful()).toString());
-		SampleResult[] subResults = result.getSubResults();
-		for(int i = 0;i < subResults.length;i++)
-		{
-			config.addChild(getConfiguration(subResults[i],funcTest));
-		}
-		if(funcTest)
-		{
-			config.addChild(getConfigForTestElement(null,result.getSamplerData()));
-			AssertionResult[] assResults = result.getAssertionResults();
-			for(int i = 0;i < assResults.length;i++)
-			{
-				config.addChild(getConfiguration(assResults[i]));
-			}
-			config.addChild(getConfiguration(result.getResponseData()));
-		}
-		return config;		
-	}
-
-	public static Configuration getConfigForTestElement(String named,TestElement item)
-	{
-		DefaultConfiguration config = new DefaultConfiguration("testelement","testelement");
-		if(named != null)
-		{
-			config.setAttribute("name",named);
-		}
-		if(item.getProperty(TestElement.TEST_CLASS) != null)
-		{
-			config.setAttribute("class",(String)item.getProperty(TestElement.TEST_CLASS));
-		}
-		else
-		{
-			config.setAttribute("class",item.getClass().getName());
-		}
-		Iterator iter = item.getPropertyNames().iterator();
-		while (iter.hasNext())
-		{
-			String name = (String)iter.next();
-			Object value = item.getProperty(name);
-			if(value instanceof TestElement)
-			{
-				config.addChild(getConfigForTestElement(name,(TestElement)value));
-			}
-			else if(value instanceof Collection)
-			{
-				config.addChild(createConfigForCollection(name,(Collection)value));
-			}
-			else if(value != null)
-			{
-				config.addChild(createConfigForString(name,value.toString()));
-			}
-		}
-		return config;
-	}
-
-	private static Configuration createConfigForCollection(String propertyName,Collection list)
-	{
-		DefaultConfiguration config = new DefaultConfiguration("collection","collection");
-		if(propertyName != null)
-		{
-			config.setAttribute("name",propertyName);
-		}
-		config.setAttribute("class",list.getClass().getName());
-		Iterator iter = list.iterator();
-		while (iter.hasNext())
-		{
-			Object item = iter.next();
-			if(item instanceof TestElement)
-			{
-				config.addChild(getConfigForTestElement(null,(TestElement)item));
-			}
-			else if(item instanceof Collection)
-			{
-				config.addChild(createConfigForCollection(null,(Collection)item));
-			}
-			else
-			{
-				config.addChild(createConfigForString(item.toString()));
-			}
-		}
-		return config;
-	}
-
-	private static Configuration createConfigForString(String value)
-	{
-		DefaultConfiguration config = new DefaultConfiguration("string","string");
-		config.setValue(value);
-		return config;
-	}
-
-	private static Configuration createConfigForString(String name,String value)
-	{
-		if(value == null || value.equals(""))
-		{
-			value = " ";
-		}
-		DefaultConfiguration config = new DefaultConfiguration("property","property");
-		config.setAttribute("name",name);
-		config.setValue(value);
-		return config;
-	}
-
-	public synchronized static ListedHashTree loadSubTree(InputStream in) throws IOException
-	{
-		try
-		{
-			Configuration config = builder.build(in);
-			ListedHashTree loadedTree = generateNode(config);
-			return loadedTree;
-		}
-		catch(ConfigurationException e)
-		{
-			throw new IOException("Problem loading using Avalon Configuration tools");
-		}
-		catch(SAXException e)
-		{
-			throw new IOException("Problem with SAX implementation");
-		}
-	}
-
-	public static TestElement createTestElement(Configuration config) throws ConfigurationException,
-			ClassNotFoundException, IllegalAccessException,InstantiationException
-	{
-		TestElement element = null;
-		try
-		{
-			element = (TestElement)Class.forName((String)config.getAttribute("class")).newInstance();
-		}
-		catch(InstantiationException e)
-		{
-			//Assertion is now an interface, replaced with ResponseAssertion
-			if(config.getAttribute("class").equals("org.apache.jmeter.assertions.Assertion"))
-			{
-				element = new ResponseAssertion();
-			}
-		}
-		Configuration[] children = config.getChildren();
-		for (int i = 0; i < children.length; i++)
-		{
-			if(children[i].getName().equals("property"))
-			{
-				try
-				{
-					element.setProperty(children[i].getAttribute("name"),
-						children[i].getValue());
-				}
-				catch (Exception ex)
-				{
-					element.setProperty(children[i].getAttribute("name"),"");
-				}
-			}
-			else if(children[i].getName().equals("testelement"))
-			{
-				element.setProperty(children[i].getAttribute("name"),
-						createTestElement(children[i]));
-			}
-			else if(children[i].getName().equals("collection"))
-			{
-				element.setProperty(children[i].getAttribute("name"),
-						createCollection(children[i]));
-			}
-		}
-		return element;
-	}
-
-	private static Collection createCollection(Configuration config) throws ConfigurationException,
-			ClassNotFoundException,IllegalAccessException,InstantiationException
-	{
-		Collection coll = (Collection)Class.forName((String)config.getAttribute("class")).newInstance();
-		Configuration[] items = config.getChildren();
-		for (int i = 0; i < items.length; i++)
-		{
-			if(items[i].getName().equals("property"))
-			{
-				coll.add(items[i].getValue());
-			}
-			else if(items[i].getName().equals("testelement"))
-			{
-				coll.add(createTestElement(items[i]));
-			}
-			else if(items[i].getName().equals("collection"))
-			{
-				coll.add(createCollection(items[i]));
-			}
-			else if(items[i].getName().equals("string"))
-			{
-				coll.add(items[i].getValue());
-			}
-		}
-		return coll;
-	}
-
-	private static ListedHashTree generateNode(Configuration config)
-	{
-		TestElement element = null;
-		try
-		{
-			element = createTestElement(config.getChild("testelement"));
-		}
-		catch(Exception e)
-		{
-			try{
-				PrintWriter logger = new PrintWriter(new FileWriter("c:\\log.txt"));
-			e.printStackTrace(logger);
-			logger.close();
-			System.out.println("Problem loading part of file");
-			}catch(Exception err){}
-			return null;
-		}
-		ListedHashTree subTree = new ListedHashTree(element);
-		Configuration[] subNodes = config.getChildren("node");
-		for (int i = 0; i < subNodes.length; i++)
-		{
-			ListedHashTree t = generateNode(subNodes[i]);
-			if(t != null)
-			{
-				subTree.add(element,t);
-			}
-		}
-		return subTree;
-	}
-	
-	public static class Test extends TestCase
-	{
-		private File assertionFile;
-		public Test(String name)
-		{
-			super(name);
-		}
-		
-		public void setUp() {
-			assertionFile =
-				new File(System.getProperty("user.dir") + "/testfiles", "assertion.jmx");
-			
-		}
-		
-		public void testLoadAssertion() throws Exception
-		{
-			Configuration config = new DefaultConfigurationBuilder().buildFromFile(assertionFile);
-			ResponseAssertion testEl = (ResponseAssertion)createTestElement(config.getChild("testelement"));
-			assertEquals("save this string \\d+",testEl.getTestStrings().get(0));
-		}
-	}
-}
\ No newline at end of file
+        transient private static Logger log =
+        Hierarchy.getDefaultHierarchy().getLoggerFor("jmeter.util");
+
+        protected static final int SAVE_NO_ASSERTIONS = 0;
+        protected static final int SAVE_FIRST_ASSERTION = SAVE_NO_ASSERTIONS + 1;
+        protected static final int SAVE_ALL_ASSERTIONS = SAVE_FIRST_ASSERTION + 1;;
+
+        /** A formatter for the time stamp.  **/
+        protected static SimpleDateFormat formatter = null;
+
+        /** A flag to indicate whether the data type should
+            be saved to the test results.  **/
+        protected static boolean saveDataType = true;
+
+        /** A flag to indicate whether the label should
+            be saved to the test results.  **/
+        protected static boolean saveLabel = true;
+
+        /** A flag to indicate whether the response code should
+            be saved to the test results.  **/
+        protected static boolean saveResponseCode = false;
+
+        /** A flag to indicate whether the response data should
+            be saved to the test results.  **/
+        protected static boolean saveResponseData = false;
+
+        /** A flag to indicate whether the response message should
+            be saved to the test results.  **/
+        protected static boolean saveResponseMessage = false;
+
+        /** A flag to indicate whether the success indicator should
+            be saved to the test results.  **/
+        protected static boolean saveSuccessful = true;
+
+        /** A flag to indicate whether the thread name should
+            be saved to the test results.  **/
+        protected static boolean saveThreadName = true;
+
+        /** A flag to indicate whether the time should
+            be saved to the test results.  **/
+        protected static boolean saveTime = true;
+
+        /** A flag to indicate the format of the time stamp within
+            the test results.  **/
+        protected static String timeStampFormat = MILLISECONDS;
+
+        /** A flag to indicate whether the time stamp should be printed
+            in milliseconds.  **/
+        protected static boolean printMilliseconds = true;
+
+        /** A flag to indicate which assertion results should
+            be saved to the test results.  Legitimate values include
+            none, first, all.  **/
+        protected static String whichAssertionResults = FIRST;
+
+        protected static int assertionsResultsToSave = SAVE_NO_ASSERTIONS;
+
+        
+        private static DefaultConfigurationBuilder builder = new DefaultConfigurationBuilder();
+
+
+        // Initialize various variables based on properties.
+        static
+        {
+                readAndSetSaveProperties();
+        }       // static initialization
+
+
+        public SaveService()
+        {
+        }
+
+        protected static void readAndSetSaveProperties()
+        {
+                Properties systemProps = System.getProperties();
+                Properties props = new Properties(systemProps);
+
+                try
+                {
+                        props = JMeterUtils.getProperties(PROPS_FILE);
+                }
+                catch (Exception e)
+                {
+                        log.error("SaveService.readAndSetSaveProperties: Problem loading properties file " + PROPS_FILE, e);
+                }
+
+                saveDataType =
+                        TRUE.equalsIgnoreCase(props.getProperty(SAVE_DATA_TYPE_PROP,
+                                                                TRUE));
+                saveLabel =
+                        TRUE.equalsIgnoreCase(props.getProperty(SAVE_LABEL_PROP,
+                                                                TRUE));
+                saveResponseCode =
+                        TRUE.equalsIgnoreCase(props.getProperty(SAVE_RESPONSE_CODE_PROP,
+                                                                TRUE));
+                saveResponseData =
+                        TRUE.equalsIgnoreCase(props.getProperty(SAVE_RESPONSE_DATA_PROP,
+                                                                FALSE));
+                saveResponseMessage =
+                        TRUE.equalsIgnoreCase(props.getProperty(SAVE_RESPONSE_MESSAGE_PROP,
+                                                                TRUE));
+                saveSuccessful =
+                        TRUE.equalsIgnoreCase(props.getProperty(SAVE_SUCCESSFUL_PROP,
+                                                                TRUE));
+                saveThreadName =
+                        TRUE.equalsIgnoreCase(props.getProperty(SAVE_THREAD_NAME_PROP,
+                                                                TRUE));
+                saveTime =
+                        TRUE.equalsIgnoreCase(props.getProperty(SAVE_TIME_PROP,
+                                                                TRUE));
+                timeStampFormat =
+                        props.getProperty(TIME_STAMP_FORMAT_PROP, MILLISECONDS);
+                printMilliseconds = MILLISECONDS.equalsIgnoreCase(timeStampFormat);
+                // 
+                if (!printMilliseconds
+                    && !NONE.equalsIgnoreCase(timeStampFormat)
+                    && (timeStampFormat != null))
+                {
+                        formatter = new SimpleDateFormat(timeStampFormat);
+                }
+
+                whichAssertionResults = props.getProperty(ASSERTION_RESULTS_PROP,
+                                                          NONE);
+
+                if (NONE.equals(whichAssertionResults))
+                {
+                        assertionsResultsToSave = SAVE_NO_ASSERTIONS;
+                }
+                else if (FIRST.equals(whichAssertionResults))
+                {
+                        assertionsResultsToSave = SAVE_FIRST_ASSERTION;
+                }
+                else if (ALL.equals(whichAssertionResults))
+                {
+                        assertionsResultsToSave = SAVE_ALL_ASSERTIONS;
+                }
+        }
+
+
+        public static void saveSubTree(HashTree subTree,OutputStream writer) throws
+                        IOException
+        {
+                Configuration config = (Configuration)getConfigsFromTree(subTree).get(0);
+                DefaultConfigurationSerializer saver = new DefaultConfigurationSerializer();
+                saver.setIndent(true);
+                try
+                {
+                        saver.serialize(writer,config);
+                }
+                catch(SAXException e)
+                {
+                        throw new IOException("SAX implementation problem");
+                }
+                catch(ConfigurationException e)
+                {
+                        throw new IOException("Problem using Avalon Configuration tools");
+                }
+        }
+        
+        public static SampleResult getSampleResult(Configuration config)
+        {
+                SampleResult result = new SampleResult();
+                result.setThreadName(config.getAttribute(THREAD_NAME,""));
+                result.setDataType(config.getAttribute(DATA_TYPE,""));
+                result.setResponseCode(config.getAttribute(RESPONSE_CODE,""));
+                result.setResponseMessage(config.getAttribute(RESPONSE_MESSAGE,""));
+                result.setTime(config.getAttributeAsLong(TIME,0L));
+                result.setTimeStamp(config.getAttributeAsLong(TIME_STAMP,0L));
+                result.setSuccessful(config.getAttributeAsBoolean(SUCCESSFUL,false));
+                result.setSampleLabel(config.getAttribute(LABEL,""));
+                result.setResponseData(getBinaryData(config.getChild(BINARY)));
+                Configuration[] subResults = config.getChildren(SAMPLE_RESULT_TAG_NAME);
+                for(int i = 0;i < subResults.length;i++)
+                {
+                        result.addSubResult(getSampleResult(subResults[i]));
+                }
+                Configuration[] assResults = config.getChildren(ASSERTION_RESULT_TAG_NAME);
+                for(int i = 0;i < assResults.length;i++)
+                {
+                        result.addAssertionResult(getAssertionResult(assResults[i]));
+                }
+                return result;
+        }
+
+        private static List getConfigsFromTree(HashTree subTree)
+        {
+                Iterator iter = subTree.list().iterator();
+                List configs = new LinkedList();
+                while (iter.hasNext())
+                {
+                        TestElement item = (TestElement)iter.next();
+                        DefaultConfiguration config = new DefaultConfiguration("node","node");
+                        config.addChild(getConfigForTestElement(null,item));
+                        List configList = getConfigsFromTree(subTree.getTree(item));
+                        Iterator iter2 = configList.iterator();
+                        while(iter2.hasNext())
+                        {
+                                config.addChild((Configuration)iter2.next());
+                        }
+                        configs.add(config);
+                }
+                return configs;
+        }
+        
+        public static Configuration getConfiguration(byte[] bin)
+        {
+                DefaultConfiguration config = new DefaultConfiguration(BINARY,"JMeter Save Service");
+                try {
+                        config.setValue(new String(bin,"utf-8"));
+                } catch(UnsupportedEncodingException e) {
+                        log.error("",e);
+                }
+                return config;
+        }
+        
+        public static byte[] getBinaryData(Configuration config)
+        {
+                if(config == null)
+                {
+                        return new byte[0];
+                }
+                try {
+                        return config.getValue("").getBytes("utf-8");
+                } catch(UnsupportedEncodingException e) {
+                        return new byte[0];
+                }
+        }
+        
+        public static AssertionResult getAssertionResult(Configuration config)
+        {
+                AssertionResult result = new AssertionResult();
+                result.setError(config.getAttributeAsBoolean(ERROR,false));
+                result.setFailure(config.getAttributeAsBoolean(FAILURE,false));
+                result.setFailureMessage(config.getAttribute(FAILURE_MESSAGE,""));
+                return result;          
+        }
+        
+        public static Configuration getConfiguration(AssertionResult assResult)
+        {
+                DefaultConfiguration config = new DefaultConfiguration(ASSERTION_RESULT_TAG_NAME,
+                                "JMeter Save Service");
+                config.setAttribute(FAILURE_MESSAGE,assResult.getFailureMessage());
+                config.setAttribute(ERROR,""+assResult.isError());
+                config.setAttribute(FAILURE,""+assResult.isFailure());
+                return config;          
+        }
+        
+
+        /**
+           This method determines the content of the result data that
+               will be stored.
+           @param result the object containing all of the data that has
+               been collected.
+           @param funcTest an indicator of whether the user wants all
+               data recorded.
+        **/
+
+        public static Configuration getConfiguration(SampleResult result,boolean funcTest)
+        {
+                DefaultConfiguration config = new DefaultConfiguration(SAMPLE_RESULT_TAG_NAME,"JMeter Save Service");
+
+                if (saveTime)
+                {
+                        config.setAttribute(TIME,""+result.getTime());
+                }
+                if (saveLabel)
+                {
+                        config.setAttribute(LABEL,result.getSampleLabel());
+                }
+                if (saveResponseCode)
+                {
+                        config.setAttribute(RESPONSE_CODE,result.getResponseCode());
+                }
+                if (saveResponseMessage)
+                {
+                        config.setAttribute(RESPONSE_MESSAGE,result.getResponseMessage());
+                }
+                if (saveThreadName)
+                {
+                        config.setAttribute(THREAD_NAME,result.getThreadName());
+                }
+                if (saveDataType)
+                {
+                        config.setAttribute(DATA_TYPE,result.getDataType());
+                }
+
+                if (printMilliseconds)
+                {
+                        config.setAttribute(TIME_STAMP,""+result.getTimeStamp());
+                }
+                else if (formatter != null)
+                {
+                        String stamp = formatter.format(new Date(result.getTimeStamp()));
+                        config.setAttribute(TIME_STAMP, stamp);
+                }
+
+                if (saveSuccessful)
+                {
+                        config.setAttribute(SUCCESSFUL,new Boolean(result.isSuccessful()).toString());
+                }
+
+                SampleResult[] subResults = result.getSubResults();
+                for(int i = 0;i < subResults.length;i++)
+                {
+                        config.addChild(getConfiguration(subResults[i],funcTest));
+                }
+
+                AssertionResult[] assResults = result.getAssertionResults();
+
+                if(funcTest)
+                {
+                        config.addChild(getConfigForTestElement(null,result.getSamplerData()));
+                        for(int i = 0;i < assResults.length;i++)
+                        {
+                                config.addChild(getConfiguration(assResults[i]));
+                        }
+                        config.addChild(getConfiguration(result.getResponseData()));
+                }
+                // Determine which of the assertion results to save and
+                // whether to save the response data
+                else
+                {
+                        if (assertionsResultsToSave == SAVE_ALL_ASSERTIONS)
+                        {
+                                config.addChild(getConfigForTestElement(null,result.getSamplerData()));
+                                for(int i = 0;i < assResults.length;i++)
+                                {
+                                        config.addChild(getConfiguration(assResults[i]));
+                                }
+                        }
+                        else if ((assertionsResultsToSave == SAVE_FIRST_ASSERTION)
+                                 && assResults.length > 0)
+                        {
+                                config.addChild(getConfiguration(assResults[0]));
+                        }
+
+                        if (saveResponseData)
+                        {
+                                config.addChild(getConfiguration(result.getResponseData()));
+                        }
+                }
+                return config;          
+        }
+
+        public static Configuration getConfigForTestElement(String named,TestElement item)
+        {
+                DefaultConfiguration config = new DefaultConfiguration("testelement","testelement");
+                if(named != null)
+                {
+                        config.setAttribute("name",named);
+                }
+                if(item.getProperty(TestElement.TEST_CLASS) != null)
+                {
+                        config.setAttribute("class",(String)item.getProperty(TestElement.TEST_CLASS));
+                }
+                else
+                {
+                        config.setAttribute("class",item.getClass().getName());
+                }
+                Iterator iter = item.getPropertyNames().iterator();
+                while (iter.hasNext())
+                {
+                        String name = (String)iter.next();
+                        Object value = item.getProperty(name);
+                        if(value instanceof TestElement)
+                        {
+                                config.addChild(getConfigForTestElement(name,(TestElement)value));
+                        }
+                        else if(value instanceof Collection)
+                        {
+                                config.addChild(createConfigForCollection(name,(Collection)value));
+                        }
+                        else if(value != null)
+                        {
+                                config.addChild(createConfigForString(name,value.toString()));
+                        }
+                }
+                return config;
+        }
+
+        private static Configuration createConfigForCollection(String propertyName,Collection list)
+        {
+                DefaultConfiguration config = new DefaultConfiguration("collection","collection");
+                if(propertyName != null)
+                {
+                        config.setAttribute("name",propertyName);
+                }
+                config.setAttribute("class",list.getClass().getName());
+                Iterator iter = list.iterator();
+                while (iter.hasNext())
+                {
+                        Object item = iter.next();
+                        if(item instanceof TestElement)
+                        {
+                                config.addChild(getConfigForTestElement(null,(TestElement)item));
+                        }
+                        else if(item instanceof Collection)
+                        {
+                                config.addChild(createConfigForCollection(null,(Collection)item));
+                        }
+                        else
+                        {
+                                config.addChild(createConfigForString(item.toString()));
+                        }
+                }
+                return config;
+        }
+
+        private static Configuration createConfigForString(String value)
+        {
+                DefaultConfiguration config = new DefaultConfiguration("string","string");
+                config.setValue(value);
+                config.setAttribute(XML_SPACE,PRESERVE);
+                return config;
+        }
+
+        private static Configuration createConfigForString(String name,String value)
+        {
+                if(value == null)
+                {
+                        value = "";
+                }
+                DefaultConfiguration config = new DefaultConfiguration("property","property");
+                config.setAttribute("name",name);
+                config.setValue(value);
+                config.setAttribute(XML_SPACE,PRESERVE);
+                return config;
+        }
+
+        public synchronized static HashTree loadSubTree(InputStream in) throws IOException
+        {
+                try
+                {
+                        Configuration config = builder.build(in);
+                        HashTree loadedTree = generateNode(config);
+                        return loadedTree;
+                }
+                catch(ConfigurationException e)
+                {
+                        throw new IOException("Problem loading using Avalon Configuration tools");
+                }
+                catch(SAXException e)
+                {
+                        throw new IOException("Problem with SAX implementation");
+                }
+        }
+
+        public static TestElement createTestElement(Configuration config) throws ConfigurationException,
+                        ClassNotFoundException, IllegalAccessException,InstantiationException
+        {
+                TestElement element = null;
+                element = (TestElement)Class.forName((String)config.getAttribute("class")).newInstance();
+                Configuration[] children = config.getChildren();
+                for (int i = 0; i < children.length; i++)
+                {
+                        if(children[i].getName().equals("property"))
+                        {
+                                try
+                                {
+                                        element.setProperty(children[i].getAttribute("name"),
+                                                children[i].getValue());
+                                }
+                                catch (Exception ex)
+                                {
+                                        log.error("Problem loading property",ex);
+                                        element.setProperty(children[i].getAttribute("name"),"");
+                                }
+                        }
+                        else if(children[i].getName().equals("testelement"))
+                        {
+                                element.setProperty(children[i].getAttribute("name"),
+                                                createTestElement(children[i]));
+                        }
+                        else if(children[i].getName().equals("collection"))
+                        {
+                                element.setProperty(children[i].getAttribute("name"),
+                                                createCollection(children[i]));
+                        }
+                }
+                return element;
+        }
+
+        private static Collection createCollection(Configuration config) throws ConfigurationException,
+                        ClassNotFoundException,IllegalAccessException,InstantiationException
+        {
+                Collection coll = (Collection)Class.forName((String)config.getAttribute("class")).newInstance();
+                Configuration[] items = config.getChildren();
+                for (int i = 0; i < items.length; i++)
+                {
+                        if(items[i].getName().equals("property"))
+                        {
+                                coll.add(items[i].getValue(""));
+                        }
+                        else if(items[i].getName().equals("testelement"))
+                        {
+                                coll.add(createTestElement(items[i]));
+                        }
+                        else if(items[i].getName().equals("collection"))
+                        {
+                                coll.add(createCollection(items[i]));
+                        }
+                        else if(items[i].getName().equals("string"))
+                        {
+                                coll.add(items[i].getValue(""));
+                        }
+                }
+                return coll;
+        }
+
+        private static HashTree generateNode(Configuration config)
+        {
+                TestElement element = null;
+                try
+                {
+                        element = createTestElement(config.getChild("testelement"));
+                }
+                catch(Exception e)
+                {
+                        log.error("Problem loading part of file",e);
+                        return null;
+                }
+                HashTree subTree = new ListedHashTree(element);
+                Configuration[] subNodes = config.getChildren("node");
+                for (int i = 0; i < subNodes.length; i++)
+                {
+                        HashTree t = generateNode(subNodes[i]);
+                        if(t != null)
+                        {
+                                subTree.add(element,t);
+                        }
+                }
+                return subTree;
+        }
+        
+        public static class Test extends TestCase
+        {
+                private static final String[] FILES= new String[]
+                {
+                  "AssertionTestPlan.jmx",
+                  "AuthManagerTestPlan.jmx",
+                  "HeaderManagerTestPlan.jmx",
+                  "InterleaveTestPlan2.jmx",
+                  "InterleaveTestPlan.jmx",
+                  "LoopTestPlan.jmx",
+                  "Modification Manager.jmx",
+                  "OnceOnlyTestPlan.jmx",
+                  "proxy.jmx",
+                  "ProxyServerTestPlan.jmx",
+                  "SimpleTestPlan.jmx",
+                };
+
+                public Test(String name)
+                {
+                        super(name);
+                }
+                
+                public void setUp() {
+                }
+
+                public void testLoadAndSave() throws java.io.IOException {
+                  byte[] original= new byte[1000000];
+
+                  for (int i=0; i<FILES.length; i++) {
+                    InputStream in= new FileInputStream(new File("testfiles/"+FILES[i]));
+                    int len= in.read(original);
+                    in.close();
+
+                    in= new ByteArrayInputStream(original, 0, len);
+                    HashTree tree= loadSubTree(in);
+                    in.close();
+
+                    ByteArrayOutputStream out= new ByteArrayOutputStream(1000000);
+                    saveSubTree(tree, out);
+                    out.close();
+
+                    // We only check the length of the result. Comparing the
+                    // actual result (out.toByteArray==original) will usually
+                    // fail, because the order of the properties within each
+                    // test element may change. Comparing the lengths should be
+                    // enough to detect most problem cases...
+                    if (len!=out.size()) {
+                      fail("Loading file bin/testfiles/"+FILES[i]+" and "+
+                          "saving it back changes its contents.");
+                    }
+
+                    // Note this test will fail if a property is added or
+                    // removed to any of the components used in the test
+                    // files. The way to solve this is to appropriately change
+                    // the test file.
+                  }
+                }
+        }
+}
diff --git a/jakarta-jmeter/src/core/org/apache/jmeter/save/SaveServiceConstants.java b/jakarta-jmeter/src/core/org/apache/jmeter/save/SaveServiceConstants.java
new file mode 100644
index 0000000..9bb8a1e
--- /dev/null
+++ b/jakarta-jmeter/src/core/org/apache/jmeter/save/SaveServiceConstants.java
@@ -0,0 +1,178 @@
+/*
+ * ====================================================================
+ * The Apache Software License, Version 1.1
+ *
+ * Copyright (c) 2001 The Apache Software Foundation.  All rights
+ * reserved.
+ *
+ * Redistribution and use in source and binary forms, with or without
+ * modification, are permitted provided that the following conditions
+ * are met:
+ *
+ * 1. Redistributions of source code must retain the above copyright
+ * notice, this list of conditions and the following disclaimer.
+ *
+ * 2. Redistributions in binary form must reproduce the above copyright
+ * notice, this list of conditions and the following disclaimer in
+ * the documentation and/or other materials provided with the
+ * distribution.
+ *
+ * 3. The end-user documentation included with the redistribution,
+ * if any, must include the following acknowledgment:
+ * "This product includes software developed by the
+ * Apache Software Foundation (http://www.apache.org/)."
+ * Alternately, this acknowledgment may appear in the software itself,
+ * if and wherever such third-party acknowledgments normally appear.
+ *
+ * 4. The names "Apache" and "Apache Software Foundation" and
+ * "Apache JMeter" must not be used to endorse or promote products
+ * derived from this software without prior written permission. For
+ * written permission, please contact apache@apache.org.
+ *
+ * 5. Products derived from this software may not be called "Apache",
+ * "Apache JMeter", nor may "Apache" appear in their name, without
+ * prior written permission of the Apache Software Foundation.
+ *
+ * THIS SOFTWARE IS PROVIDED ``AS IS'' AND ANY EXPRESSED OR IMPLIED
+ * WARRANTIES, INCLUDING, BUT NOT LIMITED TO, THE IMPLIED WARRANTIES
+ * OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE ARE
+ * DISCLAIMED.  IN NO EVENT SHALL THE APACHE SOFTWARE FOUNDATION OR
+ * ITS CONTRIBUTORS BE LIABLE FOR ANY DIRECT, INDIRECT, INCIDENTAL,
+ * SPECIAL, EXEMPLARY, OR CONSEQUENTIAL DAMAGES (INCLUDING, BUT NOT
+ * LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES; LOSS OF
+ * USE, DATA, OR PROFITS; OR BUSINESS INTERRUPTION) HOWEVER CAUSED AND
+ * ON ANY THEORY OF LIABILITY, WHETHER IN CONTRACT, STRICT LIABILITY,
+ * OR TORT (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT
+ * OF THE USE OF THIS SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF
+ * SUCH DAMAGE.
+ * ====================================================================
+ *
+ * This software consists of voluntary contributions made by many
+ * individuals on behalf of the Apache Software Foundation.  For more
+ * information on the Apache Software Foundation, please see
+ * <http://www.apache.org/>.
+ */
+package org.apache.jmeter.save;
+
+/************************************************************
+ *  This interface defines a number of constants used in the properties file
+ *  that is used to indicate which portions of the results will be
+ *  stored in the results files.  It also contains constants representing XML
+ *  tags, elements, etc.
+ *  
+ *
+ *@author     <a href="mailto:kcassell&#X0040;apache.org">Keith Cassell</a>
+ *@created    $Date: 2003/01/29 19:13:54 $
+ *@version    $Revision: 1.1 $ $Date: 2003/01/29 19:13:54 $
+ ***********************************************************/
+
+public interface SaveServiceConstants
+{
+        //---------------------------------------------------------------------
+        // PROPERTY FILE CONSTANTS
+        //---------------------------------------------------------------------
+
+        /** The file containing the properties governing the information to
+            be saved.  **/
+        public static final String PROPS_FILE =
+        "jmeter.properties";
+
+        /** Indicates that the results file should be in XML format.  **/
+        public static final String XML = "xml";
+
+        /** Indicates that the results file should be in CSV format.  **/
+        public static final String CSV = "csv";
+
+        /** Indicates that the results should be stored in a database.  **/
+        public static final String DATABASE = "db";
+
+        /** A properties file indicator for true.  **/
+        public static final String TRUE = "true";
+
+        /** A properties file indicator for false.  **/
+        public static final String FALSE = "false";
+
+        /** A properties file indicator for milliseconds.  **/
+        public static final String MILLISECONDS = "ms";
+
+        /** A properties file indicator for none.  **/
+        public static final String NONE = "none";
+
+        /** A properties file indicator for the first of a series.  **/
+        public static final String FIRST = "first";
+
+        /** A properties file indicator for all of a series.  **/
+        public static final String ALL = "all";
+
+        /** The name of the property indicating which assertion results
+            should be saved.  **/
+        public static final String ASSERTION_RESULTS_PROP
+        = "jmeter.save.saveservice.assertion_results";
+
+        /** The name of the property indicating whether the data type
+            should be saved.  **/
+        public static final String SAVE_DATA_TYPE_PROP
+        = "jmeter.save.saveservice.data_type";
+
+        /** The name of the property indicating whether the label
+            should be saved.  **/
+        public static final String SAVE_LABEL_PROP
+        = "jmeter.save.saveservice.label";
+
+        /** The name of the property indicating whether the response code
+            should be saved.  **/
+        public static final String SAVE_RESPONSE_CODE_PROP
+        = "jmeter.save.saveservice.response_code";
+
+        /** The name of the property indicating whether the response data
+            should be saved.  **/
+        public static final String SAVE_RESPONSE_DATA_PROP
+        = "jmeter.save.saveservice.response_data";
+
+        /** The name of the property indicating whether the response message
+            should be saved.  **/
+        public static final String SAVE_RESPONSE_MESSAGE_PROP
+        = "jmeter.save.saveservice.response_message";
+
+        /** The name of the property indicating whether the success indicator
+            should be saved.  **/
+        public static final String SAVE_SUCCESSFUL_PROP
+        = "jmeter.save.saveservice.successful";
+
+        /** The name of the property indicating whether the thread name
+            should be saved.  **/
+        public static final String SAVE_THREAD_NAME_PROP
+        = "jmeter.save.saveservice.thread_name";
+
+        /** The name of the property indicating whether the time
+            should be saved.  **/
+        public static final String SAVE_TIME_PROP
+        = "jmeter.save.saveservice.time";
+
+        /** The name of the property indicating whether the time stamp
+            should be saved.  **/
+        public static final String TIME_STAMP_FORMAT_PROP
+        = "jmeter.save.saveservice.timestamp_format";
+
+        //---------------------------------------------------------------------
+        // XML RESULT FILE CONSTANTS
+        //---------------------------------------------------------------------
+
+        public final static String PRESERVE = "preserve";
+        public final static String XML_SPACE = "xml:space";
+        public static final String ASSERTION_RESULT_TAG_NAME = "assertionResult";
+        public static final String BINARY = "binary";
+        public static final String DATA_TYPE = "dataType";
+        public static final String ERROR = "error";
+        public static final String FAILURE = "failure";
+        public static final String FAILURE_MESSAGE = "failureMessage";
+        public static final String LABEL = "label";
+        public static final String RESPONSE_CODE = "responseCode";
+        public static final String RESPONSE_MESSAGE = "responseMessage";
+        public static final String SAMPLE_RESULT_TAG_NAME = "sampleResult";
+        public static final String SUCCESSFUL = "success";
+        public static final String THREAD_NAME = "threadName";
+        public static final String TIME = "time";
+        public static final String TIME_STAMP = "timeStamp";
+
+}
diff --git a/jakarta-jmeter/src/core/org/apache/jmeter/save/old/CVS/Entries b/jakarta-jmeter/src/core/org/apache/jmeter/save/old/CVS/Entries
deleted file mode 100644
index 0926fa7..0000000
--- a/jakarta-jmeter/src/core/org/apache/jmeter/save/old/CVS/Entries
+++ /dev/null
@@ -1,6 +0,0 @@
-/BadHandlerException.java/1.1/Sun Aug 11 19:24:47 2002//Tv1_7_3
-/JMeterNameSpaceHandler.java/1.1/Sun Aug 11 19:24:47 2002//Tv1_7_3
-/SaveHandler.java/1.1/Sun Aug 11 19:24:47 2002//Tv1_7_3
-/Saveable.java/1.1/Sun Aug 11 19:24:47 2002//Tv1_7_3
-D/handlers////
-D/xml////
diff --git a/jakarta-jmeter/src/core/org/apache/jmeter/save/old/CVS/Repository b/jakarta-jmeter/src/core/org/apache/jmeter/save/old/CVS/Repository
deleted file mode 100644
index 4ca30ac..0000000
--- a/jakarta-jmeter/src/core/org/apache/jmeter/save/old/CVS/Repository
+++ /dev/null
@@ -1 +0,0 @@
-jakarta-jmeter/src/core/org/apache/jmeter/save/old
diff --git a/jakarta-jmeter/src/core/org/apache/jmeter/save/old/CVS/Tag b/jakarta-jmeter/src/core/org/apache/jmeter/save/old/CVS/Tag
deleted file mode 100644
index 5f312fe..0000000
--- a/jakarta-jmeter/src/core/org/apache/jmeter/save/old/CVS/Tag
+++ /dev/null
@@ -1 +0,0 @@
-Nv1_7_3
diff --git a/jakarta-jmeter/src/core/org/apache/jmeter/save/old/handlers/AbstractConfigElementHandler.java b/jakarta-jmeter/src/core/org/apache/jmeter/save/old/handlers/AbstractConfigElementHandler.java
deleted file mode 100644
index 1a4214c..0000000
--- a/jakarta-jmeter/src/core/org/apache/jmeter/save/old/handlers/AbstractConfigElementHandler.java
+++ /dev/null
@@ -1,253 +0,0 @@
-/*
- * ====================================================================
- * The Apache Software License, Version 1.1
- *
- * Copyright (c) 2001 The Apache Software Foundation.  All rights
- * reserved.
- *
- * Redistribution and use in source and binary forms, with or without
- * modification, are permitted provided that the following conditions
- * are met:
- *
- * 1. Redistributions of source code must retain the above copyright
- * notice, this list of conditions and the following disclaimer.
- *
- * 2. Redistributions in binary form must reproduce the above copyright
- * notice, this list of conditions and the following disclaimer in
- * the documentation and/or other materials provided with the
- * distribution.
- *
- * 3. The end-user documentation included with the redistribution,
- * if any, must include the following acknowledgment:
- * "This product includes software developed by the
- * Apache Software Foundation (http://www.apache.org/)."
- * Alternately, this acknowledgment may appear in the software itself,
- * if and wherever such third-party acknowledgments normally appear.
- *
- * 4. The names "Apache" and "Apache Software Foundation" and
- * "Apache JMeter" must not be used to endorse or promote products
- * derived from this software without prior written permission. For
- * written permission, please contact apache@apache.org.
- *
- * 5. Products derived from this software may not be called "Apache",
- * "Apache JMeter", nor may "Apache" appear in their name, without
- * prior written permission of the Apache Software Foundation.
- *
- * THIS SOFTWARE IS PROVIDED ``AS IS'' AND ANY EXPRESSED OR IMPLIED
- * WARRANTIES, INCLUDING, BUT NOT LIMITED TO, THE IMPLIED WARRANTIES
- * OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE ARE
- * DISCLAIMED.  IN NO EVENT SHALL THE APACHE SOFTWARE FOUNDATION OR
- * ITS CONTRIBUTORS BE LIABLE FOR ANY DIRECT, INDIRECT, INCIDENTAL,
- * SPECIAL, EXEMPLARY, OR CONSEQUENTIAL DAMAGES (INCLUDING, BUT NOT
- * LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES; LOSS OF
- * USE, DATA, OR PROFITS; OR BUSINESS INTERRUPTION) HOWEVER CAUSED AND
- * ON ANY THEORY OF LIABILITY, WHETHER IN CONTRACT, STRICT LIABILITY,
- * OR TORT (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT
- * OF THE USE OF THIS SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF
- * SUCH DAMAGE.
- * ====================================================================
- *
- * This software consists of voluntary contributions made by many
- * individuals on behalf of the Apache Software Foundation.  For more
- * information on the Apache Software Foundation, please see
- * <http://www.apache.org/>.
- */
-
-package org.apache.jmeter.save.old.handlers;
-
-
-import java.io.IOException;
-import java.io.Writer;
-import java.util.List;
-
-import org.apache.jmeter.config.ConfigTestElement;
-import org.apache.jmeter.protocol.http.sampler.HTTPSampler;
-import org.apache.jmeter.save.old.Saveable;
-import org.apache.jmeter.save.old.xml.TagHandler;
-import org.apache.jmeter.testelement.TestElement;
-import org.xml.sax.Attributes;
-
-
-
-/************************************************************
- *  Title: JMeter Description: Copyright: Copyright (c) 2000 Company: Apache
- *
- *@author     Michael Stover
- *@created    June 9, 2001
- *@version    1.0
- ***********************************************************/
-
-
-public class AbstractConfigElementHandler extends TagHandler
-{
-
-	protected TestElement config;
-
-	protected String currentProperty;
-
-
-	/************************************************************
-	 *  Constructor for the AbstractConfigElementHandler object
-	 ***********************************************************/
-	public AbstractConfigElementHandler()
-	{
-
-	}
-
-
-	/************************************************************
-	 *  This is called when a tag is first encountered for this handler class to
-	 *  handle. The attributes of the tag are passed, and the SaveHandler object is
-	 *  expected to instantiate a new object.
-	 *
-	 *@param  atts           The new Atts value
-	 *@exception  Exception  Description of Exception
-	 ***********************************************************/
-
-	public void setAtts(Attributes atts) throws Exception
-	{
-
-		config = (TestElement)Class.forName(JMeterHandler.getComponentConversion(atts.getValue("type"))).newInstance();
-		config.setProperty(TestElement.TEST_CLASS,atts.getValue("type"));
-		config.setProperty(TestElement.GUI_CLASS,JMeterHandler.getGuiClass(atts.getValue("type")));
-		config.setProperty(TestElement.NAME,atts.getValue("name"));
-	}
-
-
-	/************************************************************
-	 *  Returns the AbstractConfigElement object parsed from the XML. This method
-	 *  is required to fulfill the SaveHandler interface. It is used by the XML
-	 *  routines to gather all the saved objects.
-	 *
-	 *@return    The Model value
-	 ***********************************************************/
-
-	public Object getModel()
-	{
-
-		return config;
-	}
-
-
-
-	/************************************************************
-	 *  Gets the tag name that will trigger the use of this object's TagHandler.
-	 *
-	 *@return    The PrimaryTagName value
-	 ***********************************************************/
-
-	public String getPrimaryTagName()
-	{
-
-		return "ConfigElement";
-	}
-
-
-	/************************************************************
-	 *  Called by reflection when a &lt;property&gt; tag is encountered. Again, the
-	 *  attributes are passed.
-	 *
-	 *@param  atts  Description of Parameter
-	 ***********************************************************/
-
-	public void property(Attributes atts)
-	{
-
-		currentProperty = atts.getValue("name");
-
-	}
-
-
-	/************************************************************
-	 *  Called by reflection when text between the begin and end &lt;property&gt;
-	 *  tag is encountered.
-	 *
-	 *@param  data  Description of Parameter
-	 ***********************************************************/
-
-	public void property(String data)
-	{
-		if(data != null && data.trim().length() > 0)
-		{
-			config.setProperty(JMeterHandler.convertProperty(currentProperty), data.trim());
-			currentProperty = null;
-		}
-	}
-
-
-	/************************************************************
-	 *  Called by reflection when the &lt;property&gt; tag is ended.
-	 ***********************************************************/
-
-	public void propertyTagEnd()
-	{
-		List children = xmlParent.takeChildObjects(this);
-		if(children.size() == 1)
-		{
-			config.setProperty(JMeterHandler.convertProperty(currentProperty), ((TagHandler)children.get(0)).getModel());
-		}
-	}
-
-
-	/************************************************************
-	 *  Tells the object to save itself to the given output stream.
-	 *
-	 *@param  obj              Description of Parameter
-	 *@param  out              Description of Parameter
-	 *@exception  IOException  Description of Exception
-	 ***********************************************************/
-
-	public void save(Saveable obj, Writer out) throws IOException
-	{
-		/*
-		AbstractConfigElement saved = (AbstractConfigElement)obj;
-
-		out.write("<ConfigElement type=\"");
-
-		out.write(JMeterHandler.convertToXML(saved.getClass().getName()));
-
-		out.write("\">\n");
-
-		Iterator iter = saved.getPropertyNames().iterator();
-
-		while(iter.hasNext())
-		{
-
-			String key = (String)iter.next();
-
-			Object value = saved.getProperty(key);
-
-			writeProperty(out, key, value);
-
-		}
-
-		out.write("</ConfigElement>");*/
-
-	}
-
-
-	/************************************************************
-	 *  Routine to write each property to xml.
-	 *
-	 *@param  out              Description of Parameter
-	 *@param  key              Description of Parameter
-	 *@param  value            Description of Parameter
-	 *@exception  IOException  Description of Exception
-	 ***********************************************************/
-
-	protected void writeProperty(Writer out, String key, Object value) throws IOException
-	{
-
-		out.write("<property name=\"");
-
-		out.write(JMeterHandler.convertToXML(key));
-
-		out.write("\">");
-
-		JMeterHandler.writeObject(value, out);
-
-		out.write("</property>\n");
-
-	}
-
-}
diff --git a/jakarta-jmeter/src/core/org/apache/jmeter/save/old/handlers/AssertionHandler.java b/jakarta-jmeter/src/core/org/apache/jmeter/save/old/handlers/AssertionHandler.java
deleted file mode 100644
index c842fb4..0000000
--- a/jakarta-jmeter/src/core/org/apache/jmeter/save/old/handlers/AssertionHandler.java
+++ /dev/null
@@ -1,87 +0,0 @@
-package org.apache.jmeter.save.old.handlers;
-
-import java.io.IOException;
-import java.io.Writer;
-
-import org.apache.jmeter.assertions.ResponseAssertion;
-import org.apache.jmeter.save.old.SaveHandler;
-import org.apache.jmeter.save.old.Saveable;
-import org.apache.jmeter.save.old.xml.TagHandler;
-import org.apache.jmeter.testelement.TestElement;
-import org.xml.sax.Attributes;
-
-/**
- * Title:        Jakarta-JMeter
- * Description:
- * Copyright:    Copyright (c) 2001
- * Company:      Apache
- * @author Michael Stover
- * @version 1.0
- */
-
-public class AssertionHandler extends TagHandler implements SaveHandler
-{
-
-	ResponseAssertion model;
-
-	public AssertionHandler() {
-	}
-
-	public String getPrimaryTagName()
-	{
-		return "assertion";
-	}
-
-	public void save(Saveable objectToSave, Writer out) throws IOException {
-		ResponseAssertion saved = (ResponseAssertion)objectToSave;
-		out.write("<");
-		out.write(getPrimaryTagName());
-		out.write(" name=\"");
-		out.write(saved.getName());
-		out.write("\" class=\"");
-		out.write(saved.getClass().getName());
-		out.write("\" testType=\"");
-		out.write(""+saved.getTestType());
-		out.write("\" testField=\"");
-		out.write(saved.getTestField());
-		out.write("\">");
-		writeTestStrings(saved,out);
-		out.write("\n</");
-		out.write(getPrimaryTagName());
-		out.write(">");
-	}
-
-	public Object getModel()
-	{
-		return model;
-	}
-
-	public void setAtts(Attributes atts) throws ClassNotFoundException,IllegalAccessException,InstantiationException
-	{
-		try {
-			model = (ResponseAssertion)Class.forName(JMeterHandler.getComponentConversion(atts.getValue("class"))).newInstance();
-			model.setName(atts.getValue("name"));
-			model.setTestType(Integer.parseInt(atts.getValue("testType")));
-			model.setTestField(JMeterHandler.convertProperty(atts.getValue("testField")));
-			model.setProperty(TestElement.GUI_CLASS,JMeterHandler.getGuiClass(atts.getValue("class")));
-		} catch (Exception e) {
-			e.printStackTrace();
-		} 
-	}
-
-	public void testString(String data)
-	{
-		model.addTestString(data);
-	}
-
-	private void writeTestStrings(ResponseAssertion saved, Writer out) throws IOException
-	{
-		/*Iterator iter = saved.getTestStringList().iterator();
-		while (iter.hasNext())
-		{
-			out.write("\n<testString>");
-			out.write(JMeterHandler.convertToXML(iter.next().toString()));
-			out.write("</testString>");
-		}*/
-	}
-}
\ No newline at end of file
diff --git a/jakarta-jmeter/src/core/org/apache/jmeter/save/old/handlers/AuthManagerHandler.java b/jakarta-jmeter/src/core/org/apache/jmeter/save/old/handlers/AuthManagerHandler.java
deleted file mode 100644
index 1ba8147..0000000
--- a/jakarta-jmeter/src/core/org/apache/jmeter/save/old/handlers/AuthManagerHandler.java
+++ /dev/null
@@ -1,122 +0,0 @@
-/*
- * ====================================================================
- * The Apache Software License, Version 1.1
- *
- * Copyright (c) 2001 The Apache Software Foundation.  All rights
- * reserved.
- *
- * Redistribution and use in source and binary forms, with or without
- * modification, are permitted provided that the following conditions
- * are met:
- *
- * 1. Redistributions of source code must retain the above copyright
- * notice, this list of conditions and the following disclaimer.
- *
- * 2. Redistributions in binary form must reproduce the above copyright
- * notice, this list of conditions and the following disclaimer in
- * the documentation and/or other materials provided with the
- * distribution.
- *
- * 3. The end-user documentation included with the redistribution,
- * if any, must include the following acknowledgment:
- * "This product includes software developed by the
- * Apache Software Foundation (http://www.apache.org/)."
- * Alternately, this acknowledgment may appear in the software itself,
- * if and wherever such third-party acknowledgments normally appear.
- *
- * 4. The names "Apache" and "Apache Software Foundation" and
- * "Apache JMeter" must not be used to endorse or promote products
- * derived from this software without prior written permission. For
- * written permission, please contact apache@apache.org.
- *
- * 5. Products derived from this software may not be called "Apache",
- * "Apache JMeter", nor may "Apache" appear in their name, without
- * prior written permission of the Apache Software Foundation.
- *
- * THIS SOFTWARE IS PROVIDED ``AS IS'' AND ANY EXPRESSED OR IMPLIED
- * WARRANTIES, INCLUDING, BUT NOT LIMITED TO, THE IMPLIED WARRANTIES
- * OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE ARE
- * DISCLAIMED.  IN NO EVENT SHALL THE APACHE SOFTWARE FOUNDATION OR
- * ITS CONTRIBUTORS BE LIABLE FOR ANY DIRECT, INDIRECT, INCIDENTAL,
- * SPECIAL, EXEMPLARY, OR CONSEQUENTIAL DAMAGES (INCLUDING, BUT NOT
- * LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES; LOSS OF
- * USE, DATA, OR PROFITS; OR BUSINESS INTERRUPTION) HOWEVER CAUSED AND
- * ON ANY THEORY OF LIABILITY, WHETHER IN CONTRACT, STRICT LIABILITY,
- * OR TORT (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT
- * OF THE USE OF THIS SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF
- * SUCH DAMAGE.
- * ====================================================================
- *
- * This software consists of voluntary contributions made by many
- * individuals on behalf of the Apache Software Foundation.  For more
- * information on the Apache Software Foundation, please see
- * <http://www.apache.org/>.
- */
- package org.apache.jmeter.save.old.handlers;
-
-import java.io.Writer;
-import java.util.Iterator;
-import java.util.List;
-
-import org.apache.jmeter.protocol.http.control.AuthManager;
-import org.apache.jmeter.protocol.http.control.Authorization;
-import org.apache.jmeter.save.old.Saveable;
-import org.apache.jmeter.save.old.xml.TagHandler;
-import org.apache.jmeter.testelement.TestElement;
-import org.xml.sax.Attributes;
-
-/**
- * Title:
- * Description:
- * Copyright:    Copyright (c) 2001
- * Company:
- * @author Michael Stover
- * @version 1.0
- */
-
-public class AuthManagerHandler extends TagHandler
-{
-
-	private AuthManager authMan;
-	private String currentProperty;
-	private Authorization auth;
-
-	public AuthManagerHandler()
-	{
-	}
-	public void save(Saveable s, Writer out) throws java.io.IOException
-	{
-		AuthManager save = (AuthManager)s;
-		out.write("<AuthManager name=\"");
-		out.write(JMeterHandler.convertToXML(save.getName()));
-		out.write("\">\n");
-		JMeterHandler.writeObjects(save.getAuthObjects(),out);
-		out.write("</AuthManager>\n");
-	}
-
-	public void AuthManagerTagEnd()
-	{
-		List auths = xmlParent.takeChildObjects(this);
-		Iterator iter = auths.iterator();
-		while (iter.hasNext())
-		{
-			authMan.addTestElement((TestElement)((TagHandler)iter.next()).getModel());
-		}
-	}
-
-	public void setAtts(Attributes atts) throws java.lang.Exception
-	{
-		authMan = new AuthManager();
-		authMan.setName(atts.getValue("name"));
-		authMan.setProperty(TestElement.GUI_CLASS,"org.apache.jmeter.protocol.http.gui.AuthPanel");
-	}
-	public String getPrimaryTagName()
-	{
-		return "AuthManager";
-	}
-
-	public Object getModel()
-	{
-		return authMan;
-	}
-}
\ No newline at end of file
diff --git a/jakarta-jmeter/src/core/org/apache/jmeter/save/old/handlers/CVS/Entries b/jakarta-jmeter/src/core/org/apache/jmeter/save/old/handlers/CVS/Entries
deleted file mode 100644
index d60b43c..0000000
--- a/jakarta-jmeter/src/core/org/apache/jmeter/save/old/handlers/CVS/Entries
+++ /dev/null
@@ -1,20 +0,0 @@
-/AbstractConfigElementHandler.java/1.1/Sun Aug 11 19:24:48 2002//Tv1_7_3
-/ArgumentsHandler.java/1.1/Sun Aug 11 19:24:48 2002//Tv1_7_3
-/AssertionHandler.java/1.1/Sun Aug 11 19:24:48 2002//Tv1_7_3
-/AuthManagerHandler.java/1.1/Sun Aug 11 19:24:48 2002//Tv1_7_3
-/CookieManagerHandler.java/1.1/Sun Aug 11 19:24:48 2002//Tv1_7_3
-/FilerHandler.java/1.1/Sun Aug 11 19:24:48 2002//Tv1_7_3
-/FtpTestHandler.java/1.1/Sun Aug 11 19:24:48 2002//Tv1_7_3
-/GenericControllerHandler.java/1.1/Sun Aug 11 19:24:48 2002//Tv1_7_3
-/HeaderManagerHandler.java/1.1/Sun Aug 11 19:24:48 2002//Tv1_7_3
-/HttpTestSampleHandler.java/1.1/Sun Aug 11 19:24:48 2002//Tv1_7_3
-/JMeterComponentHandler.java/1.1/Sun Aug 11 19:24:48 2002//Tv1_7_3
-/JMeterHandler.java/1.1/Sun Aug 11 19:24:48 2002//Tv1_7_3
-/JdbcTestSampleHandler.java/1.1/Sun Aug 11 19:24:48 2002//Tv1_7_3
-/LoopControlHandler.java/1.1/Sun Aug 11 19:24:48 2002//Tv1_7_3
-/ParamMaskHandler.java/1.1/Sun Aug 11 19:24:48 2002//Tv1_7_3
-/ProxyControlHandler.java/1.1/Sun Aug 11 19:24:48 2002//Tv1_7_3
-/TestPlanHandler.java/1.1/Sun Aug 11 19:24:48 2002//Tv1_7_3
-/ThreadGroupHandler.java/1.1/Sun Aug 11 19:24:48 2002//Tv1_7_3
-/TimerHandler.java/1.1/Sun Aug 11 19:24:48 2002//Tv1_7_3
-D
diff --git a/jakarta-jmeter/src/core/org/apache/jmeter/save/old/handlers/CVS/Repository b/jakarta-jmeter/src/core/org/apache/jmeter/save/old/handlers/CVS/Repository
deleted file mode 100644
index 362df84..0000000
--- a/jakarta-jmeter/src/core/org/apache/jmeter/save/old/handlers/CVS/Repository
+++ /dev/null
@@ -1 +0,0 @@
-jakarta-jmeter/src/core/org/apache/jmeter/save/old/handlers
diff --git a/jakarta-jmeter/src/core/org/apache/jmeter/save/old/handlers/CVS/Tag b/jakarta-jmeter/src/core/org/apache/jmeter/save/old/handlers/CVS/Tag
deleted file mode 100644
index 5f312fe..0000000
--- a/jakarta-jmeter/src/core/org/apache/jmeter/save/old/handlers/CVS/Tag
+++ /dev/null
@@ -1 +0,0 @@
-Nv1_7_3
diff --git a/jakarta-jmeter/src/core/org/apache/jmeter/save/old/handlers/FilerHandler.java b/jakarta-jmeter/src/core/org/apache/jmeter/save/old/handlers/FilerHandler.java
deleted file mode 100644
index c23e22d..0000000
--- a/jakarta-jmeter/src/core/org/apache/jmeter/save/old/handlers/FilerHandler.java
+++ /dev/null
@@ -1,83 +0,0 @@
-package org.apache.jmeter.save.old.handlers;
-
-import java.io.Writer;
-
-import org.apache.jmeter.reporters.ResultCollector;
-import org.apache.jmeter.save.old.Saveable;
-import org.apache.jmeter.save.old.xml.TagHandler;
-import org.apache.jmeter.testelement.TestElement;
-import org.xml.sax.Attributes;
-
-/**
- * Title:
- * Description:
- * Copyright:    Copyright (c) 2001
- * Company:
- * @author
- * @version 1.0
- */
-
-public class FilerHandler extends TagHandler
-{
-	ResultCollector model;
-
-	public FilerHandler()
-	{
-	}
-
-	public void save(Saveable saveObject, Writer out) throws java.io.IOException
-	{
- 		/* protect ourselves from bad input.
-		if ((saveObject == null) || (out == null))
-		{
-			// error!
-		}
-		else
-		{
-	 		Filer save = (Filer)saveObject;
-
-			// validate filename
-			String filename = save.getFile();
-			if (filename == null)
-			{
-				System.err.println("Error. Missing filename in File Reporter.");
-				filename = "";
-			}
-
-			out.write("<Filer type=\"");
-			out.write(JMeterHandler.convertToXML(save.getClass().getName()));
-			out.write("\" name=\"");
-			out.write(JMeterHandler.convertToXML(save.getName()));
-			out.write("\" verbose=\"");
-			out.write(""+save.getVerbose());
-			out.write("\" append=\"");
-			out.write(""+save.getAppend());
-			out.write("\" autoFlush=\"");
-			out.write("" + save.getAutoFlush());
-			out.write("\" viewSubmitData=\"");
-			out.write("" + save.getViewSubmitData());
-			out.write("\" file=\"");
-			out.write(JMeterHandler.convertToXML(filename));
-			out.write("\"/>");
-		}*/
-	}
-
-	public void setAtts(Attributes atts) throws java.lang.Exception
-	{
-		model = new ResultCollector();
-		model.setName(atts.getValue("name"));
-		model.setFilename(atts.getValue("file"));
-		model.setProperty(TestElement.GUI_CLASS,"org.apache.jmeter.visualizers.GraphVisualizer");
-
-	}
-
-	public String getPrimaryTagName()
-	{
-		return "Filer";
-	}
-
-	public Object getModel()
-	{
-		return model;
-	}
-}
diff --git a/jakarta-jmeter/src/core/org/apache/jmeter/save/old/handlers/FtpTestHandler.java b/jakarta-jmeter/src/core/org/apache/jmeter/save/old/handlers/FtpTestHandler.java
deleted file mode 100644
index 8797fec..0000000
--- a/jakarta-jmeter/src/core/org/apache/jmeter/save/old/handlers/FtpTestHandler.java
+++ /dev/null
@@ -1,173 +0,0 @@
-/*
- * ====================================================================
- * The Apache Software License, Version 1.1
- *
- * Copyright (c) 2001 The Apache Software Foundation.  All rights
- * reserved.
- *
- * Redistribution and use in source and binary forms, with or without
- * modification, are permitted provided that the following conditions
- * are met:
- *
- * 1. Redistributions of source code must retain the above copyright
- * notice, this list of conditions and the following disclaimer.
- *
- * 2. Redistributions in binary form must reproduce the above copyright
- * notice, this list of conditions and the following disclaimer in
- * the documentation and/or other materials provided with the
- * distribution.
- *
- * 3. The end-user documentation included with the redistribution,
- * if any, must include the following acknowledgment:
- * "This product includes software developed by the
- * Apache Software Foundation (http://www.apache.org/)."
- * Alternately, this acknowledgment may appear in the software itself,
- * if and wherever such third-party acknowledgments normally appear.
- *
- * 4. The names "Apache" and "Apache Software Foundation" and
- * "Apache JMeter" must not be used to endorse or promote products
- * derived from this software without prior written permission. For
- * written permission, please contact apache@apache.org.
- *
- * 5. Products derived from this software may not be called "Apache",
- * "Apache JMeter", nor may "Apache" appear in their name, without
- * prior written permission of the Apache Software Foundation.
- *
- * THIS SOFTWARE IS PROVIDED ``AS IS'' AND ANY EXPRESSED OR IMPLIED
- * WARRANTIES, INCLUDING, BUT NOT LIMITED TO, THE IMPLIED WARRANTIES
- * OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE ARE
- * DISCLAIMED.  IN NO EVENT SHALL THE APACHE SOFTWARE FOUNDATION OR
- * ITS CONTRIBUTORS BE LIABLE FOR ANY DIRECT, INDIRECT, INCIDENTAL,
- * SPECIAL, EXEMPLARY, OR CONSEQUENTIAL DAMAGES (INCLUDING, BUT NOT
- * LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES; LOSS OF
- * USE, DATA, OR PROFITS; OR BUSINESS INTERRUPTION) HOWEVER CAUSED AND
- * ON ANY THEORY OF LIABILITY, WHETHER IN CONTRACT, STRICT LIABILITY,
- * OR TORT (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT
- * OF THE USE OF THIS SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF
- * SUCH DAMAGE.
- * ====================================================================
- *
- * This software consists of voluntary contributions made by many
- * individuals on behalf of the Apache Software Foundation.  For more
- * information on the Apache Software Foundation, please see
- * <http://www.apache.org/>.
- */
- package org.apache.jmeter.save.old.handlers;
-
-import java.io.Writer;
-import java.util.List;
-
-import org.apache.jmeter.control.GenericController;
-import org.apache.jmeter.protocol.ftp.sampler.FTPSampler;
-import org.apache.jmeter.save.old.Saveable;
-import org.apache.jmeter.save.old.xml.TagHandler;
-import org.apache.jmeter.testelement.TestElement;
-import org.xml.sax.Attributes;
-
-/**
- *  Title: Apache JMeter Description: Copyright: Copyright (c) 2000 Company:
- *  Apache Foundation
- *
- *@created    July 30, 2001
- *@version    1.0
- */
-
-public class FtpTestHandler extends TagHandler
-{
-	FTPSampler sampler;
-	//Constructor for the FtpTestHandler object
-
-		  public FtpTestHandler()	{}
-
-	/**
-	 *  Gets the PrimaryTagName attribute of the FtpTestHandler
-	 */
-	public String getPrimaryTagName()
-	{
-		return "FtpTestSampler";
-	}
-
-	//called by reflection when the <defaultUrl> tag is ended
-		  public void defaultUrlTagEnd()
-	{
-		List children = xmlParent.takeChildObjects(this);
-		if (children.size() == 1)
-		{
-			sampler.addTestElement((TestElement)((TagHandler)children.get(0)).getModel());
-		}
-	}
-
-		  //called by reflection when the <defaultLogin> tag is ended
-		  public void loginConfigTagEnd()
-	{
-		List children = xmlParent.takeChildObjects(this);
-		if (children.size() == 1)
-		{
-			sampler.addTestElement((TestElement)((TagHandler)children.get(0)).getModel());
-		}
-	}
-	
-	public void setAtts(Attributes atts) throws java.lang.Exception
-	{
-		sampler = new FTPSampler();
-		sampler.setName(atts.getValue("name"));
-		sampler.setProperty(TestElement.GUI_CLASS,"org.apache.jmeter.protocol.ftp.control.gui.FtpTestSamplerGui");
-
-	}
-	
-	public Object getModel()
-	{
-		return sampler;
-	}
-	/**
-	 *  Does the saving, calls write methods below to output config info to XML config file.
-			*/
-	public void save(Saveable cont, Writer out) throws java.io.IOException
-	{
-		/*FtpTestSampler controller = (FtpTestSampler) cont;
-		writeMainTag(out, controller);
-		writeDefaultUrl(out, controller);
-		writeLoginConfig(out, controller);
-		this.writeSubElements(controller,out);
-		out.write("</FtpTestSampler>\n");*/
-	}
-
-	/**
-	 *  This method writes the opening main tag to the XML config file, i.e. <FtpTestSampler>
-	 */
-	protected void writeMainTag(Writer out, GenericController controller) throws java.io.IOException
-	{
-		out.write("<FtpTestSampler type=\"");
-		out.write(JMeterHandler.convertToXML(controller.getClass().getName()));
-		out.write("\" name=\"");
-		out.write(JMeterHandler.convertToXML(controller.getName()));
-		out.write("\">\n");
-	}
-
-	/**
-			* Write out default domain and default filename defined in 'FTP Testing'
-	 * @exception  java.io.IOException  Description of Exception
-	 */
-	protected void writeDefaultUrl(Writer out)
-			 throws java.io.IOException
-	{
-		/*out.write("<defaultUrl>\n");
-		JMeterHandler.writeObject(controller.getDefaultUrl(), out);
-		out.write("</defaultUrl>\n");*/
-	}
-
-
-		  /**
-			* Write username and password info
-			*/
-		  protected void writeLoginConfig(Writer out)
-			 throws java.io.IOException
-	{
-		/*out.write("<loginConfig>\n");
-		JMeterHandler.writeObject(controller.getLoginConfig(), out);
-		out.write("</loginConfig>\n");*/
-	}
-}
-
-
-
diff --git a/jakarta-jmeter/src/core/org/apache/jmeter/save/old/handlers/GenericControllerHandler.java b/jakarta-jmeter/src/core/org/apache/jmeter/save/old/handlers/GenericControllerHandler.java
deleted file mode 100644
index 4affb47..0000000
--- a/jakarta-jmeter/src/core/org/apache/jmeter/save/old/handlers/GenericControllerHandler.java
+++ /dev/null
@@ -1,189 +0,0 @@
-/*
- * ====================================================================
- * The Apache Software License, Version 1.1
- *
- * Copyright (c) 2001 The Apache Software Foundation.  All rights
- * reserved.
- *
- * Redistribution and use in source and binary forms, with or without
- * modification, are permitted provided that the following conditions
- * are met:
- *
- * 1. Redistributions of source code must retain the above copyright
- * notice, this list of conditions and the following disclaimer.
- *
- * 2. Redistributions in binary form must reproduce the above copyright
- * notice, this list of conditions and the following disclaimer in
- * the documentation and/or other materials provided with the
- * distribution.
- *
- * 3. The end-user documentation included with the redistribution,
- * if any, must include the following acknowledgment:
- * "This product includes software developed by the
- * Apache Software Foundation (http://www.apache.org/)."
- * Alternately, this acknowledgment may appear in the software itself,
- * if and wherever such third-party acknowledgments normally appear.
- *
- * 4. The names "Apache" and "Apache Software Foundation" and
- * "Apache JMeter" must not be used to endorse or promote products
- * derived from this software without prior written permission. For
- * written permission, please contact apache@apache.org.
- *
- * 5. Products derived from this software may not be called "Apache",
- * "Apache JMeter", nor may "Apache" appear in their name, without
- * prior written permission of the Apache Software Foundation.
- *
- * THIS SOFTWARE IS PROVIDED ``AS IS'' AND ANY EXPRESSED OR IMPLIED
- * WARRANTIES, INCLUDING, BUT NOT LIMITED TO, THE IMPLIED WARRANTIES
- * OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE ARE
- * DISCLAIMED.  IN NO EVENT SHALL THE APACHE SOFTWARE FOUNDATION OR
- * ITS CONTRIBUTORS BE LIABLE FOR ANY DIRECT, INDIRECT, INCIDENTAL,
- * SPECIAL, EXEMPLARY, OR CONSEQUENTIAL DAMAGES (INCLUDING, BUT NOT
- * LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES; LOSS OF
- * USE, DATA, OR PROFITS; OR BUSINESS INTERRUPTION) HOWEVER CAUSED AND
- * ON ANY THEORY OF LIABILITY, WHETHER IN CONTRACT, STRICT LIABILITY,
- * OR TORT (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT
- * OF THE USE OF THIS SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF
- * SUCH DAMAGE.
- * ====================================================================
- *
- * This software consists of voluntary contributions made by many
- * individuals on behalf of the Apache Software Foundation.  For more
- * information on the Apache Software Foundation, please see
- * <http://www.apache.org/>.
- */
-package org.apache.jmeter.save.old.handlers;
-
-import java.io.Writer;
-
-import org.apache.jmeter.control.GenericController;
-import org.apache.jmeter.control.ModifyController;
-import org.apache.jmeter.save.old.Saveable;
-import org.apache.jmeter.save.old.xml.TagHandler;
-import org.apache.jmeter.testelement.TestElement;
-import org.xml.sax.Attributes;
-
-/************************************************************
- *  Title: Apache JMeter Description: Copyright: Copyright (c) 2000 Company:
- *  Apache Foundation
- *
- *@author     Michael Stover
- *@created    February 18, 2001
- *@version    1.0
- ***********************************************************/
-
-public class GenericControllerHandler extends TagHandler
-{
-
-	protected GenericController controller;
-
-	/************************************************************
-	 *  Constructor for the GenericControllerHandler object
-	 ***********************************************************/
-	public GenericControllerHandler()
-	{
-	}
-
-
-	/************************************************************
-	 *  Sets the Atts attribute of the GenericControllerHandler object
-	 *
-	 *@param  atts                     The new Atts value
-	 *@exception  java.lang.Exception  Description of Exception
-	 ***********************************************************/
-	public void setAtts(Attributes atts) throws java.lang.Exception
-	{
-		String className = atts.getValue("type");
-		if(className.equals("org.apache.jmeter.control.LogicController"))
-		{
-			controller = new GenericController();
-		}
-		else
-		{
-			controller = (GenericController)Class.forName(atts.getValue("type")).newInstance();
-		}
-		if(controller instanceof ModifyController)
-		{
-			controller = new GenericController();
-		}
-		controller.setName(atts.getValue("name"));
-		controller.setProperty(TestElement.GUI_CLASS,JMeterHandler.getGuiClass(atts.getValue("type")));
-
-	}
-
-	/************************************************************
-	 *  Gets the PrimaryTagName attribute of the GenericControllerHandler object
-	 *
-	 *@return    The PrimaryTagName value
-	 ***********************************************************/
-	public String getPrimaryTagName()
-	{
-		return "Controller";
-	}
-
-	/************************************************************
-	 *  Gets the Model attribute of the GenericControllerHandler object
-	 *
-	 *@return    The Model value
-	 ***********************************************************/
-	public Object getModel()
-	{
-		return controller;
-	}
-
-	/************************************************************
-	 *  Description of the Method
-	 *
-	 *@param  cont                     Description of Parameter
-	 *@param  out                      Description of Parameter
-	 *@exception  java.io.IOException  Description of Exception
-	 ***********************************************************/
-	public void save(Saveable cont, Writer out) throws java.io.IOException
-	{
-		GenericController controller = (GenericController)cont;
-		writeMainTag(out, controller);
-		writeSubElements(controller, out);
-		out.write("</Controller>");
-	}
-
-	/************************************************************
-	 *  !ToDo (Method description)
-	 *
-	 *@param  out                      !ToDo (Parameter description)
-	 *@param  controller               !ToDo (Parameter description)
-	 *@exception  java.io.IOException  !ToDo (Exception description)
-	 ***********************************************************/
-	protected void writeSubControllers(Writer out, GenericController controller) throws java.io.IOException
-	{
-
-	}
-
-	/************************************************************
-	 *  !ToDo (Method description)
-	 *
-	 *@param  out                      !ToDo (Parameter description)
-	 *@param  controller               !ToDo (Parameter description)
-	 *@exception  java.io.IOException  !ToDo (Exception description)
-	 ***********************************************************/
-	protected void writeMainTag(Writer out, GenericController controller) throws java.io.IOException
-	{
-		out.write("<Controller type=\"");
-		out.write(JMeterHandler.convertToXML(controller.getClass().getName()));
-		out.write("\" name=\"");
-		out.write(JMeterHandler.convertToXML(controller.getName()));
-		out.write("\">\n");
-	}
-
-	/************************************************************
-	 *  !ToDo (Method description)
-	 *
-	 *@param  controller  !ToDo (Parameter description)
-	 *@param  out         !ToDo (Parameter description)
-	 ***********************************************************/
-	protected void writeSubElements(GenericController controller, Writer out) throws java.io.IOException
-	{
-		/*JMeterHandler.writeConfigElements(controller.getConfigElements(), out);
-		JMeterHandler.writeControllers(controller.getSubControllers(), out);
-		JMeterHandler.writeObjects(controller.getAssertions(), out);*/
-	}
-}
diff --git a/jakarta-jmeter/src/core/org/apache/jmeter/save/old/handlers/HttpTestSampleHandler.java b/jakarta-jmeter/src/core/org/apache/jmeter/save/old/handlers/HttpTestSampleHandler.java
deleted file mode 100644
index 2f40b7b..0000000
--- a/jakarta-jmeter/src/core/org/apache/jmeter/save/old/handlers/HttpTestSampleHandler.java
+++ /dev/null
@@ -1,176 +0,0 @@
-/*
- * ====================================================================
- * The Apache Software License, Version 1.1
- *
- * Copyright (c) 2001 The Apache Software Foundation.  All rights
- * reserved.
- *
- * Redistribution and use in source and binary forms, with or without
- * modification, are permitted provided that the following conditions
- * are met:
- *
- * 1. Redistributions of source code must retain the above copyright
- * notice, this list of conditions and the following disclaimer.
- *
- * 2. Redistributions in binary form must reproduce the above copyright
- * notice, this list of conditions and the following disclaimer in
- * the documentation and/or other materials provided with the
- * distribution.
- *
- * 3. The end-user documentation included with the redistribution,
- * if any, must include the following acknowledgment:
- * "This product includes software developed by the
- * Apache Software Foundation (http://www.apache.org/)."
- * Alternately, this acknowledgment may appear in the software itself,
- * if and wherever such third-party acknowledgments normally appear.
- *
- * 4. The names "Apache" and "Apache Software Foundation" and
- * "Apache JMeter" must not be used to endorse or promote products
- * derived from this software without prior written permission. For
- * written permission, please contact apache@apache.org.
- *
- * 5. Products derived from this software may not be called "Apache",
- * "Apache JMeter", nor may "Apache" appear in their name, without
- * prior written permission of the Apache Software Foundation.
- *
- * THIS SOFTWARE IS PROVIDED ``AS IS'' AND ANY EXPRESSED OR IMPLIED
- * WARRANTIES, INCLUDING, BUT NOT LIMITED TO, THE IMPLIED WARRANTIES
- * OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE ARE
- * DISCLAIMED.  IN NO EVENT SHALL THE APACHE SOFTWARE FOUNDATION OR
- * ITS CONTRIBUTORS BE LIABLE FOR ANY DIRECT, INDIRECT, INCIDENTAL,
- * SPECIAL, EXEMPLARY, OR CONSEQUENTIAL DAMAGES (INCLUDING, BUT NOT
- * LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES; LOSS OF
- * USE, DATA, OR PROFITS; OR BUSINESS INTERRUPTION) HOWEVER CAUSED AND
- * ON ANY THEORY OF LIABILITY, WHETHER IN CONTRACT, STRICT LIABILITY,
- * OR TORT (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT
- * OF THE USE OF THIS SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF
- * SUCH DAMAGE.
- * ====================================================================
- *
- * This software consists of voluntary contributions made by many
- * individuals on behalf of the Apache Software Foundation.  For more
- * information on the Apache Software Foundation, please see
- * <http://www.apache.org/>.
- */
- package org.apache.jmeter.save.old.handlers;
-
-import java.io.Writer;
-import java.util.List;
-
-import org.apache.jmeter.control.GenericController;
-import org.apache.jmeter.protocol.http.sampler.HTTPSampler;
-import org.apache.jmeter.protocol.http.sampler.HTTPSamplerFull;
-import org.apache.jmeter.save.old.Saveable;
-import org.apache.jmeter.save.old.xml.TagHandler;
-import org.apache.jmeter.testelement.TestElement;
-import org.xml.sax.Attributes;
-
-/**
- *  Title: Apache JMeter Description: Copyright: Copyright (c) 2000 Company:
- *  Apache Foundation
- *
- *@author     Michael Stover
- *@created    February 18, 2001
- *@version    1.0
- */
-
-public class HttpTestSampleHandler extends TagHandler
-{
-	HTTPSampler sampler;
-
-	/**
-	 *  Constructor for the HttpTestSampleHandler object
-	 */
-	public HttpTestSampleHandler()
-	{
-	}
-	
-	public void setAtts(Attributes atts) throws java.lang.Exception
-	{
-		sampler = new HTTPSampler();
-		if(Boolean.valueOf(
-				atts.getValue("getImages")).booleanValue());
-		{
-			sampler = new HTTPSamplerFull();
-		}
-		sampler.setProperty(TestElement.GUI_CLASS,"org.apache.jmeter.protocol.http.control.gui.HttpTestSampleGui");
-		sampler.setName(atts.getValue("name"));
-
-	}
-	
-	public Object getModel()
-	{
-		return sampler;
-	}
-
-	/**
-	 *  Gets the PrimaryTagName attribute of the GenericControllerHandler object
-	 *
-	 *@return    The PrimaryTagName value
-	 */
-	public String getPrimaryTagName()
-	{
-		return "HttpTestSample";
-	}
-
-	public void notifySubElementEnded(Object childObj)
-	{
-		if(this.getMethodName().endsWith("defaultUrl"))
-		{
-			List children = xmlParent.takeChildObjects(this);
-			if (children.size() == 1)
-			{
-				sampler.addTestElement((TestElement)((TagHandler)children.get(0)).getModel());
-			}
-		}
-	}
-
-	/**
-	 *  Description of the Method
-	 *
-	 *@param  cont                     Description of Parameter
-	 *@param  out                      Description of Parameter
-	 *@exception  java.io.IOException  Description of Exception
-	 */
-	public void save(Saveable cont, Writer out) throws java.io.IOException
-	{
-		/*HttpTestSample controller = (HttpTestSample) cont;
-		writeMainTag(out, controller);
-		writeDefaultUrl(out, controller);
-		writeSubElements(controller, out);
-		out.write("</HttpTestSample>\n");*/
-	}
-
-	/**
-	 *  Description of the Method
-	 *
-	 *@param  out                      Description of Parameter
-	 *@param  controller               Description of Parameter
-	 *@exception  java.io.IOException  Description of Exception
-	 */
-	protected void writeMainTag(Writer out, GenericController controller) throws java.io.IOException
-	{
-		/*out.write("<HttpTestSample type=\"");
-		out.write(JMeterHandler.convertToXML(controller.getClass().getName()));
-		out.write("\" name=\"");
-		out.write(JMeterHandler.convertToXML(controller.getName()));
-		out.write("\" getImages=\"");
-		out.write(""+((HttpTestSample)controller).isGetImages());
-		out.write("\">\n");*/
-	}
-
-	/**
-	 *  Description of the Method
-	 *
-	 *@param  out                      Description of Parameter
-	 *@param  controller               Description of Parameter
-	 *@exception  java.io.IOException  Description of Exception
-	 */
-	protected void writeDefaultUrl(Writer out)
-			 throws java.io.IOException
-	{
-		/*out.write("<defaultUrl>\n");
-		JMeterHandler.writeObject(controller.getDefaultUrl(), out);
-		out.write("</defaultUrl>\n");*/
-	}
-}
diff --git a/jakarta-jmeter/src/core/org/apache/jmeter/save/old/handlers/JMeterComponentHandler.java b/jakarta-jmeter/src/core/org/apache/jmeter/save/old/handlers/JMeterComponentHandler.java
deleted file mode 100644
index 9bd9f1b..0000000
--- a/jakarta-jmeter/src/core/org/apache/jmeter/save/old/handlers/JMeterComponentHandler.java
+++ /dev/null
@@ -1,54 +0,0 @@
-package org.apache.jmeter.save.old.handlers;
-
-import java.io.Writer;
-
-import org.apache.jmeter.gui.JMeterComponentModel;
-import org.apache.jmeter.save.old.Saveable;
-import org.apache.jmeter.save.old.xml.TagHandler;
-import org.apache.jmeter.testelement.TestElement;
-import org.xml.sax.Attributes;
-
-/**
- * Title:
- * Description:
- * Copyright:    Copyright (c) 2001
- * Company:
- * @author
- * @version 1.0
- */
-
-public class JMeterComponentHandler extends TagHandler
-{
-	TestElement model;
-
-	public JMeterComponentHandler()
-	{
-	}
-
-	public void save(Saveable saveObject, Writer out) throws java.io.IOException
-	{
-		JMeterComponentModel save = (JMeterComponentModel)saveObject;
-		out.write("<JMeterComponent type=\"");
-		out.write(JMeterHandler.convertToXML(save.getClass().getName()));
-		out.write("\" name=\"");
-		out.write(JMeterHandler.convertToXML(save.getName()));
-		out.write("\"/>");
-	}
-
-	public void setAtts(Attributes atts) throws java.lang.Exception
-	{
-		model = (TestElement)Class.forName(JMeterHandler.getComponentConversion(atts.getValue("type"))).newInstance();
-		model.setProperty(TestElement.NAME,atts.getValue("name"));
-		model.setProperty(TestElement.GUI_CLASS,JMeterHandler.getGuiClass(atts.getValue("type")));
-	}
-
-	public String getPrimaryTagName()
-	{
-		return "JMeterComponent";
-	}
-
-	public Object getModel()
-	{
-		return model;
-	}
-}
\ No newline at end of file
diff --git a/jakarta-jmeter/src/core/org/apache/jmeter/save/old/handlers/JMeterHandler.java b/jakarta-jmeter/src/core/org/apache/jmeter/save/old/handlers/JMeterHandler.java
deleted file mode 100644
index aa2237e..0000000
--- a/jakarta-jmeter/src/core/org/apache/jmeter/save/old/handlers/JMeterHandler.java
+++ /dev/null
@@ -1,368 +0,0 @@
-/*
- * ====================================================================
- * The Apache Software License, Version 1.1
- *
- * Copyright (c) 2001 The Apache Software Foundation.  All rights
- * reserved.
- *
- * Redistribution and use in source and binary forms, with or without
- * modification, are permitted provided that the following conditions
- * are met:
- *
- * 1. Redistributions of source code must retain the above copyright
- * notice, this list of conditions and the following disclaimer.
- *
- * 2. Redistributions in binary form must reproduce the above copyright
- * notice, this list of conditions and the following disclaimer in
- * the documentation and/or other materials provided with the
- * distribution.
- *
- * 3. The end-user documentation included with the redistribution,
- * if any, must include the following acknowledgment:
- * "This product includes software developed by the
- * Apache Software Foundation (http://www.apache.org/)."
- * Alternately, this acknowledgment may appear in the software itself,
- * if and wherever such third-party acknowledgments normally appear.
- *
- * 4. The names "Apache" and "Apache Software Foundation" and
- * "Apache JMeter" must not be used to endorse or promote products
- * derived from this software without prior written permission. For
- * written permission, please contact apache@apache.org.
- *
- * 5. Products derived from this software may not be called "Apache",
- * "Apache JMeter", nor may "Apache" appear in their name, without
- * prior written permission of the Apache Software Foundation.
- *
- * THIS SOFTWARE IS PROVIDED ``AS IS'' AND ANY EXPRESSED OR IMPLIED
- * WARRANTIES, INCLUDING, BUT NOT LIMITED TO, THE IMPLIED WARRANTIES
- * OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE ARE
- * DISCLAIMED.  IN NO EVENT SHALL THE APACHE SOFTWARE FOUNDATION OR
- * ITS CONTRIBUTORS BE LIABLE FOR ANY DIRECT, INDIRECT, INCIDENTAL,
- * SPECIAL, EXEMPLARY, OR CONSEQUENTIAL DAMAGES (INCLUDING, BUT NOT
- * LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES; LOSS OF
- * USE, DATA, OR PROFITS; OR BUSINESS INTERRUPTION) HOWEVER CAUSED AND
- * ON ANY THEORY OF LIABILITY, WHETHER IN CONTRACT, STRICT LIABILITY,
- * OR TORT (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT
- * OF THE USE OF THIS SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF
- * SUCH DAMAGE.
- * ====================================================================
- *
- * This software consists of voluntary contributions made by many
- * individuals on behalf of the Apache Software Foundation.  For more
- * information on the Apache Software Foundation, please see
- * <http://www.apache.org/>.
- */
-package org.apache.jmeter.save.old.handlers;
-
-import java.io.IOException;
-import java.io.Writer;
-import java.util.Collection;
-import java.util.HashMap;
-import java.util.Iterator;
-import java.util.Map;
-
-import org.apache.jmeter.protocol.http.sampler.HTTPSampler;
-import org.apache.jmeter.save.old.SaveHandler;
-import org.apache.jmeter.save.old.Saveable;
-import org.apache.jmeter.testelement.TestElement;
-import org.apache.jmeter.assertions.ResponseAssertion;
-
-
-/**
- *  Title: Description: Copyright: Copyright (c) 2001 Company:
- *
- *@author     Michael Stover
- *@created    June 8, 2001
- *@version    1.0
- */
-
-public class JMeterHandler
-{
-	private static String TOKENS = "&'\"<>\n\r\t\f\b\\";
-	private static Map guiClassMap = new HashMap();
-	private static Map propertyConversion = new HashMap();
-	private static Map componentMap = new HashMap();
-	
-	static
-	{
-		guiClassMap.put("org.apache.jmeter.protocol.http.config.UrlConfig","org.apache.jmeter.protocol.http.config.gui.UrlConfigGui");
-		guiClassMap.put("org.apache.jmeter.control.ModifyController","org.apache.jmeter.control.gui.LogicControllerGui");
-		guiClassMap.put("org.apache.jmeter.control.LogicController",
-				"org.apache.jmeter.control.gui.LogicControllerGui");
-		guiClassMap.put("org.apache.jmeter.timers.GaussianRandomTimer",
-				"org.apache.jmeter.timers.gui.GaussianRandomTimerGui");
-		guiClassMap.put("org.apache.jmeter.timers.ConstantTimer",
-				"org.apache.jmeter.timers.gui.ConstantTimerGui");
-		guiClassMap.put("org.apache.jmeter.timers.UniformRandomTimer",
-				"org.apache.jmeter.timers.gui.UniformRandomTimerGui");
-		guiClassMap.put("org.apache.jmeter.visualizers.GraphModel",
-				"org.apache.jmeter.visualizers.GraphVisualizer");
-		guiClassMap.put("org.apache.jmeter.reporters.AssertionReporter",
-				"org.apache.jmeter.visualizers.AssertionVisualizer");
-		guiClassMap.put("org.apache.jmeter.reporters.ResultCollector",
-				"org.apache.jmeter.visualizers.ViewResultsFullVisualizer");
-		guiClassMap.put("org.apache.jmeter.control.LoopController",
-				"org.apache.jmeter.control.gui.LoopControlPanel");		
-		guiClassMap.put("org.apache.jmeter.protocol.http.modifier.AnchorModifier",
-				"org.apache.jmeter.protocol.http.modifier.gui.AnchorModifierGui");
-		guiClassMap.put("org.apache.jmeter.control.InterleaveControl",
-				"org.apache.jmeter.control.gui.InterleaveControlGui");
-		guiClassMap.put("org.apache.jmeter.control.OnceOnlyController",
-				"org.apache.jmeter.control.gui.OnceOnlyControllerGui");	
-		guiClassMap.put("org.apache.jmeter.protocol.jdbc.config.DbConfig",
-				"org.apache.jmeter.protocol.jdbc.config.gui.DbConfigGui");	
-		guiClassMap.put("org.apache.jmeter.protocol.jdbc.config.PoolConfig",
-				"org.apache.jmeter.protocol.jdbc.config.gui.PoolConfigGui");	
-		guiClassMap.put("org.apache.jmeter.protocol.jdbc.config.SqlConfig",
-				"org.apache.jmeter.protocol.jdbc.config.gui.SqlConfigGui");				
-		guiClassMap.put("org.apache.jmeter.protocol.ftp.config.FtpConfig",
-				"org.apache.jmeter.protocol.ftp.config.gui.FtpConfigGui");				
-		guiClassMap.put("org.apache.jmeter.assertions.Assertion",
-				"org.apache.jmeter.assertions.gui.AssertionGui");
-					
-		
-		propertyConversion.put("arguments",HTTPSampler.ARGUMENTS);
-		propertyConversion.put("port",HTTPSampler.PORT);
-		propertyConversion.put("PROTOCOL",HTTPSampler.PROTOCOL);
-		propertyConversion.put("method",HTTPSampler.METHOD);
-		propertyConversion.put("domain",HTTPSampler.DOMAIN);
-		propertyConversion.put("path",HTTPSampler.PATH);
-		propertyConversion.put("sampler.RESPONSE",ResponseAssertion.RESPONSE_DATA);
-		propertyConversion.put("sampler.LABEL",ResponseAssertion.SAMPLE_LABEL);
-		
-		propertyConversion.put("name",TestElement.NAME);
-		
-		componentMap.put("org.apache.jmeter.visualizers.GraphModel","org.apache.jmeter.reporters.ResultCollector");
-		componentMap.put("org.apache.jmeter.reporters.AssertionReporter","org.apache.jmeter.reporters.ResultCollector");
-		componentMap.put("org.apache.jmeter.reporters.ResultCollector","org.apache.jmeter.reporters.ResultCollector");
-		componentMap.put("org.apache.jmeter.protocol.http.config.UrlConfig","org.apache.jmeter.config.ConfigTestElement");
-		componentMap.put("org.apache.jmeter.protocol.http.config.MultipartUrlConfig","org.apache.jmeter.config.ConfigTestElement");
-		componentMap.put("org.apache.jmeter.assertions.Assertion",
-				"org.apache.jmeter.assertions.ResponseAssertion");
-		
-	}
-		
-
-	/**
-	 *  Constructor for the JMeterHandler object
-	 */
-	public JMeterHandler()
-	{
-	}
-	
-	public static String getComponentConversion(String old)
-	{
-		if(componentMap.containsKey(old))
-		{
-			return (String)componentMap.get(old);
-		}
-		else 
-		{
-			return old;
-		}
-	}
-
-	/**
-	 *  Description of the Method
-	 *
-	 *@param  configs          Description of Parameter
-	 *@param  out              Description of Parameter
-	 *@exception  IOException  Description of Exception
-	 */
-	public static void writeConfigElements(Collection configs, Writer out) throws IOException
-	{
-		out.write("<configElements>\n");
-		writeObjects(configs, out);
-		out.write("</configElements>\n");
-	}
-
-	/**
-	 *  Description of the Method
-	 *
-	 *@param  controls         Description of Parameter
-	 *@param  out              Description of Parameter
-	 *@exception  IOException  Description of Exception
-	 */
-	public static void writeControllers(Collection controls, Writer out) throws IOException
-	{
-		out.write("<controllers>\n");
-		writeObjects(controls, out);
-		out.write("</controllers>\n");
-	}
-
-	/**
-	 *  Description of the Method
-	 *
-	 *@param  groups           Description of Parameter
-	 *@param  out              Description of Parameter
-	 *@exception  IOException  Description of Exception
-	 */
-	public static void writeThreadGroups(Collection groups, Writer out) throws IOException
-	{
-		out.write("<threadgroups>\n");
-		writeObjects(groups, out);
-		out.write("</threadgroups>\n");
-	}
-
-	/**
-	 *  Description of the Method
-	 *
-	 *@param  listeners        Description of Parameter
-	 *@param  out              Description of Parameter
-	 *@exception  IOException  Description of Exception
-	 */
-	public static void writeListeners(Collection listeners, Writer out) throws IOException
-	{
-		out.write("<listeners>\n");
-		writeObjects(listeners, out);
-		out.write("</listeners>\n");
-	}
-
-	/**
-	 *  Description of the Method
-	 *
-	 *@param  timers           Description of Parameter
-	 *@param  out              Description of Parameter
-	 *@exception  IOException  Description of Exception
-	 */
-	public static void writeTimers(Collection timers, Writer out) throws IOException
-	{
-		out.write("<timers>\n");
-		writeObjects(timers, out);
-		out.write("</timers>\n");
-	}
-
-	/**
-	 *  Description of the Method
-	 *
-	 *@param  objects          Description of Parameter
-	 *@param  out              Description of Parameter
-	 *@exception  IOException  Description of Exception
-	 */
-	public static void writeObjects(Collection objects, Writer out) throws IOException
-	{
-		Iterator iter = objects.iterator();
-		while (iter.hasNext())
-		{
-			writeObject(iter.next(), out);
-			out.write("\n");
-		}
-	}
-
-	/**
-	 *  Description of the Method
-	 *
-	 *@param  obj              Description of Parameter
-	 *@param  out              Description of Parameter
-	 *@exception  IOException  Description of Exception
-	 */
-	public static void writeObject(Object obj, Writer out) throws IOException
-	{
-		if (obj instanceof Saveable)
-		{
-			try
-			{
-				((SaveHandler) ((Saveable) obj).getTagHandlerClass().newInstance()).save(
-						(Saveable) obj, out);
-			}
-			catch (Exception ex)
-			{
-				ex.printStackTrace();
-			}
-		}
-		else
-		{
-			out.write(convertToXML(obj.toString()));
-		}
-	}
-	
-	public static String getGuiClass(String testClass)
-	{
-		return (String)guiClassMap.get(testClass);
-	}
-	
-	public static String convertProperty(String prop)
-	{
-		if(propertyConversion.containsKey(prop))
-		{
-			return (String)propertyConversion.get(prop);
-		}
-		else return prop;
-	}
-
-	/**
-	 *  Description of the Method
-	 *
-	 *@param  input  Description of Parameter
-	 *@return        Description of the Returned Value
-	 */
-	public static String convertToXML(String input)
-	{
-		if (input == null)
-		{
-			return null;
-		}
-		String retVal = "";
-		StringBuffer buffer = new StringBuffer(input);
-		int length = buffer.length();
-		for (int i = 0; i < length; i++)
-		{
-			char ch = buffer.charAt(i);
-			int chInt = (int) ch;
-			if (Character.isLetterOrDigit(ch) || ch == '\n' || ch == '\r' || ch == '\t' || ch == ' ')
-			{
-				continue;
-			}
-			int chType = Character.getType(ch);
-			if (chType == Character.CONTROL || chType == Character.UNASSIGNED)
-			{
-				buffer.setCharAt(i, ' ');
-			}
-		}
-		input = buffer.toString();
-		buffer = new StringBuffer();
-		java.util.StringTokenizer tokenizer = new java.util.StringTokenizer(input, TOKENS, true);
-		while (tokenizer.hasMoreTokens())
-		{
-			String nextToken = tokenizer.nextToken();
-			length = nextToken.length();
-			if (length > 1)
-			{
-				buffer.append(nextToken);
-			}
-			else if (length == 1)
-			{
-				char ch = nextToken.charAt(0);
-				switch (ch)
-				{
-					case '&':
-						buffer.append("&amp;");
-						break;
-					case '\'':
-						buffer.append("&apos;");
-						break;
-					case '"':
-						buffer.append("&quot;");
-						break;
-					case '<':
-						buffer.append("&lt;");
-						break;
-					case '>':
-						buffer.append("&gt;");
-						break;
-					case '\n':
-					case '\r':
-					case '\t':
-					case '\f':
-					case '\b':
-					case '\\':
-						buffer.append("&#");buffer.append((int)ch);buffer.append(";");
-						break;
-					default:
-						buffer.append(nextToken);
-				}
-			}
-		}
-		return buffer.toString();
-	}
-}
diff --git a/jakarta-jmeter/src/core/org/apache/jmeter/save/old/handlers/JdbcTestSampleHandler.java b/jakarta-jmeter/src/core/org/apache/jmeter/save/old/handlers/JdbcTestSampleHandler.java
deleted file mode 100644
index 5ed2b29..0000000
--- a/jakarta-jmeter/src/core/org/apache/jmeter/save/old/handlers/JdbcTestSampleHandler.java
+++ /dev/null
@@ -1,256 +0,0 @@
-/*
- * ====================================================================
- * The Apache Software License, Version 1.1
- *
- * Copyright (c) 2001 The Apache Software Foundation.  All rights
- * reserved.
- *
- * Redistribution and use in source and binary forms, with or without
- * modification, are permitted provided that the following conditions
- * are met:
- *
- * 1. Redistributions of source code must retain the above copyright
- * notice, this list of conditions and the following disclaimer.
- *
- * 2. Redistributions in binary form must reproduce the above copyright
- * notice, this list of conditions and the following disclaimer in
- * the documentation and/or other materials provided with the
- * distribution.
- *
- * 3. The end-user documentation included with the redistribution,
- * if any, must include the following acknowledgment:
- * "This product includes software developed by the
- * Apache Software Foundation (http://www.apache.org/)."
- * Alternately, this acknowledgment may appear in the software itself,
- * if and wherever such third-party acknowledgments normally appear.
- *
- * 4. The names "Apache" and "Apache Software Foundation" and
- * "Apache JMeter" must not be used to endorse or promote products
- * derived from this software without prior written permission. For
- * written permission, please contact apache@apache.org.
- *
- * 5. Products derived from this software may not be called "Apache",
- * "Apache JMeter", nor may "Apache" appear in their name, without
- * prior written permission of the Apache Software Foundation.
- *
- * THIS SOFTWARE IS PROVIDED ``AS IS'' AND ANY EXPRESSED OR IMPLIED
- * WARRANTIES, INCLUDING, BUT NOT LIMITED TO, THE IMPLIED WARRANTIES
- * OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE ARE
- * DISCLAIMED.  IN NO EVENT SHALL THE APACHE SOFTWARE FOUNDATION OR
- * ITS CONTRIBUTORS BE LIABLE FOR ANY DIRECT, INDIRECT, INCIDENTAL,
- * SPECIAL, EXEMPLARY, OR CONSEQUENTIAL DAMAGES (INCLUDING, BUT NOT
- * LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES; LOSS OF
- * USE, DATA, OR PROFITS; OR BUSINESS INTERRUPTION) HOWEVER CAUSED AND
- * ON ANY THEORY OF LIABILITY, WHETHER IN CONTRACT, STRICT LIABILITY,
- * OR TORT (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT
- * OF THE USE OF THIS SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF
- * SUCH DAMAGE.
- * ====================================================================
- *
- * This software consists of voluntary contributions made by many
- * individuals on behalf of the Apache Software Foundation.  For more
- * information on the Apache Software Foundation, please see
- * <http://www.apache.org/>.
- */
-package org.apache.jmeter.save.old.handlers;
-
-import java.io.Writer;
-import java.util.List;
-
-import org.apache.jmeter.control.GenericController;
-import org.apache.jmeter.protocol.jdbc.sampler.JDBCSampler;
-import org.apache.jmeter.save.old.Saveable;
-import org.apache.jmeter.save.old.xml.TagHandler;
-import org.apache.jmeter.testelement.TestElement;
-import org.xml.sax.Attributes;
-
-/************************************************************
- *  Title: Description: Copyright: Copyright (c) 2001 Company:
- *
- *@author     Michael Stover
- *@created    $Date: 2002/08/11 19:24:48 $
- *@version    1.0
- ***********************************************************/
-
-public class JdbcTestSampleHandler extends TagHandler
-{
-	
-	JDBCSampler sampler;
-
-	/************************************************************
-	 *  !ToDo (Constructor description)
-	 ***********************************************************/
-	public JdbcTestSampleHandler()
-	{
-	}
-
-	/************************************************************
-	 *  Gets the PrimaryTagName attribute of the GenericControllerHandler object
-	 *
-	 *@return    The PrimaryTagName value
-	 ***********************************************************/
-	public String getPrimaryTagName()
-	{
-		return "JdbcTestSample";
-	}
-
-	/************************************************************
-	 *  !ToDo (Method description)
-	 *
-	 *@param  childObj  !ToDo (Parameter description)
-	 ***********************************************************/
-	public void notifySubElementEnded(Object childObj)
-	{
-		System.out.println(childObj);
-		if (this.getMethodName().endsWith("defaultDb"))
-		{
-			retrieveDefaultDbConfig();
-		}
-		if (this.getMethodName().endsWith("defaultPool"))
-		{
-			retrieveDefaultPoolConfig();
-		}
-		if (this.getMethodName().endsWith("defaultSql"))
-		{
-			retrieveDefaultSqlConfig();
-		}
-	}
-
-	/************************************************************
-	 *  Description of the Method
-	 ***********************************************************/
-	public void defaultDbTagEnd()
-	{
-		retrieveDefaultDbConfig();
-	}
-
-	/************************************************************
-	 *  !ToDo (Method description)
-	 ***********************************************************/
-	public void defaultPoolTagEnd()
-	{
-		List children = xmlParent.takeChildObjects(this);
-		if (children.size() == 1)
-		{
-			sampler.addTestElement((TestElement)((TagHandler)children.get(0)).getModel());
-		}
-	}
-	
-	public void setAtts(Attributes atts) throws java.lang.Exception
-	{
-		sampler = new JDBCSampler();
-		sampler.setProperty(TestElement.GUI_CLASS,"org.apache.jmeter.protocol.jdbc.control.gui.JdbcTestSampleGui");
-		sampler.setName(atts.getValue("name"));
-
-	}
-	
-	public Object getModel()
-	{
-		return sampler;
-	}
-
-	/************************************************************
-	 *  Description of the Method
-	 *
-	 *@param  cont                     Description of Parameter
-	 *@param  out                      Description of Parameter
-	 *@exception  java.io.IOException  Description of Exception
-	 ***********************************************************/
-	public void save(Saveable cont, Writer out) throws java.io.IOException
-	{
-		/*JdbcTestSample controller = (JdbcTestSample)cont;
-		writeMainTag(out, controller);
-		writeDefaultDb(out, controller);
-		writeDefaultPool(out, controller);
-		writeDefaultSql(out, controller);
-		writeSubElements(controller, out);
-		out.write("</JdbcTestSample>\n");*/
-	}
-
-	/************************************************************
-	 *  Description of the Method
-	 *
-	 *@param  out                      Description of Parameter
-	 *@param  controller               Description of Parameter
-	 *@exception  java.io.IOException  Description of Exception
-	 ***********************************************************/
-	protected void writeMainTag(Writer out, GenericController controller) throws java.io.IOException
-	{
-		/*out.write("<JdbcTestSample type=\"");
-		out.write(JMeterHandler.convertToXML(controller.getClass().getName()));
-		out.write("\" name=\"");
-		out.write(JMeterHandler.convertToXML(controller.getName()));
-		out.write("\">\n");*/
-	}
-
-	/************************************************************
-	 *  Description of the Method
-	 *
-	 *@param  out                      Description of Parameter
-	 *@param  controller               Description of Parameter
-	 *@exception  java.io.IOException  Description of Exception
-	 ***********************************************************/
-	protected void writeDefaultDb(Writer out)
-			 throws java.io.IOException
-	{
-		/*out.write("<defaultDb>\n");
-		JMeterHandler.writeObject(controller.getDefaultDbConfig(), out);
-		out.write("</defaultDb>\n");*/
-	}
-
-	/************************************************************
-	 *  !ToDo (Method description)
-	 *
-	 *@param  out                      !ToDo (Parameter description)
-	 *@param  controller               !ToDo (Parameter description)
-	 *@exception  java.io.IOException  !ToDo (Exception description)
-	 ***********************************************************/
-	protected void writeDefaultPool(Writer out)
-			 throws java.io.IOException
-	{
-		/*out.write("<defaultPool>\n");
-		JMeterHandler.writeObject(controller.getDefaultPoolConfig(), out);
-		out.write("</defaultPool>\n");*/
-	}
-
-	/************************************************************
-	 *  !ToDo (Method description)
-	 *
-	 *@param  out                      !ToDo (Parameter description)
-	 *@param  controller               !ToDo (Parameter description)
-	 *@exception  java.io.IOException  !ToDo (Exception description)
-	 ***********************************************************/
-	protected void writeDefaultSql(Writer out) throws java.io.IOException
-	{
-		/*out.write("<defaultSql>\n");
-		JMeterHandler.writeObject(controller.getDefaultSqlConfig(), out);
-		out.write("</defaultSql>\n");*/
-	}
-
-	private void retrieveDefaultDbConfig()
-	{
-		List children = xmlParent.takeChildObjects(this);
-		if (children.size() == 1)
-		{
-			sampler.addTestElement((TestElement)((TagHandler)children.get(0)).getModel());
-		}
-	}
-
-	private void retrieveDefaultPoolConfig()
-	{
-		List children = xmlParent.takeChildObjects(this);
-		if (children.size() == 1)
-		{
-			sampler.addTestElement((TestElement)((TagHandler)children.get(0)).getModel());
-		}
-	}
-
-	private void retrieveDefaultSqlConfig()
-	{
-		List children = xmlParent.takeChildObjects(this);
-		if (children.size() == 1)
-		{
-			sampler.addTestElement((TestElement)((TagHandler)children.get(0)).getModel());
-		}
-	}
-}
diff --git a/jakarta-jmeter/src/core/org/apache/jmeter/save/old/handlers/LoopControlHandler.java b/jakarta-jmeter/src/core/org/apache/jmeter/save/old/handlers/LoopControlHandler.java
deleted file mode 100644
index 55fe35c..0000000
--- a/jakarta-jmeter/src/core/org/apache/jmeter/save/old/handlers/LoopControlHandler.java
+++ /dev/null
@@ -1,135 +0,0 @@
-/*
- * ====================================================================
- * The Apache Software License, Version 1.1
- *
- * Copyright (c) 2001 The Apache Software Foundation.  All rights
- * reserved.
- *
- * Redistribution and use in source and binary forms, with or without
- * modification, are permitted provided that the following conditions
- * are met:
- *
- * 1. Redistributions of source code must retain the above copyright
- * notice, this list of conditions and the following disclaimer.
- *
- * 2. Redistributions in binary form must reproduce the above copyright
- * notice, this list of conditions and the following disclaimer in
- * the documentation and/or other materials provided with the
- * distribution.
- *
- * 3. The end-user documentation included with the redistribution,
- * if any, must include the following acknowledgment:
- * "This product includes software developed by the
- * Apache Software Foundation (http://www.apache.org/)."
- * Alternately, this acknowledgment may appear in the software itself,
- * if and wherever such third-party acknowledgments normally appear.
- *
- * 4. The names "Apache" and "Apache Software Foundation" and
- * "Apache JMeter" must not be used to endorse or promote products
- * derived from this software without prior written permission. For
- * written permission, please contact apache@apache.org.
- *
- * 5. Products derived from this software may not be called "Apache",
- * "Apache JMeter", nor may "Apache" appear in their name, without
- * prior written permission of the Apache Software Foundation.
- *
- * THIS SOFTWARE IS PROVIDED ``AS IS'' AND ANY EXPRESSED OR IMPLIED
- * WARRANTIES, INCLUDING, BUT NOT LIMITED TO, THE IMPLIED WARRANTIES
- * OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE ARE
- * DISCLAIMED.  IN NO EVENT SHALL THE APACHE SOFTWARE FOUNDATION OR
- * ITS CONTRIBUTORS BE LIABLE FOR ANY DIRECT, INDIRECT, INCIDENTAL,
- * SPECIAL, EXEMPLARY, OR CONSEQUENTIAL DAMAGES (INCLUDING, BUT NOT
- * LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES; LOSS OF
- * USE, DATA, OR PROFITS; OR BUSINESS INTERRUPTION) HOWEVER CAUSED AND
- * ON ANY THEORY OF LIABILITY, WHETHER IN CONTRACT, STRICT LIABILITY,
- * OR TORT (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT
- * OF THE USE OF THIS SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF
- * SUCH DAMAGE.
- * ====================================================================
- *
- * This software consists of voluntary contributions made by many
- * individuals on behalf of the Apache Software Foundation.  For more
- * information on the Apache Software Foundation, please see
- * <http://www.apache.org/>.
- */
-package org.apache.jmeter.save.old.handlers;
-
-import java.io.Writer;
-
-import org.apache.jmeter.control.GenericController;
-import org.apache.jmeter.control.LoopController;
-import org.apache.jmeter.save.old.Saveable;
-import org.apache.jmeter.testelement.TestElement;
-import org.xml.sax.Attributes;
-
-/************************************************************
- *  Title: JMeter Description: Copyright: Copyright (c) 2000 Company: Apache
- *
- *@author     Michael Stover
- *@created    $Date: 2002/08/11 19:24:48 $
- *@version    1.0
- ***********************************************************/
-
-public class LoopControlHandler extends GenericControllerHandler
-{
-
-	/************************************************************
-	 *  !ToDo (Constructor description)
-	 ***********************************************************/
-	public LoopControlHandler()
-	{
-		super();
-	}
-
-	public String getPrimaryTagName()
-	{
-		return "LoopController";
-	}
-
-	/************************************************************
-	 *  !ToDo (Method description)
-	 *
-	 *@param  atts                     !ToDo (Parameter description)
-	 *@exception  java.lang.Exception  !ToDo (Exception description)
-	 ***********************************************************/
-	public void setAtts(Attributes atts) throws java.lang.Exception
-	{
-		controller = (LoopController)Class.forName(atts.getValue("type")).newInstance();
-		controller.setProperty(TestElement.GUI_CLASS,JMeterHandler.getGuiClass(atts.getValue("type")));
-		((LoopController)controller).setName(atts.getValue("name"));
-		((LoopController)controller).setLoops(Integer.parseInt(atts.getValue("iterations")));
-	}
-
-	/************************************************************
-	 *  !ToDo (Method description)
-	 *
-	 *@param  out                      !ToDo (Parameter description)
-	 *@param  controller               !ToDo (Parameter description)
-	 *@exception  java.io.IOException  !ToDo (Exception description)
-	 ***********************************************************/
-	protected void writeMainTag(Writer out, GenericController controller) throws java.io.IOException
-	{
-		out.write("<LoopController type=\"");
-		out.write(JMeterHandler.convertToXML(controller.getClass().getName()));
-		out.write("\" name=\"");
-		out.write(JMeterHandler.convertToXML(controller.getName()));
-		out.write("\" iterations=\"");
-		out.write("" + ((LoopController)controller).getLoops());
-		out.write("\">\n");
-	}
-
-	/**
-	 *  Description of the Method
-	 *
-	 *@param  cont                     Description of Parameter
-	 *@param  out                      Description of Parameter
-	 *@exception  java.io.IOException  Description of Exception
-	 */
-	public void save(Saveable cont, Writer out) throws java.io.IOException
-	{
-		LoopController controller = (LoopController) cont;
-		writeMainTag(out, controller);
-		writeSubElements(controller, out);
-		out.write("</LoopController>");
-	}
-}
diff --git a/jakarta-jmeter/src/core/org/apache/jmeter/save/old/handlers/ParamMaskHandler.java b/jakarta-jmeter/src/core/org/apache/jmeter/save/old/handlers/ParamMaskHandler.java
deleted file mode 100644
index 6e26c75..0000000
--- a/jakarta-jmeter/src/core/org/apache/jmeter/save/old/handlers/ParamMaskHandler.java
+++ /dev/null
@@ -1,92 +0,0 @@
-package org.apache.jmeter.save.old.handlers;
-
-import java.io.IOException;
-import java.io.Writer;
-
-import org.apache.jmeter.protocol.http.modifier.ParamMask;
-import org.apache.jmeter.save.old.Saveable;
-import org.apache.jmeter.save.old.xml.TagHandler;
-import org.apache.jmeter.testelement.TestElement;
-import org.xml.sax.Attributes;
-
-/**
- * Saves and loads a {@link ParamMask} object to/from XML format.
- *
- * @author David La France
- * @version 1.0
- */
-public class ParamMaskHandler extends TagHandler {
-
-    /**
-     * Default constructor
-     */
-    public ParamMaskHandler() {
-    }
-
-    /**
-     * Writes a {@link ParamMask} object in XML format to the given <code>Writer</code>
-     */
-    public void save(Saveable parm1, Writer out) throws IOException {
-        ParamMask mask = (ParamMask) parm1;
-        out.write("\n");
-        out.write("  <ParamMask>\n");
-        out.write("    <mask name=\"");
-        out.write(JMeterHandler.convertToXML(mask.getName()));
-        out.write("\" prefix=\"");
-        out.write(JMeterHandler.convertToXML(mask.getPrefix()));
-        out.write("\" upperBound=\"");
-        out.write(JMeterHandler.convertToXML(Long.toString(mask.getUpperBound())));
-        out.write("\" lowerBound=\"");
-        out.write(JMeterHandler.convertToXML(Long.toString(mask.getLowerBound())));
-        out.write("\" increment=\"");
-        out.write(JMeterHandler.convertToXML(Long.toString(mask.getIncrement())));
-        out.write("\">");
-        out.write("</mask>\n");
-        out.write("  </ParamMask>\n");
-    }
-
-    /**
-     * This method is automatically called whenever a "ParamMask" tag is reached.  The ParamMask
-     * tag does not currently support attributes
-     *
-     * @param atts The attributes of the XML "ParamMask" tag
-     */
-    public void setAtts(Attributes atts) throws Exception {
-        _mask = new ParamMask();
-        _mask.setProperty(TestElement.GUI_CLASS,JMeterHandler.getGuiClass(atts.getValue("type")));
-    }
-
-
-    public String getPrimaryTagName() {
-        return "ParamMask";
-    }
-
-    /**
-     * This method is automatically called whenever a "mask" tag is reached.  Loads the values for
-     * the ParamMask
-     *
-     * @param atts The attributes of the XML "mask" tag
-     */
-    public void mask(Attributes atts) {
-        _mask.setName       (atts.getValue("name"));
-        _mask.setPrefix     (atts.getValue("prefix"));
-        _mask.setUpperBound (Long.parseLong(atts.getValue("upperBound")));
-        _mask.setLowerBound (Long.parseLong(atts.getValue("lowerBound")));
-        _mask.setIncrement  (Long.parseLong(atts.getValue("increment")));
-    }
-
-    /**
-     * This method is called with any String data found between the start and end tags of a "mask"
-     * tag.
-     *
-     * @param data The string data found
-     */
-    public void mask(String data) {
-    }
-
-    public Object getModel() {
-        return _mask;
-    }
-
-    ParamMask _mask;
-}
\ No newline at end of file
diff --git a/jakarta-jmeter/src/core/org/apache/jmeter/save/old/handlers/ProxyControlHandler.java b/jakarta-jmeter/src/core/org/apache/jmeter/save/old/handlers/ProxyControlHandler.java
deleted file mode 100644
index c4435c2..0000000
--- a/jakarta-jmeter/src/core/org/apache/jmeter/save/old/handlers/ProxyControlHandler.java
+++ /dev/null
@@ -1,179 +0,0 @@
-/*
- * ====================================================================
- * The Apache Software License, Version 1.1
- *
- * Copyright (c) 2001 The Apache Software Foundation.  All rights
- * reserved.
- *
- * Redistribution and use in source and binary forms, with or without
- * modification, are permitted provided that the following conditions
- * are met:
- *
- * 1. Redistributions of source code must retain the above copyright
- * notice, this list of conditions and the following disclaimer.
- *
- * 2. Redistributions in binary form must reproduce the above copyright
- * notice, this list of conditions and the following disclaimer in
- * the documentation and/or other materials provided with the
- * distribution.
- *
- * 3. The end-user documentation included with the redistribution,
- * if any, must include the following acknowledgment:
- * "This product includes software developed by the
- * Apache Software Foundation (http://www.apache.org/)."
- * Alternately, this acknowledgment may appear in the software itself,
- * if and wherever such third-party acknowledgments normally appear.
- *
- * 4. The names "Apache" and "Apache Software Foundation" and
- * "Apache JMeter" must not be used to endorse or promote products
- * derived from this software without prior written permission. For
- * written permission, please contact apache@apache.org.
- *
- * 5. Products derived from this software may not be called "Apache",
- * "Apache JMeter", nor may "Apache" appear in their name, without
- * prior written permission of the Apache Software Foundation.
- *
- * THIS SOFTWARE IS PROVIDED ``AS IS'' AND ANY EXPRESSED OR IMPLIED
- * WARRANTIES, INCLUDING, BUT NOT LIMITED TO, THE IMPLIED WARRANTIES
- * OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE ARE
- * DISCLAIMED.  IN NO EVENT SHALL THE APACHE SOFTWARE FOUNDATION OR
- * ITS CONTRIBUTORS BE LIABLE FOR ANY DIRECT, INDIRECT, INCIDENTAL,
- * SPECIAL, EXEMPLARY, OR CONSEQUENTIAL DAMAGES (INCLUDING, BUT NOT
- * LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES; LOSS OF
- * USE, DATA, OR PROFITS; OR BUSINESS INTERRUPTION) HOWEVER CAUSED AND
- * ON ANY THEORY OF LIABILITY, WHETHER IN CONTRACT, STRICT LIABILITY,
- * OR TORT (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT
- * OF THE USE OF THIS SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF
- * SUCH DAMAGE.
- * ====================================================================
- *
- * This software consists of voluntary contributions made by many
- * individuals on behalf of the Apache Software Foundation.  For more
- * information on the Apache Software Foundation, please see
- * <http://www.apache.org/>.
- */
-
-package org.apache.jmeter.save.old.handlers;
-
-
-import java.io.IOException;
-import java.io.Writer;
-import java.util.Iterator;
-import java.util.List;
-
-import org.apache.jmeter.config.Argument;
-import org.apache.jmeter.config.Arguments;
-import org.apache.jmeter.protocol.http.proxy.ProxyControl;
-import org.apache.jmeter.save.old.Saveable;
-import org.apache.jmeter.save.old.xml.TagHandler;
-import org.apache.jmeter.testelement.TestElement;
-import org.xml.sax.Attributes;
-
-
-
-/************************************************************
- *  Title: JMeter Description: Copyright: Copyright (c) 2000 Company: Apache
- *
- *@author     Michael Stover
- *@created    June 9, 2001
- *@version    1.0
- ***********************************************************/
-
-
-public class ProxyControlHandler extends AbstractConfigElementHandler
-{
-
-	/************************************************************
-	 *  This is called when a tag is first encountered for this handler class to
-	 *  handle. The attributes of the tag are passed, and the SaveHandler object is
-	 *  expected to instantiate a new object.
-	 *
-	 *@param  atts           The new Atts value
-	 *@exception  Exception  Description of Exception
-	 ***********************************************************/
-	public void setAtts(Attributes atts) throws Exception
-	{
-		config = new ProxyControl();
-		config.setProperty(TestElement.GUI_CLASS,"org.apache.jmeter.protocol.http.proxy.gui.ProxyControlGui");
-		config.setProperty(TestElement.NAME,atts.getValue("name"));
-	}
-
-	/************************************************************
-	 *  Gets the tag name that will trigger the use of this object's TagHandler.
-	 *
-	 *@return    The PrimaryTagName value
-	 ***********************************************************/
-	public String getPrimaryTagName()
-	{
-		return "ProxyControl";
-	}
-
-	/************************************************************
-	 *  Called by reflection when the &lt;property&gt; tag is ended.
-	 ***********************************************************/
-	public void propertyTagEnd()
-	{
-		List children = xmlParent.takeChildObjects(this);
-		if(children.size() == 1) {
-			// Include or Exclude list, encapsulated as a set of Arguments
-			Object model = ((TagHandler)children.get(0)).getModel();
-			if (model instanceof Arguments) {
-				Arguments args = (Arguments) model;
-				List list = null;
-				ProxyControl proxy = (ProxyControl) config;
-				if (currentProperty.equals("includes")) {
-					list = proxy.getIncludePatterns();
-				} else if (currentProperty.equals("excludes")) {
-					list = proxy.getExcludePatterns();
-				}
-				if (list != null) {
-					for (Iterator iter = args.iterator(); iter.hasNext(); ) {
-						Argument arg = (Argument) iter.next();
-						list.add(arg.getValue());
-					}
-				}
-			}
-		}
-	}
-
-
-
-	/************************************************************
-	 *  Tells the object to save itself to the given output stream.
-	 *
-	 *@param  obj              Description of Parameter
-	 *@param  out              Description of Parameter
-	 *@exception  IOException  Description of Exception
-	 ***********************************************************/
-	public void save(Saveable obj, Writer out) throws IOException
-	{
-		ProxyControl saved = (ProxyControl)obj;
-		String tagName = getPrimaryTagName();
-		out.write("<" + tagName);
-		out.write(" type=\"");
-		out.write(JMeterHandler.convertToXML(saved.getClass().getName()));
-		out.write("\"");
-		out.write(">\n");
-
-		for (Iterator iter = saved.getPropertyNames().iterator(); iter.hasNext(); ) {
-			String key = (String)iter.next();
-			Object value = saved.getProperty(key);
-			writeProperty(out, key, value);
-		}
-
-		writePatterns(saved.getIncludePatterns(), "includes", out);
-		writePatterns(saved.getExcludePatterns(), "excludes", out);
-
-		out.write("</" + tagName + ">");
-	}
-
-	private void writePatterns(List list, String name, Writer out) throws IOException {
-		Arguments args = new Arguments();
-		int i = 0;
-		for (Iterator iter = list.iterator(); iter.hasNext(); ) {
-			String pattern = (String) iter.next();
-			args.addArgument("arg" + i++, pattern);
-		}
-		writeProperty(out, name, args);
-	}
-}
diff --git a/jakarta-jmeter/src/core/org/apache/jmeter/save/old/handlers/ThreadGroupHandler.java b/jakarta-jmeter/src/core/org/apache/jmeter/save/old/handlers/ThreadGroupHandler.java
deleted file mode 100644
index 568ecb5..0000000
--- a/jakarta-jmeter/src/core/org/apache/jmeter/save/old/handlers/ThreadGroupHandler.java
+++ /dev/null
@@ -1,183 +0,0 @@
-/*
- * ====================================================================
- * The Apache Software License, Version 1.1
- *
- * Copyright (c) 2001 The Apache Software Foundation.  All rights
- * reserved.
- *
- * Redistribution and use in source and binary forms, with or without
- * modification, are permitted provided that the following conditions
- * are met:
- *
- * 1. Redistributions of source code must retain the above copyright
- * notice, this list of conditions and the following disclaimer.
- *
- * 2. Redistributions in binary form must reproduce the above copyright
- * notice, this list of conditions and the following disclaimer in
- * the documentation and/or other materials provided with the
- * distribution.
- *
- * 3. The end-user documentation included with the redistribution,
- * if any, must include the following acknowledgment:
- * "This product includes software developed by the
- * Apache Software Foundation (http://www.apache.org/)."
- * Alternately, this acknowledgment may appear in the software itself,
- * if and wherever such third-party acknowledgments normally appear.
- *
- * 4. The names "Apache" and "Apache Software Foundation" and
- * "Apache JMeter" must not be used to endorse or promote products
- * derived from this software without prior written permission. For
- * written permission, please contact apache@apache.org.
- *
- * 5. Products derived from this software may not be called "Apache",
- * "Apache JMeter", nor may "Apache" appear in their name, without
- * prior written permission of the Apache Software Foundation.
- *
- * THIS SOFTWARE IS PROVIDED ``AS IS'' AND ANY EXPRESSED OR IMPLIED
- * WARRANTIES, INCLUDING, BUT NOT LIMITED TO, THE IMPLIED WARRANTIES
- * OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE ARE
- * DISCLAIMED.  IN NO EVENT SHALL THE APACHE SOFTWARE FOUNDATION OR
- * ITS CONTRIBUTORS BE LIABLE FOR ANY DIRECT, INDIRECT, INCIDENTAL,
- * SPECIAL, EXEMPLARY, OR CONSEQUENTIAL DAMAGES (INCLUDING, BUT NOT
- * LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES; LOSS OF
- * USE, DATA, OR PROFITS; OR BUSINESS INTERRUPTION) HOWEVER CAUSED AND
- * ON ANY THEORY OF LIABILITY, WHETHER IN CONTRACT, STRICT LIABILITY,
- * OR TORT (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT
- * OF THE USE OF THIS SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF
- * SUCH DAMAGE.
- * ====================================================================
- *
- * This software consists of voluntary contributions made by many
- * individuals on behalf of the Apache Software Foundation.  For more
- * information on the Apache Software Foundation, please see
- * <http://www.apache.org/>.
- */
-package org.apache.jmeter.save.old.handlers;
-
-import java.io.Writer;
-import java.util.Iterator;
-
-import org.apache.jmeter.control.LoopController;
-import org.apache.jmeter.save.old.Saveable;
-import org.apache.jmeter.save.old.xml.TagHandler;
-import org.apache.jmeter.testelement.TestElement;
-import org.apache.jmeter.threads.ThreadGroup;
-import org.xml.sax.Attributes;
-
-/************************************************************
- *  Title: Description: Copyright: Copyright (c) 2001 Company:
- *
- *@author     Michael Stover
- *@created    $Date: 2002/08/11 19:24:48 $
- *@version    1.0
- ***********************************************************/
-
-public class ThreadGroupHandler extends TagHandler
-{
-
-	 private ThreadGroup group;
-
-	 /************************************************************
-	  *  !ToDo (Constructor description)
-	  ***********************************************************/
-	 public ThreadGroupHandler()
-	 {
-	 }
-
-	 /************************************************************
-	  *  !ToDo (Method description)
-	  *
-	  *@param  atts                     !ToDo (Parameter description)
-	  *@exception  java.lang.Exception  !ToDo (Exception description)
-	  ***********************************************************/
-	 public void setAtts(Attributes atts) throws java.lang.Exception
-	 {
-		  group = new ThreadGroup();
-		  group.setName(atts.getValue("name"));
-		  group.setProperty(TestElement.GUI_CLASS,
-				"org.apache.jmeter.threads.gui.ThreadGroupGui");
-		  try
-		  {
-				group.setNumThreads(Integer.parseInt(atts.getValue("numThreads")));
-		  }
-		  catch(NumberFormatException err)
-		  {
-		  	group.setNumThreads(1);
-		  }
-		  try
-		  {
-				group.setRampUp(Integer.parseInt(atts.getValue("rampUp")));
-		  }
-		  catch (NumberFormatException ex)
-		  {
-				group.setRampUp(0);
-		  }
-
-	 }
-
-	 /************************************************************
-	  *  !ToDoo (Method description)
-	  *
-	  *@return    !ToDo (Return description)
-	  ***********************************************************/
-	 public String getPrimaryTagName()
-	 {
-		  return "ThreadGroup";
-	 }
-
-	 /************************************************************
-	  *  !ToDoo (Method description)
-	  *
-	  *@return    !ToDo (Return description)
-	  ***********************************************************/
-	 public Object getModel()
-	 {
-		  return group;
-	 }
-
-	 /************************************************************
-	  *  !ToDo (Method description)
-	  *
-	  *@param  s                        !ToDo (Parameter description)
-	  *@param  out                      !ToDo (Parameter description)
-	  *@exception  java.io.IOException  !ToDo (Exception description)
-	  ***********************************************************/
-	 public void save(Saveable s, Writer out) throws java.io.IOException
-	 {
-		  /*ThreadGroup save = (ThreadGroup)s;
-		  out.write("<ThreadGroup name=\"");
-		  out.write(JMeterHandler.convertToXML(save.getName()));
-		  out.write("\" numThreads=\"");
-
-		  out.write(String.valueOf(save.getNumThreads()));
-
-		  out.write("\" rampUp=\"");
-		  out.write(String.valueOf(save.getRampUp()));
-		  out.write("\"");
-
-		  out.write(">\n");
-		  Collection controllers = new LinkedList();
-		  controllers.add(save.getSamplerController());
-		  JMeterHandler.writeControllers(controllers, out);
-		  JMeterHandler.writeTimers(save.getTimers(), out);
-		  JMeterHandler.writeListeners(save.getListeners(), out);
-		  out.write("</ThreadGroup>\n");*/
-	 }
-
-	 /************************************************************
-	  *  !ToDo (Method description)
-	  *
-	  *@param  childObj  !ToDo (Parameter description)
-	  ***********************************************************/
-	 public void notifySubElementEnded(Object childObj)
-	 {
-		  if (childObj instanceof LoopController)
-		  {
-				Iterator children = xmlParent.takeChildObjects(this).iterator();
-				if (children.hasNext())
-				{
-					 group.setSamplerController((LoopController)((TagHandler)children.next()).getModel());
-				}
-		  }
-	 }
-}
diff --git a/jakarta-jmeter/src/core/org/apache/jmeter/save/old/handlers/TimerHandler.java b/jakarta-jmeter/src/core/org/apache/jmeter/save/old/handlers/TimerHandler.java
deleted file mode 100644
index ae5cd04..0000000
--- a/jakarta-jmeter/src/core/org/apache/jmeter/save/old/handlers/TimerHandler.java
+++ /dev/null
@@ -1,90 +0,0 @@
-package org.apache.jmeter.save.old.handlers;
-
-import java.io.Writer;
-
-import org.apache.jmeter.gui.JMeterComponentModel;
-import org.apache.jmeter.save.old.Saveable;
-import org.apache.jmeter.save.old.xml.TagHandler;
-import org.apache.jmeter.testelement.TestElement;
-import org.apache.jmeter.timers.Timer;
-import org.xml.sax.Attributes;
-
-/**
- * Title:
- * Description:
- * Copyright:    Copyright (c) 2001
- * Company:
- * @author
- * @version 1.0
- */
-
-public class TimerHandler extends TagHandler
-{
-	Timer timer;
-
-	public TimerHandler()
-	{
-	}
-
-	public void save(Saveable parm1, Writer out) throws java.io.IOException
-	{
-		Timer timer = (Timer)parm1;
-		out.write("<Timer type=\"");
-		out.write(JMeterHandler.convertToXML(timer.getClass().getName()));
-		out.write("\"");
-		if(timer instanceof JMeterComponentModel)
-		{
-			out.write(" name=\"");
-			out.write(JMeterHandler.convertToXML(((JMeterComponentModel)timer).getName()));
-			out.write("\"");
-		}
-		out.write(">\n");
-		out.write("<delay>");
-		out.write(Long.toString(timer.getDelay()));
-		out.write("</delay>\n");
-		out.write("<range>");
-		out.write(Double.toString(timer.getRange()));
-		out.write("</range>\n");
-		out.write("</Timer>\n");
-	}
-
-	public void setAtts(Attributes atts) throws java.lang.Exception
-	{
-		timer = (Timer)Class.forName(atts.getValue("type")).newInstance();
-		((TestElement)timer).setProperty(TestElement.GUI_CLASS,JMeterHandler.getGuiClass(atts.getValue("type")));
-		((TestElement)timer).setProperty(TestElement.NAME,atts.getValue("name"));
-	}
-
-	public void delay(String data)
-	{
-		try
-		{
-			timer.setDelay(Long.parseLong(data));
-		}
-		catch(NumberFormatException e)
-		{
-			timer.setDelay(0);
-		}
-	}
-
-	public void range(String data)
-	{
-		try
-		{
-			timer.setRange(Double.parseDouble(data));
-		}
-		catch(NumberFormatException e)
-		{
-			timer.setRange(0);
-		}
-	}
-
-	public String getPrimaryTagName()
-	{
-		return "Timer";
-	}
-	public Object getModel()
-	{
-		return timer;
-	}
-}
\ No newline at end of file
diff --git a/jakarta-jmeter/src/core/org/apache/jmeter/save/old/xml/CVS/Entries b/jakarta-jmeter/src/core/org/apache/jmeter/save/old/xml/CVS/Entries
deleted file mode 100644
index c2444f1..0000000
--- a/jakarta-jmeter/src/core/org/apache/jmeter/save/old/xml/CVS/Entries
+++ /dev/null
@@ -1,5 +0,0 @@
-/NameSpaceHandler.java/1.1/Sun Aug 11 19:24:48 2002//Tv1_7_3
-/NoCurrentHandlerException.java/1.1/Sun Aug 11 19:24:48 2002//Tv1_7_3
-/TagHandler.java/1.1/Sun Aug 11 19:24:48 2002//Tv1_7_3
-/XmlHandler.java/1.1/Sun Aug 11 19:24:48 2002//Tv1_7_3
-D
diff --git a/jakarta-jmeter/src/core/org/apache/jmeter/save/old/xml/CVS/Repository b/jakarta-jmeter/src/core/org/apache/jmeter/save/old/xml/CVS/Repository
deleted file mode 100644
index c32b16b..0000000
--- a/jakarta-jmeter/src/core/org/apache/jmeter/save/old/xml/CVS/Repository
+++ /dev/null
@@ -1 +0,0 @@
-jakarta-jmeter/src/core/org/apache/jmeter/save/old/xml
diff --git a/jakarta-jmeter/src/core/org/apache/jmeter/save/old/xml/CVS/Tag b/jakarta-jmeter/src/core/org/apache/jmeter/save/old/xml/CVS/Tag
deleted file mode 100644
index 5f312fe..0000000
--- a/jakarta-jmeter/src/core/org/apache/jmeter/save/old/xml/CVS/Tag
+++ /dev/null
@@ -1 +0,0 @@
-Nv1_7_3
diff --git a/jakarta-jmeter/src/core/org/apache/jmeter/save/old/xml/TagHandler.java b/jakarta-jmeter/src/core/org/apache/jmeter/save/old/xml/TagHandler.java
deleted file mode 100644
index 98afb3f..0000000
--- a/jakarta-jmeter/src/core/org/apache/jmeter/save/old/xml/TagHandler.java
+++ /dev/null
@@ -1,286 +0,0 @@
-/*
- * ====================================================================
- * The Apache Software License, Version 1.1
- *
- * Copyright (c) 2001 The Apache Software Foundation.  All rights
- * reserved.
- *
- * Redistribution and use in source and binary forms, with or without
- * modification, are permitted provided that the following conditions
- * are met:
- *
- * 1. Redistributions of source code must retain the above copyright
- * notice, this list of conditions and the following disclaimer.
- *
- * 2. Redistributions in binary form must reproduce the above copyright
- * notice, this list of conditions and the following disclaimer in
- * the documentation and/or other materials provided with the
- * distribution.
- *
- * 3. The end-user documentation included with the redistribution,
- * if any, must include the following acknowledgment:
- * "This product includes software developed by the
- * Apache Software Foundation (http://www.apache.org/)."
- * Alternately, this acknowledgment may appear in the software itself,
- * if and wherever such third-party acknowledgments normally appear.
- *
- * 4. The names "Apache" and "Apache Software Foundation" and
- * "Apache JMeter" must not be used to endorse or promote products
- * derived from this software without prior written permission. For
- * written permission, please contact apache@apache.org.
- *
- * 5. Products derived from this software may not be called "Apache",
- * "Apache JMeter", nor may "Apache" appear in their name, without
- * prior written permission of the Apache Software Foundation.
- *
- * THIS SOFTWARE IS PROVIDED ``AS IS'' AND ANY EXPRESSED OR IMPLIED
- * WARRANTIES, INCLUDING, BUT NOT LIMITED TO, THE IMPLIED WARRANTIES
- * OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE ARE
- * DISCLAIMED.  IN NO EVENT SHALL THE APACHE SOFTWARE FOUNDATION OR
- * ITS CONTRIBUTORS BE LIABLE FOR ANY DIRECT, INDIRECT, INCIDENTAL,
- * SPECIAL, EXEMPLARY, OR CONSEQUENTIAL DAMAGES (INCLUDING, BUT NOT
- * LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES; LOSS OF
- * USE, DATA, OR PROFITS; OR BUSINESS INTERRUPTION) HOWEVER CAUSED AND
- * ON ANY THEORY OF LIABILITY, WHETHER IN CONTRACT, STRICT LIABILITY,
- * OR TORT (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT
- * OF THE USE OF THIS SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF
- * SUCH DAMAGE.
- * ====================================================================
- *
- * This software consists of voluntary contributions made by many
- * individuals on behalf of the Apache Software Foundation.  For more
- * information on the Apache Software Foundation, please see
- * <http://www.apache.org/>.
- */
- package org.apache.jmeter.save.old.xml;
-
-import java.util.*;
-import java.lang.reflect.*;
-import java.io.*;
-
-import org.xml.sax.Attributes;
-
-import org.apache.jmeter.save.old.SaveHandler;
-
-/**
- * Title:
- * Description:
- * Copyright:    Copyright (c) 2000
- * Company:
- * @author
- * @version 1.0
- */
-
-public abstract class TagHandler implements SaveHandler
-{
-	private LinkedList tagsIn = new LinkedList();
-	private boolean done = false;
-	protected String tagName;
-	protected XmlHandler xmlParent;
-
-	private StringBuffer dataStore;
-
-
-	public abstract void setAtts(Attributes atts) throws Exception;
-
-	public void setXmlParent(XmlHandler xml)
-	{
-		xmlParent = xml;
-	}
-
-	public void startSave(Writer out) throws IOException
-	{
-		out.write("<?xml version=\"1.0\" encoding=\"UTF-8\"?>\n\n");
-	}
-
-	/************************************************************
-	 *  Indicates whether this tag has been completely parsed
-	 *
-	 *@return    True or false whether this tag is done being parsed
-	 ***********************************************************/
-	public boolean isDone()
-	{
-		return done;
-	}
-
-	protected void setDone(boolean done)
-	{
-		this.done = done;
-	}
-
-	public void unknownTagStart(String name,Attributes atts)
-	{
-	}
-
-	public void unknownTagEnd(String name)
-	{
-	}
-
-	public void setData(String data)
-	{
-	}
-
-	public String getTagName()
-	{
-		return tagName;
-	}
-
-	public void setTagName(String tagName)
-	{
-		this.tagName = tagName;
-	}
-
-	public abstract Object getModel();
-
-	/************************************************************
-	 *  Handles character data passed to this class
-	 *
-	 *@param  data  The data within the XML tag to be handled
-	 ***********************************************************/
-	public void handleData(String data)
-	{
-		this.callTagCombo(data);
-	}
-
-	protected void startTag(String tag)
-	{
-		if(!tagName.equals(tag))
-			tagsIn.addLast(tag);
-	}
-
-	protected void endTag(String tag)
-	{
-		if(tagName.equals(tag))
-		{
-			setDone(true);
-		}
-		else
-		{
-			tagsIn.removeLast();
-		}
-	}
-
-	protected String getMethodName()
-	{
-		StringBuffer methodName = new StringBuffer();
-		boolean first = true;
-		for (Iterator it = tagsIn.iterator(); it.hasNext(); )
-		{
-			if (!first)
-			{
-				methodName.append("_");
-			}
-			else
-			{
-				first = false;
-			}
-			methodName.append(it.next());
-		}
-		return methodName.toString();
-	}
-
-	protected void callTagCombo(Attributes atts)
-	{
-		try
-		{
-			Method method = this.getClass().getMethod(getMethodName(), new Class[]{Attributes.class});
-			method.invoke(this, new Object[]{atts});
-		}
-		catch(NoSuchMethodException e)
-		{
-		}
-		catch (Exception e)
-		{
-			e.printStackTrace();
-		}
-	}
-
-	protected void callTagCombo(String data)
-	{
-		if(dataStore == null)
-		{
-			dataStore = new StringBuffer();
-		}
-		dataStore.append(data);
-	}
-
-	private void releaseData()
-	{
-		if(dataStore != null)
-		{
-			try
-			{
-				if(getMethodName().equals(""))
-				{
-					setData(dataStore.toString());
-				}
-				else
-				{
-					Method method = this.getClass().getMethod(getMethodName(), new Class[]{String.class});
-					method.invoke(this, new Object[]{dataStore.toString()});
-				}
-			}
-			catch(NoSuchMethodException e)
-			{
-			}
-			catch (Exception ex)
-			{
-				ex.printStackTrace();
-			}
-		}
-		dataStore = null;
-	}
-
-	protected void passToHandler(String localName, Attributes atts)
-	{
-		releaseData();
-		try
-		{
-			Class handler = this.getClass();
-			startTag(localName);
-			Method method = handler.getMethod(localName + "TagStart", new Class[]{Attributes.class});
-			method.invoke(this, new Object[]{atts});
-		}
-		catch (NoSuchMethodException e)
-		{
-			unknownTagStart(localName,atts);
-		}
-		catch(InvocationTargetException e)
-		{
-			e.printStackTrace();
-		}
-		catch(IllegalAccessException e)
-		{
-			e.printStackTrace();
-		}
-		callTagCombo(atts);
-	}
-
-	protected void passToHandler(String localName)
-	{
-		releaseData();
-		try
-		{
-			Class handler = this.getClass();
-			endTag(localName);
-			Method method = handler.getMethod(localName + "TagEnd", new Class[0]);
-			method.invoke(this, new Object[0]);
-		}
-		catch (NoSuchMethodException e)
-		{
-			unknownTagEnd(localName);
-		}
-		catch(InvocationTargetException e)
-		{
-			e.printStackTrace();
-		}
-		catch(IllegalAccessException e)
-		{
-			e.printStackTrace();
-		}
-	}
-
-	public void notifySubElementEnded(Object childObj)
-	{
-	}
-}
\ No newline at end of file
diff --git a/jakarta-jmeter/src/core/org/apache/jmeter/save/old/xml/XmlHandler.java b/jakarta-jmeter/src/core/org/apache/jmeter/save/old/xml/XmlHandler.java
deleted file mode 100644
index ccd3ea7..0000000
--- a/jakarta-jmeter/src/core/org/apache/jmeter/save/old/xml/XmlHandler.java
+++ /dev/null
@@ -1,367 +0,0 @@
-/*
- * ====================================================================
- * The Apache Software License, Version 1.1
- *
- * Copyright (c) 2001 The Apache Software Foundation.  All rights
- * reserved.
- *
- * Redistribution and use in source and binary forms, with or without
- * modification, are permitted provided that the following conditions
- * are met:
- *
- * 1. Redistributions of source code must retain the above copyright
- * notice, this list of conditions and the following disclaimer.
- *
- * 2. Redistributions in binary form must reproduce the above copyright
- * notice, this list of conditions and the following disclaimer in
- * the documentation and/or other materials provided with the
- * distribution.
- *
- * 3. The end-user documentation included with the redistribution,
- * if any, must include the following acknowledgment:
- * "This product includes software developed by the
- * Apache Software Foundation (http://www.apache.org/)."
- * Alternately, this acknowledgment may appear in the software itself,
- * if and wherever such third-party acknowledgments normally appear.
- *
- * 4. The names "Apache" and "Apache Software Foundation" and
- * "Apache JMeter" must not be used to endorse or promote products
- * derived from this software without prior written permission. For
- * written permission, please contact apache@apache.org.
- *
- * 5. Products derived from this software may not be called "Apache",
- * "Apache JMeter", nor may "Apache" appear in their name, without
- * prior written permission of the Apache Software Foundation.
- *
- * THIS SOFTWARE IS PROVIDED ``AS IS'' AND ANY EXPRESSED OR IMPLIED
- * WARRANTIES, INCLUDING, BUT NOT LIMITED TO, THE IMPLIED WARRANTIES
- * OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE ARE
- * DISCLAIMED.  IN NO EVENT SHALL THE APACHE SOFTWARE FOUNDATION OR
- * ITS CONTRIBUTORS BE LIABLE FOR ANY DIRECT, INDIRECT, INCIDENTAL,
- * SPECIAL, EXEMPLARY, OR CONSEQUENTIAL DAMAGES (INCLUDING, BUT NOT
- * LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES; LOSS OF
- * USE, DATA, OR PROFITS; OR BUSINESS INTERRUPTION) HOWEVER CAUSED AND
- * ON ANY THEORY OF LIABILITY, WHETHER IN CONTRACT, STRICT LIABILITY,
- * OR TORT (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT
- * OF THE USE OF THIS SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF
- * SUCH DAMAGE.
- * ====================================================================
- *
- * This software consists of voluntary contributions made by many
- * individuals on behalf of the Apache Software Foundation.  For more
- * information on the Apache Software Foundation, please see
- * <http://www.apache.org/>.
- */
-package org.apache.jmeter.save.old.xml;
-
-import org.xml.sax.helpers.DefaultHandler;
-import org.xml.sax.SAXException;
-import org.xml.sax.Attributes;
-import org.xml.sax.InputSource;
-import org.xml.sax.SAXParseException;
-import org.apache.xerces.parsers.SAXParser;
-import java.util.*;
-import java.lang.reflect.*;
-
-import org.apache.jmeter.util.*;
-
-/************************************************************
- *  Title: Description: Copyright: Copyright (c) 2000 Company:
- *
- *@author
- *@created    $Date: 2002/08/11 19:24:48 $
- *@version    1.0
- ***********************************************************/
-
-public class XmlHandler extends DefaultHandler
-{
-	protected LinkedList objectStack;
-
-	NameSpaceHandler informer;
-	List finalHandlers;
-	ListedHashTree objectHierarchy = new ListedHashTree();
-	boolean replaced = false;
-
-	/************************************************************
-	 *  !ToDo (Constructor description)
-	 *
-	 *@param  informer  !ToDo (Parameter description)
-	 ***********************************************************/
-	public XmlHandler(NameSpaceHandler informer)
-	{
-		this.informer = informer;
-		objectStack = new LinkedList();
-		finalHandlers = new LinkedList();
-	}
-
-	/************************************************************
-	 *  !ToDoo (Method description)
-	 *
-	 *@return    !ToDo (Return description)
-	 ***********************************************************/
-	public ListedHashTree getDataTree()
-	{
-		if (!replaced)
-		{
-			replaceWithModels(objectHierarchy);
-		}
-		replaced = true;
-		return objectHierarchy;
-	}
-
-	/************************************************************
-	 *  HandlerBase implementation This reports an error that has occured. This
-	 *  indicates that a rule was broken in validation, but that parsing can
-	 *  continue.
-	 *
-	 *@param  e                 !ToDo (Parameter description)
-	 *@exception  SAXException  !ToDo (Exception description)
-	 ***********************************************************/
-	public void fatalError(SAXParseException e) throws SAXException
-	{
-		System.out.println("***Parsing Fatal Error**\n" +
-				" Line:   " + e.getLineNumber() + "\n" +
-				" URI:    " + e.getSystemId() + "\n" +
-				" Message: " + e.getMessage());
-		throw new SAXException("Fatal Error encountered");
-	}
-
-	/************************************************************
-	 *  HandlerBase implementation This reports a fatal error that has occured.
-	 *  This indicates that a rule was broken that makes continued parsing
-	 *  impossible.
-	 *
-	 *@param  errs              parse error message
-	 *@exception  SAXException  !ToDo (Exception description)
-	 ***********************************************************/
-	public void error(SAXParseException errs) throws SAXException
-	{
-		System.out.println("***Parsing Error**\n" +
-				" Line:   " + errs.getLineNumber() + "\n" +
-				" URI:    " + errs.getSystemId() + "\n" +
-				" Message: " + errs.getMessage());
-		throw new SAXException("Error encountered");
-	}
-
-	/************************************************************
-	 *  HandlerBase implementation This reports a warning that has occured; this
-	 *  indicates that while no XML rules were broken, something appears to be
-	 *  incorrect or missing.
-	 *
-	 *@param  err               parse warning message
-	 *@exception  SAXException  !ToDo (Exception description)
-	 ***********************************************************/
-	public void warning(SAXParseException err) throws SAXException
-	{
-		System.out.println("***Parsing Warning**\n" +
-				" Line:   " + err.getLineNumber() + "\n" +
-				" URI:    " + err.getSystemId() + "\n" +
-				" Message: " + err.getMessage());
-		throw new SAXException("Warning encountered");
-	}
-
-	/************************************************************
-	 *  !ToDo (Method description)
-	 *
-	 *@param  chardata          !ToDo (Parameter description)
-	 *@param  start             !ToDo (Parameter description)
-	 *@param  end               !ToDo (Parameter description)
-	 *@exception  SAXException  !ToDo (Exception description)
-	 ***********************************************************/
-	public void characters(char[] chardata, int start, int end) throws SAXException
-	{
-		try
-		{
-			if(start >= 0 && start < chardata.length && (end + start) <= chardata.length)
-			{
-				getCurrentHandler().handleData(new String(chardata, start, end));
-			}
-		}
-		catch (Exception e)
-		{
-			e.printStackTrace();
-		}
-	}
-
-	/************************************************************
-	 *  !ToDo (Method description)
-	 *
-	 *@param  uri        !ToDo (Parameter description)
-	 *@param  localName  !ToDo (Parameter description)
-	 *@param  qName      !ToDo (Parameter description)
-	 *@param  atts       !ToDo (Parameter description)
-	 ***********************************************************/
-	public void startElement(String uri, String localName, String qName, Attributes atts)
-	{
-		//documentElement(localName+":"+qName, atts);
-		TagHandler newXmlObject = informer.getXmlObject(qName, atts);
-		if (newXmlObject == null)
-		{
-			try
-			{
-				getCurrentHandler().passToHandler(qName, atts);
-			}
-			catch (Exception ex)
-			{
-				System.out.println("No current Handler for " + qName);
-			}
-		}
-		else
-		{
-			newXmlObject.setXmlParent(this);
-			objectHierarchy.add(objectStack, newXmlObject);
-			objectStack.addLast(newXmlObject);
-			try
-			{
-				getCurrentHandler().passToHandler(qName, atts);
-			}
-			catch (Exception ex)
-			{
-				System.out.println("(2)No current Handler for " + qName);
-			}
-		}
-	}
-
-	/************************************************************
-	 *  HandlerBase implementation
-	 *
-	 *@param  uri               !ToDo (Parameter description)
-	 *@param  localName         !ToDo (Parameter description)
-	 *@param  qName             !ToDo (Parameter description)
-	 *@exception  SAXException  !ToDo (Exception description)
-	 ***********************************************************/
-	public void endElement(java.lang.String uri, java.lang.String localName,
-			java.lang.String qName) throws SAXException
-	{
-		try
-		{
-			getCurrentHandler().passToHandler(qName);
-		}
-		catch (Exception ex)
-		{
-			//ex.printStackTrace();
-		}
-		if (currentHandlerIsDone())
-		{
-			TagHandler currentHandler = (TagHandler)objectStack.removeLast();
-			try
-			{
-				TagHandler previousHandler = (TagHandler)objectStack.getLast();
-				previousHandler.notifySubElementEnded(currentHandler.getModel());
-			}
-			catch(Exception e)
-			{
-			}
-		}
-	}
-
-	/************************************************************
-	 *  !ToDo (Method description)
-	 *
-	 *@param  handler  !ToDo (Parameter description)
-	 *@return          !ToDo (Return description)
-	 ***********************************************************/
-	public List takeChildObjects(TagHandler handler)
-	{
-		List stack = new LinkedList();
-		Iterator iter = objectStack.iterator();
-		while (iter.hasNext())
-		{
-			Object item = iter.next();
-			stack.add(item);
-			if (item.equals(handler))
-			{
-				break;
-			}
-		}
-		ListedHashTree subTree = objectHierarchy.get(stack);
-		if (subTree == null)
-		{
-			return new LinkedList();
-		}
-		List items = new LinkedList(subTree.list());
-		iter = items.iterator();
-		while (iter.hasNext())
-		{
-			Object item = iter.next();
-			replaceSubItems(subTree, item);
-			subTree.remove(item);
-		}
-		return items;
-	}
-
-
-	/************************************************************
-	 *  !ToDoo (Method description)
-	 *
-	 *@param  tagName  !ToDo (Parameter description)
-	 *@param  atts     !ToDo (Parameter description)
-	 *@return          !ToDo (Return description)
-	 ***********************************************************/
-	protected TagHandler getXmlObject(String tagName, Attributes atts)
-	{
-		return informer.getXmlObject(tagName, atts);
-	}
-
-	/************************************************************
-	 *  !ToDoo (Method description)
-	 *
-	 *@return                                !ToDo (Return description)
-	 *@exception  NoCurrentHandlerException  !ToDo (Exception description)
-	 ***********************************************************/
-	protected TagHandler getCurrentHandler() throws NoCurrentHandlerException
-	{
-		if (objectStack.size() == 0)
-		{
-			throw new NoCurrentHandlerException();
-		}
-		else
-		{
-			return (TagHandler)objectStack.getLast();
-		}
-	}
-
-	private void replaceWithModels(ListedHashTree tree)
-	{
-		Iterator iter = new LinkedList(tree.list()).iterator();
-		while (iter.hasNext())
-		{
-			TagHandler item = (TagHandler)iter.next();
-			tree.replace(item,item.getModel());
-			replaceWithModels(tree.get(item.getModel()));
-		}
-	}
-
-	private boolean currentHandlerIsDone()
-	{
-		try
-		{
-			return getCurrentHandler().isDone();
-		}
-		catch (NoCurrentHandlerException e)
-		{
-			return false;
-		}
-	}
-
-	private void documentElement(String name, Attributes atts)
-	{
-		System.out.println("startElement= " + name);
-		for (int i = 0; i < atts.getLength(); i++)
-		{
-			System.out.println(" Attribute= " + atts.getQName(i) + "=" + atts.getValue(i));
-		}
-	}
-
-	private void replaceSubItems(ListedHashTree subTree, Object item)
-	{
-		ListedHashTree subSubTree = subTree.get(item);
-		List subItems = subSubTree.list();
-		Iterator iter2 = subItems.iterator();
-		while (iter2.hasNext())
-		{
-			Object subItem = iter2.next();
-			subTree.set(subItem, subSubTree.get(subItem));
-		}
-	}
-}
diff --git a/jakarta-jmeter/src/core/org/apache/jmeter/swing/CVS/Entries b/jakarta-jmeter/src/core/org/apache/jmeter/swing/CVS/Entries
new file mode 100644
index 0000000..7c01c99
--- /dev/null
+++ b/jakarta-jmeter/src/core/org/apache/jmeter/swing/CVS/Entries
@@ -0,0 +1,2 @@
+/HtmlPane.java/1.1/Sat Sep  7 16:54:34 2002//Tv1_8_1
+D
diff --git a/jakarta-jmeter/src/core/org/apache/jmeter/swing/CVS/Repository b/jakarta-jmeter/src/core/org/apache/jmeter/swing/CVS/Repository
new file mode 100644
index 0000000..32121db
--- /dev/null
+++ b/jakarta-jmeter/src/core/org/apache/jmeter/swing/CVS/Repository
@@ -0,0 +1 @@
+jakarta-jmeter/src/core/org/apache/jmeter/swing
diff --git a/jakarta-jmeter/src/core/org/apache/jmeter/save/old/handlers/CVS/Root b/jakarta-jmeter/src/core/org/apache/jmeter/swing/CVS/Root
similarity index 100%
rename from jakarta-jmeter/src/core/org/apache/jmeter/save/old/handlers/CVS/Root
rename to jakarta-jmeter/src/core/org/apache/jmeter/swing/CVS/Root
diff --git a/jakarta-jmeter/src/core/org/apache/jmeter/swing/CVS/Tag b/jakarta-jmeter/src/core/org/apache/jmeter/swing/CVS/Tag
new file mode 100644
index 0000000..e2fda28
--- /dev/null
+++ b/jakarta-jmeter/src/core/org/apache/jmeter/swing/CVS/Tag
@@ -0,0 +1 @@
+Nv1_8_1
diff --git a/jakarta-jmeter/src/core/org/apache/jmeter/swing/HtmlPane.java b/jakarta-jmeter/src/core/org/apache/jmeter/swing/HtmlPane.java
new file mode 100644
index 0000000..2e6b788
--- /dev/null
+++ b/jakarta-jmeter/src/core/org/apache/jmeter/swing/HtmlPane.java
@@ -0,0 +1,16 @@
+package org.apache.jmeter.swing;
+import javax.swing.JTextPane;
+/**
+ * @author Administrator
+ *
+ * To change this generated comment edit the template variable "typecomment":
+ * Window>Preferences>Java>Templates.
+ */
+public class HtmlPane extends JTextPane
+{
+	
+	public void scrollToReference(String reference)
+	{
+		super.scrollToReference(reference);
+	}
+}
diff --git a/jakarta-jmeter/src/core/org/apache/jmeter/testelement/AbstractTestElement.java b/jakarta-jmeter/src/core/org/apache/jmeter/testelement/AbstractTestElement.java
index 1cb9f4c..c2c9d28 100644
--- a/jakarta-jmeter/src/core/org/apache/jmeter/testelement/AbstractTestElement.java
+++ b/jakarta-jmeter/src/core/org/apache/jmeter/testelement/AbstractTestElement.java
@@ -2,346 +2,376 @@ package org.apache.jmeter.testelement;
 import java.io.Serializable;
 import java.util.Collection;
 import java.util.HashMap;
+import java.util.Collections;
 import java.util.Iterator;
 import java.util.Map;
 
-import org.apache.jmeter.protocol.http.util.HTTPArgument;
+import org.apache.log.Hierarchy;
+import org.apache.log.Logger;
 
 /****************************************
  * Title: JMeter Description: Copyright: Copyright (c) 2000 Company: Apache
  *
  *@author    Michael Stover
- *@created   $Date: 2002/08/11 19:24:48 $
+ *@created   $Date: 2003/01/21 22:12:51 $
  *@version   1.0
  ***************************************/
 
 public abstract class AbstractTestElement implements TestElement,Serializable
 {
-	private Map testInfo = new HashMap();
+    private Map testInfo = Collections.synchronizedMap(new HashMap());
+    transient private static Logger log =
+            Hierarchy.getDefaultHierarchy().getLoggerFor("jmeter.elements");
 
+    /****************************************
+     * !ToDo (Method description)
+     *
+     *@return   !ToDo (Return description)
+     ***************************************/
+    public Object clone()
+    {
+        try
+        {
+            TestElement newObject = (TestElement)this.getClass().newInstance();
+            configureClone(newObject);
+            return newObject;
+        }
+        catch(Exception e)
+        {
+            log.error("",e);
+        }
+        return null;
+    }
 
-	/****************************************
-	 * !ToDo (Method description)
-	 *
-	 *@return   !ToDo (Return description)
-	 ***************************************/
-	public Object clone()
-	{
-		try
-		{
-			TestElement newObject = (TestElement)this.getClass().newInstance();
-			configureClone(newObject);
-			return newObject;
-		}
-		catch(Exception e)
-		{
-			e.printStackTrace();
-		}
-		return null;
-	}
+    public void removeProperty(String key)
+    {
+        testInfo.remove(key);
+    }
 
-	public void removeProperty(String key)
-	{
-		testInfo.remove(key);
-	}
+    public boolean equals(Object o)
+    {
+        if(o instanceof AbstractTestElement)
+        {
+            return ((AbstractTestElement)o).testInfo.equals(testInfo);
+        }
+        else
+        {
+            return false;
+        }
+    }
 
-	public boolean equals(Object o)
-	{
-		if(o instanceof AbstractTestElement)
-		{
-			return ((AbstractTestElement)o).testInfo.equals(testInfo);
-		}
-		else
-		{
-			return false;
-		}
-	}
+    /****************************************
+     * !ToDo
+     *
+     *@param el  !ToDo
+     ***************************************/
+    public void addTestElement(TestElement el)
+    {
+        if(el.getClass().equals(this.getClass()))
+        {
+            mergeIn(el);
+        }
+    }
 
-	/****************************************
-	 * !ToDo
-	 *
-	 *@param el  !ToDo
-	 ***************************************/
-	public void addTestElement(TestElement el)
-	{
-		if(el.getClass().equals(this.getClass()))
-		{
-			mergeIn(el);
-		}
-	}
+    /****************************************
+     * !ToDo (Method description)
+     *
+     *@param name  !ToDo (Parameter description)
+     ***************************************/
+    public void setName(String name)
+    {
+        setProperty(TestElement.NAME, name);
+    }
 
-	/****************************************
-	 * !ToDo (Method description)
-	 *
-	 *@param name  !ToDo (Parameter description)
-	 ***************************************/
-	public void setName(String name)
-	{
-		setProperty(TestElement.NAME, name);
-	}
+    /****************************************
+     * !ToDoo (Method description)
+     *
+     *@return   !ToDo (Return description)
+     ***************************************/
+    public String getName()
+    {
+        return (String)getProperty(TestElement.NAME);
+    }
 
-	/****************************************
-	 * !ToDoo (Method description)
-	 *
-	 *@return   !ToDo (Return description)
-	 ***************************************/
-	public String getName()
-	{
-		return (String)getProperty(TestElement.NAME);
-	}
+    /****************************************
+     * !ToDo (Method description)
+     *
+     *@param key   !ToDo (Parameter description)
+     *@param prop  !ToDo (Parameter description)
+     ***************************************/
+    public void setProperty(String key, Object prop)
+    {
+        testInfo.put(key, prop);
+    }
 
-	/****************************************
-	 * !ToDo (Method description)
-	 *
-	 *@param key   !ToDo (Parameter description)
-	 *@param prop  !ToDo (Parameter description)
-	 ***************************************/
-	public void setProperty(String key, Object prop)
-	{
-		testInfo.put(key, prop);
-	}
+    /****************************************
+     * !ToDoo (Method description)
+     *
+     *@param key  !ToDo (Parameter description)
+     *@return     !ToDo (Return description)
+     ***************************************/
+    public Object getProperty(String key)
+    {
+        return testInfo.get(key);
+    }
 
-	/****************************************
-	 * !ToDoo (Method description)
-	 *
-	 *@param key  !ToDo (Parameter description)
-	 *@return     !ToDo (Return description)
-	 ***************************************/
-	public Object getProperty(String key)
-	{
-		return testInfo.get(key);
-	}
+    /****************************************
+     * !ToDoo (Method description)
+     *
+     *@return   !ToDo (Return description)
+     ***************************************/
+    public Collection getPropertyNames()
+    {
+        return testInfo.keySet();
+    }
 
-	/****************************************
-	 * !ToDoo (Method description)
-	 *
-	 *@return   !ToDo (Return description)
-	 ***************************************/
-	public Collection getPropertyNames()
-	{
-		return testInfo.keySet();
-	}
+    /****************************************
+     * !ToDo (Method description)
+     *
+     *@param newObject  !ToDo (Parameter description)
+     ***************************************/
+    protected void configureClone(TestElement newObject)
+    {
+        Iterator iter = getPropertyNames().iterator();
+        while(iter.hasNext())
+        {
+            String key = (String)iter.next();
+            Object value = getProperty(key);
+            if(value instanceof TestElement)
+            {
+                newObject.setProperty(key, ((TestElement)value).clone());
+            }
+            else if(value instanceof Collection)
+            {
+                try
+                {
+                    newObject.setProperty(key,cloneCollection(value));
+                }
+                catch(Exception e)
+                {
+                    log.error("",e);
+                }
+            }
+            else
+            {
+                newObject.setProperty(key, value);
+            }
+        }
+    }
 
-	/****************************************
-	 * !ToDo (Method description)
-	 *
-	 *@param newObject  !ToDo (Parameter description)
-	 ***************************************/
-	protected void configureClone(TestElement newObject)
-	{
-		Iterator iter = getPropertyNames().iterator();
-		while(iter.hasNext())
-		{
-			String key = (String)iter.next();
-			Object value = getProperty(key);
-			if(value instanceof TestElement)
-			{
-				newObject.setProperty(key, ((TestElement)value).clone());
-			}
-			else if(value instanceof Collection)
-			{
-				try {
-					newObject.setProperty(key,cloneCollection(value));
-				} catch(Exception e) {
-					e.printStackTrace();
-				}
-			}
-			else
-			{
-				newObject.setProperty(key, value);
-			}
-		}
-	}
+    protected Collection cloneCollection(Object value)
+            throws InstantiationException,
+                   IllegalAccessException,
+                   ClassNotFoundException
+    {
+        Iterator collIter = ((Collection)value).iterator();
+        Collection newColl = (Collection)value.getClass().newInstance();
+        while(collIter.hasNext())
+        {
+            Object val = collIter.next();
+            if(val instanceof TestElement)
+            {
+                val = ((TestElement)val).clone();
+            }
+            else if(val instanceof Collection)
+            {
+                try
+                {
+                    val = cloneCollection(val);
+                }
+                catch(Exception e)
+                {
+                    continue;
+                }
+            }
+            newColl.add(val);
+        }
+        return newColl;
+    }
 
-	protected Collection cloneCollection(Object value) throws InstantiationException,
-			IllegalAccessException,ClassNotFoundException
-	{
-		Iterator collIter = ((Collection)value).iterator();
-		Collection newColl = (Collection)value.getClass().newInstance();
-		while(collIter.hasNext())
-		{
-			Object val = collIter.next();
-			if(val instanceof TestElement)
-			{
-				val = ((TestElement)val).clone();
-			}
-			else if(val instanceof Collection)
-			{
-				try {
-					val = cloneCollection(val);
-				} catch(Exception e) {
-					continue;
-				}
-			}
-			newColl.add(val);
-		}
-		return newColl;
-	}
+    private long getLongValue(Object bound)
+    {
+        if (bound == null)
+        {
+            return (long)0;
+        }
+        else if (bound instanceof Long)
+        {
+            return ((Long) bound).longValue();
+        }
+        else
+        {
+            return Long.parseLong((String) bound);
+        }
+    }
 
-	private long getLongValue(Object bound)
-	{
-		if (bound == null)
-		{
-			return (long)0;
-		} else if (bound instanceof Long)
-		{
-			return ((Long) bound).longValue();
-		} else
-		{
-			return Long.parseLong((String) bound);
-		}
-	}
+    private float getFloatValue(Object bound)
+    {
+        if (bound == null)
+        {
+                return (float)0;
+        }
+        else if (bound instanceof Float)
+        {
+            return ((Float) bound).floatValue();
+        }
+        else
+        {
+            return Float.parseFloat((String) bound);
+        }
+    }
 
-	private float getFloatValue(Object bound)
-	{
-		if (bound == null)
-		{
-			return (float)0;
-		} else if (bound instanceof Float)
-		{
-			return ((Float) bound).floatValue();
-		} else
-		{
-			return Float.parseFloat((String) bound);
-		}
-	}
+    private double getDoubleValue(Object bound)
+    {
+        if (bound == null)
+        {
+            return (double)0;
+        }
+        else if (bound instanceof Double)
+        {
+            return ((Double) bound).doubleValue();
+        }
+        else
+        {
+            return Double.parseDouble((String) bound);
+        }
+    }
 
-	private double getDoubleValue(Object bound)
-	{
-		if (bound == null)
-		{
-			return (double)0;
-		} else if (bound instanceof Double)
-		{
-			return ((Double) bound).doubleValue();
-		} else
-		{
-			return Double.parseDouble((String) bound);
-		}
-	}
+    private String getStringValue(Object bound)
+    {
+        if (bound == null)
+        {
+            return "";
+        }
+        else {
+            return bound.toString();
+        }
+    }
 
-	private String getStringValue(Object bound)
-	{
-		if (bound == null)
-		{
-			return "";
-		} else return bound.toString();
-	}
+    private int getIntValue(Object bound)
+    {
+        if (bound == null)
+        {
+            return (int)0;
+        }
+        else if (bound instanceof Integer)
+        {
+            return ((Integer) bound).intValue();
+        }
+        else
+        {
+            try
+            {
+                return Integer.parseInt((String) bound);
+            }
+            catch(NumberFormatException e)
+            {
+                return 0;
+            }
+        }
+    }
 
-	private int getIntValue(Object bound)
-	{
-		if (bound == null)
-		{
-			return (int)0;
-		} else if (bound instanceof Integer)
-		{
-			return ((Integer) bound).intValue();
-		} else
-		{
-			try
-			{
-				return Integer.parseInt((String) bound);
-			}
-			catch(NumberFormatException e)
-			{
-				return 0;
-			}
-		}
-	}
+    private boolean getBooleanValue(Object bound)
+    {
+        if (bound == null)
+        {
+            return false;
+        }
+        else if (bound instanceof Boolean)
+        {
+            return ((Boolean) bound).booleanValue();
+        }
+        else
+        {
+            return new Boolean((String) bound).booleanValue();
+        }
+    }
 
-	private boolean getBooleanValue(Object bound)
-	{
-		if (bound == null)
-		{
-			return false;
-		} else if (bound instanceof Boolean)
-		{
-			return ((Boolean) bound).booleanValue();
-		}
-		else
-		{
-			return new Boolean((String) bound).booleanValue();
-		}
-	}
+    public int getPropertyAsInt(String key)
+    {
+        return getIntValue(getProperty(key));
+    }
 
-	public int getPropertyAsInt(String key)
-	{
-		return getIntValue(getProperty(key));
-	}
+    public boolean getPropertyAsBoolean(String key)
+    {
+        return getBooleanValue(getProperty(key));
+    }
 
-	public boolean getPropertyAsBoolean(String key)
-	{
-		return getBooleanValue(getProperty(key));
-	}
+    public float getPropertyAsFloat(String key)
+    {
+        return getFloatValue(getProperty(key));
+    }
 
-	public float getPropertyAsFloat(String key)
-	{
-		return getFloatValue(getProperty(key));
-	}
+    public long getPropertyAsLong(String key)
+    {
+        return getLongValue(getProperty(key));
+    }
 
-	public long getPropertyAsLong(String key)
-	{
-		return getLongValue(getProperty(key));
-	}
+    public double getPropertyAsDouble(String key)
+    {
+        return getDoubleValue(getProperty(key));
+    }
 
-	public double getPropertyAsDouble(String key)
-	{
-		return getDoubleValue(getProperty(key));
-	}
+    public String getPropertyAsString(String key)
+    {
+        return getStringValue(getProperty(key));
+    }
 
-	public String getPropertyAsString(String key)
-	{
-		return getStringValue(getProperty(key));
-	}
-
-	/****************************************
-	 * !ToDo (Method description)
-	 *
-	 *@param element  !ToDo (Parameter description)
-	 ***************************************/
-	protected void mergeIn(TestElement element)
-	{
-		Iterator iter = element.getPropertyNames().iterator();
-		while(iter.hasNext())
-		{
-			String key = (String)iter.next();
-			Object value = element.getProperty(key);
-			if(getProperty(key) == null || getProperty(key).equals(""))
-			{
-				setProperty(key, value);
-				continue;
-			}
-			if(value instanceof TestElement)
-			{
-				if(getProperty(key) == null)
-				{
-					setProperty(key,value);
-				}
-				else if(getProperty(key) instanceof TestElement)
-				{
-					((TestElement)getProperty(key)).addTestElement((TestElement)value);
-				}
-			}
-			else if(value instanceof Collection)
-			{
-				Iterator iter2 = ((Collection)value).iterator();
-				Collection localCollection = (Collection)getProperty(key);
-				if(localCollection == null)
-				{
-					setProperty(key,value);
-				}
-				else
-				{
-					while(iter2.hasNext())
-					{
-						Object item = iter2.next();
-						if(!localCollection.contains(item))
-						{
-							localCollection.add(item);
-						}
-					}
-				}
-			}
-		}
-	}
+    /****************************************
+     * !ToDo (Method description)
+     *
+     *@param element  !ToDo (Parameter description)
+     ***************************************/
+    protected void mergeIn(TestElement element)
+    {
+        Iterator iter = element.getPropertyNames().iterator();
+        while(iter.hasNext())
+        {
+            String key = (String)iter.next();
+            Object value = element.getProperty(key);
+            if(getProperty(key) == null || getProperty(key).equals(""))
+            {
+                setProperty(key, value);
+                continue;
+            }
+            if(value instanceof TestElement)
+            {
+                if(getProperty(key) == null)
+                {
+                    setProperty(key,value);
+                }
+                else if(getProperty(key) instanceof TestElement)
+                {
+                    ((TestElement)getProperty(key)).addTestElement((TestElement)value);
+                }
+            }
+            else if(value instanceof Collection)
+            {
+                Collection localCollection = (Collection)getProperty(key);
+                if(localCollection == null)
+                {
+                    setProperty(key,value);
+                }
+                else
+                {
+                    // Remove any repeated elements:
+                    Iterator iter2 = ((Collection)value).iterator();
+                    while(iter2.hasNext())
+                    {
+                        Object item = iter2.next();
+                        if(!localCollection.contains(item))
+                        {
+                            localCollection.remove(item);
+                        }
+                    }
+                    // Add all elements now:
+                    iter2 = ((Collection)value).iterator();
+                    while(iter2.hasNext())
+                    {
+                        localCollection.add(iter2.next());
+                    }
+                }
+            }
+        }
+    }
 }
diff --git a/jakarta-jmeter/src/core/org/apache/jmeter/testelement/CVS/Entries b/jakarta-jmeter/src/core/org/apache/jmeter/testelement/CVS/Entries
index 5b6c2ff..a2a6b4d 100644
--- a/jakarta-jmeter/src/core/org/apache/jmeter/testelement/CVS/Entries
+++ b/jakarta-jmeter/src/core/org/apache/jmeter/testelement/CVS/Entries
@@ -1,8 +1,10 @@
-/AbstractTestElement.java/1.1/Sun Aug 11 19:24:48 2002//Tv1_7_3
-/PerSampleClonable.java/1.1/Sun Aug 11 19:24:48 2002//Tv1_7_3
-/PerThreadClonable.java/1.1/Sun Aug 11 19:24:48 2002//Tv1_7_3
-/TestElement.java/1.1/Sun Aug 11 19:24:48 2002//Tv1_7_3
-/TestListener.java/1.1/Sun Aug 11 19:24:48 2002//Tv1_7_3
-/TestPlan.java/1.1/Sun Aug 11 19:24:48 2002//Tv1_7_3
-/WorkBench.java/1.1/Sun Aug 11 19:24:48 2002//Tv1_7_3
+/AbstractTestElement.java/1.6/Tue Jan 21 22:12:51 2003//Tv1_8_1
+/PerSampleClonable.java/1.1/Sun Aug 11 19:24:48 2002//Tv1_8_1
+/PerThreadClonable.java/1.1/Sun Aug 11 19:24:48 2002//Tv1_8_1
+/TestElement.java/1.1/Sun Aug 11 19:24:48 2002//Tv1_8_1
+/TestListener.java/1.1/Sun Aug 11 19:24:48 2002//Tv1_8_1
+/TestPlan.java/1.1/Sun Aug 11 19:24:48 2002//Tv1_8_1
+/ThreadListener.java/1.1/Fri Aug 16 21:10:21 2002//Tv1_8_1
+/VariablesCollection.java/1.2/Thu Aug 29 18:17:40 2002//Tv1_8_1
+/WorkBench.java/1.1/Sun Aug 11 19:24:48 2002//Tv1_8_1
 D
diff --git a/jakarta-jmeter/src/core/org/apache/jmeter/testelement/CVS/Tag b/jakarta-jmeter/src/core/org/apache/jmeter/testelement/CVS/Tag
index 5f312fe..e2fda28 100644
--- a/jakarta-jmeter/src/core/org/apache/jmeter/testelement/CVS/Tag
+++ b/jakarta-jmeter/src/core/org/apache/jmeter/testelement/CVS/Tag
@@ -1 +1 @@
-Nv1_7_3
+Nv1_8_1
diff --git a/jakarta-jmeter/src/core/org/apache/jmeter/testelement/ThreadListener.java b/jakarta-jmeter/src/core/org/apache/jmeter/testelement/ThreadListener.java
new file mode 100644
index 0000000..a02d1d9
--- /dev/null
+++ b/jakarta-jmeter/src/core/org/apache/jmeter/testelement/ThreadListener.java
@@ -0,0 +1,34 @@
+package org.apache.jmeter.testelement;
+
+import org.apache.jmeter.threads.JMeterVariables;
+
+/**
+ * Used to pass messages to test elements that are interested in information
+ * unique to a particular test thread, such as when new iterations through the
+ * test plan are begun, and access to thread-level variable values.
+ */
+public interface ThreadListener {
+	
+	/**
+	 * Tells all thread listeners that a new iteration has started
+	 * and passes the number of the iteration (starting with 1).
+	 */
+	public void iterationStarted(int iterationCount);
+	
+	/**
+	 * Hands the JMeterVariables object for that thread to the 
+	 * ThreadListener object.  The object should save the 
+	 * reference for use throughout the test.
+	 * <p>
+	 * One thing to be aware of is that if your test element does not
+	 * implement PerThreadClonable, then this method will be called 
+	 * multiple times, as each thread hands off it's JMeterVariables
+	 * object.  In that case, it is your job to store all instances of
+	 * JMeterVariables handed to you, and keep them straight by
+	 * their thread names.
+	 */
+	public void setJMeterVariables(JMeterVariables jmVars);
+	
+	
+
+}
diff --git a/jakarta-jmeter/src/core/org/apache/jmeter/testelement/VariablesCollection.java b/jakarta-jmeter/src/core/org/apache/jmeter/testelement/VariablesCollection.java
new file mode 100644
index 0000000..7fe824d
--- /dev/null
+++ b/jakarta-jmeter/src/core/org/apache/jmeter/testelement/VariablesCollection.java
@@ -0,0 +1,28 @@
+package org.apache.jmeter.testelement;
+
+import java.io.Serializable;
+import java.util.HashMap;
+import java.util.Map;
+
+import org.apache.jmeter.threads.JMeterVariables;
+
+/**
+ * @author Administrator
+ *
+ * To change this generated comment edit the template variable "typecomment":
+ * Window>Preferences>Java>Templates.
+ */
+public class VariablesCollection implements Serializable {
+	private Map varMap = new HashMap();
+	
+	public void addJMeterVariables(JMeterVariables jmVars)
+	{
+		varMap.put(Thread.currentThread().getName(),jmVars);
+	}
+	
+	public JMeterVariables getVariables()
+	{
+		return (JMeterVariables)varMap.get(Thread.currentThread().getName());
+	}
+
+}
diff --git a/jakarta-jmeter/src/core/org/apache/jmeter/threads/CVS/Entries b/jakarta-jmeter/src/core/org/apache/jmeter/threads/CVS/Entries
index 017aade..b9d3fe2 100644
--- a/jakarta-jmeter/src/core/org/apache/jmeter/threads/CVS/Entries
+++ b/jakarta-jmeter/src/core/org/apache/jmeter/threads/CVS/Entries
@@ -1,8 +1,9 @@
-/JMeterThread.java/1.1/Sun Aug 11 19:24:49 2002//Tv1_7_3
-/JMeterThreadMonitor.java/1.1/Sun Aug 11 19:24:49 2002//Tv1_7_3
-/JMeterVariables.java/1.1/Sun Aug 11 19:24:49 2002//Tv1_7_3
-/ReflectionThreadGroup.java/1.1/Sun Aug 11 19:24:49 2002//Tv1_7_3
-/SamplePackage.java/1.1/Sun Aug 11 19:24:49 2002//Tv1_7_3
-/TestCompiler.java/1.3/Tue Aug 13 18:17:50 2002//Tv1_7_3
-/ThreadGroup.java/1.1/Sun Aug 11 19:24:49 2002//Tv1_7_3
+/JMeterThread.java/1.13/Wed Jan 22 22:51:36 2003//Tv1_8_1
+/JMeterThreadMonitor.java/1.1/Sun Aug 11 19:24:49 2002//Tv1_8_1
+/JMeterVariables.java/1.3/Sat Dec 14 01:23:44 2002//Tv1_8_1
+/ListenerNotifier.java/1.9/Wed Jan 22 22:51:36 2003//Tv1_8_1
+/ReflectionThreadGroup.java/1.1/Sun Aug 11 19:24:49 2002//Tv1_8_1
+/SamplePackage.java/1.1/Sun Aug 11 19:24:49 2002//Tv1_8_1
+/TestCompiler.java/1.12/Wed Jan 22 22:51:36 2003//Tv1_8_1
+/ThreadGroup.java/1.6/Mon Jan 13 12:31:05 2003//Tv1_8_1
 D/gui////
diff --git a/jakarta-jmeter/src/core/org/apache/jmeter/threads/CVS/Tag b/jakarta-jmeter/src/core/org/apache/jmeter/threads/CVS/Tag
index 5f312fe..e2fda28 100644
--- a/jakarta-jmeter/src/core/org/apache/jmeter/threads/CVS/Tag
+++ b/jakarta-jmeter/src/core/org/apache/jmeter/threads/CVS/Tag
@@ -1 +1 @@
-Nv1_7_3
+Nv1_8_1
diff --git a/jakarta-jmeter/src/core/org/apache/jmeter/threads/JMeterThread.java b/jakarta-jmeter/src/core/org/apache/jmeter/threads/JMeterThread.java
index cdc5201..b8f4bee 100644
--- a/jakarta-jmeter/src/core/org/apache/jmeter/threads/JMeterThread.java
+++ b/jakarta-jmeter/src/core/org/apache/jmeter/threads/JMeterThread.java
@@ -53,46 +53,62 @@
  * <http://www.apache.org/>.
  */
 package org.apache.jmeter.threads;
-import java.util.*;
-import org.apache.jmeter.assertions.*;
+import java.util.Collection;
+import java.util.HashMap;
+import java.util.Iterator;
+import java.util.List;
+import java.util.Map;
+
+import org.apache.jmeter.assertions.Assertion;
+import org.apache.jmeter.assertions.AssertionResult;
 import org.apache.jmeter.control.Controller;
-import org.apache.jmeter.control.NoEntryException;
-import org.apache.jmeter.samplers.*;
 import org.apache.jmeter.samplers.SampleEvent;
-import org.apache.jmeter.samplers.SampleListener;
 import org.apache.jmeter.samplers.SampleResult;
 import org.apache.jmeter.samplers.Sampler;
-import org.apache.jmeter.timers.Timer;
-import org.apache.jmeter.util.ListedHashTree;
 import org.apache.jmeter.testelement.TestElement;
+import org.apache.jmeter.testelement.ThreadListener;
+import org.apache.jmeter.timers.Timer;
+import org.apache.log.Hierarchy;
+import org.apache.log.Logger;
+import org.apache.jorphan.collections.HashTree;
+import org.apache.jorphan.collections.SearchByClass;
 /****************************************
  * The JMeter interface to the sampling process, allowing JMeter to see the
  * timing, add listeners for sampling events and to stop the sampling process.
  *
  *@author    $Author: mstover1 $
- *@created   $Date: 2002/08/11 19:24:49 $
- *@version   $Revision: 1.1 $
+ *@created   $Date: 2003/01/22 22:51:36 $
+ *@version   $Revision: 1.13 $
  ***************************************/
 public class JMeterThread implements Runnable, java.io.Serializable {
+	transient private static Logger log = Hierarchy.getDefaultHierarchy().getLoggerFor(
+			"jmeter.engine");
 	static Map samplers = new HashMap();
 	int initialDelay = 0;
 	Controller controller;
 	private boolean running;
-	ListedHashTree testTree;
+	HashTree testTree;
 	TestCompiler compiler;
 	JMeterThreadMonitor monitor;
 	String threadName;
 	JMeterVariables threadVars;
+	Collection threadListeners;
+	ListenerNotifier notifier;
+	
 	/****************************************
 	 * !ToDo (Constructor description)
 	 ***************************************/
 	public JMeterThread() {}
-	public JMeterThread(ListedHashTree test, JMeterThreadMonitor monitor) {
+	public JMeterThread(HashTree test, JMeterThreadMonitor monitor,ListenerNotifier note) {
 		this.monitor = monitor;
 		threadVars = new JMeterVariables();
 		testTree = test;
 		compiler = new TestCompiler(testTree,threadVars);
 		controller = (Controller) testTree.getArray()[0];
+		SearchByClass threadListenerSearcher = new SearchByClass(ThreadListener.class);
+		test.traverse(threadListenerSearcher);
+		threadListeners = threadListenerSearcher.getSearchResults();
+		notifier = note;
 	}
 
 	public void setThreadName(String threadName)
@@ -105,17 +121,21 @@ public class JMeterThread implements Runnable, java.io.Serializable {
 	public void run() {
 		try
 		{
+			initializeThreadListeners();
 			testTree.traverse(compiler);
 			running = true;
 			//listeners = controller.getListeners();
 			Sampler entry = null;
 			rampUpDelay();
-			System.out.println("Thread "+Thread.currentThread().getName()+" started");
+			log.info("Thread "+Thread.currentThread().getName()+" started");
 			while (running) {
 				while (controller.hasNext() && running) {
-					threadVars.incIteration();
 					try
 					{
+						if(controller.isNextFirst())
+						{
+							notifyThreadListeners();
+						}
 						SamplePackage pack = compiler.configureSampler(controller.next());
 						delay(pack.getTimers());
 						SampleResult result = pack.getSampler().sample(null);
@@ -126,7 +146,7 @@ public class JMeterThread implements Runnable, java.io.Serializable {
 					}
 					catch(Exception e)
 					{
-						e.printStackTrace();
+						log.error("",e);
 					}
 				}
 				if (controller.isDone()) {
@@ -136,14 +156,22 @@ public class JMeterThread implements Runnable, java.io.Serializable {
 		}
 		finally
 		{
+			log.info("Thread "+threadName+" is done");
 			monitor.threadFinished(this);
 		}
 	}
+	
+	public String getThreadName()
+	{
+		return threadName;
+	}
+	
 	/****************************************
 	 * !ToDo (Method description)
 	 ***************************************/
 	public void stop() {
-		running = false;
+		running = false;		
+		log.info("stopping "+threadName);
 	}
 	private void checkAssertions(List assertions, SampleResult result) {
 		Iterator iter = assertions.iterator();
@@ -166,19 +194,36 @@ public class JMeterThread implements Runnable, java.io.Serializable {
 				Thread.sleep(sum);
 			}
 			catch (InterruptedException e) {
-				e.printStackTrace();
+				log.error("",e);
 			}
 		}
 	}
+	
+	private void initializeThreadListeners()
+	{
+		Iterator iter = threadListeners.iterator();
+		while(iter.hasNext())
+		{
+			((ThreadListener)iter.next()).setJMeterVariables(threadVars);
+		}
+	}
+	
+	private void notifyThreadListeners()
+	{
+		threadVars.incIteration();
+		Iterator iter = threadListeners.iterator();
+		while(iter.hasNext())
+		{
+			((ThreadListener)iter.next()).iterationStarted(threadVars.getIteration());
+		}
+	}
+	
 	private void notifyListeners(List listeners, SampleResult result) {
 		SampleEvent event =
 			new SampleEvent(result, (String) controller.getProperty(TestElement.NAME));
-		Iterator iter = listeners.iterator();
-		while (iter.hasNext()) {
-			SampleListener lis = (SampleListener)iter.next();
-			SampleListener item = lis;
-			item.sampleOccurred(event);
-		}
+		compiler.sampleOccurred(event);
+		notifier.addLast(event,listeners);
+		
 	}
 	public void setInitialDelay(int delay) {
 		initialDelay = delay;
@@ -192,7 +237,6 @@ public class JMeterThread implements Runnable, java.io.Serializable {
 				Thread.sleep(initialDelay);
 			}
 			catch (InterruptedException e) {
-				e.printStackTrace();
 			}
 		}
 	}
diff --git a/jakarta-jmeter/src/core/org/apache/jmeter/threads/JMeterVariables.java b/jakarta-jmeter/src/core/org/apache/jmeter/threads/JMeterVariables.java
index cb274f5..fd63eb6 100644
--- a/jakarta-jmeter/src/core/org/apache/jmeter/threads/JMeterVariables.java
+++ b/jakarta-jmeter/src/core/org/apache/jmeter/threads/JMeterVariables.java
@@ -12,7 +12,12 @@ import java.util.Map;
  * Window>Preferences>Java>Code Generation.
  */
 public class JMeterVariables {
-	private static Map iterationData = new HashMap();
+	private Map variables = new HashMap();
+	private int iteration = 0;	
+	
+	public JMeterVariables()
+	{
+	}
 	
 	public String getThreadName()
 	{
@@ -21,25 +26,32 @@ public class JMeterVariables {
 	
 	public int getIteration()
 	{
-		int[] a = (int[])iterationData.get(getThreadName());
-		return a[0];
+		return iteration;
 	}
 	
 	public void incIteration()
 	{
-		int[] a = (int[])iterationData.get(getThreadName());
-		if(a == null)
-		{
-			a = new int[1];
-			a[0] = 0;
-			iterationData.put(getThreadName(),a);
-		}
-		a[0]++;
+		iteration++;
 	}
 	
-	public static void initialize()
+	public void initialize()
 	{
-		iterationData.clear();
+		variables.clear();
+	}
+	
+	public void put(String key,String value)
+	{
+		variables.put(key,value);
+	}
+	
+	public String get(String key)
+	{
+		String val = (String)variables.get(key);
+		if(val == null)
+		{
+			return "";
+		}
+		return val;
 	}
 
 }
\ No newline at end of file
diff --git a/jakarta-jmeter/src/core/org/apache/jmeter/threads/ListenerNotifier.java b/jakarta-jmeter/src/core/org/apache/jmeter/threads/ListenerNotifier.java
new file mode 100644
index 0000000..312d897
--- /dev/null
+++ b/jakarta-jmeter/src/core/org/apache/jmeter/threads/ListenerNotifier.java
@@ -0,0 +1,112 @@
+package org.apache.jmeter.threads;
+import java.util.Iterator;
+import java.util.LinkedList;
+import java.util.List;
+
+import org.apache.jmeter.samplers.SampleEvent;
+import org.apache.jmeter.samplers.SampleListener;
+import org.apache.jmeter.util.JMeterUtils;
+import org.apache.log.Logger;
+import org.apache.jorphan.logging.LoggingManager;
+/**
+ * @author Administrator
+ *
+ * To change this generated comment edit the template variable "typecomment":
+ * Window>Preferences>Java>Templates.
+ */
+public class ListenerNotifier extends LinkedList implements Runnable
+{
+	private static Logger log =
+		LoggingManager.getLoggerFor(JMeterUtils.ENGINE);
+	/**
+	 * @see java.lang.Runnable#run()
+	 */
+	boolean running;
+	boolean isStopped;
+	static private int ABS_MAX = 500;
+	static private int MAX = 200;
+	int sleepTime = 2000;
+	public ListenerNotifier()
+	{
+		super();
+		running = true;
+		isStopped = true;
+	}
+	public void run()
+	{
+		Iterator iter;
+		while (running || this.size() > 1)
+		{
+			SampleEvent res = (SampleEvent) this.removeFirst();
+			if (res != null)
+			{
+				List listeners = (List) this.removeFirst();
+				notifyListeners(res, listeners);
+			}
+			try
+			{
+				Thread.sleep(sleepTime);
+			}
+			catch (InterruptedException e)
+			{
+			}
+			if (size() > MAX && Thread.currentThread().getPriority() == Thread.NORM_PRIORITY)
+			{
+				log.debug("Notifier thread priority going from normal to max, size = "+size());
+				Thread.currentThread().setPriority(Thread.MAX_PRIORITY);
+			}
+		}
+		log.debug("Listener Notifier stopped");
+		isStopped = true;
+	}
+	private void notifyListeners(SampleEvent res, List listeners)
+	{
+		Iterator iter;
+		iter = listeners.iterator();
+		while (iter.hasNext())
+		{
+			((SampleListener) iter.next()).sampleOccurred(res);
+		}
+	}
+	public boolean isStopped()
+	{
+		return isStopped;
+	}
+	public synchronized void addLast(SampleEvent item, List listeners)
+	{
+		if(size() > ABS_MAX)
+		{
+			notifyListeners(item,listeners);		
+		}
+		else
+		{
+			super.addLast(item);
+			super.addLast(listeners);
+			sleepTime = 0;
+		}
+	}
+	public synchronized Object removeFirst()
+	{
+		try
+		{
+			return super.removeFirst();
+		}
+		catch (RuntimeException e)
+		{
+			sleepTime = 2000;
+			log.debug("Setting notifier thread priority to normal");
+			Thread.currentThread().setPriority(Thread.NORM_PRIORITY);
+			return null;
+		}
+	}
+	public void stop()
+	{
+		running = false;
+	}
+	public void start()
+	{
+		Thread noteThread = new Thread(this);
+		noteThread.start();
+		isStopped = false;
+	}
+}
diff --git a/jakarta-jmeter/src/core/org/apache/jmeter/threads/TestCompiler.java b/jakarta-jmeter/src/core/org/apache/jmeter/threads/TestCompiler.java
index 607136a..3109fb4 100644
--- a/jakarta-jmeter/src/core/org/apache/jmeter/threads/TestCompiler.java
+++ b/jakarta-jmeter/src/core/org/apache/jmeter/threads/TestCompiler.java
@@ -9,15 +9,13 @@ import java.util.Map;
 import java.util.Set;
 
 import org.apache.jmeter.assertions.Assertion;
-import org.apache.jmeter.config.Arguments;
 import org.apache.jmeter.config.ConfigTestElement;
 import org.apache.jmeter.config.Modifier;
 import org.apache.jmeter.config.ResponseBasedModifier;
 import org.apache.jmeter.control.GenericController;
 import org.apache.jmeter.functions.Function;
 import org.apache.jmeter.functions.InvalidVariableException;
-import org.apache.jmeter.protocol.http.sampler.HTTPSampler;
-import org.apache.jmeter.protocol.http.util.HTTPArgument;
+import org.apache.jmeter.samplers.AbstractSampler;
 import org.apache.jmeter.samplers.SampleEvent;
 import org.apache.jmeter.samplers.SampleListener;
 import org.apache.jmeter.samplers.SampleResult;
@@ -25,8 +23,11 @@ import org.apache.jmeter.samplers.Sampler;
 import org.apache.jmeter.testelement.PerSampleClonable;
 import org.apache.jmeter.testelement.TestElement;
 import org.apache.jmeter.timers.Timer;
-import org.apache.jmeter.util.ListedHashTree;
-import org.apache.jmeter.util.ListedHashTreeVisitor;
+import org.apache.jorphan.collections.HashTree;
+import org.apache.jorphan.collections.HashTreeTraverser;
+import org.apache.jorphan.collections.ListedHashTree;
+import org.apache.log.Hierarchy;
+import org.apache.log.Logger;
 
 /****************************************
  * <p>
@@ -40,16 +41,18 @@ import org.apache.jmeter.util.ListedHashTreeVisitor;
  * Company: </p>
  *
  *@author    unascribed
- *@created   $Date: 2002/08/13 18:17:50 $
+ *@created   $Date: 2003/01/22 22:51:36 $
  *@version   1.0
  ***************************************/
 
-public class TestCompiler implements ListedHashTreeVisitor, SampleListener
+public class TestCompiler implements HashTreeTraverser, SampleListener
 {
+	transient private static Logger log = Hierarchy.getDefaultHierarchy().getLoggerFor(
+			"jmeter.engine");
 	LinkedList stack = new LinkedList();
-	Map samplerConfigs = new HashMap();
+	Map samplerConfigMap = new HashMap();
 	Set objectsWithFunctions = new HashSet();
-	ListedHashTree testTree;
+	HashTree testTree;
 	SampleResult previousResult;
 	Sampler currentSampler;
 	JMeterVariables threadVars;
@@ -60,7 +63,7 @@ public class TestCompiler implements ListedHashTreeVisitor, SampleListener
 	 *
 	 *@param testTree  !ToDo (Parameter description)
 	 ***************************************/
-	public TestCompiler(ListedHashTree testTree,
+	public TestCompiler(HashTree testTree,
 			JMeterVariables vars)
 	{
 		threadVars = vars;
@@ -110,22 +113,21 @@ public class TestCompiler implements ListedHashTreeVisitor, SampleListener
 		currentSampler = sampler;
 		SamplePackage ret = new SamplePackage();
 		Sampler clonedSampler = sampler;
+		SamplerConfigs configs = (SamplerConfigs)samplerConfigMap.get(sampler);
 		if(sampler instanceof PerSampleClonable)
 		{
-			clonedSampler = (Sampler)((PerSampleClonable)sampler).clone();
+			clonedSampler = (Sampler)sampler.clone();
 		}
 		if(objectsWithFunctions.contains(sampler))
 		{
 			replaceValues(clonedSampler);
 		}
 		ret.setSampler(clonedSampler);
-		ret.addSampleListener(this);
-		Iterator iter = ((List)samplerConfigs.get(sampler)).iterator();
-		while(iter.hasNext())
-		{
-			TestElement config = (TestElement)iter.next();
-			layerElement(ret,config, clonedSampler);
-		}
+		configureWithConfigElements(clonedSampler,configs.getConfigs());
+		configureWithResponseModifiers(clonedSampler,configs.getResponseModifiers());
+		configureWithModifiers(clonedSampler,configs.getModifiers());
+		configureSamplerPackage(ret,configs);
+		//replaceStatics(ret);
 		return ret;
 	}
 
@@ -135,9 +137,10 @@ public class TestCompiler implements ListedHashTreeVisitor, SampleListener
 	 *@param node     !ToDo
 	 *@param subTree  !ToDo
 	 ***************************************/
-	public void addNode(Object node, ListedHashTree subTree)
+	public void addNode(Object node, HashTree subTree)
 	{
 		stack.addLast(node);
+		log.debug("Added "+node+" to stack.  Stack size = "+stack.size());
 	}
 
 	/****************************************
@@ -145,9 +148,11 @@ public class TestCompiler implements ListedHashTreeVisitor, SampleListener
 	 ***************************************/
 	public void subtractNode()
 	{
+		log.debug("Subtracting node, stack size = "+stack.size());
 		TestElement child = (TestElement)stack.getLast();
 		if(child instanceof Sampler)
 		{
+			log.debug("Saving configs for sampler: "+child);
 			saveSamplerConfigs((Sampler)child);
 		}
 		stack.removeLast();
@@ -170,8 +175,16 @@ public class TestCompiler implements ListedHashTreeVisitor, SampleListener
 	private void saveSamplerConfigs(Sampler sam)
 	{
 		List configs = new LinkedList();
+		List modifiers = new LinkedList();
+		List responseModifiers = new LinkedList();
+		List listeners = new LinkedList();
+		List timers = new LinkedList();
+		List assertions = new LinkedList();
+		log.debug("Full stack = " + stack);
 		for(int i = stack.size(); i > 0; i--)
 		{
+			log.debug("looping, i = "+i);
+			log.debug("sub-stack = "+stack.subList(0,i));
 			Iterator iter = testTree.list(stack.subList(0, i)).iterator();
 			while(iter.hasNext())
 			{
@@ -183,10 +196,30 @@ public class TestCompiler implements ListedHashTreeVisitor, SampleListener
 						objectsWithFunctions.add(item);
 					}
 				}
-				if(!(item instanceof Sampler))
+				if((item instanceof ConfigTestElement))
 				{
 					configs.add(item);
 				}
+				if(item instanceof Modifier)
+				{
+					modifiers.add(item);
+				}
+				if(item instanceof ResponseBasedModifier)
+				{
+					responseModifiers.add(item);
+				}
+				if(item instanceof SampleListener)
+				{
+					listeners.add(item);
+				}
+				if(item instanceof Timer)
+				{
+					timers.add(item);
+				}
+				if(item instanceof Assertion)
+				{
+					assertions.add(item);
+				}			
 			}
 		}
 		synchronized(sam)
@@ -196,15 +229,68 @@ public class TestCompiler implements ListedHashTreeVisitor, SampleListener
 				objectsWithFunctions.add(sam);
 			}
 		}
-		samplerConfigs.put(sam, configs);
+		SamplerConfigs samplerConfigs = new SamplerConfigs(configs,modifiers,responseModifiers,
+				listeners,timers,assertions);
+		samplerConfigMap.put(sam, samplerConfigs);
+	}
+	
+	private class SamplerConfigs
+	{
+		List configs;
+		List modifiers;
+		List listeners;
+		List assertions;
+		List timers;
+		List responseModifiers;
+		
+		public SamplerConfigs(List configs,List modifiers,List responseModifiers,
+				List listeners,List timers,List assertions)
+		{
+			this.configs = configs;
+			this.modifiers = modifiers;
+			this.responseModifiers = responseModifiers;
+			this.listeners = listeners;
+			this.timers = timers;
+			this.assertions = assertions;
+		}
+		
+		public List getConfigs()
+		{
+			return configs;
+		}
+		
+		public List getModifiers()
+		{
+			return modifiers;
+		}
+		
+		public List getResponseModifiers()
+		{
+			return responseModifiers;
+		}
+		
+		public List getListeners()
+		{
+			return listeners;
+		}
+		
+		public List getAssertions()
+		{
+			return assertions;
+		}
+		
+		public List getTimers()
+		{
+			return timers;
+		}
 	}
 
 	/****************************************
 	 * !ToDo (Class description)
 	 *
 	 *@author    $Author: mstover1 $
-	 *@created   $Date: 2002/08/13 18:17:50 $
-	 *@version   $Revision: 1.3 $
+	 *@created   $Date: 2003/01/22 22:51:36 $
+	 *@version   $Revision: 1.12 $
 	 ***************************************/
 	public static class Test extends junit.framework.TestCase
 	{
@@ -229,28 +315,23 @@ public class TestCompiler implements ListedHashTreeVisitor, SampleListener
 			GenericController controller = new GenericController();
 			ConfigTestElement config1 = new ConfigTestElement();
 			config1.setName("config1");
-			config1.setProperty(HTTPSampler.DOMAIN, "www.jarkarta.org");
-			HTTPSampler sampler = new HTTPSampler();
+			config1.setProperty("test.property", "A test value");
+			TestSampler sampler = new TestSampler();
 			sampler.setName("sampler");
-			Arguments args = new Arguments();
-			args.addArgument("param1", "value1");
-			HTTPSampler sampler2 = new HTTPSampler();
-			sampler.setName("sampler2");
-			Arguments args2 = new Arguments();
-			args2.addArgument(new HTTPArgument("xml","<data>1234</data>"));
-			sampler2.setArguments(args2);
 			testing.add(controller, config1);
 			testing.add(controller, sampler);
-			testing.add(controller,sampler2);
-			testing.get(controller).add(sampler, args);
 			TestCompiler.initialize();
 
 			TestCompiler compiler = new TestCompiler(testing,new JMeterVariables());
 			testing.traverse(compiler);
-			sampler = (HTTPSampler)compiler.configureSampler(sampler).getSampler();
-			assertEquals(config1.getProperty(HTTPSampler.DOMAIN), sampler.getDomain());
-			assertEquals(args.getArgument(0).getName(), sampler.getArguments().getArgument(0).getName());
-			assertEquals(1,sampler.getArguments().getArguments().size());
+			sampler = (TestSampler)compiler.configureSampler(sampler).getSampler();
+			assertEquals("A test value", sampler.getProperty("test.property"));
+		}
+
+		class TestSampler extends AbstractSampler {
+		  public void addCustomTestElement(TestElement t) { }
+		  public org.apache.jmeter.samplers.SampleResult sample(org.apache.jmeter.samplers.Entry e) { return null; }
+		  public Object clone() { return new TestSampler(); }
 		}
 	}
 
@@ -258,8 +339,8 @@ public class TestCompiler implements ListedHashTreeVisitor, SampleListener
 	 * !ToDo (Class description)
 	 *
 	 *@author    $Author: mstover1 $
-	 *@created   $Date: 2002/08/13 18:17:50 $
-	 *@version   $Revision: 1.3 $
+	 *@created   $Date: 2003/01/22 22:51:36 $
+	 *@version   $Revision: 1.12 $
 	 ***************************************/
 	private class ObjectPair
 	{
@@ -302,44 +383,103 @@ public class TestCompiler implements ListedHashTreeVisitor, SampleListener
 			return false;
 		}
 	}
-
-	private void layerElement(SamplePackage ret,TestElement config, Sampler clonedSampler)
+	
+	private void configureWithConfigElements(Sampler sam,List configs)
 	{
-		boolean replace = objectsWithFunctions.contains(config);
-		if(config instanceof PerSampleClonable)
+		Iterator iter = configs.iterator();
+		while(iter.hasNext())
 		{
-			config = (TestElement)((PerSampleClonable)config).clone();
+			ConfigTestElement config = (ConfigTestElement)iter.next();
+			TestElement clonedConfig = (TestElement)cloneIfNecessary(config);
+			if(objectsWithFunctions.contains(config))
+			{
+				replaceValues(clonedConfig);
+			}
+			sam.addTestElement(clonedConfig);
 		}
-		if(config instanceof Modifier)
+	}
+	
+	private void configureWithModifiers(Sampler sam,List modifiers)
+	{
+		Iterator iter = modifiers.iterator();
+		while(iter.hasNext())
 		{
-			((Modifier)config).modifyEntry(clonedSampler);
+			Modifier mod = (Modifier)iter.next();
+			TestElement cloned = (TestElement)cloneIfNecessary(mod);
+			if(objectsWithFunctions.contains(mod))
+			{
+				replaceValues(cloned);
+			}
+			((Modifier)cloned).modifyEntry(sam);
 		}
-		if(config instanceof ResponseBasedModifier && previousResult != null)
+	}
+	
+	private void configureWithResponseModifiers(Sampler sam,List responseModifiers)
+	{
+		Iterator iter = responseModifiers.iterator();
+		while(iter.hasNext())
 		{
-			((ResponseBasedModifier)config).modifyEntry(clonedSampler, previousResult);
+			ResponseBasedModifier mod = (ResponseBasedModifier)iter.next();
+			TestElement cloned = (TestElement)cloneIfNecessary(mod);
+			if(objectsWithFunctions.contains(mod))
+			{
+				replaceValues(cloned);
+			}
+			if(previousResult != null)
+			{
+				((ResponseBasedModifier)cloned).modifyEntry(sam,previousResult);
+			}
 		}
-		if(config instanceof SampleListener)
+	}
+	
+	private Object cloneIfNecessary(Object el)
+	{
+		if(el instanceof PerSampleClonable || objectsWithFunctions.contains(el))
 		{
-			ret.addSampleListener((SampleListener)config);
+			return ((TestElement)el).clone();
 		}
-		if(config instanceof Assertion)
+		else
 		{
-			ret.addAssertion((Assertion)config);
+			return el;
 		}
-		if(config instanceof Timer)
+	}
+
+	private void configureSamplerPackage(SamplePackage ret,SamplerConfigs configs)
+	{
+		Iterator iter = configs.getAssertions().iterator();
+		while(iter.hasNext())
 		{
-			ret.addTimer((Timer)config);
+			Assertion assertion = (Assertion)iter.next();
+			TestElement cloned = (TestElement)cloneIfNecessary(assertion);
+			if(objectsWithFunctions.contains(assertion))
+			{
+				replaceValues(cloned);
+			}
+			ret.addAssertion((Assertion)cloned);
 		}
-		if(replace && config instanceof PerSampleClonable)
+		iter = configs.getTimers().iterator();
+		while(iter.hasNext())
 		{
-			replaceValues(config);
+			Timer timer = (Timer)iter.next();
+			TestElement cloned = (TestElement)cloneIfNecessary(timer);
+			if(objectsWithFunctions.contains(timer))
+			{
+				replaceValues(cloned);
+			}
+			ret.addTimer((Timer)cloned);
 		}
-		else if(replace)
+		
+		iter = configs.getListeners().iterator();
+		while(iter.hasNext())
 		{
-			config = (TestElement)config.clone();
-			replaceValues(config);
+			SampleListener lis = (SampleListener)iter.next();
+			TestElement cloned = (TestElement)cloneIfNecessary(lis);
+			if(objectsWithFunctions.contains(lis))
+			{
+				replaceValues(cloned);
+			}
+			ret.addSampleListener((SampleListener)cloned);
 		}
-		clonedSampler.addTestElement(config);
 	}
 	
 	private boolean hasFunctions(TestElement el)
@@ -436,7 +576,7 @@ public class TestCompiler implements ListedHashTreeVisitor, SampleListener
 		try {
 			newColl = (Collection)values.getClass().newInstance();
 		} catch(Exception e) {
-			e.printStackTrace();
+			log.error("",e);
 			return values;
 		} 
 		Iterator iter = values.iterator();
diff --git a/jakarta-jmeter/src/core/org/apache/jmeter/threads/ThreadGroup.java b/jakarta-jmeter/src/core/org/apache/jmeter/threads/ThreadGroup.java
index 0bc44af..a687402 100644
--- a/jakarta-jmeter/src/core/org/apache/jmeter/threads/ThreadGroup.java
+++ b/jakarta-jmeter/src/core/org/apache/jmeter/threads/ThreadGroup.java
@@ -2,7 +2,7 @@
  * ====================================================================
  * The Apache Software License, Version 1.1
  *
- * Copyright (c) 2001 The Apache Software Foundation.  All rights
+ * Copyright (c) 2001-2003 The Apache Software Foundation.  All rights 
  * reserved.
  *
  * Redistribution and use in source and binary forms, with or without
@@ -52,7 +52,9 @@
  * information on the Apache Software Foundation, please see
  * <http://www.apache.org/>.
  */
+ 
 package org.apache.jmeter.threads;
+
 import java.io.Serializable;
 import java.util.Collections;
 import java.util.Iterator;
@@ -68,279 +70,286 @@ import org.apache.jmeter.samplers.Sampler;
 import org.apache.jmeter.testelement.AbstractTestElement;
 import org.apache.jmeter.testelement.PerThreadClonable;
 import org.apache.jmeter.testelement.TestElement;
+import org.apache.log.Hierarchy;
+import org.apache.log.Logger;
 
-/****************************************
- * Title: Apache JMeter Description: Copyright: Copyright (c) 2000 Company:
- * Apache Foundation
+/**
+ * ThreadGroup
  *
- *@author    Michael Stover
- *@created   $Date: 2002/08/11 19:24:49 $
- *@version   1.0
- ***************************************/
-
-public class ThreadGroup extends AbstractTestElement implements SampleListener,
-		Serializable,Controller,PerThreadClonable
+ *@author Michael Stover
+ *@version $Id: ThreadGroup.java,v 1.6 2003/01/13 12:31:05 seade Exp $
+ */
+public class ThreadGroup
+    extends AbstractTestElement
+    implements SampleListener, Serializable, Controller, PerThreadClonable
 {
+    private static Logger log =
+        Hierarchy.getDefaultHierarchy().getLoggerFor("jmeter.elements");
+
+    public final static String NUM_THREADS = "ThreadGroup.num_threads";
+    public final static String RAMP_TIME = "ThreadGroup.ramp_time";
+    public final static String MAIN_CONTROLLER = "ThreadGroup.main_controller";
 
-	/****************************************
-	 * !ToDo (Field description)
-	 ***************************************/
-	public final static String NUM_THREADS = "ThreadGroup.num_threads";
-	/****************************************
-	 * !ToDo (Field description)
-	 ***************************************/
-	public final static String RAMP_TIME = "ThreadGroup.ramp_time";
-	/****************************************
-	 * !ToDo (Field description)
-	 ***************************************/
-	public final static String MAIN_CONTROLLER = "ThreadGroup.main_controller";
-	private final int DEFAULT_NUM_THREADS = 1;
-	private final int DEFAULT_RAMP_UP = 0;
-	private SampleQueue queue = null;
-	private int threadsStarted = 0;
-	private LinkedList listeners = new LinkedList();
-	private LinkedList remoteListeners = new LinkedList();
+    private final int DEFAULT_NUM_THREADS = 1;
+    private final int DEFAULT_RAMP_UP = 0;
+    private SampleQueue queue = null;
+    private int threadsStarted = 0;
+    private LinkedList listeners = new LinkedList();
+    private LinkedList remoteListeners = new LinkedList();
 
-	/****************************************
-	 * !ToDo (Constructor description)
-	 ***************************************/
-	public ThreadGroup()
-	{
-	}
+    /**
+     * No-arg constructor.
+     */
+    public ThreadGroup()
+    {
+    }
 
-	/****************************************
-	 * !ToDo (Method aadescription)
-	 *
-	 *@param numThreads  !ToDo (Parameter description)
-	 ***************************************/
-	public void setNumThreads(int numThreads)
-	{
-		setProperty(NUM_THREADS,new Integer(numThreads));
-	}
+    /**
+     * Set the nuber of threads.
+     *
+     * @param numThreads the number of threads.
+     */
+    public void setNumThreads(int numThreads)
+    {
+        setProperty(NUM_THREADS, new Integer(numThreads));
+    }
 
-	public boolean isDone()
-	{
-		return getSamplerController().isDone();
-	}
+    public boolean isDone()
+    {
+        return getSamplerController().isDone();
+    }
 
-	public boolean hasNext()
-	{
-		return getSamplerController().hasNext();
-	}
+    public boolean hasNext()
+    {
+        return getSamplerController().hasNext();
+    }
 
-	public Sampler next()
-	{
-		return getSamplerController().next();
-	}
+    public Sampler next()
+    {
+        return getSamplerController().next();
+    }
 
-	/****************************************
-	 * !ToDo (Method aadescription)
-	 *
-	 *@param rampUp  !ToDo (Parameter description)
-	 ***************************************/
-	public void setRampUp(int rampUp)
-	{
-		setProperty(RAMP_TIME,new Integer(rampUp));
-	}
+    /**
+     * Set the ramp-up value.
+     *
+     * @param rampUp the ramp-up value.
+     */
+    public void setRampUp(int rampUp)
+    {
+        setProperty(RAMP_TIME, new Integer(rampUp));
+    }
 
-	/****************************************
-	 * !ToDoo (Method description)
-	 *
-	 *@return   !ToDo (Return description)
-	 ***************************************/
-	public int getRampUp()
-	{
-		return getPropertyAsInt(this.RAMP_TIME);
-	}
+    public boolean isNextFirst()
+    {
+        return getSamplerController().isNextFirst();
+    }
 
-	/****************************************
-	 * !ToDoo (Method description)
-	 *
-	 *@return   !ToDo (Return description)
-	 ***************************************/
-	public Controller getSamplerController()
-	{
-		return (Controller)getProperty(MAIN_CONTROLLER);
-	}
+    /**
+     * Get the ramp-up value.
+     *
+     * @return the ramp-up value.
+     */
+    public int getRampUp()
+    {
+        return getPropertyAsInt(ThreadGroup.RAMP_TIME);
+    }
 
-	/****************************************
-	 * !ToDo (Method description)
-	 *
-	 *@param c  !ToDo (Parameter description)
-	 ***************************************/
-	public void setSamplerController(LoopController c)
-	{
-		c.setContinueForever(false);
-		setProperty(MAIN_CONTROLLER, c);
-	}
+    /**
+     * Get the sampler controller.
+     *
+     * @return the sampler controller.
+     */
+    public Controller getSamplerController()
+    {
+        return (Controller) getProperty(MAIN_CONTROLLER);
+    }
 
-	/****************************************
-	 * !ToDoo (Method description)
-	 *
-	 *@return   !ToDo (Return description)
-	 ***************************************/
-	public int getNumThreads()
-	{
-		return this.getPropertyAsInt(this.NUM_THREADS);
-	}
+    /**
+     * Set the sampler controller.
+     *
+     * @param c the sampler controller.
+     */
+    public void setSamplerController(LoopController c)
+    {
+        c.setContinueForever(false);
+        setProperty(MAIN_CONTROLLER, c);
+    }
 
-	/****************************************
-	 * !ToDoo (Method description)
-	 *
-	 *@return   !ToDo (Return description)
-	 ***************************************/
-	public int getDefaultNumThreads()
-	{
-		return this.DEFAULT_NUM_THREADS;
-	}
+    /**
+     * Get the number of threads.
+     *
+     * @return the number of threads.
+     */
+    public int getNumThreads()
+    {
+        return this.getPropertyAsInt(ThreadGroup.NUM_THREADS);
+    }
 
-	/****************************************
-	 * !ToDoo (Method description)
-	 *
-	 *@return   !ToDo (Return description)
-	 ***************************************/
-	public int getDefaultRampUp()
-	{
-		return this.DEFAULT_RAMP_UP;
-	}
+    /**
+     * Get the default number of threads.
+     *
+     * @return the default number of threads.
+     */
+    public int getDefaultNumThreads()
+    {
+        return this.DEFAULT_NUM_THREADS;
+    }
 
+    /**
+     * Get the default ramp-up value.
+     *
+     * @return the default ramp-up value (in seconds).
+     */
+    public int getDefaultRampUp()
+    {
+        return this.DEFAULT_RAMP_UP;
+    }
 
-	/****************************************
-	 * !ToDo
-	 *
-	 *@param child  !ToDo
-	 ***************************************/
-	public void addTestElement(TestElement child)
-	{
-		getSamplerController().addTestElement(child);
-	}
+    /**
+     * Add a test element.
+     *
+     * @param child the test element to add.
+     */
+    public void addTestElement(TestElement child)
+    {
+        getSamplerController().addTestElement(child);
+    }
 
-	/****************************************
-	 * !ToDo (Method description)
-	 *
-	 *@param e  !ToDo (Parameter description)
-	 ***************************************/
-	public void sampleOccurred(SampleEvent e)
-	{
-		if(queue == null)
-		{
-			queue = new SampleQueue();
-			Thread thread = new Thread(queue);
-			//thread.setPriority(Thread.MAX_PRIORITY);
-			thread.start();
-		}
-		queue.sampleOccurred(e);
-	}
+    /**
+     * A sample has occurred.
+     *
+     *@param e the sample event.
+     */
+    public void sampleOccurred(SampleEvent e)
+    {
+        if (queue == null)
+        {
+            queue = new SampleQueue();
+            Thread thread = new Thread(queue);
+            //thread.setPriority(Thread.MAX_PRIORITY);
+            thread.start();
+        }
+        queue.sampleOccurred(e);
+    }
 
-	/****************************************
-	 * A sample has started.
-	 *
-	 *@param e  !ToDo (Parameter description)
-	 ***************************************/
-	public void sampleStarted(SampleEvent e)
-	{
-	}
+    /**
+     * A sample has started.
+     *
+     *@param e the sample event.
+     */
+    public void sampleStarted(SampleEvent e)
+    {
+    }
 
-	/****************************************
-	 * A sample has stopped.
-	 *
-	 *@param e  !ToDo (Parameter description)
-	 ***************************************/
-	public void sampleStopped(SampleEvent e)
-	{
-	}
+    /**
+     * A sample has stopped.
+     *
+     * @param e the sample event
+     */
+    public void sampleStopped(SampleEvent e)
+    {
+    }
 
-	/****************************************
-	 * Separate thread to deliver all SampleEvents. This ensures that sample
-	 * listeners will get sample events 1 at a time, and can thus ignore thread
-	 * issues.
-	 *
-	 *@author    $Author: mstover1 $
-	 *@created   $Date: 2002/08/11 19:24:49 $
-	 *@version   $Revision: 1.1 $
-	 ***************************************/
-	private class SampleQueue implements Runnable, Serializable
-	{
-		List occurredQ = Collections.synchronizedList(new LinkedList());
+    /**
+     * Separate thread to deliver all SampleEvents. This ensures that sample
+     * listeners will get sample events one at a time and can thus ignore thread
+     * issues.
+     *
+     * @author Mike Stover
+     * @version $Id: ThreadGroup.java,v 1.6 2003/01/13 12:31:05 seade Exp $
+     */
+    private class SampleQueue implements Runnable, Serializable
+    {
+        List occurredQ = Collections.synchronizedList(new LinkedList());
 
-		/****************************************
-		 * !ToDo (Constructor description)
-		 ***************************************/
-		public SampleQueue() { }
+        /**
+         * No-arg constructor.
+         */
+        public SampleQueue()
+        {
+        }
 
-		/****************************************
-		 * !ToDo (Method description)
-		 *
-		 *@param e  !ToDo (Parameter description)
-		 ***************************************/
-		public synchronized void sampleOccurred(SampleEvent e)
-		{
-			occurredQ.add(e);
-			this.notify();
-		}
+        /**
+         * A sample occurred.
+         * 
+         * @param e the sample event.
+         */
+        public synchronized void sampleOccurred(SampleEvent e)
+        {
+            occurredQ.add(e);
+            this.notify();
+        }
 
-		/****************************************
-		 * !ToDo (Method description)
-		 ***************************************/
-		public void run()
-		{
-			SampleEvent event = null;
-			while(true)
-			{
-				try
-				{
-					event = (SampleEvent)occurredQ.remove(0);
-				}
-				catch(Exception ex)
-				{
-					waitForSamples();
-					continue;
-				}
-				try
-				{
-					if(event != null)
-					{
-						Iterator iter = listeners.iterator();
-						while(iter.hasNext())
-						{
-							((SampleListener)iter.next()).sampleOccurred(event);
-						}
-						iter = remoteListeners.iterator();
-						while(iter.hasNext())
-						{
-							try
-							{
-								((RemoteSampleListener)iter.next()).sampleOccurred(event);
-							}
-							catch(Exception ex)
-							{
-								ex.printStackTrace();
-							}
-						}
-					}
-					else
-					{
-						waitForSamples();
-					}
-				}
-				catch(Throwable ex)
-				{
-					ex.printStackTrace();
-				}
+        /**
+         * Run the thread.
+         * 
+         * @see java.lang.Runnable#run()
+         */
+        public void run()
+        {
+            SampleEvent event = null;
+            while (true)
+            {
+                try
+                {
+                    event = (SampleEvent) occurredQ.remove(0);
+                }
+                catch (Exception ex)
+                {
+                    waitForSamples();
+                    continue;
+                }
+                try
+                {
+                    if (event != null)
+                    {
+                        Iterator iter = listeners.iterator();
+                        while (iter.hasNext())
+                        {
+                            ((SampleListener) iter.next()).sampleOccurred(
+                                event);
+                        }
+                        iter = remoteListeners.iterator();
+                        while (iter.hasNext())
+                        {
+                            try
+                            {
+                                (
+                                    (RemoteSampleListener) iter
+                                        .next())
+                                        .sampleOccurred(
+                                    event);
+                            }
+                            catch (Exception ex)
+                            {
+                                log.error("", ex);
+                            }
+                        }
+                    }
+                    else
+                    {
+                        waitForSamples();
+                    }
+                }
+                catch (Throwable ex)
+                {
+                    log.error("", ex);
+                }
 
-			}
-		}
+            }
+        }
 
-		private synchronized void waitForSamples()
-		{
-			try
-			{
-				this.wait();
-			}
-			catch(Exception ex)
-			{
-				ex.printStackTrace();
-			}
-		}
-	}
+        private synchronized void waitForSamples()
+        {
+            try
+            {
+                this.wait();
+            }
+            catch (Exception ex)
+            {
+                log.error("", ex);
+            }
+        }
+    }
+    
 }
diff --git a/jakarta-jmeter/src/core/org/apache/jmeter/threads/gui/CVS/Entries b/jakarta-jmeter/src/core/org/apache/jmeter/threads/gui/CVS/Entries
index 2593c2a..b991950 100644
--- a/jakarta-jmeter/src/core/org/apache/jmeter/threads/gui/CVS/Entries
+++ b/jakarta-jmeter/src/core/org/apache/jmeter/threads/gui/CVS/Entries
@@ -1,2 +1,2 @@
-/ThreadGroupGui.java/1.1/Sun Aug 11 19:24:49 2002//Tv1_7_3
+/ThreadGroupGui.java/1.4/Tue Dec 31 18:05:54 2002//Tv1_8_1
 D
diff --git a/jakarta-jmeter/src/core/org/apache/jmeter/threads/gui/CVS/Tag b/jakarta-jmeter/src/core/org/apache/jmeter/threads/gui/CVS/Tag
index 5f312fe..e2fda28 100644
--- a/jakarta-jmeter/src/core/org/apache/jmeter/threads/gui/CVS/Tag
+++ b/jakarta-jmeter/src/core/org/apache/jmeter/threads/gui/CVS/Tag
@@ -1 +1 @@
-Nv1_7_3
+Nv1_8_1
diff --git a/jakarta-jmeter/src/core/org/apache/jmeter/threads/gui/ThreadGroupGui.java b/jakarta-jmeter/src/core/org/apache/jmeter/threads/gui/ThreadGroupGui.java
index e7ee687..3163c85 100644
--- a/jakarta-jmeter/src/core/org/apache/jmeter/threads/gui/ThreadGroupGui.java
+++ b/jakarta-jmeter/src/core/org/apache/jmeter/threads/gui/ThreadGroupGui.java
@@ -2,7 +2,7 @@
  * ====================================================================
  * The Apache Software License, Version 1.1
  *
- * Copyright (c) 2001 The Apache Software Foundation.  All rights
+ * Copyright (c) 2002 The Apache Software Foundation.  All rights
  * reserved.
  *
  * Redistribution and use in source and binary forms, with or without
@@ -53,29 +53,36 @@
  * <http://www.apache.org/>.
  */
 package org.apache.jmeter.threads.gui;
-import java.awt.*;
-import java.awt.event.*;
-import java.util.*;
-import javax.swing.*;
-import javax.swing.border.*;
-import javax.swing.table.*;
-import javax.swing.text.*;
+import java.awt.Font;
+import java.util.Collection;
+
+import javax.swing.BorderFactory;
+import javax.swing.JLabel;
+import javax.swing.JPanel;
+import javax.swing.JPopupMenu;
+import javax.swing.JTextField;
+import javax.swing.border.Border;
+import javax.swing.border.CompoundBorder;
+import javax.swing.border.EmptyBorder;
+
 import org.apache.jmeter.control.LoopController;
 import org.apache.jmeter.control.gui.LoopControlPanel;
-import org.apache.jmeter.gui.*;
+import org.apache.jmeter.gui.JMeterGUIComponent;
+import org.apache.jmeter.gui.NamePanel;
+import org.apache.jmeter.gui.tree.JMeterTreeNode;
 import org.apache.jmeter.gui.util.FocusRequester;
 import org.apache.jmeter.gui.util.MenuFactory;
-import org.apache.jmeter.gui.util.VerticalLayout;
 import org.apache.jmeter.gui.util.NumberFieldErrorListener;
 import org.apache.jmeter.testelement.TestElement;
 import org.apache.jmeter.threads.ThreadGroup;
 import org.apache.jmeter.util.JMeterUtils;
+import org.apache.jorphan.gui.layout.VerticalLayout;
 
 /****************************************
  * Title: JMeter Description: Copyright: Copyright (c) 2000 Company: Apache
  *
  *@author    Michael Stover
- *@created   $Date: 2002/08/11 19:24:49 $
+ *@created   $Date: 2002/12/31 18:05:54 $
  *@version   1.0
  ***************************************/
 
@@ -187,7 +194,7 @@ public class ThreadGroupGui extends JPanel implements JMeterGUIComponent
 		loopPanel = new LoopControlPanel(false);
 		LoopController looper= (LoopController)loopPanel.createTestElement();
 		looper.setLoops(-1);
-		loopPanel.configure(looper);		
+		loopPanel.configure(looper);
 		return loopPanel;
 	}
 
@@ -259,4 +266,10 @@ public class ThreadGroupGui extends JPanel implements JMeterGUIComponent
 
 		this.add(mainPanel);
 	}
+
+
+    public void setNode(JMeterTreeNode node)
+    {
+        namePanel.setNode(node);
+    }
 }
diff --git a/jakarta-jmeter/src/core/org/apache/jmeter/timers/CVS/Entries b/jakarta-jmeter/src/core/org/apache/jmeter/timers/CVS/Entries
index 07c7879..02b166e 100644
--- a/jakarta-jmeter/src/core/org/apache/jmeter/timers/CVS/Entries
+++ b/jakarta-jmeter/src/core/org/apache/jmeter/timers/CVS/Entries
@@ -1,2 +1,2 @@
-/Timer.java/1.1/Sun Aug 11 19:24:49 2002//Tv1_7_3
+/Timer.java/1.2/Fri Jan 10 13:59:50 2003//Tv1_8_1
 D/gui////
diff --git a/jakarta-jmeter/src/core/org/apache/jmeter/timers/CVS/Tag b/jakarta-jmeter/src/core/org/apache/jmeter/timers/CVS/Tag
index 5f312fe..e2fda28 100644
--- a/jakarta-jmeter/src/core/org/apache/jmeter/timers/CVS/Tag
+++ b/jakarta-jmeter/src/core/org/apache/jmeter/timers/CVS/Tag
@@ -1 +1 @@
-Nv1_7_3
+Nv1_8_1
diff --git a/jakarta-jmeter/src/core/org/apache/jmeter/timers/Timer.java b/jakarta-jmeter/src/core/org/apache/jmeter/timers/Timer.java
index cd76bfa..53a6015 100644
--- a/jakarta-jmeter/src/core/org/apache/jmeter/timers/Timer.java
+++ b/jakarta-jmeter/src/core/org/apache/jmeter/timers/Timer.java
@@ -1,155 +1,107 @@
 /*
-
  * ====================================================================
-
  * The Apache Software License, Version 1.1
-
  *
-
  * Copyright (c) 2001 The Apache Software Foundation.  All rights
-
  * reserved.
-
  *
-
  * Redistribution and use in source and binary forms, with or without
-
  * modification, are permitted provided that the following conditions
-
  * are met:
-
  *
-
  * 1. Redistributions of source code must retain the above copyright
-
  * notice, this list of conditions and the following disclaimer.
-
  *
-
  * 2. Redistributions in binary form must reproduce the above copyright
-
  * notice, this list of conditions and the following disclaimer in
-
  * the documentation and/or other materials provided with the
-
  * distribution.
-
  *
-
  * 3. The end-user documentation included with the redistribution,
-
  * if any, must include the following acknowledgment:
-
  * "This product includes software developed by the
-
  * Apache Software Foundation (http://www.apache.org/)."
-
  * Alternately, this acknowledgment may appear in the software itself,
-
  * if and wherever such third-party acknowledgments normally appear.
-
  *
-
  * 4. The names "Apache" and "Apache Software Foundation" and
-
  * "Apache JMeter" must not be used to endorse or promote products
-
  * derived from this software without prior written permission. For
-
  * written permission, please contact apache@apache.org.
-
  *
-
  * 5. Products derived from this software may not be called "Apache",
-
  * "Apache JMeter", nor may "Apache" appear in their name, without
-
  * prior written permission of the Apache Software Foundation.
-
  *
-
  * THIS SOFTWARE IS PROVIDED ``AS IS'' AND ANY EXPRESSED OR IMPLIED
-
  * WARRANTIES, INCLUDING, BUT NOT LIMITED TO, THE IMPLIED WARRANTIES
-
  * OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE ARE
-
  * DISCLAIMED.  IN NO EVENT SHALL THE APACHE SOFTWARE FOUNDATION OR
-
  * ITS CONTRIBUTORS BE LIABLE FOR ANY DIRECT, INDIRECT, INCIDENTAL,
-
  * SPECIAL, EXEMPLARY, OR CONSEQUENTIAL DAMAGES (INCLUDING, BUT NOT
-
  * LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES; LOSS OF
-
  * USE, DATA, OR PROFITS; OR BUSINESS INTERRUPTION) HOWEVER CAUSED AND
-
  * ON ANY THEORY OF LIABILITY, WHETHER IN CONTRACT, STRICT LIABILITY,
-
  * OR TORT (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT
-
  * OF THE USE OF THIS SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF
-
  * SUCH DAMAGE.
-
  * ====================================================================
-
  *
-
  * This software consists of voluntary contributions made by many
-
  * individuals on behalf of the Apache Software Foundation.  For more
-
  * information on the Apache Software Foundation, please see
-
  * <http://www.apache.org/>.
-
  */
 
-
-
 package org.apache.jmeter.timers;
 
-
-
-
-
-
+import java.io.Serializable;
 
 /**
-
  * This interface defines those methods that must be implemented
-
  * by timer plugins.
-
  *
-
- * @author  <a href="mailto:stefano@apache.org">Stefano Mazzocchi</a>
-
- * @version $Revision: 1.1 $ $Date: 2002/08/11 19:24:49 $
-
+ * @author <a href="mailto:stefano@apache.org">Stefano Mazzocchi</a>
+ * @author <a href="mailto:seade@backstagetech.com.au">Scott Eade</a>
+ * @version $Id: Timer.java,v 1.2 2003/01/10 13:59:50 seade Exp $
  */
+public interface Timer extends Serializable 
+{
+    /**
+     * This method is called after a sampling process is done to know how much
+     * time the sampling thread has to wait until sampling again.
+     * 
+     * @return the computed delay value.
+     */
+    public long delay();
+
+	/**
+	 * Set the range value.
+	 * 
+	 * @param range
+	 */
+    public void setRange(double range);
+
+    /**
+     * Get the range value.
+     * 
+     * @return double
+     */
+    public double getRange();
+
+	/**
+	 * Set the delay value.
+	 * 
+	 * @param delay the delay value (this is a String as it can be set using a
+	 * variable).
+	 */
+    public void setDelay(String delay);
+
+    /**
+     * Get the delay value for display. 
+     * 
+     * @return String
+     */
+    public String getDelay();
 
-public interface Timer extends java.io.Serializable {
-
-
-
-	 /**
-
-	  * This method is called after a sampling process is done
-
-	  * to know how much time the sampling thread has to wait
-
-	  * until sampling again.
-
-	  */
-
-	 public long delay();
-
-	 public void setRange(double range);
-	 public double getRange();
-
-	 public void setDelay(long delay);
-	 public long getDelay();
 }
-
diff --git a/jakarta-jmeter/src/core/org/apache/jmeter/timers/gui/AbstractTimerGui.java b/jakarta-jmeter/src/core/org/apache/jmeter/timers/gui/AbstractTimerGui.java
index 996db1a..ae6bba4 100644
--- a/jakarta-jmeter/src/core/org/apache/jmeter/timers/gui/AbstractTimerGui.java
+++ b/jakarta-jmeter/src/core/org/apache/jmeter/timers/gui/AbstractTimerGui.java
@@ -5,29 +5,26 @@ import java.util.Collection;
 
 import javax.swing.JPopupMenu;
 import org.apache.jmeter.gui.AbstractJMeterGuiComponent;
-import org.apache.jmeter.gui.NamePanel;
 import org.apache.jmeter.gui.util.MenuFactory;
-import org.apache.jmeter.testelement.TestElement;
 
 /**
  * Title:        JMeter
  * Description:
- * Copyright:    Copyright (c) 2000
+ * Copyright:    Copyright (c) 2003
  * Company:      Apache
  * @author Michael Stover
  * @version 1.0
  */
-
 public abstract class AbstractTimerGui extends AbstractJMeterGuiComponent
 {
+    public JPopupMenu createPopupMenu()
+    {
+        return MenuFactory.getDefaultTimerMenu();
+    }
 
-  public JPopupMenu createPopupMenu()
-  {
-	 return MenuFactory.getDefaultTimerMenu();
-  }
-
-  public Collection getMenuCategories()
-  {
-	 return Arrays.asList(new String[]{MenuFactory.TIMERS});
-  }
+    public Collection getMenuCategories()
+    {
+        return Arrays.asList(new String[]{MenuFactory.TIMERS});
+    }
+    
 }
\ No newline at end of file
diff --git a/jakarta-jmeter/src/core/org/apache/jmeter/timers/gui/CVS/Entries b/jakarta-jmeter/src/core/org/apache/jmeter/timers/gui/CVS/Entries
index b899725..dc264ce 100644
--- a/jakarta-jmeter/src/core/org/apache/jmeter/timers/gui/CVS/Entries
+++ b/jakarta-jmeter/src/core/org/apache/jmeter/timers/gui/CVS/Entries
@@ -1,2 +1,2 @@
-/AbstractTimerGui.java/1.1/Sun Aug 11 19:24:49 2002//Tv1_7_3
+/AbstractTimerGui.java/1.2/Fri Jan 10 13:59:51 2003//Tv1_8_1
 D
diff --git a/jakarta-jmeter/src/core/org/apache/jmeter/timers/gui/CVS/Tag b/jakarta-jmeter/src/core/org/apache/jmeter/timers/gui/CVS/Tag
index 5f312fe..e2fda28 100644
--- a/jakarta-jmeter/src/core/org/apache/jmeter/timers/gui/CVS/Tag
+++ b/jakarta-jmeter/src/core/org/apache/jmeter/timers/gui/CVS/Tag
@@ -1 +1 @@
-Nv1_7_3
+Nv1_8_1
diff --git a/jakarta-jmeter/src/core/org/apache/jmeter/util/CVS/Entries b/jakarta-jmeter/src/core/org/apache/jmeter/util/CVS/Entries
index a2b5c62..027b391 100644
--- a/jakarta-jmeter/src/core/org/apache/jmeter/util/CVS/Entries
+++ b/jakarta-jmeter/src/core/org/apache/jmeter/util/CVS/Entries
@@ -1,14 +1,9 @@
-/ClassFinder.java/1.2/Sun Aug 11 23:19:53 2002//Tv1_7_3
-/ColorHelper.java/1.1/Sun Aug 11 19:24:49 2002//Tv1_7_3
-/Data.java/1.1/Sun Aug 11 19:24:49 2002//Tv1_7_3
-/HashTree.java/1.1/Sun Aug 11 19:24:49 2002//Tv1_7_3
-/JMeterUtils.java/1.2/Sun Aug 11 23:19:53 2002//Tv1_7_3
-/JsseSSLManager.java/1.1/Sun Aug 11 19:24:49 2002//Tv1_7_3
-/ListedHashTree.java/1.1/Sun Aug 11 19:24:49 2002//Tv1_7_3
-/ListedHashTreeVisitor.java/1.1/Sun Aug 11 19:24:49 2002//Tv1_7_3
-/NamedObject.java/1.1/Sun Aug 11 19:24:49 2002//Tv1_7_3
-/SSLManager.java/1.1/Sun Aug 11 19:24:49 2002//Tv1_7_3
-/SearchByClass.java/1.1/Sun Aug 11 19:24:49 2002//Tv1_7_3
-/SortedHashTree.java/1.1/Sun Aug 11 19:24:49 2002//Tv1_7_3
-/TextFile.java/1.1/Sun Aug 11 19:24:49 2002//Tv1_7_3
+/ColorHelper.java/1.1/Sun Aug 11 19:24:49 2002//Tv1_8_1
+/JMeterUtils.java/1.15/Thu Jan 30 00:35:46 2003//Tv1_8_1
+/JsseSSLManager.java/1.4/Tue Sep 17 19:32:52 2002//Tv1_8_1
+/LocaleChangeEvent.java/1.1/Mon Dec 30 05:08:29 2002//Tv1_8_1
+/LocaleChangeListener.java/1.1/Mon Dec 30 05:08:29 2002//Tv1_8_1
+/NamedObject.java/1.1/Sun Aug 11 19:24:49 2002//Tv1_8_1
+/SSLManager.java/1.5/Fri Dec 27 15:51:17 2002//Tv1_8_1
+/StringUtilities.java/1.1/Wed Aug 28 15:53:00 2002//Tv1_8_1
 D/keystore////
diff --git a/jakarta-jmeter/src/core/org/apache/jmeter/util/CVS/Tag b/jakarta-jmeter/src/core/org/apache/jmeter/util/CVS/Tag
index 5f312fe..e2fda28 100644
--- a/jakarta-jmeter/src/core/org/apache/jmeter/util/CVS/Tag
+++ b/jakarta-jmeter/src/core/org/apache/jmeter/util/CVS/Tag
@@ -1 +1 @@
-Nv1_7_3
+Nv1_8_1
diff --git a/jakarta-jmeter/src/core/org/apache/jmeter/util/HashTree.java b/jakarta-jmeter/src/core/org/apache/jmeter/util/HashTree.java
deleted file mode 100644
index aa03157..0000000
--- a/jakarta-jmeter/src/core/org/apache/jmeter/util/HashTree.java
+++ /dev/null
@@ -1,832 +0,0 @@
-/*
- * ====================================================================
- * The Apache Software License, Version 1.1
- *
- * Copyright (c) 2001 The Apache Software Foundation.  All rights
- * reserved.
- *
- * Redistribution and use in source and binary forms, with or without
- * modification, are permitted provided that the following conditions
- * are met:
- *
- * 1. Redistributions of source code must retain the above copyright
- * notice, this list of conditions and the following disclaimer.
- *
- * 2. Redistributions in binary form must reproduce the above copyright
- * notice, this list of conditions and the following disclaimer in
- * the documentation and/or other materials provided with the
- * distribution.
- *
- * 3. The end-user documentation included with the redistribution,
- * if any, must include the following acknowledgment:
- * "This product includes software developed by the
- * Apache Software Foundation (http://www.apache.org/)."
- * Alternately, this acknowledgment may appear in the software itself,
- * if and wherever such third-party acknowledgments normally appear.
- *
- * 4. The names "Apache" and "Apache Software Foundation" and
- * "Apache JMeter" must not be used to endorse or promote products
- * derived from this software without prior written permission. For
- * written permission, please contact apache@apache.org.
- *
- * 5. Products derived from this software may not be called "Apache",
- * "Apache JMeter", nor may "Apache" appear in their name, without
- * prior written permission of the Apache Software Foundation.
- *
- * THIS SOFTWARE IS PROVIDED ``AS IS'' AND ANY EXPRESSED OR IMPLIED
- * WARRANTIES, INCLUDING, BUT NOT LIMITED TO, THE IMPLIED WARRANTIES
- * OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE ARE
- * DISCLAIMED.  IN NO EVENT SHALL THE APACHE SOFTWARE FOUNDATION OR
- * ITS CONTRIBUTORS BE LIABLE FOR ANY DIRECT, INDIRECT, INCIDENTAL,
- * SPECIAL, EXEMPLARY, OR CONSEQUENTIAL DAMAGES (INCLUDING, BUT NOT
- * LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES; LOSS OF
- * USE, DATA, OR PROFITS; OR BUSINESS INTERRUPTION) HOWEVER CAUSED AND
- * ON ANY THEORY OF LIABILITY, WHETHER IN CONTRACT, STRICT LIABILITY,
- * OR TORT (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT
- * OF THE USE OF THIS SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF
- * SUCH DAMAGE.
- * ====================================================================
- *
- * This software consists of voluntary contributions made by many
- * individuals on behalf of the Apache Software Foundation.  For more
- * information on the Apache Software Foundation, please see
- * <http://www.apache.org/>.
- */
-
-
-
-package org.apache.jmeter.util;
-
-import java.io.*;
-import java.util.*;
-
-/**********************************************************************
-This class is used to create a tree structure of objects.  Each element in the tree
-is also a key to the next node down in the tree.
-***********************************************************************/
-public class HashTree implements Serializable
-{
-
-  public HashTree()
-  {
-	 data = new HashMap();
-  }
-
-  public HashTree(Object key)
-  {
-	 data = new HashMap();
-	 data.put(key,new HashTree());
-  }
-
-  public HashTree(Collection keys)
-  {
-	 data = new HashMap();
-	 Iterator it = keys.iterator();
-	 while(it.hasNext())
-		data.put(it.next(),new HashTree());
-  }
-
-  public HashTree(Object[] keys)
-  {
-	 data = new HashMap();
-	 for(int x = 0;x < keys.length;x++)
-		data.put(keys[x],new HashTree());
-  }
-
-/************************************************************
-  If the HashTree contains the given object as a key at the top level, then a
-  true result is returned, otherwise false.
-@param obj Object to be tested as a key.
-@return True if the HashTree contains the key, false otherwise.
-***************************************************************/
-  public boolean containsKey(Object o)
-  {
-	 return data.containsKey(o);
-  }
-
-/*****************************************************************
-  If the HashTree is empty, true is returned, false otherwise.
-@return True if HashTree is empty, false otherwise.
-***************************************************************/
-  public boolean isEmpty()
-  {
-	 return data.isEmpty();
-  }
-
-/************************************************************************
-  Sets a key and it's value in the HashTree.  It actually sets up a key, and then
-  creates a node for the key and adds the value to the new node, as a key.
-@param key Key to be set up.
-@param value Value to be set up as a key in the secondary node.
-*************************************************************************/
-  public void set(Object key,Object value)
-  {
-	 data.put(key,new HashTree(value));
-  }
-
-/********************************************************************
- Sets a key and it's values in the HashTree.  It sets up a key in the current node, and
- then creates a node for that key, and adds all the values in the array as keys in
- the new node.
-@param key Key to be set up.
-@param tree HashTree that the key maps to.
-**************************************************************************/
-  public void set(Object key,HashTree t)
-  {
-	 data.put(key,t);
-  }
-
-/************************************************************************
-Sets a key and it's values in the HashTree.  It sets up a key in the current node, and
-then creates a node for that key, and adds all the values in the array as keys in
- the new node.
-@param key Key to be set up.
-@param values Array of objects to be added as keys in the secondary node.
-********************************************************************/
-  public void set(Object key,Object[] values)
-  {
-	 data.put(key,new HashTree(values));
-  }
-
-/********************************************************************
- Sets a key and it's values in the HashTree.  It sets up a key in the current node, and
- then creates a node for that key, and adds all the values in the array as keys in
- the new node.
-@param key Key to be set up.
-@param values Collection of objects to be added as keys in the secondary node.
-**************************************************************************/
-  public void set(Object key,Collection values)
-  {
-	 data.put(key,new HashTree(values));
-  }
-
-/********************************************************************
-  Sets a series of keys into the HashTree.  It sets up the first object in the
-  key array as a key in the current node, recurses into the next HashTree node through
-  that key and adds the second object in the array.  Continues recursing in this
-  manner until the end of the first array is reached, at which point all the
-  values of the second array are added as keys to the bottom-most node.
-@param key Array of keys to put into HashTree.
-@param values Array of values to be added as keys to bottom-most node.
-********************************************************************/
-  public void set(Object[] key,Object[] values)
-  {
-	 List keys = new LinkedList();
-	 for(int x = 0;x < key.length;keys.add(key[x++]));
-	 set(keys,values);
-  }
-
-/********************************************************************
-  Sets a series of keys into the HashTree.  It sets up the first object in the
-  key array as a key in the current node, recurses into the next HashTree node through
-  that key and adds the second object in the array.  Continues recursing in this
-  manner until the end of the first array is reached, at which point all the
-  values of the Collection of values are added as keys to the bottom-most node.
-@param key Array of keys to put into HashTree.
-@param values Collection of values to be added as keys to bottom-most node.
-********************************************************************/
-  public void set(Object[] key,Collection values)
-  {
-	 List keys = new LinkedList();
-	 for(int x = 0;x < key.length;keys.add(key[x++]));
-	 set(keys,values);
-  }
-
-/********************************************************************
-  Sets a series of keys into the HashTree.  It sets up the first object in the
-  key list as a key in the current node, recurses into the next HashTree node through
-  that key and adds the second object in the list.  Continues recursing in this
-  manner until the end of the first list is reached, at which point all the
-  values of the array of values are added as keys to the bottom-most node.
-@param key List of keys to put into HashTree.
-@param values Array of values to be added as keys to bottom-most node.
-********************************************************************/
-  public void set(List key,Object[] values)
-  {
-	 if(key.size() == 0)
-		return;
-	 else if(key.size() == 1)
-		set(key.get(0),values);
-	 else
-	 {
-		Object temp = key.remove(0);
-		add(temp,key.get(0));
-		get(temp).set(key,values);
-	 }
-  }
-
-/********************************************************************
-  Sets a series of keys into the HashTree.  It sets up the first object in the
-  key list as a key in the current node, recurses into the next HashTree node through
-  that key and adds the second object in the list.  Continues recursing in this
-  manner until the end of the first list is reached, at which point all the
-  values of the Collection of values are added as keys to the bottom-most node.
-@param key List of keys to put into HashTree.
-@param values Collection of values to be added as keys to bottom-most node.
-********************************************************************/
-  public void set(List key,Collection values)
-  {
-	 if(key.size() == 0)
-		return;
-	 else if(key.size() == 1)
-		set(key.get(0),values);
-	 else
-	 {
-		Object temp = key.remove(0);
-		add(temp,key.get(0));
-		get(temp).set(key,values);
-	 }
-  }
-
-/********************************************************************
-  Sets a series of keys into the HashTree.  It sets up the first object in the
-  key SortedSet as a key in the current node, recurses into the next HashTree node through
-  that key and adds the second object in the SortedSet.  Continues recursing in this
-  manner until the end of the first SortedSet is reached, at which point all the
-  values of the array of values are added as keys to the bottom-most node.
-@param key SortedSet of keys to put into HashTree.
-@param values Array of values to be added as keys to bottom-most node.
-********************************************************************/
-  public void set(SortedSet key,Object[] values)
-  {
-	 Object temp;
-	 if(key.size() == 0)
-		return;
-	 else if(key.size() == 1)
-		set(key.first(),values);
-	 else
-	 {
-		temp = key.first();
-		key.remove(temp);
-		add(temp,key.first());
-		get(temp).set(key,values);
-	 }
-  }
-
-/********************************************************************
-  Sets a series of keys into the HashTree.  It sets up the first object in the
-  key SortedSet as a key in the current node, recurses into the next HashTree node through
-  that key and adds the second object in the SortedSet.  Continues recursing in this
-  manner until the end of the first SortedSet is reached, at which point all the
-  values of the Collection of values are added as keys to the bottom-most node.
-@param key SortedSet of keys to put into HashTree.
-@param values Collection of values to be added as keys to bottom-most node.
-********************************************************************/
-  public void set(SortedSet key,Collection values)
-  {
-	 Object temp;
-	 if(key.size() == 0)
-		return;
-	 else if(key.size() == 1)
-		set(key.first(),values);
-	 else
-	 {
-		temp = key.first();
-		key.remove(temp);
-		add(temp,key.first());
-		get(temp).set(key,values);
-	 }
-  }
-
-/*********************************************************************
-Adds an key into the HashTree at the current level.
-@param key Key to be added to HashTree.
-*****************************************************************/
-  public void add(Object key)
-  {
-	 if(!data.containsKey(key))
-		data.put(key,new HashTree());
-  }
-
-/*******************************************************************
-Adds a bunch of keys into the HashTree at the current level.
-@param keys Array of Keys to be added to HashTree.
-*******************************************************************/
-  public void add(Object[] keys)
-  {
-	 for(int x = 0;x < keys.length;x++)
-		add(keys[x]);
-  }
-
-/*******************************************************************
-Adds a bunch of keys into the HashTree at the current level.
-@param keys Collection of Keys to be added to HashTree.
-*******************************************************************/
-  public void add(Collection keys)
-  {
-	 Iterator it = keys.iterator();
-	 while(it.hasNext())
-		add(it.next());
-  }
-
-/************************************************************************
-  Adds a key and it's value in the HashTree.  It actually adds  a key, and then
-  creates a node for the key and adds the value to the new node, as a key.
-@param key Key to be added.
-@param value Value to be added as a key in the secondary node.
-*************************************************************************/
-  public void add(Object key,Object value)
-  {
-	 if(!data.containsKey(key))
-		set(key,value);
-	 else
-		get(key).add(value);
-  }
-
-/************************************************************************
-Adds a key and it's values in the HashTree.  It Adds a key in the current node, and
-then creates a node for that key, and adds all the values in the array as keys in
- the new node.
-@param key Key to be added.
-@param values Array of objects to be added as keys in the secondary node.
-********************************************************************/
-  public void add(Object key,Object[] values)
-  {
-	 if(!data.containsKey(key))
-		set(key,values);
-	 else
-		get(key).add(values);
-  }
-
-/************************************************************************
-Adds a key and it's values in the HashTree.  It adds a key in the current node, and
-then creates a node for that key, and adds all the values in the Collection as keys in
- the new node.
-@param key Key to be added.
-@param values Collection of objects to be added as keys in the secondary node.
-********************************************************************/
-  public void add(Object key,Collection values)
-  {
-	 if(!data.containsKey(key))
-		set(key,values);
-	 else
-		get(key).add(values);
-  }
-
-/********************************************************************
-  Adds a series of keys into the HashTree.  It sets up the first object in the
-  key array as a key in the current node, recurses into the next HashTree node through
-  that key and adds the second object in the array.  Continues recursing in this
-  manner until the end of the first array is reached, at which point all the
-  values of the second array are added as keys to the bottom-most node.
-@param key Array of keys to put into HashTree.
-@param values Array of values to be added as keys to bottom-most node.
-********************************************************************/
-  public void add(Object[] key,Object[] values)
-  {
-	 List list = new LinkedList();
-	 for(int x = 0;x < key.length;list.add(key[x++]));
-	 add(list,values);
-  }
-
-/********************************************************************
-  Adds a series of keys into the HashTree.  It sets up the first object in the
-  key array as a key in the current node, recurses into the next HashTree node through
-  that key and adds the second object in the array.  Continues recursing in this
-  manner until the end of the first array is reached, at which point all the
-  values of the second Collection are added as keys to the bottom-most node.
-@param key Array of keys to put into HashTree.
-@param values Collection of values to be added as keys to bottom-most node.
-********************************************************************/
-  public void add(Object[] key,Collection values)
-  {
-	 List list = new LinkedList();
-	 for(int x = 0;x < key.length;list.add(key[x++]));
-	 add(list,values);
-  }
-
-/********************************************************************
-  Adds a series of keys into the HashTree.  It sets up the first object in the
-  key List as a key in the current node, recurses into the next HashTree node through
-  that key and adds the second object in the List.  Continues recursing in this
-  manner until the end of the first List is reached, at which point all the
-  values of the second Array are added as keys to the bottom-most node.
-@param key List of keys to put into HashTree.
-@param values Array of values to be added as keys to bottom-most node.
-********************************************************************/
-  public void add(List key,Object[] values)
-  {
-	 if(key == null || key.size() == 0)
-	 {
-		add(values);
-		return;
-	 }
-	 else if(key.size() == 1)
-		add(key.get(0),values);
-	 else
-	 {
-		Object temp = key.remove(0);
-		add(temp,key.get(0));
-		get(temp).add(key,values);
-	 }
-  }
-
-	 /********************************************************************
-  Adds a series of keys into the SortedHashTree.  It sets up the first object in the
-  key List as a key in the current node, recurses into the next SortedHashTree node through
-  that key and adds the second object in the List.  Continues recursing in this
-  manner until the end of the first List is reached, at which point all the
-  values of the second Collection are added as keys to the bottom-most node.
-@param key List of keys to put into SortedHashTree.
-@param values Collection of values to be added as keys to bottom-most node.
-********************************************************************/
-  public void add(List key,Object value)
-  {
-	 if(key == null || key.size() == 0)
-	 {
-		add(value);
-		return;
-	 }
-	 else if(key.size() == 1)
-		  add(key.get(0),value);
-	 else
-	 {
-		Object temp = key.remove(0);
-		add(temp,key.get(0));
-		get(temp).add(key,value);
-	 }
-  }
-
-/********************************************************************
-  Adds a series of keys into the HashTree.  It sets up the first object in the
-  key List as a key in the current node, recurses into the next HashTree node through
-  that key and adds the second object in the List.  Continues recursing in this
-  manner until the end of the first List is reached, at which point all the
-  values of the second Collection are added as keys to the bottom-most node.
-@param key List of keys to put into HashTree.
-@param values Collection of values to be added as keys to bottom-most node.
-********************************************************************/
-  public void add(List key,Collection values)
-  {
-	 if(key == null || key.size() == 0)
-	 {
-		add(values);
-		return;
-	 }
-	 else if(key.size() == 1)
-		add(key.get(0),values);
-	 else
-	 {
-		Object temp = key.remove(0);
-		add(temp,key.get(0));
-		get(temp).add(key,values);
-	 }
-  }
-
-/********************************************************************
-  Adds a series of keys into the HashTree.  It sets up the first object in the
-  key SortedSet as a key in the current node, recurses into the next HashTree node through
-  that key and adds the second object in the SortedSet.  Continues recursing in this
-  manner until the end of the first SortedSet is reached, at which point all the
-  values of the second Array are added as keys to the bottom-most node.
-@param key SortedSet of keys to put into HashTree.
-@param values Array of values to be added as keys to bottom-most node.
-********************************************************************/
-  public void add(SortedSet key,Object[] values)
-  {
-	 if(key.size() == 0)
-		return;
-	 else if(key.size() == 1)
-		add(key.first(),values);
-	 else
-	 {
-		Object temp = key.first();
-		key.remove(temp);
-		add(temp,key.first());
-		get(temp).add(key,values);
-	 }
-  }
-
-/********************************************************************
-  Adds a series of keys into the HashTree.  It sets up the first object in the
-  key SortedSet as a key in the current node, recurses into the next HashTree node through
-  that key and adds the second object in the SortedSet.  Continues recursing in this
-  manner until the end of the first SortedSet is reached, at which point all the
-  values of the second Collection are added as keys to the bottom-most node.
-@param key SortedSet of keys to put into HashTree.
-@param values Collection of values to be added as keys to bottom-most node.
-********************************************************************/
-  public void add(SortedSet key,Collection values)
-  {
-	 if(key.size() == 0)
-		return;
-	 else if(key.size() == 1)
-		add(key.first(),values);
-	 else
-	 {
-		Object temp = key.first();
-		key.remove(temp);
-		add(temp,key.first());
-		get(temp).add(key,values);
-	 }
-  }
-
-/*********************************************************************
-Gets the HashTree object mapped to the given key.
-@param key Key used to find appropriate HashTree()
-********************************************************************/
-  public HashTree get(Object key)
-  {
-	 return (HashTree)data.get(key);
-  }
-
-/*************************************************************
-Gets the HashTree object mapped to the last key in the array by recursing through
-the HashTree structure one key at a time.
-@param keys Array of keys.
-@return HashTree at the end of the recursion.
-**************************************************************/
-  public HashTree get(Object[] keys)
-  {
-	 List list = new LinkedList();
-	 for(int x = 0;x < keys.length;list.add(keys[x++]));
-	 return get(list);
-  }
-
-/*************************************************************
-Gets the HashTree object mapped to the last key in the List by recursing through
-the HashTree structure one key at a time.
-@param keys List of keys.
-@return HashTree at the end of the recursion.
-**************************************************************/
-  public HashTree get(List keys)
-  {
-	 if(keys.size() == 1)
-		return get(keys.get(0));
-	 else if(keys.size() > 1)
-	 {
-		Object temp = keys.remove(0);
-		return get(temp).get(keys);
-	 }
-	 return new HashTree();
-  }
-
-/*************************************************************
-Gets the HashTree object mapped to the last key in the SortedSet by recursing through
-the HashTree structure one key at a time.
-@param keys SortedSet of keys.
-@return HashTree at the end of the recursion.
-**************************************************************/
-  public HashTree get(SortedSet keys)
-  {
-	 if(keys.size() == 1)
-		return get(keys.first());
-	 else if(keys.size() > 1)
-	 {
-		Object temp = keys.first();
-		keys.remove(temp);
-		return get(temp).get(keys);
-	 }
-	 return new HashTree();
-  }
-
-/****************************************************************
-Gets a Set of all keys in the current HashTree node.
-@return Set of all keys in this HashTree.
-*****************************************************************/
-  public Set list()
-  {
-	 return data.keySet();
-  }
-
-/***************************************************************
-  Gets a Set of all keys in the HashTree mapped to the given key of the
-  current HashTree object (in other words, one level down.
-@param key Key used to find HashTree to get list of.
-@return Set of all keys in found HashTree.
-***************************************************************/
-  public Set list(Object key)
-  {
-	 HashTree temp = (HashTree)data.get(key);
-	 if(temp != null)
-		return temp.list();
-	 else
-		return null;
-  }
-
-  public void remove(Object key)
-  {
-	 data.remove(key);
-  }
-
-/*************************************************************
-Recurses down into the HashTree stucture using each subsequent key in the
-array of keys, and returns the Set of keys of the HashTree object at the
-end of the recursion.
-@param keys Array of keys used to recurse into HashTree structure.
-@return Set of all keys found in end HashTree.
-**************************************************************/
-  public Set list(Object[] keys)
-  {
-	 List list = new LinkedList();
-	 for(int x = 0;x < keys.length;list.add(keys[x++]));
-	 return list(list);
-  }
-
-/*************************************************************
-Recurses down into the HashTree stucture using each subsequent key in the
-List of keys, and returns the Set of keys of the HashTree object at the
-end of the recursion.
-@param keys List of keys used to recurse into HashTree structure.
-@return Set of all keys found in end HashTree.
-**************************************************************/
-  public Set list(List keys)
-  {
-	 if(keys.size() == 0)
-		return list();
-	 else if(keys.size() == 1)
-		return get(keys.get(0)).list();
-	 else
-	 {
-		Object temp = keys.remove(0);
-		return get(temp).list(keys);
-	 }
-  }
-
-/*************************************************************
-Recurses down into the HashTree stucture using each subsequent key in the
-SortedSet of keys, and returns the Set of keys of the HashTree object at the
-end of the recursion.
-@param keys SortedSet of keys used to recurse into HashTree structure.
-@return Set of all keys found in end HashTree.
-**************************************************************/
-  public Set list(SortedSet keys)
-  {
-	 if(keys.size() == 0)
-		return list();
-	 else if(keys.size() == 1)
-		return get(keys.first()).list();
-	 else
-	 {
-		Object temp = keys.first();
-		keys.remove(temp);
-		return get(temp).list(keys);
-	 }
-  }
-
-/****************************************************************
-Gets an array of all keys in the current HashTree node.
-@return Array of all keys in this HashTree.
-*****************************************************************/
-  public Object[] getArray()
-  {
-	 return data.keySet().toArray();
-  }
-
-/***************************************************************
-  Gets an array of all keys in the HashTree mapped to the given key of the
-  current HashTree object (in other words, one level down.
-@param key Key used to find HashTree to get list of.
-@return Array of all keys in found HashTree.
-***************************************************************/
-  public Object[] getArray(Object key)
-  {
-	 return get(key).getArray();
-  }
-
-/*************************************************************
-Recurses down into the HashTree stucture using each subsequent key in the
-array of keys, and returns an array of keys of the HashTree object at the
-end of the recursion.
-@param keys Array of keys used to recurse into HashTree structure.
-@return Array of all keys found in end HashTree.
-**************************************************************/
-  public Object[] getArray(Object[] keys)
-  {
-	 List list = new LinkedList();
-	 for(int x = 0;x < keys.length;list.add(keys[x++]));
-	 return getArray(list);
-  }
-
-/*************************************************************
-Recurses down into the HashTree stucture using each subsequent key in the
-List of keys, and returns an array of keys of the HashTree object at the
-end of the recursion.
-@param keys List of keys used to recurse into HashTree structure.
-@return Array of all keys found in end HashTree.
-**************************************************************/
-  public Object[] getArray(List keys)
-  {
-	 if(keys.size() == 0)
-		return getArray();
-	 if(keys.size() == 1)
-		return getArray(keys.get(0));
-	 else
-	 {
-		Object temp = keys.remove(0);
-		return get(temp).getArray(keys);
-	 }
-  }
-
-/*************************************************************
-Recurses down into the HashTree stucture using each subsequent key in the
-SortedSet of keys, and returns an array of keys of the HashTree object at the
-end of the recursion.
-@param keys SortedSet of keys used to recurse into HashTree structure.
-@return Array of all keys found in end HashTree.
-**************************************************************/
-  public Object[] getArray(SortedSet keys)
-  {
-	 if(keys.size() == 0)
-		return getArray();
-	 if(keys.size() == 1)
-		return getArray(keys.first());
-	 else
-	 {
-		Object temp = keys.first();
-		keys.remove(temp);
-		return get(temp).getArray(keys);
-	 }
-  }
-
-  public int hashCode()
-  {
-	 return data.hashCode()*7;
-  }
-
-  public boolean equals(Object o)
-  {
-	 boolean flag = true;
-	 if(o instanceof HashTree)
-	 {
-		HashTree oo = (HashTree)o;
-		Iterator it = data.keySet().iterator();
-		while(it.hasNext())
-		{
-		  if(!oo.containsKey(it.next()))
-		  {
-			 flag = false;
-			 break;
-		  }
-		}
-		if(flag)
-		{
-		  it = data.keySet().iterator();
-		  while(it.hasNext())
-		  {
-			 Object temp = it.next();
-			 flag = get(temp).equals(oo.get(temp));
-			 if(!flag)
-				break;
-		  }
-		}
-	 }
-	 else
-		flag = false;
-	 return flag;
-  }
-
-  public Set keySet()
-  {
-	 return data.keySet();
-  }
-
-/*****************************************************
-Searches the HashTree structure for the given key.  If it finds the key,
-it returns the HashTree mapped to the key.  If it finds nothing, it returns
-null.
-@param key Key to search for.
-@return HashTree mapped to key, if found, otherwise <B>null</B>.
-**********************************************************/
-  public HashTree search(Object key)
-  {
-	 HashTree temp = null;
-	 if(data.containsKey(key))
-		temp = (HashTree)data.get(key);
-	 else
-	 {
-		Iterator it = list().iterator();
-		while(it.hasNext())
-		{
-		  if(temp == null)
-		  {
-			 temp = ((HashTree)it.next()).search(key);
-			 break;
-		  }
-		  else
-			 break;
-		}
-	 }
-	 return temp;
-  }
-
-
-
-
-  void readObject(ObjectInputStream ois) throws ClassNotFoundException, IOException
-  {
-	 ois.defaultReadObject();
-  }
-
-  void writeObject(ObjectOutputStream oos) throws IOException
-  {
-	 oos.defaultWriteObject();
-  }
-
-  public int size()
-  {
-	 return data.size();
-  }
-
-  private java.util.Map data;
-}
diff --git a/jakarta-jmeter/src/core/org/apache/jmeter/util/JMeterUtils.java b/jakarta-jmeter/src/core/org/apache/jmeter/util/JMeterUtils.java
index 77c2950..d8a3414 100644
--- a/jakarta-jmeter/src/core/org/apache/jmeter/util/JMeterUtils.java
+++ b/jakarta-jmeter/src/core/org/apache/jmeter/util/JMeterUtils.java
@@ -2,7 +2,7 @@
  * ====================================================================
  * The Apache Software License, Version 1.1
  *
- * Copyright (c) 2001 The Apache Software Foundation.  All rights
+ * Copyright (c) 2001-2002 The Apache Software Foundation.  All rights
  * reserved.
  *
  * Redistribution and use in source and binary forms, with or without
@@ -52,11 +52,7 @@
  * information on the Apache Software Foundation, please see
  * <http://www.apache.org/>.
  */
-
-
-
 package org.apache.jmeter.util;
-
 import java.awt.Dimension;
 import java.awt.event.ActionListener;
 import java.io.BufferedReader;
@@ -66,147 +62,241 @@ import java.io.IOException;
 import java.io.InputStreamReader;
 import java.util.Enumeration;
 import java.util.Hashtable;
+import java.util.Locale;
 import java.util.MissingResourceException;
 import java.util.Properties;
 import java.util.ResourceBundle;
 import java.util.StringTokenizer;
 import java.util.Vector;
-
+import java.util.HashSet;
+import java.util.Collection;
+import java.util.Iterator;
 import javax.swing.ImageIcon;
 import javax.swing.JButton;
 import javax.swing.JComboBox;
 import javax.swing.JOptionPane;
 import javax.xml.parsers.SAXParserFactory;
 import org.apache.jmeter.gui.GuiPackage;
+import org.apache.log.Hierarchy;
+import org.apache.log.Logger;
+import org.apache.jorphan.logging.LoggingManager;
+import org.apache.jorphan.test.UnitTestManager;
 import org.xml.sax.XMLReader;
-
-
 /**
  *  This class contains the static utility methods used by JMeter.
  *
  *@author     <a href="mailto://stefano@apache.org">Stefano Mazzocchi</a>
  *@created    June 28, 2001
- *@version    $Revision: 1.2 $ $Date: 2002/08/11 23:19:53 $
+ *@version    $Revision: 1.15 $ $Date: 2003/01/30 00:35:46 $
  */
-
-public class JMeterUtils
+public class JMeterUtils implements UnitTestManager
 {
-
-	 private static final SAXParserFactory xmlFactory;
-
-	 static {
-		  SAXParserFactory temp = null;
-		  try {
-				temp = SAXParserFactory.newInstance();
-		  } catch(Exception e) {
-		  e.printStackTrace();
-				temp = null;
-		  }
-
-		  xmlFactory = temp;
-	 }
-
-
-	 private static Properties appProperties;
-	 public static ResourceBundle RESOURCES = ResourceBundle.getBundle("org.apache.jmeter.resources.messages");
-
-
-	 /**
-	  *  This method is used by the init method to load the property file that may
-	  *  even reside in the user space, or in the classpath under
-	  *  org.apache.jmeter.jmeter.properties
-	  *
-	  *@param  file  Description of Parameter
-	  *@return       The Properties value
-	  */
-	 public static Properties getProperties(String file)
-	 {
-		  Properties p = new Properties(System.getProperties());
-		  try
-		  {
-				File f = new File(file);
-				p.load(new FileInputStream(f));
-		  }
-		  catch (Exception e)
-		  {
-				try
-				{
-					 p.load(JMeterUtils.class.getClassLoader().getSystemResourceAsStream("org/apache/jmeter/jmeter.properties"));
-				}
-				catch (IOException ex)
-				{
-					 //JMeter.fail("Could not read internal resource. Archive is broken.");
-				}
-		  }
-		  appProperties = p;
-		  return p;
-	 }
-
-	 /**
-	  *  Gets the resource string for this key.
-	  *  @param key the key in the resource file
-	  *  @return the resource string if the key is found; otherwise, return an empty string
-	  */
-	 public static String getResString(String key)
-	 {
-		if(key == null)
+        private static final String VERSION="1.8.1";
+
+	transient private static Logger log =
+		Hierarchy.getDefaultHierarchy().getLoggerFor("jmeter.util");
+	private static LoggingManager logManager;
+	private static String LOG_FILE = "log_file";
+	private static String LOG_PRIORITY = "log_level";
+	private static final SAXParserFactory xmlFactory;
+	static {
+		SAXParserFactory temp = null;
+		try
+		{
+			temp = SAXParserFactory.newInstance();
+		}
+		catch (Exception e)
+		{
+			log.error("", e);
+			temp = null;
+		}
+		xmlFactory = temp;
+	}
+	private static Properties appProperties;
+	private static Collection localeChangeListeners = new HashSet();
+	private static Locale locale;
+	private static ResourceBundle resources;
+
+	/**
+	 *  This method is used by the init method to load the property file that may
+	 *  even reside in the user space, or in the classpath under
+	 *  org.apache.jmeter.jmeter.properties
+	 *
+	 *@param  file  Description of Parameter
+	 *@return       The Properties value
+	 */
+	public static Properties getProperties(String file)
+	{
+		Properties p = new Properties(System.getProperties());
+		try
+		{
+			File f = new File(file);
+			p.load(new FileInputStream(f));
+		}
+		catch (Exception e)
+		{
+			try
+			{
+				p.load(
+					JMeterUtils.class.getClassLoader().getSystemResourceAsStream(
+						"org/apache/jmeter/jmeter.properties"));
+			}
+			catch (IOException ex)
+			{
+				//JMeter.fail("Could not read internal resource. Archive is broken.");
+			}
+		}
+		appProperties = p;
+		LoggingManager.initializeLogging(appProperties);
+		log = LoggingManager.getLoggerFor(UTIL);
+		String loc= appProperties.getProperty("language");
+		if (loc!=null) setLocale(new Locale(loc, ""));
+		else setLocale(Locale.getDefault());
+		return p;
+	}
+	public void initializeProperties(String file)
+	{
+		System.out.println("Initializing Properties: " + file);
+		getProperties(file);
+		String home = file.substring(0,file.lastIndexOf("/"));
+		home = new File(home + "/..").getAbsolutePath();
+		System.out.println("Setting JMeter home: " + home);
+		setJMeterHome(home);
+	}
+	public static String[] getSearchPaths()
+	{
+		return new String[] { getJMeterHome() + "/lib/ext" };
+	}
+
+	/**
+	 * Changes the current locale: re-reads resource strings and notifies
+	 * listeners.
+	 *
+	 * @author Oliver Rossmueller
+	 * @param locale new locale
+	 */
+	public static void setLocale(Locale loc)
+	{
+	    locale= loc;
+	    resources = ResourceBundle.getBundle(
+		    "org.apache.jmeter.resources.messages", locale);
+	    notifyLocaleChangeListeners();
+	}
+
+	/**
+	 * Gets the current locale.
+	 *
+	 * @author Oliver Rossmueller
+	 * @return current locale
+	 */
+	public static Locale getLocale()
+	{
+	    return locale;
+	}
+
+	/**
+	 * @author Oliver Rossmueller
+	 */
+	public static void addLocaleChangeListener(
+		LocaleChangeListener listener)
+	{
+	    localeChangeListeners.add(listener);
+	}
+
+	/**
+	 * @author Oliver Rossmueller
+	 */
+	public static void removeLocaleChangeListener(
+		LocaleChangeListener listener)
+	{
+	    localeChangeListeners.remove(listener);
+	}
+
+	/**
+	 * Notify all listeners interested in locale changes.
+	 *
+	 * @author Oliver Rossmueller
+	 */
+	private static void notifyLocaleChangeListeners()
+	{
+	    LocaleChangeEvent event =
+		new LocaleChangeEvent(JMeterUtils.class, locale);
+	    Iterator iterator = localeChangeListeners.iterator();
+
+	    while (iterator.hasNext()) {
+		LocaleChangeListener listener =
+			(LocaleChangeListener)iterator.next();
+		listener.localeChanged(event);
+	    }
+	}
+
+	/**
+	 *  Gets the resource string for this key.
+	 *  @param key the key in the resource file
+	 *  @return the resource string if the key is found; otherwise, return an empty string
+	 */
+	public static String getResString(String key)
+	{
+		if (key == null)
 		{
 			return null;
 		}
-		key = key.replace(' ','_');
+		key = key.replace(' ', '_');
 		key = key.toLowerCase();
-		  String resString = null;
-		  try
-		  {
-				resString = RESOURCES.getString(key);
-		  }
-		  catch (MissingResourceException mre)
-		  {
-				System.out.println("ERROR! Resource string not found: [" + key + "]");
-				resString = "";
-		  }
-		  return resString;
-	 }
-
-	 /**
-	  *  This gets the currently defined appProperties. It can only be called after
-	  *  the getProperties(String file) method is called.
-	  *
-	  *@return    The JMeterProperties value
-	  */
-	 public static Properties getJMeterProperties()
-	 {
-		  return appProperties;
-	 }
-
-	 /**
-	  *  This looks for the requested image in the classpath under
-	  *  org.apache.jmeter.images. <name>
-	  *
-	  *@param  name  Description of Parameter
-	  *@return       The Image value
-	  */
-	 public static ImageIcon getImage(String name)
-	 {
-		  try
-		  {
-				return new ImageIcon(JMeterUtils.class.getClassLoader().getResource(
-								  "org/apache/jmeter/images/" + name.trim()));
-		  }
-		  catch(NullPointerException e)
-		  {
-				System.out.println(name);
-				return null;
-		  }
-	 }
-	 
-	 public static String getResourceFileAsText(String name)
-	 {
-	 	try {
+		String resString = null;
+		try
+		{
+			resString = resources.getString(key);
+		}
+		catch (MissingResourceException mre)
+		{
+			log.warn("ERROR! Resource string not found: [" + key + "]");
+			resString = "";
+		}
+		return resString;
+	}
+	/**
+	 *  This gets the currently defined appProperties. It can only be called after
+	 *  the getProperties(String file) method is called.
+	 *
+	 *@return    The JMeterProperties value
+	 */
+	public static Properties getJMeterProperties()
+	{
+		return appProperties;
+	}
+	/**
+	 *  This looks for the requested image in the classpath under
+	 *  org.apache.jmeter.images. <name>
+	 *
+	 *@param  name  Description of Parameter
+	 *@return       The Image value
+	 */
+	public static ImageIcon getImage(String name)
+	{
+		try
+		{
+			return new ImageIcon(
+				JMeterUtils.class.getClassLoader().getResource(
+					"org/apache/jmeter/images/" + name.trim()));
+		}
+		catch (NullPointerException e)
+		{
+			log.warn("no icon for " + name);
+			return null;
+		}
+	}
+	public static String getResourceFileAsText(String name)
+	{
+		try
+		{
 			String lineEnd = System.getProperty("line.separator");
-		 	BufferedReader fileReader = new BufferedReader(new InputStreamReader(JMeterUtils.class.getClassLoader().getResourceAsStream(name)));
-		 	StringBuffer text = new StringBuffer();
-		 	String line = "NOTNULL";
+			BufferedReader fileReader =
+				new BufferedReader(
+					new InputStreamReader(
+						JMeterUtils.class.getClassLoader().getResourceAsStream(name)));
+			StringBuffer text = new StringBuffer();
+			String line = "NOTNULL";
 			while (line != null)
 			{
 				line = fileReader.readLine();
@@ -217,782 +307,632 @@ public class JMeterUtils
 				}
 			}
 			return text.toString();
-		} catch(IOException e) {
+		}
+		catch (IOException e)
+		{
 			return "";
 		}
-	 }
-
-	 /**
-	  *  Creates the vector of Timers plugins.
-	  *
-	  *@param  properties  Description of Parameter
-	  *@return             The Timers value
-	  */
-	 public static Vector getTimers(Properties properties)
-	 {
-		  return instantiate(getVector(properties, "timer."), "org.apache.jmeter.timers.Timer");
-	 }
-
-	 /**
-	  *  Creates the vector of visualizer plugins.
-	  *
-	  *@param  properties  Description of Parameter
-	  *@return             The Visualizers value
-	  */
-	 public static Vector getVisualizers(Properties properties)
-	 {
-		  return instantiate(getVector(properties, "visualizer."),
-					 "org.apache.jmeter.visualizers.Visualizer");
-	 }
-
-	 /**
-	  *  Creates a vector of SampleController plugins.
-	  *
-	  *@param  properties  The properties with information about the samplers
-	  *@return             The Controllers value
-	  */
-	 public static Vector getControllers(Properties properties)
-	 {
-		  String name = "controller.";
-		  Vector v = new Vector();
-		  Enumeration names = properties.keys();
-		  while (names.hasMoreElements())
-		  {
-				String prop = (String) names.nextElement();
-				if (prop.startsWith(name))
-				{
-					 Object o = instantiate(properties.getProperty(prop),
-								"org.apache.jmeter.control.SamplerController");
-					 v.addElement(o);
-				}
-		  }
-		  return v;
-	 }
-
-	 /**
-	  *  Create a string of class names for a particular SamplerController
-	  *
-	  *@param  properties  The properties with info about the samples.
-	  *@param  name        The name of the sampler controller.
-	  *@return             The TestSamples value
-	  */
-	 public static String[] getTestSamples(Properties properties, String name)
-	 {
-		  return (String[]) getVector(properties, name + ".testsample").toArray(new String[0]);
-	 }
-
-	 /**
-	  *  Create an instance of an org.xml.sax.Parser
-	  *
-	  * @deprecated use the plain version instead.  We are using JAXP!
-	  *@param  properties  The properties file containing the parser's class name
-	  *@return             The XMLParser value
-	  */
-	 public static XMLReader getXMLParser(Properties properties)
-	 {
-		  return getXMLParser();
-	 }
-
-	 /**
-	  *  Create an instance of an org.xml.sax.Parser based on the default props.
-	  *
-	  *@return    The XMLParser value
-	  */
-	 public static XMLReader getXMLParser()
-	 {
-		  XMLReader reader = null;
-
-		  try {
-		  	reader = (XMLReader) instantiate(getPropDefault("xml.parser", "org.apache.xerces.parsers.SAXParser"), "org.xml.sax.XMLReader");
-				//reader = xmlFactory.newSAXParser().getXMLReader();
-		  } catch (Exception e) {
-				reader = (XMLReader) instantiate(getPropDefault("xml.parser", "org.apache.xerces.parsers.SAXParser"), "org.xml.sax.XMLReader");
-		  }
-
-		  return reader;
-	 }
-
-	 /**
-	  *  Creates the vector of alias strings.
-	  *
-	  *@param  properties  Description of Parameter
-	  *@return             The Alias value
-	  */
-	 public static Hashtable getAlias(Properties properties)
-	 {
-		  return getHashtable(properties, "alias.");
-	 }
-
-	 /**
-	  *  Creates a vector of strings for all the properties that start with a common
-	  *  prefix.
-	  *
-	  *@param  properties  Description of Parameter
-	  *@param  name        Description of Parameter
-	  *@return             The Vector value
-	  */
-	 public static Vector getVector(Properties properties, String name)
-	 {
-		  Vector v = new Vector();
-		  Enumeration names = properties.keys();
-		  while (names.hasMoreElements())
-		  {
-				String prop = (String) names.nextElement();
-				if (prop.startsWith(name))
-				{
-					 v.addElement(properties.getProperty(prop));
-				}
-		  }
-		  return v;
-	 }
-
-	 /**
-	  *  Creates a vector of strings for all the properties that start with a common
-	  *  prefix.
-	  *
-	  *@param  properties  Description of Parameter
-	  *@param  name        Description of Parameter
-	  *@return             The Hashtable value
-	  */
-	 public static Hashtable getHashtable(Properties properties, String name)
-	 {
-		  Hashtable t = new Hashtable();
-		  Enumeration names = properties.keys();
-		  while (names.hasMoreElements())
-		  {
-				String prop = (String) names.nextElement();
-				if (prop.startsWith(name))
-				{
-					 t.put(prop.substring(name.length()), properties.getProperty(prop));
-				}
-		  }
-		  return t;
-	 }
-
-	 /**
-	  *  Get a int value with default if not present.
-	  *
-	  *@param  propName    the name of the property.
-	  *@param  defaultVal  the default value.
-	  *@return             The PropDefault value
-	  */
-	 public static int getPropDefault(String propName, int defaultVal)
-	 {
-		  int ans;
-		  try
-		  {
-				ans = (Integer.valueOf(
-						  appProperties.getProperty(propName, Integer.toString(defaultVal)).trim())).intValue();
-		  }
-		  catch (Exception e)
-		  {
-				ans = defaultVal;
-		  }
-		  return ans;
-	 }
-
-	 /**
-	  *  Get a boolean value with default if not present.
-	  *
-	  *@param  propName    the name of the property.
-	  *@param  defaultVal  the default value.
-	  *@return             The PropDefault value
-	  */
-	 public static boolean getPropDefault(String propName, boolean defaultVal)
-	 {
-		  boolean ans;
-		  try
-		  {
-				String strVal = appProperties.getProperty(propName,
-						  (new Boolean(defaultVal)).toString()).trim();
-				if (strVal.equalsIgnoreCase("true") || strVal.equalsIgnoreCase("t"))
-				{
-					 ans = true;
-				}
-				else if (strVal.equalsIgnoreCase("false") || strVal.equalsIgnoreCase("f"))
+	}
+	/**
+	 *  Creates the vector of Timers plugins.
+	 *
+	 *@param  properties  Description of Parameter
+	 *@return             The Timers value
+	 */
+	public static Vector getTimers(Properties properties)
+	{
+		return instantiate(
+			getVector(properties, "timer."),
+			"org.apache.jmeter.timers.Timer");
+	}
+	/**
+	 *  Creates the vector of visualizer plugins.
+	 *
+	 *@param  properties  Description of Parameter
+	 *@return             The Visualizers value
+	 */
+	public static Vector getVisualizers(Properties properties)
+	{
+		return instantiate(
+			getVector(properties, "visualizer."),
+			"org.apache.jmeter.visualizers.Visualizer");
+	}
+	/**
+	 *  Creates a vector of SampleController plugins.
+	 *
+	 *@param  properties  The properties with information about the samplers
+	 *@return             The Controllers value
+	 */
+	public static Vector getControllers(Properties properties)
+	{
+		String name = "controller.";
+		Vector v = new Vector();
+		Enumeration names = properties.keys();
+		while (names.hasMoreElements())
+		{
+			String prop = (String) names.nextElement();
+			if (prop.startsWith(name))
+			{
+				Object o =
+					instantiate(
+						properties.getProperty(prop),
+						"org.apache.jmeter.control.SamplerController");
+				v.addElement(o);
+			}
+		}
+		return v;
+	}
+	/**
+	 *  Create a string of class names for a particular SamplerController
+	 *
+	 *@param  properties  The properties with info about the samples.
+	 *@param  name        The name of the sampler controller.
+	 *@return             The TestSamples value
+	 */
+	public static String[] getTestSamples(Properties properties, String name)
+	{
+		return (String[]) getVector(properties, name + ".testsample").toArray(
+			new String[0]);
+	}
+	/**
+	 *  Create an instance of an org.xml.sax.Parser
+	 *
+	 * @deprecated use the plain version instead.  We are using JAXP!
+	 *@param  properties  The properties file containing the parser's class name
+	 *@return             The XMLParser value
+	 */
+	public static XMLReader getXMLParser(Properties properties)
+	{
+		return getXMLParser();
+	}
+	/**
+	 *  Create an instance of an org.xml.sax.Parser based on the default props.
+	 *
+	 *@return    The XMLParser value
+	 */
+	public static XMLReader getXMLParser()
+	{
+		XMLReader reader = null;
+		try
+		{
+			reader =
+				(XMLReader) instantiate(getPropDefault("xml.parser",
+					"org.apache.xerces.parsers.SAXParser"),
+					"org.xml.sax.XMLReader");
+			//reader = xmlFactory.newSAXParser().getXMLReader();
+		}
+		catch (Exception e)
+		{
+			reader =
+				(XMLReader) instantiate(getPropDefault("xml.parser",
+					"org.apache.xerces.parsers.SAXParser"),
+					"org.xml.sax.XMLReader");
+		}
+		return reader;
+	}
+	/**
+	 *  Creates the vector of alias strings.
+	 *
+	 *@param  properties  Description of Parameter
+	 *@return             The Alias value
+	 */
+	public static Hashtable getAlias(Properties properties)
+	{
+		return getHashtable(properties, "alias.");
+	}
+	/**
+	 *  Creates a vector of strings for all the properties that start with a common
+	 *  prefix.
+	 *
+	 *@param  properties  Description of Parameter
+	 *@param  name        Description of Parameter
+	 *@return             The Vector value
+	 */
+	public static Vector getVector(Properties properties, String name)
+	{
+		Vector v = new Vector();
+		Enumeration names = properties.keys();
+		while (names.hasMoreElements())
+		{
+			String prop = (String) names.nextElement();
+			if (prop.startsWith(name))
+			{
+				v.addElement(properties.getProperty(prop));
+			}
+		}
+		return v;
+	}
+	/**
+	 *  Creates a vector of strings for all the properties that start with a common
+	 *  prefix.
+	 *
+	 *@param  properties  Description of Parameter
+	 *@param  name        Description of Parameter
+	 *@return             The Hashtable value
+	 */
+	public static Hashtable getHashtable(Properties properties, String name)
+	{
+		Hashtable t = new Hashtable();
+		Enumeration names = properties.keys();
+		while (names.hasMoreElements())
+		{
+			String prop = (String) names.nextElement();
+			if (prop.startsWith(name))
+			{
+				t.put(prop.substring(name.length()), properties.getProperty(prop));
+			}
+		}
+		return t;
+	}
+	/**
+	 *  Get a int value with default if not present.
+	 *
+	 *@param  propName    the name of the property.
+	 *@param  defaultVal  the default value.
+	 *@return             The PropDefault value
+	 */
+	public static int getPropDefault(String propName, int defaultVal)
+	{
+		int ans;
+		try
+		{
+			ans =
+				(Integer
+					.valueOf(
+						appProperties
+							.getProperty(propName, Integer.toString(defaultVal))
+							.trim()))
+					.intValue();
+		}
+		catch (Exception e)
+		{
+			ans = defaultVal;
+		}
+		return ans;
+	}
+	/**
+	 *  Get a boolean value with default if not present.
+	 *
+	 *@param  propName    the name of the property.
+	 *@param  defaultVal  the default value.
+	 *@return             The PropDefault value
+	 */
+	public static boolean getPropDefault(String propName, boolean defaultVal)
+	{
+		boolean ans;
+		try
+		{
+			String strVal =
+				appProperties
+					.getProperty(propName, (new Boolean(defaultVal)).toString())
+					.trim();
+			if (strVal.equalsIgnoreCase("true") || strVal.equalsIgnoreCase("t"))
+			{
+				ans = true;
+			}
+			else if (
+				strVal.equalsIgnoreCase("false") || strVal.equalsIgnoreCase("f"))
+			{
+				ans = false;
+			}
+			else
+			{
+				ans = ((Integer.valueOf(strVal)).intValue() == 1);
+			}
+		}
+		catch (Exception e)
+		{
+			ans = defaultVal;
+		}
+		return ans;
+	}
+	/**
+	 *  Get a long value with default if not present.
+	 *
+	 *@param  propName    the name of the property.
+	 *@param  defaultVal  the default value.
+	 *@return             The PropDefault value
+	 */
+	public static long getPropDefault(String propName, long defaultVal)
+	{
+		long ans;
+		try
+		{
+			ans =
+				(Long
+					.valueOf(
+						appProperties
+							.getProperty(propName, Long.toString(defaultVal))
+							.trim()))
+					.longValue();
+		}
+		catch (Exception e)
+		{
+			ans = defaultVal;
+		}
+		return ans;
+	}
+	/**
+	 *  Get a String value with default if not present.
+	 *
+	 *@param  propName    the name of the property.
+	 *@param  defaultVal  the default value.
+	 *@return             The PropDefault value
+	 */
+	public static String getPropDefault(String propName, String defaultVal)
+	{
+		String ans;
+		try
+		{
+			ans = appProperties.getProperty(propName, defaultVal).trim();
+		}
+		catch (Exception e)
+		{
+			ans = defaultVal;
+		}
+		return ans;
+	}
+	/**
+	 *  Sets the selection of the JComboBox to the Object 'name' from the list in
+	 *  namVec.
+	 *
+	 *@param  properties  Description of Parameter
+	 *@param  combo       Description of Parameter
+	 *@param  namVec      Description of Parameter
+	 *@param  name        Description of Parameter
+	 */
+	public static void selJComboBoxItem(
+		Properties properties,
+		JComboBox combo,
+		Vector namVec,
+		String name)
+	{
+		int idx = namVec.indexOf(name);
+		combo.setSelectedIndex(idx);
+		// Redisplay.
+		combo.updateUI();
+		return;
+	}
+	/**
+	 *  Instatiate an object and guarantee its class.
+	 *
+	 *@param  className  The name of the class to instantiate.
+	 *@param  impls      The name of the class it subclases.
+	 *@return            Description of the Returned Value
+	 */
+	public static Object instantiate(String className, String impls)
+	{
+		if (className != null)
+			className.trim();
+		if (impls != null)
+			className.trim();
+		try
+		{
+			Class c = Class.forName(impls);
+			try
+			{
+				Class o = Class.forName(className);
+				Object res = o.newInstance();
+				if (c.isInstance(res))
 				{
-					 ans = false;
+					return res;
 				}
 				else
 				{
-					 ans = ((Integer.valueOf(strVal)).intValue() == 1);
+					throw new IllegalArgumentException(
+						className + " is not an instance of " + impls);
 				}
-		  }
-		  catch (Exception e)
-		  {
-				ans = defaultVal;
-		  }
-		  return ans;
-	 }
-
-	 /**
-	  *  Get a long value with default if not present.
-	  *
-	  *@param  propName    the name of the property.
-	  *@param  defaultVal  the default value.
-	  *@return             The PropDefault value
-	  */
-	 public static long getPropDefault(String propName, long defaultVal)
-	 {
-		  long ans;
-		  try
-		  {
-				ans = (Long.valueOf(appProperties.getProperty(propName, Long.toString(defaultVal)).trim())).longValue();
-		  }
-		  catch (Exception e)
-		  {
-				ans = defaultVal;
-		  }
-		  return ans;
-	 }
-
-	 /**
-	  *  Get a String value with default if not present.
-	  *
-	  *@param  propName    the name of the property.
-	  *@param  defaultVal  the default value.
-	  *@return             The PropDefault value
-	  */
-	 public static String getPropDefault(String propName, String defaultVal)
-	 {
-		  String ans;
-		  try
-		  {
-				ans = appProperties.getProperty(propName, defaultVal).trim();
-		  }
-		  catch (Exception e)
-		  {
-				ans = defaultVal;
-		  }
-		  return ans;
-	 }
-
-	 /**
-	  *  Sets the selection of the JComboBox to the Object 'name' from the list in
-	  *  namVec.
-	  *
-	  *@param  properties  Description of Parameter
-	  *@param  combo       Description of Parameter
-	  *@param  namVec      Description of Parameter
-	  *@param  name        Description of Parameter
-	  */
-
-	 public static void selJComboBoxItem(Properties properties, JComboBox combo, Vector namVec, String name)
-	 {
-
-		  int idx = namVec.indexOf(name);
-
-
-		  combo.setSelectedIndex(idx);
-
-
-		  // Redisplay.
-
-		  combo.updateUI();
-
-		  return;
-	 }
-
-
-	 /**
-	  *  Instatiate an object and guarantee its class.
-	  *
-	  *@param  className  The name of the class to instantiate.
-	  *@param  impls      The name of the class it subclases.
-	  *@return            Description of the Returned Value
-	  */
-
-	 public static Object instantiate(String className, String impls)
-	 {
-		  if (className != null) className.trim();
-		  if (impls != null) className.trim();
-
-		  try
-		  {
-
-				Class c = Class.forName(impls);
-
-
+			}
+			catch (ClassNotFoundException e)
+			{
+				log.error("Error loading class " + className + ": class is not found");
+			}
+			catch (IllegalAccessException e)
+			{
+				log.error(
+					"Error loading class " + className + ": does not have access");
+			}
+			catch (InstantiationException e)
+			{
+				log.error(
+					"Error loading class " + className + ": could not instantiate");
+			}
+			catch (NoClassDefFoundError e)
+			{
+				log.error(
+					"Error loading class "
+						+ className
+						+ ": couldn't find class "
+						+ e.getMessage());
+			}
+		}
+		catch (ClassNotFoundException e)
+		{
+			log.error("Error loading class " + impls + ": was not found.");
+		}
+		return null;
+	}
+	/**
+	 *  Instantiate a vector of classes
+	 *
+	 *@param  v          Description of Parameter
+	 *@param  className  Description of Parameter
+	 *@return            Description of the Returned Value
+	 */
+	public static Vector instantiate(Vector v, String className)
+	{
+		Vector i = new Vector();
+		try
+		{
+			Class c = Class.forName(className);
+			Enumeration elements = v.elements();
+			while (elements.hasMoreElements())
+			{
+				String name = (String) elements.nextElement();
 				try
 				{
-
-					 Class o = Class.forName(className);
-
-
-					 Object res = o.newInstance();
-
-					 if (c.isInstance(res))
-					 {
-
-						  return res;
-					 }
-
-					 else
-					 {
-
-						  throw new IllegalArgumentException
-									 (className + " is not an instance of " + impls);
-					 }
-
+					Object o = Class.forName(name).newInstance();
+					if (c.isInstance(o))
+					{
+						i.addElement(o);
+					}
 				}
-
 				catch (ClassNotFoundException e)
 				{
-
-					 System.err.println("Error loading class " +
-								className + ": class is not found");
-
+					log.error("Error loading class " + name + ": class is not found");
 				}
-
 				catch (IllegalAccessException e)
 				{
-
-					 System.err.println("Error loading class " + className +
-								": does not have access");
-
+					log.error("Error loading class " + name + ": does not have access");
 				}
-
 				catch (InstantiationException e)
 				{
-
-					 System.err.println("Error loading class " + className +
-								": could not instantiate");
-
+					log.error("Error loading class " + name + ": could not instantiate");
 				}
-
 				catch (NoClassDefFoundError e)
 				{
-
-					 System.err.println("Error loading class " + className +
-								": couldn't find class " + e.getMessage());
-
-				}
-
-		  }
-
-		  catch (ClassNotFoundException e)
-		  {
-
-				System.err.println("Error loading class " + impls +
-						  ": was not found.");
-
-		  }
-
-		  return null;
-	 }
-
-
-	 /**
-	  *  Instantiate a vector of classes
-	  *
-	  *@param  v          Description of Parameter
-	  *@param  className  Description of Parameter
-	  *@return            Description of the Returned Value
-	  */
-
-	 public static Vector instantiate(Vector v, String className)
-	 {
-
-		  Vector i = new Vector();
-
-
-		  try
-		  {
-
-				Class c = Class.forName(className);
-
-				Enumeration elements = v.elements();
-
-				while (elements.hasMoreElements())
-				{
-
-					 String name = (String) elements.nextElement();
-
-					 try
-					 {
-
-						  Object o = Class.forName(name).newInstance();
-
-						  if (c.isInstance(o))
-						  {
-
-								i.addElement(o);
-
-						  }
-
-					 }
-
-					 catch (ClassNotFoundException e)
-					 {
-
-						  System.err.println("Error loading class " +
-									 name + ": class is not found");
-
-					 }
-
-					 catch (IllegalAccessException e)
-					 {
-
-						  System.err.println("Error loading class " + name + ": does not have access");
-
-					 }
-
-					 catch (InstantiationException e)
-					 {
-
-						  System.err.println("Error loading class " + name + ": could not instantiate");
-
-					 }
-
-					 catch (NoClassDefFoundError e)
-					 {
-
-						  System.err.println("Error loading class " + name + ": couldn't find class " + e.getMessage());
-
-					 }
-
-
-				}
-
-		  }
-		  catch (ClassNotFoundException e)
-		  {
-
-				System.err.println("Error loading class " + className + ": class is not found");
-
-		  }
-
-
-		  return i;
-	 }
-
-
-	 /**
-	  *  Tokenize a string into a vector of tokens
-	  *
-	  *@param  string     Description of Parameter
-	  *@param  separator  Description of Parameter
-	  *@return            Description of the Returned Value
-	  */
-
-	 public static Vector tokenize(String string, String separator)
-	 {
-
-		  Vector v = new Vector();
-
-		  StringTokenizer s = new StringTokenizer(string, separator);
-
-		  while (s.hasMoreTokens())
-		  {
-
-				v.addElement(s.nextToken());
-
-		  }
-
-		  return v;
-	 }
-
-
-	 /**
-	  *  Create a button with the netscape style
-	  *
-	  *@param  name      Description of Parameter
-	  *@param  listener  Description of Parameter
-	  *@return           Description of the Returned Value
-	  */
-
-	 public static JButton createButton(String name, ActionListener listener)
-	 {
-
-		  JButton button = new JButton(getImage(name + ".on.gif"));
-
-		  button.setDisabledIcon(getImage(name + ".off.gif"));
-
-		  button.setRolloverIcon(getImage(name + ".over.gif"));
-
-		  button.setPressedIcon(getImage(name + ".down.gif"));
-
-		  button.setActionCommand(name);
-
-		  button.addActionListener(listener);
-
-		  button.setRolloverEnabled(true);
-
-		  button.setFocusPainted(false);
-
-		  button.setBorderPainted(false);
-
-		  button.setOpaque(false);
-
-		  button.setPreferredSize(new Dimension(24, 24));
-
-		  return button;
-	 }
-
-
-	 /**
-	  *  Create a button with the netscape style
-	  *
-	  *@param  name      Description of Parameter
-	  *@param  listener  Description of Parameter
-	  *@return           Description of the Returned Value
-	  */
-
-	 public static JButton createSimpleButton(String name, ActionListener listener)
-	 {
-
-		  JButton button = new JButton(getImage(name + ".gif"));
-
-		  button.setActionCommand(name);
-
-		  button.addActionListener(listener);
-
-		  button.setFocusPainted(false);
-
-		  button.setBorderPainted(false);
-
-		  button.setOpaque(false);
-
-		  button.setPreferredSize(new Dimension(25, 25));
-
-		  return button;
-	 }
-
-
-	 /**
-	  *  Takes a String and a tokenizer character, and returns a new array of
-	  *  strings of the string split by the tokenizer character.
-	  *
-	  *@param  splittee   String to be split
-	  *@param  splitChar  Character to split the string on
-	  *@return            Array of all the tokens.
-	  */
-
-	 public static String[] split(String splittee, String splitChar)
-	 {
-		  if (splittee == null || splitChar == null)
-		  {
-				return new String[0];
-		  }
-		  StringTokenizer tokens;
-		  String temp;
-		  int spot;
-		  while ((spot = splittee.indexOf(splitChar + splitChar)) != -1)
-		  {
-				splittee = splittee.substring(0, spot + splitChar.length()) +
-						  splittee.substring(spot + 2 * splitChar.length(),
-						  splittee.length());
-		  }
-		  Vector returns = new Vector();
-		  int start = 0;
-		  int length = splittee.length();
-		  spot = 0;
-		  while (start < length && (spot = splittee.indexOf(splitChar, start)) > -1)
-		  {
-				if (spot > 0)
-				{
-					 returns.addElement(splittee.substring(start, spot));
-				}
-				start = spot + splitChar.length();
-		  }
-		  if (start < length)
-		  {
-				returns.add(splittee.substring(start));
-		  }
-		  String[] values = new String[returns.size()];
-		  returns.copyInto(values);
-		  return values;
-	 }
-	 // End Method
-
-
-	 /**
-	  *  Takes a String and a tokenizer character, and returns a new array of
-	  *  strings of the string split by the tokenizer character.
-	  *
-	  *@param  splittee   String to be split
-	  *@param  splitChar  Character to split the string on
-	  *@param  def        Default value to place between two split chars that have
-	  *      nothing between them
-	  *@return            Array of all the tokens.
-	  */
-
-	 public static String[] split(String splittee, String splitChar, String def)
-	 {
-		  if (splittee == null || splitChar == null)
-		  {
-				return new String[0];
-		  }
-		  StringTokenizer tokens;
-		  String temp;
-		  int spot;
-		  while ((spot = splittee.indexOf(splitChar + splitChar)) != -1)
-		  {
-				splittee = splittee.substring(0, spot + splitChar.length()) + def +
-						  splittee.substring(spot + 1 * splitChar.length(),
-						  splittee.length());
-		  }
-		  Vector returns = new Vector();
-		  int start = 0;
-		  int length = splittee.length();
-		  spot = 0;
-		  while (start < length && (spot = splittee.indexOf(splitChar, start)) > -1)
-		  {
-				if (spot > 0)
-				{
-					 returns.addElement(splittee.substring(start, spot));
+					log.error(
+						"Error loading class "
+							+ name
+							+ ": couldn't find class "
+							+ e.getMessage());
 				}
-				start = spot + splitChar.length();
-		  }
-		  if (start < length)
-		  {
-				returns.add(splittee.substring(start));
-		  }
-		  String[] values = new String[returns.size()];
-		  returns.copyInto(values);
-		  return values;
-	 }
-
-	 /**
-	  *  Report an error through a dialog box.
-	  *
-	  *@param  errorMsg  the error message.
-	  */
-	 public static void reportErrorToUser(String errorMsg)
-	 {
-		  JOptionPane.showMessageDialog(GuiPackage.getInstance().getMainFrame(),
-					 errorMsg,"Error",JOptionPane.ERROR_MESSAGE);
-	 }
-
-	 /**
-	  *  Finds a string in an array of strings and returns the
-	  *
-	  *@param  array  Array of strings.
-	  *@param  value  String to compare to array values.
-	  *@return        Index of value in array, or -1 if not in array.
-	  */
-
-	 public static int findInArray(String[] array, String value)
-	 {
-		  int count = -1;
-		  int index = -1;
-		  if (array != null && value != null)
-		  {
-				while (++count < array.length)
-				{
-					 if (array[count] != null && array[count].equals(value))
-					 {
-						  index = count;
-						  break;
-					 }
-				}
-		  }
-		  return index;
-	 }
-
-
-	 /**
-	  *  Takes an array of strings and a tokenizer character, and returns a string
-	  *  of all the strings concatenated with the tokenizer string in between each
-	  *  one.
-	  *
-	  *@param  splittee   Array of Objects to be concatenated.
-	  *@param  splitChar  Object to unsplit the strings with.
-	  *@return            Array of all the tokens.
-	  */
-
-	 public static String unsplit(Object[] splittee, Object splitChar)
-	 {
-
-		  StringBuffer retVal = new StringBuffer("");
-
-		  int count = -1;
-
-		  while (++count < splittee.length)
-		  {
-
-				if (splittee[count] != null)
-				{
-
-					 retVal.append(splittee[count]);
-				}
-
-				if (count + 1 < splittee.length && splittee[count + 1] != null)
-				{
-
-					 retVal.append(splitChar);
-				}
-
-		  }
-
-		  return retVal.toString();
-	 }
-	 // End Method
-
-
-	 /**
-	  *  Takes an array of strings and a tokenizer character, and returns a string
-	  *  of all the strings concatenated with the tokenizer string in between each
-	  *  one.
-	  *
-	  *@param  splittee   Array of Objects to be concatenated.
-	  *@param  splitChar  Object to unsplit the strings with.
-	  *@param  def        Default value to replace null values in array.
-	  *@return            Array of all the tokens.
-	  */
-
-	 public static String unsplit(Object[] splittee, Object splitChar, String def)
-	 {
-
-		  StringBuffer retVal = new StringBuffer("");
-
-		  int count = -1;
-
-		  while (++count < splittee.length)
-		  {
-
-				if (splittee[count] != null)
-				{
-
-					 retVal.append(splittee[count]);
-				}
-
-				else
-				{
-
-					 retVal.append(def);
-				}
-
-				if (count + 1 < splittee.length)
+			}
+		}
+		catch (ClassNotFoundException e)
+		{
+			log.error("Error loading class " + className + ": class is not found");
+		}
+		return i;
+	}
+	/**
+	 *  Tokenize a string into a vector of tokens
+	 *
+	 *@param  string     Description of Parameter
+	 *@param  separator  Description of Parameter
+	 *@return            Description of the Returned Value
+	 */
+	public static Vector tokenize(String string, String separator)
+	{
+		Vector v = new Vector();
+		StringTokenizer s = new StringTokenizer(string, separator);
+		while (s.hasMoreTokens())
+		{
+			v.addElement(s.nextToken());
+		}
+		return v;
+	}
+	/**
+	 *  Create a button with the netscape style
+	 *
+	 *@param  name      Description of Parameter
+	 *@param  listener  Description of Parameter
+	 *@return           Description of the Returned Value
+	 */
+	public static JButton createButton(String name, ActionListener listener)
+	{
+		JButton button = new JButton(getImage(name + ".on.gif"));
+		button.setDisabledIcon(getImage(name + ".off.gif"));
+		button.setRolloverIcon(getImage(name + ".over.gif"));
+		button.setPressedIcon(getImage(name + ".down.gif"));
+		button.setActionCommand(name);
+		button.addActionListener(listener);
+		button.setRolloverEnabled(true);
+		button.setFocusPainted(false);
+		button.setBorderPainted(false);
+		button.setOpaque(false);
+		button.setPreferredSize(new Dimension(24, 24));
+		return button;
+	}
+	/**
+	 *  Create a button with the netscape style
+	 *
+	 *@param  name      Description of Parameter
+	 *@param  listener  Description of Parameter
+	 *@return           Description of the Returned Value
+	 */
+	public static JButton createSimpleButton(
+		String name,
+		ActionListener listener)
+	{
+		JButton button = new JButton(getImage(name + ".gif"));
+		button.setActionCommand(name);
+		button.addActionListener(listener);
+		button.setFocusPainted(false);
+		button.setBorderPainted(false);
+		button.setOpaque(false);
+		button.setPreferredSize(new Dimension(25, 25));
+		return button;
+	}
+	/**
+	 *  Takes a String and a tokenizer character, and returns a new array of
+	 *  strings of the string split by the tokenizer character.
+	 *
+	 *@param  splittee   String to be split
+	 *@param  splitChar  Character to split the string on
+	 *@param  def        Default value to place between two split chars that have
+	 *      nothing between them
+	 *@return            Array of all the tokens.
+	 */
+	public static String[] split(String splittee, String splitChar, String def)
+	{
+		if (splittee == null || splitChar == null)
+		{
+			return new String[0];
+		}
+		StringTokenizer tokens;
+		String temp;
+		int spot;
+		while ((spot = splittee.indexOf(splitChar + splitChar)) != -1)
+		{
+			splittee =
+				splittee.substring(0, spot + splitChar.length())
+					+ def
+					+ splittee.substring(spot + 1 * splitChar.length(), splittee.length());
+		}
+		Vector returns = new Vector();
+		int start = 0;
+		int length = splittee.length();
+		spot = 0;
+		while (start < length && (spot = splittee.indexOf(splitChar, start)) > -1)
+		{
+			if (spot > 0)
+			{
+				returns.addElement(splittee.substring(start, spot));
+			}
+			start = spot + splitChar.length();
+		}
+		if (start < length)
+		{
+			returns.add(splittee.substring(start));
+		}
+		String[] values = new String[returns.size()];
+		returns.copyInto(values);
+		return values;
+	}
+	/**
+	 *  Report an error through a dialog box.
+	 *
+	 *@param  errorMsg  the error message.
+	 */
+	public static void reportErrorToUser(String errorMsg)
+	{
+		JOptionPane.showMessageDialog(
+			GuiPackage.getInstance().getMainFrame(),
+			errorMsg,
+			"Error",
+			JOptionPane.ERROR_MESSAGE);
+	}
+	/**
+	 *  Finds a string in an array of strings and returns the
+	 *
+	 *@param  array  Array of strings.
+	 *@param  value  String to compare to array values.
+	 *@return        Index of value in array, or -1 if not in array.
+	 */
+	public static int findInArray(String[] array, String value)
+	{
+		int count = -1;
+		int index = -1;
+		if (array != null && value != null)
+		{
+			while (++count < array.length)
+			{
+				if (array[count] != null && array[count].equals(value))
 				{
-
-					 retVal.append(splitChar);
+					index = count;
+					break;
 				}
-
-		  }
-
-		  return retVal.toString();
-	 }
-	 // End Method
-	 
-	 public static String getJMeterHome()
-	 {
-	 	return jmDir;
-	 }
-	 
-	 public static void setJMeterHome(String home)
-	 {
-	 	jmDir = home;
-	 }
-	 private static String jmDir;
-
-
-	 /**
-	  * Gets the JMeter Version.
-	  * @returns the JMeter version.
-	  */
-	 public static String getJMeterVersion()
-	 {
-		  return "@VERSION@";
-	 }
+			}
+		}
+		return index;
+	}
+	/**
+	 *  Takes an array of strings and a tokenizer character, and returns a string
+	 *  of all the strings concatenated with the tokenizer string in between each
+	 *  one.
+	 *
+	 *@param  splittee   Array of Objects to be concatenated.
+	 *@param  splitChar  Object to unsplit the strings with.
+	 *@return            Array of all the tokens.
+	 */
+	public static String unsplit(Object[] splittee, Object splitChar)
+	{
+		StringBuffer retVal = new StringBuffer("");
+		int count = -1;
+		while (++count < splittee.length)
+		{
+			if (splittee[count] != null)
+			{
+				retVal.append(splittee[count]);
+			}
+			if (count + 1 < splittee.length && splittee[count + 1] != null)
+			{
+				retVal.append(splitChar);
+			}
+		}
+		return retVal.toString();
+	}
+	// End Method
+	/**
+	 *  Takes an array of strings and a tokenizer character, and returns a string
+	 *  of all the strings concatenated with the tokenizer string in between each
+	 *  one.
+	 *
+	 *@param  splittee   Array of Objects to be concatenated.
+	 *@param  splitChar  Object to unsplit the strings with.
+	 *@param  def        Default value to replace null values in array.
+	 *@return            Array of all the tokens.
+	 */
+	public static String unsplit(Object[] splittee, Object splitChar, String def)
+	{
+		StringBuffer retVal = new StringBuffer("");
+		int count = -1;
+		while (++count < splittee.length)
+		{
+			if (splittee[count] != null)
+			{
+				retVal.append(splittee[count]);
+			}
+			else
+			{
+				retVal.append(def);
+			}
+			if (count + 1 < splittee.length)
+			{
+				retVal.append(splitChar);
+			}
+		}
+		return retVal.toString();
+	}
+	// End Method
+	public static String getJMeterHome()
+	{
+		return jmDir;
+	}
+	public static void setJMeterHome(String home)
+	{
+		jmDir = home;
+	}
+	private static String jmDir;
+	public static final String JMETER = "jmeter";
+	public static final String ENGINE = "jmeter.engine";
+	public static final String ELEMENTS = "jmeter.elements";
+	public static final String GUI = "jmeter.gui";
+	public static final String UTIL = "jmeter.util";
+	public static final String CLASSFINDER = "jmeter.util.classfinder";
+	public static final String TEST = "jmeter.test";
+	public static final String HTTP = "jmeter.protocol.http";
+	public static final String JDBC = "jmeter.protocol.jdbc";
+	public static final String FTP = "jmeter.protocol.ftp";
+	public static final String JAVA = "jmeter.protocol.java";
+	/**
+	 * Gets the JMeter Version.
+	 * @returns the JMeter version.
+	 */
+	public static String getJMeterVersion()
+	{
+		return VERSION;
+	}
 }
+
diff --git a/jakarta-jmeter/src/core/org/apache/jmeter/util/JsseSSLManager.java b/jakarta-jmeter/src/core/org/apache/jmeter/util/JsseSSLManager.java
index d45f5ad..44996ae 100644
--- a/jakarta-jmeter/src/core/org/apache/jmeter/util/JsseSSLManager.java
+++ b/jakarta-jmeter/src/core/org/apache/jmeter/util/JsseSSLManager.java
@@ -53,21 +53,26 @@
  *  <http://www.apache.org/>.
  */
 package org.apache.jmeter.util;
-
-import com.sun.net.ssl.*;
-
-import java.io.File;
-import java.io.FileInputStream;
 import java.net.HttpURLConnection;
-import java.security.SecureRandom;
-import java.security.Provider;
+import java.security.KeyStore;
 import java.security.Principal;
 import java.security.PrivateKey;
-import java.security.KeyStore;
+import java.security.Provider;
+import java.security.SecureRandom;
 import java.security.cert.X509Certificate;
 
 import org.apache.jmeter.util.keystore.JmeterKeyStore;
-
+import org.apache.log.Hierarchy;
+import org.apache.log.Logger;
+
+import com.sun.net.ssl.HostnameVerifier;
+import com.sun.net.ssl.HttpsURLConnection;
+import com.sun.net.ssl.KeyManager;
+import com.sun.net.ssl.KeyManagerFactory;
+import com.sun.net.ssl.SSLContext;
+import com.sun.net.ssl.TrustManager;
+import com.sun.net.ssl.X509KeyManager;
+import com.sun.net.ssl.X509TrustManager;
 /**
  *  The SSLManager handles the KeyStore information for JMeter. Basically, it
  *  handles all the logic for loading and initializing all the JSSE parameters
@@ -78,10 +83,12 @@ import org.apache.jmeter.util.keystore.JmeterKeyStore;
  *
  *@author     <a href="bloritsch@apache.org">Berin Loritsch</a>
  *@created    March 21, 2002
- *@version    CVS $Revision: 1.1 $ $Date: 2002/08/11 19:24:49 $
+ *@version    CVS $Revision: 1.4 $ $Date: 2002/09/17 19:32:52 $
  */
 public class JsseSSLManager extends SSLManager
 {
+	transient private static Logger log =
+		Hierarchy.getDefaultHierarchy().getLoggerFor("jmeter.util");
 	/**
 	 *  Cache the SecureRandom instance because it takes a long time to create
 	 */
@@ -91,8 +98,6 @@ public class JsseSSLManager extends SSLManager
 	 */
 	private SSLContext context = null;
 	private Provider pro = null;
-
-
 	/**
 	 *  Private Constructor to remove the possibility of directly instantiating
 	 *  this object. Create the SSLContext, and wrap all the X509KeyManagers with
@@ -105,34 +110,36 @@ public class JsseSSLManager extends SSLManager
 		setProvider(provider);
 		try
 		{
-			Class iaikProvider = SSLManager.class.getClassLoader().loadClass("iaik.security.jsse.provider.IAIKJSSEProvider");
+			Class iaikProvider =
+				SSLManager.class.getClassLoader().loadClass(
+					"iaik.security.jsse.provider.IAIKJSSEProvider");
 			setProvider((Provider) iaikProvider.newInstance());
 		}
 		catch (Exception e)
-		{}
+		{
+		}
 		try
 		{
-			Class sunProvider = SSLManager.class.getClassLoader().loadClass("com.sun.net.ssl.internal.ssl.Provider");
+			Class sunProvider =
+				SSLManager.class.getClassLoader().loadClass(
+					"com.sun.net.ssl.internal.ssl.Provider");
 			setProvider((Provider) sunProvider.newInstance());
 		}
 		catch (Exception e)
-		{}
-
+		{
+		}
 		if (null == this.rand)
 		{
 			this.rand = new SecureRandom();
 		}
-
-		if ("all".equalsIgnoreCase(JMeterUtils.getPropDefault("javax.net.debug", "none")))
+		if ("all"
+			.equalsIgnoreCase(JMeterUtils.getPropDefault("javax.net.debug", "none")))
 		{
 			System.setProperty("javax.net.debug", "all");
 		}
-
 		this.getContext();
-		System.out.println("JsseSSLManager installed");
+		log.info("JsseSSLManager installed");
 	}
-
-
 	/**
 	 *  Sets the Context attribute of the JsseSSLManager object
 	 *
@@ -142,9 +149,14 @@ public class JsseSSLManager extends SSLManager
 	{
 		HttpsURLConnection secureConn = (HttpsURLConnection) conn;
 		secureConn.setSSLSocketFactory(this.getContext().getSocketFactory());
+		HttpsURLConnection.setDefaultHostnameVerifier(new HostnameVerifier()
+		{
+			public boolean verify(String urlHostname, String certHostname)
+			{
+				return true;
+			}
+		});
 	}
-
-
 	/**
 	 *  Sets the Provider attribute of the JsseSSLManager object
 	 *
@@ -158,8 +170,6 @@ public class JsseSSLManager extends SSLManager
 			this.pro = p;
 		}
 	}
-
-
 	/**
 	 *  Returns the SSLContext we are using. It is useful for obtaining the
 	 *  SSLSocketFactory so that your created sockets are authenticated.
@@ -181,17 +191,17 @@ public class JsseSSLManager extends SSLManager
 					this.context = SSLContext.getInstance("TLS");
 				}
 				catch (Exception ee)
-				{}
+				{
+				}
 			}
-
 			try
 			{
-				KeyManagerFactory managerFactory = KeyManagerFactory.getInstance("SunX509");
+				KeyManagerFactory managerFactory =
+					KeyManagerFactory.getInstance("SunX509");
 				JmeterKeyStore keys = this.getKeyStore();
 				managerFactory.init(null, this.defaultpw.toCharArray());
 				KeyManager[] managers = managerFactory.getKeyManagers();
-				System.out.println(keys.getClass().toString());
-
+				log.info(keys.getClass().toString());
 				for (int i = 0; i < managers.length; i++)
 				{
 					if (managers[i] instanceof X509KeyManager)
@@ -200,35 +210,35 @@ public class JsseSSLManager extends SSLManager
 						managers[i] = new WrappedX509KeyManager(manager, keys);
 					}
 				}
-
-				TrustManager[] trusts = new TrustManager[]{new AlwaysTrustManager(this.getTrustStore())};
+				TrustManager[] trusts =
+					new TrustManager[] { new AlwaysTrustManager(this.getTrustStore())};
 				context.init(managers, trusts, this.rand);
-				HttpsURLConnection.setDefaultSSLSocketFactory(context.getSocketFactory());
+				HttpsURLConnection.setDefaultSSLSocketFactory(
+					context.getSocketFactory());
 			}
 			catch (Exception e)
 			{
 			}
-
-			String[] dCiphers = this.context.getSocketFactory().getDefaultCipherSuites();
-			String[] sCiphers = this.context.getSocketFactory().getSupportedCipherSuites();
-			int len = (dCiphers.length > sCiphers.length) ? dCiphers.length : sCiphers.length;
+			String[] dCiphers =
+				this.context.getSocketFactory().getDefaultCipherSuites();
+			String[] sCiphers =
+				this.context.getSocketFactory().getSupportedCipherSuites();
+			int len =
+				(dCiphers.length > sCiphers.length) ? dCiphers.length : sCiphers.length;
 			for (int i = 0; i < len; i++)
 			{
 				if (i < dCiphers.length)
 				{
-					System.out.println("Default Cipher: " + dCiphers[i]);
+					log.info("Default Cipher: " + dCiphers[i]);
 				}
 				if (i < sCiphers.length)
 				{
-					System.out.println("Supported Cipher: " + sCiphers[i]);
+					log.info("Supported Cipher: " + sCiphers[i]);
 				}
 			}
 		}
-
 		return this.context;
 	}
-
-
 	/**
 	 *  Description of the Class
 	 *
@@ -241,8 +251,6 @@ public class JsseSSLManager extends SSLManager
 		 *  Description of the Field
 		 */
 		protected X509Certificate[] certs;
-
-
 		/**
 		 *  Constructor for the AlwaysTrustManager object
 		 *
@@ -257,26 +265,25 @@ public class JsseSSLManager extends SSLManager
 				while (enum.hasMoreElements())
 				{
 					String alias = (String) enum.nextElement();
-					System.out.print("AlwaysTrustManager alias: " + alias);
-
+					log.info("AlwaysTrustManager alias: " + alias);
 					if (store.isCertificateEntry(alias))
 					{
 						list.add(store.getCertificate(alias));
-						System.out.println(" INSTALLED");
-					} else
+						log.info(" INSTALLED");
+					}
+					else
 					{
-						System.out.println(" SKIPPED");
+						log.info(" SKIPPED");
 					}
 				}
-				this.certs = (X509Certificate[]) list.toArray(new X509Certificate[]{});
+				this.certs = (X509Certificate[]) list.toArray(new X509Certificate[] {
+				});
 			}
 			catch (Exception e)
 			{
 				this.certs = null;
 			}
 		}
-
-
 		/**
 		 *  Gets the AcceptedIssuers attribute of the AlwaysTrustManager object
 		 *
@@ -284,11 +291,9 @@ public class JsseSSLManager extends SSLManager
 		 */
 		public X509Certificate[] getAcceptedIssuers()
 		{
-			System.out.println("Get accepted Issuers");
+			log.info("Get accepted Issuers");
 			return certs;
 		}
-
-
 		/**
 		 *  Gets the ClientTrusted attribute of the AlwaysTrustManager object
 		 *
@@ -297,11 +302,9 @@ public class JsseSSLManager extends SSLManager
 		 */
 		public boolean isClientTrusted(X509Certificate[] chain)
 		{
-			System.out.println("Is client trusted ???");
+			log.info("Is client trusted ???");
 			return true;
 		}
-
-
 		/**
 		 *  Gets the ServerTrusted attribute of the AlwaysTrustManager object
 		 *
@@ -310,12 +313,10 @@ public class JsseSSLManager extends SSLManager
 		 */
 		public boolean isServerTrusted(X509Certificate[] chain)
 		{
-			System.out.println("Is server trusted ???");
+			log.info("Is server trusted ???");
 			return true;
 		}
 	}
-
-
 	/**
 	 *  This is the X509KeyManager we have defined for the sole purpose of selecing
 	 *  the proper key and certificate based on the keystore available.
@@ -333,8 +334,6 @@ public class JsseSSLManager extends SSLManager
 		 *  The KeyStore this KeyManager uses
 		 */
 		private final JmeterKeyStore store;
-
-
 		/**
 		 *  Instantiate a new WrappedX509KeyManager.
 		 *
@@ -346,8 +345,6 @@ public class JsseSSLManager extends SSLManager
 			this.manager = parent;
 			this.store = ks;
 		}
-
-
 		/**
 		 *  Compiles the list of all client aliases with a private key. Currently,
 		 *  keyType and issuers are both ignored.
@@ -358,12 +355,10 @@ public class JsseSSLManager extends SSLManager
 		 */
 		public String[] getClientAliases(String keyType, Principal[] issuers)
 		{
-			System.out.println("WrappedX509Manager: getClientAliases: ");
-			System.out.println(new String[]{this.store.getAlias()});
-			return new String[]{this.store.getAlias()};
+			log.info("WrappedX509Manager: getClientAliases: ");
+			log.info(this.store.getAlias());
+			return new String[] { this.store.getAlias()};
 		}
-
-
 		/**
 		 *  Get the list of server aliases for the SSLServerSockets. This is not used
 		 *  in JMeter.
@@ -374,12 +369,10 @@ public class JsseSSLManager extends SSLManager
 		 */
 		public String[] getServerAliases(String keyType, Principal[] issuers)
 		{
-			System.out.println("WrappedX509Manager: getServerAliases: ");
-			System.out.println(this.manager.getServerAliases(keyType, issuers));
+			log.info("WrappedX509Manager: getServerAliases: ");
+			log.info(this.manager.getServerAliases(keyType, issuers).toString());
 			return this.manager.getServerAliases(keyType, issuers);
 		}
-
-
 		/**
 		 *  Get the Certificate chain for a particular alias
 		 *
@@ -388,12 +381,10 @@ public class JsseSSLManager extends SSLManager
 		 */
 		public X509Certificate[] getCertificateChain(String alias)
 		{
-			System.out.println("WrappedX509Manager: getCertificateChain(" + alias + ")");
-			System.out.println(this.store.getCertificateChain());
+			log.info("WrappedX509Manager: getCertificateChain(" + alias + ")");
+			log.info(this.store.getCertificateChain().toString());
 			return this.store.getCertificateChain();
 		}
-
-
 		/**
 		 *  Get the Private Key for a particular alias
 		 *
@@ -402,11 +393,10 @@ public class JsseSSLManager extends SSLManager
 		 */
 		public PrivateKey getPrivateKey(String alias)
 		{
-			System.out.println("WrappedX509Manager: getPrivateKey: " + this.store.getPrivateKey());
+			log.info(
+				"WrappedX509Manager: getPrivateKey: " + this.store.getPrivateKey());
 			return this.store.getPrivateKey();
 		}
-
-
 		/**
 		 *  Select the Alias we will authenticate as if Client authentication is
 		 *  required by the server we are connecting to. We get the list of aliases,
@@ -422,11 +412,9 @@ public class JsseSSLManager extends SSLManager
 		 */
 		public String chooseClientAlias(String keyType, Principal[] issuers)
 		{
-			System.out.println("Alias: " + this.store.getAlias());
+			log.info("Alias: " + this.store.getAlias());
 			return this.store.getAlias();
 		}
-
-
 		/**
 		 *  Choose the server alias for the SSLServerSockets. This are not used in
 		 *  JMeter.
@@ -437,8 +425,9 @@ public class JsseSSLManager extends SSLManager
 		 */
 		public String chooseServerAlias(String keyType, Principal[] issuers)
 		{
-			System.out.println("WrappedX509Manager: chooseServerAlias: " +
-					this.manager.chooseServerAlias(keyType, issuers));
+			log.info(
+				"WrappedX509Manager: chooseServerAlias: "
+					+ this.manager.chooseServerAlias(keyType, issuers));
 			return this.manager.chooseServerAlias(keyType, issuers);
 		}
 	}
diff --git a/jakarta-jmeter/src/core/org/apache/jmeter/util/ListedHashTree.java b/jakarta-jmeter/src/core/org/apache/jmeter/util/ListedHashTree.java
deleted file mode 100644
index f088ef9..0000000
--- a/jakarta-jmeter/src/core/org/apache/jmeter/util/ListedHashTree.java
+++ /dev/null
@@ -1,1211 +0,0 @@
-/*
- * ====================================================================
- * The Apache Software License, Version 1.1
- *
- * Copyright (c) 2001 The Apache Software Foundation.  All rights
- * reserved.
- *
- * Redistribution and use in source and binary forms, with or without
- * modification, are permitted provided that the following conditions
- * are met:
- *
- * 1. Redistributions of source code must retain the above copyright
- * notice, this list of conditions and the following disclaimer.
- *
- * 2. Redistributions in binary form must reproduce the above copyright
- * notice, this list of conditions and the following disclaimer in
- * the documentation and/or other materials provided with the
- * distribution.
- *
- * 3. The end-user documentation included with the redistribution,
- * if any, must include the following acknowledgment:
- * "This product includes software developed by the
- * Apache Software Foundation (http://www.apache.org/)."
- * Alternately, this acknowledgment may appear in the software itself,
- * if and wherever such third-party acknowledgments normally appear.
- *
- * 4. The names "Apache" and "Apache Software Foundation" and
- * "Apache JMeter" must not be used to endorse or promote products
- * derived from this software without prior written permission. For
- * written permission, please contact apache@apache.org.
- *
- * 5. Products derived from this software may not be called "Apache",
- * "Apache JMeter", nor may "Apache" appear in their name, without
- * prior written permission of the Apache Software Foundation.
- *
- * THIS SOFTWARE IS PROVIDED ``AS IS'' AND ANY EXPRESSED OR IMPLIED
- * WARRANTIES, INCLUDING, BUT NOT LIMITED TO, THE IMPLIED WARRANTIES
- * OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE ARE
- * DISCLAIMED.  IN NO EVENT SHALL THE APACHE SOFTWARE FOUNDATION OR
- * ITS CONTRIBUTORS BE LIABLE FOR ANY DIRECT, INDIRECT, INCIDENTAL,
- * SPECIAL, EXEMPLARY, OR CONSEQUENTIAL DAMAGES (INCLUDING, BUT NOT
- * LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES; LOSS OF
- * USE, DATA, OR PROFITS; OR BUSINESS INTERRUPTION) HOWEVER CAUSED AND
- * ON ANY THEORY OF LIABILITY, WHETHER IN CONTRACT, STRICT LIABILITY,
- * OR TORT (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT
- * OF THE USE OF THIS SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF
- * SUCH DAMAGE.
- * ====================================================================
- *
- * This software consists of voluntary contributions made by many
- * individuals on behalf of the Apache Software Foundation.  For more
- * information on the Apache Software Foundation, please see
- * <http://www.apache.org/>.
- */
-
-package org.apache.jmeter.util;
-import java.io.*;
-import java.util.*;
-
-/****************************************
- * This class is used to create a tree structure of objects. Each element in the
- * tree is also a key to the next node down in the tree. In the ListedHashTree,
- * the order in which values are added is preserved (not to be confused with
- * SortedHashTree, which sorts the order of the values using the compare()
- * function).
- *
- *@author    $Author: mstover1 $
- *@created   $Date: 2002/08/11 19:24:49 $
- *@version   $Revision: 1.1 $
- ***************************************/
-public class ListedHashTree implements Serializable,Cloneable
-{
-
-	private java.util.Map data;
-	private List order;
-
-	/****************************************
-	 * !ToDo (Constructor description)
-	 ***************************************/
-	public ListedHashTree()
-	{
-		data = new HashMap();
-		order = new LinkedList();
-	}
-	
-	public Object clone()
-	{
-		ListedHashTree newTree = new ListedHashTree();
-		newTree.data = (Map)((HashMap)data).clone();
-		newTree.order = (List)((LinkedList)order).clone();
-		return newTree;
-	}
-
-	/****************************************
-	 * !ToDo (Constructor description)
-	 *
-	 *@param key  !ToDo (Parameter description)
-	 ***************************************/
-	public ListedHashTree(Object key)
-	{
-		data = new HashMap();
-		order = new LinkedList();
-		data.put(key, new ListedHashTree());
-		order.add(key);
-	}
-
-	/****************************************
-	 * !ToDo (Constructor description)
-	 *
-	 *@param keys  !ToDo (Parameter description)
-	 ***************************************/
-	public ListedHashTree(Collection keys)
-	{
-		data = new HashMap();
-		order = new LinkedList();
-		Iterator it = keys.iterator();
-		while(it.hasNext())
-		{
-			Object temp = it.next();
-			data.put(temp, new ListedHashTree());
-			order.add(temp);
-		}
-	}
-
-	/****************************************
-	 * !ToDo (Constructor description)
-	 *
-	 *@param keys  !ToDo (Parameter description)
-	 ***************************************/
-	public ListedHashTree(Object[] keys)
-	{
-		data = new HashMap();
-		order = new LinkedList();
-		for(int x = 0; x < keys.length; x++)
-		{
-			data.put(keys[x], new ListedHashTree());
-			order.add(keys[x]);
-		}
-	}
-
-	/****************************************
-	 * !ToDo (Method description)
-	 *
-	 *@param visitor  !ToDo (Parameter description)
-	 ***************************************/
-	public void traverse(ListedHashTreeVisitor visitor)
-	{
-		Iterator iter = list().iterator();
-		while(iter.hasNext())
-		{
-			Object item = iter.next();
-			visitor.addNode(item, get(item));
-			get(item).traverseInto(visitor);
-		}
-	}
-
-	private void traverseInto(ListedHashTreeVisitor visitor)
-	{
-		Iterator iter = list().iterator();
-		while(iter.hasNext())
-		{
-			Object item = iter.next();
-			visitor.addNode(item, get(item));
-			get(item).traverseInto(visitor);
-		}
-		if(list().size() == 0)
-		{
-			visitor.processPath();
-		}
-		visitor.subtractNode();
-	}
-
-	/****************************************
-	 * If the ListedHashTree contains the given object as a key at the top level,
-	 * then a true result is returned, otherwise false.
-	 *
-	 *@param o    !ToDo (Parameter description)
-	 *@return     True if the ListedHashTree contains the key, false otherwise.
-	 ***************************************/
-	public boolean containsKey(Object o)
-	{
-		return data.containsKey(o);
-	}
-
-	/****************************************
-	 * If the ListedHashTree is empty, true is returned, false otherwise.
-	 *
-	 *@return   True if ListedHashTree is empty, false otherwise.
-	 ***************************************/
-	public boolean isEmpty()
-	{
-		return data.isEmpty();
-	}
-
-	/****************************************
-	 * Sets a key and it's value in the ListedHashTree. It actually sets up a key,
-	 * and then creates a node for the key and adds the value to the new node, as a
-	 * key.
-	 *
-	 *@param key    Key to be set up.
-	 *@param value  Value to be set up as a key in the secondary node.
-	 ***************************************/
-	public void set(Object key, Object value)
-	{
-		data.put(key, new ListedHashTree(value));
-		order.add(key);
-	}
-
-	/****************************************
-	 * Sets a key and it's values in the ListedHashTree. It sets up a key in the
-	 * current node, and then creates a node for that key, and adds all the values
-	 * in the array as keys in the new node.
-	 *
-	 *@param key   Key to be set up.
-	 *@param t     !ToDo (Parameter description)
-	 ***************************************/
-	public void set(Object key, ListedHashTree t)
-	{
-		if(!data.containsKey(key))
-		{
-			order.add(key);
-		}
-		data.put(key, t);
-	}
-
-	/****************************************
-	 * Sets a key and it's values in the ListedHashTree. It sets up a key in the
-	 * current node, and then creates a node for that key, and adds all the values
-	 * in the array as keys in the new node.
-	 *
-	 *@param key     Key to be set up.
-	 *@param values  Array of objects to be added as keys in the secondary node.
-	 ***************************************/
-	public void set(Object key, Object[] values)
-	{
-		data.put(key, new ListedHashTree(values));
-		order.add(key);
-	}
-
-	/****************************************
-	 * Sets a key and it's values in the ListedHashTree. It sets up a key in the
-	 * current node, and then creates a node for that key, and adds all the values
-	 * in the array as keys in the new node.
-	 *
-	 *@param key     Key to be set up.
-	 *@param values  Collection of objects to be added as keys in the secondary
-	 *      node.
-	 ***************************************/
-	public void set(Object key, Collection values)
-	{
-		data.put(key, new ListedHashTree(values));
-		order.add(key);
-	}
-
-	/****************************************
-	 * Sets a series of keys into the ListedHashTree. It sets up the first object
-	 * in the key array as a key in the current node, recurses into the next
-	 * ListedHashTree node through that key and adds the second object in the
-	 * array. Continues recursing in this manner until the end of the first array
-	 * is reached, at which point all the values of the second array are added as
-	 * keys to the bottom-most node.
-	 *
-	 *@param key     Array of keys to put into ListedHashTree.
-	 *@param values  Array of values to be added as keys to bottom-most node.
-	 ***************************************/
-	public void set(Object[] key, Object[] values)
-	{
-		List keys = new LinkedList();
-		for(int x = 0; x < key.length; keys.add(key[x++]))
-		{
-			;
-		}
-		set(keys, values);
-	}
-
-	/****************************************
-	 * Sets a series of keys into the ListedHashTree. It sets up the first object
-	 * in the key array as a key in the current node, recurses into the next
-	 * ListedHashTree node through that key and adds the second object in the
-	 * array. Continues recursing in this manner until the end of the first array
-	 * is reached, at which point all the values of the Collection of values are
-	 * added as keys to the bottom-most node.
-	 *
-	 *@param key     Array of keys to put into ListedHashTree.
-	 *@param values  Collection of values to be added as keys to bottom-most node.
-	 ***************************************/
-	public void set(Object[] key, Collection values)
-	{
-		List keys = new LinkedList();
-		for(int x = 0; x < key.length; keys.add(key[x++]))
-		{
-			;
-		}
-		set(keys, values);
-	}
-
-	/****************************************
-	 * !ToDo (Method description)
-	 *
-	 *@param values  !ToDo (Parameter description)
-	 ***************************************/
-	public void set(Collection values)
-	{
-		Iterator iter = this.list().iterator();
-		while(iter.hasNext())
-		{
-			this.remove(iter.next());
-		}
-		this.add(values);
-	}
-
-	/****************************************
-	 * Sets a series of keys into the ListedHashTree. It sets up the first object
-	 * in the key list as a key in the current node, recurses into the next
-	 * ListedHashTree node through that key and adds the second object in the list.
-	 * Continues recursing in this manner until the end of the first list is
-	 * reached, at which point all the values of the array of values are added as
-	 * keys to the bottom-most node.
-	 *
-	 *@param key     List of keys to put into ListedHashTree.
-	 *@param values  Array of values to be added as keys to bottom-most node.
-	 ***************************************/
-	public void set(List key, Object[] values)
-	{
-		if(key.size() == 0)
-		{
-			return;
-		}
-		else if(key.size() == 1)
-		{
-			set(key.get(0), values);
-		}
-		else
-		{
-			Object temp = key.get(0);
-			add(temp, key.get(1));
-			get(temp).set(key.subList(1, key.size()), values);
-		}
-	}
-
-	/****************************************
-	 * !ToDo (Method description)
-	 *
-	 *@param currentKey  !ToDo (Parameter description)
-	 *@param newKey      !ToDo (Parameter description)
-	 ***************************************/
-	public void replace(Object currentKey, Object newKey)
-	{
-		ListedHashTree tree = this.get(currentKey);
-		data.remove(currentKey);
-		data.put(newKey, tree);
-		order.set(order.indexOf(currentKey), newKey);
-	}
-
-	/****************************************
-	 * Sets a series of keys into the ListedHashTree. It sets up the first object
-	 * in the key list as a key in the current node, recurses into the next
-	 * ListedHashTree node through that key and adds the second object in the list.
-	 * Continues recursing in this manner until the end of the first list is
-	 * reached, at which point all the values of the Collection of values are added
-	 * as keys to the bottom-most node.
-	 *
-	 *@param key     List of keys to put into ListedHashTree.
-	 *@param values  Collection of values to be added as keys to bottom-most node.
-	 ***************************************/
-	public void set(List key, Collection values)
-	{
-		if(key.size() == 0)
-		{
-			return;
-		}
-		else if(key.size() == 1)
-		{
-			set(key.get(0), values);
-		}
-		else
-		{
-			Object temp = key.get(0);
-			add(temp, key.get(1));
-			get(temp).set(key.subList(1, key.size()), values);
-		}
-	}
-
-	/****************************************
-	 * Adds an key into the ListedHashTree at the current level.
-	 *
-	 *@param key  Key to be added to ListedHashTree.
-	 ***************************************/
-	public void add(Object key)
-	{
-		if(!data.containsKey(key))
-		{
-			data.put(key, new ListedHashTree());
-			order.add(key);
-		}
-	}
-
-	/****************************************
-	 * !ToDo (Method description)
-	 *
-	 *@param key      !ToDo (Parameter description)
-	 *@param subTree  !ToDo (Parameter description)
-	 ***************************************/
-	public void add(Object key, ListedHashTree subTree)
-	{
-		Iterator iter = subTree.list().iterator();
-		while(iter.hasNext())
-		{
-			Object item = iter.next();
-			add(key, item);
-			get(key).set(item, subTree.get(item));
-		}
-	}
-
-	/****************************************
-	 * Adds a bunch of keys into the ListedHashTree at the current level.
-	 *
-	 *@param keys  Array of Keys to be added to ListedHashTree.
-	 ***************************************/
-	public void add(Object[] keys)
-	{
-		for(int x = 0; x < keys.length; x++)
-		{
-			add(keys[x]);
-		}
-	}
-
-	/****************************************
-	 * Adds a bunch of keys into the ListedHashTree at the current level.
-	 *
-	 *@param keys  Collection of Keys to be added to ListedHashTree.
-	 ***************************************/
-	public void add(Collection keys)
-	{
-		Iterator it = keys.iterator();
-		while(it.hasNext())
-		{
-			add(it.next());
-		}
-	}
-
-	/****************************************
-	 * Adds a key and it's value in the ListedHashTree. It actually adds a key, and
-	 * then creates a node for the key and adds the value to the new node, as a
-	 * key.
-	 *
-	 *@param key    Key to be added.
-	 *@param value  Value to be added as a key in the secondary node.
-	 ***************************************/
-	public void add(Object key, Object value)
-	{
-		if(!data.containsKey(key))
-		{
-			set(key, value);
-		}
-		else
-		{
-			get(key).add(value);
-		}
-	}
-
-	/****************************************
-	 * Adds a key and it's values in the ListedHashTree. It Adds a key in the
-	 * current node, and then creates a node for that key, and adds all the values
-	 * in the array as keys in the new node.
-	 *
-	 *@param key     Key to be added.
-	 *@param values  Array of objects to be added as keys in the secondary node.
-	 ***************************************/
-	public void add(Object key, Object[] values)
-	{
-		if(!data.containsKey(key))
-		{
-			set(key, values);
-		}
-		else
-		{
-			get(key).add(values);
-		}
-	}
-
-	/****************************************
-	 * Adds a key and it's values in the ListedHashTree. It adds a key in the
-	 * current node, and then creates a node for that key, and adds all the values
-	 * in the Collection as keys in the new node.
-	 *
-	 *@param key     Key to be added.
-	 *@param values  Collection of objects to be added as keys in the secondary
-	 *      node.
-	 ***************************************/
-	public void add(Object key, Collection values)
-	{
-		if(!data.containsKey(key))
-		{
-			set(key, values);
-		}
-		else
-		{
-			get(key).add(values);
-		}
-	}
-
-	/****************************************
-	 * Adds a series of keys into the ListedHashTree. It sets up the first object
-	 * in the key array as a key in the current node, recurses into the next
-	 * ListedHashTree node through that key and adds the second object in the
-	 * array. Continues recursing in this manner until the end of the first array
-	 * is reached, at which point all the values of the second array are added as
-	 * keys to the bottom-most node.
-	 *
-	 *@param key     Array of keys to put into ListedHashTree.
-	 *@param values  Array of values to be added as keys to bottom-most node.
-	 ***************************************/
-	public void add(Object[] key, Object[] values)
-	{
-		List list = new LinkedList();
-		for(int x = 0; x < key.length; list.add(key[x++]))
-		{
-			;
-		}
-		add(list, values);
-	}
-
-	/****************************************
-	 * Adds a series of keys into the ListedHashTree. It sets up the first object
-	 * in the key array as a key in the current node, recurses into the next
-	 * ListedHashTree node through that key and adds the second object in the
-	 * array. Continues recursing in this manner until the end of the first array
-	 * is reached, at which point all the values of the second Collection are added
-	 * as keys to the bottom-most node.
-	 *
-	 *@param key     Array of keys to put into ListedHashTree.
-	 *@param values  Collection of values to be added as keys to bottom-most node.
-	 ***************************************/
-	public void add(Object[] key, Collection values)
-	{
-		List list = new LinkedList();
-		for(int x = 0; x < key.length; list.add(key[x++]))
-		{
-			;
-		}
-		add(list, values);
-	}
-
-	/****************************************
-	 * Adds a series of keys into the ListedHashTree. It sets up the first object
-	 * in the key List as a key in the current node, recurses into the next
-	 * ListedHashTree node through that key and adds the second object in the List.
-	 * Continues recursing in this manner until the end of the first List is
-	 * reached, at which point all the values of the second Array are added as keys
-	 * to the bottom-most node.
-	 *
-	 *@param key     List of keys to put into ListedHashTree.
-	 *@param values  Array of values to be added as keys to bottom-most node.
-	 ***************************************/
-	public void add(List key, Object[] values)
-	{
-		if(key == null || key.size() == 0)
-		{
-			add(values);
-			return;
-		}
-		else if(key.size() == 1)
-		{
-			add(key.get(0), values);
-		}
-		else
-		{
-			Object temp = key.get(0);
-			add(temp, key.get(1));
-			get(temp).add(key.subList(1, key.size()), values);
-		}
-	}
-
-	/****************************************
-	 * Adds a series of keys into the SortedListedHashTree. It sets up the first
-	 * object in the key List as a key in the current node, recurses into the next
-	 * SortedListedHashTree node through that key and adds the second object in the
-	 * List. Continues recursing in this manner until the end of the first List is
-	 * reached, at which point all the values of the second Collection are added as
-	 * keys to the bottom-most node.
-	 *
-	 *@param key     List of keys to put into SortedListedHashTree.
-	 *@param value   !ToDo (Parameter description)
-	 ***************************************/
-	public void add(List key, Object value)
-	{
-		if(key == null || key.size() == 0)
-		{
-			add(value);
-			return;
-		}
-		else if(key.size() == 1)
-		{
-			add(key.get(0), value);
-		}
-		else
-		{
-			Object temp = key.get(0);
-			add(temp, key.get(1));
-			get(temp).add(key.subList(1, key.size()), value);
-		}
-	}
-
-	/****************************************
-	 * Adds a series of keys into the ListedHashTree. It sets up the first object
-	 * in the key List as a key in the current node, recurses into the next
-	 * ListedHashTree node through that key and adds the second object in the List.
-	 * Continues recursing in this manner until the end of the first List is
-	 * reached, at which point all the values of the second Collection are added as
-	 * keys to the bottom-most node.
-	 *
-	 *@param key     List of keys to put into ListedHashTree.
-	 *@param values  Collection of values to be added as keys to bottom-most node.
-	 ***************************************/
-	public void add(List key, Collection values)
-	{
-		if(key == null || key.size() == 0)
-		{
-			add(values);
-			return;
-		}
-		else if(key.size() == 1)
-		{
-			add(key.get(0), values);
-		}
-		else
-		{
-			Object temp = key.get(0);
-			add(temp, key.get(1));
-			get(temp).add(key.subList(1, key.size()), values);
-		}
-	}
-
-	/****************************************
-	 * Adds a series of keys into the ListedHashTree. It sets up the first object
-	 * in the key SortedSet as a key in the current node, recurses into the next
-	 * ListedHashTree node through that key and adds the second object in the
-	 * SortedSet. Continues recursing in this manner until the end of the first
-	 * SortedSet is reached, at which point all the values of the second Array are
-	 * added as keys to the bottom-most node.
-	 *
-	 *@param key     SortedSet of keys to put into ListedHashTree.
-	 *@param values  Array of values to be added as keys to bottom-most node.
-	 ***************************************/
-	public void add(SortedSet key, Object[] values)
-	{
-		if(key.size() == 0)
-		{
-			return;
-		}
-		else if(key.size() == 1)
-		{
-			add(key.first(), values);
-		}
-		else
-		{
-			Iterator iter = key.iterator();
-			Object previous = null;
-			ListedHashTree tree = this;
-			while(iter.hasNext())
-			{
-				Object item = iter.next();
-				if(previous == null)
-				{
-					previous = item;
-				}
-				else
-				{
-					tree.add(previous, item);
-					tree = tree.get(item);
-				}
-			}
-			tree.add(values);
-		}
-	}
-
-	/****************************************
-	 * Adds a series of keys into the ListedHashTree. It sets up the first object
-	 * in the key SortedSet as a key in the current node, recurses into the next
-	 * ListedHashTree node through that key and adds the second object in the
-	 * SortedSet. Continues recursing in this manner until the end of the first
-	 * SortedSet is reached, at which point all the values of the second Collection
-	 * are added as keys to the bottom-most node.
-	 *
-	 *@param key     SortedSet of keys to put into ListedHashTree.
-	 *@param values  Collection of values to be added as keys to bottom-most node.
-	 ***************************************/
-	public void add(SortedSet key, Collection values)
-	{
-		if(key.size() == 0)
-		{
-			return;
-		}
-		else if(key.size() == 1)
-		{
-			add(key.first(), values);
-		}
-		else
-		{
-			Iterator iter = key.iterator();
-			Object previous = null;
-			ListedHashTree tree = this;
-			while(iter.hasNext())
-			{
-				Object item = iter.next();
-				if(previous == null)
-				{
-					previous = item;
-				}
-				else
-				{
-					tree.add(previous, item);
-					tree = tree.get(item);
-				}
-			}
-			tree.add(values);
-		}
-	}
-
-	/****************************************
-	 * Gets the ListedHashTree object mapped to the given key.
-	 *
-	 *@param key  Key used to find appropriate ListedHashTree()
-	 *@return     !ToDo (Return description)
-	 ***************************************/
-	public ListedHashTree get(Object key)
-	{
-		return (ListedHashTree)data.get(key);
-	}
-
-	/****************************************
-	 * Gets the ListedHashTree object mapped to the last key in the array by
-	 * recursing through the ListedHashTree structure one key at a time.
-	 *
-	 *@param keys  Array of keys.
-	 *@return      ListedHashTree at the end of the recursion.
-	 ***************************************/
-	public ListedHashTree get(Object[] keys)
-	{
-		List list = new LinkedList();
-		for(int x = 0; x < keys.length; list.add(keys[x++]))
-		{
-			;
-		}
-		return get(list);
-	}
-
-	/****************************************
-	 * Gets the ListedHashTree object mapped to the last key in the List by
-	 * recursing through the ListedHashTree structure one key at a time.
-	 *
-	 *@param keys  List of keys.
-	 *@return      ListedHashTree at the end of the recursion.
-	 ***************************************/
-	public ListedHashTree get(List keys)
-	{
-		if(keys.size() == 1)
-		{
-			return get(keys.get(0));
-		}
-		else if(keys.size() > 1)
-		{
-			return get(keys.get(0)).get(keys.subList(1, keys.size()));
-		}
-		return new ListedHashTree();
-	}
-
-	/****************************************
-	 * Gets the ListedHashTree object mapped to the last key in the SortedSet by
-	 * recursing through the ListedHashTree structure one key at a time.
-	 *
-	 *@param keys  SortedSet of keys.
-	 *@return      ListedHashTree at the end of the recursion.
-	 ***************************************/
-	public ListedHashTree get(SortedSet keys)
-	{
-		if(keys.size() == 1)
-		{
-			return get(keys.first());
-		}
-		else if(keys.size() > 1)
-		{
-			Iterator iter = keys.iterator();
-			ListedHashTree tree = this;
-			while(iter.hasNext())
-			{
-				tree = tree.get(iter.next());
-			}
-			return tree;
-		}
-		return new ListedHashTree();
-	}
-
-	/****************************************
-	 * Gets a Set of all keys in the current ListedHashTree node.
-	 *
-	 *@return   Set of all keys in this ListedHashTree.
-	 ***************************************/
-	public List list()
-	{
-		return order;
-	}
-
-	/****************************************
-	 * Gets a Set of all keys in the ListedHashTree mapped to the given key of the
-	 * current ListedHashTree object (in other words, one level down.
-	 *
-	 *@param key  Key used to find ListedHashTree to get list of.
-	 *@return     Set of all keys in found ListedHashTree.
-	 ***************************************/
-	public List list(Object key)
-	{
-		ListedHashTree temp = (ListedHashTree)data.get(key);
-		if(temp != null)
-		{
-			return temp.list();
-		}
-		else
-		{
-			return null;
-		}
-	}
-
-	/****************************************
-	 * !ToDo (Method description)
-	 *
-	 *@param key  !ToDo (Parameter description)
-	 ***************************************/
-	public void remove(Object key)
-	{
-		data.remove(key);
-		order.remove(key);
-	}
-
-	/****************************************
-	 * Recurses down into the ListedHashTree stucture using each subsequent key in
-	 * the array of keys, and returns the Set of keys of the ListedHashTree object
-	 * at the end of the recursion.
-	 *
-	 *@param keys  Array of keys used to recurse into ListedHashTree structure.
-	 *@return      Set of all keys found in end ListedHashTree.
-	 ***************************************/
-	public List list(Object[] keys)
-	{
-		List list = new LinkedList();
-		for(int x = 0; x < keys.length; list.add(keys[x++]))
-		{
-			;
-		}
-		return list(list);
-	}
-
-	/****************************************
-	 * Recurses down into the ListedHashTree stucture using each subsequent key in
-	 * the List of keys, and returns the Set of keys of the ListedHashTree object
-	 * at the end of the recursion.
-	 *
-	 *@param keys  List of keys used to recurse into ListedHashTree structure.
-	 *@return      Set of all keys found in end ListedHashTree.
-	 ***************************************/
-	public List list(List keys)
-	{
-		if(keys.size() == 0)
-		{
-			return list();
-		}
-		else if(keys.size() == 1)
-		{
-			return get(keys.get(0)).list();
-		}
-		else
-		{
-			return get(keys.get(0)).list(keys.subList(1, keys.size()));
-		}
-	}
-
-	/****************************************
-	 * Recurses down into the ListedHashTree stucture using each subsequent key in
-	 * the SortedSet of keys, and returns the Set of keys of the ListedHashTree
-	 * object at the end of the recursion.
-	 *
-	 *@param keys  SortedSet of keys used to recurse into ListedHashTree structure.
-	 *@return      Set of all keys found in end ListedHashTree.
-	 ***************************************/
-	public List list(SortedSet keys)
-	{
-		if(keys.size() == 0)
-		{
-			return list();
-		}
-		else if(keys.size() == 1)
-		{
-			return get(keys.first()).list();
-		}
-		else
-		{
-			Iterator iter = keys.iterator();
-			ListedHashTree tree = this;
-			while(iter.hasNext())
-			{
-				tree = tree.get(iter.next());
-			}
-			return tree.list();
-		}
-	}
-
-	/****************************************
-	 * Gets an array of all keys in the current ListedHashTree node.
-	 *
-	 *@return   Array of all keys in this ListedHashTree.
-	 ***************************************/
-	public Object[] getArray()
-	{
-		return order.toArray();
-	}
-
-	/****************************************
-	 * Gets an array of all keys in the ListedHashTree mapped to the given key of
-	 * the current ListedHashTree object (in other words, one level down.
-	 *
-	 *@param key  Key used to find ListedHashTree to get list of.
-	 *@return     Array of all keys in found ListedHashTree.
-	 ***************************************/
-	public Object[] getArray(Object key)
-	{
-		return get(key).getArray();
-	}
-
-	/****************************************
-	 * Recurses down into the ListedHashTree stucture using each subsequent key in
-	 * the array of keys, and returns an array of keys of the ListedHashTree object
-	 * at the end of the recursion.
-	 *
-	 *@param keys  Array of keys used to recurse into ListedHashTree structure.
-	 *@return      Array of all keys found in end ListedHashTree.
-	 ***************************************/
-	public Object[] getArray(Object[] keys)
-	{
-		List list = new LinkedList();
-		for(int x = 0; x < keys.length; list.add(keys[x++]))
-		{
-			;
-		}
-		return getArray(list);
-	}
-
-	/****************************************
-	 * Recurses down into the ListedHashTree stucture using each subsequent key in
-	 * the List of keys, and returns an array of keys of the ListedHashTree object
-	 * at the end of the recursion.
-	 *
-	 *@param keys  List of keys used to recurse into ListedHashTree structure.
-	 *@return      Array of all keys found in end ListedHashTree.
-	 ***************************************/
-	public Object[] getArray(List keys)
-	{
-		if(keys.size() == 0)
-		{
-			return getArray();
-		}
-		if(keys.size() == 1)
-		{
-			return getArray(keys.get(0));
-		}
-		else
-		{
-			return get(keys.get(0)).getArray(keys.subList(1, keys.size()));
-		}
-	}
-
-	/****************************************
-	 * Recurses down into the ListedHashTree stucture using each subsequent key in
-	 * the SortedSet of keys, and returns an array of keys of the ListedHashTree
-	 * object at the end of the recursion.
-	 *
-	 *@param keys  SortedSet of keys used to recurse into ListedHashTree structure.
-	 *@return      Array of all keys found in end ListedHashTree.
-	 ***************************************/
-	public Object[] getArray(SortedSet keys)
-	{
-		if(keys.size() == 0)
-		{
-			return getArray();
-		}
-		if(keys.size() == 1)
-		{
-			return getArray(keys.first());
-		}
-		else
-		{
-			Iterator iter = keys.iterator();
-			ListedHashTree tree = this;
-			while(iter.hasNext())
-			{
-				tree = tree.get(iter.next());
-			}
-			return tree.getArray();
-		}
-	}
-
-	/****************************************
-	 * !ToDo (Method description)
-	 *
-	 *@return   !ToDo (Return description)
-	 ***************************************/
-	public int hashCode()
-	{
-		return data.hashCode() * 7 + 3;
-	}
-
-	/****************************************
-	 * !ToDo (Method description)
-	 *
-	 *@param o  !ToDo (Parameter description)
-	 *@return   !ToDo (Return description)
-	 ***************************************/
-	public boolean equals(Object o)
-	{
-		boolean flag = true;
-		if(o instanceof ListedHashTree)
-		{
-			ListedHashTree oo = (ListedHashTree)o;
-			Iterator it = order.iterator();
-			while(it.hasNext())
-			{
-				if(!oo.containsKey(it.next()))
-				{
-					flag = false;
-					break;
-				}
-			}
-			if(flag)
-			{
-				it = order.iterator();
-				while(it.hasNext())
-				{
-					Object temp = it.next();
-					flag = get(temp).equals(oo.get(temp));
-					if(!flag)
-					{
-						break;
-					}
-				}
-			}
-		}
-		else
-		{
-			flag = false;
-		}
-		return flag;
-	}
-
-	/****************************************
-	 * !ToDo (Method description)
-	 *
-	 *@return   !ToDo (Return description)
-	 ***************************************/
-	public Set keySet()
-	{
-		return data.keySet();
-	}
-
-	/****************************************
-	 * Searches the ListedHashTree structure for the given key. If it finds the
-	 * key, it returns the ListedHashTree mapped to the key. If it finds nothing,
-	 * it returns null.
-	 *
-	 *@param key  Key to search for.
-	 *@return     ListedHashTree mapped to key, if found, otherwise <B>null</B> .
-	 ***************************************/
-	public ListedHashTree search(Object key)
-	{
-		ListedHashTree temp = null;
-		if(data.containsKey(key))
-		{
-			temp = (ListedHashTree)data.get(key);
-		}
-		else
-		{
-			Iterator it = list().iterator();
-			while(it.hasNext())
-			{
-				if(temp == null)
-				{
-					temp = ((ListedHashTree)it.next()).search(key);
-					break;
-				}
-				else
-				{
-					break;
-				}
-			}
-		}
-		return temp;
-	}
-
-	/****************************************
-	 * !ToDo (Method description)
-	 *
-	 *@return   !ToDo (Return description)
-	 ***************************************/
-	public int size()
-	{
-		return data.size();
-	}
-
-	/****************************************
-	 * The method debugs the entire tree all the way down (recursively)adding a tab
-	 * at each level. The debugging is only supported on the log4j output files.
-	 *
-	 *@param numTabs  The number of tabs (preferably make the first call with a
-	 *      value 0)
-	 **************************************
-	public void debugDeep(int numTabs)
-	{
-		if(!log.isDebugEnabled())
-		{
-			return;
-		}
-		if(numTabs == 0 && order.size() > 0)
-		{
-			log.debug("==============Starting the debugDeep:" + this + "===============");
-		}
-
-		StringBuffer tabBuffer = new StringBuffer(numTabs);
-		for(int i = 0; i < numTabs; i++)
-		{
-			tabBuffer.append("\t");
-		}
-		String tabs = tabBuffer.toString();
-
-		for(Iterator iter = order.iterator(); iter.hasNext(); )
-		{
-			Object obj = iter.next();
-			log.debug(tabs + obj);
-			ListedHashTree tree = get(obj);
-			tree.debugDeep(numTabs + 1);
-		}
-		if(numTabs == 0 && order.size() > 0)
-		{
-			log.debug("==============Ending the debugDeep===============");
-		}
-	}
-
-	/****************************************
-	 * Debugs all the elements in the current ListedHashTree
-	 ***************************************
-	public void debugShallow()
-	{
-		if(!log.isDebugEnabled())
-		{
-			return;
-		}
-		for(Iterator iter = order.iterator(); iter.hasNext(); )
-		{
-			log.debug(iter.next());
-		}
-	}*/
-
-
-
-	void readObject(ObjectInputStream ois) throws ClassNotFoundException, IOException
-	{
-		ois.defaultReadObject();
-	}
-
-	void writeObject(ObjectOutputStream oos) throws IOException
-	{
-		oos.defaultWriteObject();
-	}
-
-	/****************************************
-	 * !ToDo (Class description)
-	 *
-	 *@author    $Author: mstover1 $
-	 *@created   $Date: 2002/08/11 19:24:49 $
-	 *@version   $Revision: 1.1 $
-	 ***************************************/
-	public static class Test extends junit.framework.TestCase
-	{
-		/****************************************
-		 * !ToDo (Constructor description)
-		 *
-		 *@param name  !ToDo (Parameter description)
-		 ***************************************/
-		public Test(String name)
-		{
-			super(name);
-		}
-
-		/****************************************
-		 * !ToDo
-		 *
-		 *@exception Exception  !ToDo (Exception description)
-		 ***************************************/
-		public void testAddObjectAndTree() throws Exception
-		{
-			ListedHashTree tree = new ListedHashTree("key");
-			ListedHashTree newTree = new ListedHashTree("value");
-			tree.add("key", newTree);
-			assertEquals(tree.list().size(), 1);
-			assertEquals(tree.getArray()[0], "key");
-			assertEquals(tree.get("key").list().size(), 1);
-			assertEquals(tree.get("key").get("value").size(), 0);
-			assertEquals(tree.get("key").getArray()[0], "value");
-			this.assertNotNull(tree.get("key").get("value"));
-		}
-	}
-
-}
diff --git a/jakarta-jmeter/src/core/org/apache/jmeter/util/ListedHashTreeVisitor.java b/jakarta-jmeter/src/core/org/apache/jmeter/util/ListedHashTreeVisitor.java
deleted file mode 100644
index fe3d8bd..0000000
--- a/jakarta-jmeter/src/core/org/apache/jmeter/util/ListedHashTreeVisitor.java
+++ /dev/null
@@ -1,34 +0,0 @@
-package org.apache.jmeter.util;
-
-/**
- * <p>Title: </p>
- * <p>Description: </p>
- * <p>Copyright: Copyright (c) 2001</p>
- * <p>Company: </p>
- * @author unascribed
- * @version 1.0
- */
-
-public interface ListedHashTreeVisitor
-{
-
-	/**
-	 * The tree traverses itself depth-first, calling processNode for each object
-	 * it encounters as it goes.
-	 */
-	public void addNode(Object node,ListedHashTree subTree);
-
-	/**
-	 * Indicates traversal has moved up a step, and the visitor should remove the
-	 * top node from it's stack structure.
-	 */
-	public void subtractNode();
-
-	/**
-	 * Process path is called when a leaf is reached.  If a visitor wishes to generate
-	 * Lists of path elements to each leaf, it should keep a Stack data structure of
-	 * nodes passed to it with addNode, and removing top items for every subtractNode()
-	 * call.
-	 */
-	public void processPath();
-}
\ No newline at end of file
diff --git a/jakarta-jmeter/src/core/org/apache/jmeter/save/old/BadHandlerException.java b/jakarta-jmeter/src/core/org/apache/jmeter/util/LocaleChangeEvent.java
similarity index 83%
rename from jakarta-jmeter/src/core/org/apache/jmeter/save/old/BadHandlerException.java
rename to jakarta-jmeter/src/core/org/apache/jmeter/util/LocaleChangeEvent.java
index ee4c403..53e5da8 100644
--- a/jakarta-jmeter/src/core/org/apache/jmeter/save/old/BadHandlerException.java
+++ b/jakarta-jmeter/src/core/org/apache/jmeter/util/LocaleChangeEvent.java
@@ -2,7 +2,7 @@
  * ====================================================================
  * The Apache Software License, Version 1.1
  *
- * Copyright (c) 2001 The Apache Software Foundation.  All rights
+ * Copyright (c) 2002 The Apache Software Foundation.  All rights
  * reserved.
  *
  * Redistribution and use in source and binary forms, with or without
@@ -53,33 +53,35 @@
  * <http://www.apache.org/>.
  */
 
+package org.apache.jmeter.util;
+
+
+import java.util.*;
+
+
 /**
- * Title:        JMeter<p>
- * Description:  <p>
- * Copyright:    Copyright (c) Michael Stover<p>
- * Company:      Apache JMeter<p>
- * @author Michael Stover
- * @version 1.0
+ * @author Oliver Rossmueller <oliver@oross.net>
  */
- package org.apache.jmeter.save.old;
+public class LocaleChangeEvent extends EventObject {
 
-public class BadHandlerException extends Exception
-{
-  String message;
+    private Locale locale;
+    
 
-  public BadHandlerException()
-  {
-  }
+    public LocaleChangeEvent(Object source)
+    {
+        super(source);
+    }
 
-  public BadHandlerException(String m)
-  {
-	 message = m;
-  }
 
-  public String getMessage()
-  {
-	 return message;
-  }
+    public LocaleChangeEvent(Object source, Locale locale)
+    {
+        super(source);
+        this.locale = locale;
+    }
 
 
-}
\ No newline at end of file
+    public Locale getLocale()
+    {
+        return locale;
+    }
+}
diff --git a/jakarta-jmeter/src/core/org/apache/jmeter/save/old/xml/NameSpaceHandler.java b/jakarta-jmeter/src/core/org/apache/jmeter/util/LocaleChangeListener.java
similarity index 88%
rename from jakarta-jmeter/src/core/org/apache/jmeter/save/old/xml/NameSpaceHandler.java
rename to jakarta-jmeter/src/core/org/apache/jmeter/util/LocaleChangeListener.java
index 98ed000..d114f91 100644
--- a/jakarta-jmeter/src/core/org/apache/jmeter/save/old/xml/NameSpaceHandler.java
+++ b/jakarta-jmeter/src/core/org/apache/jmeter/util/LocaleChangeListener.java
@@ -2,7 +2,7 @@
  * ====================================================================
  * The Apache Software License, Version 1.1
  *
- * Copyright (c) 2001 The Apache Software Foundation.  All rights
+ * Copyright (c) 2002 The Apache Software Foundation.  All rights
  * reserved.
  *
  * Redistribution and use in source and binary forms, with or without
@@ -52,21 +52,18 @@
  * information on the Apache Software Foundation, please see
  * <http://www.apache.org/>.
  */
- package org.apache.jmeter.save.old.xml;
 
-import org.xml.sax.Attributes;
+package org.apache.jmeter.util;
+
+
+import org.apache.jmeter.util.LocaleChangeEvent;
+
 
 /**
- * Title:
- * Description:
- * Copyright:    Copyright (c) 2000
- * Company:
- * @author
- * @version 1.0
+ * @author Oliver Rossmueller <oliver@oross.net>
  */
+public interface LocaleChangeListener {
 
-public interface NameSpaceHandler
-{
+    public void localeChanged(LocaleChangeEvent event);
 
-	public TagHandler getXmlObject(String tagName,Attributes atts);
-}
\ No newline at end of file
+}
diff --git a/jakarta-jmeter/src/core/org/apache/jmeter/util/SSLManager.java b/jakarta-jmeter/src/core/org/apache/jmeter/util/SSLManager.java
index d29274b..2306515 100644
--- a/jakarta-jmeter/src/core/org/apache/jmeter/util/SSLManager.java
+++ b/jakarta-jmeter/src/core/org/apache/jmeter/util/SSLManager.java
@@ -54,17 +54,20 @@
  */
 package org.apache.jmeter.util;
 
-import java.lang.reflect.Constructor;
 import java.io.File;
 import java.io.FileInputStream;
+import java.lang.reflect.Constructor;
+import java.net.HttpURLConnection;
+import java.security.KeyStore;
 import java.security.Provider;
 import java.security.Security;
-import java.security.KeyStore;
-import java.net.HttpURLConnection;
+
 import javax.swing.JOptionPane;
 
 import org.apache.jmeter.gui.GuiPackage;
 import org.apache.jmeter.util.keystore.JmeterKeyStore;
+import org.apache.log.Hierarchy;
+import org.apache.log.Logger;
 
 /**
  * The SSLManager handles the KeyStore information for JMeter.  Basically, it
@@ -74,9 +77,11 @@ import org.apache.jmeter.util.keystore.JmeterKeyStore;
  * make a decision, it will pop open a dialog asking you for more information.
  *
  * @author <a href="bloritsch@apache.org">Berin Loritsch</a>
- * @version CVS $Revision: 1.1 $ $Date: 2002/08/11 19:24:49 $
+ * @version CVS $Revision: 1.5 $ $Date: 2002/12/27 15:51:17 $
  */
 public abstract class SSLManager {
+	transient private static Logger log = Hierarchy.getDefaultHierarchy().getLoggerFor(
+			"jmeter.util");
     /** Singleton instance of the manager */
     private static SSLManager manager;
     private static boolean isIAIKProvider = false;
@@ -126,11 +131,11 @@ public abstract class SSLManager {
             try {
                 if (fileName.endsWith(".p12") || fileName.endsWith(".P12")) {
                     this.keyStore = JmeterKeyStore.getInstance("pkcs12");
-                    System.out.println("KeyStore Type: PKCS 12");
+                    log.info("KeyStore Type: PKCS 12");
                     System.setProperty("javax.net.ssl.keyStoreType", "pkcs12");
                 } else {
                     this.keyStore = JmeterKeyStore.getInstance("JKS");
-                    System.out.println("KeyStore Type: JKS");
+                    log.info("KeyStore Type: JKS");
                 }
             } catch (Exception e) {
                 JOptionPane.showMessageDialog(GuiPackage.getInstance().getMainFrame(),
@@ -164,19 +169,16 @@ public abstract class SSLManager {
                 File initStore = new File(fileName);
 
                 if (initStore.exists()) {
-                    try {
-                        this.keyStore.load(new FileInputStream(initStore), password);
-                    } catch (Exception e) {
-                        throw new RuntimeException("Can't load KeyStore!!!  " + e.getMessage());
-                    }
+		    this.keyStore.load(new FileInputStream(initStore),password);
                 } else {
                     this.keyStore.load(null, password);
                 }
             } catch (Exception e) {
+	      throw new RuntimeException("Can't load KeyStore: "+e.toString());
             }
 
-        System.out.println("JmeterKeyStore Location: " + fileName);
-        System.out.println("JmeterKeyStore type: " + this.keyStore.getClass().toString());
+        log.info("JmeterKeyStore Location: " + fileName);
+        log.info("JmeterKeyStore type: " + this.keyStore.getClass().toString());
         }
 
         return this.keyStore;
@@ -195,7 +197,7 @@ public abstract class SSLManager {
                     this.trustStore = KeyStore.getInstance("IAIKKeyStore", "IAIK");
                 }  else {
                     this.trustStore = KeyStore.getInstance("JKS");
-                    System.out.println("KeyStore Type: JKS");
+                    log.info("KeyStore Type: JKS");
                 }
             } catch (Exception e) {
                 JOptionPane.showMessageDialog(GuiPackage.getInstance().getMainFrame(),
@@ -210,19 +212,16 @@ public abstract class SSLManager {
                 File initStore = new File(fileName);
 
                 if (initStore.exists()) {
-                    try {
-                        this.trustStore.load(new FileInputStream(initStore), null);
-                    } catch (Exception e) {
-                        throw new RuntimeException("Can't load KeyStore!!!  " + e.getMessage());
-                    }
+		    this.trustStore.load(new FileInputStream(initStore), null);
                 } else {
                     this.trustStore.load(null, null);
                 }
             } catch (Exception e) {
+	      throw new RuntimeException("Can't load TrustStore: "+e.toString());
             }
 
-            System.out.println("TrustStore Location: " + fileName);
-            System.out.println("TrustStore type: " + this.keyStore.getClass().toString());
+            log.info("TrustStore Location: " + fileName);
+            log.info("TrustStore type: " + this.keyStore.getClass().toString());
         }
 
         return this.trustStore;
@@ -253,7 +252,7 @@ public abstract class SSLManager {
                     Constructor con = clazz.getConstructor(new Class[] {Provider.class});
                     SSLManager.manager = (SSLManager) con.newInstance(new Object[] {SSLManager.sslProvider});
                 } catch (Exception e) {
-                    e.printStackTrace(System.err);
+                    log.error("",e);
                     SSLManager.isSSLSupported = false;
                     return null;
                 }
@@ -285,12 +284,12 @@ public abstract class SSLManager {
                 SSLManager.isSSLSupported = true;
             }
         } catch (Exception noSSL) {
-            noSSL.printStackTrace(System.err);
+            log.error("",noSSL);
         }
 
         try {
             if(SSLManager.sslProvider != null) {
-                System.out.println("SSL Provider is: " + SSLManager.sslProvider);
+                log.info("SSL Provider is: " + SSLManager.sslProvider);
                 Security.addProvider(SSLManager.sslProvider);
                 // register jsse provider
             }
diff --git a/jakarta-jmeter/src/core/org/apache/jmeter/util/SearchByClass.java b/jakarta-jmeter/src/core/org/apache/jmeter/util/SearchByClass.java
deleted file mode 100644
index aa75d13..0000000
--- a/jakarta-jmeter/src/core/org/apache/jmeter/util/SearchByClass.java
+++ /dev/null
@@ -1,51 +0,0 @@
-package org.apache.jmeter.util;
-import java.util.*;
-/**
- * <p>Title: </p>
- * <p>Description: </p>
- * <p>Copyright: Copyright (c) 2001</p>
- * <p>Company: </p>
- * @author unascribed
- * @version 1.0
- */
-public class SearchByClass implements ListedHashTreeVisitor {
-	List objectsOfClass = new LinkedList();
-	Map subTrees = new HashMap();
-	Class searchClass = null;
-	public SearchByClass() {}
-	public SearchByClass(Class searchClass) {
-		this.searchClass = searchClass;
-	}
-	public Collection getSearchResults() {
-		return objectsOfClass;
-	}
-	public ListedHashTree getSubTree(Object root) {
-		return (ListedHashTree) subTrees.get(root);
-	}
-	public void addNode(Object node, ListedHashTree subTree) {
-		if (searchClass.isAssignableFrom(node.getClass())) {
-			objectsOfClass.add(node);
-			ListedHashTree tree = new ListedHashTree(node);
-			tree.set(node, subTree);
-			subTrees.put(node, tree);
-		}
-	}
-	public static class Test extends junit.framework.TestCase {
-		public Test(String name) {
-			super(name);
-		}
-		public void testSearch() throws Exception {
-			ListedHashTree tree = new ListedHashTree();
-			SearchByClass searcher = new SearchByClass(Integer.class);
-			String one = "one";
-			String two = "two";
-			Integer o = new Integer(1);
-			tree.add(one, o);
-			tree.get(one).add(o, two);
-			tree.traverse(searcher);
-			assertEquals(1, searcher.getSearchResults().size());
-		}
-	}
-	public void subtractNode() {}
-	public void processPath() {}
-}
\ No newline at end of file
diff --git a/jakarta-jmeter/src/core/org/apache/jmeter/util/SortedHashTree.java b/jakarta-jmeter/src/core/org/apache/jmeter/util/SortedHashTree.java
deleted file mode 100644
index 5f17c12..0000000
--- a/jakarta-jmeter/src/core/org/apache/jmeter/util/SortedHashTree.java
+++ /dev/null
@@ -1,821 +0,0 @@
-/*
- * ====================================================================
- * The Apache Software License, Version 1.1
- *
- * Copyright (c) 2001 The Apache Software Foundation.  All rights
- * reserved.
- *
- * Redistribution and use in source and binary forms, with or without
- * modification, are permitted provided that the following conditions
- * are met:
- *
- * 1. Redistributions of source code must retain the above copyright
- * notice, this list of conditions and the following disclaimer.
- *
- * 2. Redistributions in binary form must reproduce the above copyright
- * notice, this list of conditions and the following disclaimer in
- * the documentation and/or other materials provided with the
- * distribution.
- *
- * 3. The end-user documentation included with the redistribution,
- * if any, must include the following acknowledgment:
- * "This product includes software developed by the
- * Apache Software Foundation (http://www.apache.org/)."
- * Alternately, this acknowledgment may appear in the software itself,
- * if and wherever such third-party acknowledgments normally appear.
- *
- * 4. The names "Apache" and "Apache Software Foundation" and
- * "Apache JMeter" must not be used to endorse or promote products
- * derived from this software without prior written permission. For
- * written permission, please contact apache@apache.org.
- *
- * 5. Products derived from this software may not be called "Apache",
- * "Apache JMeter", nor may "Apache" appear in their name, without
- * prior written permission of the Apache Software Foundation.
- *
- * THIS SOFTWARE IS PROVIDED ``AS IS'' AND ANY EXPRESSED OR IMPLIED
- * WARRANTIES, INCLUDING, BUT NOT LIMITED TO, THE IMPLIED WARRANTIES
- * OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE ARE
- * DISCLAIMED.  IN NO EVENT SHALL THE APACHE SOFTWARE FOUNDATION OR
- * ITS CONTRIBUTORS BE LIABLE FOR ANY DIRECT, INDIRECT, INCIDENTAL,
- * SPECIAL, EXEMPLARY, OR CONSEQUENTIAL DAMAGES (INCLUDING, BUT NOT
- * LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES; LOSS OF
- * USE, DATA, OR PROFITS; OR BUSINESS INTERRUPTION) HOWEVER CAUSED AND
- * ON ANY THEORY OF LIABILITY, WHETHER IN CONTRACT, STRICT LIABILITY,
- * OR TORT (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT
- * OF THE USE OF THIS SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF
- * SUCH DAMAGE.
- * ====================================================================
- *
- * This software consists of voluntary contributions made by many
- * individuals on behalf of the Apache Software Foundation.  For more
- * information on the Apache Software Foundation, please see
- * <http://www.apache.org/>.
- */
-
-package org.apache.jmeter.util;
-
-import java.io.*;
-import java.util.*;
-
-/**********************************************************************
-This class is used to create a tree structure of objects.  Each element in the tree
-is also a key to the next node down in the tree.
-***********************************************************************/
-public class SortedHashTree implements Serializable
-{
-
-  public SortedHashTree()
-  {
-	 data = new TreeMap();
-  }
-
-  public SortedHashTree(Object key)
-  {
-	 data = new TreeMap();
-	 data.put(key,new SortedHashTree());
-  }
-
-  public SortedHashTree(Collection keys)
-  {
-	 data = new TreeMap();
-	 Iterator it = keys.iterator();
-	 while(it.hasNext())
-		data.put(it.next(),new SortedHashTree());
-  }
-
-  public SortedHashTree(Object[] keys)
-  {
-	 data = new TreeMap();
-	 for(int x = 0;x < keys.length;x++)
-		data.put(keys[x],new SortedHashTree());
-  }
-
-/************************************************************
-  If the SortedHashTree contains the given object as a key at the top level, then a
-  true result is returned, otherwise false.
-@param obj Object to be tested as a key.
-@return True if the SortedHashTree contains the key, false otherwise.
-***************************************************************/
-  public boolean containsKey(Object o)
-  {
-	 return data.containsKey(o);
-  }
-
-/*****************************************************************
-  If the SortedHashTree is empty, true is returned, false otherwise.
-@return True if SortedHashTree is empty, false otherwise.
-***************************************************************/
-  public boolean isEmpty()
-  {
-	 return data.isEmpty();
-  }
-
-/************************************************************************
-  Sets a key and it's value in the SortedHashTree.  It actually sets up a key, and then
-  creates a node for the key and adds the value to the new node, as a key.
-@param key Key to be set up.
-@param value Value to be set up as a key in the secondary node.
-*************************************************************************/
-  public void set(Object key,Object value)
-  {
-	 data.put(key,new SortedHashTree(value));
-  }
-
-/************************************************************************
-Sets a key and it's values in the SortedHashTree.  It sets up a key in the current node, and
-then creates a node for that key, and adds all the values in the array as keys in
- the new node.
-@param key Key to be set up.
-@param values Array of objects to be added as keys in the secondary node.
-********************************************************************/
-  public void set(Object key,Object[] values)
-  {
-	 data.put(key,new SortedHashTree(values));
-  }
-
-/********************************************************************
- Sets a key and it's values in the SortedHashTree.  It sets up a key in the current node, and
- then creates a node for that key, and adds all the values in the array as keys in
- the new node.
-@param key Key to be set up.
-@param values Collection of objects to be added as keys in the secondary node.
-**************************************************************************/
-  public void set(Object key,Collection values)
-  {
-	 data.put(key,new SortedHashTree(values));
-  }
-
-/********************************************************************
- Sets a key and it's values in the SortedHashTree.  It sets up a key in the current node, and
- then creates a node for that key, and adds all the values in the array as keys in
- the new node.
-@param key Key to be set up.
-@param tree SortedHashTree that the key maps to.
-**************************************************************************/
-  public void set(Object key,SortedHashTree t)
-  {
-	 data.put(key,t);
-  }
-
-/********************************************************************
-  Sets a series of keys into the SortedHashTree.  It sets up the first object in the
-  key array as a key in the current node, recurses into the next SortedHashTree node through
-  that key and adds the second object in the array.  Continues recursing in this
-  manner until the end of the first array is reached, at which point all the
-  values of the second array are added as keys to the bottom-most node.
-@param key Array of keys to put into SortedHashTree.
-@param values Array of values to be added as keys to bottom-most node.
-********************************************************************/
-  public void set(Object[] key,Object[] values)
-  {
-	 List keys = new LinkedList();
-	 for(int x = 0;x < key.length;keys.add(key[x++]));
-	 set(keys,values);
-  }
-
-/********************************************************************
-  Sets a series of keys into the SortedHashTree.  It sets up the first object in the
-  key array as a key in the current node, recurses into the next SortedHashTree node through
-  that key and adds the second object in the array.  Continues recursing in this
-  manner until the end of the first array is reached, at which point all the
-  values of the Collection of values are added as keys to the bottom-most node.
-@param key Array of keys to put into SortedHashTree.
-@param values Collection of values to be added as keys to bottom-most node.
-********************************************************************/
-  public void set(Object[] key,Collection values)
-  {
-	 List keys = new LinkedList();
-	 for(int x = 0;x < key.length;keys.add(key[x++]));
-	 set(keys,values);
-  }
-
-/********************************************************************
-  Sets a series of keys into the SortedHashTree.  It sets up the first object in the
-  key list as a key in the current node, recurses into the next SortedHashTree node through
-  that key and adds the second object in the list.  Continues recursing in this
-  manner until the end of the first list is reached, at which point all the
-  values of the array of values are added as keys to the bottom-most node.
-@param key List of keys to put into SortedHashTree.
-@param values Array of values to be added as keys to bottom-most node.
-********************************************************************/
-  public void set(List key,Object[] values)
-  {
-	 if(key.size() == 0)
-		return;
-	 else if(key.size() == 1)
-		set(key.get(0),values);
-	 else
-	 {
-		Object temp = key.remove(0);
-		add(temp,key.get(0));
-		get(temp).set(key,values);
-	 }
-  }
-
-/********************************************************************
-  Sets a series of keys into the SortedHashTree.  It sets up the first object in the
-  key list as a key in the current node, recurses into the next SortedHashTree node through
-  that key and adds the second object in the list.  Continues recursing in this
-  manner until the end of the first list is reached, at which point all the
-  values of the Collection of values are added as keys to the bottom-most node.
-@param key List of keys to put into SortedHashTree.
-@param values Collection of values to be added as keys to bottom-most node.
-********************************************************************/
-  public void set(List key,Collection values)
-  {
-	 if(key.size() == 0)
-		return;
-	 else if(key.size() == 1)
-		set(key.get(0),values);
-	 else
-	 {
-		Object temp = key.remove(0);
-		add(temp,key.get(0));
-		get(temp).set(key,values);
-	 }
-  }
-
-/********************************************************************
-  Sets a series of keys into the SortedHashTree.  It sets up the first object in the
-  key SortedSet as a key in the current node, recurses into the next SortedHashTree node through
-  that key and adds the second object in the SortedSet.  Continues recursing in this
-  manner until the end of the first SortedSet is reached, at which point all the
-  values of the array of values are added as keys to the bottom-most node.
-@param key SortedSet of keys to put into SortedHashTree.
-@param values Array of values to be added as keys to bottom-most node.
-********************************************************************/
-  public void set(SortedSet key,Object[] values)
-  {
-	 Object temp;
-	 if(key.size() == 0)
-		return;
-	 else if(key.size() == 1)
-		set(key.first(),values);
-	 else
-	 {
-		temp = key.first();
-		key.remove(temp);
-		add(temp,key.first());
-		get(temp).set(key,values);
-	 }
-  }
-
-/********************************************************************
-  Sets a series of keys into the SortedHashTree.  It sets up the first object in the
-  key SortedSet as a key in the current node, recurses into the next SortedHashTree node through
-  that key and adds the second object in the SortedSet.  Continues recursing in this
-  manner until the end of the first SortedSet is reached, at which point all the
-  values of the Collection of values are added as keys to the bottom-most node.
-@param key SortedSet of keys to put into SortedHashTree.
-@param values Collection of values to be added as keys to bottom-most node.
-********************************************************************/
-  public void set(SortedSet key,Collection values)
-  {
-	 Object temp;
-	 if(key.size() == 0)
-		return;
-	 else if(key.size() == 1)
-		set(key.first(),values);
-	 else
-	 {
-		temp = key.first();
-		key.remove(temp);
-		add(temp,key.first());
-		get(temp).set(key,values);
-	 }
-  }
-
-/*********************************************************************
-Adds an key into the SortedHashTree at the current level.
-@param key Key to be added to SortedHashTree.
-*****************************************************************/
-  public void add(Object key)
-  {
-	 if(!data.containsKey(key))
-		data.put(key,new SortedHashTree());
-  }
-
-/*******************************************************************
-Adds a bunch of keys into the SortedHashTree at the current level.
-@param keys Array of Keys to be added to SortedHashTree.
-*******************************************************************/
-  public void add(Object[] keys)
-  {
-	 for(int x = 0;x < keys.length;x++)
-		add(keys[x]);
-  }
-
-/*******************************************************************
-Adds a bunch of keys into the SortedHashTree at the current level.
-@param keys Collection of Keys to be added to SortedHashTree.
-*******************************************************************/
-  public void add(Collection keys)
-  {
-	 Iterator it = keys.iterator();
-	 while(it.hasNext())
-		add(it.next());
-  }
-
-/************************************************************************
-  Adds a key and it's value in the SortedHashTree.  It actually adds  a key, and then
-  creates a node for the key and adds the value to the new node, as a key.
-@param key Key to be added.
-@param value Value to be added as a key in the secondary node.
-*************************************************************************/
-  public void add(Object key,Object value)
-  {
-	 if(!data.containsKey(key))
-		set(key,value);
-	 else
-		get(key).add(value);
-  }
-
-/************************************************************************
-Adds a key and it's values in the SortedHashTree.  It Adds a key in the current node, and
-then creates a node for that key, and adds all the values in the array as keys in
- the new node.
-@param key Key to be added.
-@param values Array of objects to be added as keys in the secondary node.
-********************************************************************/
-  public void add(Object key,Object[] values)
-  {
-	 if(!data.containsKey(key))
-		set(key,values);
-	 else
-		get(key).add(values);
-  }
-
-/************************************************************************
-Adds a key and it's values in the SortedHashTree.  It adds a key in the current node, and
-then creates a node for that key, and adds all the values in the Collection as keys in
- the new node.
-@param key Key to be added.
-@param values Collection of objects to be added as keys in the secondary node.
-********************************************************************/
-  public void add(Object key,Collection values)
-  {
-	 if(!data.containsKey(key))
-		set(key,values);
-	 else
-		get(key).add(values);
-  }
-
-/********************************************************************
-  Adds a series of keys into the SortedHashTree.  It sets up the first object in the
-  key array as a key in the current node, recurses into the next SortedHashTree node through
-  that key and adds the second object in the array.  Continues recursing in this
-  manner until the end of the first array is reached, at which point all the
-  values of the second array are added as keys to the bottom-most node.
-@param key Array of keys to put into SortedHashTree.
-@param values Array of values to be added as keys to bottom-most node.
-********************************************************************/
-  public void add(Object[] key,Object[] values)
-  {
-	 List list = new LinkedList();
-	 for(int x = 0;x < key.length;list.add(key[x++]));
-	 add(list,values);
-  }
-
-/********************************************************************
-  Adds a series of keys into the SortedHashTree.  It sets up the first object in the
-  key array as a key in the current node, recurses into the next SortedHashTree node through
-  that key and adds the second object in the array.  Continues recursing in this
-  manner until the end of the first array is reached, at which point all the
-  values of the second Collection are added as keys to the bottom-most node.
-@param key Array of keys to put into SortedHashTree.
-@param values Collection of values to be added as keys to bottom-most node.
-********************************************************************/
-  public void add(Object[] key,Collection values)
-  {
-	 List list = new LinkedList();
-	 for(int x = 0;x < key.length;list.add(key[x++]));
-	 add(list,values);
-  }
-
-/********************************************************************
-  Adds a series of keys into the SortedHashTree.  It sets up the first object in the
-  key List as a key in the current node, recurses into the next SortedHashTree node through
-  that key and adds the second object in the List.  Continues recursing in this
-  manner until the end of the first List is reached, at which point all the
-  values of the second Array are added as keys to the bottom-most node.
-@param key List of keys to put into SortedHashTree.
-@param values Array of values to be added as keys to bottom-most node.
-********************************************************************/
-  public void add(List key,Object[] values)
-  {
-	 if(key.size() == 0)
-		return;
-	 else if(key.size() == 1)
-		add(key.get(0),values);
-	 else
-	 {
-		Object temp = key.remove(0);
-		add(temp,key.get(0));
-		get(temp).add(key,values);
-	 }
-  }
-
-/********************************************************************
-  Adds a series of keys into the SortedHashTree.  It sets up the first object in the
-  key List as a key in the current node, recurses into the next SortedHashTree node through
-  that key and adds the second object in the List.  Continues recursing in this
-  manner until the end of the first List is reached, at which point all the
-  values of the second Collection are added as keys to the bottom-most node.
-@param key List of keys to put into SortedHashTree.
-@param values Collection of values to be added as keys to bottom-most node.
-********************************************************************/
-  public void add(List key,Collection values)
-  {
-	 if(key.size() == 0)
-		return;
-	 else if(key.size() == 1)
-		add(key.get(0),values);
-	 else
-	 {
-		Object temp = key.remove(0);
-		add(temp,key.get(0));
-		get(temp).add(key,values);
-	 }
-  }
-
-  /********************************************************************
-  Adds a series of keys into the SortedHashTree.  It sets up the first object in the
-  key List as a key in the current node, recurses into the next SortedHashTree node through
-  that key and adds the second object in the List.  Continues recursing in this
-  manner until the end of the first List is reached, at which point all the
-  values of the second Collection are added as keys to the bottom-most node.
-@param key List of keys to put into SortedHashTree.
-@param values Collection of values to be added as keys to bottom-most node.
-********************************************************************/
-  public void add(List key,Object value)
-  {
-	 if(key.size() == 0)
-		return;
-	 else if(key.size() == 1)
-		  add(key.get(0),value);
-	 else
-	 {
-		Object temp = key.remove(0);
-		add(temp,key.get(0));
-		get(temp).add(key,value);
-	 }
-  }
-
-/********************************************************************
-  Adds a series of keys into the SortedHashTree.  It sets up the first object in the
-  key SortedSet as a key in the current node, recurses into the next SortedHashTree node through
-  that key and adds the second object in the SortedSet.  Continues recursing in this
-  manner until the end of the first SortedSet is reached, at which point all the
-  values of the second Array are added as keys to the bottom-most node.
-@param key SortedSet of keys to put into SortedHashTree.
-@param values Array of values to be added as keys to bottom-most node.
-********************************************************************/
-  public void add(SortedSet key,Object[] values)
-  {
-	 if(key.size() == 0)
-		return;
-	 else if(key.size() == 1)
-		add(key.first(),values);
-	 else
-	 {
-		Object temp = key.first();
-		key.remove(temp);
-		add(temp,key.first());
-		get(temp).add(key,values);
-	 }
-  }
-
-/********************************************************************
-  Adds a series of keys into the SortedHashTree.  It sets up the first object in the
-  key SortedSet as a key in the current node, recurses into the next SortedHashTree node through
-  that key and adds the second object in the SortedSet.  Continues recursing in this
-  manner until the end of the first SortedSet is reached, at which point all the
-  values of the second Collection are added as keys to the bottom-most node.
-@param key SortedSet of keys to put into SortedHashTree.
-@param values Collection of values to be added as keys to bottom-most node.
-********************************************************************/
-  public void add(SortedSet key,Collection values)
-  {
-	 if(key.size() == 0)
-		return;
-	 else if(key.size() == 1)
-		add(key.first(),values);
-	 else
-	 {
-		Object temp = key.first();
-		key.remove(temp);
-		add(temp,key.first());
-		get(temp).add(key,values);
-	 }
-  }
-
-/*********************************************************************
-Gets the SortedHashTree object mapped to the given key.
-@param key Key used to find appropriate SortedHashTree()
-********************************************************************/
-  public SortedHashTree get(Object key)
-  {
-	 return (SortedHashTree)data.get(key);
-  }
-
-/*************************************************************
-Gets the SortedHashTree object mapped to the last key in the array by recursing through
-the SortedHashTree structure one key at a time.
-@param keys Array of keys.
-@return SortedHashTree at the end of the recursion.
-**************************************************************/
-  public SortedHashTree get(Object[] keys)
-  {
-	 List list = new LinkedList();
-	 for(int x = 0;x < keys.length;list.add(keys[x++]));
-	 return get(list);
-  }
-
-/*************************************************************
-Gets the SortedHashTree object mapped to the last key in the List by recursing through
-the SortedHashTree structure one key at a time.
-@param keys List of keys.
-@return SortedHashTree at the end of the recursion.
-**************************************************************/
-  public SortedHashTree get(List keys)
-  {
-	 if(keys.size() == 1)
-		return get(keys.get(0));
-	 else if(keys.size() > 1)
-	 {
-		Object temp = keys.remove(0);
-		return get(temp).get(keys);
-	 }
-	 return new SortedHashTree();
-  }
-
-/*************************************************************
-Gets the SortedHashTree object mapped to the last key in the SortedSet by recursing through
-the SortedHashTree structure one key at a time.
-@param keys SortedSet of keys.
-@return SortedHashTree at the end of the recursion.
-**************************************************************/
-  public SortedHashTree get(SortedSet keys)
-  {
-	 if(keys.size() == 1)
-		return get(keys.first());
-	 else if(keys.size() > 1)
-	 {
-		Object temp = keys.first();
-		keys.remove(temp);
-		return get(temp).get(keys);
-	 }
-	 return new SortedHashTree();
-  }
-
-/****************************************************************
-Gets a Set of all keys in the current SortedHashTree node.
-@return Set of all keys in this SortedHashTree.
-*****************************************************************/
-  public Set list()
-  {
-	 return data.keySet();
-  }
-
-/***************************************************************
-  Gets a Set of all keys in the SortedHashTree mapped to the given key of the
-  current SortedHashTree object (in other words, one level down.
-@param key Key used to find SortedHashTree to get list of.
-@return Set of all keys in found SortedHashTree.
-***************************************************************/
-  public Set list(Object key)
-  {
-	 SortedHashTree temp = (SortedHashTree)data.get(key);
-	 if(temp != null)
-		return temp.list();
-	 else
-		return null;
-  }
-
-  public void remove(Object key)
-  {
-	 data.remove(key);
-  }
-
-/*************************************************************
-Recurses down into the SortedHashTree stucture using each subsequent key in the
-array of keys, and returns the Set of keys of the SortedHashTree object at the
-end of the recursion.
-@param keys Array of keys used to recurse into SortedHashTree structure.
-@return Set of all keys found in end SortedHashTree.
-**************************************************************/
-  public Set list(Object[] keys)
-  {
-	 List list = new LinkedList();
-	 for(int x = 0;x < keys.length;list.add(keys[x++]));
-	 return list(list);
-  }
-
-/*************************************************************
-Recurses down into the SortedHashTree stucture using each subsequent key in the
-List of keys, and returns the Set of keys of the SortedHashTree object at the
-end of the recursion.
-@param keys List of keys used to recurse into SortedHashTree structure.
-@return Set of all keys found in end SortedHashTree.
-**************************************************************/
-  public Set list(List keys)
-  {
-	 if(keys.size() == 0)
-		return list();
-	 else if(keys.size() == 1)
-		return get(keys.get(0)).list();
-	 else
-	 {
-		Object temp = keys.remove(0);
-		return get(temp).list(keys);
-	 }
-  }
-
-/*************************************************************
-Recurses down into the SortedHashTree stucture using each subsequent key in the
-SortedSet of keys, and returns the Set of keys of the SortedHashTree object at the
-end of the recursion.
-@param keys SortedSet of keys used to recurse into SortedHashTree structure.
-@return Set of all keys found in end SortedHashTree.
-**************************************************************/
-  public Set list(SortedSet keys)
-  {
-	 if(keys.size() == 0)
-		return list();
-	 else if(keys.size() == 1)
-		return get(keys.first()).list();
-	 else
-	 {
-		Object temp = keys.first();
-		keys.remove(temp);
-		return get(temp).list(keys);
-	 }
-  }
-
-/****************************************************************
-Gets an array of all keys in the current SortedHashTree node.
-@return Array of all keys in this SortedHashTree.
-*****************************************************************/
-  public Object[] getArray()
-  {
-	 return data.keySet().toArray();
-  }
-
-/***************************************************************
-  Gets an array of all keys in the SortedHashTree mapped to the given key of the
-  current SortedHashTree object (in other words, one level down.
-@param key Key used to find SortedHashTree to get list of.
-@return Array of all keys in found SortedHashTree.
-***************************************************************/
-  public Object[] getArray(Object key)
-  {
-	 return get(key).getArray();
-  }
-
-/*************************************************************
-Recurses down into the SortedHashTree stucture using each subsequent key in the
-array of keys, and returns an array of keys of the SortedHashTree object at the
-end of the recursion.
-@param keys Array of keys used to recurse into SortedHashTree structure.
-@return Array of all keys found in end SortedHashTree.
-**************************************************************/
-  public Object[] getArray(Object[] keys)
-  {
-	 List list = new LinkedList();
-	 for(int x = 0;x < keys.length;list.add(keys[x++]));
-	 return getArray(list);
-  }
-
-/*************************************************************
-Recurses down into the SortedHashTree stucture using each subsequent key in the
-List of keys, and returns an array of keys of the SortedHashTree object at the
-end of the recursion.
-@param keys List of keys used to recurse into SortedHashTree structure.
-@return Array of all keys found in end SortedHashTree.
-**************************************************************/
-  public Object[] getArray(List keys)
-  {
-	 if(keys.size() == 0)
-		return getArray();
-	 if(keys.size() == 1)
-		return getArray(keys.get(0));
-	 else
-	 {
-		Object temp = keys.remove(0);
-		return get(temp).getArray(keys);
-	 }
-  }
-
-/*************************************************************
-Recurses down into the SortedHashTree stucture using each subsequent key in the
-SortedSet of keys, and returns an array of keys of the SortedHashTree object at the
-end of the recursion.
-@param keys SortedSet of keys used to recurse into SortedHashTree structure.
-@return Array of all keys found in end SortedHashTree.
-**************************************************************/
-  public Object[] getArray(SortedSet keys)
-  {
-	 if(keys.size() == 0)
-		return getArray();
-	 if(keys.size() == 1)
-		return getArray(keys.first());
-	 else
-	 {
-		Object temp = keys.first();
-		keys.remove(temp);
-		return get(temp).getArray(keys);
-	 }
-  }
-
-  public int hashCode()
-  {
-	 return data.hashCode()*7;
-  }
-
-  public boolean equals(Object o)
-  {
-	 boolean flag = true;
-	 if(o instanceof SortedHashTree)
-	 {
-		SortedHashTree oo = (SortedHashTree)o;
-		Iterator it = data.keySet().iterator();
-		while(it.hasNext())
-		{
-		  if(!oo.containsKey(it.next()))
-		  {
-			 flag = false;
-			 break;
-		  }
-		}
-		if(flag)
-		{
-		  it = data.keySet().iterator();
-		  while(it.hasNext())
-		  {
-			 Object temp = it.next();
-			 flag = get(temp).equals(oo.get(temp));
-			 if(!flag)
-				break;
-		  }
-		}
-	 }
-	 else
-		flag = false;
-	 return flag;
-  }
-
-  public Set keySet()
-  {
-	 return data.keySet();
-  }
-
-/*****************************************************
-Searches the SortedHashTree structure for the given key.  If it finds the key,
-it returns the SortedHashTree mapped to the key.  If it finds nothing, it returns
-null.
-@param key Key to search for.
-@return SortedHashTree mapped to key, if found, otherwise <B>null</B>.
-**********************************************************/
-  public SortedHashTree search(Object key)
-  {
-	 SortedHashTree temp = null;
-	 if(data.containsKey(key))
-		temp = (SortedHashTree)data.get(key);
-	 else
-	 {
-		Iterator it = list().iterator();
-		while(it.hasNext())
-		{
-		  if(temp == null)
-		  {
-			 temp = ((SortedHashTree)it.next()).search(key);
-			 break;
-		  }
-		  else
-			 break;
-		}
-	 }
-	 return temp;
-  }
-
-
-
-
-  void readObject(ObjectInputStream ois) throws ClassNotFoundException, IOException
-  {
-	 ois.defaultReadObject();
-  }
-
-  void writeObject(ObjectOutputStream oos) throws IOException
-  {
-	 oos.defaultWriteObject();
-  }
-
-  public int size()
-  {
-	 return data.size();
-  }
-
-  private java.util.SortedMap data;
-}
diff --git a/jakarta-jmeter/src/core/org/apache/jmeter/util/StringUtilities.java b/jakarta-jmeter/src/core/org/apache/jmeter/util/StringUtilities.java
new file mode 100644
index 0000000..b8ab146
--- /dev/null
+++ b/jakarta-jmeter/src/core/org/apache/jmeter/util/StringUtilities.java
@@ -0,0 +1,64 @@
+package org.apache.jmeter.util;
+
+import junit.framework.TestCase;
+
+/**
+ * @author Administrator
+ *
+ * To change this generated comment edit the template variable "typecomment":
+ * Window>Preferences>Java>Templates.
+ */
+public class StringUtilities
+{
+	
+	public static String substitute(String input,String pattern,String sub)
+	{
+		StringBuffer ret = new StringBuffer();
+		int start = 0;
+		int index = -1;
+		while((index = input.indexOf(pattern,start)) >= start)
+		{
+			ret.append(input.substring(start,index));
+			ret.append(sub);
+			start = index + pattern.length();
+		}
+		ret.append(input.substring(start));
+		return ret.toString();
+	}
+	
+	public static class Test extends TestCase
+	{
+		public Test(String name)
+		{
+			super(name);
+		}
+		
+		public void testSub1() throws Exception
+		{
+			String input = "http://jakarta.apache.org/jmeter/index.html";
+			String pattern = "jakarta.apache.org";
+			String sub = "${server}";
+			assertEquals("http://${server}/jmeter/index.html",
+					StringUtilities.substitute(input,pattern,sub));
+		}
+		
+		public void testSub2() throws Exception
+		{
+			String input = "arg1=param1;param1";
+			String pattern = "param1";
+			String sub = "${value}";
+			assertEquals("arg1=${value};${value}",
+					StringUtilities.substitute(input,pattern,sub));
+		}
+		
+		public void testSub3() throws Exception
+		{
+			String input = "jakarta.apache.org";
+			String pattern = "jakarta.apache.org";
+			String sub = "${server}";
+			assertEquals("${server}",
+					StringUtilities.substitute(input,pattern,sub));
+		}
+		
+	}
+}
diff --git a/jakarta-jmeter/src/core/org/apache/jmeter/util/TextFile.java b/jakarta-jmeter/src/core/org/apache/jmeter/util/TextFile.java
deleted file mode 100644
index cb02953..0000000
--- a/jakarta-jmeter/src/core/org/apache/jmeter/util/TextFile.java
+++ /dev/null
@@ -1,82 +0,0 @@
-package org.apache.jmeter.util;
-
-import java.io.*;
-
-/************************************************************
- *  !ToDo (Class description)
- *
- *@author     $Author: mstover1 $
- *@created    $Date: 2002/08/11 19:24:49 $
- *@version    $Revision: 1.1 $
- ***********************************************************/
-public class TextFile extends File
-{
-	/************************************************************
-	 *  !ToDo (Constructor description)
-	 *
-	 *@param  filename  !ToDo (Parameter description)
-	 ***********************************************************/
-	public TextFile(File filename)
-	{
-		super(filename.toString());
-	}
-
-	/************************************************************
-	 *  !ToDo (Constructor description)
-	 *
-	 *@param  filename  !ToDo (Parameter description)
-	 ***********************************************************/
-	public TextFile(String filename)
-	{
-		super(filename);
-	}
-
-	/************************************************************
-	 *  !ToDo (Method description)
-	 *
-	 *@param  body  !ToDo (Parameter description)
-	 ***********************************************************/
-	public void setText(String body)
-	{
-		try
-		{
-			Writer writer = new FileWriter(this);
-			writer.write(body);
-			writer.flush();
-			writer.close();
-		}
-		catch (IOException ioe)
-		{
-			System.err.println(ioe.getMessage());
-		}
-	}
-
-	/************************************************************
-	 *  !ToDoo (Method description)
-	 *
-	 *@return    !ToDo (Return description)
-	 ***********************************************************/
-	public String getText()
-	{
-		String lineEnd = System.getProperty("line.separator");
-		StringBuffer sb = new StringBuffer();
-		try
-		{
-			BufferedReader br = new BufferedReader(new FileReader(this));
-			String line = "NOTNULL";
-			while (line != null)
-			{
-				line = br.readLine();
-				if (line != null)
-				{
-					sb.append(line + lineEnd);
-				}
-			}
-		}
-		catch (IOException ioe)
-		{
-			System.err.println(ioe.getMessage());
-		}
-		return sb.toString();
-	}
-}
diff --git a/jakarta-jmeter/src/core/org/apache/jmeter/util/keystore/CVS/Entries b/jakarta-jmeter/src/core/org/apache/jmeter/util/keystore/CVS/Entries
index 8a9475f..8e71cfc 100644
--- a/jakarta-jmeter/src/core/org/apache/jmeter/util/keystore/CVS/Entries
+++ b/jakarta-jmeter/src/core/org/apache/jmeter/util/keystore/CVS/Entries
@@ -1,4 +1,4 @@
-/DefaultKeyStore.java/1.1/Sun Aug 11 19:24:50 2002//Tv1_7_3
-/JmeterKeyStore.java/1.1/Sun Aug 11 19:24:50 2002//Tv1_7_3
-/PKCS12KeyStore.java/1.1/Sun Aug 11 19:24:50 2002//Tv1_7_3
+/DefaultKeyStore.java/1.2/Fri Dec 27 13:42:30 2002//Tv1_8_1
+/JmeterKeyStore.java/1.1/Sun Aug 11 19:24:50 2002//Tv1_8_1
+/PKCS12KeyStore.java/1.1/Sun Aug 11 19:24:50 2002//Tv1_8_1
 D
diff --git a/jakarta-jmeter/src/core/org/apache/jmeter/util/keystore/CVS/Tag b/jakarta-jmeter/src/core/org/apache/jmeter/util/keystore/CVS/Tag
index 5f312fe..e2fda28 100644
--- a/jakarta-jmeter/src/core/org/apache/jmeter/util/keystore/CVS/Tag
+++ b/jakarta-jmeter/src/core/org/apache/jmeter/util/keystore/CVS/Tag
@@ -1 +1 @@
-Nv1_7_3
+Nv1_8_1
diff --git a/jakarta-jmeter/src/core/org/apache/jmeter/util/keystore/DefaultKeyStore.java b/jakarta-jmeter/src/core/org/apache/jmeter/util/keystore/DefaultKeyStore.java
index 8170384..3fa4f2d 100644
--- a/jakarta-jmeter/src/core/org/apache/jmeter/util/keystore/DefaultKeyStore.java
+++ b/jakarta-jmeter/src/core/org/apache/jmeter/util/keystore/DefaultKeyStore.java
@@ -69,7 +69,7 @@ import java.util.Enumeration;
  * Use this Keystore to wrap the normal KeyStore implementation.
  *
  * @author <a href="bloritsch@apache.org">Berin Loritsch</a>
- * @version CVS $Revision: 1.1 $ $Date: 2002/08/11 19:24:50 $
+ * @version CVS $Revision: 1.2 $ $Date: 2002/12/27 13:42:30 $
  */
 public class DefaultKeyStore extends JmeterKeyStore {
     private X509Certificate[] certChain;
@@ -90,11 +90,11 @@ public class DefaultKeyStore extends JmeterKeyStore {
 
         Enumeration aliases = store.aliases();
         while (aliases.hasMoreElements()) {
+	    this.alias = (String) aliases.nextElement();
             if (store.isKeyEntry(alias)) {
                 key = (PrivateKey) store.getKey(alias, pword.toCharArray());
                 Certificate[] chain = store.getCertificateChain(alias);
                 certChain = new X509Certificate[chain.length];
-                this.alias = (String) aliases.nextElement();
 
                 for (int i = 0; i < chain.length; i++) {
                     certChain[i] = (X509Certificate) chain[i];
@@ -122,4 +122,4 @@ public class DefaultKeyStore extends JmeterKeyStore {
     public final String getAlias() {
         return this.alias;
     }
-}
\ No newline at end of file
+}
diff --git a/jakarta-jmeter/src/core/org/apache/jmeter/visualizers/CVS/Entries b/jakarta-jmeter/src/core/org/apache/jmeter/visualizers/CVS/Entries
index 02442bb..e214a9e 100644
--- a/jakarta-jmeter/src/core/org/apache/jmeter/visualizers/CVS/Entries
+++ b/jakarta-jmeter/src/core/org/apache/jmeter/visualizers/CVS/Entries
@@ -1,5 +1,3 @@
-/GraphAccumListener.java/1.1/Sun Aug 11 19:24:50 2002//Tv1_7_3
-/GraphListener.java/1.1/Sun Aug 11 19:24:50 2002//Tv1_7_3
-/ImageVisualizer.java/1.1/Sun Aug 11 19:24:50 2002//Tv1_7_3
-/Visualizer.java/1.1/Sun Aug 11 19:24:50 2002//Tv1_7_3
+/ImageVisualizer.java/1.1/Sun Aug 11 19:24:50 2002//Tv1_8_1
+/Visualizer.java/1.1/Sun Aug 11 19:24:50 2002//Tv1_8_1
 D/gui////
diff --git a/jakarta-jmeter/src/core/org/apache/jmeter/visualizers/CVS/Tag b/jakarta-jmeter/src/core/org/apache/jmeter/visualizers/CVS/Tag
index 5f312fe..e2fda28 100644
--- a/jakarta-jmeter/src/core/org/apache/jmeter/visualizers/CVS/Tag
+++ b/jakarta-jmeter/src/core/org/apache/jmeter/visualizers/CVS/Tag
@@ -1 +1 @@
-Nv1_7_3
+Nv1_8_1
diff --git a/jakarta-jmeter/src/core/org/apache/jmeter/visualizers/gui/AbstractVisualizer.java b/jakarta-jmeter/src/core/org/apache/jmeter/visualizers/gui/AbstractVisualizer.java
index 4d017bf..b2dec85 100644
--- a/jakarta-jmeter/src/core/org/apache/jmeter/visualizers/gui/AbstractVisualizer.java
+++ b/jakarta-jmeter/src/core/org/apache/jmeter/visualizers/gui/AbstractVisualizer.java
@@ -3,12 +3,13 @@ import java.io.IOException;
 import java.util.Arrays;
 import java.util.Collection;
 
+import javax.swing.JCheckBox;
 import javax.swing.JPopupMenu;
 import javax.swing.event.ChangeEvent;
 import javax.swing.event.ChangeListener;
+
 import org.apache.jmeter.exceptions.IllegalUserActionException;
 import org.apache.jmeter.gui.AbstractJMeterGuiComponent;
-import org.apache.jmeter.gui.NamePanel;
 import org.apache.jmeter.gui.util.FilePanel;
 import org.apache.jmeter.gui.util.MenuFactory;
 import org.apache.jmeter.reporters.AbstractListenerElement;
@@ -16,19 +17,25 @@ import org.apache.jmeter.reporters.ResultCollector;
 import org.apache.jmeter.testelement.TestElement;
 import org.apache.jmeter.util.JMeterUtils;
 import org.apache.jmeter.visualizers.Visualizer;
+import org.apache.log.Hierarchy;
+import org.apache.log.Logger;
 
 /****************************************
  * Title: JMeter Description: Copyright: Copyright (c) 2000 Company: Apache
  *
  *@author    Michael Stover
- *@created   $Date: 2002/08/11 19:24:50 $
+ *@created   $Date: 2002/08/30 15:51:21 $
  *@version   1.0
  ***************************************/
 
 public abstract class AbstractVisualizer extends AbstractJMeterGuiComponent
 	implements Visualizer, ChangeListener {
+		
+	transient private static Logger log = Hierarchy.getDefaultHierarchy().getLoggerFor(
+			"jmeter.gui");
 
 		private FilePanel filePanel;
+		private JCheckBox errorLogging;
 	ResultCollector collector;
 
 	/****************************************
@@ -36,7 +43,14 @@ public abstract class AbstractVisualizer extends AbstractJMeterGuiComponent
 	 ***************************************/
 	public AbstractVisualizer() {
 		super();
-		filePanel = new FilePanel(this);
+		filePanel = new FilePanel(this,
+				JMeterUtils.getResString("file_visualizer_output_file"));
+		errorLogging = new JCheckBox(JMeterUtils.getResString("log_errors_only"));
+	}
+	
+	protected JCheckBox getErrorLoggingCheckbox()
+	{
+		return errorLogging;
 	}
 
 
@@ -66,7 +80,7 @@ public abstract class AbstractVisualizer extends AbstractJMeterGuiComponent
 	}
 
 	public void stateChanged(ChangeEvent e) {
-		System.out.println("getting new collector");
+		log.info("getting new collector");
 		collector = (ResultCollector) createTestElement();
 	}
 
@@ -84,6 +98,7 @@ public abstract class AbstractVisualizer extends AbstractJMeterGuiComponent
 			collector = new ResultCollector();
 		}
 		configureTestElement(collector);
+		collector.setErrorLogging(errorLogging.isSelected());
 		try {
 			if (!getFile().equals("")) {
 				try {
@@ -96,7 +111,7 @@ public abstract class AbstractVisualizer extends AbstractJMeterGuiComponent
 			}
 		}
 		catch (IOException e) {
-			e.printStackTrace();
+			log.error("",e);
 		}
 		return (TestElement)collector.clone();
 	}
@@ -105,6 +120,8 @@ public abstract class AbstractVisualizer extends AbstractJMeterGuiComponent
 	{
 		super.configure(el);
 		setFile(el.getPropertyAsString(ResultCollector.FILENAME));
+		ResultCollector rc = (ResultCollector)el;
+		errorLogging.setSelected(rc.isErrorLogging());
 	}
 
 	/****************************************
diff --git a/jakarta-jmeter/src/core/org/apache/jmeter/visualizers/gui/CVS/Entries b/jakarta-jmeter/src/core/org/apache/jmeter/visualizers/gui/CVS/Entries
index ecb97cd..2127da2 100644
--- a/jakarta-jmeter/src/core/org/apache/jmeter/visualizers/gui/CVS/Entries
+++ b/jakarta-jmeter/src/core/org/apache/jmeter/visualizers/gui/CVS/Entries
@@ -1,2 +1,2 @@
-/AbstractVisualizer.java/1.1/Sun Aug 11 19:24:50 2002//Tv1_7_3
+/AbstractVisualizer.java/1.4/Fri Aug 30 15:51:21 2002//Tv1_8_1
 D
diff --git a/jakarta-jmeter/src/core/org/apache/jmeter/visualizers/gui/CVS/Tag b/jakarta-jmeter/src/core/org/apache/jmeter/visualizers/gui/CVS/Tag
index 5f312fe..e2fda28 100644
--- a/jakarta-jmeter/src/core/org/apache/jmeter/visualizers/gui/CVS/Tag
+++ b/jakarta-jmeter/src/core/org/apache/jmeter/visualizers/gui/CVS/Tag
@@ -1 +1 @@
-Nv1_7_3
+Nv1_8_1
diff --git a/jakarta-jmeter/src/functions/CVS/Tag b/jakarta-jmeter/src/functions/CVS/Tag
index f4b6a59..75ba187 100644
--- a/jakarta-jmeter/src/functions/CVS/Tag
+++ b/jakarta-jmeter/src/functions/CVS/Tag
@@ -1 +1 @@
-Tv1_7_3
+Tv1_8_1
diff --git a/jakarta-jmeter/src/functions/org/CVS/Tag b/jakarta-jmeter/src/functions/org/CVS/Tag
index f4b6a59..75ba187 100644
--- a/jakarta-jmeter/src/functions/org/CVS/Tag
+++ b/jakarta-jmeter/src/functions/org/CVS/Tag
@@ -1 +1 @@
-Tv1_7_3
+Tv1_8_1
diff --git a/jakarta-jmeter/src/functions/org/apache/CVS/Tag b/jakarta-jmeter/src/functions/org/apache/CVS/Tag
index f4b6a59..75ba187 100644
--- a/jakarta-jmeter/src/functions/org/apache/CVS/Tag
+++ b/jakarta-jmeter/src/functions/org/apache/CVS/Tag
@@ -1 +1 @@
-Tv1_7_3
+Tv1_8_1
diff --git a/jakarta-jmeter/src/functions/org/apache/jmeter/CVS/Tag b/jakarta-jmeter/src/functions/org/apache/jmeter/CVS/Tag
index f4b6a59..75ba187 100644
--- a/jakarta-jmeter/src/functions/org/apache/jmeter/CVS/Tag
+++ b/jakarta-jmeter/src/functions/org/apache/jmeter/CVS/Tag
@@ -1 +1 @@
-Tv1_7_3
+Tv1_8_1
diff --git a/jakarta-jmeter/src/functions/org/apache/jmeter/functions/CVS/Entries b/jakarta-jmeter/src/functions/org/apache/jmeter/functions/CVS/Entries
index ad67efe..d4401f5 100644
--- a/jakarta-jmeter/src/functions/org/apache/jmeter/functions/CVS/Entries
+++ b/jakarta-jmeter/src/functions/org/apache/jmeter/functions/CVS/Entries
@@ -1,4 +1,5 @@
-/IterationCounter.java/1.1/Sun Aug 11 19:24:50 2002//Tv1_7_3
-/RegexFunction.java/1.1/Sun Aug 11 19:24:50 2002//Tv1_7_3
-/ThreadNumber.java/1.1/Sun Aug 11 19:24:50 2002//Tv1_7_3
+/IntSum.java/1.1/Fri Jan 10 13:44:31 2003//Tv1_8_1
+/IterationCounter.java/1.4/Thu Aug 29 18:17:41 2002//Tv1_8_1
+/RegexFunction.java/1.9/Fri Jan 31 18:25:10 2003//Tv1_8_1
+/ThreadNumber.java/1.3/Thu Aug 29 18:17:41 2002//Tv1_8_1
 D
diff --git a/jakarta-jmeter/src/functions/org/apache/jmeter/functions/CVS/Tag b/jakarta-jmeter/src/functions/org/apache/jmeter/functions/CVS/Tag
index 5f312fe..e2fda28 100644
--- a/jakarta-jmeter/src/functions/org/apache/jmeter/functions/CVS/Tag
+++ b/jakarta-jmeter/src/functions/org/apache/jmeter/functions/CVS/Tag
@@ -1 +1 @@
-Nv1_7_3
+Nv1_8_1
diff --git a/jakarta-jmeter/src/core/org/apache/jmeter/save/old/JMeterNameSpaceHandler.java b/jakarta-jmeter/src/functions/org/apache/jmeter/functions/IntSum.java
similarity index 55%
rename from jakarta-jmeter/src/core/org/apache/jmeter/save/old/JMeterNameSpaceHandler.java
rename to jakarta-jmeter/src/functions/org/apache/jmeter/functions/IntSum.java
index cb91f77..6fd46f7 100644
--- a/jakarta-jmeter/src/core/org/apache/jmeter/save/old/JMeterNameSpaceHandler.java
+++ b/jakarta-jmeter/src/functions/org/apache/jmeter/functions/IntSum.java
@@ -52,82 +52,107 @@
  * information on the Apache Software Foundation, please see
  * <http://www.apache.org/>.
  */
-package org.apache.jmeter.save.old;
 
-import java.io.File;
-import java.io.FileInputStream;
-import java.util.HashMap;
-import java.util.Iterator;
+package org.apache.jmeter.functions;
+
+import java.io.Serializable;
+import java.util.Collection;
 import java.util.LinkedList;
 import java.util.List;
-import java.util.Map;
 
-import junit.framework.TestCase;
-import org.apache.jmeter.control.GenericController;
-import org.apache.jmeter.gui.action.Load;
-import org.apache.jmeter.protocol.http.config.gui.UrlConfigGui;
-import org.apache.jmeter.protocol.http.sampler.HTTPSampler;
-import org.apache.jmeter.save.old.xml.NameSpaceHandler;
-import org.apache.jmeter.save.old.xml.TagHandler;
-import org.apache.jmeter.save.old.xml.XmlHandler;
-import org.apache.jmeter.testelement.TestElement;
-import org.apache.jmeter.util.ClassFinder;
+import org.apache.jmeter.samplers.SampleResult;
+import org.apache.jmeter.samplers.Sampler;
+import org.apache.jmeter.threads.JMeterVariables;
 import org.apache.jmeter.util.JMeterUtils;
-import org.apache.jmeter.util.ListedHashTree;
-import org.xml.sax.Attributes;
-import org.xml.sax.InputSource;
-import org.xml.sax.XMLReader;
 
 /**
- * Title:        JMeter
- * Description:
- * Copyright:    Copyright (c) 2000
- * Company:      Apache
- * @author Michael Stover
- * @version 1.0
+ * Provides an intSum function that adds two or more integer values.
+ *
+ * @author <a href="mailto:seade@backstagetech.com.au">Scott Eade</a>
+ * @version $Id: IntSum.java,v 1.1 2003/01/10 13:44:31 seade Exp $
  */
+public class IntSum extends AbstractFunction implements Serializable
+{
+	private static final List desc = new LinkedList();
+    private int sum = 0;
 
-public class JMeterNameSpaceHandler implements NameSpaceHandler {
+	static
+	{
+		desc.add(JMeterUtils.getResString("intsum_param_1"));
+		desc.add(JMeterUtils.getResString("intsum_param_2"));
+		desc.add(JMeterUtils.getResString("function_name_param"));
+	}
+	
+	private static final String KEY = "__intSum";
+	private String varName;
 
-	private static Map saveHandlers = new HashMap();
-	static {
-		try {
-			List classes =
-				ClassFinder.findClassesThatExtend(
-					new Class[] { org.apache.jmeter.save.old.xml.TagHandler.class });
-			Iterator iter = classes.iterator();
-			while (iter.hasNext()) {
-				String item = (String) iter.next();
-				try {
-					TagHandler obj = (TagHandler) Class.forName(item).newInstance();
-					saveHandlers.put(obj.getPrimaryTagName(), obj.getClass());
-				} catch (Exception ex) {
-					ex.printStackTrace();
-				}
-			}
-		} catch (Exception ex) {
-			ex.printStackTrace();
-		}
+    /**
+     * No-arg constructor.
+     */
+	public IntSum()
+	{
+		sum = 0;
 	}
 
-	public JMeterNameSpaceHandler() {
+    /**
+     * Clone this Add object.
+     * 
+     * @return A new Add object.
+     */
+	public Object clone()
+	{
+		IntSum newIntSum = new IntSum();
+		return newIntSum;
 	}
 
-	public TagHandler getXmlObject(String tagName, Attributes atts) {
-		try {
+	/**
+	 * Execute the function.
+	 * 
+	 * @see Function#execute(SampleResult, Sampler)
+	 */
+	public synchronized String execute(SampleResult previousResult, Sampler currentSampler)
+			throws InvalidVariableException
+	{
+		JMeterVariables vars = getVariables();
+		String totalString = Integer.toString(sum);
+		vars.put(varName, totalString);
+		return totalString;
+	}
 
-			TagHandler handler =
-				(TagHandler) ((Class) saveHandlers.get(tagName)).newInstance();
-			handler.setTagName(handler.getPrimaryTagName());
-			handler.setAtts(atts);
-			return handler;
-		} catch(NullPointerException e)
+	/**
+	 * Set the parameters for the function.
+	 * 
+	 * @see Function#setParameters(String)
+	 */
+	public void setParameters(String parameters)
+			throws InvalidVariableException
+	{
+		Collection params = this.parseArguments(parameters);
+		String[] values = (String[])params.toArray(new String[0]);
+		varName = values[values.length - 1];
+		sum = 0;
+		for (int i = 0; i < values.length - 1; i++)
 		{
-			return null;
-		}catch (Exception ex) {
-			ex.printStackTrace();
-			return null;
+			sum += Integer.parseInt(values[i]);
 		}
+	}
+
+	/**
+	 * Get the invocation key for this function.
+	 * 
+	 * @see Function#getReferenceKey()
+	 */
+	public String getReferenceKey() {
+		return KEY;
+	}
 
+	/**
+	 * Get the description of this function.
+	 * 
+	 * @see Function#getArgumentDesc()
+	 */
+	public List getArgumentDesc() {
+		return desc;
 	}
-}
\ No newline at end of file
+
+}
diff --git a/jakarta-jmeter/src/functions/org/apache/jmeter/functions/IterationCounter.java b/jakarta-jmeter/src/functions/org/apache/jmeter/functions/IterationCounter.java
index 54fa11e..436aa19 100644
--- a/jakarta-jmeter/src/functions/org/apache/jmeter/functions/IterationCounter.java
+++ b/jakarta-jmeter/src/functions/org/apache/jmeter/functions/IterationCounter.java
@@ -1,12 +1,12 @@
 package org.apache.jmeter.functions;
 
+import java.io.Serializable;
 import java.util.Collection;
 import java.util.LinkedList;
 import java.util.List;
 
 import org.apache.jmeter.samplers.SampleResult;
 import org.apache.jmeter.samplers.Sampler;
-import org.apache.jmeter.testelement.PerThreadClonable;
 import org.apache.jmeter.threads.JMeterVariables;
 import org.apache.jmeter.util.JMeterUtils;
 
@@ -18,9 +18,8 @@ import org.apache.jmeter.util.JMeterUtils;
  * To enable and disable the creation of type comments go to
  * Window>Preferences>Java>Code Generation.
  */
-public class IterationCounter extends AbstractFunction
+public class IterationCounter extends AbstractFunction implements Serializable
 {
-	private JMeterVariables vars;
 	private static int counter;
 	private static final List desc = new LinkedList();
 	private boolean perThread = true;
@@ -28,13 +27,16 @@ public class IterationCounter extends AbstractFunction
 	static
 	{
 		desc.add(JMeterUtils.getResString("iteration_counter_arg_1"));
+		desc.add(JMeterUtils.getResString("function_name_param"));
 	}
 	
 	private static final String KEY = "__counter";
+	private String trueCount;
+	private String falseCount;
 	
 	public IterationCounter()
 	{
-		counter = 1;
+		counter = 0;
 	}
 	
 	public Object clone()
@@ -46,15 +48,22 @@ public class IterationCounter extends AbstractFunction
 	/**
 	 * @see org.apache.jmeter.functions.Function#execute(SampleResult, Sampler)
 	 */
-	public String execute(SampleResult previousResult, Sampler currentSampler)
+	public synchronized String execute(SampleResult previousResult, Sampler currentSampler)
 		throws InvalidVariableException {
+		counter++;
+		JMeterVariables vars = getVariables();
+		String falseCounterString = Integer.toString(counter);
+		String trueCounterString = Integer.toString(vars.getIteration());
+		vars.put(trueCount,trueCounterString);
+		vars.put(falseCount,falseCounterString);
+		
 		if(perThread)
 		{
-			return Integer.toString(vars.getIteration());
+			return trueCounterString;
 		}
 		else
 		{
-			return Integer.toString(counter++);
+			return falseCounterString;
 		}
 	}
 
@@ -66,6 +75,11 @@ public class IterationCounter extends AbstractFunction
 			Collection params = this.parseArguments(parameters);
 			String[] values = (String[])params.toArray(new String[0]);
 			perThread = new Boolean(values[0]).booleanValue();
+			if(values.length > 1)
+			{
+				trueCount = values[1]+"_true";
+				falseCount = values[1]+"_false";
+			}
 	}
 
 	/**
@@ -82,14 +96,4 @@ public class IterationCounter extends AbstractFunction
 		return desc;
 	}
 
-	/**
-	 * @see org.apache.jmeter.functions.Function#setJMeterVariables(JMeterVariables)
-	 */
-	public void setJMeterVariables(JMeterVariables jmv) {
-		if(vars == null)
-		{
-			vars = jmv;
-		}
-	}
-
 }
diff --git a/jakarta-jmeter/src/functions/org/apache/jmeter/functions/RegexFunction.java b/jakarta-jmeter/src/functions/org/apache/jmeter/functions/RegexFunction.java
index 503b380..ead2915 100644
--- a/jakarta-jmeter/src/functions/org/apache/jmeter/functions/RegexFunction.java
+++ b/jakarta-jmeter/src/functions/org/apache/jmeter/functions/RegexFunction.java
@@ -1,5 +1,6 @@
 package org.apache.jmeter.functions;
 
+import java.io.Serializable;
 import java.net.URLDecoder;
 import java.net.URLEncoder;
 import java.util.ArrayList;
@@ -14,6 +15,8 @@ import org.apache.jmeter.samplers.SampleResult;
 import org.apache.jmeter.samplers.Sampler;
 import org.apache.jmeter.threads.JMeterVariables;
 import org.apache.jmeter.util.JMeterUtils;
+import org.apache.log.Hierarchy;
+import org.apache.log.Logger;
 import org.apache.oro.text.regex.MalformedPatternException;
 import org.apache.oro.text.regex.MatchResult;
 import org.apache.oro.text.regex.Pattern;
@@ -30,8 +33,9 @@ import org.apache.oro.text.regex.Util;
  * To change this generated comment edit the template variable "typecomment":
  * Window>Preferences>Java>Templates.
  */
-public class RegexFunction extends AbstractFunction {
-	
+public class RegexFunction extends AbstractFunction implements Serializable {
+	transient private static Logger log = Hierarchy.getDefaultHierarchy().getLoggerFor(
+			"jmeter.elements");
 	public static final String ALL = "ALL";
 	public static final String RAND = "RAND";
 	public static final String KEY = "__regexFunction";	
@@ -41,8 +45,17 @@ public class RegexFunction extends AbstractFunction {
 	Pattern searchPattern;
 	Object[] template;
 	String valueIndex,defaultValue,between;
-	PatternCompiler compiler = new Perl5Compiler();
+	transient PatternCompiler compiler = new Perl5Compiler();
 	Pattern templatePattern;
+	private String name;
+	private static ThreadLocal localMatcher =
+				 new ThreadLocal()
+				 {
+					protected Object initialValue()
+					{
+						 return new Perl5Matcher();
+					}
+				 };
 	
 	static
 	{
@@ -51,6 +64,7 @@ public class RegexFunction extends AbstractFunction {
 		desc.add(JMeterUtils.getResString("regexfunc_param_3"));
 		desc.add(JMeterUtils.getResString("regexfunc_param_4"));
 		desc.add(JMeterUtils.getResString("regexfunc_param_5"));
+		desc.add(JMeterUtils.getResString("function_name_param"));
 	}
 	
 	public RegexFunction()
@@ -58,7 +72,7 @@ public class RegexFunction extends AbstractFunction {
 		try {
 			templatePattern = compiler.compile("\\$(\\d+)\\$");
 		} catch(MalformedPatternException e) {
-			e.printStackTrace();
+			log.error("",e);
 		}
 	}
 	
@@ -68,13 +82,14 @@ public class RegexFunction extends AbstractFunction {
 	 */
 	public String execute(SampleResult previousResult,Sampler currentSampler) 
 	{
+		getVariables().put(name,defaultValue);
 		if(previousResult == null || previousResult.getResponseData() == null)
 		{
 			return defaultValue;
 		}
 		List collectAllMatches = new ArrayList();
 		try {
-			PatternMatcher matcher = new Perl5Matcher();
+			PatternMatcher matcher = (PatternMatcher)localMatcher.get();
 			String responseText = new String(previousResult.getResponseData());
 			PatternMatcherInput input = new PatternMatcherInput(responseText);
 			while(matcher.contains(input,searchPattern))
@@ -83,7 +98,12 @@ public class RegexFunction extends AbstractFunction {
 				collectAllMatches.add(match);
 			}
 		} catch(NumberFormatException e) {
-			e.printStackTrace();
+			log.error("",e);
+			return defaultValue;
+		}
+		catch(Exception e)
+		{
+			return defaultValue;
 		}
 		if(collectAllMatches.size() == 0)
 		{
@@ -99,6 +119,9 @@ public class RegexFunction extends AbstractFunction {
 				if(!first)
 				{
 					value.append(between);
+				}
+				else
+				{
 					first = false;
 				}
 				value.append(generateResult((MatchResult)it.next()));
@@ -107,22 +130,39 @@ public class RegexFunction extends AbstractFunction {
 		}
 		else if(valueIndex.equals(RAND))
 		{
-			return generateResult((MatchResult)collectAllMatches.get(
-					rand.nextInt(collectAllMatches.size())));
+			MatchResult result = (MatchResult)collectAllMatches.get(
+					rand.nextInt(collectAllMatches.size()));
+			return generateResult(result);
 		}
 		else
 		{
 			try {
 				int index = Integer.parseInt(valueIndex) - 1;
-				return generateResult((MatchResult)collectAllMatches.get(index));
+				MatchResult result = (MatchResult)collectAllMatches.get(index);
+				return generateResult(result);
 			} catch(NumberFormatException e) {
 				float ratio = Float.parseFloat(valueIndex);
-				return generateResult((MatchResult)collectAllMatches.get(
-						(int)(collectAllMatches.size() * ratio + .5) - 1));
+				MatchResult result = (MatchResult)collectAllMatches.get(
+						(int)(collectAllMatches.size() * ratio + .5) - 1);
+				return generateResult(result);
+			}catch (IndexOutOfBoundsException e) {
+				 return defaultValue;
 			}
 		}			
 	}
 	
+	private void saveGroups(MatchResult result)
+	{
+		if(result != null)
+		{
+			JMeterVariables vars = getVariables();
+			for(int x = 0;x < result.groups();x++)
+			{
+				vars.put(name+"_g"+x,result.group(x));
+			}
+		}
+	}
+	
 	public List getArgumentDesc()
 	{
 		return desc;
@@ -130,6 +170,7 @@ public class RegexFunction extends AbstractFunction {
 	
 	private String generateResult(MatchResult match)
 	{
+		saveGroups(match);
 		StringBuffer result = new StringBuffer();
 		for(int a = 0;a < template.length;a++)
 		{
@@ -142,6 +183,8 @@ public class RegexFunction extends AbstractFunction {
 				result.append(match.group(((Integer)template[a]).intValue()));
 			}
 		}
+		JMeterVariables vars = getVariables();
+		vars.put(name,result.toString());
 		return result.toString();
 	}
 	
@@ -150,10 +193,6 @@ public class RegexFunction extends AbstractFunction {
 		return KEY;
 	}
 	
-	public void setJMeterVariables(JMeterVariables xxx)
-	{
-	}
-	
 	public void setParameters(String params) throws InvalidVariableException
 	{
 		try
@@ -176,8 +215,12 @@ public class RegexFunction extends AbstractFunction {
 			{
 				defaultValue = (String)tk.next();
 			}
+			if(tk.hasNext())
+			{
+				name = (String)tk.next();
+			}
 		} catch(MalformedPatternException e) {
-				e.printStackTrace();
+				log.error("",e);
 				throw new InvalidVariableException("Bad regex pattern");
 		}
 		catch(Exception e)
@@ -229,7 +272,7 @@ public class RegexFunction extends AbstractFunction {
 			Pattern pattern = compiler.compile("^\\$\\d+\\$");
 			return new Perl5Matcher().contains(rawData,pattern);
 		} catch(MalformedPatternException e) {
-			e.printStackTrace();
+			log.error("",e);
 			return false;
 		}
 	}
@@ -263,7 +306,7 @@ public class RegexFunction extends AbstractFunction {
 		public void testVariableExtraction() throws Exception
 		{
 			variable.setParameters(URLEncoder.encode("<value field=\"(pinposition\\d+)\">(\\d+)</value>")+",$2$,2");
-			
+			variable.setJMeterVariables(new JMeterVariables());
 			String match = variable.execute(result,null);
 			assertEquals("5",match);			
 		}
@@ -271,13 +314,31 @@ public class RegexFunction extends AbstractFunction {
 		public void testVariableExtraction2() throws Exception
 		{
 			variable.setParameters(URLEncoder.encode("<value field=\"(pinposition\\d+)\">(\\d+)</value>")+",$1$,3");
+			variable.setJMeterVariables(new JMeterVariables());
 			String match = variable.execute(result,null);
 			assertEquals("pinposition3",match);			
 		}
 		
+		public void testVariableExtraction5() throws Exception
+		{
+			variable.setParameters(URLEncoder.encode("<value field=\"(pinposition\\d+)\">(\\d+)</value>")+",$1$,ALL,_");
+			variable.setJMeterVariables(new JMeterVariables());
+			String match = variable.execute(result,null);
+			assertEquals("pinposition1_pinposition2_pinposition3",match);			
+		}
+		
+		public void testVariableExtraction6() throws Exception
+				{
+					variable.setParameters(URLEncoder.encode("<value field=\"(pinposition\\d+)\">(\\d+)</value>")+",$2$,4,,default");
+					variable.setJMeterVariables(new JMeterVariables());
+					String match = variable.execute(result,null);
+					assertEquals("default",match);			
+				}
+		
 		public void testComma() throws Exception
 		{
 			variable.setParameters(URLEncoder.encode("<value,? field=\"(pinposition\\d+)\">(\\d+)</value>")+",$1$,3");
+			variable.setJMeterVariables(new JMeterVariables());
 			String match = variable.execute(result,null);
 			assertEquals("pinposition3",match);			
 		}
@@ -286,6 +347,7 @@ public class RegexFunction extends AbstractFunction {
 		{
 			variable.setParameters(URLEncoder.encode("<value field=\"(pinposition\\d+)\">(\\d+)</value>")+
 					",_$1$,.5");
+			variable.setJMeterVariables(new JMeterVariables());
 			String match = variable.execute(result,null);
 			assertEquals("_pinposition2",match);			
 		}
@@ -295,6 +357,7 @@ public class RegexFunction extends AbstractFunction {
 			variable.setParameters(URLEncoder.encode(
 					"<value field=\"(pinposition\\d+)\">(\\d+)</value>")+","+URLEncoder.encode("$2$, ")+
 					",.333");
+			variable.setJMeterVariables(new JMeterVariables());
 			
 			String match = variable.execute(result,null);
 			assertEquals("1, ",match);			
@@ -305,6 +368,7 @@ public class RegexFunction extends AbstractFunction {
 			variable.setParameters(URLEncoder.encode(
 					"<value,, field=\"(pinposition\\d+)\">(\\d+)</value>")+","+URLEncoder.encode("$2$, ")+
 					",.333,,No Value Found");
+			variable.setJMeterVariables(new JMeterVariables());
 			
 			String match = variable.execute(result,null);
 			assertEquals("No Value Found",match);			
diff --git a/jakarta-jmeter/src/functions/org/apache/jmeter/functions/ThreadNumber.java b/jakarta-jmeter/src/functions/org/apache/jmeter/functions/ThreadNumber.java
index cf6af1e..541cadd 100644
--- a/jakarta-jmeter/src/functions/org/apache/jmeter/functions/ThreadNumber.java
+++ b/jakarta-jmeter/src/functions/org/apache/jmeter/functions/ThreadNumber.java
@@ -1,5 +1,6 @@
 package org.apache.jmeter.functions;
 
+import java.io.Serializable;
 import java.util.LinkedList;
 import java.util.List;
 
@@ -15,9 +16,9 @@ import org.apache.jmeter.threads.JMeterVariables;
  * To enable and disable the creation of type comments go to
  * Window>Preferences>Java>Code Generation.
  */
-public class ThreadNumber implements Function {
+public class ThreadNumber implements Function,Serializable {
 	
-	private JMeterVariables vars;
+	transient private JMeterVariables vars;
 	private static final String KEY = "__threadNum";
 
 	/**
@@ -25,8 +26,8 @@ public class ThreadNumber implements Function {
 	 */
 	public String execute(SampleResult previousResult, Sampler currentSampler)
 		throws InvalidVariableException {
-		return vars.getThreadName().substring(
-				vars.getThreadName().indexOf("-")+1);
+		return Thread.currentThread().getName().substring(
+				Thread.currentThread().getName().indexOf("-")+1);
 	}
 
 	/**
diff --git a/jakarta-jmeter/src/jorphan/CVS/Entries b/jakarta-jmeter/src/jorphan/CVS/Entries
new file mode 100644
index 0000000..381094d
--- /dev/null
+++ b/jakarta-jmeter/src/jorphan/CVS/Entries
@@ -0,0 +1 @@
+D/org////
diff --git a/jakarta-jmeter/src/jorphan/CVS/Repository b/jakarta-jmeter/src/jorphan/CVS/Repository
new file mode 100644
index 0000000..9d12203
--- /dev/null
+++ b/jakarta-jmeter/src/jorphan/CVS/Repository
@@ -0,0 +1 @@
+jakarta-jmeter/src/jorphan
diff --git a/jakarta-jmeter/src/core/org/apache/jmeter/save/old/xml/CVS/Root b/jakarta-jmeter/src/jorphan/CVS/Root
similarity index 100%
rename from jakarta-jmeter/src/core/org/apache/jmeter/save/old/xml/CVS/Root
rename to jakarta-jmeter/src/jorphan/CVS/Root
diff --git a/jakarta-jmeter/src/jorphan/CVS/Tag b/jakarta-jmeter/src/jorphan/CVS/Tag
new file mode 100644
index 0000000..75ba187
--- /dev/null
+++ b/jakarta-jmeter/src/jorphan/CVS/Tag
@@ -0,0 +1 @@
+Tv1_8_1
diff --git a/jakarta-jmeter/src/jorphan/org/CVS/Entries b/jakarta-jmeter/src/jorphan/org/CVS/Entries
new file mode 100644
index 0000000..a0bd27a
--- /dev/null
+++ b/jakarta-jmeter/src/jorphan/org/CVS/Entries
@@ -0,0 +1 @@
+D/apache////
diff --git a/jakarta-jmeter/src/jorphan/org/CVS/Repository b/jakarta-jmeter/src/jorphan/org/CVS/Repository
new file mode 100644
index 0000000..5ff3015
--- /dev/null
+++ b/jakarta-jmeter/src/jorphan/org/CVS/Repository
@@ -0,0 +1 @@
+jakarta-jmeter/src/jorphan/org
diff --git a/jakarta-jmeter/src/jorphan/org/CVS/Root b/jakarta-jmeter/src/jorphan/org/CVS/Root
new file mode 100644
index 0000000..41188ef
--- /dev/null
+++ b/jakarta-jmeter/src/jorphan/org/CVS/Root
@@ -0,0 +1 @@
+:pserver:anoncvs@cvs.apache.org:/home/cvspublic
diff --git a/jakarta-jmeter/src/jorphan/org/CVS/Tag b/jakarta-jmeter/src/jorphan/org/CVS/Tag
new file mode 100644
index 0000000..75ba187
--- /dev/null
+++ b/jakarta-jmeter/src/jorphan/org/CVS/Tag
@@ -0,0 +1 @@
+Tv1_8_1
diff --git a/jakarta-jmeter/src/jorphan/org/apache/CVS/Entries b/jakarta-jmeter/src/jorphan/org/apache/CVS/Entries
new file mode 100644
index 0000000..cccca93
--- /dev/null
+++ b/jakarta-jmeter/src/jorphan/org/apache/CVS/Entries
@@ -0,0 +1 @@
+D/jorphan////
diff --git a/jakarta-jmeter/src/jorphan/org/apache/CVS/Repository b/jakarta-jmeter/src/jorphan/org/apache/CVS/Repository
new file mode 100644
index 0000000..bf31a84
--- /dev/null
+++ b/jakarta-jmeter/src/jorphan/org/apache/CVS/Repository
@@ -0,0 +1 @@
+jakarta-jmeter/src/jorphan/org/apache
diff --git a/jakarta-jmeter/src/jorphan/org/apache/CVS/Root b/jakarta-jmeter/src/jorphan/org/apache/CVS/Root
new file mode 100644
index 0000000..41188ef
--- /dev/null
+++ b/jakarta-jmeter/src/jorphan/org/apache/CVS/Root
@@ -0,0 +1 @@
+:pserver:anoncvs@cvs.apache.org:/home/cvspublic
diff --git a/jakarta-jmeter/src/jorphan/org/apache/CVS/Tag b/jakarta-jmeter/src/jorphan/org/apache/CVS/Tag
new file mode 100644
index 0000000..75ba187
--- /dev/null
+++ b/jakarta-jmeter/src/jorphan/org/apache/CVS/Tag
@@ -0,0 +1 @@
+Tv1_8_1
diff --git a/jakarta-jmeter/src/jorphan/org/apache/jorphan/CVS/Entries b/jakarta-jmeter/src/jorphan/org/apache/jorphan/CVS/Entries
new file mode 100644
index 0000000..19973f3
--- /dev/null
+++ b/jakarta-jmeter/src/jorphan/org/apache/jorphan/CVS/Entries
@@ -0,0 +1,7 @@
+D/collections////
+D/gui////
+D/io////
+D/logging////
+D/reflect////
+D/test////
+D/util////
diff --git a/jakarta-jmeter/src/jorphan/org/apache/jorphan/CVS/Repository b/jakarta-jmeter/src/jorphan/org/apache/jorphan/CVS/Repository
new file mode 100644
index 0000000..91269cd
--- /dev/null
+++ b/jakarta-jmeter/src/jorphan/org/apache/jorphan/CVS/Repository
@@ -0,0 +1 @@
+jakarta-jmeter/src/jorphan/org/apache/jorphan
diff --git a/jakarta-jmeter/src/jorphan/org/apache/jorphan/CVS/Root b/jakarta-jmeter/src/jorphan/org/apache/jorphan/CVS/Root
new file mode 100644
index 0000000..41188ef
--- /dev/null
+++ b/jakarta-jmeter/src/jorphan/org/apache/jorphan/CVS/Root
@@ -0,0 +1 @@
+:pserver:anoncvs@cvs.apache.org:/home/cvspublic
diff --git a/jakarta-jmeter/src/jorphan/org/apache/jorphan/CVS/Tag b/jakarta-jmeter/src/jorphan/org/apache/jorphan/CVS/Tag
new file mode 100644
index 0000000..75ba187
--- /dev/null
+++ b/jakarta-jmeter/src/jorphan/org/apache/jorphan/CVS/Tag
@@ -0,0 +1 @@
+Tv1_8_1
diff --git a/jakarta-jmeter/src/jorphan/org/apache/jorphan/collections/CVS/Entries b/jakarta-jmeter/src/jorphan/org/apache/jorphan/collections/CVS/Entries
new file mode 100644
index 0000000..582b444
--- /dev/null
+++ b/jakarta-jmeter/src/jorphan/org/apache/jorphan/collections/CVS/Entries
@@ -0,0 +1,7 @@
+/Data.java/1.2/Fri Dec 27 15:51:17 2002//Tv1_8_1
+/HashTree.java/1.1/Thu Oct 17 19:47:18 2002//Tv1_8_1
+/HashTreeTraverser.java/1.1/Thu Oct 17 19:47:18 2002//Tv1_8_1
+/ListedHashTree.java/1.1/Thu Oct 17 19:47:18 2002//Tv1_8_1
+/SearchByClass.java/1.1/Thu Oct 17 19:47:18 2002//Tv1_8_1
+/SortedHashTree.java/1.1/Thu Oct 17 19:47:18 2002//Tv1_8_1
+D
diff --git a/jakarta-jmeter/src/jorphan/org/apache/jorphan/collections/CVS/Repository b/jakarta-jmeter/src/jorphan/org/apache/jorphan/collections/CVS/Repository
new file mode 100644
index 0000000..9df5177
--- /dev/null
+++ b/jakarta-jmeter/src/jorphan/org/apache/jorphan/collections/CVS/Repository
@@ -0,0 +1 @@
+jakarta-jmeter/src/jorphan/org/apache/jorphan/collections
diff --git a/jakarta-jmeter/src/jorphan/org/apache/jorphan/collections/CVS/Root b/jakarta-jmeter/src/jorphan/org/apache/jorphan/collections/CVS/Root
new file mode 100644
index 0000000..41188ef
--- /dev/null
+++ b/jakarta-jmeter/src/jorphan/org/apache/jorphan/collections/CVS/Root
@@ -0,0 +1 @@
+:pserver:anoncvs@cvs.apache.org:/home/cvspublic
diff --git a/jakarta-jmeter/src/jorphan/org/apache/jorphan/collections/CVS/Tag b/jakarta-jmeter/src/jorphan/org/apache/jorphan/collections/CVS/Tag
new file mode 100644
index 0000000..e2fda28
--- /dev/null
+++ b/jakarta-jmeter/src/jorphan/org/apache/jorphan/collections/CVS/Tag
@@ -0,0 +1 @@
+Nv1_8_1
diff --git a/jakarta-jmeter/src/core/org/apache/jmeter/util/Data.java b/jakarta-jmeter/src/jorphan/org/apache/jorphan/collections/Data.java
similarity index 93%
rename from jakarta-jmeter/src/core/org/apache/jmeter/util/Data.java
rename to jakarta-jmeter/src/jorphan/org/apache/jorphan/collections/Data.java
index a443ed4..6a72686 100644
--- a/jakarta-jmeter/src/core/org/apache/jmeter/util/Data.java
+++ b/jakarta-jmeter/src/jorphan/org/apache/jorphan/collections/Data.java
@@ -52,25 +52,26 @@
  * information on the Apache Software Foundation, please see
  * <http://www.apache.org/>.
  */
+ 
 
-package org.apache.jmeter.util;
+package org.apache.jorphan.collections;
+import java.io.Serializable;
 import java.util.ArrayList;
 import java.util.HashMap;
 import java.util.Iterator;
 import java.util.List;
 import java.util.Map;
 
+import org.apache.jorphan.util.JOrphanUtils;
 
 /****************************************************************
  Use this class to store database-like data.  This class uses rows
  and columns to organize its data.  It has some convenience methods
  that allow fast loading and retrieval of the data into and out of
- string arrays.  It also can work closely with the DataTree class to
- sort string data.
-@author Michael Stover
-@version 1.0 10/14/1998
+ string arrays.  It is also handy for reading CSV files.
+@author Michael Stover (mstover1 at apache.org)
  ******************************************************************/
-public class Data
+public class Data implements Serializable
 {
   Map data;
   Map iterators = new HashMap();
@@ -115,8 +116,8 @@ Adds the rows of the given Data object to this Data object.
 	 if(headers.length!=dHeaders.length)
 		valid=false;
 	 else
-		for(int count = 0;count<headers.length && count<dHeaders.length;count++)
-		  if(JMeterUtils.findInArray(headers,dHeaders[count])<0)
+		for(int count = 0;count<dHeaders.length;count++)
+		  if(!header.contains(dHeaders[count]))
 			 valid=false;
 	 if(valid)
 	 {
@@ -332,6 +333,10 @@ Returns the row number where a certain value is.
 		  size++;
 		  tempList.add(value);
 	 }
+	 else if(currentPos >= tempList.size())
+	 {
+	 	tempList.add(value);
+	 }
 	 else
 		tempList.set(currentPos,value);
   }// end method
@@ -413,7 +418,13 @@ Returns the row number where a certain value is.
   	setCurrentPos(row);
   	return getColumnValue(column);
   }
-
+  
+  public void removeColumn(int col)
+  {
+  	String columnName = (String)header.get(col);
+  	data.remove(columnName);
+  	header.remove(columnName);
+  }
 
 
   /*****************************************************************
@@ -454,16 +465,9 @@ Returns the row number where a certain value is.
 @param columnName String value, name of the column.
 @return Array of Objects representing the data.
   *****************************************************************/
-  public Object[] getColumnAsObjectArray(String columnName)
+  public List getColumnAsObjectArray(String columnName)
   {
-	 Object[] returnValue;
-	 Object o;
-	 List temp=(List)data.get(columnName);
-	 if(temp != null)
-		returnValue = temp.toArray();
-	 else
-		returnValue = new Object[0];
-	 return returnValue;
+	 return (List)data.get(columnName);
   }// end of Method
 
 
@@ -514,11 +518,11 @@ Returns the row number where a certain value is.
 	  *****************************************************************/
   public void setData(String[] contents, String delimiter)
   {
-		setHeaders(JMeterUtils.split(contents[0],delimiter));
+		setHeaders(JOrphanUtils.split(contents[0], delimiter));
 		int x=1;
 		while(x<contents.length)
 		{
-			setLine(JMeterUtils.split(contents[x++],delimiter));
+			setLine(JOrphanUtils.split(contents[x++], delimiter));
 		}
 	 } //end of Method
 
@@ -531,6 +535,27 @@ Returns the row number where a certain value is.
   {
 
   }*/
+  
+  public void setColumnData(String colName,Object value)
+  {
+  	List list = this.getColumnAsObjectArray(colName);
+  	for(int x = 0;x < list.size();x++)
+  	{
+  		list.set(x,value);
+  	}
+  }
+  
+  public void setColumnData(int col,List data)
+  {
+  	reset();
+  	Iterator iter = data.iterator();
+  	String columnName = (String)header.get(col);
+  	while(iter.hasNext())
+  	{
+  		next();
+  		setColumnValue(columnName,iter.next());
+  	}
+  }
 
 
   /***************************************************
@@ -540,7 +565,7 @@ Returns the row number where a certain value is.
   public void addHeader(String s)
   {
 	header.add(s);
-	data.put(s,new ArrayList());
+	data.put(s,new ArrayList(size()));
   }
 
   /************************************************************
diff --git a/jakarta-jmeter/src/jorphan/org/apache/jorphan/collections/HashTree.java b/jakarta-jmeter/src/jorphan/org/apache/jorphan/collections/HashTree.java
new file mode 100644
index 0000000..f3757e2
--- /dev/null
+++ b/jakarta-jmeter/src/jorphan/org/apache/jorphan/collections/HashTree.java
@@ -0,0 +1,982 @@
+/*
+ * ====================================================================
+ * The Apache Software License, Version 1.1
+ *
+ * Copyright (c) 2001 The Apache Software Foundation.  All rights
+ * reserved.
+ *
+ * Redistribution and use in source and binary forms, with or without
+ * modification, are permitted provided that the following conditions
+ * are met:
+ *
+ * 1. Redistributions of source code must retain the above copyright
+ * notice, this list of conditions and the following disclaimer.
+ *
+ * 2. Redistributions in binary form must reproduce the above copyright
+ * notice, this list of conditions and the following disclaimer in
+ * the documentation and/or other materials provided with the
+ * distribution.
+ *
+ * 3. The end-user documentation included with the redistribution,
+ * if any, must include the following acknowledgment:
+ * "This product includes software developed by the
+ * Apache Software Foundation (http://www.apache.org/)."
+ * Alternately, this acknowledgment may appear in the software itself,
+ * if and wherever such third-party acknowledgments normally appear.
+ *
+ * 4. The names "Apache" and "Apache Software Foundation" and
+ * "Apache JMeter" must not be used to endorse or promote products
+ * derived from this software without prior written permission. For
+ * written permission, please contact apache@apache.org.
+ *
+ * 5. Products derived from this software may not be called "Apache",
+ * "Apache JMeter", nor may "Apache" appear in their name, without
+ * prior written permission of the Apache Software Foundation.
+ *
+ * THIS SOFTWARE IS PROVIDED ``AS IS'' AND ANY EXPRESSED OR IMPLIED
+ * WARRANTIES, INCLUDING, BUT NOT LIMITED TO, THE IMPLIED WARRANTIES
+ * OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE ARE
+ * DISCLAIMED.  IN NO EVENT SHALL THE APACHE SOFTWARE FOUNDATION OR
+ * ITS CONTRIBUTORS BE LIABLE FOR ANY DIRECT, INDIRECT, INCIDENTAL,
+ * SPECIAL, EXEMPLARY, OR CONSEQUENTIAL DAMAGES (INCLUDING, BUT NOT
+ * LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES; LOSS OF
+ * USE, DATA, OR PROFITS; OR BUSINESS INTERRUPTION) HOWEVER CAUSED AND
+ * ON ANY THEORY OF LIABILITY, WHETHER IN CONTRACT, STRICT LIABILITY,
+ * OR TORT (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT
+ * OF THE USE OF THIS SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF
+ * SUCH DAMAGE.
+ * ====================================================================
+ *
+ * This software consists of voluntary contributions made by many
+ * individuals on behalf of the Apache Software Foundation.  For more
+ * information on the Apache Software Foundation, please see
+ * <http://www.apache.org/>.
+ */
+ 
+
+
+package org.apache.jorphan.collections;
+import java.io.IOException;
+import java.io.ObjectInputStream;
+import java.io.ObjectOutputStream;
+import java.io.Serializable;
+import java.util.Arrays;
+import java.util.Collection;
+import java.util.HashMap;
+import java.util.Iterator;
+import java.util.Map;
+import java.util.Set;
+
+import junit.framework.TestCase;
+
+import org.apache.log.Logger;
+import org.apache.jorphan.logging.LoggingManager;
+/**********************************************************************
+This class is used to create a tree structure of objects.  Each element in the tree
+is also a key to the next node down in the tree.  It provides many ways to add objects and 
+branches, as well as many ways to retrieve. 
+<p>
+HashTree implements the Map interface for convenience reasons.  The main difference between 
+a Map and a HashTree is that the HashTree organizes the data into a recursive tree structure,
+and provides the means to manipulate that structure.
+<p>
+Of special interest is the 
+{@link traverse(HashTreeTraverser)} method, which provides an expedient way to 
+traverse any HashTree by implementing the
+{@link HashTreeTraverser} interface in order to perform some operation on the tree, or to extract
+information from the tree.
+
+@author Michael Stover (mstover1 at apache.org)
+@see HashTreeTraverser
+@see SearchByClass
+***********************************************************************/
+public class HashTree implements Serializable,Map
+{
+	private static Logger log = LoggingManager.getLoggerFor("jorphan.collections");
+	/**
+	 * Creates an empty new HashTree
+	 */
+	public HashTree()
+	{
+		data = new HashMap();
+	}
+	/**
+	 * Creates a new HashTree and adds the given object as a top-level node.
+	 * @param key
+	 */
+	public HashTree(Object key)
+	{
+		data = new HashMap();
+		data.put(key, new HashTree());
+	}
+	/**
+	 * The Map given must also be a HashTree, otherwise an UnsupportedOperationException
+	 * is thrown.  If it is a HashTree, this is like calling the add(HashTree) method.
+	 * @see add(HashTree)
+	 * @see java.util.Map#putAll(Map)
+	 */
+	public void putAll(Map map)
+	{
+		if(map instanceof HashTree)
+		{
+			this.add((HashTree)map);
+		}
+		else
+		{
+			throw new UnsupportedOperationException("can only putAll other HashTree objects");
+		}
+	}
+	
+	/**
+	 * Exists to satisfy the Map interface.  
+	 * @see java.util.Map#entrySet()
+	 */
+	public Set entrySet()
+	{
+		return data.entrySet();
+	}
+	
+	/**
+	 * Implemented as required by the Map interface, but is not very useful here. All
+	 * 'values' in a HashTree are HashTree's themselves. 
+	 * @param obj Object to be tested as a value.
+	 * @return True if the HashTree contains the value, false otherwise.
+	 * @see java.util.Map#containsValue(Object)
+	 */
+	public boolean containsValue(Object value)
+	{
+		return data.containsValue(value);
+	}
+	
+	/**
+	 * This is the same as calling HashTree.add(key,value).
+	 * @see java.util.Map#put(Object, Object)
+	 */
+	public Object put(Object key,Object value)
+	{
+		Object previous = data.get(key);
+		add(key,value);
+		return previous;
+	}
+	
+	/**
+	 * Clears the HashTree of all contents.
+	 * @see java.util.Map#clear()
+	 */
+	public void clear()
+	{
+		data.clear();
+	}
+	
+	/**
+	 * Returns a collection of all the sub-trees of the current tree.
+	 * @see java.util.Map#values()
+	 */
+	public Collection values()
+	{
+		return data.values();
+	}
+	
+	/****************************************
+	 * Adds a key as a node at the current level and then adds the
+	 * given HashTree to that new node.
+	 *
+	 *@param key      Key to create in this tree
+	 *@param subTree  Sub tree to add to the node created for the first argument.
+	 ***************************************/
+	public void add(Object key,HashTree subTree)
+	{
+		add(key);
+		getTree(key).add(subTree);
+	}
+	
+	/**
+	 * Adds all the nodes and branches of the given tree to this tree.  Is like merging
+	 * two trees.  Duplicates are ignored.
+	 * @param newTree
+	 */
+	public void add(HashTree newTree)
+	{
+		Iterator iter = newTree.list().iterator();
+		while(iter.hasNext())
+		{
+			Object item = iter.next();
+			add(item);
+			getTree(item).add(newTree.getTree(item));
+		}
+	}
+	/**
+	 * Creates a new HashTree and adds all the objects in the given collection as top-level
+	 * nodes in the tree.
+	 * @param keys A collection of objects to be added to the created HashTree.
+	 */
+	public HashTree(Collection keys)
+	{
+		data = new HashMap();
+		Iterator it = keys.iterator();
+		while (it.hasNext())
+			data.put(it.next(), new HashTree());
+	}
+	/**
+	 * Creates a new HashTree and adds all the objects in the given array as top-level
+	 * nodes in the tree.
+	 * @param keys
+	 */
+	public HashTree(Object[] keys)
+	{
+		data = new HashMap();
+		for (int x = 0; x < keys.length; x++)
+			data.put(keys[x], new HashTree());
+	}
+	/************************************************************
+	  If the HashTree contains the given object as a key at the top level, then a
+	  true result is returned, otherwise false.
+	@param obj Object to be tested as a key.
+	@return True if the HashTree contains the key, false otherwise.
+	@see java.util.Map#containsKey()
+	***************************************************************/
+	public boolean containsKey(Object o)
+	{
+		return data.containsKey(o);
+	}
+	/*****************************************************************
+	  If the HashTree is empty, true is returned, false otherwise.
+	@return True if HashTree is empty, false otherwise.
+	***************************************************************/
+	public boolean isEmpty()
+	{
+		return data.isEmpty();
+	}
+	/************************************************************************
+	  Sets a key and it's value in the HashTree.  It actually sets up a key, and then
+	  creates a node for the key and sets the value to the new node, as a key.  Any
+	  previous nodes that existed under the given key are lost.
+	@param key Key to be set up.
+	@param value Value to be set up as a key in the secondary node.
+	*************************************************************************/
+	public void set(Object key, Object value)
+	{
+		data.put(key, createNewTree(value));
+	}
+	/********************************************************************
+	 Sets a key into the current tree and assigns it a HashTree as its subtree.  Any
+	 previous entries under the given key are removed.
+	@param key Key to be set up.
+	@param tree HashTree that the key maps to.
+	**************************************************************************/
+	public void set(Object key, HashTree t)
+	{
+		data.put(key, t);
+	}
+	/************************************************************************
+	Sets a key and it's values in the HashTree.  It sets up a key in the current node, and
+	then creates a node for that key, and sets all the values in the array as keys in
+	 the new node.  Any keys previously held under the given key are lost.
+	@param key Key to be set up.
+	@param values Array of objects to be added as keys in the secondary node.
+	********************************************************************/
+	public void set(Object key, Object[] values)
+	{
+		data.put(key, createNewTree(Arrays.asList(values)));
+	}
+	/********************************************************************
+	 Sets a key and its values in the HashTree.  It sets up a key in the current node, and
+	 then creates a node for that key, and set all the values in the array as keys in
+	 the new node.  Any keys previously held under the given key are removed.
+	@param key Key to be set up.
+	@param values Collection of objects to be added as keys in the secondary node.
+	**************************************************************************/
+	public void set(Object key, Collection values)
+	{
+		data.put(key, createNewTree(values));
+	}
+	/********************************************************************
+	  Sets a series of keys into the HashTree.  It sets up the first object in the
+	  key array as a key in the current node, recurses into the next HashTree node through
+	  that key and adds the second object in the array.  Continues recursing in this
+	  manner until the end of the first array is reached, at which point all the
+	  values of the second array are set as keys to the bottom-most node.  All previous
+	  keys of that bottom-most node are removed.
+	@param treePath Array of keys to put into HashTree.
+	@param values Array of values to be added as keys to bottom-most node.
+	********************************************************************/
+	public void set(Object[] treePath, Object[] values)
+	{
+		if(treePath != null && values != null)
+		{
+			set(Arrays.asList(treePath),Arrays.asList(values));
+		}
+	}
+	/********************************************************************
+	  Sets a series of keys into the HashTree.  It sets up the first object in the
+	  key array as a key in the current node, recurses into the next HashTree node through
+	  that key and adds the second object in the array.  Continues recursing in this
+	  manner until the end of the first array is reached, at which point all the
+	  values of the Collection of values are set as keys to the bottom-most node.  Any
+	  keys previously held by the bottom-most node are lost.
+	@param key Array of keys to put into HashTree.
+	@param values Collection of values to be added as keys to bottom-most node.
+	********************************************************************/
+	public void set(Object[] treePath, Collection values)
+	{
+		if(treePath != null)
+		{
+			set(Arrays.asList(treePath),values);
+		}
+	}
+	/********************************************************************
+	  Sets a series of keys into the HashTree.  It sets up the first object in the
+	  key list as a key in the current node, recurses into the next HashTree node through
+	  that key and adds the second object in the list.  Continues recursing in this
+	  manner until the end of the first list is reached, at which point all the
+	  values of the array of values are set as keys to the bottom-most node.  Any
+	  previously existing keys of that bottom node are removed.
+	@param treePath List of keys to put into HashTree.
+	@param values Array of values to be added as keys to bottom-most node.
+	********************************************************************/
+	public void set(Collection treePath, Object[] values)
+	{
+		HashTree tree = addTreePath(treePath);
+		tree.set(Arrays.asList(values));
+	}
+	/****************************************
+	 * Sets the nodes of the current tree to be the objects of the given collection.  
+	 * Any nodes previously in the tree are removed.
+	 *
+	 *@param values  Collection of objects to set as nodes.
+	 ***************************************/
+	public void set(Collection values)
+	{
+		Iterator iter = this.list().iterator();
+		while(iter.hasNext())
+		{
+			this.remove(iter.next());
+		}
+		this.add(values);
+	}
+	/********************************************************************
+	  Sets a series of keys into the HashTree.  It sets up the first object in the
+	  key list as a key in the current node, recurses into the next HashTree node through
+	  that key and adds the second object in the list.  Continues recursing in this
+	  manner until the end of the first list is reached, at which point all the
+	  values of the Collection of values are set as keys to the bottom-most node.  Any
+	  previously existing keys of that bottom node are lost.
+	@param key List of keys to put into HashTree.
+	@param values Collection of values to be added as keys to bottom-most node.
+	********************************************************************/
+	public void set(Collection treePath, Collection values)
+	{
+		HashTree tree = addTreePath(treePath);
+		tree.set(values);
+	}
+	/*********************************************************************
+	Adds an key into the HashTree at the current level.
+	@param key Key to be added to HashTree.
+	*****************************************************************/
+	public void add(Object key)
+	{
+		if (!data.containsKey(key))
+			data.put(key, createNewTree());
+	}
+	/*******************************************************************
+	Adds all the given objects as nodes at the current level.
+	@param keys Array of Keys to be added to HashTree.
+	*******************************************************************/
+	public void add(Object[] keys)
+	{
+		for (int x = 0; x < keys.length; x++)
+			add(keys[x]);
+	}
+	/*******************************************************************
+	Adds a bunch of keys into the HashTree at the current level.
+	@param keys Collection of Keys to be added to HashTree.
+	*******************************************************************/
+	public void add(Collection keys)
+	{
+		Iterator it = keys.iterator();
+		while (it.hasNext())
+			add(it.next());
+	}
+	/************************************************************************
+	* Adds a key and it's value in the HashTree.  The first argument becomes a node 
+	* at the current level, and the second argument becomes a node of it.
+	@param key Key to be added.
+	@param value Value to be added as a key in the secondary node.
+	*************************************************************************/
+	public void add(Object key, Object value)
+	{
+		add(key);
+		getTree(key).add(value);
+	}
+	/************************************************************************
+	Adds a key and it's values in the HashTree.  The first argument becomes a 
+	node at the current level, and adds all the values in the array to
+	 the new node.
+	@param key Key to be added.
+	@param values Array of objects to be added as keys in the secondary node.
+	********************************************************************/
+	public void add(Object key, Object[] values)
+	{
+		add(key);
+		getTree(key).add(values);
+	}
+	/************************************************************************
+	Adds a key as a node at the current level and then adds all the objects in the
+	second argument as nodes of the new node. 
+	@param key Key to be added.
+	@param values Collection of objects to be added as keys in the secondary node.
+	********************************************************************/
+	public void add(Object key, Collection values)
+	{
+		add(key);
+		getTree(key).add(values);
+	}
+	/********************************************************************
+	* Adds a series of nodes into the HashTree using the given path.  The
+	* first argument is an array that represents a path to a specific node in the
+	* tree.  If the path doesn't already exist, it is created (the objects are added 
+	* along the way).  At the path, all the objects in the second argument are added
+	* as nodes.
+	@param treePath An array of objects representing a path.
+	@param values Array of values to be added as keys to bottom-most node.
+	********************************************************************/
+	public void add(Object[] treePath, Object[] values)
+	{
+		if(treePath != null)
+		{
+			add(Arrays.asList(treePath), Arrays.asList(values));
+		}
+	}
+	/********************************************************************
+	* Adds a series of nodes into the HashTree using the given path.  The
+	* first argument is an array that represents a path to a specific node in the
+	* tree.  If the path doesn't already exist, it is created (the objects are added 
+	* along the way).  At the path, all the objects in the second argument are added
+	* as nodes.
+	@param treePath An array of objects representing a path.
+	@param values Collection of values to be added as keys to bottom-most node.
+	********************************************************************/
+	public void add(Object[] treePath, Collection values)
+	{
+		if(treePath != null)
+		{
+			add(Arrays.asList(treePath), values);
+		}
+	}
+	/********************************************************************
+	*  Adds a series of nodes into the HashTree using the given path.  The
+	* first argument is a List that represents a path to a specific node in the
+	* tree.  If the path doesn't already exist, it is created (the objects are added 
+	* along the way).  At the path, all the objects in the second argument are added
+	* as nodes.
+	@param treePath A list of objects representing a path.
+	@param values Array of values to be added as keys to bottom-most node.
+	********************************************************************/
+	public void add(Collection treePath, Object[] values)
+	{
+		HashTree tree = addTreePath(treePath);
+		tree.add(Arrays.asList(values));
+	}
+	/****************************************
+	 * Adds a series of nodes into the HashTree using the given path.  The
+	* first argument is a List that represents a path to a specific node in the
+	* tree.  If the path doesn't already exist, it is created (the objects are added 
+	* along the way).  At the path, the object in the second argument is added
+	* as a node.
+	 *
+	 *@param key     A list of objects representing a path.
+	 *@param value   Object to add as a node to bottom-most node.
+	 ***************************************/
+	public void add(Collection treePath, Object value)
+	{
+		HashTree tree = addTreePath(treePath);
+		tree.add(value);
+	}
+	/********************************************************************
+	* Adds a series of nodes into the HashTree using the given path.  The
+	* first argument is a SortedSet that represents a path to a specific node in the
+	* tree.  If the path doesn't already exist, it is created (the objects are added 
+	* along the way).  At the path, all the objects in the second argument are added
+	* as nodes.
+	@param treePath A SortedSet of objects representing a path.
+	@param values Collection of values to be added as keys to bottom-most node.
+	********************************************************************/
+	public void add(Collection treePath, Collection values)
+	{
+		HashTree tree = addTreePath(treePath);
+		tree.add(values);
+	}
+
+	protected HashTree addTreePath(Collection treePath)
+	{
+		HashTree tree = this;
+		Iterator iter = treePath.iterator();
+		while(iter.hasNext())
+		{
+			Object temp = iter.next();
+			tree.add(temp);
+			tree = tree.getTree(temp);
+		}
+		return tree;
+	}
+	/*********************************************************************
+	Gets the HashTree mapped to the given key.
+	@param key Key used to find appropriate HashTree()
+	********************************************************************/
+	public HashTree getTree(Object key)
+	{
+		return (HashTree) data.get(key);
+	}
+	
+	/**
+	 * Returns the HashTree object associated with the given key.  Same as calling
+	 * getTree(key).
+	 * @see org.apache.jorphan.collections.HashTree#getTree(Object)
+	 * @see java.util.Map#get(Object)
+	 */
+	public Object get(Object key)
+	{
+		return getTree(key);
+	}
+	/*************************************************************
+	Gets the HashTree object mapped to the last key in the array by recursing through
+	the HashTree structure one key at a time.
+	@param treePath Array of keys.
+	@return HashTree at the end of the recursion.
+	**************************************************************/
+	public HashTree getTree(Object[] treePath)
+	{
+		if(treePath != null)
+		{
+			return getTree(Arrays.asList(treePath));
+		}
+		else
+		{
+			return this;
+		}
+	}
+	
+	/**
+	 * Create a clone of this HashTree.  This is not a deep clone (ie, the contents of 
+	 * the tree are not cloned).
+	 * @see java.lang.Object#clone()
+	 */
+	public Object clone()
+	{
+		HashTree newTree = new HashTree();
+		newTree.data = (Map)((HashMap)data).clone();
+		return newTree;
+	}
+	
+	/**
+	 * Creates a new tree.  This method exists to allow inheriting classes to generate the
+	 * appropriate types of nodes.  For instance, when a node is added, it's value is a HashTree.
+	 * Rather than directly calling the HashTree() constructor, the createNewTree() method is
+	 * called.  Inheriting classes should override these methods and create the appropriate
+	 * subclass of HashTree.
+	 * @return HashTree
+	 */
+	protected HashTree createNewTree()
+	{
+		return new HashTree();
+	}
+	
+	/**
+	 * Creates a new tree.  This method exists to allow inheriting classes to generate the
+	 * appropriate types of nodes.  For instance, when a node is added, it's value is a HashTree.
+	 * Rather than directly calling the HashTree() constructor, the createNewTree() method is
+	 * called.  Inheriting classes should override these methods and create the appropriate
+	 * subclass of HashTree.
+	 * @return HashTree
+	 */
+	protected HashTree createNewTree(Object key)
+	{
+		return new HashTree(key);
+	}
+	
+	/**
+	 * Creates a new tree.  This method exists to allow inheriting classes to generate the
+	 * appropriate types of nodes.  For instance, when a node is added, it's value is a HashTree.
+	 * Rather than directly calling the HashTree() constructor, the createNewTree() method is
+	 * called.  Inheriting classes should override these methods and create the appropriate
+	 * subclass of HashTree.
+	 * @return HashTree
+	 */
+	protected HashTree createNewTree(Collection values)
+	{
+		return new HashTree(values);
+	}
+	
+	/*************************************************************
+	Gets the HashTree object mapped to the last key in the SortedSet by recursing through
+	the HashTree structure one key at a time.
+	@param treePath SortedSet of keys.
+	@return HashTree at the end of the recursion.
+	**************************************************************/
+	public HashTree getTree(Collection treePath)
+	{
+		return getTreePath(treePath);
+	}
+	/****************************************************************
+	Gets a Collection of all keys in the current HashTree node.  If the HashTree represented
+	a file system, this would be like getting a collection of all the files in the current
+	folder.
+	@return Set of all keys in this HashTree.
+	*****************************************************************/
+	public Collection list()
+	{
+		return data.keySet();
+	}
+	/***************************************************************
+	  Gets a Set of all keys in the HashTree mapped to the given key of the
+	  current HashTree object (in other words, one level down.  If the HashTree
+	  represented a file system, this would like getting a list of all files in
+	  a sub-directory (of the current directory) specified by the key argument
+	@param key Key used to find HashTree to get list of.
+	@return Set of all keys in found HashTree.
+	***************************************************************/
+	public Collection list(Object key)
+	{
+		HashTree temp = (HashTree) data.get(key);
+		if (temp != null)
+			return temp.list();
+		else
+			return null;
+	}
+	/**
+	 * Removes the entire branch specified by the given key.
+	 * @see java.util.Map#remove(Object)
+	 */
+	public Object remove(Object key)
+	{
+		return data.remove(key);
+	}
+	/*************************************************************
+	Recurses down into the HashTree stucture using each subsequent key in the
+	array of keys, and returns the Set of keys of the HashTree object at the
+	end of the recursion.  If the HashTree represented a file system, this would
+	be like getting a list of all the files in a directory specified by
+	the treePath, relative from the current directory.
+	@param treePath Array of keys used to recurse into HashTree structure.
+	@return Set of all keys found in end HashTree.
+	**************************************************************/
+	public Collection list(Object[] treePath)
+	{
+		if(treePath != null)
+		{
+			return list(Arrays.asList(treePath));
+		}
+		else
+		{
+			return list();
+		}
+	}
+	/*************************************************************
+	Recurses down into the HashTree stucture using each subsequent key in the
+	List of keys, and returns the Set of keys of the HashTree object at the
+	end of the recursion.  If the HashTree represented a file system, this would
+	be like getting a list of all the files in a directory specified by
+	the treePath, relative from the current directory.
+	@param treePath List of keys used to recurse into HashTree structure.
+	@return Set of all keys found in end HashTree.
+	**************************************************************/
+	public Collection list(Collection treePath)
+	{
+		return getTreePath(treePath).list();
+	}
+	/****************************************
+	 * Finds the given current key, and replaces it with the given new key.  Any 
+	 * tree structure found under the original key is moved to the new key.
+	 *
+	 *@param currentKey  !ToDo (Parameter description)
+	 *@param newKey      !ToDo (Parameter description)
+	 ***************************************/
+	public void replace(Object currentKey, Object newKey)
+	{
+		HashTree tree = getTree(currentKey);
+		data.remove(currentKey);
+		data.put(newKey, tree);
+	}
+	/****************************************************************
+	Gets an array of all keys in the current HashTree node.  If the HashTree represented
+	a file system, this would be like getting an array of all the files in the current
+	folder.
+	@return Array of all keys in this HashTree.
+	*****************************************************************/
+	public Object[] getArray()
+	{
+		return data.keySet().toArray();
+	}
+	/***************************************************************
+	  Gets an array of all keys in the HashTree mapped to the given key of the
+	  current HashTree object (in other words, one level down).  If the HashTree
+	  represented a file system, this would like getting a list of all files in
+	  a sub-directory (of the current directory) specified by the key argument
+	@param key Key used to find HashTree to get list of.
+	@return Array of all keys in found HashTree.
+	***************************************************************/
+	public Object[] getArray(Object key)
+	{
+		return getTree(key).getArray();
+	}
+	/*************************************************************
+	Recurses down into the HashTree stucture using each subsequent key in the
+	array of keys, and returns an array of keys of the HashTree object at the
+	end of the recursion.  If the HashTree represented a file system, this would
+	be like getting a list of all the files in a directory specified by
+	the treePath, relative from the current directory.
+	@param keys Array of keys used to recurse into HashTree structure.
+	@return Array of all keys found in end HashTree.
+	**************************************************************/
+	public Object[] getArray(Object[] treePath)
+	{
+		if(treePath != null)
+		{
+			return getArray(Arrays.asList(treePath));
+		}
+		else
+		{
+			return getArray();
+		}
+	}
+	/*************************************************************
+	Recurses down into the HashTree stucture using each subsequent key in the
+	treePath argument, and returns an array of keys of the HashTree object at the
+	end of the recursion.  If the HashTree represented a file system, this would
+	be like getting a list of all the files in a directory specified by
+	the treePath, relative from the current directory.
+	@param treePath List of keys used to recurse into HashTree structure.
+	@return Array of all keys found in end HashTree.
+	**************************************************************/
+	public Object[] getArray(Collection treePath)
+	{
+		HashTree tree = getTreePath(treePath);
+		return tree.getArray();
+	}
+	protected HashTree getTreePath(Collection treePath)
+	{
+		HashTree tree = this;
+		Iterator iter = treePath.iterator();
+		while(iter.hasNext())
+		{
+			Object temp = iter.next();
+			log.debug("Getting tree for " +temp);
+			tree = tree.getTree(temp);
+		}
+		return tree;
+	}
+	/**
+	 * Returns a hashcode for this HashTree.
+	 * @see java.lang.Object#hashCode()
+	 */
+	public int hashCode()
+	{
+		return data.hashCode() * 7;
+	}
+	/**
+	 * Compares all objects in the tree and verifies that the two trees contain
+	 * the same objects at the same tree levels.  Returns true if they do, false otherwise.
+	 * @see java.lang.Object#equals(Object)
+	 */
+	public boolean equals(Object o)
+	{
+		boolean flag = true;
+		if (o instanceof HashTree)
+		{
+			HashTree oo = (HashTree) o;
+			Iterator it = data.keySet().iterator();
+			while (it.hasNext())
+			{
+				if (!oo.containsKey(it.next()))
+				{
+					flag = false;
+					break;
+				}
+			}
+			if (flag)
+			{
+				it = data.keySet().iterator();
+				while (it.hasNext())
+				{
+					Object temp = it.next();
+					flag = get(temp).equals(oo.get(temp));
+					if (!flag)
+						break;
+				}
+			}
+		}
+		else
+			flag = false;
+		return flag;
+	}
+	/**
+	 * Returns a Set of all the keys in the top-level of this HashTree.
+	 * @see java.util.Map#keySet()
+	 */
+	public Set keySet()
+	{
+		return data.keySet();
+	}
+	/*****************************************************
+	Searches the HashTree structure for the given key.  If it finds the key,
+	it returns the HashTree mapped to the key.  If it finds nothing, it returns
+	null.
+	@param key Key to search for.
+	@return HashTree mapped to key, if found, otherwise <B>null</B>.
+	**********************************************************/
+	public HashTree search(Object key)
+	{
+		HashTree temp = null;
+		if (data.containsKey(key))
+			temp = (HashTree) data.get(key);
+		else
+		{
+			Iterator it = list().iterator();
+			while (it.hasNext())
+			{
+				if (temp == null)
+				{
+					temp = ((HashTree) it.next()).search(key);
+					break;
+				}
+				else
+					break;
+			}
+		}
+		return temp;
+	}
+	/**
+	 * Method readObject.
+	 * @param ois
+	 * @throws ClassNotFoundException
+	 * @throws IOException
+	 */
+	void readObject(ObjectInputStream ois)
+		throws ClassNotFoundException, IOException
+	{
+		ois.defaultReadObject();
+	}
+	void writeObject(ObjectOutputStream oos) throws IOException
+	{
+		oos.defaultWriteObject();
+	}
+	/**
+	 * Returns the number of top-level entries in the HashTree.
+	 * @see java.util.Map#size()
+	 */
+	public int size()
+	{
+		return data.size();
+	}
+		/****************************************
+	 * Allows any implementation of the HashTreeTraverser interface to 
+	 * easily traverse (depth-first) all the nodes of the HashTree.  The
+	 * Traverser implementation will be given notification of each node visited.
+	 *
+	 *@param visitor  !ToDo (Parameter description)
+	 * @see org.apache.jorphan.collections.HashTreeTraverser
+	 ***************************************/
+	public void traverse(HashTreeTraverser visitor)
+	{
+		Iterator iter = list().iterator();
+		while(iter.hasNext())
+		{
+			Object item = iter.next();
+			visitor.addNode(item, getTree(item));
+			getTree(item).traverseInto(visitor);
+		}
+	}
+
+	/**
+	 * The recursive method that accomplishes the tree-traversal and performs the 
+	 * callbacks to the HashTreeTraverser.
+	 * @param visitor
+	 */
+	private void traverseInto(HashTreeTraverser visitor)
+	{
+		Iterator iter = list().iterator();
+		while(iter.hasNext())
+		{
+			Object item = iter.next();
+			visitor.addNode(item, getTree(item));
+			getTree(item).traverseInto(visitor);
+		}
+		if(list().size() == 0)
+		{
+			visitor.processPath();
+		}
+		visitor.subtractNode();
+	}
+	
+	public String toString()
+	{
+		ConvertToString converter = new ConvertToString();
+		traverse(converter);
+		return converter.toString();
+	}
+	
+	protected java.util.Map data;
+	
+	private class ConvertToString implements HashTreeTraverser
+	{
+		StringBuffer string = new StringBuffer(getClass().getName());
+		StringBuffer spaces = new StringBuffer();
+		int depth = 0;
+		public void addNode(Object key,HashTree subTree)
+		{
+			depth++;
+			string.append("\n"+getSpaces()+"{"+key);
+		}
+		
+		public void subtractNode()
+		{
+			depth--;
+			string.append("\n"+getSpaces()+"}");
+		}
+		
+		public void processPath()
+		{
+		}
+		
+		public String toString()
+		{
+			return string.toString();
+		}
+		
+		private String getSpaces()
+		{
+			if(spaces.length() < depth * 2)
+			{
+				while(spaces.length() < depth * 2)
+				{
+					spaces.append("  ");
+				}
+			}
+			else if(spaces.length() > depth * 2)
+			{
+				spaces.setLength(depth * 2);
+			}
+			return spaces.toString();
+		}
+	}
+	
+	public static class Test extends TestCase
+	{
+		public Test(String name)
+		{
+			super(name);
+		}
+		
+		public void testAdd1() throws Exception
+		{
+			Collection treePath = Arrays.asList(new String[]{"1","2","3","4"});
+			HashTree tree = new HashTree();
+			log.debug("treePath = "+treePath);
+			tree.add(treePath,new String("value"));
+			log.debug("Now treePath = "+treePath);
+			log.debug(tree.toString());
+			assertEquals(1,tree.list(treePath).size());
+			assertEquals("value",tree.getArray(treePath)[0]);
+		}
+	}
+}
diff --git a/jakarta-jmeter/src/core/org/apache/jmeter/save/old/handlers/ArgumentsHandler.java b/jakarta-jmeter/src/jorphan/org/apache/jorphan/collections/HashTreeTraverser.java
similarity index 53%
rename from jakarta-jmeter/src/core/org/apache/jmeter/save/old/handlers/ArgumentsHandler.java
rename to jakarta-jmeter/src/jorphan/org/apache/jorphan/collections/HashTreeTraverser.java
index e5f40c3..95313de 100644
--- a/jakarta-jmeter/src/core/org/apache/jmeter/save/old/handlers/ArgumentsHandler.java
+++ b/jakarta-jmeter/src/jorphan/org/apache/jorphan/collections/HashTreeTraverser.java
@@ -52,93 +52,58 @@
  * information on the Apache Software Foundation, please see
  * <http://www.apache.org/>.
  */
- package org.apache.jmeter.save.old.handlers;
-
-import java.io.IOException;
-import java.io.Writer;
-import java.util.Iterator;
-
-import org.apache.jmeter.config.Argument;
-import org.apache.jmeter.config.Arguments;
-import org.apache.jmeter.save.old.Saveable;
-import org.apache.jmeter.save.old.xml.TagHandler;
-import org.apache.jmeter.testelement.TestElement;
-import org.xml.sax.Attributes;
+ 
+package org.apache.jorphan.collections;
 
 /**
- * Title:        JMeter
- * Description:
- * Copyright:    Copyright (c) 2000
- * Company:      Apache
- * @author Michael Stover
- * @version 1.0
+ * By implementing this interface, a class can easily traverse a HashTree object, and be
+ * notified via callbacks of certain events.  There are three such events:
+ * <ol><li>When a node is first encountered, the traverser's 
+ * {@link addNode(Object,HashTree)} method
+ *  is called.  It is handed the object at that node, and the entire sub-tree of the node.</li>
+ * <li>When a leaf node is encountered, the traverser is notified that a full path has been
+ * finished via the {@link processPath()} method.  It is the traversing class's responsibility
+ * to know the path that has just finished (this can be done by keeping a simple stack of
+ * all added nodes).</li>
+ * <li>When a node is retraced, the traverser's {@link subtractNode()} is called.  Again, it is the
+ * traverser's responsibility to know which node has been retraced.  </li>
+ * </ol>
+ * To summarize, as the traversal goes down a tree path, nodes are added.  When the
+ * end of the path is reached, the {@link processPath()} call is sent.  As the traversal backs up,
+ * nodes are subtracted.
+ * <p>
+ * The traversal is a depth-first traversal. 
+ * @author Michael Stover (mstover1 at apache.org)
+ * @see HashTree
+ * @see SearchByClass
  */
 
-public class ArgumentsHandler extends TagHandler
+public interface HashTreeTraverser
 {
-	Arguments args;
-	String currentArgument;
-
-	public ArgumentsHandler()
-	{
-	}
-
-	public void save(Saveable parm1, Writer out) throws java.io.IOException
-	{
-		Arguments args = (Arguments)parm1;
-		out.write("<Arguments>\n");
-		Iterator iter = args.iterator();
-		while (iter.hasNext())
-		{
-			writeArgument((Argument)iter.next(),out);
-		}
-		out.write("</Arguments>\n");
-	}
-
-	private void writeArgument(Argument arg,Writer out) throws IOException
-	{
-		out.write("<argument name=\"");
-		out.write(JMeterHandler.convertToXML(arg.getName()));
-		out.write("\">");
-		try
-		{
-			out.write(JMeterHandler.convertToXML(" "+arg.getValue().toString()));
-		}
-		catch (Exception ex)
-		{
-
-		}
-		out.write("</argument>\n");
-	}
-
-	public void setAtts(Attributes atts) throws java.lang.Exception
-	{
-		args = new Arguments();
-		args.setProperty(TestElement.GUI_CLASS,"org.apache.jmeter.config.gui.ArgumentsPanel");
-	}
-
-	public String getPrimaryTagName()
-	{
-		return "Arguments";
-	}
 
-	public void argument(Attributes atts)
-	{
-		currentArgument = atts.getValue("name");
-	}
+	/**
+	 * The tree traverses itself depth-first, calling addNode for each object
+	 * it encounters as it goes.  This is a callback method, and should not be called except
+	 * by a HashTree during traversal.
+	 * 
+	 * @param node The node currently encountered
+	 * @param subTree The HashTree under the node encountered.
+	 */
+	public void addNode(Object node,HashTree subTree);
 
-	public void argument(String data)
-	{
-		if(data != null)
-		{
-			data = data.trim();
-		}
-		args.addArgument(currentArgument,data);
-		currentArgument = null;
-	}
+	/**
+	 * Indicates traversal has moved up a step, and the visitor should remove the
+	 * top node from it's stack structure.  This is a callback method, and should not be called except
+	 * by a HashTree during traversal.
+	 */
+	public void subtractNode();
 
-	public Object getModel()
-	{
-		return args;
-	}
+	/**
+	 * Process path is called when a leaf is reached.  If a visitor wishes to generate
+	 * Lists of path elements to each leaf, it should keep a Stack data structure of
+	 * nodes passed to it with addNode, and removing top items for every subtractNode()
+	 * call.  This is a callback method, and should not be called except
+	 * by a HashTree during traversal.
+	 */
+	public void processPath();
 }
\ No newline at end of file
diff --git a/jakarta-jmeter/src/jorphan/org/apache/jorphan/collections/ListedHashTree.java b/jakarta-jmeter/src/jorphan/org/apache/jorphan/collections/ListedHashTree.java
new file mode 100644
index 0000000..b13759c
--- /dev/null
+++ b/jakarta-jmeter/src/jorphan/org/apache/jorphan/collections/ListedHashTree.java
@@ -0,0 +1,299 @@
+/*
+ * ====================================================================
+ * The Apache Software License, Version 1.1
+ *
+ * Copyright (c) 2001 The Apache Software Foundation.  All rights
+ * reserved.
+ *
+ * Redistribution and use in source and binary forms, with or without
+ * modification, are permitted provided that the following conditions
+ * are met:
+ *
+ * 1. Redistributions of source code must retain the above copyright
+ * notice, this list of conditions and the following disclaimer.
+ *
+ * 2. Redistributions in binary form must reproduce the above copyright
+ * notice, this list of conditions and the following disclaimer in
+ * the documentation and/or other materials provided with the
+ * distribution.
+ *
+ * 3. The end-user documentation included with the redistribution,
+ * if any, must include the following acknowledgment:
+ * "This product includes software developed by the
+ * Apache Software Foundation (http://www.apache.org/)."
+ * Alternately, this acknowledgment may appear in the software itself,
+ * if and wherever such third-party acknowledgments normally appear.
+ *
+ * 4. The names "Apache" and "Apache Software Foundation" and
+ * "Apache JMeter" must not be used to endorse or promote products
+ * derived from this software without prior written permission. For
+ * written permission, please contact apache@apache.org.
+ *
+ * 5. Products derived from this software may not be called "Apache",
+ * "Apache JMeter", nor may "Apache" appear in their name, without
+ * prior written permission of the Apache Software Foundation.
+ *
+ * THIS SOFTWARE IS PROVIDED ``AS IS'' AND ANY EXPRESSED OR IMPLIED
+ * WARRANTIES, INCLUDING, BUT NOT LIMITED TO, THE IMPLIED WARRANTIES
+ * OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE ARE
+ * DISCLAIMED.  IN NO EVENT SHALL THE APACHE SOFTWARE FOUNDATION OR
+ * ITS CONTRIBUTORS BE LIABLE FOR ANY DIRECT, INDIRECT, INCIDENTAL,
+ * SPECIAL, EXEMPLARY, OR CONSEQUENTIAL DAMAGES (INCLUDING, BUT NOT
+ * LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES; LOSS OF
+ * USE, DATA, OR PROFITS; OR BUSINESS INTERRUPTION) HOWEVER CAUSED AND
+ * ON ANY THEORY OF LIABILITY, WHETHER IN CONTRACT, STRICT LIABILITY,
+ * OR TORT (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT
+ * OF THE USE OF THIS SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF
+ * SUCH DAMAGE.
+ * ====================================================================
+ *
+ * This software consists of voluntary contributions made by many
+ * individuals on behalf of the Apache Software Foundation.  For more
+ * information on the Apache Software Foundation, please see
+ * <http://www.apache.org/>.
+ */
+ 
+package org.apache.jorphan.collections;
+import java.io.*;
+import java.util.*;
+
+/****************************************
+ * ListedHashTree is a different implementation of the {@link HashTree} collection class. 
+ * In the ListedHashTree,
+ * the order in which values are added is preserved (not to be confused with
+ * {@link SortedHashTree}, which sorts the order of the values using the compare()
+ * function).  Any listing of nodes or iteration through the list of nodes of a
+ * ListedHashTree will be given in the order in which the nodes were added to the
+ * tree.
+ *
+ *@author    mstover1 at apache.org
+ * @see HashTree
+ ***************************************/
+public class ListedHashTree extends HashTree implements Serializable,Cloneable
+{
+
+	private List order;
+
+	public ListedHashTree()
+	{
+		data = new HashMap();
+		order = new LinkedList();
+	}
+	
+	public Object clone()
+	{
+		ListedHashTree newTree = new ListedHashTree();
+		newTree.data = (Map)((HashMap)data).clone();
+		newTree.order = (List)((LinkedList)order).clone();
+		return newTree;
+	}
+
+	public ListedHashTree(Object key)
+	{
+		data = new HashMap();
+		order = new LinkedList();
+		data.put(key, new ListedHashTree());
+		order.add(key);
+	}
+
+	public ListedHashTree(Collection keys)
+	{
+		data = new HashMap();
+		order = new LinkedList();
+		Iterator it = keys.iterator();
+		while(it.hasNext())
+		{
+			Object temp = it.next();
+			data.put(temp, new ListedHashTree());
+			order.add(temp);
+		}
+	}
+
+	public ListedHashTree(Object[] keys)
+	{
+		data = new HashMap();
+		order = new LinkedList();
+		for(int x = 0; x < keys.length; x++)
+		{
+			data.put(keys[x], new ListedHashTree());
+			order.add(keys[x]);
+		}
+	}
+
+	public void set(Object key, Object value)
+	{
+		if(!data.containsKey(key))
+		{
+			order.add(key);
+		}
+		super.set(key,value);
+	}
+
+	public void set(Object key, HashTree t)
+	{
+		if(!data.containsKey(key))
+		{
+			order.add(key);
+		}
+		super.set(key,t);
+	}
+
+	public void set(Object key, Object[] values)
+	{		
+		if(!data.containsKey(key))
+		{
+			order.add(key);
+		}
+		super.set(key,values);
+	}
+
+	public void set(Object key, Collection values)
+	{
+		if(!data.containsKey(key))
+		{
+			order.add(key);
+		}
+		super.set(key,values);
+	}
+
+	public void replace(Object currentKey, Object newKey)
+	{
+		HashTree tree = getTree(currentKey);
+		data.remove(currentKey);
+		data.put(newKey, tree);
+		order.set(order.indexOf(currentKey), newKey);
+	}
+	
+	public HashTree createNewTree()
+	{
+		return new ListedHashTree();
+	}
+	
+	public HashTree createNewTree(Object key)
+	{
+		return new ListedHashTree(key);
+	}
+	
+	public HashTree createNewTree(Collection values)
+	{
+		return new ListedHashTree(values);
+	}
+
+	public void add(Object key)
+	{
+		if(!data.containsKey(key))
+		{
+			data.put(key, createNewTree());
+			order.add(key);
+		}
+	}
+
+	public Collection list()
+	{
+		return order;
+	}
+
+	public Object remove(Object key)
+	{
+		order.remove(key);
+		return data.remove(key);
+	}
+
+	public Object[] getArray()
+	{
+		return order.toArray();
+	}
+
+	public int hashCode()
+	{
+		return data.hashCode() * 7 + 3;
+	}
+
+	public boolean equals(Object o)
+	{
+		boolean flag = true;
+		if(o instanceof ListedHashTree)
+		{
+			ListedHashTree oo = (ListedHashTree)o;
+			Iterator it = order.iterator();
+			Iterator it2 = oo.order.iterator();
+			if(size() != oo.size())
+			{
+				flag = false;
+			}
+			while(it.hasNext() && it2.hasNext() && flag)
+			{
+				if(!it.next().equals(it2.next()))
+				{
+					flag = false;
+				}
+			}
+			if(flag)
+			{
+				it = order.iterator();
+				while(it.hasNext() && flag)
+				{
+					Object temp = it.next();
+					flag = get(temp).equals(oo.get(temp));
+				}
+			}
+		}
+		else
+		{
+			flag = false;
+		}
+		return flag;
+	}
+
+	public Set keySet()
+	{
+		return data.keySet();
+	}
+
+	public int size()
+	{
+		return data.size();
+	}
+
+	void readObject(ObjectInputStream ois) throws ClassNotFoundException, IOException
+	{
+		ois.defaultReadObject();
+	}
+
+	void writeObject(ObjectOutputStream oos) throws IOException
+	{
+		oos.defaultWriteObject();
+	}
+
+	public static class Test extends junit.framework.TestCase
+	{
+		/****************************************
+		 * !ToDo (Constructor description)
+		 *
+		 *@param name  !ToDo (Parameter description)
+		 ***************************************/
+		public Test(String name)
+		{
+			super(name);
+		}
+
+		/****************************************
+		 * !ToDo
+		 *
+		 *@exception Exception  !ToDo (Exception description)
+		 ***************************************/
+		public void testAddObjectAndTree() throws Exception
+		{
+			ListedHashTree tree = new ListedHashTree("key");
+			ListedHashTree newTree = new ListedHashTree("value");
+			tree.add("key", newTree);
+			assertEquals(tree.list().size(), 1);
+			assertEquals("key",tree.getArray()[0]);
+			assertEquals(1,tree.getTree("key").list().size());
+			assertEquals(0,tree.getTree("key").getTree("value").size());
+			assertEquals(tree.getTree("key").getArray()[0], "value");
+			this.assertNotNull(tree.getTree("key").get("value"));
+		}
+	}
+
+}
diff --git a/jakarta-jmeter/src/jorphan/org/apache/jorphan/collections/SearchByClass.java b/jakarta-jmeter/src/jorphan/org/apache/jorphan/collections/SearchByClass.java
new file mode 100644
index 0000000..8f61b6e
--- /dev/null
+++ b/jakarta-jmeter/src/jorphan/org/apache/jorphan/collections/SearchByClass.java
@@ -0,0 +1,143 @@
+/*
+ * ====================================================================
+ * The Apache Software License, Version 1.1
+ *
+ * Copyright (c) 2001 The Apache Software Foundation.  All rights
+ * reserved.
+ *
+ * Redistribution and use in source and binary forms, with or without
+ * modification, are permitted provided that the following conditions
+ * are met:
+ *
+ * 1. Redistributions of source code must retain the above copyright
+ * notice, this list of conditions and the following disclaimer.
+ *
+ * 2. Redistributions in binary form must reproduce the above copyright
+ * notice, this list of conditions and the following disclaimer in
+ * the documentation and/or other materials provided with the
+ * distribution.
+ *
+ * 3. The end-user documentation included with the redistribution,
+ * if any, must include the following acknowledgment:
+ * "This product includes software developed by the
+ * Apache Software Foundation (http://www.apache.org/)."
+ * Alternately, this acknowledgment may appear in the software itself,
+ * if and wherever such third-party acknowledgments normally appear.
+ *
+ * 4. The names "Apache" and "Apache Software Foundation" and
+ * "Apache JMeter" must not be used to endorse or promote products
+ * derived from this software without prior written permission. For
+ * written permission, please contact apache@apache.org.
+ *
+ * 5. Products derived from this software may not be called "Apache",
+ * "Apache JMeter", nor may "Apache" appear in their name, without
+ * prior written permission of the Apache Software Foundation.
+ *
+ * THIS SOFTWARE IS PROVIDED ``AS IS'' AND ANY EXPRESSED OR IMPLIED
+ * WARRANTIES, INCLUDING, BUT NOT LIMITED TO, THE IMPLIED WARRANTIES
+ * OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE ARE
+ * DISCLAIMED.  IN NO EVENT SHALL THE APACHE SOFTWARE FOUNDATION OR
+ * ITS CONTRIBUTORS BE LIABLE FOR ANY DIRECT, INDIRECT, INCIDENTAL,
+ * SPECIAL, EXEMPLARY, OR CONSEQUENTIAL DAMAGES (INCLUDING, BUT NOT
+ * LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES; LOSS OF
+ * USE, DATA, OR PROFITS; OR BUSINESS INTERRUPTION) HOWEVER CAUSED AND
+ * ON ANY THEORY OF LIABILITY, WHETHER IN CONTRACT, STRICT LIABILITY,
+ * OR TORT (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT
+ * OF THE USE OF THIS SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF
+ * SUCH DAMAGE.
+ * ====================================================================
+ *
+ * This software consists of voluntary contributions made by many
+ * individuals on behalf of the Apache Software Foundation.  For more
+ * information on the Apache Software Foundation, please see
+ * <http://www.apache.org/>.
+ */
+ 
+
+package org.apache.jorphan.collections;
+import java.util.*;
+/**
+ * Useful for finding all nodes in the tree that represent objects of a particular
+ * type.  For instance, if your tree contains all strings, and a few StringBuffer objects, 
+ * you can use the SearchByClass traverser to find all the StringBuffer objects in your
+ * tree.  
+ * <p>
+ * Usage is simple.  Given a {@link HashTree} object "tree", and a SearchByClass object:
+ * <p>
+ * <pre>
+ * 	HashTree tree = new HashTree();
+ * 	// ... tree gets filled with objects
+ * 	SearchByClass searcher = new SearchByClass(StringBuffer.class);
+ * 	tree.traverse(searcher);
+ * 	Iterator iter = searcher.getSearchResults().iterator();
+ * 	while(iter.hasNext())
+ * 	{
+ * 		StringBuffer foundNode = (StringBuffer)iter.next();
+ * 		HashTree subTreeOfFoundNode = searcher.getSubTree(foundNode);
+ * 		//  .... do something with node and subTree...
+ * 	}
+ * </pre>
+ * @author Michael Stover (mstover1 at apache.org)
+ * @see HashTree
+ * @see HashTreeTraverser
+ */
+public class SearchByClass implements HashTreeTraverser {
+	List objectsOfClass = new LinkedList();
+	Map subTrees = new HashMap();
+	Class searchClass = null;
+	/**
+	 * Creates an instance of SearchByClass.  However, without setting the Class to search
+	 * for, it will be a useless object.
+	 * @see java.lang.Object#Object()
+	 */
+	public SearchByClass() {}
+	/**
+	 * Creates an instance of SearchByClass, and sets the Class to be searched for.
+	 * @param searchClass
+	 */
+	public SearchByClass(Class searchClass) {
+		this.searchClass = searchClass;
+	}
+	/**
+	 * After traversing the HashTree, call this method to get a collection of the
+	 * nodes that were found.
+	 * @return Collection  All found nodes of the requested type
+	 */
+	public Collection getSearchResults() {
+		return objectsOfClass;
+	}
+	/**
+	 * Given a specific found node, this method will return the sub tree of that node.
+	 * @param root The node for which the sub tree is requested.
+	 * @return HashTree
+	 */
+	public HashTree getSubTree(Object root) {
+		return (HashTree)subTrees.get(root);
+	}
+	public void addNode(Object node, HashTree subTree) {
+		if (searchClass.isAssignableFrom(node.getClass())) {
+			objectsOfClass.add(node);
+			ListedHashTree tree = new ListedHashTree(node);
+			tree.set(node, subTree);
+			subTrees.put(node, tree);
+		}
+	}
+	public static class Test extends junit.framework.TestCase {
+		public Test(String name) {
+			super(name);
+		}
+		public void testSearch() throws Exception {
+			ListedHashTree tree = new ListedHashTree();
+			SearchByClass searcher = new SearchByClass(Integer.class);
+			String one = "one";
+			String two = "two";
+			Integer o = new Integer(1);
+			tree.add(one, o);
+			tree.getTree(one).add(o, two);
+			tree.traverse(searcher);
+			assertEquals(1, searcher.getSearchResults().size());
+		}
+	}
+	public void subtractNode() {}
+	public void processPath() {}
+}
\ No newline at end of file
diff --git a/jakarta-jmeter/src/core/org/apache/jmeter/save/old/handlers/HeaderManagerHandler.java b/jakarta-jmeter/src/jorphan/org/apache/jorphan/collections/SortedHashTree.java
similarity index 59%
rename from jakarta-jmeter/src/core/org/apache/jmeter/save/old/handlers/HeaderManagerHandler.java
rename to jakarta-jmeter/src/jorphan/org/apache/jorphan/collections/SortedHashTree.java
index 8e1f950..d9125d8 100644
--- a/jakarta-jmeter/src/core/org/apache/jmeter/save/old/handlers/HeaderManagerHandler.java
+++ b/jakarta-jmeter/src/jorphan/org/apache/jorphan/collections/SortedHashTree.java
@@ -52,75 +52,81 @@
  * information on the Apache Software Foundation, please see
  * <http://www.apache.org/>.
  */
+ 
 
-package org.apache.jmeter.save.old.handlers;
+package org.apache.jorphan.collections;
 
-import java.io.Writer;
+import java.io.Serializable;
+import java.util.Collection;
+import java.util.HashMap;
 import java.util.Iterator;
-import java.util.List;
+import java.util.Map;
+import java.util.TreeMap;
 
-import org.apache.jmeter.protocol.http.control.Header;
-import org.apache.jmeter.protocol.http.control.HeaderManager;
-import org.apache.jmeter.save.old.Saveable;
-import org.apache.jmeter.save.old.xml.TagHandler;
-import org.apache.jmeter.testelement.TestElement;
-import org.xml.sax.Attributes;
+import org.apache.log.Logger;
 
-/**
- * Title:
- * Description:
- * Copyright:    Copyright (c) 2001
- * Company:
- * @author Giacomo Pati
- * @version 1.0
- */
+import org.apache.jorphan.logging.LoggingManager;
 
-public class HeaderManagerHandler extends TagHandler
+/**********************************************************************
+ * SortedHashTree is a different implementation of the {@link HashTree} collection class. 
+ * In the ListedHashTree,
+ * The ordering of values in the tree is made explicit via the compare() function of objects
+ * added to the tree.  This works in exactly the same fashion as it does for a SortedSet.
+ *
+ *@author    mstover1 at apache.org
+ * @see HashTree
+ * @see HashTreeTraverser
+***********************************************************************/
+public class SortedHashTree extends HashTree implements Serializable
 {
+	
+	private static Logger log = LoggingManager.getLoggerFor("jorphan.collections");
 
-	private HeaderManager headerManager;
-
-	public HeaderManagerHandler()
-	{
-	}
+  public SortedHashTree()
+  {
+	 data = new TreeMap();
+  }
 
-	public void save(Saveable cm, Writer out) throws java.io.IOException
-	{
-		HeaderManager headers = (HeaderManager)cm;
-		out.write("<HeaderManager name=\"");
-		out.write(JMeterHandler.convertToXML(headers.getName()));
-		out.write("\">\n");
-		JMeterHandler.writeObjects(headers.getHeaders(),out);
-		out.write("</HeaderManager>\n");
-	}
+  public SortedHashTree(Object key)
+  {
+	 data = new TreeMap();
+	 data.put(key,new SortedHashTree());
+  }
 
-	public void setAtts(Attributes atts) throws java.lang.Exception
-	{
-		headerManager = new HeaderManager();
-		headerManager.setProperty(TestElement.GUI_CLASS,
-				"org.apache.jmeter.protocol.http.gui.HeaderPanel");
-		headerManager.setName(atts.getValue("name"));
-	}
+  public SortedHashTree(Collection keys)
+  {
+	 data = new TreeMap();
+	 Iterator it = keys.iterator();
+	 while(it.hasNext())
+		data.put(it.next(),new SortedHashTree());
+  }
 
-	public String getPrimaryTagName()
+  public SortedHashTree(Object[] keys)
+  {
+	 data = new TreeMap();
+	 for(int x = 0;x < keys.length;x++)
+		data.put(keys[x],new SortedHashTree());
+  }
+  
+  public HashTree createNewTree()
+  {
+  	return new SortedHashTree();
+  }
+  
+  public HashTree createNewTree(Object key)
 	{
-		return "HeaderManager";
+		return new SortedHashTree(key);
 	}
 
-	public void HeaderManagerTagEnd()
+	public HashTree createNewTree(Collection values)
 	{
-		List headers = xmlParent.takeChildObjects(this);
-		Iterator iter = headers.iterator();
-		while (iter.hasNext())
-		{
-			TestElement header = (TestElement)((TagHandler)iter.next()).getModel();
-			headerManager.add(new Header((String)header.getProperty(TestElement.NAME),
-					(String)header.getProperty("value")));
-		}
+		return new SortedHashTree(values);
 	}
-
-	public Object getModel()
+	
+	public Object clone()
 	{
-		return headerManager;
+		HashTree newTree = new SortedHashTree();
+		newTree.data = (Map)((HashMap)data).clone();
+		return newTree;
 	}
-}
\ No newline at end of file
+}
diff --git a/jakarta-jmeter/src/jorphan/org/apache/jorphan/gui/CVS/Entries b/jakarta-jmeter/src/jorphan/org/apache/jorphan/gui/CVS/Entries
new file mode 100644
index 0000000..47fd1cf
--- /dev/null
+++ b/jakarta-jmeter/src/jorphan/org/apache/jorphan/gui/CVS/Entries
@@ -0,0 +1,7 @@
+/ComponentUtil.java/1.1/Thu Oct 17 19:47:18 2002//Tv1_8_1
+/JLabeledChoice.java/1.1/Thu Oct 17 19:47:18 2002//Tv1_8_1
+/JLabeledField.java/1.1/Thu Oct 17 19:47:18 2002//Tv1_8_1
+/JLabeledPasswordField.java/1.1/Thu Oct 17 19:47:18 2002//Tv1_8_1
+/JLabeledTextArea.java/1.1/Thu Oct 17 19:47:18 2002//Tv1_8_1
+/JLabeledTextField.java/1.1/Thu Oct 17 19:47:18 2002//Tv1_8_1
+D/layout////
diff --git a/jakarta-jmeter/src/jorphan/org/apache/jorphan/gui/CVS/Repository b/jakarta-jmeter/src/jorphan/org/apache/jorphan/gui/CVS/Repository
new file mode 100644
index 0000000..a2d855c
--- /dev/null
+++ b/jakarta-jmeter/src/jorphan/org/apache/jorphan/gui/CVS/Repository
@@ -0,0 +1 @@
+jakarta-jmeter/src/jorphan/org/apache/jorphan/gui
diff --git a/jakarta-jmeter/src/jorphan/org/apache/jorphan/gui/CVS/Root b/jakarta-jmeter/src/jorphan/org/apache/jorphan/gui/CVS/Root
new file mode 100644
index 0000000..41188ef
--- /dev/null
+++ b/jakarta-jmeter/src/jorphan/org/apache/jorphan/gui/CVS/Root
@@ -0,0 +1 @@
+:pserver:anoncvs@cvs.apache.org:/home/cvspublic
diff --git a/jakarta-jmeter/src/jorphan/org/apache/jorphan/gui/CVS/Tag b/jakarta-jmeter/src/jorphan/org/apache/jorphan/gui/CVS/Tag
new file mode 100644
index 0000000..e2fda28
--- /dev/null
+++ b/jakarta-jmeter/src/jorphan/org/apache/jorphan/gui/CVS/Tag
@@ -0,0 +1 @@
+Nv1_8_1
diff --git a/jakarta-jmeter/src/core/org/apache/jmeter/gui/util/ComponentUtil.java b/jakarta-jmeter/src/jorphan/org/apache/jorphan/gui/ComponentUtil.java
similarity index 99%
rename from jakarta-jmeter/src/core/org/apache/jmeter/gui/util/ComponentUtil.java
rename to jakarta-jmeter/src/jorphan/org/apache/jorphan/gui/ComponentUtil.java
index ec2778d..71f5c9e 100644
--- a/jakarta-jmeter/src/core/org/apache/jmeter/gui/util/ComponentUtil.java
+++ b/jakarta-jmeter/src/jorphan/org/apache/jorphan/gui/ComponentUtil.java
@@ -51,7 +51,9 @@
  * individuals on behalf of the Apache Software Foundation.  For more
  * information on the Apache Software Foundation, please see
  * <http://www.apache.org/>.
- */package org.apache.jmeter.gui.util;
+ */
+ 
+package org.apache.jorphan.gui;
 
 /**
  * Title:        Apache JMeter
diff --git a/jakarta-jmeter/src/core/org/apache/jmeter/gui/util/JLabeledChoice.java b/jakarta-jmeter/src/jorphan/org/apache/jorphan/gui/JLabeledChoice.java
similarity index 99%
rename from jakarta-jmeter/src/core/org/apache/jmeter/gui/util/JLabeledChoice.java
rename to jakarta-jmeter/src/jorphan/org/apache/jorphan/gui/JLabeledChoice.java
index 2a5555b..5f2bf63 100644
--- a/jakarta-jmeter/src/core/org/apache/jmeter/gui/util/JLabeledChoice.java
+++ b/jakarta-jmeter/src/jorphan/org/apache/jorphan/gui/JLabeledChoice.java
@@ -52,7 +52,8 @@
  * information on the Apache Software Foundation, please see
  * <http://www.apache.org/>.
  */
-package org.apache.jmeter.gui.util;
+ 
+package org.apache.jorphan.gui;
 
 import java.util.*;
 import javax.swing.*;
diff --git a/jakarta-jmeter/src/core/org/apache/jmeter/gui/util/JLabeledField.java b/jakarta-jmeter/src/jorphan/org/apache/jorphan/gui/JLabeledField.java
similarity index 98%
rename from jakarta-jmeter/src/core/org/apache/jmeter/gui/util/JLabeledField.java
rename to jakarta-jmeter/src/jorphan/org/apache/jorphan/gui/JLabeledField.java
index 8124d78..5593521 100644
--- a/jakarta-jmeter/src/core/org/apache/jmeter/gui/util/JLabeledField.java
+++ b/jakarta-jmeter/src/jorphan/org/apache/jorphan/gui/JLabeledField.java
@@ -52,7 +52,8 @@
  * information on the Apache Software Foundation, please see
  * <http://www.apache.org/>.
  */
- package org.apache.jmeter.gui.util;
+ 
+ package org.apache.jorphan.gui;
 
 import javax.swing.event.*;
 import java.util.*;
diff --git a/jakarta-jmeter/src/core/org/apache/jmeter/gui/util/JLabeledPasswordField.java b/jakarta-jmeter/src/jorphan/org/apache/jorphan/gui/JLabeledPasswordField.java
similarity index 98%
rename from jakarta-jmeter/src/core/org/apache/jmeter/gui/util/JLabeledPasswordField.java
rename to jakarta-jmeter/src/jorphan/org/apache/jorphan/gui/JLabeledPasswordField.java
index 2b5fa08..5452313 100644
--- a/jakarta-jmeter/src/core/org/apache/jmeter/gui/util/JLabeledPasswordField.java
+++ b/jakarta-jmeter/src/jorphan/org/apache/jorphan/gui/JLabeledPasswordField.java
@@ -52,7 +52,8 @@
  * information on the Apache Software Foundation, please see
  * <http://www.apache.org/>.
  */
- package org.apache.jmeter.gui.util;
+ 
+ package org.apache.jorphan.gui;
 
 import javax.swing.JPasswordField;
 
diff --git a/jakarta-jmeter/src/core/org/apache/jmeter/gui/util/JLabeledTextArea.java b/jakarta-jmeter/src/jorphan/org/apache/jorphan/gui/JLabeledTextArea.java
similarity index 99%
rename from jakarta-jmeter/src/core/org/apache/jmeter/gui/util/JLabeledTextArea.java
rename to jakarta-jmeter/src/jorphan/org/apache/jorphan/gui/JLabeledTextArea.java
index 629dd74..0e2e9c7 100644
--- a/jakarta-jmeter/src/core/org/apache/jmeter/gui/util/JLabeledTextArea.java
+++ b/jakarta-jmeter/src/jorphan/org/apache/jorphan/gui/JLabeledTextArea.java
@@ -52,7 +52,8 @@
  * information on the Apache Software Foundation, please see
  * <http://www.apache.org/>.
  */
- package org.apache.jmeter.gui.util;
+ 
+ package org.apache.jorphan.gui;
 
 import javax.swing.*;
 import java.util.*;
diff --git a/jakarta-jmeter/src/core/org/apache/jmeter/gui/util/JLabeledTextField.java b/jakarta-jmeter/src/jorphan/org/apache/jorphan/gui/JLabeledTextField.java
similarity index 99%
rename from jakarta-jmeter/src/core/org/apache/jmeter/gui/util/JLabeledTextField.java
rename to jakarta-jmeter/src/jorphan/org/apache/jorphan/gui/JLabeledTextField.java
index 883e25f..62dea16 100644
--- a/jakarta-jmeter/src/core/org/apache/jmeter/gui/util/JLabeledTextField.java
+++ b/jakarta-jmeter/src/jorphan/org/apache/jorphan/gui/JLabeledTextField.java
@@ -52,7 +52,8 @@
  * information on the Apache Software Foundation, please see
  * <http://www.apache.org/>.
  */
-package org.apache.jmeter.gui.util;
+ 
+package org.apache.jorphan.gui;
 
 import javax.swing.*;
 import java.util.*;
diff --git a/jakarta-jmeter/src/jorphan/org/apache/jorphan/gui/layout/CVS/Entries b/jakarta-jmeter/src/jorphan/org/apache/jorphan/gui/layout/CVS/Entries
new file mode 100644
index 0000000..c43dce8
--- /dev/null
+++ b/jakarta-jmeter/src/jorphan/org/apache/jorphan/gui/layout/CVS/Entries
@@ -0,0 +1,2 @@
+/VerticalLayout.java/1.1/Thu Oct 17 19:47:18 2002//Tv1_8_1
+D
diff --git a/jakarta-jmeter/src/jorphan/org/apache/jorphan/gui/layout/CVS/Repository b/jakarta-jmeter/src/jorphan/org/apache/jorphan/gui/layout/CVS/Repository
new file mode 100644
index 0000000..339d85f
--- /dev/null
+++ b/jakarta-jmeter/src/jorphan/org/apache/jorphan/gui/layout/CVS/Repository
@@ -0,0 +1 @@
+jakarta-jmeter/src/jorphan/org/apache/jorphan/gui/layout
diff --git a/jakarta-jmeter/src/jorphan/org/apache/jorphan/gui/layout/CVS/Root b/jakarta-jmeter/src/jorphan/org/apache/jorphan/gui/layout/CVS/Root
new file mode 100644
index 0000000..41188ef
--- /dev/null
+++ b/jakarta-jmeter/src/jorphan/org/apache/jorphan/gui/layout/CVS/Root
@@ -0,0 +1 @@
+:pserver:anoncvs@cvs.apache.org:/home/cvspublic
diff --git a/jakarta-jmeter/src/jorphan/org/apache/jorphan/gui/layout/CVS/Tag b/jakarta-jmeter/src/jorphan/org/apache/jorphan/gui/layout/CVS/Tag
new file mode 100644
index 0000000..e2fda28
--- /dev/null
+++ b/jakarta-jmeter/src/jorphan/org/apache/jorphan/gui/layout/CVS/Tag
@@ -0,0 +1 @@
+Nv1_8_1
diff --git a/jakarta-jmeter/src/core/org/apache/jmeter/gui/util/VerticalLayout.java b/jakarta-jmeter/src/jorphan/org/apache/jorphan/gui/layout/VerticalLayout.java
similarity index 96%
rename from jakarta-jmeter/src/core/org/apache/jmeter/gui/util/VerticalLayout.java
rename to jakarta-jmeter/src/jorphan/org/apache/jorphan/gui/layout/VerticalLayout.java
index 502e11a..225ce6c 100644
--- a/jakarta-jmeter/src/core/org/apache/jmeter/gui/util/VerticalLayout.java
+++ b/jakarta-jmeter/src/jorphan/org/apache/jorphan/gui/layout/VerticalLayout.java
@@ -52,9 +52,15 @@
  * information on the Apache Software Foundation, please see
  * <http://www.apache.org/>.
  */
- package org.apache.jmeter.gui.util;
-import java.awt.*;
-import java.util.*;
+ 
+ package org.apache.jorphan.gui.layout;
+import java.awt.Component;
+import java.awt.Container;
+import java.awt.Dimension;
+import java.awt.Insets;
+import java.awt.LayoutManager;
+import java.io.Serializable;
+import java.util.Hashtable;
 /****************************************
  * A vertical layout manager similar to java.awt.FlowLayout. Like FlowLayout
  * components do not expand to fill available space except when the horizontal
@@ -67,11 +73,11 @@ import java.util.*;
  *@author    Colin Mummery e-mail:equitysoft@iname.com
  *      Homepage:www.kagi.com/equitysoft - Based on 'FlexLayout' in Java class
  *      libraries Vol 2 Chan/Lee Addison-Wesley 1998
- *@created   $Date: 2002/08/11 19:24:44 $
+ *@created   $Date: 2002/10/17 19:47:18 $
  *@version   $Revision: 1.1 $
  ***************************************/
 
-public class VerticalLayout implements LayoutManager
+public class VerticalLayout implements LayoutManager, Serializable
 {
 
 	/****************************************
diff --git a/jakarta-jmeter/src/jorphan/org/apache/jorphan/io/CVS/Entries b/jakarta-jmeter/src/jorphan/org/apache/jorphan/io/CVS/Entries
new file mode 100644
index 0000000..f37d6f2
--- /dev/null
+++ b/jakarta-jmeter/src/jorphan/org/apache/jorphan/io/CVS/Entries
@@ -0,0 +1,2 @@
+/TextFile.java/1.1/Thu Oct 17 19:47:18 2002//Tv1_8_1
+D
diff --git a/jakarta-jmeter/src/jorphan/org/apache/jorphan/io/CVS/Repository b/jakarta-jmeter/src/jorphan/org/apache/jorphan/io/CVS/Repository
new file mode 100644
index 0000000..c4f4677
--- /dev/null
+++ b/jakarta-jmeter/src/jorphan/org/apache/jorphan/io/CVS/Repository
@@ -0,0 +1 @@
+jakarta-jmeter/src/jorphan/org/apache/jorphan/io
diff --git a/jakarta-jmeter/src/jorphan/org/apache/jorphan/io/CVS/Root b/jakarta-jmeter/src/jorphan/org/apache/jorphan/io/CVS/Root
new file mode 100644
index 0000000..41188ef
--- /dev/null
+++ b/jakarta-jmeter/src/jorphan/org/apache/jorphan/io/CVS/Root
@@ -0,0 +1 @@
+:pserver:anoncvs@cvs.apache.org:/home/cvspublic
diff --git a/jakarta-jmeter/src/jorphan/org/apache/jorphan/io/CVS/Tag b/jakarta-jmeter/src/jorphan/org/apache/jorphan/io/CVS/Tag
new file mode 100644
index 0000000..e2fda28
--- /dev/null
+++ b/jakarta-jmeter/src/jorphan/org/apache/jorphan/io/CVS/Tag
@@ -0,0 +1 @@
+Nv1_8_1
diff --git a/jakarta-jmeter/src/core/org/apache/jmeter/save/old/handlers/TestPlanHandler.java b/jakarta-jmeter/src/jorphan/org/apache/jorphan/io/TextFile.java
similarity index 69%
rename from jakarta-jmeter/src/core/org/apache/jmeter/save/old/handlers/TestPlanHandler.java
rename to jakarta-jmeter/src/jorphan/org/apache/jorphan/io/TextFile.java
index 4e8b272..5d00a99 100644
--- a/jakarta-jmeter/src/core/org/apache/jmeter/save/old/handlers/TestPlanHandler.java
+++ b/jakarta-jmeter/src/jorphan/org/apache/jorphan/io/TextFile.java
@@ -52,51 +52,73 @@
  * information on the Apache Software Foundation, please see
  * <http://www.apache.org/>.
  */
-package org.apache.jmeter.save.old.handlers;
+ 
+package org.apache.jorphan.io;
 
+import java.io.BufferedReader;
+import java.io.File;
+import java.io.FileReader;
+import java.io.FileWriter;
+import java.io.IOException;
 import java.io.Writer;
 
-import org.apache.jmeter.save.old.Saveable;
-import org.apache.jmeter.save.old.xml.TagHandler;
-import org.apache.jmeter.testelement.TestPlan;
-import org.xml.sax.Attributes;
+import org.apache.log.Logger;
+
+import org.apache.jorphan.logging.LoggingManager;
 
 /************************************************************
- *  Title: Description: Copyright: Copyright (c) 2001 Company:
+ *  !ToDo (Class description)
  *
- *@author     Michael Stover
- *@created    $Date: 2002/08/11 19:24:48 $
- *@version    1.0
+ *@author     Giles Cope (gilescope at users.sourceforge.net), Michael Stover (mstover1 at apache.org)
  ***********************************************************/
-
-public class TestPlanHandler extends TagHandler
+public class TextFile extends File
 {
-
+	
+	transient private static Logger log = LoggingManager.getLoggerFor(
+			"jorphan.io");
 	/************************************************************
 	 *  !ToDo (Constructor description)
+	 *
+	 *@param  filename  !ToDo (Parameter description)
 	 ***********************************************************/
-	public TestPlanHandler()
+	public TextFile(File filename)
+	{
+		super(filename.toString());
+	}	
+	
+	public TextFile()
 	{
+		super("");
 	}
 
 	/************************************************************
-	 *  !ToDo (Method description)
+	 *  !ToDo (Constructor description)
 	 *
-	 *@param  atts                     !ToDo (Parameter description)
-	 *@exception  java.lang.Exception  !ToDo (Exception description)
+	 *@param  filename  !ToDo (Parameter description)
 	 ***********************************************************/
-	public void setAtts(Attributes atts) throws java.lang.Exception
+	public TextFile(String filename)
 	{
+		super(filename);
 	}
 
 	/************************************************************
-	 *  !ToDoo (Method description)
+	 *  !ToDo (Method description)
 	 *
-	 *@return    !ToDo (Return description)
+	 *@param  body  !ToDo (Parameter description)
 	 ***********************************************************/
-	public String getPrimaryTagName()
+	public void setText(String body)
 	{
-		return "TestPlan";
+		try
+		{
+			Writer writer = new FileWriter(this);
+			writer.write(body);
+			writer.flush();
+			writer.close();
+		}
+		catch (IOException ioe)
+		{
+			log.error("",ioe);
+		}
 	}
 
 	/************************************************************
@@ -104,24 +126,27 @@ public class TestPlanHandler extends TagHandler
 	 *
 	 *@return    !ToDo (Return description)
 	 ***********************************************************/
-	public Object getModel()
-	{
-		return TestPlan.createTestPlan(null);
-	}
-
-	/************************************************************
-	 *  !ToDo (Method description)
-	 *
-	 *@param  s                        !ToDo (Parameter description)
-	 *@param  out                      !ToDo (Parameter description)
-	 *@exception  java.io.IOException  !ToDo (Exception description)
-	 ***********************************************************/
-	public void save(Saveable s, Writer out) throws java.io.IOException
+	public String getText()
 	{
-		/*out.write("<TestPlan>\n");
-		TestPlan save = (TestPlan)s;
-		JMeterHandler.writeThreadGroups(save.getThreadGroups(), out);
-		JMeterHandler.writeConfigElements(save.getConfigElements(), out);
-		out.write("</TestPlan>\n");*/
+		String lineEnd = System.getProperty("line.separator");
+		StringBuffer sb = new StringBuffer();
+		try
+		{
+			BufferedReader br = new BufferedReader(new FileReader(this));
+			String line = "NOTNULL";
+			while (line != null)
+			{
+				line = br.readLine();
+				if (line != null)
+				{
+					sb.append(line + lineEnd);
+				}
+			}
+		}
+		catch (IOException ioe)
+		{
+			log.error("",ioe);
+		}
+		return sb.toString();
 	}
 }
diff --git a/jakarta-jmeter/src/jorphan/org/apache/jorphan/logging/CVS/Entries b/jakarta-jmeter/src/jorphan/org/apache/jorphan/logging/CVS/Entries
new file mode 100644
index 0000000..74d984d
--- /dev/null
+++ b/jakarta-jmeter/src/jorphan/org/apache/jorphan/logging/CVS/Entries
@@ -0,0 +1,2 @@
+/LoggingManager.java/1.1/Thu Oct 17 19:47:18 2002//Tv1_8_1
+D
diff --git a/jakarta-jmeter/src/jorphan/org/apache/jorphan/logging/CVS/Repository b/jakarta-jmeter/src/jorphan/org/apache/jorphan/logging/CVS/Repository
new file mode 100644
index 0000000..020c924
--- /dev/null
+++ b/jakarta-jmeter/src/jorphan/org/apache/jorphan/logging/CVS/Repository
@@ -0,0 +1 @@
+jakarta-jmeter/src/jorphan/org/apache/jorphan/logging
diff --git a/jakarta-jmeter/src/jorphan/org/apache/jorphan/logging/CVS/Root b/jakarta-jmeter/src/jorphan/org/apache/jorphan/logging/CVS/Root
new file mode 100644
index 0000000..41188ef
--- /dev/null
+++ b/jakarta-jmeter/src/jorphan/org/apache/jorphan/logging/CVS/Root
@@ -0,0 +1 @@
+:pserver:anoncvs@cvs.apache.org:/home/cvspublic
diff --git a/jakarta-jmeter/src/jorphan/org/apache/jorphan/logging/CVS/Tag b/jakarta-jmeter/src/jorphan/org/apache/jorphan/logging/CVS/Tag
new file mode 100644
index 0000000..e2fda28
--- /dev/null
+++ b/jakarta-jmeter/src/jorphan/org/apache/jorphan/logging/CVS/Tag
@@ -0,0 +1 @@
+Nv1_8_1
diff --git a/jakarta-jmeter/src/jorphan/org/apache/jorphan/logging/LoggingManager.java b/jakarta-jmeter/src/jorphan/org/apache/jorphan/logging/LoggingManager.java
new file mode 100644
index 0000000..0c8e983
--- /dev/null
+++ b/jakarta-jmeter/src/jorphan/org/apache/jorphan/logging/LoggingManager.java
@@ -0,0 +1,174 @@
+/*
+ * ====================================================================
+ * The Apache Software License, Version 1.1
+ *
+ * Copyright (c) 2001 The Apache Software Foundation.  All rights
+ * reserved.
+ *
+ * Redistribution and use in source and binary forms, with or without
+ * modification, are permitted provided that the following conditions
+ * are met:
+ *
+ * 1. Redistributions of source code must retain the above copyright
+ * notice, this list of conditions and the following disclaimer.
+ *
+ * 2. Redistributions in binary form must reproduce the above copyright
+ * notice, this list of conditions and the following disclaimer in
+ * the documentation and/or other materials provided with the
+ * distribution.
+ *
+ * 3. The end-user documentation included with the redistribution,
+ * if any, must include the following acknowledgment:
+ * "This product includes software developed by the
+ * Apache Software Foundation (http://www.apache.org/)."
+ * Alternately, this acknowledgment may appear in the software itself,
+ * if and wherever such third-party acknowledgments normally appear.
+ *
+ * 4. The names "Apache" and "Apache Software Foundation" and
+ * "Apache JMeter" must not be used to endorse or promote products
+ * derived from this software without prior written permission. For
+ * written permission, please contact apache@apache.org.
+ *
+ * 5. Products derived from this software may not be called "Apache",
+ * "Apache JMeter", nor may "Apache" appear in their name, without
+ * prior written permission of the Apache Software Foundation.
+ *
+ * THIS SOFTWARE IS PROVIDED ``AS IS'' AND ANY EXPRESSED OR IMPLIED
+ * WARRANTIES, INCLUDING, BUT NOT LIMITED TO, THE IMPLIED WARRANTIES
+ * OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE ARE
+ * DISCLAIMED.  IN NO EVENT SHALL THE APACHE SOFTWARE FOUNDATION OR
+ * ITS CONTRIBUTORS BE LIABLE FOR ANY DIRECT, INDIRECT, INCIDENTAL,
+ * SPECIAL, EXEMPLARY, OR CONSEQUENTIAL DAMAGES (INCLUDING, BUT NOT
+ * LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES; LOSS OF
+ * USE, DATA, OR PROFITS; OR BUSINESS INTERRUPTION) HOWEVER CAUSED AND
+ * ON ANY THEORY OF LIABILITY, WHETHER IN CONTRACT, STRICT LIABILITY,
+ * OR TORT (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT
+ * OF THE USE OF THIS SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF
+ * SUCH DAMAGE.
+ * ====================================================================
+ *
+ * This software consists of voluntary contributions made by many
+ * individuals on behalf of the Apache Software Foundation.  For more
+ * information on the Apache Software Foundation, please see
+ * <http://www.apache.org/>.
+ */
+ 
+
+package org.apache.jorphan.logging;
+import java.io.FileWriter;
+import java.io.PrintWriter;
+import java.io.Writer;
+import java.util.HashMap;
+import java.util.Iterator;
+import java.util.Map;
+
+import org.apache.log.Hierarchy;
+import org.apache.log.LogTarget;
+import org.apache.log.Logger;
+import org.apache.log.Priority;
+import org.apache.log.format.PatternFormatter;
+import org.apache.log.output.NullOutputLogTarget;
+import org.apache.log.output.io.WriterTarget;
+/**
+ * @author Michael Stover (mstover1 at apache.org)
+ *
+ * To change this generated comment edit the template variable "typecomment":
+ * Window>Preferences>Java>Templates.
+ */
+public class LoggingManager
+{
+	private static PatternFormatter format =
+		new PatternFormatter("%{time:MM/dd/yyyy h:mm:ss a} %{priority} - %{category}: %{message} %{throwable}\n");
+	private static LogTarget target;
+	public final static String LOG_FILE = "log_file";
+	public final static String LOG_PRIORITY = "log_level";
+	private static LoggingManager logManager = null;
+	
+	static
+	{
+		Map initProps = new HashMap();
+		initProps.put("log_level.jorphan","ERROR");
+		initializeLogging(initProps);
+	}
+	
+	private LoggingManager()
+	{
+		target = new NullOutputLogTarget();
+	}
+	public static LoggingManager getLogManager()
+	{
+		return logManager;
+	}
+	public static void initializeLogging(Map properties)
+	{
+		if (logManager == null)
+		{
+			logManager = new LoggingManager();
+		}
+		setLoggingLevels(properties,(String)properties.get(LOG_FILE));
+	}
+	private static void setLoggingLevels(Map appProperties,String logFile)
+	{
+		WriterTarget tempTarget = null;
+		try
+		{
+			tempTarget = new WriterTarget(new FileWriter(logFile),format);
+		}
+		catch(Exception e){
+			target = new WriterTarget(new PrintWriter(System.out),format);
+		}
+		Iterator names = appProperties.keySet().iterator();
+		while (names.hasNext())
+		{
+			String prop = (String) names.next();
+			if (prop.startsWith(LOG_PRIORITY))
+			{
+				String name = prop.substring(LOG_PRIORITY.length() + 1);
+				logManager.setPriority(
+					Priority.getPriorityForName((String) appProperties.get(prop)),
+					name);
+				if(tempTarget != null)
+				{
+					logManager.setTarget(tempTarget,name);
+				}
+				else
+				{
+					logManager.setTarget(target,name);
+				}
+			}
+		}
+	}
+	public static Logger getLoggerFor(String category)
+	{
+		return Hierarchy.getDefaultHierarchy().getLoggerFor(category);
+	}
+	public void setPriority(Priority p, String category)
+	{
+		Hierarchy.getDefaultHierarchy().getLoggerFor(category).setPriority(p);
+	}
+	
+	public void setTarget(LogTarget target,String category)
+	{
+		Logger logger = getLoggerFor(category);
+		logger.setLogTargets(new LogTarget[]{target});
+	}
+	public void setTarget(Writer targetFile)
+	{
+		if (target == null)
+		{
+			target = new WriterTarget(targetFile, format);
+			Hierarchy.getDefaultHierarchy().setDefaultLogTarget(
+				new WriterTarget(targetFile, format));
+		}
+		else
+		{
+			if(target instanceof WriterTarget)
+			{
+				((WriterTarget)target).close();
+			}
+			target = new WriterTarget(targetFile, format);
+			Hierarchy.getDefaultHierarchy().setDefaultLogTarget(
+				new WriterTarget(targetFile, format));
+		}
+	}
+}
diff --git a/jakarta-jmeter/src/jorphan/org/apache/jorphan/reflect/CVS/Entries b/jakarta-jmeter/src/jorphan/org/apache/jorphan/reflect/CVS/Entries
new file mode 100644
index 0000000..9e5c669
--- /dev/null
+++ b/jakarta-jmeter/src/jorphan/org/apache/jorphan/reflect/CVS/Entries
@@ -0,0 +1,2 @@
+/ClassFinder.java/1.2/Thu Oct 17 20:05:38 2002//Tv1_8_1
+D
diff --git a/jakarta-jmeter/src/jorphan/org/apache/jorphan/reflect/CVS/Repository b/jakarta-jmeter/src/jorphan/org/apache/jorphan/reflect/CVS/Repository
new file mode 100644
index 0000000..554f0a0
--- /dev/null
+++ b/jakarta-jmeter/src/jorphan/org/apache/jorphan/reflect/CVS/Repository
@@ -0,0 +1 @@
+jakarta-jmeter/src/jorphan/org/apache/jorphan/reflect
diff --git a/jakarta-jmeter/src/jorphan/org/apache/jorphan/reflect/CVS/Root b/jakarta-jmeter/src/jorphan/org/apache/jorphan/reflect/CVS/Root
new file mode 100644
index 0000000..41188ef
--- /dev/null
+++ b/jakarta-jmeter/src/jorphan/org/apache/jorphan/reflect/CVS/Root
@@ -0,0 +1 @@
+:pserver:anoncvs@cvs.apache.org:/home/cvspublic
diff --git a/jakarta-jmeter/src/jorphan/org/apache/jorphan/reflect/CVS/Tag b/jakarta-jmeter/src/jorphan/org/apache/jorphan/reflect/CVS/Tag
new file mode 100644
index 0000000..e2fda28
--- /dev/null
+++ b/jakarta-jmeter/src/jorphan/org/apache/jorphan/reflect/CVS/Tag
@@ -0,0 +1 @@
+Nv1_8_1
diff --git a/jakarta-jmeter/src/core/org/apache/jmeter/util/ClassFinder.java b/jakarta-jmeter/src/jorphan/org/apache/jorphan/reflect/ClassFinder.java
similarity index 51%
rename from jakarta-jmeter/src/core/org/apache/jmeter/util/ClassFinder.java
rename to jakarta-jmeter/src/jorphan/org/apache/jorphan/reflect/ClassFinder.java
index 0da9650..2c882f9 100644
--- a/jakarta-jmeter/src/core/org/apache/jmeter/util/ClassFinder.java
+++ b/jakarta-jmeter/src/jorphan/org/apache/jorphan/reflect/ClassFinder.java
@@ -52,13 +52,13 @@
  * information on the Apache Software Foundation, please see
  * <http://www.apache.org/>.
  */
-package org.apache.jmeter.util;
+ 
+package org.apache.jorphan.reflect;
 import java.io.File;
 import java.io.FilenameFilter;
 import java.io.IOException;
 import java.lang.reflect.Modifier;
 import java.util.ArrayList;
-import java.util.Arrays;
 import java.util.Enumeration;
 import java.util.HashMap;
 import java.util.HashSet;
@@ -70,32 +70,23 @@ import java.util.StringTokenizer;
 import java.util.zip.ZipEntry;
 import java.util.zip.ZipFile;
 
-import junit.framework.TestCase;
+import org.apache.log.Logger;
 
-import org.apache.log4j.Category;
+import org.apache.jorphan.logging.LoggingManager;
 /************************************************************
-
  *  This class finds classes that implement one or more specified interfaces.
-
- *  This allows us to implement a plugin-type search in jar files or
-
- *  directories.
-
+ *  
  *
-
- *@author     Burt Beckwith
-
- *@created    November 30, 2000
-
- *@version    1.0
-
- ***********************************************************/
-public class ClassFinder {
-	private static Category catClass =
-		Category.getInstance(ClassFinder.class.getName());
-	private ClassFinder() {}
+ *@author     Burt Beckwith, Michael Stover (mstover1 at apache.org)
+ ******************************************/
+public class ClassFinder
+{
+	transient private static Logger log =
+		LoggingManager.getLoggerFor("jorphan.reflect");
+	private ClassFinder()
+	{
+	}
 	// static only
-	
 	/************************************************************	
 	 *  Convenience method for <code>findClassesThatExtend(Class[], boolean)</code>	
 	 *  with the option to include inner classes in the search set to false	
@@ -105,11 +96,13 @@ public class ClassFinder {
 	 *@exception  IOException	
 	 *@exception  ClassNotFoundException	
 	 ***********************************************************/
-	public static List findClassesThatExtend(Class[] superClasses)
-		throws IOException, ClassNotFoundException {
-		return findClassesThatExtend(superClasses, false);
+	public static List findClassesThatExtend(
+		String[] paths,
+		Class[] superClasses)
+		throws IOException, ClassNotFoundException
+	{
+		return findClassesThatExtend(paths, superClasses, false);
 	}
-	
 	/************************************************************	
 	 *  Find classes in the provided path(s)/jar(s) that extend the class(es).	
 	 *	
@@ -120,22 +113,30 @@ public class ClassFinder {
 	 *@exception  IOException
 	 *@exception  ClassNotFoundException	
 	 ***********************************************************/
-	private static String[] addJarsInPath(String[] paths) {
+	private static String[] addJarsInPath(String[] paths)
+	{
 		Set fullList = new HashSet();
-		for (int i = 0; i < paths.length; i++) {
+		for (int i = 0; i < paths.length; i++)
+		{
 			fullList.add(paths[i]);
-			if (!paths[i].endsWith(".jar")) {
+			if (!paths[i].endsWith(".jar"))
+			{
 				File dir = new File(paths[i]);
-				if (dir.exists() && dir.isDirectory()) {
-					String[] jars = dir.list(new FilenameFilter() {
-						public boolean accept(File f, String name) {
-							if (name.endsWith(".jar")) {
+				if (dir.exists() && dir.isDirectory())
+				{
+					String[] jars = dir.list(new FilenameFilter()
+					{
+						public boolean accept(File f, String name)
+						{
+							if (name.endsWith(".jar"))
+							{
 								return true;
 							}
 							return false;
 						}
 					});
-					for (int x = 0; x < jars.length; x++) {
+					for (int x = 0; x < jars.length; x++)
+					{
 						fullList.add(jars[x]);
 					}
 				}
@@ -143,191 +144,93 @@ public class ClassFinder {
 		}
 		return (String[]) fullList.toArray(new String[0]);
 	}
-	
 	public static List findClassesThatExtend(
+		String[] strPathsOrJars,
 		Class[] superClasses,
 		boolean innerClasses)
-		throws IOException, ClassNotFoundException 
+		throws IOException, ClassNotFoundException
 	{
 		List listPaths = null;
 		ArrayList listClasses = null;
 		List listSuperClasses = null;
-		String[] strPathsOrJars =
-			JMeterUtils.split(
-				JMeterUtils.getPropDefault("search_paths", "lib/ext"),
-				";");
-		// paths are relative to jmDir - convert to absolutec
-		for (int i = 0; i < strPathsOrJars.length; i++) {
-			File file = new File(strPathsOrJars[i]);
-			if (!file.isAbsolute()) {
-				file = new File(JMeterUtils.getJMeterHome(),
-					strPathsOrJars[i]);
-				strPathsOrJars[i] = file.getPath();
-			}
-		}
 		strPathsOrJars = addJarsInPath(strPathsOrJars);
-		if (catClass.isDebugEnabled()) {
-			for (int k = 0; k < strPathsOrJars.length; k++) {
-				catClass.debug("strPathsOrJars : " + strPathsOrJars[k]);
+		if (log.isDebugEnabled())
+		{
+			for (int k = 0; k < strPathsOrJars.length; k++)
+			{
+				log.debug("strPathsOrJars : " + strPathsOrJars[k]);
 			}
 		}
 		listPaths = getClasspathMatches(strPathsOrJars);
-		if (catClass.isDebugEnabled()) {
+		if (log.isDebugEnabled())
+		{
 			Iterator tIter = listPaths.iterator();
-			for (; tIter.hasNext();) {
-				catClass.debug("listPaths : " + tIter.next());
+			for (; tIter.hasNext();)
+			{
+				log.debug("listPaths : " + tIter.next());
 			}
 		}
 		listClasses = new ArrayList();
 		listSuperClasses = new ArrayList();
-		for (int i = 0; i < superClasses.length; i++) {
+		for (int i = 0; i < superClasses.length; i++)
+		{
 			listSuperClasses.add(superClasses[i].getName());
 		}
 		// first get all the classes
 		findClassesInPaths(listPaths, listClasses);
-		if (catClass.isDebugEnabled()) {
+		if (log.isDebugEnabled())
+		{
 			Iterator tIter = listClasses.iterator();
-			for (; tIter.hasNext();) {
-				catClass.debug("listClasses : " + tIter.next());
+			for (; tIter.hasNext();)
+			{
+				log.debug("listClasses : " + tIter.next());
 			}
 		}
 		List subClassList =
 			findAllSubclasses(listSuperClasses, listClasses, innerClasses);
 		return subClassList;
 	}
-	/************************************************************
-	
-	 *  Convenience method to <code>findClassesByInterface(String[], Class[],
-	
-	 *  boolean)</code> with option to include inner classes in the search set to
-	
-	 *  false
-	
-	 *
-	
-	 *@param  interfaces                  Array of interfaces to search for.
-	
-	 *@param  strPathsOrJars              paths and jars to search
-	
-	 *@return                             ArrayList containing discovered classes.
-	
-	 *@exception  IOException
-	
-	 *@exception  ClassNotFoundException  !ToDo (Exception description)
-	
-	 ***********************************************************/
-	public static ArrayList findClassesByInterface(
-		String[] strPathsOrJars,
-		Class[] interfaces)
-		throws IOException, ClassNotFoundException {
-		return findClassesByInterface(strPathsOrJars, interfaces, false);
-	}
-	/************************************************************
-	
-	 *  Find classes in the provided path(s)/jar(s) that implement the
-	
-	 *  interface(s).
-	
-	 *
 	
-	 *@param  interfaces                  Array of interfaces to search for.
-	
-	 *@param  strPathsOrJars              paths and jars to search
-	
-	 *@param  innerClasses                Indicate whether the search includes
-	
-	 *      inner classes
-	
-	 *@return                             ArrayList containing discovered classes.
-	
-	 *@exception  IOException
-	
-	 *@exception  ClassNotFoundException
-	
-	 ***********************************************************/
-	public static ArrayList findClassesByInterface(
-		String[] strPathsOrJars,
-		Class[] interfaces,
-		boolean innerClasses)
-		throws IOException, ClassNotFoundException {
-		List listPaths = null;
-		ArrayList listClasses = null;
-		ArrayList listClassesWithInterface = null;
-		String strClassName = null;
-		Iterator iterClasses = null;
-		Class tempClass = null;
-		boolean foundIt;
-		int i;
-		listPaths = getClasspathMatches(strPathsOrJars);
-		listClasses = new ArrayList();
-		// first get all the classes
-		findClassesInPaths(listPaths, listClasses);
-		// then filter by the specified interfaces;
-		// if the array is null or empty, keep all classes
-		if (interfaces == null || interfaces.length == 0) {
-			listClassesWithInterface = listClasses;
-		} else {
-			// make a copy of the ArrayList, and remove all classes that
-			// don't implement one of the interefaces
-			listClassesWithInterface = (ArrayList) listClasses.clone();
-			iterClasses = listClasses.iterator();
-			while (iterClasses.hasNext()) {
-				strClassName = (String) iterClasses.next();
-				foundIt = false;
-				// only check classes if they are not inner classes
-				// or we intend to check for inner classes
-				if ((strClassName.indexOf("$") == -1) || innerClasses) {
-					// might throw an exception, assume this is ignorable
-					try {
-						tempClass = Class.forName(strClassName,true,Thread.currentThread().getContextClassLoader());
-						for (i = 0; i < interfaces.length; i++) {
-							if (classImplementsInterface(tempClass, interfaces[i])) {
-								foundIt = true;
-								break;
-							}
-						}
-					} catch (Throwable ignored) {}
-				}
-				if (!foundIt) {
-					listClassesWithInterface.remove(strClassName);
-				}
-			}
-		}
-		// listClassesWithInterface only contains classes that directly
-		// implement the interface(s);  to get all classes we need
-		// subclasses of these, too
-		return findAllSubclasses(listClassesWithInterface, listClasses, innerClasses);
-	}
-	private static List getClasspathMatches(String[] strPathsOrJars) {
+	private static List getClasspathMatches(String[] strPathsOrJars)
+	{
 		ArrayList listPaths = null;
 		StringTokenizer stPaths = null;
 		String strPath = null;
 		int i;
 		listPaths = new ArrayList();
+		log.debug("Classpath = "+System.getProperty("java.class.path"));
 		stPaths =
 			new StringTokenizer(
 				System.getProperty("java.class.path"),
 				System.getProperty("path.separator"));
-		if (strPathsOrJars != null) {
+		if (strPathsOrJars != null)
+		{
 			strPathsOrJars = fixDotDirs(strPathsOrJars);
 			strPathsOrJars = fixSlashes(strPathsOrJars);
 			strPathsOrJars = fixEndingSlashes(strPathsOrJars);
 		}
 		// find all jar files or paths that end with strPathOrJar
-		while (stPaths.hasMoreTokens()) {
+		while (stPaths.hasMoreTokens())
+		{
 			strPath = fixDotDir((String) stPaths.nextToken());
 			strPath = fixSlashes(strPath);
 			strPath = fixEndingSlashes(strPath);
-			if (strPathsOrJars == null) {
+			if (strPathsOrJars == null)
+			{
 				listPaths.add(strPath);
-			} else {
-				for (i = 0; i < strPathsOrJars.length; i++) {
-					if (catClass.isDebugEnabled()) {
-						catClass.debug("strPath(lower) : " + strPath.toLowerCase());
-						catClass.debug("strPathsOrJars[" + i + "] : " + strPathsOrJars[i]);
+			}
+			else
+			{
+				for (i = 0; i < strPathsOrJars.length; i++)
+				{
+					if (log.isDebugEnabled())
+					{
+						log.debug("strPath(lower) : " + strPath.toLowerCase());
+						log.debug("strPathsOrJars[" + i + "] : " + strPathsOrJars[i]);
 					}
-					if (strPath.endsWith(strPathsOrJars[i])) {
-						catClass.debug("match!!!");
+					if (strPath.endsWith(strPathsOrJars[i]))
+					{
+						log.debug("match!!!");
 						listPaths.add(strPath);
 					}
 				}
@@ -335,7 +238,6 @@ public class ClassFinder {
 		}
 		return listPaths;
 	}
-	
 	/************************************************************	
 	 *  Get all interfaces that the class implements, including parent interfaces.
 	 *  This keeps us from having to instantiate and check instanceof, which	
@@ -345,48 +247,63 @@ public class ClassFinder {
 	 *@param  theClass     the class to get interfaces for	
 	 *@param  hInterfaces  a Map to store the discovered interfaces in	
 	 ***********************************************************/
-	private static void getAllInterfaces(Class theClass, Map hInterfaces) {
+	private static void getAllInterfaces(Class theClass, Map hInterfaces)
+	{
 		Class[] interfaces = theClass.getInterfaces();
-		for (int i = 0; i < interfaces.length; i++) {
+		for (int i = 0; i < interfaces.length; i++)
+		{
 			hInterfaces.put(interfaces[i].getName(), interfaces[i]);
 			getAllInterfaces(interfaces[i], hInterfaces);
 		}
 	}
-	private static String[] fixDotDirs(String[] paths) {
-		for (int i = 0; i < paths.length; i++) {
+	private static String[] fixDotDirs(String[] paths)
+	{
+		for (int i = 0; i < paths.length; i++)
+		{
 			paths[i] = fixDotDir(paths[i]);
 		}
 		return paths;
 	}
-	private static String fixDotDir(String path) {
-		if (path != null && path.equals(".")) {
+	private static String fixDotDir(String path)
+	{
+		if (path != null && path.equals("."))
+		{
 			return System.getProperty("user.dir");
-		} else {
+		}
+		else
+		{
 			return path.trim();
 		}
 	}
-	private static String[] fixEndingSlashes(String[] strings) {
+	private static String[] fixEndingSlashes(String[] strings)
+	{
 		String[] strNew = new String[strings.length];
-		for (int i = 0; i < strings.length; i++) {
+		for (int i = 0; i < strings.length; i++)
+		{
 			strNew[i] = fixEndingSlashes(strings[i]);
 		}
 		return strNew;
 	}
-	private static String fixEndingSlashes(String string) {
-		if (string.endsWith("/") || string.endsWith("\\")) {
+	private static String fixEndingSlashes(String string)
+	{
+		if (string.endsWith("/") || string.endsWith("\\"))
+		{
 			string = string.substring(0, string.length() - 1);
 			string = fixEndingSlashes(string);
 		}
 		return string;
 	}
-	private static String[] fixSlashes(String[] strings) {
+	private static String[] fixSlashes(String[] strings)
+	{
 		String[] strNew = new String[strings.length];
-		for (int i = 0; i < strings.length; i++) {
+		for (int i = 0; i < strings.length; i++)
+		{
 			strNew[i] = fixSlashes(strings[i]) /*.toLowerCase()*/;
 		}
 		return strNew;
 	}
-	private static String fixSlashes(String str) {
+	private static String fixSlashes(String str)
+	{
 		// replace \ with /
 		str = str.replace('\\', '/');
 		// compress multiples into singles;
@@ -399,18 +316,22 @@ public class ClassFinder {
 	private static String replaceString(
 		String s,
 		String strToFind,
-		String strToReplace) {
+		String strToReplace)
+	{
 		int index;
 		int currentPos;
 		StringBuffer buffer = null;
-		if (s.indexOf(strToFind) == -1) {
+		if (s.indexOf(strToFind) == -1)
+		{
 			return s;
 		}
 		currentPos = 0;
 		buffer = new StringBuffer();
-		while (true) {
+		while (true)
+		{
 			index = s.indexOf(strToFind, currentPos);
-			if (index == -1) {
+			if (index == -1)
+			{
 				break;
 			}
 			buffer.append(s.substring(currentPos, index));
@@ -420,150 +341,128 @@ public class ClassFinder {
 		buffer.append(s.substring(currentPos));
 		return buffer.toString();
 	}
-	/************************************************************
-	
-	 *  Determine if the class implements the interface.
-	
-	 *
-	
-	 *@param  theClass      the class to check
-	
-	 *@param  theInterface  the interface to look for
-	
-	 *@return               boolean true if it implements
-	
+	/************************************************************	
+	 *  Determine if the class implements the interface.	
+	 *	
+	 *@param  theClass      the class to check	
+	 *@param  theInterface  the interface to look for	
+	 *@return               boolean true if it implements	
 	 ***********************************************************/
 	private static boolean classImplementsInterface(
 		Class theClass,
-		Class theInterface) {
+		Class theInterface)
+	{
 		HashMap mapInterfaces = new HashMap();
 		String strKey = null;
 		// pass in the map by reference since the method is recursive
 		getAllInterfaces(theClass, mapInterfaces);
 		Iterator iterInterfaces = mapInterfaces.keySet().iterator();
-		while (iterInterfaces.hasNext()) {
+		while (iterInterfaces.hasNext())
+		{
 			strKey = (String) iterInterfaces.next();
-			if (mapInterfaces.get(strKey) == theInterface) {
+			if (mapInterfaces.get(strKey) == theInterface)
+			{
 				return true;
 			}
 		}
 		return false;
 	}
-	/************************************************************
-	
-	 *  Convenience method for <code>findAllSubclasses(List, List, boolean)</code>
-	
-	 *  with the option to include inner classes in the search set to false
-	
-	 *
-	
-	 *@param  listSuperClasses  the base classes to find subclasses for
-	
-	 *@param  listAllClasses    the collection of classes to search in
-	
-	 *@return                   ArrayList of the subclasses
-	
+	/************************************************************	
+	 *  Convenience method for <code>findAllSubclasses(List, List, boolean)</code>	
+	 *  with the option to include inner classes in the search set to false	
+	 *	
+	 *@param  listSuperClasses  the base classes to find subclasses for	
+	 *@param  listAllClasses    the collection of classes to search in	
+	 *@return                   ArrayList of the subclasses	
 	 ***********************************************************/
 	private static ArrayList findAllSubclasses(
 		List listSuperClasses,
-		List listAllClasses) {
+		List listAllClasses)
+	{
 		return findAllSubclasses(listSuperClasses, listAllClasses, false);
 	}
-	/************************************************************
-	
-	 *  Finds all classes that extend the classes in the listSuperClasses
-	
-	 *  ArrayList, searching in the listAllClasses ArrayList.
-	
-	 *
-	
-	 *@param  listSuperClasses  the base classes to find subclasses for
-	
-	 *@param  listAllClasses    the collection of classes to search in
-	
-	 *@param  innerClasses      indicate whether to include inner classes in the
-	
-	 *      search
-	
-	 *@return                   ArrayList of the subclasses
-	
+	/************************************************************	
+	 *  Finds all classes that extend the classes in the listSuperClasses	
+	 *  ArrayList, searching in the listAllClasses ArrayList.	
+	 *	
+	 *@param  listSuperClasses  the base classes to find subclasses for	
+	 *@param  listAllClasses    the collection of classes to search in	
+	 *@param  innerClasses      indicate whether to include inner classes in the	
+	 *      search	
+	 *@return                   ArrayList of the subclasses	
 	 ***********************************************************/
 	private static ArrayList findAllSubclasses(
 		List listSuperClasses,
 		List listAllClasses,
-		boolean innerClasses) {
+		boolean innerClasses)
+	{
 		Iterator iterClasses = null;
 		ArrayList listSubClasses = null;
 		String strClassName = null;
 		Class tempClass = null;
 		listSubClasses = new ArrayList();
 		iterClasses = listSuperClasses.iterator();
-		while (iterClasses.hasNext()) {
+		while (iterClasses.hasNext())
+		{
 			strClassName = (String) iterClasses.next();
 			// only check classes if they are not inner classes
 			// or we intend to check for inner classes
-			if ((strClassName.indexOf("$") == -1) || innerClasses) {
+			if ((strClassName.indexOf("$") == -1) || innerClasses)
+			{
 				// might throw an exception, assume this is ignorable
-				try {
-					tempClass = Class.forName(strClassName,true,Thread.currentThread().getContextClassLoader());
+				try
+				{
+					tempClass =
+						Class.forName(
+							strClassName,
+							false,
+							Thread.currentThread().getContextClassLoader());
 					findAllSubclassesOneClass(
 						tempClass,
 						listAllClasses,
 						listSubClasses,
 						innerClasses);
 					// call by reference - recursive
-				} catch (Throwable ignored) {}
+				}
+				catch (Throwable ignored)
+				{
+				}
 			}
 		}
 		return listSubClasses;
 	}
-	/************************************************************
-	
+	/************************************************************	
 	 *  Convenience method for <code>findAllSubclassesOneClass(Class, List, List,
-	
-	 *  boolean)</code> with option to include inner classes in the search set to
-	
-	 *  false
-	
-	 *
-	
-	 *@param  theClass        the parent class
-	
-	 *@param  listAllClasses  the collection of classes to search in
-	
-	 *@param  listSubClasses  the collection of discovered subclasses
-	
+	 *  boolean)</code> with option to include inner classes in the search set to	
+	 *  false	
+	 *	
+	 *@param  theClass        the parent class	
+	 *@param  listAllClasses  the collection of classes to search in	
+	 *@param  listSubClasses  the collection of discovered subclasses	
 	 ***********************************************************/
 	private static void findAllSubclassesOneClass(
 		Class theClass,
 		List listAllClasses,
-		List listSubClasses) {
+		List listSubClasses)
+	{
 		findAllSubclassesOneClass(theClass, listAllClasses, listSubClasses, false);
 	}
-	/************************************************************
-	
-	 *  Finds all classes that extend the class, searching in the listAllClasses
-	
-	 *  ArrayList.
-	
-	 *
-	
-	 *@param  theClass        the parent class
-	
-	 *@param  listAllClasses  the collection of classes to search in
-	
-	 *@param  listSubClasses  the collection of discovered subclasses
-	
-	 *@param  innerClasses    indicates whether inners classes should be included
-	
-	 *      in the search
-	
+	/************************************************************	
+	 *  Finds all classes that extend the class, searching in the listAllClasses	
+	 *  ArrayList.	
+	 *	
+	 *@param  theClass        the parent class	
+	 *@param  listAllClasses  the collection of classes to search in	
+	 *@param  listSubClasses  the collection of discovered subclasses	
+	 *@param  innerClasses    indicates whether inners classes should be included	
+	 *      in the search	
 	 ***********************************************************/
 	private static void findAllSubclassesOneClass(
 		Class theClass,
 		List listAllClasses,
 		List listSubClasses,
-		boolean innerClasses) {
+		boolean innerClasses)
+	{
 		Iterator iterClasses = null;
 		String strClassName = null;
 		String strSuperClassName = null;
@@ -572,64 +471,68 @@ public class ClassFinder {
 		boolean bIsSubclass = false;
 		strSuperClassName = theClass.getName();
 		iterClasses = listAllClasses.iterator();
-		while (iterClasses.hasNext()) {
+		while (iterClasses.hasNext())
+		{
 			strClassName = (String) iterClasses.next();
 			// only check classes if they are not inner classes
 			// or we intend to check for inner classes
-			if ((strClassName.indexOf("$") == -1) || innerClasses) {
+			if ((strClassName.indexOf("$") == -1) || innerClasses)
+			{
 				// might throw an exception, assume this is ignorable
-				try {
+				try
+				{
 					// Class.forName() doesn't like nulls
 					if (strClassName == null)
 						continue;
-					c = Class.forName(strClassName,true,Thread.currentThread().getContextClassLoader());
-					if (!c.isInterface() && !Modifier.isAbstract(c.getModifiers())) {
+					c =
+						Class.forName(
+							strClassName,
+							false,
+							Thread.currentThread().getContextClassLoader());
+					if (!c.isInterface() && !Modifier.isAbstract(c.getModifiers()))
+					{
 						bIsSubclass = theClass.isAssignableFrom(c);
-					} else {
+					}
+					else
+					{
 						bIsSubclass = false;
 					}
-					if (bIsSubclass) {
+					if (bIsSubclass)
+					{
 						listSubClasses.add(strClassName);
 					}
-				} catch (Throwable ignored) {}
+				}
+				catch (Throwable ignored)
+				{
+				}
 			}
 		}
 	}
-	/************************************************************
-	
-	 *  Converts a class file from the text stored in a Jar file to a version that
-	
-	 *  can be used in Class.forName().
-	
-	 *
-	
-	 *@param  strClassName  the class name from a Jar file
-	
-	 *@return               String the Java-style dotted version of the name
-	
+	/************************************************************	
+	 *  Converts a class file from the text stored in a Jar file to a version that	
+	 *  can be used in Class.forName().	
+	 *	
+	 *@param  strClassName  the class name from a Jar file	
+	 *@return               String the Java-style dotted version of the name	
 	 ***********************************************************/
-	private static String fixClassName(String strClassName) {
+	private static String fixClassName(String strClassName)
+	{
 		strClassName = strClassName.replace('\\', '.');
 		strClassName = strClassName.replace('/', '.');
 		strClassName = strClassName.substring(0, strClassName.length() - 6);
 		// remove ".class"
 		return strClassName;
 	}
-	/************************************************************
-	
-	 *  Description of the Method
-	
-	 *
-	
-	 *@param  strPath          Description of Parameter
-	
-	 *@param  listClasses      Description of Parameter
-	
-	 *@exception  IOException  Description of Exception
-	
+	/************************************************************	
+	 *  Description of the Method	
+	 *	
+	 *@param  strPath          Description of Parameter	
+	 *@param  listClasses      Description of Parameter	
+	 *@exception  IOException  Description of Exception	
 	 ***********************************************************/
 	private static void findClassesInOnePath(String strPath, List listClasses)
-		throws IOException {
+		throws IOException
+	{
 		File file = null;
 		String strPathName = null;
 		ZipFile zipFile = null;
@@ -637,138 +540,73 @@ public class ClassFinder {
 		Enumeration entries = null;
 		String strEntry = null;
 		file = new File(strPath);
-		if (file.isDirectory()) {
+		if (file.isDirectory())
+		{
 			findClassesInPathsDir(strPath, file, listClasses);
-		} else
-			if (file.exists()) {
-				zipFile = new ZipFile(file);
-				entries = zipFile.entries();
-				while (entries.hasMoreElements()) {
-					strEntry = entries.nextElement().toString();
-					if (strEntry.endsWith(".class")) {
-						listClasses.add(fixClassName(strEntry));
-					}
+		}
+		else if (file.exists())
+		{
+			zipFile = new ZipFile(file);
+			entries = zipFile.entries();
+			while (entries.hasMoreElements())
+			{
+				strEntry = entries.nextElement().toString();
+				if (strEntry.endsWith(".class"))
+				{
+					listClasses.add(fixClassName(strEntry));
 				}
 			}
+		}
 	}
-	/************************************************************
-	
-	 *  Description of the Method
-	
-	 *
-	
-	 *@param  listPaths        Description of Parameter
-	
-	 *@param  listClasses      Description of Parameter
-	
-	 *@exception  IOException  Description of Exception
-	
+	/************************************************************	
+	 *  Description of the Method	
+	 *	
+	 *@param  listPaths        Description of Parameter	
+	 *@param  listClasses      Description of Parameter	
+	 *@exception  IOException  Description of Exception	
 	 ***********************************************************/
 	private static void findClassesInPaths(List listPaths, List listClasses)
-		throws IOException {
+		throws IOException
+	{
 		Iterator iterPaths = listPaths.iterator();
-		while (iterPaths.hasNext()) {
+		while (iterPaths.hasNext())
+		{
 			findClassesInOnePath((String) iterPaths.next(), listClasses);
 		}
 	}
-	/************************************************************
-	
-	 *  Description of the Method
-	
-	 *
-	
-	 *@param  strPathElement   Description of Parameter
-	
-	 *@param  dir              Description of Parameter
-	
-	 *@param  listClasses      Description of Parameter
-	
-	 *@exception  IOException  Description of Exception
-	
+	/************************************************************	
+	 *  Description of the Method	
+	 *	
+	 *@param  strPathElement   Description of Parameter	
+	 *@param  dir              Description of Parameter	
+	 *@param  listClasses      Description of Parameter	
+	 *@exception  IOException  Description of Exception	
 	 ***********************************************************/
 	private static void findClassesInPathsDir(
 		String strPathElement,
 		File dir,
 		List listClasses)
-		throws IOException {
+		throws IOException
+	{
 		File file = null;
 		String[] list = dir.list();
-		for (int i = 0; i < list.length; i++) {
+		for (int i = 0; i < list.length; i++)
+		{
 			file = new File(dir, list[i]);
-			if (file.isDirectory()) {
+			if (file.isDirectory())
+			{
 				findClassesInPathsDir(strPathElement, file, listClasses);
-			} else
-				if (file.exists() && (file.length() != 0) && list[i].endsWith(".class")) {
-					listClasses.add(
-						file
-							.getPath()
-							.substring(strPathElement.length() + 1, file.getPath().lastIndexOf("."))
-							.replace(File.separator.charAt(0), '.'));
-				}
-		}
-	}
-	/************************************************************
-	
-	 *  !ToDo (Class description)
-	
-	 *
-	
-	 *@author     $Author: mstover1 $
-	
-	 *@created    $Date: 2002/08/11 23:19:53 $
-	
-	 *@version    $Revision: 1.2 $
-	
-	 ***********************************************************/
-	public static class Test extends TestCase {
-		/************************************************************
-		
-		 *  !ToDo (Constructor description)
-		
-		 *
-		
-		 *@param  name  !ToDo (Parameter description)
-		
-		 ***********************************************************/
-		public Test(String name) {
-			super(name);
-		}
-		// For a given testPath, get the name of the classes in the path and its
-		// subpaths. Append the first class name found to the testPath to ensure
-		// that the file is found.
-		/************************************************************
-		
-		 *  !ToDo
-		
-		 ***********************************************************/
-		public void testFindClassesInPaths() {
-			String testPath = JMeterUtils.getJMeterHome() + "/build";
-			List listPaths = new ArrayList();
-			ArrayList listClasses = new ArrayList();
-			// listPaths will contain the path/jars where all classes will be listed
-			listPaths.add(testPath);
-			try {
-				findClassesInPaths(listPaths, listClasses);
-			} catch (IOException e) {
-				fail("IOException thrown");
 			}
-			Iterator iter = listClasses.iterator();
-			if (iter.hasNext()) {
-				String fullname = null;
-				// check if file exist
-				String fileSeparator = System.getProperty("file.separator");
-				String filename = (String) iter.next();
-				filename = filename.replace('.', fileSeparator.charAt(0));
-				if (testPath.endsWith(fileSeparator)) {
-					fullname = testPath + filename + ".class";
-				} else {
-					fullname = testPath + fileSeparator + filename + ".class";
-				}
-				File file = new File(fullname);
-				this.assertTrue(fullname + " is not a file", file.isFile());
-			} else {
-				// if testPath is empty, fail the test
-				fail(testPath + " is empty. Please choose a path which has at least one file");
+			else if (
+				file.exists() && (file.length() != 0) && list[i].endsWith(".class"))
+			{
+				listClasses.add(
+					file
+						.getPath()
+						.substring(
+							strPathElement.length() + 1,
+							file.getPath().lastIndexOf("."))
+						.replace(File.separator.charAt(0), '.'));
 			}
 		}
 	}
diff --git a/jakarta-jmeter/src/jorphan/org/apache/jorphan/test/AllTests.java b/jakarta-jmeter/src/jorphan/org/apache/jorphan/test/AllTests.java
new file mode 100644
index 0000000..0a3fb4b
--- /dev/null
+++ b/jakarta-jmeter/src/jorphan/org/apache/jorphan/test/AllTests.java
@@ -0,0 +1,251 @@
+/*
+ * ====================================================================
+ * The Apache Software License, Version 1.1
+ *
+ * Copyright (c) 2001 The Apache Software Foundation.  All rights
+ * reserved.
+ *
+ * Redistribution and use in source and binary forms, with or without
+ * modification, are permitted provided that the following conditions
+ * are met:
+ *
+ * 1. Redistributions of source code must retain the above copyright
+ * notice, this list of conditions and the following disclaimer.
+ *
+ * 2. Redistributions in binary form must reproduce the above copyright
+ * notice, this list of conditions and the following disclaimer in
+ * the documentation and/or other materials provided with the
+ * distribution.
+ *
+ * 3. The end-user documentation included with the redistribution,
+ * if any, must include the following acknowledgment:
+ * "This product includes software developed by the
+ * Apache Software Foundation (http://www.apache.org/)."
+ * Alternately, this acknowledgment may appear in the software itself,
+ * if and wherever such third-party acknowledgments normally appear.
+ *
+ * 4. The names "Apache" and "Apache Software Foundation" and
+ * "Apache JMeter" must not be used to endorse or promote products
+ * derived from this software without prior written permission. For
+ * written permission, please contact apache@apache.org.
+ *
+ * 5. Products derived from this software may not be called "Apache",
+ * "Apache JMeter", nor may "Apache" appear in their name, without
+ * prior written permission of the Apache Software Foundation.
+ *
+ * THIS SOFTWARE IS PROVIDED ``AS IS'' AND ANY EXPRESSED OR IMPLIED
+ * WARRANTIES, INCLUDING, BUT NOT LIMITED TO, THE IMPLIED WARRANTIES
+ * OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE ARE
+ * DISCLAIMED.  IN NO EVENT SHALL THE APACHE SOFTWARE FOUNDATION OR
+ * ITS CONTRIBUTORS BE LIABLE FOR ANY DIRECT, INDIRECT, INCIDENTAL,
+ * SPECIAL, EXEMPLARY, OR CONSEQUENTIAL DAMAGES (INCLUDING, BUT NOT
+ * LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES; LOSS OF
+ * USE, DATA, OR PROFITS; OR BUSINESS INTERRUPTION) HOWEVER CAUSED AND
+ * ON ANY THEORY OF LIABILITY, WHETHER IN CONTRACT, STRICT LIABILITY,
+ * OR TORT (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT
+ * OF THE USE OF THIS SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF
+ * SUCH DAMAGE.
+ * ====================================================================
+ *
+ * This software consists of voluntary contributions made by many
+ * individuals on behalf of the Apache Software Foundation.  For more
+ * information on the Apache Software Foundation, please see
+ * <http://www.apache.org/>.
+ */
+ 
+package org.apache.jorphan.test;
+
+import java.io.FileInputStream;
+import java.io.FileNotFoundException;
+import java.io.FileOutputStream;
+import java.io.IOException;
+import java.io.PrintStream;
+import java.util.Iterator;
+import java.util.Properties;
+
+import junit.framework.TestCase;
+import junit.framework.TestSuite;
+
+import org.apache.log.Hierarchy;
+import org.apache.log.Logger;
+import org.apache.jorphan.logging.LoggingManager;
+import org.apache.jorphan.reflect.ClassFinder;
+import org.apache.jorphan.util.JOrphanUtils;
+
+/************************************************************
+ *  Provides a quick and easy way to run all <a href="http://junit.sourceforge.net">junit</a> unit tests in your java project.  It will 
+ * find all unit test classes and run all their test methods.  There is no need to configure
+ * it in any way to find these classes except to give it a path to search.
+ * <p>
+ * Here is an example Ant target (See Ant at <a href="http://jakarta.apache.org/ant">Apache</a>) that
+ * runs all your unit tests:
+ * <pre>
+ *		&lt;target name="test" depends="compile"&gt;
+ *			&lt;java classname="org.apache.jorphan.test.AllTests" fork="yes"&gt; 
+ *				&lt;classpath&gt;
+ *					&lt;path refid="YOUR_CLASSPATH"/&gt;
+ *					&lt;pathelement location="ROOT_DIR_OF_YOUR_COMPILED_CLASSES"/&gt;
+ *				&lt;/classpath&gt;
+ *				&lt;arg value="SEARCH_PATH/"/&gt;
+ *				&lt;arg value="PROPERTY_FILE"/&gt;
+ *				&lt;arg value="NAME_OF_UNITTESTMANAGER_CLASS"/&gt;
+ *			&lt;/java&gt;
+ *		&lt;/target&gt;
+ * </pre>
+ * 
+ * <DL><dt>YOUR_CLASSPATH
+ * 	<DD>Refers to the classpath that includes all jars and libraries need to run your unit tests
+ *</dd>
+ * </dt><dt>ROOT_DIR_OF_YOUR_COMPILED_CLASSES
+ * <dd>The classpath should include the directory where all your project's classes are compiled
+ * to, if it doesn't already.  </dd></dt>
+ * <dt>SEARCH_PATH
+ * <dd>The first argument tells AllTests where to 
+ * look for unit test classes to execute.  In most cases, it is identical to 
+ * ROOT_DIR_OF_YOUR_COMPILED_CLASSES.  You can specify multiple directories or jars to 
+ * search by providing a comma-delimited list.</dd></dt>
+ * <dt>PROPERTY_FILE
+ * <dd>A simple property file that sets logging parameters.  It is optional and is only relevant
+ * if you use the same logging packages that JOrphan uses.</dd></dt>
+ * <dt>NAME_OF_UNITTESTMANAGER_CLASS
+ * <dd>If your system requires some configuration to run correctly, you can implement the
+ * {@link UnitTestManager} interface and be given an opportunity to initialize your system from a configuration 
+ * file.</dd></dt></dl>
+ *
+ *@author     Michael Stover (mstover1 at apache.org)
+ *@see UnitTestManager
+ ***********************************************************/
+public class AllTests
+{
+	transient private static Logger log = Hierarchy.getDefaultHierarchy().getLoggerFor(
+			"jmeter.test");
+	/************************************************************
+	 *  Constructor for the AllTests object
+	 ***********************************************************/
+	public AllTests()
+	{
+	}
+
+	/************************************************************
+	 *  Starts a run through all unit tests found in the specified classpaths.
+	 * The first argument should be a list of paths to search.
+	 * The second argument is optional and specifies a properties file used to
+	 * initialize logging.
+	 * The third argument is also optional, and specifies a class that implements the 
+	 * UnitTestManager interface.  This provides a means of initializing your application
+	 * with a configuration file prior to the start of any unit tests.
+	 *
+	 *@param  args  The command line arguments
+	 ***********************************************************/
+	public static void main(String[] args)
+	{
+		if(args.length < 1)
+		{
+			System.out.println("You must specify a comma-delimited list of paths to search for unit tests");
+			System.exit(0);
+		}
+		initializeLogging(args);
+		initializeManager(args);
+		// end : added - 11 July 2001
+		try
+		{
+			TestSuite suite = suite(args[0]);
+			PrintStream out = new PrintStream(new FileOutputStream("testresults.txt"));
+			junit.textui.TestRunner runner = new junit.textui.TestRunner(out);
+			runner.run(suite);
+			out.close();
+		}
+		catch (FileNotFoundException e)
+		{
+			log.error("",e);
+		}
+		System.exit(0);
+	}
+
+	/**
+	 * An overridable method that initializes the logging for the unit test run, using
+	 * the properties file passed in as the second argument.
+	 * @param args 
+	 */
+	protected static void initializeLogging(String[] args)
+	{
+		if (args.length >= 2)
+		{
+			Properties props = new Properties();
+			try
+			{
+				System.out.println("setting up logging props using file: "+args[1]);
+				props.load(new FileInputStream(args[1]));
+				LoggingManager.initializeLogging(props);
+			}
+			catch (FileNotFoundException e)
+			{
+			}
+			catch (IOException e)
+			{
+			}
+		}
+	}
+
+	/**
+	 * An overridable method that that instantiates a UnitTestManager (if one was
+	 * specified in the command-line arguments), and hands it the name of the 
+	 * properties file to use to configure the system.
+	 * @param args
+	 */
+	protected static void initializeManager(String[] args)
+	{
+		if(args.length >= 3)
+		{
+			try
+			{
+				UnitTestManager um = (UnitTestManager)Class.forName(args[2]).newInstance();
+				um.initializeProperties(args[1]);
+			}
+			catch (Exception e)
+			{
+				System.out.println("Couldn't create: "+args[2]);
+				e.printStackTrace();
+			}
+		}
+	}
+
+	/************************************************************
+	 *  A unit test suite for JUnit
+	 *
+	 *@return    The test suite
+	 ***********************************************************/
+	private static TestSuite suite(String searchPaths)
+	{
+		TestSuite suite = new TestSuite();
+		try
+		{
+			Iterator classes = ClassFinder.findClassesThatExtend(
+			    		JOrphanUtils.split(searchPaths, ","),
+					new Class[]{TestCase.class},true).iterator();
+			while (classes.hasNext())
+			{
+				String name = (String)classes.next();
+				try
+				{
+					suite.addTest(new TestSuite(Class.forName(name)));
+				}
+				catch (Exception ex)
+				{
+					log.error("error adding test :"+ex);
+				}
+			}
+		}
+		catch (IOException e)
+		{
+			log.error("",e);
+		}
+		catch (ClassNotFoundException e)
+		{
+			log.error("",e);
+		}
+		return suite;
+	}
+}
+
+
diff --git a/jakarta-jmeter/src/jorphan/org/apache/jorphan/test/CVS/Entries b/jakarta-jmeter/src/jorphan/org/apache/jorphan/test/CVS/Entries
new file mode 100644
index 0000000..47302d6
--- /dev/null
+++ b/jakarta-jmeter/src/jorphan/org/apache/jorphan/test/CVS/Entries
@@ -0,0 +1,3 @@
+/AllTests.java/1.2/Fri Dec 27 15:51:18 2002//Tv1_8_1
+/UnitTestManager.java/1.1/Thu Oct 17 19:47:19 2002//Tv1_8_1
+D
diff --git a/jakarta-jmeter/src/jorphan/org/apache/jorphan/test/CVS/Repository b/jakarta-jmeter/src/jorphan/org/apache/jorphan/test/CVS/Repository
new file mode 100644
index 0000000..0149364
--- /dev/null
+++ b/jakarta-jmeter/src/jorphan/org/apache/jorphan/test/CVS/Repository
@@ -0,0 +1 @@
+jakarta-jmeter/src/jorphan/org/apache/jorphan/test
diff --git a/jakarta-jmeter/src/jorphan/org/apache/jorphan/test/CVS/Root b/jakarta-jmeter/src/jorphan/org/apache/jorphan/test/CVS/Root
new file mode 100644
index 0000000..41188ef
--- /dev/null
+++ b/jakarta-jmeter/src/jorphan/org/apache/jorphan/test/CVS/Root
@@ -0,0 +1 @@
+:pserver:anoncvs@cvs.apache.org:/home/cvspublic
diff --git a/jakarta-jmeter/src/jorphan/org/apache/jorphan/test/CVS/Tag b/jakarta-jmeter/src/jorphan/org/apache/jorphan/test/CVS/Tag
new file mode 100644
index 0000000..e2fda28
--- /dev/null
+++ b/jakarta-jmeter/src/jorphan/org/apache/jorphan/test/CVS/Tag
@@ -0,0 +1 @@
+Nv1_8_1
diff --git a/jakarta-jmeter/src/core/org/apache/jmeter/save/old/Saveable.java b/jakarta-jmeter/src/jorphan/org/apache/jorphan/test/UnitTestManager.java
similarity index 80%
rename from jakarta-jmeter/src/core/org/apache/jmeter/save/old/Saveable.java
rename to jakarta-jmeter/src/jorphan/org/apache/jorphan/test/UnitTestManager.java
index a4afdfe..09daf05 100644
--- a/jakarta-jmeter/src/core/org/apache/jmeter/save/old/Saveable.java
+++ b/jakarta-jmeter/src/jorphan/org/apache/jorphan/test/UnitTestManager.java
@@ -52,27 +52,23 @@
  * information on the Apache Software Foundation, please see
  * <http://www.apache.org/>.
  */
-
+ 
+package org.apache.jorphan.test;
 /**
- * Title:        JMeter<p>
- * Description:  <p>
- * Copyright:    Copyright (c) Michael Stover<p>
- * Company:      Apache JMeter<p>
- * @author Michael Stover
- * @version 1.0
+ * Implement this interface to work with the AllTests class.  This interface allows
+ * AllTests to pass a configuration file to your application before running the 
+ * junit unit tests.
+ * 
+ * @author Michael Stover (mstover at apache.org)
+ * @see AllTests
  */
-package org.apache.jmeter.save.old;
-
-import java.io.*;
-import org.xml.sax.*;
-
-import org.apache.jmeter.save.old.xml.*;
-
-public interface Saveable
+public interface UnitTestManager
 {
-  /**
-	*  Gets the TagHandler that will handle the parsing of the xml for this type of
-	*  object.
-	*/
-  public Class getTagHandlerClass();
+	/**
+	 * Your implementation will be handed the filename that was provided to AllTests as
+	 * a configuration file.  It can hold whatever properties you need to configure
+	 * your system prior to the unit tests running.
+	 * @param filename
+	 */
+	public void initializeProperties(String filename);
 }
diff --git a/jakarta-jmeter/src/jorphan/org/apache/jorphan/util/CVS/Entries b/jakarta-jmeter/src/jorphan/org/apache/jorphan/util/CVS/Entries
new file mode 100644
index 0000000..619a765
--- /dev/null
+++ b/jakarta-jmeter/src/jorphan/org/apache/jorphan/util/CVS/Entries
@@ -0,0 +1,2 @@
+/JOrphanUtils.java/1.1/Fri Dec 27 15:51:18 2002//Tv1_8_1
+D
diff --git a/jakarta-jmeter/src/jorphan/org/apache/jorphan/util/CVS/Repository b/jakarta-jmeter/src/jorphan/org/apache/jorphan/util/CVS/Repository
new file mode 100644
index 0000000..7ad84ae
--- /dev/null
+++ b/jakarta-jmeter/src/jorphan/org/apache/jorphan/util/CVS/Repository
@@ -0,0 +1 @@
+jakarta-jmeter/src/jorphan/org/apache/jorphan/util
diff --git a/jakarta-jmeter/src/jorphan/org/apache/jorphan/util/CVS/Root b/jakarta-jmeter/src/jorphan/org/apache/jorphan/util/CVS/Root
new file mode 100644
index 0000000..41188ef
--- /dev/null
+++ b/jakarta-jmeter/src/jorphan/org/apache/jorphan/util/CVS/Root
@@ -0,0 +1 @@
+:pserver:anoncvs@cvs.apache.org:/home/cvspublic
diff --git a/jakarta-jmeter/src/jorphan/org/apache/jorphan/util/CVS/Tag b/jakarta-jmeter/src/jorphan/org/apache/jorphan/util/CVS/Tag
new file mode 100644
index 0000000..e2fda28
--- /dev/null
+++ b/jakarta-jmeter/src/jorphan/org/apache/jorphan/util/CVS/Tag
@@ -0,0 +1 @@
+Nv1_8_1
diff --git a/jakarta-jmeter/src/core/org/apache/jmeter/save/old/handlers/CookieManagerHandler.java b/jakarta-jmeter/src/jorphan/org/apache/jorphan/util/JOrphanUtils.java
similarity index 59%
rename from jakarta-jmeter/src/core/org/apache/jmeter/save/old/handlers/CookieManagerHandler.java
rename to jakarta-jmeter/src/jorphan/org/apache/jorphan/util/JOrphanUtils.java
index 85f80ad..0d81c1a 100644
--- a/jakarta-jmeter/src/core/org/apache/jmeter/save/old/handlers/CookieManagerHandler.java
+++ b/jakarta-jmeter/src/jorphan/org/apache/jorphan/util/JOrphanUtils.java
@@ -2,7 +2,7 @@
  * ====================================================================
  * The Apache Software License, Version 1.1
  *
- * Copyright (c) 2001 The Apache Software Foundation.  All rights
+ * Copyright (c) 2002 The Apache Software Foundation.  All rights
  * reserved.
  *
  * Redistribution and use in source and binary forms, with or without
@@ -52,72 +52,65 @@
  * information on the Apache Software Foundation, please see
  * <http://www.apache.org/>.
  */
- package org.apache.jmeter.save.old.handlers;
+package org.apache.jorphan.util;
 
-import java.io.Writer;
-import java.util.Iterator;
-import java.util.List;
-
-import org.apache.jmeter.protocol.http.control.Cookie;
-import org.apache.jmeter.protocol.http.control.CookieManager;
-import org.apache.jmeter.save.old.Saveable;
-import org.apache.jmeter.save.old.xml.TagHandler;
-import org.apache.jmeter.testelement.TestElement;
-import org.xml.sax.Attributes;
+import java.util.StringTokenizer;
+import java.util.Vector;
 
 /**
- * Title:
- * Description:
- * Copyright:    Copyright (c) 2001
- * Company:
- * @author Michael Stover
- * @version 1.0
+ * This class contains frequently-used static utility methods.
+ *
+ * @author     <a href="mailto://jsalvata@atg.com">Jordi Salvat i Alabart</a>
+ * @created    27th December 2002
+ * @version    $Revision: 1.1 $
  */
-
-public class CookieManagerHandler extends TagHandler
+public class JOrphanUtils
 {
-
-	private CookieManager cookieManager;
-
-	public CookieManagerHandler()
-	{
-	}
-
-	public void save(Saveable cm, Writer out) throws java.io.IOException
+    /**
+     * This is equivalent to the String.split method in JDK 1.4. It is
+     * here to enable us to support earlier JDKs.
+     *
+     * <P>This piece of code used to be part of JMeterUtils, but was moved
+     * here because some JOrphan classes use it too.
+     *
+     * @param  splittee   String to be split
+     * @param  splitChar  Character to split the string on
+     * @return            Array of all the tokens.
+     */
+    public static String[] split(String splittee, String splitChar)
+    {
+	if (splittee == null || splitChar == null)
 	{
-		CookieManager cookies = (CookieManager)cm;
-		out.write("<CookieManager name=\"");
-		out.write(JMeterHandler.convertToXML(cookies.getName()));
-		out.write("\">\n");
-		JMeterHandler.writeObjects(cookies.getCookies(),out);
-		out.write("</CookieManager>\n");
+	    return new String[0];
 	}
-
-	public void setAtts(Attributes atts) throws java.lang.Exception
+	StringTokenizer tokens;
+	String temp;
+	int spot;
+	while ((spot = splittee.indexOf(splitChar + splitChar)) != -1)
 	{
-		cookieManager = new CookieManager();
-		cookieManager.setName(atts.getValue("name"));
-		cookieManager.setProperty(TestElement.GUI_CLASS,
-				"org.apache.jmeter.protocol.http.gui.CookiePanel");
+	    splittee = splittee.substring(0, spot + splitChar.length())
+		       + splittee.substring(spot + 2 * splitChar.length(),
+			       splittee.length());
 	}
-
-	public String getPrimaryTagName()
+	Vector returns = new Vector();
+	int start = 0;
+	int length = splittee.length();
+	spot = 0;
+	while (start<length && (spot = splittee.indexOf(splitChar, start)) > -1)
 	{
-		return "CookieManager";
+	    if (spot > 0)
+	    {
+		returns.addElement(splittee.substring(start, spot));
+	    }
+	    start = spot + splitChar.length();
 	}
-
-	public void CookieManagerTagEnd()
-	{
-		List cookies = xmlParent.takeChildObjects(this);
-		Iterator iter = cookies.iterator();
-		while (iter.hasNext())
-		{
-			cookieManager.add((Cookie)((TagHandler)iter.next()).getModel());
-		}
-	}
-
-	public Object getModel()
+	if (start < length)
 	{
-		return cookieManager;
+	    returns.add(splittee.substring(start));
 	}
-}
\ No newline at end of file
+	String[] values = new String[returns.size()];
+	returns.copyInto(values);
+	return values;
+    }
+    // End Method split(String, String)
+}
diff --git a/jakarta-jmeter/src/protocol/CVS/Tag b/jakarta-jmeter/src/protocol/CVS/Tag
index f4b6a59..75ba187 100644
--- a/jakarta-jmeter/src/protocol/CVS/Tag
+++ b/jakarta-jmeter/src/protocol/CVS/Tag
@@ -1 +1 @@
-Tv1_7_3
+Tv1_8_1
diff --git a/jakarta-jmeter/src/protocol/ftp/CVS/Tag b/jakarta-jmeter/src/protocol/ftp/CVS/Tag
index f4b6a59..75ba187 100644
--- a/jakarta-jmeter/src/protocol/ftp/CVS/Tag
+++ b/jakarta-jmeter/src/protocol/ftp/CVS/Tag
@@ -1 +1 @@
-Tv1_7_3
+Tv1_8_1
diff --git a/jakarta-jmeter/src/protocol/ftp/org/CVS/Tag b/jakarta-jmeter/src/protocol/ftp/org/CVS/Tag
index f4b6a59..75ba187 100644
--- a/jakarta-jmeter/src/protocol/ftp/org/CVS/Tag
+++ b/jakarta-jmeter/src/protocol/ftp/org/CVS/Tag
@@ -1 +1 @@
-Tv1_7_3
+Tv1_8_1
diff --git a/jakarta-jmeter/src/protocol/ftp/org/apache/CVS/Tag b/jakarta-jmeter/src/protocol/ftp/org/apache/CVS/Tag
index f4b6a59..75ba187 100644
--- a/jakarta-jmeter/src/protocol/ftp/org/apache/CVS/Tag
+++ b/jakarta-jmeter/src/protocol/ftp/org/apache/CVS/Tag
@@ -1 +1 @@
-Tv1_7_3
+Tv1_8_1
diff --git a/jakarta-jmeter/src/protocol/ftp/org/apache/jmeter/CVS/Tag b/jakarta-jmeter/src/protocol/ftp/org/apache/jmeter/CVS/Tag
index f4b6a59..75ba187 100644
--- a/jakarta-jmeter/src/protocol/ftp/org/apache/jmeter/CVS/Tag
+++ b/jakarta-jmeter/src/protocol/ftp/org/apache/jmeter/CVS/Tag
@@ -1 +1 @@
-Tv1_7_3
+Tv1_8_1
diff --git a/jakarta-jmeter/src/protocol/ftp/org/apache/jmeter/protocol/CVS/Tag b/jakarta-jmeter/src/protocol/ftp/org/apache/jmeter/protocol/CVS/Tag
index f4b6a59..75ba187 100644
--- a/jakarta-jmeter/src/protocol/ftp/org/apache/jmeter/protocol/CVS/Tag
+++ b/jakarta-jmeter/src/protocol/ftp/org/apache/jmeter/protocol/CVS/Tag
@@ -1 +1 @@
-Tv1_7_3
+Tv1_8_1
diff --git a/jakarta-jmeter/src/protocol/ftp/org/apache/jmeter/protocol/ftp/CVS/Tag b/jakarta-jmeter/src/protocol/ftp/org/apache/jmeter/protocol/ftp/CVS/Tag
index f4b6a59..75ba187 100644
--- a/jakarta-jmeter/src/protocol/ftp/org/apache/jmeter/protocol/ftp/CVS/Tag
+++ b/jakarta-jmeter/src/protocol/ftp/org/apache/jmeter/protocol/ftp/CVS/Tag
@@ -1 +1 @@
-Tv1_7_3
+Tv1_8_1
diff --git a/jakarta-jmeter/src/protocol/ftp/org/apache/jmeter/protocol/ftp/config/CVS/Entries b/jakarta-jmeter/src/protocol/ftp/org/apache/jmeter/protocol/ftp/config/CVS/Entries
index fb351b2..033461b 100644
--- a/jakarta-jmeter/src/protocol/ftp/org/apache/jmeter/protocol/ftp/config/CVS/Entries
+++ b/jakarta-jmeter/src/protocol/ftp/org/apache/jmeter/protocol/ftp/config/CVS/Entries
@@ -1,2 +1,2 @@
-/FtpConfig.java/1.1/Sun Aug 11 19:24:50 2002//Tv1_7_3
+/FtpConfig.java/1.1/Sun Aug 11 19:24:50 2002//Tv1_8_1
 D/gui////
diff --git a/jakarta-jmeter/src/protocol/ftp/org/apache/jmeter/protocol/ftp/config/CVS/Tag b/jakarta-jmeter/src/protocol/ftp/org/apache/jmeter/protocol/ftp/config/CVS/Tag
index 5f312fe..e2fda28 100644
--- a/jakarta-jmeter/src/protocol/ftp/org/apache/jmeter/protocol/ftp/config/CVS/Tag
+++ b/jakarta-jmeter/src/protocol/ftp/org/apache/jmeter/protocol/ftp/config/CVS/Tag
@@ -1 +1 @@
-Nv1_7_3
+Nv1_8_1
diff --git a/jakarta-jmeter/src/protocol/ftp/org/apache/jmeter/protocol/ftp/config/gui/CVS/Entries b/jakarta-jmeter/src/protocol/ftp/org/apache/jmeter/protocol/ftp/config/gui/CVS/Entries
index dea1b54..a0b9537 100644
--- a/jakarta-jmeter/src/protocol/ftp/org/apache/jmeter/protocol/ftp/config/gui/CVS/Entries
+++ b/jakarta-jmeter/src/protocol/ftp/org/apache/jmeter/protocol/ftp/config/gui/CVS/Entries
@@ -1,2 +1,2 @@
-/FtpConfigGui.java/1.1/Sun Aug 11 19:24:50 2002//Tv1_7_3
+/FtpConfigGui.java/1.3/Thu Oct 17 19:47:19 2002//Tv1_8_1
 D
diff --git a/jakarta-jmeter/src/protocol/ftp/org/apache/jmeter/protocol/ftp/config/gui/CVS/Tag b/jakarta-jmeter/src/protocol/ftp/org/apache/jmeter/protocol/ftp/config/gui/CVS/Tag
index 5f312fe..e2fda28 100644
--- a/jakarta-jmeter/src/protocol/ftp/org/apache/jmeter/protocol/ftp/config/gui/CVS/Tag
+++ b/jakarta-jmeter/src/protocol/ftp/org/apache/jmeter/protocol/ftp/config/gui/CVS/Tag
@@ -1 +1 @@
-Nv1_7_3
+Nv1_8_1
diff --git a/jakarta-jmeter/src/protocol/ftp/org/apache/jmeter/protocol/ftp/config/gui/FtpConfigGui.java b/jakarta-jmeter/src/protocol/ftp/org/apache/jmeter/protocol/ftp/config/gui/FtpConfigGui.java
index 7dc94ed..15a37d0 100644
--- a/jakarta-jmeter/src/protocol/ftp/org/apache/jmeter/protocol/ftp/config/gui/FtpConfigGui.java
+++ b/jakarta-jmeter/src/protocol/ftp/org/apache/jmeter/protocol/ftp/config/gui/FtpConfigGui.java
@@ -53,24 +53,26 @@
  * <http://www.apache.org/>.
  */
 package org.apache.jmeter.protocol.ftp.config.gui;
-import java.awt.*;
-import java.awt.event.*;
-import javax.swing.*;
-import javax.swing.border.*;
-import org.apache.jmeter.gui.*;
-import org.apache.jmeter.gui.util.VerticalLayout;
-import org.apache.jmeter.protocol.ftp.config.*;
-import org.apache.jmeter.util.JMeterUtils;
+import java.awt.Font;
+
+import javax.swing.JLabel;
+import javax.swing.JPanel;
+import javax.swing.JTextField;
+import javax.swing.border.Border;
+import javax.swing.border.EmptyBorder;
+
+import org.apache.jmeter.config.ConfigTestElement;
 import org.apache.jmeter.config.gui.AbstractConfigGui;
-import org.apache.jmeter.testelement.TestElement;
 import org.apache.jmeter.protocol.ftp.sampler.FTPSampler;
-import org.apache.jmeter.config.ConfigTestElement;
+import org.apache.jmeter.testelement.TestElement;
+import org.apache.jmeter.util.JMeterUtils;
+import org.apache.jorphan.gui.layout.VerticalLayout;
 
 /****************************************
  * Title: JMeter Description: Copyright: Copyright (c) 2000 Company: Apache
  *
  *@author    Michael Stover
- *@created   $Date: 2002/08/11 19:24:50 $
+ *@created   $Date: 2002/10/17 19:47:19 $
  *@version   1.0
  ***************************************/
 
diff --git a/jakarta-jmeter/src/protocol/ftp/org/apache/jmeter/protocol/ftp/control/CVS/Tag b/jakarta-jmeter/src/protocol/ftp/org/apache/jmeter/protocol/ftp/control/CVS/Tag
index f4b6a59..75ba187 100644
--- a/jakarta-jmeter/src/protocol/ftp/org/apache/jmeter/protocol/ftp/control/CVS/Tag
+++ b/jakarta-jmeter/src/protocol/ftp/org/apache/jmeter/protocol/ftp/control/CVS/Tag
@@ -1 +1 @@
-Tv1_7_3
+Tv1_8_1
diff --git a/jakarta-jmeter/src/protocol/ftp/org/apache/jmeter/protocol/ftp/control/gui/CVS/Entries b/jakarta-jmeter/src/protocol/ftp/org/apache/jmeter/protocol/ftp/control/gui/CVS/Entries
index 36f8101..87fc253 100644
--- a/jakarta-jmeter/src/protocol/ftp/org/apache/jmeter/protocol/ftp/control/gui/CVS/Entries
+++ b/jakarta-jmeter/src/protocol/ftp/org/apache/jmeter/protocol/ftp/control/gui/CVS/Entries
@@ -1,2 +1,2 @@
-/FtpTestSamplerGui.java/1.1/Sun Aug 11 19:24:50 2002//Tv1_7_3
+/FtpTestSamplerGui.java/1.3/Thu Oct 17 19:47:19 2002//Tv1_8_1
 D
diff --git a/jakarta-jmeter/src/protocol/ftp/org/apache/jmeter/protocol/ftp/control/gui/CVS/Tag b/jakarta-jmeter/src/protocol/ftp/org/apache/jmeter/protocol/ftp/control/gui/CVS/Tag
index 5f312fe..e2fda28 100644
--- a/jakarta-jmeter/src/protocol/ftp/org/apache/jmeter/protocol/ftp/control/gui/CVS/Tag
+++ b/jakarta-jmeter/src/protocol/ftp/org/apache/jmeter/protocol/ftp/control/gui/CVS/Tag
@@ -1 +1 @@
-Nv1_7_3
+Nv1_8_1
diff --git a/jakarta-jmeter/src/protocol/ftp/org/apache/jmeter/protocol/ftp/control/gui/FtpTestSamplerGui.java b/jakarta-jmeter/src/protocol/ftp/org/apache/jmeter/protocol/ftp/control/gui/FtpTestSamplerGui.java
index 3b16cb3..baa2fad 100644
--- a/jakarta-jmeter/src/protocol/ftp/org/apache/jmeter/protocol/ftp/control/gui/FtpTestSamplerGui.java
+++ b/jakarta-jmeter/src/protocol/ftp/org/apache/jmeter/protocol/ftp/control/gui/FtpTestSamplerGui.java
@@ -53,26 +53,28 @@
  * <http://www.apache.org/>.
  */
 package org.apache.jmeter.protocol.ftp.control.gui;
-import java.awt.*;
-import javax.swing.*;
-import javax.swing.border.*;
-import org.apache.jmeter.config.gui.LoginConfigGui;
+import java.awt.Font;
+
+import javax.swing.BorderFactory;
+import javax.swing.JLabel;
+import javax.swing.JPanel;
+import javax.swing.border.Border;
+import javax.swing.border.EmptyBorder;
+
 import org.apache.jmeter.config.gui.LoginConfigGui;
-import org.apache.jmeter.gui.*;
-import org.apache.jmeter.gui.util.VerticalLayout;
 import org.apache.jmeter.protocol.ftp.config.gui.FtpConfigGui;
-import org.apache.jmeter.protocol.ftp.control.*;
-import org.apache.jmeter.util.JMeterUtils;
+import org.apache.jmeter.protocol.ftp.sampler.FTPSampler;
 import org.apache.jmeter.samplers.gui.AbstractSamplerGui;
 import org.apache.jmeter.testelement.TestElement;
-import org.apache.jmeter.protocol.ftp.sampler.FTPSampler;
+import org.apache.jmeter.util.JMeterUtils;
+import org.apache.jorphan.gui.layout.VerticalLayout;
 
 /****************************************
  * Title: Apache JMeter Description: Copyright: Copyright (c) 2000 Company:
  * Apache Foundation
  *
  *@author    Michael Stover
- *@created   $Date: 2002/08/11 19:24:50 $
+ *@created   $Date: 2002/10/17 19:47:19 $
  *@version   1.0
  ***************************************/
 
diff --git a/jakarta-jmeter/src/protocol/ftp/org/apache/jmeter/protocol/ftp/sampler/CVS/Entries b/jakarta-jmeter/src/protocol/ftp/org/apache/jmeter/protocol/ftp/sampler/CVS/Entries
index 5af43ed..013f866 100644
--- a/jakarta-jmeter/src/protocol/ftp/org/apache/jmeter/protocol/ftp/sampler/CVS/Entries
+++ b/jakarta-jmeter/src/protocol/ftp/org/apache/jmeter/protocol/ftp/sampler/CVS/Entries
@@ -1,3 +1,3 @@
-/FTPSampler.java/1.1/Sun Aug 11 19:24:50 2002//Tv1_7_3
-/FtpClient.java/1.1/Sun Aug 11 19:24:50 2002//Tv1_7_3
+/FTPSampler.java/1.2/Fri Aug 23 22:51:46 2002//Tv1_8_1
+/FtpClient.java/1.3/Thu Aug 29 18:17:41 2002//Tv1_8_1
 D
diff --git a/jakarta-jmeter/src/protocol/ftp/org/apache/jmeter/protocol/ftp/sampler/CVS/Tag b/jakarta-jmeter/src/protocol/ftp/org/apache/jmeter/protocol/ftp/sampler/CVS/Tag
index 5f312fe..e2fda28 100644
--- a/jakarta-jmeter/src/protocol/ftp/org/apache/jmeter/protocol/ftp/sampler/CVS/Tag
+++ b/jakarta-jmeter/src/protocol/ftp/org/apache/jmeter/protocol/ftp/sampler/CVS/Tag
@@ -1 +1 @@
-Nv1_7_3
+Nv1_8_1
diff --git a/jakarta-jmeter/src/protocol/ftp/org/apache/jmeter/protocol/ftp/sampler/FTPSampler.java b/jakarta-jmeter/src/protocol/ftp/org/apache/jmeter/protocol/ftp/sampler/FTPSampler.java
index 8c2d7a8..05cf508 100644
--- a/jakarta-jmeter/src/protocol/ftp/org/apache/jmeter/protocol/ftp/sampler/FTPSampler.java
+++ b/jakarta-jmeter/src/protocol/ftp/org/apache/jmeter/protocol/ftp/sampler/FTPSampler.java
@@ -68,8 +68,8 @@ import org.apache.jmeter.testelement.TestElement;
  *  A sampler which understands FTP file requests
  *
  *@author     $Author: mstover1 $
- *@created    $Date: 2002/08/11 19:24:50 $
- *@version    $Revision: 1.1 $
+ *@created    $Date: 2002/08/23 22:51:46 $
+ *@version    $Revision: 1.2 $
  ***********************************************************/
 
 public class FTPSampler extends AbstractSampler
@@ -157,7 +157,6 @@ public class FTPSampler extends AbstractSampler
 				// set the response code here somewhere
 			ftp.disconnect();
 				isSuccessful = true;
-			//System.out.println(s);
 		}
 		catch (java.net.ConnectException cex)
 		{
diff --git a/jakarta-jmeter/src/protocol/ftp/org/apache/jmeter/protocol/ftp/sampler/FtpClient.java b/jakarta-jmeter/src/protocol/ftp/org/apache/jmeter/protocol/ftp/sampler/FtpClient.java
index 04ab9dd..04acf3d 100644
--- a/jakarta-jmeter/src/protocol/ftp/org/apache/jmeter/protocol/ftp/sampler/FtpClient.java
+++ b/jakarta-jmeter/src/protocol/ftp/org/apache/jmeter/protocol/ftp/sampler/FtpClient.java
@@ -54,8 +54,20 @@
  */
 package org.apache.jmeter.protocol.ftp.sampler;
 
-import java.io.*;
-import java.net.*;
+import java.io.BufferedInputStream;
+import java.io.BufferedReader;
+import java.io.BufferedWriter;
+import java.io.File;
+import java.io.IOException;
+import java.io.InputStream;
+import java.io.InputStreamReader;
+import java.io.OutputStreamWriter;
+import java.net.InetAddress;
+import java.net.ServerSocket;
+import java.net.Socket;
+
+import org.apache.log.Hierarchy;
+import org.apache.log.Logger;
 
 /*
  * Simple FTP client (non-passive transfers don't work yet)
@@ -70,6 +82,8 @@ import java.net.*;
  */
 public class FtpClient
 {
+	transient private static Logger log = Hierarchy.getDefaultHierarchy().getLoggerFor(
+			"jmeter.protocol.ftp");
 	File f = new File("e:\\");
 	BufferedWriter out;
 	BufferedReader in;
@@ -106,15 +120,15 @@ public class FtpClient
 		StringBuffer response = new StringBuffer();
 		String line = in.readLine();
 		response.append(line);
-		//System.out.println("#" + line + "#");
+		log.info("FtpClient.getResponse(): #" + line + "#");
 		while (line.charAt(3) == '-')
 		{
 			line = in.readLine();
 			response.append("\n");
 			response.append(line);
-			//System.out.println("#" + line + "#");
+			log.info("FtpClient.getResponse(): #" + line + "#");
 		}
-		//System.out.println("return response");
+		log.info("return response");
 		return response.toString();
 	}
 
@@ -141,7 +155,7 @@ public class FtpClient
 			int lower = getLower(dataPort);
 			String ip = InetAddress.getLocalHost().getHostAddress().replace('.', ',');
 			String port = ip + "," + upper + "," + lower;
-			System.out.println("port:" + port);
+			log.info("port:" + port);
 			send("PORT " + port);
 			getResponse();
 			dataGrabber grab = new dataGrabber(ip, dataPort);
@@ -150,8 +164,8 @@ public class FtpClient
 			}
 			send("RETR " + file);
 			String response = in.readLine();
-			System.out.println(response);
-			System.out.println(dataPort);
+			log.info(response);
+			log.info(""+dataPort);
 			data = "FTP client - File Not Found";
 			if (!response.startsWith("5"))
 			{
@@ -208,12 +222,8 @@ public class FtpClient
 		
 		InputStreamReader isr = new InputStreamReader(s.getInputStream());
 		in = new BufferedReader(isr);
-		//System.out.println(in.readLine());
 		send("USER " + username);
-		//System.out.println(getResponse());
 		send("PASS " + password);
-		//System.out.println(getResponse());
-		//System.out.println("Done connecting");
 	}
 
 	/**
@@ -228,7 +238,7 @@ public class FtpClient
 		}
 		catch (Exception e)
 		{
-			System.out.println("FTP client - " + e.toString());
+			log.error("FTP client - ",e);
 		}
 		try
 		{
@@ -238,7 +248,7 @@ public class FtpClient
 		}
 		catch (Exception e)
 		{
-			System.out.println("FTP client - " + e.toString());
+			log.error("FTP client - ",e);
 		}
 	}
 
@@ -250,7 +260,6 @@ public class FtpClient
 	 */
 	public void send(String command) throws IOException
 	{
-		//System.out.println("#" + command + "#");
 		for (int i = 0; i < command.length(); i++)
 		{
 			out.write(command.charAt(i));
@@ -366,12 +375,12 @@ public class FtpClient
 				}
 				else
 				{
-					System.out.println("creating socket on " + port);
+					log.info("creating socket on " + port);
 					ServerSocket server = new ServerSocket(port);
-					System.out.println("accepting...");
+					log.info("accepting...");
 					portCreated = true;
 					s = server.accept();
-					System.out.println("accepted");
+					log.info("accepted");
 				}
 			}
 			catch (Exception e)
@@ -393,7 +402,7 @@ public class FtpClient
 			}
 			catch (Exception e)
 			{
-				System.out.println("FTP client: dataGrabber - " + e.toString());
+				log.error("FTP client: dataGrabber",e);
 			}
 			done = true;
 		}
diff --git a/jakarta-jmeter/src/protocol/http/CVS/Tag b/jakarta-jmeter/src/protocol/http/CVS/Tag
index f4b6a59..75ba187 100644
--- a/jakarta-jmeter/src/protocol/http/CVS/Tag
+++ b/jakarta-jmeter/src/protocol/http/CVS/Tag
@@ -1 +1 @@
-Tv1_7_3
+Tv1_8_1
diff --git a/jakarta-jmeter/src/protocol/http/org/CVS/Tag b/jakarta-jmeter/src/protocol/http/org/CVS/Tag
index f4b6a59..75ba187 100644
--- a/jakarta-jmeter/src/protocol/http/org/CVS/Tag
+++ b/jakarta-jmeter/src/protocol/http/org/CVS/Tag
@@ -1 +1 @@
-Tv1_7_3
+Tv1_8_1
diff --git a/jakarta-jmeter/src/protocol/http/org/apache/CVS/Tag b/jakarta-jmeter/src/protocol/http/org/apache/CVS/Tag
index f4b6a59..75ba187 100644
--- a/jakarta-jmeter/src/protocol/http/org/apache/CVS/Tag
+++ b/jakarta-jmeter/src/protocol/http/org/apache/CVS/Tag
@@ -1 +1 @@
-Tv1_7_3
+Tv1_8_1
diff --git a/jakarta-jmeter/src/protocol/http/org/apache/jmeter/CVS/Tag b/jakarta-jmeter/src/protocol/http/org/apache/jmeter/CVS/Tag
index f4b6a59..75ba187 100644
--- a/jakarta-jmeter/src/protocol/http/org/apache/jmeter/CVS/Tag
+++ b/jakarta-jmeter/src/protocol/http/org/apache/jmeter/CVS/Tag
@@ -1 +1 @@
-Tv1_7_3
+Tv1_8_1
diff --git a/jakarta-jmeter/src/protocol/http/org/apache/jmeter/junit/CVS/Tag b/jakarta-jmeter/src/protocol/http/org/apache/jmeter/junit/CVS/Tag
index f4b6a59..75ba187 100644
--- a/jakarta-jmeter/src/protocol/http/org/apache/jmeter/junit/CVS/Tag
+++ b/jakarta-jmeter/src/protocol/http/org/apache/jmeter/junit/CVS/Tag
@@ -1 +1 @@
-Tv1_7_3
+Tv1_8_1
diff --git a/jakarta-jmeter/src/protocol/http/org/apache/jmeter/junit/protocol/CVS/Tag b/jakarta-jmeter/src/protocol/http/org/apache/jmeter/junit/protocol/CVS/Tag
index f4b6a59..75ba187 100644
--- a/jakarta-jmeter/src/protocol/http/org/apache/jmeter/junit/protocol/CVS/Tag
+++ b/jakarta-jmeter/src/protocol/http/org/apache/jmeter/junit/protocol/CVS/Tag
@@ -1 +1 @@
-Tv1_7_3
+Tv1_8_1
diff --git a/jakarta-jmeter/src/protocol/http/org/apache/jmeter/junit/protocol/http/CVS/Tag b/jakarta-jmeter/src/protocol/http/org/apache/jmeter/junit/protocol/http/CVS/Tag
index f4b6a59..75ba187 100644
--- a/jakarta-jmeter/src/protocol/http/org/apache/jmeter/junit/protocol/http/CVS/Tag
+++ b/jakarta-jmeter/src/protocol/http/org/apache/jmeter/junit/protocol/http/CVS/Tag
@@ -1 +1 @@
-Tv1_7_3
+Tv1_8_1
diff --git a/jakarta-jmeter/src/protocol/http/org/apache/jmeter/junit/protocol/http/config/CVS/Entries b/jakarta-jmeter/src/protocol/http/org/apache/jmeter/junit/protocol/http/config/CVS/Entries
index 2e6fb15..3e7b298 100644
--- a/jakarta-jmeter/src/protocol/http/org/apache/jmeter/junit/protocol/http/config/CVS/Entries
+++ b/jakarta-jmeter/src/protocol/http/org/apache/jmeter/junit/protocol/http/config/CVS/Entries
@@ -1,3 +1,3 @@
-/HttpConfigSuite.java/1.1/Sun Aug 11 19:24:50 2002//Tv1_7_3
-/UrlConfigTest.java/1.1/Sun Aug 11 19:24:50 2002//Tv1_7_3
+/HttpConfigSuite.java/1.1/Sun Aug 11 19:24:50 2002//Tv1_8_1
+/UrlConfigTest.java/1.1/Sun Aug 11 19:24:50 2002//Tv1_8_1
 D
diff --git a/jakarta-jmeter/src/protocol/http/org/apache/jmeter/junit/protocol/http/config/CVS/Tag b/jakarta-jmeter/src/protocol/http/org/apache/jmeter/junit/protocol/http/config/CVS/Tag
index 5f312fe..e2fda28 100644
--- a/jakarta-jmeter/src/protocol/http/org/apache/jmeter/junit/protocol/http/config/CVS/Tag
+++ b/jakarta-jmeter/src/protocol/http/org/apache/jmeter/junit/protocol/http/config/CVS/Tag
@@ -1 +1 @@
-Nv1_7_3
+Nv1_8_1
diff --git a/jakarta-jmeter/src/protocol/http/org/apache/jmeter/junit/protocol/http/parser/CVS/Entries b/jakarta-jmeter/src/protocol/http/org/apache/jmeter/junit/protocol/http/parser/CVS/Entries
index 7ccb799..521548a 100644
--- a/jakarta-jmeter/src/protocol/http/org/apache/jmeter/junit/protocol/http/parser/CVS/Entries
+++ b/jakarta-jmeter/src/protocol/http/org/apache/jmeter/junit/protocol/http/parser/CVS/Entries
@@ -1,2 +1,2 @@
-/HtmlParserTester.java/1.1/Sun Aug 11 19:24:50 2002//Tv1_7_3
+/HtmlParserTester.java/1.1/Sun Aug 11 19:24:50 2002//Tv1_8_1
 D
diff --git a/jakarta-jmeter/src/protocol/http/org/apache/jmeter/junit/protocol/http/parser/CVS/Tag b/jakarta-jmeter/src/protocol/http/org/apache/jmeter/junit/protocol/http/parser/CVS/Tag
index 5f312fe..e2fda28 100644
--- a/jakarta-jmeter/src/protocol/http/org/apache/jmeter/junit/protocol/http/parser/CVS/Tag
+++ b/jakarta-jmeter/src/protocol/http/org/apache/jmeter/junit/protocol/http/parser/CVS/Tag
@@ -1 +1 @@
-Nv1_7_3
+Nv1_8_1
diff --git a/jakarta-jmeter/src/protocol/http/org/apache/jmeter/protocol/CVS/Tag b/jakarta-jmeter/src/protocol/http/org/apache/jmeter/protocol/CVS/Tag
index f4b6a59..75ba187 100644
--- a/jakarta-jmeter/src/protocol/http/org/apache/jmeter/protocol/CVS/Tag
+++ b/jakarta-jmeter/src/protocol/http/org/apache/jmeter/protocol/CVS/Tag
@@ -1 +1 @@
-Tv1_7_3
+Tv1_8_1
diff --git a/jakarta-jmeter/src/protocol/http/org/apache/jmeter/protocol/http/CVS/Tag b/jakarta-jmeter/src/protocol/http/org/apache/jmeter/protocol/http/CVS/Tag
index f4b6a59..75ba187 100644
--- a/jakarta-jmeter/src/protocol/http/org/apache/jmeter/protocol/http/CVS/Tag
+++ b/jakarta-jmeter/src/protocol/http/org/apache/jmeter/protocol/http/CVS/Tag
@@ -1 +1 @@
-Tv1_7_3
+Tv1_8_1
diff --git a/jakarta-jmeter/src/protocol/http/org/apache/jmeter/protocol/http/config/CVS/Entries b/jakarta-jmeter/src/protocol/http/org/apache/jmeter/protocol/http/config/CVS/Entries
index 513d426..fdf94d2 100644
--- a/jakarta-jmeter/src/protocol/http/org/apache/jmeter/protocol/http/config/CVS/Entries
+++ b/jakarta-jmeter/src/protocol/http/org/apache/jmeter/protocol/http/config/CVS/Entries
@@ -1,2 +1,2 @@
-/MultipartUrlConfig.java/1.3/Wed Aug 14 02:52:19 2002//Tv1_7_3
+/MultipartUrlConfig.java/1.4/Fri Dec 27 15:51:18 2002//Tv1_8_1
 D/gui////
diff --git a/jakarta-jmeter/src/protocol/http/org/apache/jmeter/protocol/http/config/CVS/Tag b/jakarta-jmeter/src/protocol/http/org/apache/jmeter/protocol/http/config/CVS/Tag
index 5f312fe..e2fda28 100644
--- a/jakarta-jmeter/src/protocol/http/org/apache/jmeter/protocol/http/config/CVS/Tag
+++ b/jakarta-jmeter/src/protocol/http/org/apache/jmeter/protocol/http/config/CVS/Tag
@@ -1 +1 @@
-Nv1_7_3
+Nv1_8_1
diff --git a/jakarta-jmeter/src/protocol/http/org/apache/jmeter/protocol/http/config/MultipartUrlConfig.java b/jakarta-jmeter/src/protocol/http/org/apache/jmeter/protocol/http/config/MultipartUrlConfig.java
index 9e97b94..583a476 100644
--- a/jakarta-jmeter/src/protocol/http/org/apache/jmeter/protocol/http/config/MultipartUrlConfig.java
+++ b/jakarta-jmeter/src/protocol/http/org/apache/jmeter/protocol/http/config/MultipartUrlConfig.java
@@ -60,6 +60,7 @@ import java.io.Serializable;
 import org.apache.jmeter.config.Arguments;
 import org.apache.jmeter.protocol.http.util.HTTPArgument;
 import org.apache.jmeter.util.JMeterUtils;
+import org.apache.jorphan.util.JOrphanUtils;
 
 /**
  * Title:        JMeter
@@ -163,7 +164,7 @@ public class MultipartUrlConfig implements Serializable
 	 */
 	public void parseArguments(String queryString)
 	{
-		String[] parts = JMeterUtils.split(queryString,"--"+getBoundary());
+		String[] parts = JOrphanUtils.split(queryString,"--"+getBoundary());
 		for (int i = 0; i < parts.length; i++)
 		{
 			if(parts[i].indexOf("filename=") > -1)
diff --git a/jakarta-jmeter/src/protocol/http/org/apache/jmeter/protocol/http/config/gui/CVS/Entries b/jakarta-jmeter/src/protocol/http/org/apache/jmeter/protocol/http/config/gui/CVS/Entries
index 4d95beb..da39019 100644
--- a/jakarta-jmeter/src/protocol/http/org/apache/jmeter/protocol/http/config/gui/CVS/Entries
+++ b/jakarta-jmeter/src/protocol/http/org/apache/jmeter/protocol/http/config/gui/CVS/Entries
@@ -1,3 +1,4 @@
-/MultipartUrlConfigGui.java/1.1/Sun Aug 11 19:24:50 2002//Tv1_7_3
-/UrlConfigGui.java/1.2/Wed Aug 14 02:52:19 2002//Tv1_7_3
+/HttpDefaultsGui.java/1.4/Tue Dec 24 11:48:49 2002//Tv1_8_1
+/MultipartUrlConfigGui.java/1.4/Thu Oct 17 19:47:19 2002//Tv1_8_1
+/UrlConfigGui.java/1.5/Tue Dec 24 11:48:49 2002//Tv1_8_1
 D
diff --git a/jakarta-jmeter/src/protocol/http/org/apache/jmeter/protocol/http/config/gui/CVS/Tag b/jakarta-jmeter/src/protocol/http/org/apache/jmeter/protocol/http/config/gui/CVS/Tag
index 5f312fe..e2fda28 100644
--- a/jakarta-jmeter/src/protocol/http/org/apache/jmeter/protocol/http/config/gui/CVS/Tag
+++ b/jakarta-jmeter/src/protocol/http/org/apache/jmeter/protocol/http/config/gui/CVS/Tag
@@ -1 +1 @@
-Nv1_7_3
+Nv1_8_1
diff --git a/jakarta-jmeter/src/protocol/http/org/apache/jmeter/protocol/http/config/gui/HttpDefaultsGui.java b/jakarta-jmeter/src/protocol/http/org/apache/jmeter/protocol/http/config/gui/HttpDefaultsGui.java
new file mode 100644
index 0000000..0c158f0
--- /dev/null
+++ b/jakarta-jmeter/src/protocol/http/org/apache/jmeter/protocol/http/config/gui/HttpDefaultsGui.java
@@ -0,0 +1,99 @@
+package org.apache.jmeter.protocol.http.config.gui;
+import java.awt.BorderLayout;
+import java.awt.Font;
+
+import javax.swing.JLabel;
+import javax.swing.JPanel;
+import javax.swing.border.Border;
+import javax.swing.border.EmptyBorder;
+
+import org.apache.jmeter.config.ConfigTestElement;
+import org.apache.jmeter.config.gui.AbstractConfigGui;
+import org.apache.jmeter.protocol.http.gui.HTTPArgumentsPanel;
+import org.apache.jmeter.protocol.http.sampler.HTTPSampler;
+import org.apache.jmeter.testelement.TestElement;
+import org.apache.jmeter.util.JMeterUtils;
+import org.apache.jorphan.gui.JLabeledTextField;
+import org.apache.jorphan.gui.layout.VerticalLayout;
+/**
+ * @author Administrator
+ *
+ * To change this generated comment edit the template variable "typecomment":
+ * Window>Preferences>Java>Templates.
+ */
+public class HttpDefaultsGui extends AbstractConfigGui
+{
+	JLabeledTextField protocol;
+	JLabeledTextField domain;
+	JLabeledTextField path;
+	JLabeledTextField port;
+	HTTPArgumentsPanel argPanel;
+	
+	public HttpDefaultsGui()
+	{
+		super();
+		init();
+	}
+	
+	/****************************************
+	 * !ToDoo (Method description)
+	 *
+	 *@return   !ToDo (Return description)
+	 ***************************************/
+	public String getStaticLabel()
+	{
+		return JMeterUtils.getResString("url_config_title");
+	}
+	
+	/**
+	 * @see org.apache.jmeter.gui.JMeterGUIComponent#createTestElement()
+	 */
+	public TestElement createTestElement()
+	{
+		ConfigTestElement config = new ConfigTestElement();
+		super.configureTestElement(config);
+		config.setProperty(HTTPSampler.PROTOCOL,protocol.getText());
+		config.setProperty(HTTPSampler.DOMAIN,domain.getText());
+		config.setProperty(HTTPSampler.PATH,path.getText());
+		config.setProperty(HTTPSampler.ARGUMENTS,argPanel.createTestElement());
+		config.setProperty(HTTPSampler.PORT,port.getText());
+		return config;
+	}
+	
+	public void configure(TestElement el)
+	{
+		super.configure(el);
+		protocol.setText(el.getPropertyAsString(HTTPSampler.PROTOCOL));
+		domain.setText(el.getPropertyAsString(HTTPSampler.DOMAIN));
+		path.setText(el.getPropertyAsString(HTTPSampler.PATH));
+		port.setText(el.getPropertyAsString(HTTPSampler.PORT));
+		argPanel.configure((TestElement)el.getProperty(HTTPSampler.ARGUMENTS));
+	}
+	
+	private void init()
+	{
+		Border margin = new EmptyBorder(10, 10, 5, 10);
+		this.setBorder(margin);
+		this.setLayout(new BorderLayout());
+		argPanel = new HTTPArgumentsPanel();
+		this.add(argPanel,BorderLayout.CENTER);
+		protocol = new JLabeledTextField(JMeterUtils.getResString("url_config_protocol"));
+		domain = new JLabeledTextField(JMeterUtils.getResString("web_server_domain"));
+		path = new JLabeledTextField(JMeterUtils.getResString("path"));
+		port = new JLabeledTextField(JMeterUtils.getResString("web_server_port"));
+		JPanel topPanel = new JPanel(new VerticalLayout(5,VerticalLayout.LEFT));
+		JLabel title = new JLabel(JMeterUtils.getResString("url_config_title"));
+		Font curFont = title.getFont();
+		int curFontSize = curFont.getSize();
+		curFontSize += 4;
+		title.setFont(new Font(curFont.getFontName(), curFont.getStyle(), curFontSize));
+		
+		topPanel.add(title);
+		topPanel.add(getNamePanel());
+		topPanel.add(protocol);
+		topPanel.add(domain);
+		topPanel.add(path);
+		topPanel.add(port);
+		this.add(topPanel,BorderLayout.NORTH);
+	}
+}
diff --git a/jakarta-jmeter/src/protocol/http/org/apache/jmeter/protocol/http/config/gui/MultipartUrlConfigGui.java b/jakarta-jmeter/src/protocol/http/org/apache/jmeter/protocol/http/config/gui/MultipartUrlConfigGui.java
index ea16fba..6b8f2d9 100644
--- a/jakarta-jmeter/src/protocol/http/org/apache/jmeter/protocol/http/config/gui/MultipartUrlConfigGui.java
+++ b/jakarta-jmeter/src/protocol/http/org/apache/jmeter/protocol/http/config/gui/MultipartUrlConfigGui.java
@@ -54,12 +54,9 @@
  */
 package org.apache.jmeter.protocol.http.config.gui;
 import java.awt.BorderLayout;
-import java.awt.Font;
 import java.awt.event.ActionEvent;
 import java.awt.event.ActionListener;
-import java.awt.BorderLayout;
 import java.io.File;
-import java.util.Collection;
 
 import javax.swing.BorderFactory;
 import javax.swing.JButton;
@@ -67,20 +64,18 @@ import javax.swing.JFileChooser;
 import javax.swing.JLabel;
 import javax.swing.JPanel;
 import javax.swing.JTextField;
-import javax.swing.border.Border;
-import javax.swing.border.EmptyBorder;
 
 import org.apache.jmeter.gui.util.FileDialoger;
-import org.apache.jmeter.gui.util.VerticalLayout;
 import org.apache.jmeter.protocol.http.sampler.HTTPSampler;
 import org.apache.jmeter.testelement.TestElement;
 import org.apache.jmeter.util.JMeterUtils;
+import org.apache.jorphan.gui.layout.VerticalLayout;
 
 /****************************************
  * Title: JMeter Description: Copyright: Copyright (c) 2000 Company: Apache
  *
  *@author    Michael Stover
- *@created   $Date: 2002/08/11 19:24:50 $
+ *@created   $Date: 2002/10/17 19:47:19 $
  *@version   1.0
  ***************************************/
 
@@ -104,23 +99,7 @@ public class MultipartUrlConfigGui extends UrlConfigGui implements ActionListene
 	 ***************************************/
 	public MultipartUrlConfigGui()
 	{
-		this(true);
-	}
-
-	public Collection getMenuCategories()
-	{
-		return null;
-	}
-
-	/****************************************
-	 * !ToDo (Constructor description)
-	 *
-	 *@param displayName  !ToDo (Parameter description)
-	 ***************************************/
-	public MultipartUrlConfigGui(boolean displayName)
-	{
-		super(displayName);
-		setName(getStaticLabel());
+		super();
 	}
 
 	/****************************************
@@ -223,36 +202,8 @@ public class MultipartUrlConfigGui extends UrlConfigGui implements ActionListene
 		webRequestPanel.add(getFilePanel(),BorderLayout.SOUTH);
 
 		// If displayName is TRUE, then this GUI is not embedded in another GUI.
-		if(displayName)
-		{
-			// MAIN PANEL
-			JPanel mainPanel = new JPanel();
-			Border margin = new EmptyBorder(10, 10, 5, 10);
-			mainPanel.setBorder(margin);
-			mainPanel.setLayout(new BorderLayout());
-
-			// TITLE
-			JLabel panelTitleLabel = new JLabel(JMeterUtils.getResString("url_full_config_title"));
-			Font curFont = panelTitleLabel.getFont();
-			int curFontSize = curFont.getSize();
-			curFontSize += 4;
-			panelTitleLabel.setFont(new Font(curFont.getFontName(), curFont.getStyle(), curFontSize));
-			mainPanel.add(panelTitleLabel);
-
-			// NAME
-			mainPanel.add(getNamePanel());
-
-			mainPanel.add(webServerPanel);
-			mainPanel.add(webRequestPanel);
-
-			this.add(mainPanel);
-		}
-		else
-		{// Embed this GUI in the parent GUI
-
-			this.add(webServerPanel,BorderLayout.NORTH);
-			this.add(webRequestPanel,BorderLayout.CENTER);
-		}
+		this.add(webServerPanel,BorderLayout.NORTH);
+		this.add(webRequestPanel,BorderLayout.CENTER);
 	}
 
 	/****************************************
diff --git a/jakarta-jmeter/src/protocol/http/org/apache/jmeter/protocol/http/config/gui/UrlConfigGui.java b/jakarta-jmeter/src/protocol/http/org/apache/jmeter/protocol/http/config/gui/UrlConfigGui.java
index 6324950..3d0dffd 100644
--- a/jakarta-jmeter/src/protocol/http/org/apache/jmeter/protocol/http/config/gui/UrlConfigGui.java
+++ b/jakarta-jmeter/src/protocol/http/org/apache/jmeter/protocol/http/config/gui/UrlConfigGui.java
@@ -56,7 +56,6 @@ package org.apache.jmeter.protocol.http.config.gui;
 import java.awt.BorderLayout;
 import java.awt.Dimension;
 import java.awt.FlowLayout;
-import java.awt.Font;
 
 import javax.swing.BorderFactory;
 import javax.swing.Box;
@@ -67,14 +66,9 @@ import javax.swing.JLabel;
 import javax.swing.JPanel;
 import javax.swing.JRadioButton;
 import javax.swing.JTextField;
-import javax.swing.border.Border;
-import javax.swing.border.EmptyBorder;
 
 import org.apache.jmeter.config.Arguments;
 import org.apache.jmeter.config.ConfigTestElement;
-import org.apache.jmeter.config.gui.AbstractConfigGui;
-import org.apache.jmeter.config.gui.ArgumentsPanel;
-import org.apache.jmeter.gui.util.VerticalLayout;
 import org.apache.jmeter.protocol.http.gui.HTTPArgumentsPanel;
 import org.apache.jmeter.protocol.http.sampler.HTTPSampler;
 import org.apache.jmeter.protocol.http.util.HTTPArgument;
@@ -86,16 +80,12 @@ import org.apache.jmeter.util.JMeterUtils;
  * Title: JMeter Description: Copyright: Copyright (c) 2000 Company: Apache
  *
  *@author    Michael Stover
- *@created   $Date: 2002/08/14 02:52:19 $
+ *@created   $Date: 2002/12/24 11:48:49 $
  *@version   1.0
  ***************************************/
 
-public class UrlConfigGui extends AbstractConfigGui
+public class UrlConfigGui extends JPanel
 {
-	/****************************************
-	 * !ToDo (Field description)
-	 ***************************************/
-	protected boolean displayName = true;
 
 	/****************************************
 	 * !ToDo (Field description)
@@ -103,24 +93,22 @@ public class UrlConfigGui extends AbstractConfigGui
 	protected HTTPArgumentsPanel argsPanel;
 	private static String DOMAIN = "domain";
 	private static String PORT = "port";
+	private static String PROTOCOL = "protocol";
 	private static String PATH = "path";
 	private static String FOLLOW_REDIRECTS = "follow_redirects";
 	private static String USE_KEEPALIVE = "use_keepalive";
 	private static String POST = "post";
 	private static String GET = "get";
-	private static String HTTP = "http";
-	private static String HTTPS = "https";
 	private static String SEND_PARAM = "sendparam";
 
 	private JTextField domain;
 	private JTextField port;
+	private JTextField protocol;
 	private JTextField path;
 	private JCheckBox followRedirects;
 	private JCheckBox useKeepAlive;
 	private JRadioButton post;
 	private JRadioButton get;
-	private JRadioButton http;
-	private JRadioButton https;
 
 
 	/****************************************
@@ -128,29 +116,15 @@ public class UrlConfigGui extends AbstractConfigGui
 	 ***************************************/
 	public UrlConfigGui()
 	{
-		this(true);
-	}
-
-	/****************************************
-	 * !ToDo (Constructor description)
-	 *
-	 *@param display  !ToDo (Parameter description)
-	 ***************************************/
-	public UrlConfigGui(boolean display)
-	{
-		displayName = display;
 		init();
-		setName(getStaticLabel());
 	}
 
-	/****************************************
-	 * !ToDoo (Method description)
-	 *
-	 *@return   !ToDo (Return description)
-	 ***************************************/
-	public String getStaticLabel()
+
+	  protected void configureTestElement(TestElement mc)
 	{
-		return JMeterUtils.getResString("url_config_title");
+		mc.setProperty(TestElement.NAME, getName());
+		mc.setProperty(TestElement.GUI_CLASS, this.getClass().getName());
+		mc.setProperty(TestElement.TEST_CLASS, mc.getClass().getName());
 	}
 
 	/****************************************
@@ -167,11 +141,11 @@ public class UrlConfigGui extends AbstractConfigGui
 		element.setProperty(HTTPSampler.ARGUMENTS, args);
 		element.setProperty(HTTPSampler.DOMAIN, domain.getText());
 		element.setProperty(HTTPSampler.PORT, port.getText());
+		element.setProperty(HTTPSampler.PROTOCOL, protocol.getText());
 		element.setProperty(HTTPSampler.METHOD, (post.isSelected() ? "POST" : "GET"));
 		element.setProperty(HTTPSampler.PATH, path.getText());
 		element.setProperty(HTTPSampler.FOLLOW_REDIRECTS, new Boolean(followRedirects.isSelected()));
 		element.setProperty(HTTPSampler.USE_KEEPALIVE, new Boolean(useKeepAlive.isSelected()));
-		element.setProperty(HTTPSampler.PROTOCOL, (http.isSelected() ? "http" : "https"));
 		return element;
 	}
 
@@ -179,6 +153,7 @@ public class UrlConfigGui extends AbstractConfigGui
 	{
 		sampler.setArguments((Arguments)argsPanel.createTestElement());
 		sampler.setDomain(domain.getText());
+		sampler.setProtocol(protocol.getText());
 		sampler.setPath(path.getText());
 		sampler.setFollowRedirects(followRedirects.isSelected());
 		sampler.setUseKeepAlive(useKeepAlive.isSelected());
@@ -187,7 +162,6 @@ public class UrlConfigGui extends AbstractConfigGui
 			sampler.setPort(Integer.parseInt(port.getText()));
 		}
 		sampler.setMethod((post.isSelected() ? "POST" : "GET"));
-		sampler.setProtocol((http.isSelected() ? "http" : "https"));
 	}
 
 	/****************************************
@@ -201,6 +175,7 @@ public class UrlConfigGui extends AbstractConfigGui
 		argsPanel.configure((TestElement)el.getProperty(HTTPSampler.ARGUMENTS));
 		domain.setText((String)el.getProperty(HTTPSampler.DOMAIN));
 		port.setText((String)el.getPropertyAsString(HTTPSampler.PORT));
+		protocol.setText((String)el.getProperty(HTTPSampler.PROTOCOL));
 		if("POST".equals(el.getProperty(HTTPSampler.METHOD)))
 		{
 			post.setSelected(true);
@@ -214,16 +189,6 @@ public class UrlConfigGui extends AbstractConfigGui
 		path.setText((String)el.getProperty(HTTPSampler.PATH));
 		followRedirects.setSelected(((AbstractTestElement)el).getPropertyAsBoolean(HTTPSampler.FOLLOW_REDIRECTS));
 		useKeepAlive.setSelected(((AbstractTestElement)el).getPropertyAsBoolean(HTTPSampler.USE_KEEPALIVE));
-		if("http".equals(el.getProperty(HTTPSampler.PROTOCOL)))
-		{
-			http.setSelected(true);
-			https.setSelected(false);
-		}
-		else
-		{
-			https.setSelected(true);
-			http.setSelected(false);
-		}
 	}
 
 	/****************************************
@@ -248,40 +213,8 @@ public class UrlConfigGui extends AbstractConfigGui
 		webRequestPanel.add(northPanel,BorderLayout.NORTH);
 		webRequestPanel.add(getParameterPanel(),BorderLayout.CENTER);
 
-		if(displayName)
-		{
-			// MAIN PANEL
-			JPanel mainPanel = new JPanel();
-			Border margin = new EmptyBorder(10, 10, 5, 10);
-			mainPanel.setBorder(margin);
-			mainPanel.setLayout(new BorderLayout());
-			JPanel normalPanel = new JPanel(new VerticalLayout(5,VerticalLayout.LEFT));
-
-			// TITLE
-			JLabel panelTitleLabel = new JLabel(JMeterUtils.getResString("url_config_title"));
-			Font curFont = panelTitleLabel.getFont();
-			int curFontSize = curFont.getSize();
-			curFontSize += 4;
-			panelTitleLabel.setFont(new Font(curFont.getFontName(), curFont.getStyle(), curFontSize));
-			normalPanel.add(panelTitleLabel);
-
-			// NAME
-			if(displayName)
-			{
-				normalPanel.add(getNamePanel());
-			}
-
-			normalPanel.add(webServerPanel);
-			mainPanel.add(normalPanel,BorderLayout.NORTH);
-			mainPanel.add(webRequestPanel,BorderLayout.CENTER);
-
-			this.add(mainPanel,BorderLayout.CENTER);
-		}
-		else
-		{
-			this.add(webServerPanel,BorderLayout.NORTH);
-			this.add(webRequestPanel,BorderLayout.CENTER);
-		}
+		this.add(webServerPanel,BorderLayout.NORTH);
+		this.add(webRequestPanel,BorderLayout.CENTER);
 	}
 
 	/****************************************
@@ -361,26 +294,14 @@ public class UrlConfigGui extends AbstractConfigGui
 	 ***************************************/
 	protected JPanel getProtocolAndMethodPanel()
 	{
-		JPanel panel = new JPanel();
-		panel.setLayout(new BoxLayout(panel, BoxLayout.X_AXIS));
-		panel.setBorder(BorderFactory.createEmptyBorder(0, 10, 0, 10));
-
-		panel.add(new JLabel(JMeterUtils.getResString("protocol")));
-		panel.add(Box.createRigidArea(new Dimension(5, 0)));
+		JPanel panel = new JPanel(new FlowLayout(FlowLayout.LEFT));
+		panel.setBorder(BorderFactory.createEmptyBorder(0, 5, 0, 10));
 
 		// PROTOCOL
-		http = new JRadioButton(JMeterUtils.getResString("url_config_http"));
-		https = new JRadioButton(JMeterUtils.getResString("url_config_https"));
-		ButtonGroup protocolButtonGroup = new ButtonGroup();
-		protocolButtonGroup.add(http);
-		protocolButtonGroup.add(https);
-
-		http.setSelected(true);
-
-		panel.add(http);
-		panel.add(https);
-
-		panel.add(Box.createRigidArea(new Dimension(20, 0)));
+		panel.add(new JLabel(JMeterUtils.getResString("protocol")));
+		protocol = new JTextField(4);
+		protocol.setName(PROTOCOL);
+		panel.add(protocol);
 
 		// METHOD
 		post = new JRadioButton(JMeterUtils.getResString("url_config_post"));
@@ -389,8 +310,8 @@ public class UrlConfigGui extends AbstractConfigGui
 		methodButtonGroup.add(post);
 		methodButtonGroup.add(get);
 
-		panel.add(new JLabel(JMeterUtils.getResString("method")));
 		panel.add(Box.createRigidArea(new Dimension(5, 0)));
+		panel.add(new JLabel(JMeterUtils.getResString("method")));
 
 		post.setSelected(true);
 
diff --git a/jakarta-jmeter/src/protocol/http/org/apache/jmeter/protocol/http/control/AuthManager.java b/jakarta-jmeter/src/protocol/http/org/apache/jmeter/protocol/http/control/AuthManager.java
index 9109e94..07ed08f 100644
--- a/jakarta-jmeter/src/protocol/http/org/apache/jmeter/protocol/http/control/AuthManager.java
+++ b/jakarta-jmeter/src/protocol/http/org/apache/jmeter/protocol/http/control/AuthManager.java
@@ -68,8 +68,8 @@ import java.util.List;
 import java.util.StringTokenizer;
 
 import org.apache.jmeter.config.ConfigElement;
+import org.apache.jmeter.config.ConfigTestElement;
 import org.apache.jmeter.protocol.http.util.Base64Encoder;
-import org.apache.jmeter.testelement.AbstractTestElement;
 import org.apache.jmeter.testelement.TestElement;
 import org.apache.jmeter.util.JMeterUtils;
 
@@ -80,10 +80,10 @@ import org.apache.jmeter.util.JMeterUtils;
  *
  *@author    <a href="mailto:luta.raphael@networks.vivendi.com">Raphaël Luta
  *      </a>
- *@created   $Date: 2002/08/11 19:24:51 $
+ *@created   $Date: 2002/08/20 01:55:24 $
  *@version   0.9
  ***************************************/
-public class AuthManager extends AbstractTestElement implements ConfigElement,
+public class AuthManager extends ConfigTestElement implements ConfigElement,
 		Serializable
 {
 	private final static String AUTH_LIST = "AuthManager.auth_list";
diff --git a/jakarta-jmeter/src/protocol/http/org/apache/jmeter/protocol/http/control/CVS/Entries b/jakarta-jmeter/src/protocol/http/org/apache/jmeter/protocol/http/control/CVS/Entries
index bdcc436..8aedb59 100644
--- a/jakarta-jmeter/src/protocol/http/org/apache/jmeter/protocol/http/control/CVS/Entries
+++ b/jakarta-jmeter/src/protocol/http/org/apache/jmeter/protocol/http/control/CVS/Entries
@@ -1,7 +1,7 @@
-/AuthManager.java/1.1/Sun Aug 11 19:24:51 2002//Tv1_7_3
-/Authorization.java/1.1/Sun Aug 11 19:24:51 2002//Tv1_7_3
-/Cookie.java/1.1/Sun Aug 11 19:24:51 2002//Tv1_7_3
-/CookieManager.java/1.1/Sun Aug 11 19:24:51 2002//Tv1_7_3
-/Header.java/1.1/Sun Aug 11 19:24:51 2002//Tv1_7_3
-/HeaderManager.java/1.1/Sun Aug 11 19:24:51 2002//Tv1_7_3
+/AuthManager.java/1.2/Tue Aug 20 01:55:24 2002//Tv1_8_1
+/Authorization.java/1.1/Sun Aug 11 19:24:51 2002//Tv1_8_1
+/Cookie.java/1.3/Thu Aug 29 18:17:41 2002//Tv1_8_1
+/CookieManager.java/1.5/Fri Sep 20 19:44:40 2002//Tv1_8_1
+/Header.java/1.1/Sun Aug 11 19:24:51 2002//Tv1_8_1
+/HeaderManager.java/1.2/Tue Aug 20 01:55:24 2002//Tv1_8_1
 D/gui////
diff --git a/jakarta-jmeter/src/protocol/http/org/apache/jmeter/protocol/http/control/CVS/Tag b/jakarta-jmeter/src/protocol/http/org/apache/jmeter/protocol/http/control/CVS/Tag
index 5f312fe..e2fda28 100644
--- a/jakarta-jmeter/src/protocol/http/org/apache/jmeter/protocol/http/control/CVS/Tag
+++ b/jakarta-jmeter/src/protocol/http/org/apache/jmeter/protocol/http/control/CVS/Tag
@@ -1 +1 @@
-Nv1_7_3
+Nv1_8_1
diff --git a/jakarta-jmeter/src/protocol/http/org/apache/jmeter/protocol/http/control/Cookie.java b/jakarta-jmeter/src/protocol/http/org/apache/jmeter/protocol/http/control/Cookie.java
index 3034d8a..76880a9 100644
--- a/jakarta-jmeter/src/protocol/http/org/apache/jmeter/protocol/http/control/Cookie.java
+++ b/jakarta-jmeter/src/protocol/http/org/apache/jmeter/protocol/http/control/Cookie.java
@@ -55,20 +55,12 @@
 
 package org.apache.jmeter.protocol.http.control;
 
-import java.io.*;
-import java.net.URL;
-import java.text.DateFormat;
-import java.text.ParseException;
-import java.text.SimpleDateFormat;
-import java.util.Date;
-import java.util.Enumeration;
-import java.util.Hashtable;
-import java.util.Properties;
-import java.util.StringTokenizer;
-import java.util.Vector;
-
-import org.apache.jmeter.config.*;
+import java.io.Serializable;
+
+import org.apache.jmeter.config.ConfigElement;
 import org.apache.jmeter.testelement.AbstractTestElement;
+import org.apache.log.Hierarchy;
+import org.apache.log.Logger;
 
 /**
  * This class is a Cookie encapsulator.
@@ -77,7 +69,8 @@ import org.apache.jmeter.testelement.AbstractTestElement;
  */
 public class Cookie extends AbstractTestElement implements Serializable
 {
-
+	transient private static Logger log = Hierarchy.getDefaultHierarchy().getLoggerFor(
+			"jmeter.protocol.http");
 	 private static String NAME = "Cookie.name";
 	 private static String VALUE = "Cookie.value";
 	 private static String DOMAIN = "Cookie.domain";
@@ -188,7 +181,7 @@ public class Cookie extends AbstractTestElement implements Serializable
 	  * get the secure for this object.
 	  */
 	 public boolean getSecure() {
-	 	System.out.println("Secure = "+getProperty(SECURE));
+	 	log.info("Secure = "+getProperty(SECURE));
 		return this.getPropertyAsBoolean(SECURE);
 	 }
 
diff --git a/jakarta-jmeter/src/protocol/http/org/apache/jmeter/protocol/http/control/CookieManager.java b/jakarta-jmeter/src/protocol/http/org/apache/jmeter/protocol/http/control/CookieManager.java
index 8c325b0..df296e7 100644
--- a/jakarta-jmeter/src/protocol/http/org/apache/jmeter/protocol/http/control/CookieManager.java
+++ b/jakarta-jmeter/src/protocol/http/org/apache/jmeter/protocol/http/control/CookieManager.java
@@ -76,20 +76,24 @@ import java.util.StringTokenizer;
 import java.util.TimeZone;
 import java.util.Vector;
 
-import org.apache.jmeter.testelement.AbstractTestElement;
+import org.apache.jmeter.config.ConfigTestElement;
 import org.apache.jmeter.testelement.PerThreadClonable;
 import org.apache.jmeter.util.JMeterUtils;
+import org.apache.log.Hierarchy;
+import org.apache.log.Logger;
 
 /**
  * This class provides an interface to the netscape cookies file to
  * pass cookies along with a request.
  *
  * @author  <a href="mailto:sdowd@arcmail.com">Sean Dowd</a>
- * @version $Revision: 1.1 $ $Date: 2002/08/11 19:24:51 $
+ * @version $Revision: 1.5 $ $Date: 2002/09/20 19:44:40 $
  */
-public class CookieManager extends AbstractTestElement implements
+public class CookieManager extends ConfigTestElement implements
 		  Serializable,PerThreadClonable
 {
+	transient private static Logger log = Hierarchy.getDefaultHierarchy().getLoggerFor(
+			"jmeter.protocol.http");
 
 	 public static final String COOKIES = "CookieManager.cookies";
 	  /**
@@ -232,7 +236,7 @@ public class CookieManager extends AbstractTestElement implements
 				// a Date. So, I chose 0. The Date will appear as
 				// the beginning of the Epoch (Jan 1, 1970 00:00:00 GMT)
 				time = 0;
-				System.out.println("DateFormat.ParseException: " + e.getMessage());
+				log.error("DateFormat.ParseException: ",e);
 		  }
 
 		  return time;
@@ -264,7 +268,6 @@ public class CookieManager extends AbstractTestElement implements
 	  }
 
 	  public void addCookieFromHeader(String cookieHeader, URL url) {
-		  //System.out.println("inside addCookieFromHeader: " + cookieHeader + " " + url);
 			 StringTokenizer st = new StringTokenizer(cookieHeader, ";");
 			 String nvp;
 
@@ -274,12 +277,7 @@ public class CookieManager extends AbstractTestElement implements
 			 String name = nvp.substring(0,index);
 			 String value = nvp.substring(index+1);
 			 String domain = url.getHost();
-			 String path = url.getFile();
-
-		  //System.out.println(name);
-		  //System.out.println(value);
-		  //System.out.println(domain);
-		  //System.out.println(path);
+			 String path = "/";
 
 			 Cookie newCookie = new Cookie(name, value, domain, path, false,
 							System.currentTimeMillis() + 1000 * 60 * 60 * 24);
@@ -298,8 +296,6 @@ public class CookieManager extends AbstractTestElement implements
 								  String expires = nvp.substring(index+1);
 								  Date date = dateFormat.parse(expires);
 								  newCookie.setExpires(date.getTime());
-								//System.out.println("set expires to " + date.getTime());
-								//System.out.println("current time: " + (System.currentTimeMillis());
 							} catch (ParseException pe) {}
 					 } else if (key.equalsIgnoreCase("domain")) {
 							newCookie.setDomain(nvp.substring(index+1));
@@ -318,20 +314,17 @@ public class CookieManager extends AbstractTestElement implements
 					 if (cookie.getPath().equals(newCookie.getPath()) &&
 								  cookie.getDomain().equals(newCookie.getDomain()) &&
 								  cookie.getName().equals(newCookie.getName())) {
-						  //System.out.println("remove cookie #" + i);
 							removeIndices.addElement(new Integer(i));
 					 }
 			 }
 
 			 for (Enumeration e = removeIndices.elements(); e.hasMoreElements();) {
 					 index = ((Integer) e.nextElement()).intValue();
-					 //System.out.println("remove cookie index " + index);
 					 getCookies().remove(index);
 			 }
 
 			 if (newCookie.getExpires() >= System.currentTimeMillis())
 			 {
-				//System.out.println("cookie expiration is future so add it");
 					 getCookies().add(newCookie);
 			 }
 	  }
diff --git a/jakarta-jmeter/src/protocol/http/org/apache/jmeter/protocol/http/control/HeaderManager.java b/jakarta-jmeter/src/protocol/http/org/apache/jmeter/protocol/http/control/HeaderManager.java
index cbdb534..dd4a3a3 100644
--- a/jakarta-jmeter/src/protocol/http/org/apache/jmeter/protocol/http/control/HeaderManager.java
+++ b/jakarta-jmeter/src/protocol/http/org/apache/jmeter/protocol/http/control/HeaderManager.java
@@ -58,26 +58,27 @@ import java.io.BufferedReader;
 import java.io.File;
 import java.io.FileReader;
 import java.io.FileWriter;
-import java.net.URL;
-import java.text.DateFormat;
-import java.text.ParseException;
-import java.text.SimpleDateFormat;
-import java.util.*;
-import java.io.*;
-import javax.swing.table.AbstractTableModel;
-
-import org.apache.jmeter.config.*;
+import java.io.IOException;
+import java.io.PrintWriter;
+import java.io.Serializable;
+import java.util.ArrayList;
+import java.util.Enumeration;
+import java.util.LinkedList;
+import java.util.List;
+import java.util.StringTokenizer;
+import java.util.Vector;
+
+import org.apache.jmeter.config.ConfigTestElement;
 import org.apache.jmeter.util.JMeterUtils;
-import org.apache.jmeter.testelement.AbstractTestElement;
 
 /**
  * This class provides an interface to headers file to
  * pass HTTP headers along with a request.
  *
  * @author  <a href="mailto:giacomo@apache.org">Giacomo Pati</a>
- * @version $Revision: 1.1 $ $Date: 2002/08/11 19:24:51 $
+ * @version $Revision: 1.2 $ $Date: 2002/08/20 01:55:24 $
  */
-public class HeaderManager extends AbstractTestElement implements
+public class HeaderManager extends ConfigTestElement implements
 		Serializable
 {
 
diff --git a/jakarta-jmeter/src/protocol/http/org/apache/jmeter/protocol/http/control/gui/CVS/Entries b/jakarta-jmeter/src/protocol/http/org/apache/jmeter/protocol/http/control/gui/CVS/Entries
index 2fce733..15b0644 100644
--- a/jakarta-jmeter/src/protocol/http/org/apache/jmeter/protocol/http/control/gui/CVS/Entries
+++ b/jakarta-jmeter/src/protocol/http/org/apache/jmeter/protocol/http/control/gui/CVS/Entries
@@ -1,3 +1,4 @@
-/HttpTestSampleGui.java/1.1/Sun Aug 11 19:24:51 2002//Tv1_7_3
-/SoapSamplerGui.java/1.1/Sun Aug 11 19:24:51 2002//Tv1_7_3
+/HttpTestSampleGui.java/1.4/Thu Oct 17 19:47:19 2002//Tv1_8_1
+/RecordController.java/1.2/Sun Dec 29 18:05:19 2002//Tv1_8_1
+/SoapSamplerGui.java/1.3/Thu Oct 17 19:47:19 2002//Tv1_8_1
 D
diff --git a/jakarta-jmeter/src/protocol/http/org/apache/jmeter/protocol/http/control/gui/CVS/Tag b/jakarta-jmeter/src/protocol/http/org/apache/jmeter/protocol/http/control/gui/CVS/Tag
index 5f312fe..e2fda28 100644
--- a/jakarta-jmeter/src/protocol/http/org/apache/jmeter/protocol/http/control/gui/CVS/Tag
+++ b/jakarta-jmeter/src/protocol/http/org/apache/jmeter/protocol/http/control/gui/CVS/Tag
@@ -1 +1 @@
-Nv1_7_3
+Nv1_8_1
diff --git a/jakarta-jmeter/src/protocol/http/org/apache/jmeter/protocol/http/control/gui/HttpTestSampleGui.java b/jakarta-jmeter/src/protocol/http/org/apache/jmeter/protocol/http/control/gui/HttpTestSampleGui.java
index 136fc51..27f4d86 100644
--- a/jakarta-jmeter/src/protocol/http/org/apache/jmeter/protocol/http/control/gui/HttpTestSampleGui.java
+++ b/jakarta-jmeter/src/protocol/http/org/apache/jmeter/protocol/http/control/gui/HttpTestSampleGui.java
@@ -53,25 +53,32 @@
  * <http://www.apache.org/>.
  */
 package org.apache.jmeter.protocol.http.control.gui;
-import java.awt.*;
-import java.awt.event.*;
-import java.util.*;
-import javax.swing.*;
-import javax.swing.border.*;
-import org.apache.jmeter.gui.*;
-import org.apache.jmeter.gui.util.VerticalLayout;
+import java.awt.BorderLayout;
+import java.awt.Font;
+import java.awt.GridLayout;
+
+import javax.swing.BorderFactory;
+import javax.swing.BoxLayout;
+import javax.swing.JCheckBox;
+import javax.swing.JLabel;
+import javax.swing.JPanel;
+import javax.swing.border.Border;
+import javax.swing.border.EmptyBorder;
+
 import org.apache.jmeter.protocol.http.config.gui.MultipartUrlConfigGui;
 import org.apache.jmeter.protocol.http.config.gui.UrlConfigGui;
-import org.apache.jmeter.protocol.http.sampler.*;
+import org.apache.jmeter.protocol.http.sampler.HTTPSampler;
+import org.apache.jmeter.protocol.http.sampler.HTTPSamplerFull;
 import org.apache.jmeter.samplers.gui.AbstractSamplerGui;
 import org.apache.jmeter.testelement.TestElement;
 import org.apache.jmeter.util.JMeterUtils;
+import org.apache.jorphan.gui.layout.VerticalLayout;
 
 /****************************************
  * Title: JMeter Description: Copyright: Copyright (c) 2000 Company: Apache
  *
  *@author    Michael Stover
- *@created   $Date: 2002/08/11 19:24:51 $
+ *@created   $Date: 2002/10/17 19:47:19 $
  *@version   1.0
  ***************************************/
 
@@ -164,7 +171,7 @@ public class HttpTestSampleGui extends AbstractSamplerGui
 		mainPanel.add(titlePanel,BorderLayout.NORTH);
 
 		// URL CONFIG
-		urlConfigGui = new MultipartUrlConfigGui(false);
+		urlConfigGui = new MultipartUrlConfigGui();
 		mainPanel.add(urlConfigGui,BorderLayout.CENTER);
 
 		// OPTIONAL TASKS
diff --git a/jakarta-jmeter/src/protocol/http/org/apache/jmeter/protocol/http/control/gui/RecordController.java b/jakarta-jmeter/src/protocol/http/org/apache/jmeter/protocol/http/control/gui/RecordController.java
new file mode 100644
index 0000000..b634e34
--- /dev/null
+++ b/jakarta-jmeter/src/protocol/http/org/apache/jmeter/protocol/http/control/gui/RecordController.java
@@ -0,0 +1,19 @@
+package org.apache.jmeter.protocol.http.control.gui;
+
+import org.apache.jmeter.util.JMeterUtils;
+import org.apache.jmeter.control.gui.LogicControllerGui;
+
+/**
+ * @author Administrator
+ *
+ * To change this generated comment edit the template variable "typecomment":
+ * Window>Preferences>Java>Templates.
+ */
+public class RecordController extends LogicControllerGui
+{
+	
+	public String getStaticLabel()
+	{
+		return JMeterUtils.getResString("record_controller_title");
+	}
+}
diff --git a/jakarta-jmeter/src/protocol/http/org/apache/jmeter/protocol/http/control/gui/SoapSamplerGui.java b/jakarta-jmeter/src/protocol/http/org/apache/jmeter/protocol/http/control/gui/SoapSamplerGui.java
index 126503d..7b6f4e9 100644
--- a/jakarta-jmeter/src/protocol/http/org/apache/jmeter/protocol/http/control/gui/SoapSamplerGui.java
+++ b/jakarta-jmeter/src/protocol/http/org/apache/jmeter/protocol/http/control/gui/SoapSamplerGui.java
@@ -8,13 +8,14 @@ import javax.swing.JLabel;
 import javax.swing.JPanel;
 import javax.swing.border.Border;
 import javax.swing.border.EmptyBorder;
-import org.apache.jmeter.gui.util.JLabeledTextArea;
-import org.apache.jmeter.gui.util.JLabeledTextField;
-import org.apache.jmeter.gui.util.VerticalLayout;
+
 import org.apache.jmeter.protocol.http.sampler.SoapSampler;
 import org.apache.jmeter.samplers.gui.AbstractSamplerGui;
 import org.apache.jmeter.testelement.TestElement;
 import org.apache.jmeter.util.JMeterUtils;
+import org.apache.jorphan.gui.JLabeledTextArea;
+import org.apache.jorphan.gui.JLabeledTextField;
+import org.apache.jorphan.gui.layout.VerticalLayout;
 
 /**
  * @author mstover
diff --git a/jakarta-jmeter/src/protocol/http/org/apache/jmeter/protocol/http/gui/AuthPanel.java b/jakarta-jmeter/src/protocol/http/org/apache/jmeter/protocol/http/gui/AuthPanel.java
index 00046e3..eb273a3 100644
--- a/jakarta-jmeter/src/protocol/http/org/apache/jmeter/protocol/http/gui/AuthPanel.java
+++ b/jakarta-jmeter/src/protocol/http/org/apache/jmeter/protocol/http/gui/AuthPanel.java
@@ -53,19 +53,42 @@
  * <http://www.apache.org/>.
  */
 package org.apache.jmeter.protocol.http.gui;
-import java.awt.*;
-import java.awt.event.*;
-import java.io.*;
-import javax.swing.*;
-import javax.swing.border.*;
-import javax.swing.table.*;
+import java.awt.Component;
+import java.awt.Dimension;
+import java.awt.Font;
+import java.awt.event.ActionEvent;
+import java.awt.event.ActionListener;
+import java.io.File;
+import java.io.IOException;
+
+import javax.swing.BorderFactory;
+import javax.swing.Box;
+import javax.swing.DefaultCellEditor;
+import javax.swing.JButton;
+import javax.swing.JLabel;
+import javax.swing.JPanel;
+import javax.swing.JPasswordField;
+import javax.swing.JScrollPane;
+import javax.swing.JTable;
+import javax.swing.ListSelectionModel;
+import javax.swing.border.Border;
+import javax.swing.border.CompoundBorder;
+import javax.swing.border.EmptyBorder;
+import javax.swing.table.AbstractTableModel;
+import javax.swing.table.JTableHeader;
+import javax.swing.table.TableCellEditor;
+import javax.swing.table.TableCellRenderer;
+import javax.swing.table.TableColumn;
+
 import org.apache.jmeter.config.gui.AbstractConfigGui;
-import org.apache.jmeter.gui.*;
 import org.apache.jmeter.gui.util.FileDialoger;
-import org.apache.jmeter.gui.util.VerticalLayout;
-import org.apache.jmeter.protocol.http.control.*;
+import org.apache.jmeter.protocol.http.control.AuthManager;
+import org.apache.jmeter.protocol.http.control.Authorization;
 import org.apache.jmeter.testelement.TestElement;
 import org.apache.jmeter.util.JMeterUtils;
+import org.apache.log.Hierarchy;
+import org.apache.log.Logger;
+import org.apache.jorphan.gui.layout.VerticalLayout;
 
 /****************************************
  * Handles input for determining if authentication services are required for a
@@ -73,12 +96,13 @@ import org.apache.jmeter.util.JMeterUtils;
  * user selects.
  *
  *@author    $Author: mstover1 $
- *@created   $Date: 2002/08/11 19:24:51 $
- *@version   $Revision: 1.1 $
+ *@created   $Date: 2002/10/17 19:47:19 $
+ *@version   $Revision: 1.5 $
  ***************************************/
 public class AuthPanel extends AbstractConfigGui implements ActionListener
 {
-
+	transient private static Logger log = Hierarchy.getDefaultHierarchy().getLoggerFor(
+			"jmeter.protocol.http");
 	InnerTableModel tableModel;
 
 	/****************************************
@@ -260,7 +284,7 @@ public class AuthPanel extends AbstractConfigGui implements ActionListener
 			}
 			catch(IOException ex)
 			{
-				ex.printStackTrace();
+				log.error("",ex);
 			}
 			catch(NullPointerException err){}
 		}
@@ -276,7 +300,7 @@ public class AuthPanel extends AbstractConfigGui implements ActionListener
 			}
 			catch(IOException ex)
 			{
-				ex.printStackTrace();
+				log.error("",ex);
 			}
 			catch(NullPointerException err){}
 		}
@@ -375,8 +399,8 @@ public class AuthPanel extends AbstractConfigGui implements ActionListener
 	 * !ToDo (Class description)
 	 *
 	 *@author    $Author: mstover1 $
-	 *@created   $Date: 2002/08/11 19:24:51 $
-	 *@version   $Revision: 1.1 $
+	 *@created   $Date: 2002/10/17 19:47:19 $
+	 *@version   $Revision: 1.5 $
 	 ***************************************/
 	private class InnerTableModel extends AbstractTableModel
 	{
@@ -529,8 +553,8 @@ public class AuthPanel extends AbstractConfigGui implements ActionListener
 	 * !ToDo (Class description)
 	 *
 	 *@author    $Author: mstover1 $
-	 *@created   $Date: 2002/08/11 19:24:51 $
-	 *@version   $Revision: 1.1 $
+	 *@created   $Date: 2002/10/17 19:47:19 $
+	 *@version   $Revision: 1.5 $
 	 ***************************************/
 	private class PasswordCellRenderer extends JPasswordField implements TableCellRenderer
 	{
diff --git a/jakarta-jmeter/src/protocol/http/org/apache/jmeter/protocol/http/gui/CVS/Entries b/jakarta-jmeter/src/protocol/http/org/apache/jmeter/protocol/http/gui/CVS/Entries
index f9514e1..214ef37 100644
--- a/jakarta-jmeter/src/protocol/http/org/apache/jmeter/protocol/http/gui/CVS/Entries
+++ b/jakarta-jmeter/src/protocol/http/org/apache/jmeter/protocol/http/gui/CVS/Entries
@@ -1,5 +1,5 @@
-/AuthPanel.java/1.1/Sun Aug 11 19:24:51 2002//Tv1_7_3
-/CookiePanel.java/1.1/Sun Aug 11 19:24:51 2002//Tv1_7_3
-/HTTPArgumentsPanel.java/1.3/Fri Aug 16 12:58:52 2002//Tv1_7_3
-/HeaderPanel.java/1.2/Wed Aug 14 16:38:04 2002//Tv1_7_3
+/AuthPanel.java/1.5/Thu Oct 17 19:47:19 2002//Tv1_8_1
+/CookiePanel.java/1.5/Thu Oct 17 19:47:19 2002//Tv1_8_1
+/HTTPArgumentsPanel.java/1.6/Thu Oct 17 19:47:19 2002//Tv1_8_1
+/HeaderPanel.java/1.6/Thu Oct 17 19:47:19 2002//Tv1_8_1
 D
diff --git a/jakarta-jmeter/src/protocol/http/org/apache/jmeter/protocol/http/gui/CVS/Tag b/jakarta-jmeter/src/protocol/http/org/apache/jmeter/protocol/http/gui/CVS/Tag
index 5f312fe..e2fda28 100644
--- a/jakarta-jmeter/src/protocol/http/org/apache/jmeter/protocol/http/gui/CVS/Tag
+++ b/jakarta-jmeter/src/protocol/http/org/apache/jmeter/protocol/http/gui/CVS/Tag
@@ -1 +1 @@
-Nv1_7_3
+Nv1_8_1
diff --git a/jakarta-jmeter/src/protocol/http/org/apache/jmeter/protocol/http/gui/CookiePanel.java b/jakarta-jmeter/src/protocol/http/org/apache/jmeter/protocol/http/gui/CookiePanel.java
index 8fd3063..6442964 100644
--- a/jakarta-jmeter/src/protocol/http/org/apache/jmeter/protocol/http/gui/CookiePanel.java
+++ b/jakarta-jmeter/src/protocol/http/org/apache/jmeter/protocol/http/gui/CookiePanel.java
@@ -77,26 +77,30 @@ import javax.swing.border.CompoundBorder;
 import javax.swing.border.EmptyBorder;
 import javax.swing.table.JTableHeader;
 import javax.swing.table.TableCellEditor;
+
 import org.apache.jmeter.config.gui.AbstractConfigGui;
 import org.apache.jmeter.gui.util.FileDialoger;
 import org.apache.jmeter.gui.util.PowerTableModel;
-import org.apache.jmeter.gui.util.TextAreaTableCellEditor;
-import org.apache.jmeter.gui.util.VerticalLayout;
 import org.apache.jmeter.protocol.http.control.Cookie;
 import org.apache.jmeter.protocol.http.control.CookieManager;
 import org.apache.jmeter.testelement.TestElement;
 import org.apache.jmeter.util.JMeterUtils;
+import org.apache.log.Hierarchy;
+import org.apache.log.Logger;
+import org.apache.jorphan.gui.layout.VerticalLayout;
 
 /****************************************
  * Allows the user to specify if she needs cookie services, and give parameters
  * for this service.
  *
  *@author    $Author: mstover1 $
- *@created   $Date: 2002/08/11 19:24:51 $
- *@version   $Revision: 1.1 $
+ *@created   $Date: 2002/10/17 19:47:19 $
+ *@version   $Revision: 1.5 $
  ***************************************/
 public class CookiePanel extends AbstractConfigGui implements ActionListener
 {
+	transient private static Logger log = Hierarchy.getDefaultHierarchy().getLoggerFor(
+			"jmeter.protocol.http");
 	private final static int columnCount = 6;
 	private final static String[] columnNames = {
 		 JMeterUtils.getResString("name"),
@@ -238,7 +242,7 @@ public class CookiePanel extends AbstractConfigGui implements ActionListener
 			}
 			catch(IOException ex)
 			{
-				ex.printStackTrace();
+				log.error("",ex);
 			}
 			catch(NullPointerException err){}
 		}
@@ -254,7 +258,7 @@ public class CookiePanel extends AbstractConfigGui implements ActionListener
 			}
 			catch(IOException ex)
 			{
-				ex.printStackTrace();
+				log.error("",ex);
 			}
 			catch(NullPointerException err){}
 		}
diff --git a/jakarta-jmeter/src/protocol/http/org/apache/jmeter/protocol/http/gui/HTTPArgumentsPanel.java b/jakarta-jmeter/src/protocol/http/org/apache/jmeter/protocol/http/gui/HTTPArgumentsPanel.java
index 79a6969..f6fcd7e 100644
--- a/jakarta-jmeter/src/protocol/http/org/apache/jmeter/protocol/http/gui/HTTPArgumentsPanel.java
+++ b/jakarta-jmeter/src/protocol/http/org/apache/jmeter/protocol/http/gui/HTTPArgumentsPanel.java
@@ -1,20 +1,14 @@
 package org.apache.jmeter.protocol.http.gui;
 
-import java.awt.event.FocusEvent;
-import java.net.URLEncoder;
 import java.util.Iterator;
 
-import javax.swing.event.ChangeEvent;
-import javax.swing.table.TableCellEditor;
-
 import org.apache.jmeter.config.Arguments;
 import org.apache.jmeter.config.gui.ArgumentsPanel;
 import org.apache.jmeter.gui.util.PowerTableModel;
-import org.apache.jmeter.gui.util.TextAreaTableCellEditor;
 import org.apache.jmeter.protocol.http.util.HTTPArgument;
 import org.apache.jmeter.testelement.TestElement;
-import org.apache.jmeter.util.Data;
 import org.apache.jmeter.util.JMeterUtils;
+import org.apache.jorphan.collections.Data;
 
 /**
  * @author Administrator
@@ -58,9 +52,10 @@ public class HTTPArgumentsPanel extends ArgumentsPanel {
 			}
 			else
 			{
-				HTTPArgument arg = new HTTPArgument((String)model.getColumnValue(Arguments.COLUMN_NAMES[0]),
-						model.getColumnValue(Arguments.COLUMN_NAMES[1]),true);
+				HTTPArgument arg = new HTTPArgument();
 				arg.setAlwaysEncode(false);
+				arg.setName((String)model.getColumnValue(Arguments.COLUMN_NAMES[0]));
+				arg.setValue(model.getColumnValue(Arguments.COLUMN_NAMES[1]));
 				args.addArgument(arg);
 			}
 		}
diff --git a/jakarta-jmeter/src/protocol/http/org/apache/jmeter/protocol/http/gui/HeaderPanel.java b/jakarta-jmeter/src/protocol/http/org/apache/jmeter/protocol/http/gui/HeaderPanel.java
index 37f33eb..010ab8e 100644
--- a/jakarta-jmeter/src/protocol/http/org/apache/jmeter/protocol/http/gui/HeaderPanel.java
+++ b/jakarta-jmeter/src/protocol/http/org/apache/jmeter/protocol/http/gui/HeaderPanel.java
@@ -83,23 +83,26 @@ import javax.swing.table.TableCellEditor;
 
 import org.apache.jmeter.config.gui.AbstractConfigGui;
 import org.apache.jmeter.gui.util.FileDialoger;
-import org.apache.jmeter.gui.util.VerticalLayout;
 import org.apache.jmeter.protocol.http.control.Header;
 import org.apache.jmeter.protocol.http.control.HeaderManager;
 import org.apache.jmeter.testelement.TestElement;
 import org.apache.jmeter.util.JMeterUtils;
+import org.apache.log.Hierarchy;
+import org.apache.log.Logger;
+import org.apache.jorphan.gui.layout.VerticalLayout;
 
 /****************************************
  * Allows the user to specify if she needs HTTP header services, and give
  * parameters for this service.
  *
  *@author    $Author: mstover1 $
- *@created   $Date: 2002/08/14 16:38:04 $
- *@version   $Revision: 1.2 $
+ *@created   $Date: 2002/10/17 19:47:19 $
+ *@version   $Revision: 1.6 $
  ***************************************/
 public class HeaderPanel extends AbstractConfigGui implements ActionListener,FocusListener
 {
-
+	transient private static Logger log = Hierarchy.getDefaultHierarchy().getLoggerFor(
+			"jmeter.protocol.http");
 	InnerTableModel tableModel;
 
 	/****************************************
@@ -291,7 +294,7 @@ public class HeaderPanel extends AbstractConfigGui implements ActionListener,Foc
 			}
 			catch(IOException ex)
 			{
-				ex.printStackTrace();
+				log.error("",ex);
 			}
 			catch(NullPointerException err){}
 		}
@@ -307,7 +310,7 @@ public class HeaderPanel extends AbstractConfigGui implements ActionListener,Foc
 			}
 			catch(IOException ex)
 			{
-				ex.printStackTrace();
+				log.error("",ex);
 			}
 			catch(NullPointerException err){}
 		}
@@ -403,8 +406,8 @@ public class HeaderPanel extends AbstractConfigGui implements ActionListener,Foc
 	 * Updates a header record
 	 *
 	 *@author    $Author: mstover1 $
-	 *@created   $Date: 2002/08/14 16:38:04 $
-	 *@version   $Revision: 1.2 $
+	 *@created   $Date: 2002/10/17 19:47:19 $
+	 *@version   $Revision: 1.6 $
 	 ***************************************/
 	class HeaderUpdater implements ActionListener
 	{
@@ -572,8 +575,8 @@ public class HeaderPanel extends AbstractConfigGui implements ActionListener,Foc
 	 * !ToDo (Class description)
 	 *
 	 *@author    $Author: mstover1 $
-	 *@created   $Date: 2002/08/14 16:38:04 $
-	 *@version   $Revision: 1.2 $
+	 *@created   $Date: 2002/10/17 19:47:19 $
+	 *@version   $Revision: 1.6 $
 	 ***************************************/
 	private class InnerTableModel extends AbstractTableModel
 	{
diff --git a/jakarta-jmeter/src/protocol/http/org/apache/jmeter/protocol/http/modifier/AnchorModifier.java b/jakarta-jmeter/src/protocol/http/org/apache/jmeter/protocol/http/modifier/AnchorModifier.java
index 4110276..1071d85 100644
--- a/jakarta-jmeter/src/protocol/http/org/apache/jmeter/protocol/http/modifier/AnchorModifier.java
+++ b/jakarta-jmeter/src/protocol/http/org/apache/jmeter/protocol/http/modifier/AnchorModifier.java
@@ -54,38 +54,46 @@
  */
 package org.apache.jmeter.protocol.http.modifier;
 
-import org.apache.jmeter.config.ResponseBasedModifier;
+import java.io.Serializable;
+import java.io.UnsupportedEncodingException;
+import java.net.MalformedURLException;
+import java.util.ArrayList;
+import java.util.Iterator;
+import java.util.LinkedList;
+import java.util.List;
+import java.util.Random;
+
+import org.apache.jmeter.config.Argument;
+import org.apache.jmeter.config.Arguments;
 import org.apache.jmeter.config.ConfigElement;
-import org.apache.jmeter.samplers.Entry;
+import org.apache.jmeter.config.ResponseBasedModifier;
 import org.apache.jmeter.protocol.http.parser.HtmlParser;
 import org.apache.jmeter.protocol.http.sampler.HTTPSampler;
 import org.apache.jmeter.samplers.SampleResult;
 import org.apache.jmeter.samplers.Sampler;
-import org.apache.jmeter.config.Argument;
-import org.apache.jmeter.config.Arguments;
-import org.apache.jmeter.gui.NamePanel;
-import org.apache.jmeter.util.JMeterUtils;
-
-import java.util.*;
-import java.io.*;
-import org.w3c.dom.*;
-import org.xml.sax.SAXException;
-import java.net.*;
 import org.apache.jmeter.testelement.AbstractTestElement;
+import org.apache.log.Hierarchy;
+import org.apache.log.Logger;
+import org.w3c.dom.Document;
+import org.w3c.dom.NamedNodeMap;
+import org.w3c.dom.Node;
+import org.w3c.dom.NodeList;
+import org.xml.sax.SAXException;
 
 /************************************************************
  *  Title: Jakarta-JMeter Description: Copyright: Copyright (c) 2001 Company:
  *  Apache
  *
  *@author     Michael Stover
- *@created    $Date: 2002/08/11 19:24:51 $
+ *@created    $Date: 2002/08/29 18:17:41 $
  *@version    1.0
  ***********************************************************/
 
 public class AnchorModifier extends AbstractTestElement implements ResponseBasedModifier,
 		Serializable
 {
-
+	transient private static Logger log = Hierarchy.getDefaultHierarchy().getLoggerFor(
+			"jmeter.protocol.http");
 	private static Random rand = new Random();
 
 	/************************************************************
@@ -176,7 +184,7 @@ public class AnchorModifier extends AbstractTestElement implements ResponseBased
 				}
 			}
 			catch (Exception ex) {
-				ex.printStackTrace();
+				log.error("",ex);
 			}
 		}
 		if(possibleReplacements.size() > 0)
@@ -221,7 +229,7 @@ public class AnchorModifier extends AbstractTestElement implements ResponseBased
 			}
 			catch (org.apache.oro.text.regex.MalformedPatternException e)
 			{
-				System.out.println("Bad pattern");
+				log.error("Bad pattern",e);
 			}
 		}
 	}
@@ -253,7 +261,7 @@ public class AnchorModifier extends AbstractTestElement implements ResponseBased
 			}
 			catch (org.apache.oro.text.regex.MalformedPatternException e)
 			{
-				System.out.println("Bad pattern");
+				log.error("Bad pattern",e);
 			}
 		}
 	}
diff --git a/jakarta-jmeter/src/protocol/http/org/apache/jmeter/protocol/http/modifier/CVS/Entries b/jakarta-jmeter/src/protocol/http/org/apache/jmeter/protocol/http/modifier/CVS/Entries
index b320874..11bc05d 100644
--- a/jakarta-jmeter/src/protocol/http/org/apache/jmeter/protocol/http/modifier/CVS/Entries
+++ b/jakarta-jmeter/src/protocol/http/org/apache/jmeter/protocol/http/modifier/CVS/Entries
@@ -1,10 +1,10 @@
-/AnchorModifier.java/1.1/Sun Aug 11 19:24:51 2002//Tv1_7_3
-/ParamMask.java/1.1/Sun Aug 11 19:24:51 2002//Tv1_7_3
-/ParamModifier.java/1.1/Sun Aug 11 19:24:51 2002//Tv1_7_3
-/URLRewritingModifier.java/1.1/Sun Aug 11 19:24:51 2002//Tv1_7_3
-/UserParameterModifier.java/1.1/Sun Aug 11 19:24:51 2002//Tv1_7_3
-/UserParameterXMLContentHandler.java/1.1/Sun Aug 11 19:24:51 2002//Tv1_7_3
-/UserParameterXMLErrorHandler.java/1.1/Sun Aug 11 19:24:51 2002//Tv1_7_3
-/UserParameterXMLParser.java/1.1/Sun Aug 11 19:24:51 2002//Tv1_7_3
-/UserSequence.java/1.1/Sun Aug 11 19:24:51 2002//Tv1_7_3
+/AnchorModifier.java/1.3/Thu Aug 29 18:17:41 2002//Tv1_8_1
+/ParamMask.java/1.1/Sun Aug 11 19:24:51 2002//Tv1_8_1
+/ParamModifier.java/1.2/Mon Oct 21 17:02:29 2002//Tv1_8_1
+/URLRewritingModifier.java/1.6/Wed Oct 16 00:38:41 2002//Tv1_8_1
+/UserParameterModifier.java/1.3/Thu Aug 29 18:17:41 2002//Tv1_8_1
+/UserParameterXMLContentHandler.java/1.1/Sun Aug 11 19:24:51 2002//Tv1_8_1
+/UserParameterXMLErrorHandler.java/1.3/Thu Aug 29 18:17:41 2002//Tv1_8_1
+/UserParameterXMLParser.java/1.1/Sun Aug 11 19:24:51 2002//Tv1_8_1
+/UserSequence.java/1.3/Thu Aug 29 18:17:41 2002//Tv1_8_1
 D/gui////
diff --git a/jakarta-jmeter/src/protocol/http/org/apache/jmeter/protocol/http/modifier/CVS/Tag b/jakarta-jmeter/src/protocol/http/org/apache/jmeter/protocol/http/modifier/CVS/Tag
index 5f312fe..e2fda28 100644
--- a/jakarta-jmeter/src/protocol/http/org/apache/jmeter/protocol/http/modifier/CVS/Tag
+++ b/jakarta-jmeter/src/protocol/http/org/apache/jmeter/protocol/http/modifier/CVS/Tag
@@ -1 +1 @@
-Nv1_7_3
+Nv1_8_1
diff --git a/jakarta-jmeter/src/protocol/http/org/apache/jmeter/protocol/http/modifier/ParamModifier.java b/jakarta-jmeter/src/protocol/http/org/apache/jmeter/protocol/http/modifier/ParamModifier.java
index 1f9d448..9749551 100644
--- a/jakarta-jmeter/src/protocol/http/org/apache/jmeter/protocol/http/modifier/ParamModifier.java
+++ b/jakarta-jmeter/src/protocol/http/org/apache/jmeter/protocol/http/modifier/ParamModifier.java
@@ -1,14 +1,14 @@
 package org.apache.jmeter.protocol.http.modifier;
 
-import org.apache.jmeter.testelement.AbstractTestElement;
-import org.apache.jmeter.samplers.Entry;
-import org.apache.jmeter.config.Modifier;
+import java.io.Serializable;
+import java.util.Iterator;
+
 import org.apache.jmeter.config.Argument;
-import org.apache.jmeter.samplers.Sampler;
+import org.apache.jmeter.config.Modifier;
 import org.apache.jmeter.protocol.http.sampler.HTTPSampler;
-
-import java.io.Serializable;
-import java.util.*;
+import org.apache.jmeter.samplers.Sampler;
+import org.apache.jmeter.testelement.AbstractTestElement;
+import org.apache.jmeter.testelement.TestListener;
 
 /**
  *  <P>
@@ -34,7 +34,7 @@ import java.util.*;
  *@created    Jan 18, 2002
  *@see        ParamMask
  */
-public class ParamModifier extends AbstractTestElement implements Modifier, Serializable
+public class ParamModifier extends AbstractTestElement implements TestListener,Modifier, Serializable
 {
 
 	/*
@@ -65,6 +65,24 @@ public class ParamModifier extends AbstractTestElement implements Modifier, Seri
 	{
 		return (ParamMask)getProperty(MASK);
 	}
+	
+	public void testStarted()
+	{
+		getMask().resetValue();
+	}
+	
+	public void testStarted(String host)
+	{
+		getMask().resetValue();
+	}
+	
+	public void testEnded()
+	{
+	}
+	
+	public void testEnded(String host)
+	{
+	}	
 
 	/*
 	 *  ----------------------------------------------------------------------------------------------
diff --git a/jakarta-jmeter/src/protocol/http/org/apache/jmeter/protocol/http/modifier/URLRewritingModifier.java b/jakarta-jmeter/src/protocol/http/org/apache/jmeter/protocol/http/modifier/URLRewritingModifier.java
index 4f83a4e..3c9b855 100644
--- a/jakarta-jmeter/src/protocol/http/org/apache/jmeter/protocol/http/modifier/URLRewritingModifier.java
+++ b/jakarta-jmeter/src/protocol/http/org/apache/jmeter/protocol/http/modifier/URLRewritingModifier.java
@@ -1,9 +1,6 @@
 package org.apache.jmeter.protocol.http.modifier;
-
 import java.io.Serializable;
-
 import junit.framework.TestCase;
-
 import org.apache.jmeter.config.Argument;
 import org.apache.jmeter.config.Arguments;
 import org.apache.jmeter.config.ResponseBasedModifier;
@@ -12,12 +9,13 @@ import org.apache.jmeter.protocol.http.util.HTTPArgument;
 import org.apache.jmeter.samplers.SampleResult;
 import org.apache.jmeter.samplers.Sampler;
 import org.apache.jmeter.testelement.AbstractTestElement;
+import org.apache.log.Hierarchy;
+import org.apache.log.Logger;
 import org.apache.oro.text.regex.MalformedPatternException;
 import org.apache.oro.text.regex.MatchResult;
 import org.apache.oro.text.regex.Pattern;
 import org.apache.oro.text.regex.Perl5Compiler;
 import org.apache.oro.text.regex.Perl5Matcher;
-
 /**
  * @author mstover
  *
@@ -26,85 +24,100 @@ import org.apache.oro.text.regex.Perl5Matcher;
  */
 public class URLRewritingModifier
 	extends AbstractTestElement
-	implements Serializable, ResponseBasedModifier {
-		
-		private Pattern case1,case2,case3;
-		Perl5Compiler compiler = new Perl5Compiler();
-
+	implements Serializable, ResponseBasedModifier
+{
+	transient private static Logger log =
+		Hierarchy.getDefaultHierarchy().getLoggerFor("jmeter.protocol.http");
+	private Pattern case1, case2, case3;
+	transient Perl5Compiler compiler = new Perl5Compiler();
 	private final static String ARGUMENT_NAME = "argument_name";
 	private final static String PATH_EXTENSION = "path_extension";
-	
 	/**
 	 * @see ResponseBasedModifier#modifyEntry(Sampler, SampleResult)
 	 */
-	public boolean modifyEntry(Sampler sampler, SampleResult responseText) {
+	public boolean modifyEntry(Sampler sampler, SampleResult responseText)
+	{
+		if(case1 == null)
+		{
+			initRegex(getArgumentName());
+		}
 		String text = new String(responseText.getResponseData());
-		
 		Perl5Matcher matcher = new Perl5Matcher();
 		String value = "";
-		if(matcher.contains(text,case1))
+		if (matcher.contains(text, case1))
 		{
 			MatchResult result = matcher.getMatch();
 			value = result.group(1);
 		}
-		else if(matcher.contains(text,case2))
+		else if (matcher.contains(text, case2))
 		{
 			MatchResult result = matcher.getMatch();
 			value = result.group(1);
 		}
-		else if(matcher.contains(text,case3))
+		else if (matcher.contains(text, case3))
 		{
 			MatchResult result = matcher.getMatch();
 			value = result.group(1);
 		}
-		modify((HTTPSampler)sampler,value);		
-		if(value.length() > 0)
+		modify((HTTPSampler) sampler, value);
+		if (value.length() > 0)
 		{
 			return true;
 		}
 		return false;
 	}
-	
-	private void modify(HTTPSampler sampler,String value)
+	private void modify(HTTPSampler sampler, String value)
 	{
-		if(isPathExtension())
+		if (isPathExtension())
 		{
-			sampler.setPath(sampler.getPath()+";"+getArgumentName()+"="+value);
+			sampler.setPath(
+				sampler.getPath() + ";" + getArgumentName() + "=" + value);
 		}
 		else
 		{
 			sampler.getArguments().removeArgument(getArgumentName());
-			sampler.getArguments().addArgument(new HTTPArgument(getArgumentName(),value,true));
+			sampler.getArguments().addArgument(
+				new HTTPArgument(getArgumentName(), value, true));
 		}
 	}
-	
 	public void setArgumentName(String argName)
 	{
-		setProperty(ARGUMENT_NAME,argName);
-		try {
-			case1 = compiler.compile(argName+"=([^\">& \n\r]*)[& \\n\\r\">]?$?");
-			case2 = compiler.compile("[Nn][Aa][Mm][Ee]=\""+argName+"\"[^>]+[vV][Aa][Ll][Uu][Ee]=\"(.*)\"");
-			case3 = compiler.compile("[vV][Aa][Ll][Uu][Ee]=\"(.*)\"[^>]+[Nn][Aa][Mm][Ee]=\""+argName+"\"");
-		} catch(MalformedPatternException e) {
-			e.printStackTrace();
+		setProperty(ARGUMENT_NAME, argName);
+		case1 = case2 = case3 = null;
+	}
+	private void initRegex(String argName)
+	{
+		try
+		{
+			case1 = compiler.compile(argName + "=([^\"'>& \n\r]*)[& \\n\\r\"'>]?$?");
+			case2 =
+				compiler.compile(
+					"[Nn][Aa][Mm][Ee]=\""
+						+ argName
+						+ "\"[^>]+[vV][Aa][Ll][Uu][Ee]=\"([^\"]*)\"");
+			case3 =
+				compiler.compile(
+					"[vV][Aa][Ll][Uu][Ee]=\"([^\"]*)\"[^>]+[Nn][Aa][Mm][Ee]=\""
+						+ argName
+						+ "\"");
+		}
+		catch (MalformedPatternException e)
+		{
+			log.error("", e);
 		}
 	}
-	
 	public String getArgumentName()
 	{
 		return getPropertyAsString(ARGUMENT_NAME);
 	}
-	
 	public void setPathExtension(boolean pathExt)
 	{
-		setProperty(PATH_EXTENSION,new Boolean(pathExt));
+		setProperty(PATH_EXTENSION, new Boolean(pathExt));
 	}
-	
 	public boolean isPathExtension()
 	{
 		return getPropertyAsBoolean(PATH_EXTENSION);
 	}
-	
 	public static class Test extends TestCase
 	{
 		SampleResult response;
@@ -112,15 +125,13 @@ public class URLRewritingModifier
 		{
 			super(name);
 		}
-		
 		public void setUp()
 		{
-			
 		}
-		
 		public void testGrabSessionId() throws Exception
 		{
-			String html = "location: http://server.com/index.html?session_id=jfdkjdkf%jddkfdfjkdjfdf";
+			String html =
+				"location: http://server.com/index.html?session_id=jfdkjdkf%jddkfdfjkdjfdf";
 			response = new SampleResult();
 			response.setResponseData(html.getBytes());
 			URLRewritingModifier mod = new URLRewritingModifier();
@@ -130,16 +141,40 @@ public class URLRewritingModifier
 			sampler.setPath("index.html");
 			sampler.setMethod(HTTPSampler.GET);
 			sampler.setProtocol("http");
-			sampler.addArgument("session_id","adfasdfdsafasdfasd");
-			mod.modifyEntry(sampler,response);
+			sampler.addArgument("session_id", "adfasdfdsafasdfasd");
+			mod.modifyEntry(sampler, response);
 			Arguments args = sampler.getArguments();
-			assertEquals("jfdkjdkf%jddkfdfjkdjfdf",((Argument)args.getArguments().get(0)).getValue());
-			assertEquals("http://server.com:80/index.html?session_id=jfdkjdkf%jddkfdfjkdjfdf",sampler.toString());
+			assertEquals(
+				"jfdkjdkf%jddkfdfjkdjfdf",
+				((Argument) args.getArguments().get(0)).getValue());
+			assertEquals(
+				"http://server.com:80/index.html?session_id=jfdkjdkf%jddkfdfjkdjfdf",
+				sampler.toString());
 		}
-		
 		public void testGrabSessionId2() throws Exception
 		{
-			String html = "<a href=\"http://server.com/index.html?session_id=jfdkjdkfjddkfdfjkdjfdf\">";
+			String html =
+				"<a href=\"http://server.com/index.html?session_id=jfdkjdkfjddkfdfjkdjfdf\">";
+			response = new SampleResult();
+			response.setResponseData(html.getBytes());
+			URLRewritingModifier mod = new URLRewritingModifier();
+			mod.setArgumentName("session_id");
+			HTTPSampler sampler = new HTTPSampler();
+			sampler.setDomain("server.com");
+			sampler.setPath("index.html");
+			sampler.setMethod(HTTPSampler.GET);
+			sampler.setProtocol("http");
+			mod.modifyEntry(sampler, response);
+			Arguments args = sampler.getArguments();
+			assertEquals(
+				"jfdkjdkfjddkfdfjkdjfdf",
+				((Argument) args.getArguments().get(0)).getValue());
+		}
+		
+		public void testGrabSessionId3() throws Exception
+		{
+			String html =
+				"href='index.html?session_id=jfdkjdkfjddkfdfjkdjfdf'";
 			response = new SampleResult();
 			response.setResponseData(html.getBytes());
 			URLRewritingModifier mod = new URLRewritingModifier();
@@ -149,10 +184,11 @@ public class URLRewritingModifier
 			sampler.setPath("index.html");
 			sampler.setMethod(HTTPSampler.GET);
 			sampler.setProtocol("http");
-			mod.modifyEntry(sampler,response);
+			mod.modifyEntry(sampler, response);
 			Arguments args = sampler.getArguments();
-			assertEquals("jfdkjdkfjddkfdfjkdjfdf",((Argument)args.getArguments().get(0)).getValue());
+			assertEquals(
+				"jfdkjdkfjddkfdfjkdjfdf",
+				((Argument) args.getArguments().get(0)).getValue());
 		}
 	}
-
 }
diff --git a/jakarta-jmeter/src/protocol/http/org/apache/jmeter/protocol/http/modifier/UserParameterModifier.java b/jakarta-jmeter/src/protocol/http/org/apache/jmeter/protocol/http/modifier/UserParameterModifier.java
index 137cd37..11f59c5 100644
--- a/jakarta-jmeter/src/protocol/http/org/apache/jmeter/protocol/http/modifier/UserParameterModifier.java
+++ b/jakarta-jmeter/src/protocol/http/org/apache/jmeter/protocol/http/modifier/UserParameterModifier.java
@@ -53,26 +53,19 @@
  * <http://www.apache.org/>.
  */
 package org.apache.jmeter.protocol.http.modifier;
+import java.io.Serializable;
+import java.util.Iterator;
+import java.util.LinkedList;
+import java.util.List;
+import java.util.Map;
+import org.apache.jmeter.config.Argument;
+import org.apache.jmeter.config.ConfigTestElement;
 import org.apache.jmeter.config.Modifier;
-import org.apache.jmeter.config.ConfigElement;
-import org.apache.jmeter.samplers.Entry;
-import org.apache.jmeter.protocol.http.parser.HtmlParser;
 import org.apache.jmeter.protocol.http.sampler.HTTPSampler;
-import org.apache.jmeter.samplers.SampleResult;
 import org.apache.jmeter.samplers.Sampler;
-import org.apache.jmeter.config.Argument;
-import org.apache.jmeter.config.Arguments;
-import org.apache.jmeter.gui.NamePanel;
-import org.apache.jmeter.util.JMeterUtils;
-import java.util.*;
-import java.io.*;
-import org.w3c.dom.*;
-import org.xml.sax.SAXException;
-import java.net.*;
-import org.apache.jmeter.config.ConfigTestElement;
 import org.apache.jmeter.testelement.TestListener;
-import org.apache.jmeter.samplers.Sampler;
-import org.apache.jmeter.protocol.http.sampler.HTTPSampler;
+import org.apache.log.Hierarchy;
+import org.apache.log.Logger;
 /************************************************************
  *  Title: Jakarta-JMeter Description: Copyright: Copyright (c) 2001 Company:
  *  Apache
@@ -83,12 +76,15 @@ import org.apache.jmeter.protocol.http.sampler.HTTPSampler;
  *<P>For example if userid and password are defined in the XML parameter file
  * for each user (ie thread), then simulated multiple user activity can occur
  *@author     Mark Walsh
- *@created    $Date: 2002/08/11 19:24:51 $
+ *@created    $Date: 2002/08/29 18:17:41 $
  *@version    1.0
  ***********************************************************/
 public class UserParameterModifier
 	extends ConfigTestElement
-	implements Modifier, Serializable, TestListener {
+	implements Modifier, Serializable, TestListener
+{
+	transient private static Logger log =
+		Hierarchy.getDefaultHierarchy().getLoggerFor("jmeter.protocol.http");
 	private static final String XMLURI = "UserParameterModifier.xmluri";
 	//-------------------------------------------
 	// Constants and Data Members
@@ -100,7 +96,9 @@ public class UserParameterModifier
 	/**
 	 * Default constructor
 	 */
-	public UserParameterModifier() {} //end constructor
+	public UserParameterModifier()
+	{
+	} //end constructor
 	//-------------------------------------------
 	// Methods
 	//-------------------------------------------
@@ -111,36 +109,35 @@ public class UserParameterModifier
 	 * Runs before the start of every test. Reload the Sequencer with the
 	 * latest parameter data for each user
 	 */
-	public void testStarted() {
+	public void testStarted()
+	{
 		// try to populate allUsers, if fail, leave as any empty set
 		List allUsers = new LinkedList();
-		try {
+		try
+		{
 			UserParameterXMLParser readXMLParameters = new UserParameterXMLParser();
 			allUsers = readXMLParameters.getXMLParameters(getXmlUri());
 		}
-		catch (Exception e) {
-			e.printStackTrace();
+		catch (Exception e)
+		{
 			// do nothing, now object allUsers contains an empty set
-			System.err.println("Unable to read parameters from xml file " + getXmlUri());
-			System.err.println(
-				"No unique values for http requests will be substituted for each thread");
+			log.error("Unable to read parameters from xml file " + getXmlUri());
+			log.error(
+				"No unique values for http requests will be substituted for each thread",
+				e);
 		}
 		allAvailableUsers = new UserSequence(allUsers);
 	}
-	
 	public void testEnded()
 	{
 	}
-	
 	public void testStarted(String host)
 	{
 		testStarted();
 	}
-	
 	public void testEnded(String host)
 	{
 	}
-	
 	/*----------------------------------------------------------------------------------------------
 	 * Methods implemented from interface org.apache.jmeter.config.Modifier
 	 *--------------------------------------------------------------------------------------------*/
@@ -151,21 +148,24 @@ public class UserParameterModifier
 	 * @param entry Entry object containing information about the current test
 	 * @return <code>True</code> if modified, else <code>false</code>
 	 */
-	public boolean modifyEntry(Sampler entry) {
-		if(!(entry instanceof HTTPSampler))
+	public boolean modifyEntry(Sampler entry)
+	{
+		if (!(entry instanceof HTTPSampler))
 		{
 			return false;
 		}
-		HTTPSampler config = (HTTPSampler)entry;
+		HTTPSampler config = (HTTPSampler) entry;
 		Map currentUser = allAvailableUsers.getNextUserMods();
 		boolean changeValue = false;
 		Iterator iter = config.getArguments().iterator();
-		while (iter.hasNext()) {
+		while (iter.hasNext())
+		{
 			Argument arg = (Argument) iter.next();
 			// if parameter name exists in http request
 			// then change its value
 			// (Note: each jmeter thread (ie user) gets to have unique values)			
-			if (currentUser.containsKey(arg.getName())) {
+			if (currentUser.containsKey(arg.getName()))
+			{
 				arg.setValue(currentUser.get(arg.getName()));
 			}
 		}
@@ -178,14 +178,16 @@ public class UserParameterModifier
 	 * return the current XML file name to be read to obtain the parameter data for all users
 	 * @return the name of the XML file containing parameter data for each user
 	 */
-	public String getXmlUri() {
+	public String getXmlUri()
+	{
 		return this.getPropertyAsString(XMLURI);
 	}
 	/**
 	 * From the GUI screen, set file name of XML to read
 	 * @param the name of the XML file containing the HTTP name value pair parameters per user
 	 */
-	public void setXmlUri(String xmlURI) {
-		setProperty(XMLURI,xmlURI);
+	public void setXmlUri(String xmlURI)
+	{
+		setProperty(XMLURI, xmlURI);
 	}
 }
\ No newline at end of file
diff --git a/jakarta-jmeter/src/protocol/http/org/apache/jmeter/protocol/http/modifier/UserParameterXMLErrorHandler.java b/jakarta-jmeter/src/protocol/http/org/apache/jmeter/protocol/http/modifier/UserParameterXMLErrorHandler.java
index 4e47b20..bdf2da5 100644
--- a/jakarta-jmeter/src/protocol/http/org/apache/jmeter/protocol/http/modifier/UserParameterXMLErrorHandler.java
+++ b/jakarta-jmeter/src/protocol/http/org/apache/jmeter/protocol/http/modifier/UserParameterXMLErrorHandler.java
@@ -53,65 +53,72 @@
  * <http://www.apache.org/>.
  */
 package org.apache.jmeter.protocol.http.modifier;
-
-import org.xml.sax.*;
-import java.util.*;
-import java.io.*;
-
+import org.apache.log.Hierarchy;
+import org.apache.log.Logger;
+import org.xml.sax.ErrorHandler;
+import org.xml.sax.SAXException;
+import org.xml.sax.SAXParseException;
 /************************************************************
  *  Title: Jakarta-JMeter Description: Copyright: Copyright (c) 2001 Company:
  *  Apache
  * <P> XML Parseing errors for XML parameters file are handled here 
  *@author     Mark Walsh
- *@created    $Date: 2002/08/11 19:24:51 $
+ *@created    $Date: 2002/08/29 18:17:41 $
  *@version    1.0
  ***********************************************************/
-   
-public class UserParameterXMLErrorHandler implements ErrorHandler {
-
-    //-------------------------------------------
-    // Constants and Data Members
-    //-------------------------------------------
-
-
-
-    //-------------------------------------------
-    // Constructors
-    //-------------------------------------------
-
-    //-------------------------------------------
-    // Methods
-    //-------------------------------------------
-
-    public void warning(SAXParseException exception)
-	throws SAXException {
-	
-	System.err.println("**Parsing Warning**\n" +
-			   "  line:    " + exception.getLineNumber() + "\n" +
-			   "  URI:    :" + exception.getSystemId() + "\n" +
-			   "  Message: " + exception.getMessage() );
-	throw new SAXException("Warning encountered");
-    }
-
-    public void error(SAXParseException exception)
-	throws SAXException {
-	
-	System.err.println("**Parsing Warning**\n" +
-			   "  line:    " + exception.getLineNumber() + "\n" +
-			   "  URI:    :" + exception.getSystemId() + "\n" +
-			   "  Message: " + exception.getMessage() );
-	throw new SAXException("Error encountered");
-    }
-
-    public void fatalError(SAXParseException exception)
-	throws SAXException {
-	
-	System.err.println("**Parsing Warning**\n" +
-			   "  line:    " + exception.getLineNumber() + "\n" +
-			   "  URI:    :" + exception.getSystemId() + "\n" +
-			   "  Message: " + exception.getMessage() );
-	throw new SAXException("Fatal Error encountered");
-    }
-
-
+public class UserParameterXMLErrorHandler implements ErrorHandler
+{
+	transient private static Logger log =
+		Hierarchy.getDefaultHierarchy().getLoggerFor("jmeter.protocol.http");
+	//-------------------------------------------
+	// Constants and Data Members
+	//-------------------------------------------
+	//-------------------------------------------
+	// Constructors
+	//-------------------------------------------
+	//-------------------------------------------
+	// Methods
+	//-------------------------------------------
+	public void warning(SAXParseException exception) throws SAXException
+	{
+		log.warn(
+			"**Parsing Warning**\n"
+				+ "  line:    "
+				+ exception.getLineNumber()
+				+ "\n"
+				+ "  URI:    :"
+				+ exception.getSystemId()
+				+ "\n"
+				+ "  Message: "
+				+ exception.getMessage());
+		throw new SAXException("Warning encountered");
+	}
+	public void error(SAXParseException exception) throws SAXException
+	{
+		log.error(
+			"**Parsing Warning**\n"
+				+ "  line:    "
+				+ exception.getLineNumber()
+				+ "\n"
+				+ "  URI:    :"
+				+ exception.getSystemId()
+				+ "\n"
+				+ "  Message: "
+				+ exception.getMessage());
+		throw new SAXException("Error encountered");
+	}
+	public void fatalError(SAXParseException exception) throws SAXException
+	{
+		log.error(
+			"**Parsing Warning**\n"
+				+ "  line:    "
+				+ exception.getLineNumber()
+				+ "\n"
+				+ "  URI:    :"
+				+ exception.getSystemId()
+				+ "\n"
+				+ "  Message: "
+				+ exception.getMessage());
+		throw new SAXException("Fatal Error encountered");
+	}
 } // end class
diff --git a/jakarta-jmeter/src/protocol/http/org/apache/jmeter/protocol/http/modifier/UserSequence.java b/jakarta-jmeter/src/protocol/http/org/apache/jmeter/protocol/http/modifier/UserSequence.java
index 0c2802e..4abb5d3 100644
--- a/jakarta-jmeter/src/protocol/http/org/apache/jmeter/protocol/http/modifier/UserSequence.java
+++ b/jakarta-jmeter/src/protocol/http/org/apache/jmeter/protocol/http/modifier/UserSequence.java
@@ -54,8 +54,14 @@
  */
 package org.apache.jmeter.protocol.http.modifier;
  
-import java.util.*;
 import java.io.Serializable;
+import java.util.HashMap;
+import java.util.Iterator;
+import java.util.List;
+import java.util.Map;
+
+import org.apache.log.Hierarchy;
+import org.apache.log.Logger;
 
 /************************************************************
  *  Title: Jakarta-JMeter Description: Copyright: Copyright (c) 2001 Company:
@@ -64,12 +70,13 @@ import java.io.Serializable;
  * <BR>
  * <P> This module uses round robin allocation of users.
  *@author     Mark Walsh
- *@created    $Date: 2002/08/11 19:24:51 $
+ *@created    $Date: 2002/08/29 18:17:41 $
  *@version    1.0
  ***********************************************************/
 
 public class UserSequence implements Serializable {
-
+	transient private static Logger log = Hierarchy.getDefaultHierarchy().getLoggerFor(
+			"jmeter.protocol.http");
 
     //-------------------------------------------
     // Constants and Data Members
@@ -116,8 +123,7 @@ public class UserSequence implements Serializable {
 	Map user;
 	if (indexOfUsers.hasNext() ) {
 	    user = (Map)indexOfUsers.next();
-	    //debug
-	    //System.out.println("current parameters will be changed to: " + user);
+	    log.debug("UserSequence.getNextuserMods(): current parameters will be changed to: " + user);
 	} else {
 	    // no entries in all users, therefore create an empty Map object
 	    user = new HashMap();
diff --git a/jakarta-jmeter/src/protocol/http/org/apache/jmeter/protocol/http/modifier/gui/AnchorModifierGui.java b/jakarta-jmeter/src/protocol/http/org/apache/jmeter/protocol/http/modifier/gui/AnchorModifierGui.java
index 58296fc..4a254da 100644
--- a/jakarta-jmeter/src/protocol/http/org/apache/jmeter/protocol/http/modifier/gui/AnchorModifierGui.java
+++ b/jakarta-jmeter/src/protocol/http/org/apache/jmeter/protocol/http/modifier/gui/AnchorModifierGui.java
@@ -53,24 +53,24 @@
  * <http://www.apache.org/>.
  */
 package org.apache.jmeter.protocol.http.modifier.gui;
-import java.awt.*;
-import java.awt.event.*;
-import javax.swing.*;
-import javax.swing.border.*;
-import javax.swing.table.*;
-import javax.swing.text.*;
-import org.apache.jmeter.gui.*;
-import org.apache.jmeter.gui.util.VerticalLayout;
-import org.apache.jmeter.protocol.http.modifier.AnchorModifier;
-import org.apache.jmeter.util.JMeterUtils;
+import java.awt.Font;
+
+import javax.swing.JLabel;
+import javax.swing.JPanel;
+import javax.swing.border.Border;
+import javax.swing.border.EmptyBorder;
+
 import org.apache.jmeter.config.gui.AbstractResponseBasedModifierGui;
+import org.apache.jmeter.protocol.http.modifier.AnchorModifier;
 import org.apache.jmeter.testelement.TestElement;
+import org.apache.jmeter.util.JMeterUtils;
+import org.apache.jorphan.gui.layout.VerticalLayout;
 
 /****************************************
  * Title: JMeter Description: Copyright: Copyright (c) 2000 Company: Apache
  *
  *@author    Kevin Hammond
- *@created   $Date: 2002/08/11 19:24:51 $
+ *@created   $Date: 2002/10/17 19:47:19 $
  *@version   1.0
  ***************************************/
 
diff --git a/jakarta-jmeter/src/protocol/http/org/apache/jmeter/protocol/http/modifier/gui/CVS/Entries b/jakarta-jmeter/src/protocol/http/org/apache/jmeter/protocol/http/modifier/gui/CVS/Entries
index 8835f8d..5bcfba7 100644
--- a/jakarta-jmeter/src/protocol/http/org/apache/jmeter/protocol/http/modifier/gui/CVS/Entries
+++ b/jakarta-jmeter/src/protocol/http/org/apache/jmeter/protocol/http/modifier/gui/CVS/Entries
@@ -1,5 +1,5 @@
-/AnchorModifierGui.java/1.1/Sun Aug 11 19:24:51 2002//Tv1_7_3
-/ParamModifierGui.java/1.1/Sun Aug 11 19:24:52 2002//Tv1_7_3
-/URLRewritingModifierGui.java/1.1/Sun Aug 11 19:24:52 2002//Tv1_7_3
-/UserParameterModifierGui.java/1.1/Sun Aug 11 19:24:52 2002//Tv1_7_3
+/AnchorModifierGui.java/1.3/Thu Oct 17 19:47:19 2002//Tv1_8_1
+/ParamModifierGui.java/1.4/Mon Oct 21 17:02:29 2002//Tv1_8_1
+/URLRewritingModifierGui.java/1.3/Thu Oct 17 19:47:19 2002//Tv1_8_1
+/UserParameterModifierGui.java/1.3/Thu Oct 17 19:47:19 2002//Tv1_8_1
 D
diff --git a/jakarta-jmeter/src/protocol/http/org/apache/jmeter/protocol/http/modifier/gui/CVS/Tag b/jakarta-jmeter/src/protocol/http/org/apache/jmeter/protocol/http/modifier/gui/CVS/Tag
index 5f312fe..e2fda28 100644
--- a/jakarta-jmeter/src/protocol/http/org/apache/jmeter/protocol/http/modifier/gui/CVS/Tag
+++ b/jakarta-jmeter/src/protocol/http/org/apache/jmeter/protocol/http/modifier/gui/CVS/Tag
@@ -1 +1 @@
-Nv1_7_3
+Nv1_8_1
diff --git a/jakarta-jmeter/src/protocol/http/org/apache/jmeter/protocol/http/modifier/gui/ParamModifierGui.java b/jakarta-jmeter/src/protocol/http/org/apache/jmeter/protocol/http/modifier/gui/ParamModifierGui.java
index 3da945e..66206e6 100644
--- a/jakarta-jmeter/src/protocol/http/org/apache/jmeter/protocol/http/modifier/gui/ParamModifierGui.java
+++ b/jakarta-jmeter/src/protocol/http/org/apache/jmeter/protocol/http/modifier/gui/ParamModifierGui.java
@@ -1,16 +1,26 @@
 package org.apache.jmeter.protocol.http.modifier.gui;
-import java.awt.*;
-import java.awt.event.*;
-import javax.swing.*;
+import java.awt.Component;
+import java.awt.Font;
+import java.awt.GridBagConstraints;
+import java.awt.GridBagLayout;
+import java.awt.Insets;
+import java.awt.event.FocusEvent;
+import java.awt.event.FocusListener;
+
+import javax.swing.BorderFactory;
+import javax.swing.JLabel;
+import javax.swing.JOptionPane;
+import javax.swing.JPanel;
+import javax.swing.JTextField;
 import javax.swing.border.Border;
 import javax.swing.border.EmptyBorder;
+
 import org.apache.jmeter.config.gui.AbstractModifierGui;
-import org.apache.jmeter.gui.NamePanel;
-import org.apache.jmeter.gui.util.VerticalLayout;
 import org.apache.jmeter.protocol.http.modifier.ParamMask;
 import org.apache.jmeter.protocol.http.modifier.ParamModifier;
 import org.apache.jmeter.testelement.TestElement;
 import org.apache.jmeter.util.JMeterUtils;
+import org.apache.jorphan.gui.layout.VerticalLayout;
 
 /****************************************
  * A swing panel to allow UI with the ParamModifier class.
@@ -18,7 +28,7 @@ import org.apache.jmeter.util.JMeterUtils;
  *@author    David La France
  *@author     <a href="mailto:seade@backstagetech.com.au">Scott Eade</a>
  *@created   Jan 18, 2002
- *@version   $Revision: 1.1 $
+ *@version   $Revision: 1.4 $
  ***************************************/
 public class ParamModifierGui extends AbstractModifierGui implements FocusListener
 {
@@ -84,7 +94,6 @@ public class ParamModifierGui extends AbstractModifierGui implements FocusListen
 		mask.setIncrement(Long.parseLong(_increment.getText()));
 		mask.setUpperBound(Long.parseLong(_upperBound.getText()));
 		mask.setSuffix(_suffix.getText());
-		mask.resetValue();
 		return modifier;
 	}
 
diff --git a/jakarta-jmeter/src/protocol/http/org/apache/jmeter/protocol/http/modifier/gui/URLRewritingModifierGui.java b/jakarta-jmeter/src/protocol/http/org/apache/jmeter/protocol/http/modifier/gui/URLRewritingModifierGui.java
index cccc990..1eed0a5 100644
--- a/jakarta-jmeter/src/protocol/http/org/apache/jmeter/protocol/http/modifier/gui/URLRewritingModifierGui.java
+++ b/jakarta-jmeter/src/protocol/http/org/apache/jmeter/protocol/http/modifier/gui/URLRewritingModifierGui.java
@@ -7,12 +7,13 @@ import javax.swing.JLabel;
 import javax.swing.JPanel;
 import javax.swing.border.Border;
 import javax.swing.border.EmptyBorder;
+
 import org.apache.jmeter.config.gui.AbstractResponseBasedModifierGui;
-import org.apache.jmeter.gui.util.JLabeledTextField;
-import org.apache.jmeter.gui.util.VerticalLayout;
 import org.apache.jmeter.protocol.http.modifier.URLRewritingModifier;
 import org.apache.jmeter.testelement.TestElement;
 import org.apache.jmeter.util.JMeterUtils;
+import org.apache.jorphan.gui.JLabeledTextField;
+import org.apache.jorphan.gui.layout.VerticalLayout;
 
 /**
  * @author mstover
diff --git a/jakarta-jmeter/src/protocol/http/org/apache/jmeter/protocol/http/modifier/gui/UserParameterModifierGui.java b/jakarta-jmeter/src/protocol/http/org/apache/jmeter/protocol/http/modifier/gui/UserParameterModifierGui.java
index c17bbf8..37bbfc5 100644
--- a/jakarta-jmeter/src/protocol/http/org/apache/jmeter/protocol/http/modifier/gui/UserParameterModifierGui.java
+++ b/jakarta-jmeter/src/protocol/http/org/apache/jmeter/protocol/http/modifier/gui/UserParameterModifierGui.java
@@ -53,24 +53,26 @@
  * <http://www.apache.org/>.
  */
 package org.apache.jmeter.protocol.http.modifier.gui;
-import javax.swing.*;
-import java.awt.event.*;
-import javax.swing.border.*;
-import javax.swing.table.*;
-import java.awt.*;
-import javax.swing.text.*;
-import org.apache.jmeter.gui.util.*;
+import java.awt.Font;
+
+import javax.swing.JLabel;
+import javax.swing.JPanel;
+import javax.swing.JTextField;
+import javax.swing.border.Border;
+import javax.swing.border.EmptyBorder;
+
 import org.apache.jmeter.config.gui.AbstractModifierGui;
 import org.apache.jmeter.protocol.http.modifier.UserParameterModifier;
-import org.apache.jmeter.util.JMeterUtils;
 import org.apache.jmeter.testelement.TestElement;
+import org.apache.jmeter.util.JMeterUtils;
+import org.apache.jorphan.gui.layout.VerticalLayout;
 /************************************************************
  *  Title: JMeter Description: Copyright: Copyright (c) 2000 Company: Apache
  *
  * A swing panel to allow UI with the UserParameterModifier class.
  *
  *@author     Mark Walsh
- *@created    $Date: 2002/08/11 19:24:52 $
+ *@created    $Date: 2002/10/17 19:47:19 $
  *@version    1.0
  ***********************************************************/
 public class UserParameterModifierGui extends AbstractModifierGui {
diff --git a/jakarta-jmeter/src/protocol/http/org/apache/jmeter/protocol/http/parser/CVS/Entries b/jakarta-jmeter/src/protocol/http/org/apache/jmeter/protocol/http/parser/CVS/Entries
index aa8e8a1..dcf5fe1 100644
--- a/jakarta-jmeter/src/protocol/http/org/apache/jmeter/protocol/http/parser/CVS/Entries
+++ b/jakarta-jmeter/src/protocol/http/org/apache/jmeter/protocol/http/parser/CVS/Entries
@@ -1,4 +1,4 @@
-/FormElement.java/1.1/Sun Aug 11 19:24:52 2002//Tv1_7_3
-/HtmlForm.java/1.1/Sun Aug 11 19:24:52 2002//Tv1_7_3
-/HtmlParser.java/1.1/Sun Aug 11 19:24:52 2002//Tv1_7_3
+/FormElement.java/1.1/Sun Aug 11 19:24:52 2002//Tv1_8_1
+/HtmlForm.java/1.1/Sun Aug 11 19:24:52 2002//Tv1_8_1
+/HtmlParser.java/1.5/Fri Jan 31 18:25:10 2003//Tv1_8_1
 D
diff --git a/jakarta-jmeter/src/protocol/http/org/apache/jmeter/protocol/http/parser/CVS/Tag b/jakarta-jmeter/src/protocol/http/org/apache/jmeter/protocol/http/parser/CVS/Tag
index 5f312fe..e2fda28 100644
--- a/jakarta-jmeter/src/protocol/http/org/apache/jmeter/protocol/http/parser/CVS/Tag
+++ b/jakarta-jmeter/src/protocol/http/org/apache/jmeter/protocol/http/parser/CVS/Tag
@@ -1 +1 @@
-Nv1_7_3
+Nv1_8_1
diff --git a/jakarta-jmeter/src/protocol/http/org/apache/jmeter/protocol/http/parser/HtmlParser.java b/jakarta-jmeter/src/protocol/http/org/apache/jmeter/protocol/http/parser/HtmlParser.java
index 4cdbf3a..12a050b 100644
--- a/jakarta-jmeter/src/protocol/http/org/apache/jmeter/protocol/http/parser/HtmlParser.java
+++ b/jakarta-jmeter/src/protocol/http/org/apache/jmeter/protocol/http/parser/HtmlParser.java
@@ -53,20 +53,32 @@
  * <http://www.apache.org/>.
  */
 package org.apache.jmeter.protocol.http.parser;
-import java.io.*;
-import java.net.*;
-import java.util.*;
-import org.w3c.dom.*;
-import org.w3c.tidy.Tidy;
-import org.xml.sax.SAXException;
+import java.io.ByteArrayInputStream;
+import java.io.Serializable;
+import java.io.UnsupportedEncodingException;
+import java.net.MalformedURLException;
+import java.net.URL;
+import java.net.URLDecoder;
+import java.util.Iterator;
+import java.util.LinkedList;
+import java.util.List;
+
 import junit.framework.TestCase;
-import org.apache.jmeter.config.*;
+
 import org.apache.jmeter.config.Argument;
 import org.apache.jmeter.protocol.http.sampler.HTTPSampler;
-import org.apache.jmeter.samplers.Entry;
-import org.apache.jmeter.util.JMeterUtils;
-import org.apache.log4j.*;
-import org.apache.oro.text.regex.*;
+import org.apache.log.Hierarchy;
+import org.apache.log.Logger;
+import org.apache.oro.text.PatternCacheLRU;
+import org.apache.oro.text.regex.MalformedPatternException;
+import org.apache.oro.text.regex.Perl5Compiler;
+import org.apache.oro.text.regex.Perl5Matcher;
+import org.w3c.dom.Document;
+import org.w3c.dom.NamedNodeMap;
+import org.w3c.dom.Node;
+import org.w3c.dom.NodeList;
+import org.w3c.tidy.Tidy;
+import org.xml.sax.SAXException;
 
 /****************************************
  * Title: Description: Copyright: Copyright (c) 2001 Company:
@@ -82,8 +94,8 @@ public class HtmlParser implements Serializable
 	/****************************************
 	 * !ToDo (Field description)
 	 ***************************************/
-	protected static Category catClass =
-			Category.getInstance(HtmlParser.class.getName());
+	transient private static Logger log = Hierarchy.getDefaultHierarchy().getLoggerFor(
+			"jmeter.protocol.http");
 
 	/****************************************
 	 * !ToDo (Field description)
@@ -92,9 +104,18 @@ public class HtmlParser implements Serializable
 	private int compilerOptions = Perl5Compiler.CASE_INSENSITIVE_MASK |
 			Perl5Compiler.MULTILINE_MASK | Perl5Compiler.READ_ONLY_MASK;
 
-	private static transient Perl5Compiler compiler = new Perl5Compiler();
+	private static PatternCacheLRU patternCache =
+		new PatternCacheLRU(1000, new Perl5Compiler());
+	
+	private static ThreadLocal localMatcher =
+			 new ThreadLocal()
+			 {
+				protected Object initialValue()
+				{
+					 return new Perl5Matcher();
+				}
+			 };
 
-	private static transient Perl5Matcher matcher = new Perl5Matcher();
 
 	/****************************************
 	 * Constructor for the HtmlParser object
@@ -116,7 +137,7 @@ public class HtmlParser implements Serializable
 			HTTPSampler config) throws MalformedPatternException
 	{
 		boolean ok = true;
-
+		Perl5Matcher matcher = (Perl5Matcher)localMatcher.get();
 		Iterator iter = config.getArguments().iterator();
 
 		// In JDK1.2, URLDecoder.decode has Exception in its throws clause. However, it
@@ -140,7 +161,8 @@ public class HtmlParser implements Serializable
 			Argument item = (Argument)iter.next();
 			if(query.indexOf(item.getName()+"=") == -1)
 			{
-				if(!(ok = ok && matcher.contains(query, compiler.compile(item.getName()))))
+				if(!(ok = ok && matcher.contains(query, 
+						patternCache.getPattern(item.getName(), Perl5Compiler.READ_ONLY_MASK))))
 				{
 					return false;
 				}
@@ -151,15 +173,16 @@ public class HtmlParser implements Serializable
 				!newLink.getDomain().equals(config.getDomain()))
 		{
 			if(!(ok = ok && matcher.matches(newLink.getDomain(),
-					compiler.compile(config.getDomain()))))
+					patternCache.getPattern(config.getDomain(), Perl5Compiler.READ_ONLY_MASK))))
 				return false;
 		}
 
 		if(!newLink.getPath().equals(config.getPath()) && !matcher.matches(newLink.getPath(), 
-				compiler.compile("[/]*" + config.getPath())))
+				patternCache.getPattern("[/]*" + config.getPath(), Perl5Compiler.READ_ONLY_MASK)))
 			return false;
 
-		if(!(ok = ok && matcher.matches(newLink.getProtocol(), compiler.compile(config.getProtocol()))))
+		if(!(ok = ok && matcher.matches(newLink.getProtocol(), 
+				patternCache.getPattern(config.getProtocol(), Perl5Compiler.READ_ONLY_MASK))))
 			return false;
 
 		return ok;
@@ -175,10 +198,13 @@ public class HtmlParser implements Serializable
 	 ***************************************/
 	public static synchronized boolean isArgumentMatched(Argument arg, Argument patternArg) throws MalformedPatternException
 	{
+		Perl5Matcher matcher = (Perl5Matcher)localMatcher.get();
 		return (arg.getName().equals(patternArg.getName()) || 
-				matcher.matches(arg.getName(), compiler.compile(patternArg.getName()))) &&
+				matcher.matches(arg.getName(), patternCache.getPattern(patternArg.getName(), 
+						Perl5Compiler.READ_ONLY_MASK))) &&
 				(arg.getValue().equals(patternArg.getValue()) || 
-				matcher.matches((String)arg.getValue(), compiler.compile((String)patternArg.getValue())));
+				matcher.matches((String)arg.getValue(), patternCache.getPattern((String)patternArg.getValue(), 
+						Perl5Compiler.READ_ONLY_MASK)));
 	}
 
 	/****************************************
@@ -188,16 +214,16 @@ public class HtmlParser implements Serializable
 	 ***************************************/
 	public static Tidy getParser()
 	{
-		catClass.debug("Start : getParser1");
+		log.debug("Start : getParser1");
 		Tidy tidy = new Tidy();
 		tidy.setCharEncoding(org.w3c.tidy.Configuration.UTF8);
 		tidy.setQuiet(true);
 		tidy.setShowWarnings(false);
 
-		if(catClass.isDebugEnabled())
-			catClass.debug("getParser1 : tidy parser created - " + tidy);
+		if(log.isDebugEnabled())
+			log.debug("getParser1 : tidy parser created - " + tidy);
 
-		catClass.debug("End : getParser1");
+		log.debug("End : getParser1");
 
 		return tidy;
 	}
@@ -211,24 +237,24 @@ public class HtmlParser implements Serializable
 	 ***************************************/
 	public static Node getDOM(String text) throws SAXException
 	{
-		catClass.debug("Start : getDOM1");
+		log.debug("Start : getDOM1");
 
 		try
 		{
 			Node node = getParser().parseDOM(new
 					ByteArrayInputStream(text.getBytes(getUTFEncodingName())), null);
 
-			if(catClass.isDebugEnabled())
-				catClass.debug("node : " + node);
+			if(log.isDebugEnabled())
+				log.debug("node : " + node);
 
-			catClass.debug("End : getDOM1");
+			log.debug("End : getDOM1");
 
 			return node;
 		}
 		catch(UnsupportedEncodingException e)
 		{
-			catClass.error("getDOM1 : Unsupported encoding exception - " + e);
-			catClass.debug("End : getDOM1");
+			log.error("getDOM1 : Unsupported encoding exception - " + e);
+			log.debug("End : getDOM1");
 			throw new RuntimeException("UTF-8 encoding failed");
 		}
 	}
@@ -241,14 +267,14 @@ public class HtmlParser implements Serializable
 	 ***************************************/
 	public static String getUTFEncodingName()
 	{
-		catClass.debug("Start : getUTFEncodingName1");
+		log.debug("Start : getUTFEncodingName1");
 
 		if(utfEncodingName == null)
 		{
 			String versionNum = System.getProperty("java.version");
 
-			if(catClass.isDebugEnabled())
-				catClass.debug("getUTFEncodingName1 : versionNum - " + versionNum);
+			if(log.isDebugEnabled())
+				log.debug("getUTFEncodingName1 : versionNum - " + versionNum);
 
 			if(versionNum.startsWith("1.1"))
 				utfEncodingName = "UTF8";
@@ -258,11 +284,11 @@ public class HtmlParser implements Serializable
 
 		}
 
-		if(catClass.isDebugEnabled())
-			catClass.debug("getUTFEncodingName1 : Returning utfEncodingName - " +
+		if(log.isDebugEnabled())
+			log.debug("getUTFEncodingName1 : Returning utfEncodingName - " +
 					utfEncodingName);
 
-		catClass.debug("End : getUTFEncodingName1");
+		log.debug("End : getUTFEncodingName1");
 
 		return utfEncodingName;
 	}
@@ -449,7 +475,7 @@ public class HtmlParser implements Serializable
 		}
 		catch(Exception ex)
 		{
-			System.out.println("Some bad HTML " + printNode(tempNode));
+			log.warn("Some bad HTML " + printNode(tempNode),ex);
 		}
 		NodeList childNodes = tempNode.getChildNodes();
 		for(int x = 0; x < childNodes.getLength(); x++)
@@ -495,13 +521,12 @@ public class HtmlParser implements Serializable
 	 * !ToDo (Class description)
 	 *
 	 *@author    $Author: mstover1 $
-	 *@created   $Date: 2002/08/11 19:24:52 $
-	 *@version   $Revision: 1.1 $
+	 *@created   $Date: 2003/01/31 18:25:10 $
+	 *@version   $Revision: 1.5 $
 	 ***************************************/
 	public static class Test extends TestCase
 	{
-		private static Category catClass =
-				Category.getInstance(Test.class.getName());
+		transient private static Logger log = Hierarchy.getDefaultHierarchy().getLoggerFor("jmeter.test");
 
 		/****************************************
 		 * !ToDo (Constructor description)
@@ -518,7 +543,7 @@ public class HtmlParser implements Serializable
 		 ***************************************/
 		public void testGetUTFEncodingName()
 		{
-			catClass.debug("Start : testGetUTFEncodingName1");
+			log.debug("Start : testGetUTFEncodingName1");
 			String javaVersion = System.getProperty("java.version");
 			utfEncodingName = null;
 			System.setProperty("java.version", "1.1");
@@ -529,7 +554,7 @@ public class HtmlParser implements Serializable
 			System.setProperty("java.version", "1.2");
 			assertEquals("UTF-8", HtmlParser.getUTFEncodingName());
 			System.setProperty("java.version", javaVersion);
-			catClass.debug("End : testGetUTFEncodingName1");
+			log.debug("End : testGetUTFEncodingName1");
 		}
 
 		/****************************************
diff --git a/jakarta-jmeter/src/protocol/http/org/apache/jmeter/protocol/http/proxy/Admin.java b/jakarta-jmeter/src/protocol/http/org/apache/jmeter/protocol/http/proxy/Admin.java
index 32b72e5..e05df93 100644
--- a/jakarta-jmeter/src/protocol/http/org/apache/jmeter/protocol/http/proxy/Admin.java
+++ b/jakarta-jmeter/src/protocol/http/org/apache/jmeter/protocol/http/proxy/Admin.java
@@ -4,8 +4,16 @@ package org.apache.jmeter.protocol.http.proxy;
 ***
 ***/
 
-import java.net.*;
-import java.io.*;
+import java.io.BufferedReader;
+import java.io.DataInputStream;
+import java.io.DataOutputStream;
+import java.io.IOException;
+import java.io.InputStreamReader;
+import java.net.ServerSocket;
+import java.net.Socket;
+
+import org.apache.log.Hierarchy;
+import org.apache.log.Logger;
 
 //
 // Class:     Admin
@@ -15,6 +23,9 @@ import java.io.*;
 
 public class Admin extends Thread
 {
+	
+	transient private static Logger log = Hierarchy.getDefaultHierarchy().getLoggerFor(
+			"jmeter.protocol.http");
     //
     // Member variables
     //
@@ -46,7 +57,7 @@ public class Admin extends Thread
         }
         catch (IOException e)
         {
-            System.out.println("Error opening admin socket");
+            log.error("Error opening admin socket",e);
         }
     }
 
@@ -93,7 +104,7 @@ public class Admin extends Thread
                     out.flush();
 
                     config.parse(in.readLine());
-                    System.out.println("Configuration changed by administrator.");
+                    log.info("Configuration changed by administrator.");
 
                     // Administrator wants to clean the cache
                     if (config.getCleanCache())
@@ -110,7 +121,7 @@ public class Admin extends Thread
                 // the connection with the proxy. That's fine, we are now
                 // available for another administrator to log in.
                 //
-                System.out.println("Connection with administrator closed.");
+                log.error("Connection with administrator closed.",e);
             }
             finally
             {
diff --git a/jakarta-jmeter/src/protocol/http/org/apache/jmeter/protocol/http/proxy/CVS/Entries b/jakarta-jmeter/src/protocol/http/org/apache/jmeter/protocol/http/proxy/CVS/Entries
index 6b5f04d..5d2e478 100644
--- a/jakarta-jmeter/src/protocol/http/org/apache/jmeter/protocol/http/proxy/CVS/Entries
+++ b/jakarta-jmeter/src/protocol/http/org/apache/jmeter/protocol/http/proxy/CVS/Entries
@@ -1,9 +1,9 @@
-/Admin.java/1.1/Sun Aug 11 19:24:52 2002//Tv1_7_3
-/Cache.java/1.1/Sun Aug 11 19:24:52 2002//Tv1_7_3
-/Config.java/1.1/Sun Aug 11 19:24:52 2002//Tv1_7_3
-/Daemon.java/1.1/Sun Aug 11 19:24:52 2002//Tv1_7_3
-/HttpReplyHdr.java/1.1/Sun Aug 11 19:24:52 2002//Tv1_7_3
-/HttpRequestHdr.java/1.3/Wed Aug 14 17:49:04 2002//Tv1_7_3
-/Proxy.java/1.1/Sun Aug 11 19:24:52 2002//Tv1_7_3
-/ProxyControl.java/1.2/Wed Aug 14 17:49:04 2002//Tv1_7_3
+/Admin.java/1.3/Thu Aug 29 18:17:42 2002//Tv1_8_1
+/Cache.java/1.3/Thu Aug 29 18:17:42 2002//Tv1_8_1
+/Config.java/1.3/Thu Aug 29 18:17:42 2002//Tv1_8_1
+/Daemon.java/1.4/Thu Jan 30 13:56:21 2003//Tv1_8_1
+/HttpReplyHdr.java/1.1/Sun Aug 11 19:24:52 2002//Tv1_8_1
+/HttpRequestHdr.java/1.7/Mon Jan 13 01:05:57 2003//Tv1_8_1
+/Proxy.java/1.4/Thu Jan 30 13:56:21 2003//Tv1_8_1
+/ProxyControl.java/1.10/Fri Jan 31 18:25:10 2003//Tv1_8_1
 D/gui////
diff --git a/jakarta-jmeter/src/protocol/http/org/apache/jmeter/protocol/http/proxy/CVS/Tag b/jakarta-jmeter/src/protocol/http/org/apache/jmeter/protocol/http/proxy/CVS/Tag
index 5f312fe..e2fda28 100644
--- a/jakarta-jmeter/src/protocol/http/org/apache/jmeter/protocol/http/proxy/CVS/Tag
+++ b/jakarta-jmeter/src/protocol/http/org/apache/jmeter/protocol/http/proxy/CVS/Tag
@@ -1 +1 @@
-Nv1_7_3
+Nv1_8_1
diff --git a/jakarta-jmeter/src/protocol/http/org/apache/jmeter/protocol/http/proxy/Cache.java b/jakarta-jmeter/src/protocol/http/org/apache/jmeter/protocol/http/proxy/Cache.java
index e611df2..b2dbcc6 100644
--- a/jakarta-jmeter/src/protocol/http/org/apache/jmeter/protocol/http/proxy/Cache.java
+++ b/jakarta-jmeter/src/protocol/http/org/apache/jmeter/protocol/http/proxy/Cache.java
@@ -4,9 +4,17 @@ package org.apache.jmeter.protocol.http.proxy;
 ***
 ***/
 
-import java.io.*;
-import java.util.*;
-import java.net.*;
+import java.io.File;
+import java.io.FileInputStream;
+import java.io.FileNotFoundException;
+import java.io.FileOutputStream;
+import java.io.IOException;
+import java.util.Date;
+import java.util.Enumeration;
+import java.util.Hashtable;
+
+import org.apache.log.Hierarchy;
+import org.apache.log.Logger;
 
 //
 // Class:     Cache
@@ -15,6 +23,8 @@ import java.net.*;
 
 public class Cache
 {
+	transient private static Logger log = Hierarchy.getDefaultHierarchy().getLoggerFor(
+			"jmeter.protocol.http");
 	//
 	// Members variables
 	//
@@ -121,7 +131,7 @@ public class Cache
 			try
 
 			{
-				System.out.println("File Not Found:"+getFileName(rawUrl)+" "+fnf);
+				log.warn("File Not Found:"+getFileName(rawUrl),fnf);
 			}
 			catch (Exception e)
 			{}
@@ -185,7 +195,7 @@ public class Cache
 	//
 	 public synchronized void clean()
 	{
-		System.out.println("Cleaning the cache...");
+		log.info("Cleaning the cache...");
 
 		// Enumerate the hash table
 		for (Enumeration keys = htable.keys(); keys.hasMoreElements() ;)
@@ -210,7 +220,7 @@ public class Cache
 		}
 		config.setHits(0);
 		config.setMisses(0);
-		System.out.println("Cache is clean.");
+		log.info("Cache is clean.");
 	}
 
 
@@ -236,7 +246,7 @@ public class Cache
 
 			if (htable.isEmpty())
 			{
-				System.out.println("Could not make free space: Hash table empty...");
+				log.info("Could not make free space: Hash table empty...");
 				return;
 			}
 
@@ -269,7 +279,7 @@ public class Cache
 			else
 			{
 				// Another thread holds this file open for writing
-				System.out.println("File "+LRUfilename+" could not be deleted...");
+				log.info("File "+LRUfilename+" could not be deleted...");
 				return;
 			}
 		}
diff --git a/jakarta-jmeter/src/protocol/http/org/apache/jmeter/protocol/http/proxy/Config.java b/jakarta-jmeter/src/protocol/http/org/apache/jmeter/protocol/http/proxy/Config.java
index 4e6c446..3b13518 100644
--- a/jakarta-jmeter/src/protocol/http/org/apache/jmeter/protocol/http/proxy/Config.java
+++ b/jakarta-jmeter/src/protocol/http/org/apache/jmeter/protocol/http/proxy/Config.java
@@ -1,15 +1,10 @@
 package org.apache.jmeter.protocol.http.proxy;
 
-import java.io.*;
+import java.io.File;
+import java.util.StringTokenizer;
 
-import java.net.*;
-
-/************************************************************
- *  File Config.java
- ***********************************************************/
-
-
-import java.util.*;
+import org.apache.log.Hierarchy;
+import org.apache.log.Logger;
 
 
 
@@ -32,6 +27,8 @@ import java.util.*;
  ***********************************************************/
 class Config
 {
+	transient private static Logger log = Hierarchy.getDefaultHierarchy().getLoggerFor(
+			"jmeter.protocol.http");
 
 	//
 
@@ -813,7 +810,7 @@ class Config
 	public synchronized void parse(String config)
 	{
 
-		System.out.println("Parsing administrator request...");
+		log.info("Parsing administrator request...");
 
 		int size;
 
@@ -824,7 +821,7 @@ class Config
 
 		isFatherProxy = s.nextToken().equals("true");
 
-		System.out.println("Use father proxy = " + isFatherProxy);
+		log.info("Use father proxy = " + isFatherProxy);
 
 		fatherProxyHost = s.nextToken();
 
@@ -834,12 +831,12 @@ class Config
 			fatherProxyHost = "";
 		}
 
-		System.out.println("Father proxy name = " + fatherProxyHost);
+		log.info("Father proxy name = " + fatherProxyHost);
 
 
 		fatherProxyPort = Integer.parseInt(s.nextToken());
 
-		System.out.println("Father proxy port = " + fatherProxyPort);
+		log.info("Father proxy port = " + fatherProxyPort);
 
 
 		size = Integer.parseInt(s.nextToken());
@@ -851,26 +848,26 @@ class Config
 
 			deniedHosts[i] = s.nextToken();
 
-			System.out.println("Deny access to " + deniedHosts[i]);
+			log.info("Deny access to " + deniedHosts[i]);
 
 		}
 
 
 		password = s.nextToken();
 
-		System.out.println("password = " + password);
+		log.info("password = " + password);
 
 		isCaching = s.nextToken().equals("true");
 
-		System.out.println("Caching = " + isCaching);
+		log.info("Caching = " + isCaching);
 
 		cacheSize = Long.parseLong(s.nextToken());
 
-		System.out.println("Cache size = " + cacheSize);
+		log.info("Cache size = " + cacheSize);
 
 		cleanCache = s.nextToken().equals("true");
 
-		System.out.println("Do cache clean up = " + cleanCache);
+		log.info("Do cache clean up = " + cleanCache);
 
 
 		size = Integer.parseInt(s.nextToken());
@@ -882,7 +879,7 @@ class Config
 
 			cacheMasks[i] = s.nextToken();
 
-			System.out.println("Don't cache " + cacheMasks[i]);
+			log.info("Don't cache " + cacheMasks[i]);
 
 		}
 
diff --git a/jakarta-jmeter/src/protocol/http/org/apache/jmeter/protocol/http/proxy/Daemon.java b/jakarta-jmeter/src/protocol/http/org/apache/jmeter/protocol/http/proxy/Daemon.java
index 7ee301b..56c3ade 100644
--- a/jakarta-jmeter/src/protocol/http/org/apache/jmeter/protocol/http/proxy/Daemon.java
+++ b/jakarta-jmeter/src/protocol/http/org/apache/jmeter/protocol/http/proxy/Daemon.java
@@ -1,12 +1,15 @@
 package org.apache.jmeter.protocol.http.proxy;
 
-import java.io.*;
-import org.apache.jmeter.protocol.http.control.CookieManager;
+import java.io.File;
+import java.io.IOException;
+import java.net.InetAddress;
+import java.net.ServerSocket;
+import java.net.Socket;
+import java.net.UnknownHostException;
 
-/************************************************************
- *  File Daemon.java
- ***********************************************************/
-import java.net.*;
+import org.apache.jmeter.protocol.http.control.CookieManager;
+import org.apache.log.Hierarchy;
+import org.apache.log.Logger;
 //
 // Class:     Daemon
 // Abstract:  Web daemon thread. creates main socket on port 8080
@@ -21,6 +24,8 @@ import java.net.*;
  ***********************************************************/
 public class Daemon extends Thread
 {
+	transient private static Logger log = Hierarchy.getDefaultHierarchy().getLoggerFor(
+			"jmeter.protocol.http");
 	//
 	// Member variables
 	//
@@ -34,6 +39,7 @@ public class Daemon extends Thread
 	private boolean running;
 	ProxyControl target;
 	private Socket ClientSocket;
+	static private Class proxyClass = Proxy.class;
 
 	public Daemon()
 	{
@@ -44,6 +50,12 @@ public class Daemon extends Thread
 		this.target = target;
 		configureProxy(port);
 	}
+	
+	public Daemon(int port,ProxyControl target,Class proxyClass) throws UnknownHostException
+	{
+		this(port,target);
+		Daemon.proxyClass = proxyClass;
+	}
 
 	/************************************************************
 	 *  Description of the Method
@@ -54,8 +66,8 @@ public class Daemon extends Thread
 	{
 		this.daemonPort = daemonPort;
 		// Create the Cache Manager and Configuration objects
-		System.out.println("Initializing...");
-		System.out.print("Creating Config Object...");
+		log.info("Initializing...");
+		log.info("Creating Config Object...");
 		config = new Config();
 		config.setIsAppletContext(false);
 		config.setLocalHost(InetAddress.getLocalHost().getHostName());
@@ -65,10 +77,10 @@ public class Daemon extends Thread
 		config.setJmxScriptDir("proxy_script");
 		File adminDir = new File("Applet");
 		config.setAdminPath(adminDir.getAbsolutePath());
-		System.out.println("OK");
-		System.out.print("Creating Cache Manager...");
+		log.info("Proxy: OK");
+		log.info("Creating Cache Manager...");
 		cache = new Cache(config);
-		System.out.println("OK");
+		log.info("Proxy: OK");
 	}
 
 	//
@@ -97,17 +109,17 @@ public class Daemon extends Thread
 				}
 				catch(NumberFormatException e)
 				{
-					System.out.println("Error: Invalid daemon port");
+					log.error("Invalid daemon port",e);
 					return;
 				}
 				if(daemonPort > maxDaemonPort)
 				{
-					System.out.println("Error: Invalid daemon port");
+					log.error("Invalid daemon port");
 					return;
 				}
 				break;
 			default:
-				System.out.println("Usage: Proxy [daemon port]");
+				log.info("Usage: Proxy [daemon port]");
 				return;
 		}
 		Daemon demon = new Daemon();
@@ -117,7 +129,7 @@ public class Daemon extends Thread
 		}
 		catch(UnknownHostException e)
 		{
-			System.out.println("Unknown host");
+			log.fatalError("Unknown host",e);
 			System.exit(-1);
 		}
 		demon.start();
@@ -132,23 +144,24 @@ public class Daemon extends Thread
 		running = true;
 		try
 		{
-			System.out.print("Creating Daemon Socket...");
+			log.info("Creating Daemon Socket...");
 			MainSocket = new ServerSocket(daemonPort);
-			System.out.println(" port " + daemonPort + " OK");
-			System.out.println("Proxy up and running!");
+			log.info(" port " + daemonPort + " OK");
+			log.info("Proxy up and running!");
 			while(running)
 			{
 				// Listen on main socket
 				Socket ClientSocket = MainSocket.accept();
 				// Pass request to new proxy thread
-				Proxy thd = new Proxy(ClientSocket, cache, config,target,cookieManager);
+				Proxy thd = (Proxy)proxyClass.newInstance();
+				thd.configure(ClientSocket, cache, config,target,cookieManager);
 				thd.start();
 			}
-			System.out.println("Proxy Server stopped");
+			log.info("Proxy Server stopped");
 		}
 		catch(Exception e)
 		{
-			System.out.println("Proxy Server stopped");
+			log.warn("Proxy Server stopped",e);
 		}
 		finally
 		{
diff --git a/jakarta-jmeter/src/protocol/http/org/apache/jmeter/protocol/http/proxy/HttpRequestHdr.java b/jakarta-jmeter/src/protocol/http/org/apache/jmeter/protocol/http/proxy/HttpRequestHdr.java
index 59038e1..171f7de 100644
--- a/jakarta-jmeter/src/protocol/http/org/apache/jmeter/protocol/http/proxy/HttpRequestHdr.java
+++ b/jakarta-jmeter/src/protocol/http/org/apache/jmeter/protocol/http/proxy/HttpRequestHdr.java
@@ -12,6 +12,8 @@ import java.util.Iterator;
 import java.util.Map;
 import java.util.StringTokenizer;
 
+import junit.framework.TestCase;
+
 import org.apache.jmeter.protocol.http.config.MultipartUrlConfig;
 import org.apache.jmeter.protocol.http.control.Header;
 import org.apache.jmeter.protocol.http.control.HeaderManager;
@@ -19,50 +21,44 @@ import org.apache.jmeter.protocol.http.control.gui.HttpTestSampleGui;
 import org.apache.jmeter.protocol.http.gui.HeaderPanel;
 import org.apache.jmeter.protocol.http.sampler.HTTPSampler;
 import org.apache.jmeter.testelement.TestElement;
+import org.apache.jmeter.util.JMeterUtils;
+import org.apache.log.Logger;
+import org.apache.jorphan.logging.LoggingManager;
 
 //
 // Class:     HttpRequestHdr
 // Abstract:  The headers of the client HTTP request.
 //
-
 /****************************************
  * !ToDo (Class description)
  *
- *@author    $Author: mstover1 $
- *@created   $Date: 2002/08/14 17:49:04 $
- *@version   $Revision: 1.3 $
+ *@author    $Author: jsalvata $
+ *@created   $Date: 2003/01/13 01:05:57 $
+ *@version   $Revision: 1.7 $
  ***************************************/
 public class HttpRequestHdr
 {
-
+	Logger log =
+		LoggingManager.getLoggerFor(JMeterUtils.HTTP);
 	/****************************************
 	 * Http Request method. Such as get or post.
 	 ***************************************/
 	public String method = new String();
-
 	/****************************************
 	 * The requested url. The universal resource locator that hopefully uniquely
 	 * describes the object or service the client is requesting.
 	 ***************************************/
 	public String url = new String();
-
 	/****************************************
 	 * Version of http being used. Such as HTTP/1.0
 	 ***************************************/
 	public String version = new String();
-
-
-
 	/****************************************
 	 * !ToDo (Field description)
 	 ***************************************/
 	public String postData = "";
-
 	static String CR = "\r\n";
-
 	private Map headers = new HashMap();
-
-
 	/****************************************
 	 * Parses a http header from a stream.
 	 *
@@ -79,28 +75,28 @@ public class HttpRequestHdr
 		ByteArrayOutputStream clientRequest = new ByteArrayOutputStream();
 		ByteArrayOutputStream line = new ByteArrayOutputStream();
 		int x;
-		while((inHeaders || readLength < dataLength) && ((x = in.read()) != -1))
+		while ((inHeaders || readLength < dataLength) && ((x = in.read()) != -1))
 		{
 			line.write(x);
 			clientRequest.write(x);
-			if(inHeaders && (byte)x == (byte)'\n')
+			if (inHeaders && (byte) x == (byte) '\n')
 			{
-				if(line.size() < 3)
+				if (line.size() < 3)
 				{
 					inHeaders = false;
 				}
-				if(first)
+				if (first)
 				{
 					parseFirstLine(line.toString());
 					first = false;
 				}
 				else
 				{
-					dataLength = Math.max(parseLine(line.toString()),dataLength);
+					dataLength = Math.max(parseLine(line.toString()), dataLength);
 				}
 				line.reset();
 			}
-			else if(!inHeaders)
+			else if (!inHeaders)
 			{
 				readLength++;
 			}
@@ -108,106 +104,116 @@ public class HttpRequestHdr
 		postData = line.toString().trim();
 		return clientRequest.toByteArray();
 	}
-
 	public void parseFirstLine(String firstLine)
 	{
+		log.debug("browser request: " + firstLine);
 		StringTokenizer tz = new StringTokenizer(firstLine);
 		method = getToken(tz).toUpperCase();
 		url = getToken(tz);
+		log.debug("parsed url: " + url);
 		version = getToken(tz);
 	}
-
 	public int parseLine(String nextLine)
 	{
 		StringTokenizer tz;
 		tz = new StringTokenizer(nextLine);
 		String token = getToken(tz);
 		// look for termination of HTTP command
-		if(0 == token.length())
+		if (0 == token.length())
 		{
 			return 0;
 		}
 		else
 		{
-			String name = token.trim().substring(0,token.trim().length()-1);
+			String name = token.trim().substring(0, token.trim().length() - 1);
 			String value = getRemainder(tz);
-			headers.put(name.toLowerCase(),new Header(name,value));
-			if(name.equalsIgnoreCase("content-length"))
+			headers.put(name.toLowerCase(), new Header(name, value));
+			if (name.equalsIgnoreCase("content-length"))
 			{
 				return Integer.parseInt(value);
 			}
 		}
 		return 0;
 	}
-	
 	public HeaderManager getHeaderManager()
 	{
 		HeaderManager manager = new HeaderManager();
 		Iterator keys = headers.keySet().iterator();
-		while(keys.hasNext())
+		while (keys.hasNext())
 		{
-			String key = (String)keys.next();
-			if(!key.equals("proxy-connection") && !key.equals("content-length"))
+			String key = (String) keys.next();
+			if (!key.equals("proxy-connection") && !key.equals("content-length"))
 			{
-				manager.add((Header)headers.get(key));
+				manager.add((Header) headers.get(key));
 			}
 		}
 		manager.setName("Browser-derived headers");
-		manager.setProperty(TestElement.TEST_CLASS,HeaderManager.class.getName());
-		manager.setProperty(TestElement.GUI_CLASS,HeaderPanel.class.getName());
-		return  manager;
+		manager.setProperty(TestElement.TEST_CLASS, HeaderManager.class.getName());
+		manager.setProperty(TestElement.GUI_CLASS, HeaderPanel.class.getName());
+		return manager;
 	}
-
-	public HTTPSampler getSampler() throws MalformedURLException,IOException,ProtocolException
+	public HTTPSampler getSampler()
+		throws MalformedURLException, IOException, ProtocolException
 	{
 		HttpTestSampleGui tempGui = new HttpTestSampleGui();
 		tempGui.configure(createSampler());
-		HTTPSampler result = (HTTPSampler)tempGui.createTestElement();
+		HTTPSampler result = (HTTPSampler) tempGui.createTestElement();
 		result.setFollowRedirects(false);
 		result.setUseKeepAlive(true);
 		return result;
 	}
-
 	public String getContentType()
 	{
-		Header contentTypeHeader = (Header)headers.get("content-type");
-		if(contentTypeHeader != null)
+		Header contentTypeHeader = (Header) headers.get("content-type");
+		if (contentTypeHeader != null)
 		{
 			return contentTypeHeader.getValue();
 		}
 		return "";
 	}
-	
 	public static MultipartUrlConfig isMultipart(String contentType)
 	{
-		if(contentType != null && contentType.startsWith(MultipartUrlConfig.MULTIPART_FORM))
+		if (contentType != null
+			&& contentType.startsWith(MultipartUrlConfig.MULTIPART_FORM))
 		{
-			return new MultipartUrlConfig(contentType.substring(contentType.indexOf("oundary=")+8));
+			return new MultipartUrlConfig(
+				contentType.substring(contentType.indexOf("oundary=") + 8));
 		}
 		else
 		{
 			return null;
 		}
 	}
-
 	private HTTPSampler createSampler()
 	{
 		MultipartUrlConfig urlConfig = null;
 		HTTPSampler sampler = new HTTPSampler();
 		sampler.setDomain(serverName());
+		log.debug("Proxy: setting server: "+sampler.getDomain());
 		sampler.setMethod(method);
+		log.debug("Proxy: method server: "+sampler.getMethod());
 		sampler.setPath(serverUrl());
+		log.debug("Proxy: setting path: "+sampler.getPath());
 		sampler.setName(sampler.getPath());
-		if(url.indexOf(":") > -1)
+		sampler.setPort(serverPort());
+		log.debug("Proxy: setting port: "+sampler.getPort());
+		if (url.indexOf("//") > -1)
+		{
+			String protocol = url.substring(0, url.indexOf(":"));
+			log.debug("Proxy: setting protocol to : "+protocol);
+			sampler.setProtocol(protocol);
+		}
+		else if(sampler.getPort() == 443)
 		{
-			sampler.setProtocol(url.substring(0, url.indexOf(":")));
+			sampler.setProtocol("https");
+			log.debug("Proxy: setting protocol to https");
 		}
 		else
 		{
+			log.debug("Proxy setting default protocol to: http");
 			sampler.setProtocol("http");
 		}
-		sampler.setPort(serverPort());
-		if((urlConfig = isMultipart(getContentType())) != null)
+		if ((urlConfig = isMultipart(getContentType())) != null)
 		{
 			urlConfig.parseArguments(postData);
 			sampler.setArguments(urlConfig.getArguments());
@@ -220,12 +226,10 @@ public class HttpRequestHdr
 			sampler.parseArguments(postData);
 		}
 		return sampler;
-	 }
-
+	}
 	//
 	// Parsing Methods
 	//
-
 	/****************************************
 	 * Find the //server.name from an url.
 	 *
@@ -236,29 +240,24 @@ public class HttpRequestHdr
 		// chop to "server.name:x/thing"
 		String str = url;
 		int i = str.indexOf("//");
-		if(i < 0)
+		if (i > 0)
 		{
-			return "";
+			str = str.substring(i + 2);
 		}
-		str = str.substring(i + 2);
-
 		// chop to  server.name:xx
 		i = str.indexOf("/");
-		if(0 < i)
+		if (0 < i)
 		{
 			str = str.substring(0, i);
 		}
-
 		// chop to server.name
 		i = str.indexOf(":");
-		if(0 < i)
+		if (0 < i)
 		{
 			str = str.substring(0, i);
 		}
-
 		return str;
 	}
-
 	/****************************************
 	 * Find the :PORT form http://server.ect:PORT/some/file.xxx
 	 *
@@ -269,29 +268,24 @@ public class HttpRequestHdr
 		String str = url;
 		// chop to "server.name:x/thing"
 		int i = str.indexOf("//");
-		if(i < 0)
+		if (i > 0)
 		{
-			return 80;
-		}
-		str = str.substring(i + 2);
-
+			str = str.substring(i + 2);
+		}		
 		// chop to  server.name:xx
 		i = str.indexOf("/");
-		if(0 < i)
+		if (0 < i)
 		{
 			str = str.substring(0, i);
 		}
-
 		// chop XX
 		i = str.indexOf(":");
-		if(0 < i)
+		if (0 < i)
 		{
 			return Integer.parseInt(str.substring(i + 1).trim());
 		}
-
 		return 80;
 	}
-
 	/****************************************
 	 * Find the /some/file.xxxx form http://server.ect:PORT/some/file.xxx
 	 *
@@ -301,21 +295,17 @@ public class HttpRequestHdr
 	{
 		String str = url;
 		int i = str.indexOf("//");
-		if(i < 0)
+		if (i > 0)
 		{
-			return str;
-		}
-
-		str = str.substring(i + 2);
+			str = str.substring(i + 2);
+		}		
 		i = str.indexOf("/");
-		if(i < 0)
+		if (i < 0)
 		{
-			return str;
+			return "";
 		}
-
 		return str.substring(i);
 	}
-
 	/****************************************
 	 * Returns the next token in a string
 	 *
@@ -326,13 +316,12 @@ public class HttpRequestHdr
 	String getToken(StringTokenizer tk)
 	{
 		String str = "";
-		if(tk.hasMoreTokens())
+		if (tk.hasMoreTokens())
 		{
 			str = tk.nextToken();
 		}
 		return str;
 	}
-
 	/****************************************
 	 * Returns the remainder of a tokenized string
 	 *
@@ -343,16 +332,35 @@ public class HttpRequestHdr
 	String getRemainder(StringTokenizer tk)
 	{
 		String str = "";
-		if(tk.hasMoreTokens())
+		if (tk.hasMoreTokens())
 		{
 			str = tk.nextToken();
 		}
-		while(tk.hasMoreTokens())
+		while (tk.hasMoreTokens())
 		{
 			str += " " + tk.nextToken();
 		}
-
 		return str;
 	}
 
+        public static class Test extends TestCase
+	{
+                public Test(String name)
+		{
+			super(name);
+		}
+	
+		public void setUp() {
+		}
+
+                public void testRepeatedArguments() throws Exception {
+                    String TEST_REQ=
+                        "GET http://localhost/matrix.html?update=yes&d=1&d=2&d=&d=&d=&d=&d=&d=1&d=2&d=1&d=&d= HTTP/1.0\n\n";
+                    HttpRequestHdr req= new HttpRequestHdr();
+                    req.parse(new java.io.ByteArrayInputStream(
+                            TEST_REQ.getBytes()));
+                    HTTPSampler s= req.getSampler();
+                    assertEquals(s.getArguments().getArguments().size(), 13);
+                }
+        }
 }
diff --git a/jakarta-jmeter/src/protocol/http/org/apache/jmeter/protocol/http/proxy/Proxy.java b/jakarta-jmeter/src/protocol/http/org/apache/jmeter/protocol/http/proxy/Proxy.java
index c4f2eed..7183c2e 100644
--- a/jakarta-jmeter/src/protocol/http/org/apache/jmeter/protocol/http/proxy/Proxy.java
+++ b/jakarta-jmeter/src/protocol/http/org/apache/jmeter/protocol/http/proxy/Proxy.java
@@ -53,16 +53,27 @@
  * <http://www.apache.org/>.
  */
 package org.apache.jmeter.protocol.http.proxy;
-import java.net.*;
-import java.io.*;
-import java.util.*;
+import java.io.BufferedInputStream;
+import java.io.BufferedOutputStream;
+import java.io.BufferedReader;
+import java.io.DataOutputStream;
+import java.io.File;
+import java.io.FileInputStream;
+import java.io.FileOutputStream;
+import java.io.IOException;
+import java.io.InputStreamReader;
+import java.io.OutputStream;
+import java.net.HttpURLConnection;
+import java.net.Socket;
+import java.net.UnknownHostException;
+
 import org.apache.jmeter.protocol.http.control.CookieManager;
-import org.apache.jmeter.samplers.Entry;
-import org.apache.jmeter.samplers.Sampler;
-import org.apache.jmeter.samplers.SampleResult;
+import org.apache.jmeter.protocol.http.control.HeaderManager;
 import org.apache.jmeter.protocol.http.sampler.HTTPSampler;
+import org.apache.jmeter.samplers.SampleResult;
 import org.apache.jmeter.testelement.TestElement;
-import org.apache.jmeter.protocol.http.control.HeaderManager;
+import org.apache.log.Hierarchy;
+import org.apache.log.Logger;
 //
 // Class:     Proxy
 // Abstract:  Thread to handle one client request. get the requested
@@ -76,6 +87,8 @@ import org.apache.jmeter.protocol.http.control.HeaderManager;
  *@created    June 8, 2001
  */
 public class Proxy extends Thread {
+	transient private static Logger log = Hierarchy.getDefaultHierarchy().getLoggerFor(
+			"jmeter.protocol.http");
 	//
 	// Member variables
 	//
@@ -95,21 +108,34 @@ public class Proxy extends Thread {
 	// UrlConfig object for saving test cases
 	ProxyControl target;
 	CookieManager cookieManager;
-	//
-	// Public member methods
-	//
-	//
-	// Constructor
-	//
-	Proxy(
+	
+	
+	/**
+	 * Constructor.  Configures Proxy at same time.
+	 * @param clientSocket
+	 * @param CacheManager
+	 * @param configObject
+	 * @param target
+	 * @param cookieManager
+	 */
+	Proxy(Socket clientSocket,Cache CacheManager,Config configObject,
+		ProxyControl target,CookieManager cookieManager) 
+	{
+		configure(clientSocket,CacheManager,configObject,target,cookieManager);
+	}
+	
+	public Proxy()
+	{
+		
+	}
+	
+	public void configure(
 		Socket clientSocket,
 		Cache CacheManager,
 		Config configObject,
 		ProxyControl target,
-		CookieManager cookieManager) {
-		//
-		// Initialize member variables
-		//
+		CookieManager cookieManager)
+	{
 		this.cookieManager = cookieManager;
 		this.target = target;
 		config = configObject;
@@ -145,16 +171,16 @@ public class Proxy extends Thread {
 			writeToClient(serverResponse,
 				new BufferedOutputStream(ClientSocket.getOutputStream()));
 			headers.removeHeaderNamed("cookie");
-			target.deliverSampler(sampler,new TestElement[]{headers});
+			target.deliverSampler(sampler,new TestElement[]{headers},serverResponse);
 		} catch (UnknownHostException uhe) {
-			System.out.println("Server Not Found.");
+			log.warn("Server Not Found.",uhe);
 			try {
 				DataOutputStream out = new DataOutputStream(ClientSocket.getOutputStream());
 				out.writeBytes(reply.formServerNotFound());
 				out.flush();
 			} catch (Exception uhe2) {}
 		} catch (Exception e) {
-			e.printStackTrace();
+			log.error("",e);
 			try {
 				if (TakenFromCache) {
 					fileInputStream.close();
@@ -170,7 +196,7 @@ public class Proxy extends Thread {
 			try {
 				ClientSocket.close();
 			} catch (Exception e) {
-				e.printStackTrace();
+				log.error("",e);
 			}
 		}
 	}
@@ -186,7 +212,7 @@ public class Proxy extends Thread {
 	// Send to administrator web page containing reference to applet
 	//
 	private void sendAppletWebPage() {
-		System.out.println("Sending the applet...");
+		log.info("Sending the applet...");
 		String page = "";
 		try {
 			File appletHtmlPage =
@@ -207,7 +233,7 @@ public class Proxy extends Thread {
 			out.flush();
 			out.close();
 		} catch (Exception e) {
-			System.out.println("Error: can't open applet html page");
+			log.error("can't open applet html page",e);
 		}
 	}
 	//
@@ -239,9 +265,9 @@ public class Proxy extends Thread {
 			
 			out.write(inBytes);
 			out.flush();
-			System.out.println("Done writing to client");
+			log.info("Done writing to client");
 		} catch (IOException e) {
-			e.printStackTrace();
+			log.error("",e);
 		} finally {
 			try {
 				out.close();
diff --git a/jakarta-jmeter/src/protocol/http/org/apache/jmeter/protocol/http/proxy/ProxyControl.java b/jakarta-jmeter/src/protocol/http/org/apache/jmeter/protocol/http/proxy/ProxyControl.java
index 2cf3e23..4babb90 100644
--- a/jakarta-jmeter/src/protocol/http/org/apache/jmeter/protocol/http/proxy/ProxyControl.java
+++ b/jakarta-jmeter/src/protocol/http/org/apache/jmeter/protocol/http/proxy/ProxyControl.java
@@ -52,42 +52,51 @@
  * information on the Apache Software Foundation, please see
  * <http://www.apache.org/>.
  */
-
 package org.apache.jmeter.protocol.http.proxy;
-
+import java.io.Serializable;
 import java.net.UnknownHostException;
-import java.util.*;
-import java.io.*;
+import java.util.Enumeration;
+import java.util.Iterator;
+import java.util.LinkedList;
+import java.util.List;
 
 import junit.framework.TestCase;
 
-import org.apache.jmeter.config.*;
-import org.apache.jmeter.threads.ThreadGroup;
+import org.apache.jmeter.config.ConfigElement;
+import org.apache.jmeter.config.ConfigTestElement;
+import org.apache.jmeter.protocol.http.control.gui.RecordController;
+import org.apache.jmeter.exceptions.IllegalUserActionException;
+import org.apache.jmeter.functions.ValueReplacer;
+import org.apache.jmeter.gui.GuiPackage;
+import org.apache.jmeter.gui.JMeterGUIComponent;
+import org.apache.jmeter.gui.tree.JMeterTreeModel;
+import org.apache.jmeter.gui.tree.JMeterTreeNode;
 import org.apache.jmeter.protocol.http.config.gui.UrlConfigGui;
-import org.apache.oro.text.regex.*;
-import org.apache.jmeter.util.JMeterUtils;
-import org.apache.jmeter.gui.*;
-import org.apache.jmeter.gui.tree.*;
+import org.apache.jmeter.protocol.http.control.HeaderManager;
 import org.apache.jmeter.protocol.http.control.gui.HttpTestSampleGui;
-import org.apache.jmeter.exceptions.IllegalUserActionException;
+import org.apache.jmeter.protocol.http.gui.HeaderPanel;
 import org.apache.jmeter.protocol.http.sampler.HTTPSampler;
 import org.apache.jmeter.testelement.TestElement;
-import org.apache.jmeter.protocol.http.control.HeaderManager;
-import org.apache.jmeter.protocol.http.gui.HeaderPanel;
-import org.apache.jmeter.control.gui.LogicControllerGui;
 import org.apache.jmeter.threads.gui.ThreadGroupGui;
-
+import org.apache.jmeter.util.JMeterUtils;
+import org.apache.log.Hierarchy;
+import org.apache.log.Logger;
+import org.apache.oro.text.regex.MalformedPatternException;
+import org.apache.oro.text.regex.Pattern;
+import org.apache.oro.text.regex.Perl5Compiler;
+import org.apache.oro.text.regex.Perl5Matcher;
 /************************************************************
  *  Title: Apache JMeter Description: Copyright: Copyright (c) 2000 Company:
  *  Apache Foundation
  *
  *@author     Michael Stover
- *@created    $Date: 2002/08/14 17:49:04 $
+ *@created    $Date: 2003/01/31 18:25:10 $
  *@version    1.0
  ***********************************************************/
-
 public class ProxyControl extends ConfigTestElement implements Serializable
 {
+	transient private static Logger log =
+		Hierarchy.getDefaultHierarchy().getLoggerFor("jmeter.protocol.http");
 	Daemon server;
 	private final int DEFAULT_PORT = 8080;
 	transient Perl5Compiler compiler;
@@ -95,7 +104,6 @@ public class ProxyControl extends ConfigTestElement implements Serializable
 	public final static String PORT = "ProxyControlGui.port";
 	public final static String EXCLUDE_LIST = "ProxyControlGui.exclude_list";
 	public final static String INCLUDE_LIST = "ProxyControlGui.include_list";
-
 	/************************************************************
 	 *  !ToDo (Constructor description)
 	 ***********************************************************/
@@ -107,7 +115,6 @@ public class ProxyControl extends ConfigTestElement implements Serializable
 		setExcludeList(new LinkedList());
 		setIncludeList(new LinkedList());
 	}
-
 	/************************************************************
 	 *  !ToDo (Method description)
 	 *
@@ -117,17 +124,14 @@ public class ProxyControl extends ConfigTestElement implements Serializable
 	{
 		this.setProperty(PORT, new Integer(port));
 	}
-
 	public void setIncludeList(List list)
 	{
-		setProperty(INCLUDE_LIST,list);
+		setProperty(INCLUDE_LIST, list);
 	}
-
 	public void setExcludeList(List list)
 	{
-		setProperty(EXCLUDE_LIST,list);
+		setProperty(EXCLUDE_LIST, list);
 	}
-
 	/************************************************************
 	 *  !ToDoo (Method description)
 	 *
@@ -137,7 +141,6 @@ public class ProxyControl extends ConfigTestElement implements Serializable
 	{
 		return JMeterUtils.getResString("proxy_title");
 	}
-
 	/************************************************************
 	 *  !ToDoo (Method description)
 	 *
@@ -147,15 +150,14 @@ public class ProxyControl extends ConfigTestElement implements Serializable
 	{
 		if (this.getProperty(PORT) instanceof String)
 		{
-			setPort(Integer.parseInt((String)getProperty(PORT)));
-			return ((Integer)this.getProperty(PORT)).intValue();
+			setPort(Integer.parseInt((String) getProperty(PORT)));
+			return ((Integer) this.getProperty(PORT)).intValue();
 		}
 		else
 		{
-			return ((Integer)this.getProperty(PORT)).intValue();
+			return ((Integer) this.getProperty(PORT)).intValue();
 		}
 	}
-
 	/************************************************************
 	 *  !ToDoo (Method description)
 	 *
@@ -165,24 +167,11 @@ public class ProxyControl extends ConfigTestElement implements Serializable
 	{
 		return DEFAULT_PORT;
 	}
-
 	public Class getGuiClass()
 	{
 		return org.apache.jmeter.protocol.http.proxy.gui.ProxyControlGui.class;
 	}
 
-	/************************************************************
-	 *  !ToDo (Method description)
-	 *
-	 *@return    !ToDo (Return description)
-	 ***********************************************************/
-	public Object clone()
-	{
-		ProxyControl clone = new ProxyControl();
-		configureClone(clone);
-		return clone;
-	}
-
 	/************************************************************
 	 *  !ToDo
 	 *
@@ -191,7 +180,6 @@ public class ProxyControl extends ConfigTestElement implements Serializable
 	public void addConfigElement(ConfigElement config)
 	{
 	}
-
 	/************************************************************
 	 *  !ToDo (Method description)
 	 ***********************************************************/
@@ -204,10 +192,9 @@ public class ProxyControl extends ConfigTestElement implements Serializable
 		}
 		catch (UnknownHostException e)
 		{
-			e.printStackTrace();
+			log.error("", e);
 		}
 	}
-
 	/************************************************************
 	 *  !ToDo
 	 *
@@ -217,12 +204,10 @@ public class ProxyControl extends ConfigTestElement implements Serializable
 	{
 		getExcludePatterns().add(pattern);
 	}
-
 	public List getExcludePatterns()
 	{
-		return (List)getProperty(EXCLUDE_LIST);
+		return (List) getProperty(EXCLUDE_LIST);
 	}
-
 	/************************************************************
 	 *  !ToDo
 	 *
@@ -232,12 +217,10 @@ public class ProxyControl extends ConfigTestElement implements Serializable
 	{
 		getIncludePatterns().add(pattern);
 	}
-
 	public List getIncludePatterns()
 	{
-		return (List)getProperty(INCLUDE_LIST);
+		return (List) getProperty(INCLUDE_LIST);
 	}
-
 	/************************************************************
 	 *  !ToDo (Method description)
 	 ***********************************************************/
@@ -245,7 +228,6 @@ public class ProxyControl extends ConfigTestElement implements Serializable
 	{
 		getExcludePatterns().clear();
 	}
-
 	/************************************************************
 	 *  !ToDo (Method description)
 	 ***********************************************************/
@@ -253,20 +235,23 @@ public class ProxyControl extends ConfigTestElement implements Serializable
 	{
 		getIncludePatterns().clear();
 	}
-
-	/************************************************************
-	 *  !ToDo (Method description)
-	 *
-	 *@param  config  !ToDo (Parameter description)
-	 ***********************************************************/
-	public void deliverSampler(HTTPSampler sampler,TestElement[] subConfigs)
+	
+	/**
+	 * Receives the recorded sampler from the proxy server for placing in the
+	 * test tree
+	 * @param sampler
+	 * @param subConfigs
+	 * @param serverResponse Added to allow saving of the server's response while
+	 * recording.  A future consideration.
+	 */
+	public void deliverSampler(HTTPSampler sampler, TestElement[] subConfigs,
+			byte[] serverResponse)
 	{
 		if (filterUrl(sampler))
 		{
-			placeConfigElement(sampler,subConfigs);
+			placeConfigElement(sampler, subConfigs);
 		}
 	}
-
 	/************************************************************
 	 *  !ToDo (Method description)
 	 ***********************************************************/
@@ -277,11 +262,10 @@ public class ProxyControl extends ConfigTestElement implements Serializable
 			server.stopServer();
 		}
 	}
-
-	private boolean filterUrl(HTTPSampler sampler)
+	protected boolean filterUrl(HTTPSampler sampler)
 	{
 		boolean ok = false;
-		if(sampler.getDomain() == null || sampler.getDomain().equals(""))
+		if (sampler.getDomain() == null || sampler.getDomain().equals(""))
 		{
 			return false;
 		}
@@ -310,87 +294,99 @@ public class ProxyControl extends ConfigTestElement implements Serializable
 		}
 		return ok;
 	}
-
-	private void placeConfigElement(HTTPSampler sampler,TestElement[] subConfigs)
+	private void placeConfigElement(
+		HTTPSampler sampler,
+		TestElement[] subConfigs)
 	{
+		ValueReplacer replacer = GuiPackage.getInstance().getReplacer();
 		TestElement urlConfig = null;
 		JMeterTreeModel treeModel = GuiPackage.getInstance().getTreeModel();
-		List nodes = treeModel.getNodesOfType(LogicControllerGui.class);
-		if(nodes.size() == 0)
+		List nodes = treeModel.getNodesOfType(RecordController.class);
+		if (nodes.size() == 0)
 		{
 			nodes = treeModel.getNodesOfType(ThreadGroupGui.class);
 		}
 		Iterator iter = nodes.iterator();
-		if (iter.hasNext())
+		while (iter.hasNext())
 		{
-			JMeterTreeNode node = (JMeterTreeNode)iter.next();
-			Enumeration enum = node.children();
-			while(enum.hasMoreElements())
-			{
-				JMeterTreeNode subNode = (JMeterTreeNode)enum.nextElement();
-				JMeterGUIComponent sample = (JMeterGUIComponent)subNode.getUserObject();
-				if(sample instanceof UrlConfigGui)
-				{
-					urlConfig = sample.createTestElement();
-					break;
-				}
-			}
-			if(areMatched(sampler, urlConfig))
-			{
-				removeValuesFromSampler(sampler, urlConfig);
-				HttpTestSampleGui test = new HttpTestSampleGui();
-				test.configure(sampler);
-				try
-				{
-					JMeterTreeNode newNode = treeModel.addComponent(test,node);
-					for(int i = 0;subConfigs != null && i < subConfigs.length;
-							i++)
-					{
-						if(subConfigs[i] instanceof HeaderManager)
-						{
-							HeaderPanel comp = new HeaderPanel();
-							comp.configure(subConfigs[i]);
-							treeModel.addComponent(comp,newNode);
-						}
-					}
-				}
-				catch(IllegalUserActionException e)
-				{
-					JMeterUtils.reportErrorToUser(e.getMessage());
-				}
-			}
-		}
+			JMeterTreeNode node = (JMeterTreeNode) iter.next();
+
+            if (! node.isEnabled()) {
+                continue;
+            } else {
+                Enumeration enum = node.children();
+                while (enum.hasMoreElements())
+                {
+                    JMeterTreeNode subNode = (JMeterTreeNode) enum.nextElement();
+                    JMeterGUIComponent sample =
+                        (JMeterGUIComponent) subNode.getUserObject();
+                    if (sample instanceof UrlConfigGui)
+                    {
+                        urlConfig = sample.createTestElement();
+                        break;
+                    }
+                }
+                if (areMatched(sampler, urlConfig))
+                {
+                    removeValuesFromSampler(sampler, urlConfig);
+                    replacer.reverseReplace(sampler);
+                    HttpTestSampleGui test = new HttpTestSampleGui();
+                    test.configure(sampler);
+                    try
+                    {
+                        JMeterTreeNode newNode = treeModel.addComponent(test, node);
+                        for (int i = 0; subConfigs != null && i < subConfigs.length; i++)
+                        {
+                            if (subConfigs[i] instanceof HeaderManager)
+                            {
+                                HeaderPanel comp = new HeaderPanel();
+                                replacer.reverseReplace(subConfigs[i]);
+                                comp.configure(subConfigs[i]);
+                                treeModel.addComponent(comp, newNode);
+                            }
+                        }
+                    }
+                    catch (IllegalUserActionException e)
+                    {
+                        JMeterUtils.reportErrorToUser(e.getMessage());
+                    }
+                }
+                return;
+            }
+        }
 	}
-
 	private void removeValuesFromSampler(
 		HTTPSampler sampler,
-		TestElement urlConfig) {
-		if(urlConfig != null && sampler.getDomain().equals(urlConfig.getProperty(HTTPSampler.DOMAIN)))
+		TestElement urlConfig)
+	{
+		if (urlConfig != null
+			&& sampler.getDomain().equals(urlConfig.getProperty(HTTPSampler.DOMAIN)))
 		{
 			sampler.setDomain("");
 		}
-		if(urlConfig != null && sampler.getPath().equals(urlConfig.getProperty(HTTPSampler.PATH)))
+		if (urlConfig != null
+			&& sampler.getPath().equals(urlConfig.getProperty(HTTPSampler.PATH)))
 		{
 			sampler.setPath("");
 		}
 	}
-
-	private boolean areMatched(HTTPSampler sampler, TestElement urlConfig) {
-		return urlConfig == null || (urlConfig.getProperty(HTTPSampler.DOMAIN) == null ||
-				urlConfig.getProperty(HTTPSampler.DOMAIN).equals("") ||
-				urlConfig.getProperty(HTTPSampler.DOMAIN).equals(sampler.getDomain())) &&
-				(urlConfig.getProperty(HTTPSampler.PATH) == null ||
-				urlConfig.getProperty(HTTPSampler.PATH).equals("") ||
-				urlConfig.getProperty(HTTPSampler.PATH).equals(sampler.getPath()));
+	private boolean areMatched(HTTPSampler sampler, TestElement urlConfig)
+	{
+		return urlConfig == null
+			|| (urlConfig.getProperty(HTTPSampler.DOMAIN) == null
+				|| urlConfig.getProperty(HTTPSampler.DOMAIN).equals("")
+				|| urlConfig.getProperty(HTTPSampler.DOMAIN).equals(sampler.getDomain()))
+			&& (urlConfig.getProperty(HTTPSampler.PATH) == null
+				|| urlConfig.getProperty(HTTPSampler.PATH).equals("")
+				|| urlConfig.getProperty(HTTPSampler.PATH).equals(sampler.getPath()));
 	}
-
 	private boolean checkIncludes(HTTPSampler sampler)
 	{
 		boolean ok = false;
 		Iterator iter = getIncludePatterns().iterator();
 		while (iter.hasNext())
 		{
-			String item = (String)iter.next();
+			String item = (String) iter.next();
 			try
 			{
 				Pattern pattern = compiler.compile(item);
@@ -398,7 +394,7 @@ public class ProxyControl extends ConfigTestElement implements Serializable
 				url.append(":");
 				url.append(sampler.getPort());
 				url.append(sampler.getPath());
-				if(sampler.getQueryString().length() > 0)
+				if (sampler.getQueryString().length() > 0)
 				{
 					url.append("?");
 					url.append(sampler.getQueryString());
@@ -416,14 +412,13 @@ public class ProxyControl extends ConfigTestElement implements Serializable
 		}
 		return ok;
 	}
-
 	private boolean checkExcludes(HTTPSampler sampler)
 	{
 		boolean ok = true;
 		Iterator iter = getExcludePatterns().iterator();
 		while (iter.hasNext())
 		{
-			String item = (String)iter.next();
+			String item = (String) iter.next();
 			try
 			{
 				Pattern pattern = compiler.compile(item);
@@ -431,7 +426,7 @@ public class ProxyControl extends ConfigTestElement implements Serializable
 				url.append(":");
 				url.append(sampler.getPort());
 				url.append(sampler.getPath());
-				if(sampler.getQueryString().length() > 0)
+				if (sampler.getQueryString().length() > 0)
 				{
 					url.append("?");
 					url.append(sampler.getQueryString());
@@ -449,14 +444,12 @@ public class ProxyControl extends ConfigTestElement implements Serializable
 		}
 		return ok;
 	}
-
 	public static class Test extends TestCase
 	{
 		public Test(String name)
 		{
 			super(name);
 		}
-
 		public void testFiltering() throws Exception
 		{
 			ProxyControl control = new ProxyControl();
@@ -473,5 +466,4 @@ public class ProxyControl extends ConfigTestElement implements Serializable
 			assertTrue(!control.filterUrl(sampler));
 		}
 	}
-
 }
diff --git a/jakarta-jmeter/src/protocol/http/org/apache/jmeter/protocol/http/proxy/gui/CVS/Entries b/jakarta-jmeter/src/protocol/http/org/apache/jmeter/protocol/http/proxy/gui/CVS/Entries
index 00b9663..8eeea17 100644
--- a/jakarta-jmeter/src/protocol/http/org/apache/jmeter/protocol/http/proxy/gui/CVS/Entries
+++ b/jakarta-jmeter/src/protocol/http/org/apache/jmeter/protocol/http/proxy/gui/CVS/Entries
@@ -1,2 +1,2 @@
-/ProxyControlGui.java/1.1/Sun Aug 11 19:24:52 2002//Tv1_7_3
+/ProxyControlGui.java/1.5/Fri Jan 31 18:25:10 2003//Tv1_8_1
 D
diff --git a/jakarta-jmeter/src/protocol/http/org/apache/jmeter/protocol/http/proxy/gui/CVS/Tag b/jakarta-jmeter/src/protocol/http/org/apache/jmeter/protocol/http/proxy/gui/CVS/Tag
index 5f312fe..e2fda28 100644
--- a/jakarta-jmeter/src/protocol/http/org/apache/jmeter/protocol/http/proxy/gui/CVS/Tag
+++ b/jakarta-jmeter/src/protocol/http/org/apache/jmeter/protocol/http/proxy/gui/CVS/Tag
@@ -1 +1 @@
-Nv1_7_3
+Nv1_8_1
diff --git a/jakarta-jmeter/src/protocol/http/org/apache/jmeter/protocol/http/proxy/gui/ProxyControlGui.java b/jakarta-jmeter/src/protocol/http/org/apache/jmeter/protocol/http/proxy/gui/ProxyControlGui.java
index 575ca99..12f53ba 100644
--- a/jakarta-jmeter/src/protocol/http/org/apache/jmeter/protocol/http/proxy/gui/ProxyControlGui.java
+++ b/jakarta-jmeter/src/protocol/http/org/apache/jmeter/protocol/http/proxy/gui/ProxyControlGui.java
@@ -2,7 +2,7 @@
  * ====================================================================
  * The Apache Software License, Version 1.1
  *
- * Copyright (c) 2001 The Apache Software Foundation.  All rights
+ * Copyright (c) 2002 The Apache Software Foundation.  All rights
  * reserved.
  *
  * Redistribution and use in source and binary forms, with or without
@@ -81,12 +81,18 @@ import javax.swing.JTable;
 import javax.swing.JTextField;
 import javax.swing.border.Border;
 import javax.swing.border.EmptyBorder;
+
+import org.apache.jmeter.functions.InvalidVariableException;
+import org.apache.jmeter.functions.ValueReplacer;
+import org.apache.jmeter.gui.GuiPackage;
 import org.apache.jmeter.gui.JMeterGUIComponent;
 import org.apache.jmeter.gui.NamePanel;
+import org.apache.jmeter.gui.tree.JMeterTreeNode;
 import org.apache.jmeter.gui.util.MenuFactory;
 import org.apache.jmeter.gui.util.PowerTableModel;
 import org.apache.jmeter.protocol.http.proxy.ProxyControl;
 import org.apache.jmeter.testelement.TestElement;
+import org.apache.jmeter.testelement.TestPlan;
 import org.apache.jmeter.util.JMeterUtils;
 
 /****************************************
@@ -94,7 +100,7 @@ import org.apache.jmeter.util.JMeterUtils;
  * Apache
  *
  *@author    Michael Stover
- *@created   $Date: 2002/08/11 19:24:52 $
+ *@created   $Date: 2003/01/31 18:25:10 $
  *@version   1.0
  ***************************************/
 
@@ -121,7 +127,7 @@ public class ProxyControlGui extends JPanel implements JMeterGUIComponent, Actio
 	private final static String ADD_EXCLUDE = "add_exclude";
 	private final static String DELETE_INCLUDE = "delete_include";
 	private final static String DELETE_EXCLUDE = "delete_exclude";
-	
+
 	private final static String INCLUDE_COL = JMeterUtils.getResString("patterns_to_include");
 	private final static String EXCLUDE_COL = JMeterUtils.getResString("patterns_to_exclude");
 
@@ -152,12 +158,12 @@ public class ProxyControlGui extends JPanel implements JMeterGUIComponent, Actio
 		return element;
 	}
 
-	private void setIncludeListInProxyControl(ProxyControl element) {
+	protected void setIncludeListInProxyControl(ProxyControl element) {
 		List includeList = getDataList(includeModel,INCLUDE_COL);
 		element.setIncludeList(includeList);
 	}
-	
-	private void setExcludeListInProxyControl(ProxyControl element)
+
+	protected void setExcludeListInProxyControl(ProxyControl element)
 	{
 		List excludeList = getDataList(excludeModel,EXCLUDE_COL);
 		element.setExcludeList(excludeList);
@@ -172,8 +178,8 @@ public class ProxyControlGui extends JPanel implements JMeterGUIComponent, Actio
 		}
 		return list;
 	}
-	
-	
+
+
 
 	public void setName(String name)
 	{
@@ -211,7 +217,7 @@ public class ProxyControlGui extends JPanel implements JMeterGUIComponent, Actio
 			model.addRow(new Object[]{iter.next()});
 		}
 	}
-	
+
 	public void focusLost(FocusEvent e)
 	{
 		try
@@ -222,7 +228,7 @@ public class ProxyControlGui extends JPanel implements JMeterGUIComponent, Actio
 		{
 		}
 	}
-	
+
 	public void focusGained(FocusEvent e)
 	{
 	}
@@ -246,16 +252,13 @@ public class ProxyControlGui extends JPanel implements JMeterGUIComponent, Actio
 		else if(command.equals(START))
 		{
 			model = (ProxyControl)createTestElement();
-			model.startProxy();
-			start.setEnabled(false);
-			stop.setEnabled(true);
+			startProxy();
 		}
 		else if(command.equals(RESTART))
 		{
 			model.stopProxy();
 			model = (ProxyControl)createTestElement();
-			model.startProxy();
-			restart.setEnabled(false);
+			startProxy();
 		}
 		else if(command.equals(this.ADD_EXCLUDE))
 		{
@@ -283,7 +286,25 @@ public class ProxyControlGui extends JPanel implements JMeterGUIComponent, Actio
 			enableRestart();
 		}
 	}
-	
+
+	private void startProxy()
+	{
+		ValueReplacer replacer = GuiPackage.getInstance().getReplacer();
+		try
+		{
+			replacer.replaceValues(model);
+			model.startProxy();
+			start.setEnabled(false);
+			stop.setEnabled(true);
+			restart.setEnabled(false);
+		}
+		catch (InvalidVariableException e)
+		{
+			JOptionPane.showMessageDialog(this,JMeterUtils.getResString(
+					"invalid_variables"),"Error",JOptionPane.ERROR_MESSAGE);
+		}
+	}
+
 	private void enableRestart()
 	{
 		if(model != null)
@@ -401,7 +422,7 @@ public class ProxyControlGui extends JPanel implements JMeterGUIComponent, Actio
 		stop = new JButton(JMeterUtils.getResString("stop"));
 		stop.addActionListener(this);
 		stop.setActionCommand(STOP);
-		
+
 		restart = new JButton(JMeterUtils.getResString("restart"));
 		restart.addActionListener(this);
 		restart.setActionCommand(RESTART);
@@ -482,4 +503,20 @@ public class ProxyControlGui extends JPanel implements JMeterGUIComponent, Actio
 		excludeTable.addFocusListener(this);
 		return panel;
 	}
+
+
+    public void setNode(JMeterTreeNode node)
+    {
+        namePanel.setNode(node);
+    }
+
+	/**
+	 * Returns the portField.
+	 * @return JTextField
+	 */
+	protected JTextField getPortField()
+	{
+		return portField;
+	}
+
 }
diff --git a/jakarta-jmeter/src/protocol/http/org/apache/jmeter/protocol/http/sampler/CVS/Entries b/jakarta-jmeter/src/protocol/http/org/apache/jmeter/protocol/http/sampler/CVS/Entries
index 1f4074e..6e8cab2 100644
--- a/jakarta-jmeter/src/protocol/http/org/apache/jmeter/protocol/http/sampler/CVS/Entries
+++ b/jakarta-jmeter/src/protocol/http/org/apache/jmeter/protocol/http/sampler/CVS/Entries
@@ -1,5 +1,5 @@
-/HTTPSampler.java/1.4/Wed Aug 14 02:52:19 2002//Tv1_7_3
-/HTTPSamplerFull.java/1.2/Mon Aug 12 18:12:37 2002//Tv1_7_3
-/PostWriter.java/1.1/Sun Aug 11 19:24:52 2002//Tv1_7_3
-/SoapSampler.java/1.1/Sun Aug 11 19:24:52 2002//Tv1_7_3
+/HTTPSampler.java/1.19/Mon Dec 30 02:22:40 2002//Tv1_8_1
+/HTTPSamplerFull.java/1.8/Tue Jan 14 01:14:07 2003//Tv1_8_1
+/PostWriter.java/1.5/Thu Dec 12 22:00:16 2002//Tv1_8_1
+/SoapSampler.java/1.2/Mon Dec  2 03:07:43 2002//Tv1_8_1
 D
diff --git a/jakarta-jmeter/src/protocol/http/org/apache/jmeter/protocol/http/sampler/CVS/Tag b/jakarta-jmeter/src/protocol/http/org/apache/jmeter/protocol/http/sampler/CVS/Tag
index 5f312fe..e2fda28 100644
--- a/jakarta-jmeter/src/protocol/http/org/apache/jmeter/protocol/http/sampler/CVS/Tag
+++ b/jakarta-jmeter/src/protocol/http/org/apache/jmeter/protocol/http/sampler/CVS/Tag
@@ -1 +1 @@
-Nv1_7_3
+Nv1_8_1
diff --git a/jakarta-jmeter/src/protocol/http/org/apache/jmeter/protocol/http/sampler/HTTPSampler.java b/jakarta-jmeter/src/protocol/http/org/apache/jmeter/protocol/http/sampler/HTTPSampler.java
index 1e7dc7b..ace1005 100644
--- a/jakarta-jmeter/src/protocol/http/org/apache/jmeter/protocol/http/sampler/HTTPSampler.java
+++ b/jakarta-jmeter/src/protocol/http/org/apache/jmeter/protocol/http/sampler/HTTPSampler.java
@@ -2,7 +2,7 @@
  * ====================================================================
  * The Apache Software License, Version 1.1
  *
- * Copyright (c) 2001 The Apache Software Foundation.  All rights
+ * Copyright (c) 2001-2002 The Apache Software Foundation.  All rights
  * reserved.
  *
  * Redistribution and use in source and binary forms, with or without
@@ -57,11 +57,11 @@ import java.io.BufferedInputStream;
 import java.io.ByteArrayOutputStream;
 import java.io.FileNotFoundException;
 import java.io.IOException;
+import java.net.BindException;
 import java.net.HttpURLConnection;
 import java.net.MalformedURLException;
 import java.net.URL;
 import java.net.URLConnection;
-import java.net.URLDecoder;
 import java.util.ArrayList;
 import java.util.Collection;
 import java.util.Iterator;
@@ -79,21 +79,21 @@ import org.apache.jmeter.samplers.SampleResult;
 import org.apache.jmeter.testelement.TestElement;
 import org.apache.jmeter.util.JMeterUtils;
 import org.apache.jmeter.util.SSLManager;
-import org.apache.log4j.Category;
-
+import org.apache.jorphan.util.JOrphanUtils;
+import org.apache.log.Hierarchy;
+import org.apache.log.Logger;
 /****************************************
  * A sampler which understands all the parts necessary to read statistics about
  * HTTP requests, including cookies and authentication.
  *
  *@author    Michael Stover
- *@created   $Date: 2002/08/14 02:52:19 $
- *@version   $Revision: 1.4 $
+ *@created   $Date: 2002/12/30 02:22:40 $
+ *@version   $Revision: 1.19 $
  ***************************************/
 public class HTTPSampler extends AbstractSampler
 {
 	public final static String HEADERS = "headers";
 	public final static String HEADER = "header";
-
 	public final static String ARGUMENTS = "HTTPsampler.Arguments";
 	public final static String AUTH_MANAGER = "HTTPSampler.auth_manager";
 	public final static String COOKIE_MANAGER = "HTTPSampler.cookie_manager";
@@ -105,6 +105,7 @@ public class HTTPSampler extends AbstractSampler
 	public final static String PATH = "HTTPSampler.path";
 	public final static String FOLLOW_REDIRECTS = "HTTPSampler.follow_redirects";
 	public final static String PROTOCOL = "HTTPSampler.protocol";
+	public final static String DEFAULT_PROTOCOL = "http";
 	public final static String URL = "HTTPSampler.URL";
 	public final static String POST = "POST";
 	public final static String GET = "GET";
@@ -116,40 +117,40 @@ public class HTTPSampler extends AbstractSampler
 	public final static String CONTENT_TYPE = "HTTPSampler.CONTENT_TYPE";
 	public final static String NORMAL_FORM = "normal_form";
 	public final static String MULTIPART_FORM = "multipart_form";
+	private static final int MAX_REDIRECTS=10;
 	protected static String encoding = "iso-8859-1";
-	
 	private static final PostWriter postWriter = new PostWriter();
-
+	transient protected HttpURLConnection conn;
+	private int connectionTries = 0;
 	public void setFileField(String value)
 	{
-		setProperty(FILE_FIELD,value);
+		setProperty(FILE_FIELD, value);
 	}
-
 	public String getFileField()
 	{
 		return getPropertyAsString(FILE_FIELD);
 	}
-
 	public void setFilename(String value)
 	{
-		setProperty(FILE_NAME,value);
+		setProperty(FILE_NAME, value);
 	}
-
 	public String getFilename()
 	{
 		return getPropertyAsString(FILE_NAME);
 	}
-
 	public void setProtocol(String value)
 	{
-		setProperty(PROTOCOL,value);
+		setProperty(PROTOCOL, value);
 	}
-
 	public String getProtocol()
 	{
-		return getPropertyAsString(PROTOCOL);
+		String protocol= getPropertyAsString(PROTOCOL);
+		if (protocol==null || protocol.equals(""))
+		{
+		  return DEFAULT_PROTOCOL;
+		}
+		else return protocol;
 	}
-
 	/**
 	 *  Sets the Path attribute of the UrlConfig object
 	 *
@@ -157,13 +158,13 @@ public class HTTPSampler extends AbstractSampler
 	 */
 	public void setPath(String path)
 	{
-		if(GET.equals(getMethod()))
+		if (GET.equals(getMethod()))
 		{
 			int index = path.indexOf("?");
-			if(index > -1)
+			if (index > -1)
 			{
-				setProperty(PATH,path.substring(0,index));
-				parseArguments(path.substring(index+1));
+				setProperty(PATH, path.substring(0, index));
+				parseArguments(path.substring(index + 1));
 			}
 			else
 			{
@@ -173,223 +174,198 @@ public class HTTPSampler extends AbstractSampler
 		else
 		{
 			setProperty(PATH, path);
-		}	
+		}
 	}
-
 	public String getPath()
 	{
 		return getPropertyAsString(PATH);
 	}
-
 	public void setFollowRedirects(boolean value)
 	{
 		setProperty(FOLLOW_REDIRECTS, new Boolean(value));
 	}
-
 	public boolean getFollowRedirects()
 	{
 		return getPropertyAsBoolean(FOLLOW_REDIRECTS);
 	}
-
 	public void setMethod(String value)
 	{
-		setProperty(METHOD,value);
+		setProperty(METHOD, value);
 	}
-
 	public String getMethod()
 	{
 		return getPropertyAsString(METHOD);
 	}
-
 	public void setUseKeepAlive(boolean value)
 	{
 		setProperty(USE_KEEPALIVE, new Boolean(value));
 	}
-
 	public boolean getUseKeepAlive()
 	{
 		return getPropertyAsBoolean(USE_KEEPALIVE);
 	}
-	
-	public void addEncodedArgument(String name,String value,String metaData)
+	public void addEncodedArgument(String name, String value, String metaData)
 	{
 		Arguments args = getArguments();
-		HTTPArgument arg = new HTTPArgument(name,value,metaData,true);
-		if(arg.getName().equals(arg.getEncodedName()) && arg.getValue().equals(arg.getEncodedValue()))
+		HTTPArgument arg = new HTTPArgument(name, value, metaData, true);
+		if (arg.getName().equals(arg.getEncodedName())
+			&& arg.getValue().equals(arg.getEncodedValue()))
 		{
 			arg.setAlwaysEncode(false);
 		}
 		args.addArgument(arg);
 	}
-	
-	public void addArgument(String name,String value)
+	public void addArgument(String name, String value)
 	{
 		Arguments args = this.getArguments();
-		args.addArgument(new HTTPArgument(name,value));
+		args.addArgument(new HTTPArgument(name, value));
 	}
-
-	public void addArgument(String name,String value,String metadata)
+	public void addArgument(String name, String value, String metadata)
 	{
 		Arguments args = this.getArguments();
-		args.addArgument(new HTTPArgument(name,value,metadata));
+		args.addArgument(new HTTPArgument(name, value, metadata));
 	}
-
 	public void setPort(int value)
 	{
-		setProperty(PORT,new Integer(value));
+		setProperty(PORT, new Integer(value));
 	}
-
 	public int getPort()
 	{
 		int port = getPropertyAsInt(PORT);
-		if(port == 0)
+		if (port == 0)
 		{
-			port = 80;
-			setPort(port);
+			if("https".equalsIgnoreCase(getProtocol()))
+			{
+				return 443;
+			}
+			return 80;
 		}
 		return port;
 	}
-
 	public void setDomain(String value)
 	{
-		setProperty(DOMAIN,value);
+		setProperty(DOMAIN, value);
 	}
-
 	public String getDomain()
 	{
-		return (String)getProperty(DOMAIN);
+		return (String) getProperty(DOMAIN);
 	}
-
 	public void setArguments(Arguments value)
 	{
-		setProperty(ARGUMENTS,value);
+		setProperty(ARGUMENTS, value);
 	}
-
 	public Arguments getArguments()
 	{
-		return (Arguments)getProperty(ARGUMENTS);
+		return (Arguments) getProperty(ARGUMENTS);
 	}
-
 	public void setAuthManager(AuthManager value)
 	{
-		setProperty(AUTH_MANAGER,value);
+		setProperty(AUTH_MANAGER, value);
 	}
-
 	public AuthManager getAuthManager()
 	{
-		return (AuthManager)getProperty(AUTH_MANAGER);
+		return (AuthManager) getProperty(AUTH_MANAGER);
 	}
-
 	public void setHeaderManager(HeaderManager value)
 	{
-		setProperty(HEADER_MANAGER,value);
+		setProperty(HEADER_MANAGER, value);
 	}
-
 	public HeaderManager getHeaderManager()
 	{
-		return (HeaderManager)getProperty(HEADER_MANAGER);
+		return (HeaderManager) getProperty(HEADER_MANAGER);
 	}
-
 	public void setCookieManager(CookieManager value)
 	{
-		setProperty(COOKIE_MANAGER,value);
+		setProperty(COOKIE_MANAGER, value);
 	}
-
 	public CookieManager getCookieManager()
 	{
-		return (CookieManager)getProperty(COOKIE_MANAGER);
+		return (CookieManager) getProperty(COOKIE_MANAGER);
 	}
-
 	public void setMimetype(String value)
 	{
-		setProperty(MIMETYPE,value);
+		setProperty(MIMETYPE, value);
 	}
-
 	public String getMimetype()
 	{
-		return (String)getProperty(MIMETYPE);
+		return (String) getProperty(MIMETYPE);
 	}
-
 	protected void addCustomTestElement(TestElement element)
 	{
-		if(element instanceof Arguments)
+		if (element instanceof Arguments)
 		{
-			if(getProperty(ARGUMENTS) != null)
+			if (getProperty(ARGUMENTS) != null)
 			{
-				((Arguments)getProperty(ARGUMENTS)).addTestElement(element);
+				((Arguments) getProperty(ARGUMENTS)).addTestElement(element);
 			}
 			else
 			{
-				setProperty(ARGUMENTS,element);
+				setProperty(ARGUMENTS, element);
 			}
 		}
-		else if(element instanceof AuthManager)
+		else if (element instanceof AuthManager)
 		{
-			if(getProperty(AUTH_MANAGER) != null)
+			if (getProperty(AUTH_MANAGER) != null)
 			{
-				((TestElement)getProperty(AUTH_MANAGER)).addTestElement(element);
+				((TestElement) getProperty(AUTH_MANAGER)).addTestElement(element);
 			}
 			else
 			{
-				setProperty(AUTH_MANAGER,element);
+				setProperty(AUTH_MANAGER, element);
 			}
 		}
-		else if(element instanceof CookieManager)
+		else if (element instanceof CookieManager)
 		{
-			if(getProperty(COOKIE_MANAGER) != null)
+			if (getProperty(COOKIE_MANAGER) != null)
 			{
-				((TestElement)getProperty(COOKIE_MANAGER)).addTestElement(element);
+				((TestElement) getProperty(COOKIE_MANAGER)).addTestElement(element);
 			}
 			else
 			{
-				setProperty(COOKIE_MANAGER,element);
+				setProperty(COOKIE_MANAGER, element);
 			}
 		}
-		else if(element instanceof HeaderManager)
+		else if (element instanceof HeaderManager)
 		{
-			if(getProperty(HEADER_MANAGER) != null)
+			if (getProperty(HEADER_MANAGER) != null)
 			{
-				((TestElement)getProperty(HEADER_MANAGER)).addTestElement(element);
+				((TestElement) getProperty(HEADER_MANAGER)).addTestElement(element);
 			}
 			else
 			{
-				setProperty(HEADER_MANAGER,element);
+				setProperty(HEADER_MANAGER, element);
 			}
 		}
-		else if(element instanceof HTTPSampler ||
-				element instanceof ConfigTestElement)
+		else if (
+			element instanceof HTTPSampler || element instanceof ConfigTestElement)
 		{
 			this.mergeIn(element);
 		}
 	}
-
 	/****************************************
 	 * !ToDo (Field description)
 	 ***************************************/
 	protected final static String NON_HTTP_RESPONSE_CODE =
-			"Non HTTP response code";
+		"Non HTTP response code";
 	/****************************************
 	 * !ToDo (Field description)
 	 ***************************************/
 	protected final static String NON_HTTP_RESPONSE_MESSAGE =
-			"Non HTTP response message";
-
-	private static Category catClass = Category.getInstance(
-			HTTPSampler.class.getName());
-
+		"Non HTTP response message";
+	transient private static Logger log =
+		Hierarchy.getDefaultHierarchy().getLoggerFor("jmeter.protocol.http");
 	/****************************************
 	 * Holds a list of URLs sampled - so we're not flooding stdout with debug
 	 * information
 	 ***************************************/
 	private ArrayList m_sampledURLs = new ArrayList();
-
 	/****************************************
 	 * Constructor for the HTTPSampler object
 	 ***************************************/
-	public HTTPSampler() {
+	public HTTPSampler()
+	{
 		setArguments(new Arguments());
 	}
-	
 	public HTTPSampler(URL u)
 	{
 		setMethod(GET);
@@ -402,25 +378,22 @@ public class HTTPSampler extends AbstractSampler
 		setUseKeepAlive(true);
 		setArguments(new Arguments());
 	}
-
 	/****************************************
 	 * Do a sampling and return its results.
 	 *
 	 *@param e  <code>Entry</code> to be sampled
 	 *@return   results of the sampling
 	 *@see      org.apache.jmeter.protocol.http.sampler.HTTPSampler.sample(org.apache.jmeter.samplers.Entry,
-	 *      boolean)
+	 *      int)
 	 ***************************************/
 	public SampleResult sample(Entry e)
 	{
-		return sample(false);
+		return sample(0);
 	}
-
 	public SampleResult sample()
 	{
-		return sample(false);
+		return sample(0);
 	}
-
 	/**
 	 *  !ToDoo (Method description)
 	 *
@@ -430,10 +403,10 @@ public class HTTPSampler extends AbstractSampler
 	public URL getUrl() throws MalformedURLException
 	{
 		String pathAndQuery = null;
-
-		if (this.getMethod().equals(HTTPSampler.GET) && getQueryString().length() > 0)
+		if (this.getMethod().equals(HTTPSampler.GET)
+			&& getQueryString().length() > 0)
 		{
-			if(this.getPath().indexOf("?") > -1)
+			if (this.getPath().indexOf("?") > -1)
 			{
 				pathAndQuery = this.getPath() + "&" + getQueryString();
 			}
@@ -446,23 +419,23 @@ public class HTTPSampler extends AbstractSampler
 		{
 			pathAndQuery = this.getPath();
 		}
-
 		if (!pathAndQuery.startsWith("/"))
 		{
 			pathAndQuery = "/" + pathAndQuery;
 		}
-
 		if (getPort() == 0)
 		{
 			return new URL(getProtocol(), getDomain(), pathAndQuery);
 		}
 		else
 		{
-			return new URL(getProtocol(), (String) getProperty(HTTPSampler.DOMAIN), getPort(),
-					pathAndQuery);
+			return new URL(
+				getProtocol(),
+				(String) getProperty(HTTPSampler.DOMAIN),
+				getPort(),
+				pathAndQuery);
 		}
 	}
-
 	/**
 	 *  Gets the QueryString attribute of the UrlConfig object
 	 *
@@ -485,10 +458,11 @@ public class HTTPSampler extends AbstractSampler
 				first = false;
 			}
 			buf.append(item.getEncodedName());
-			if ( item.getMetaData() == null) {
-			    buf.append("=");
-			} 
-			else 
+			if (item.getMetaData() == null)
+			{
+				buf.append("=");
+			}
+			else
 			{
 				buf.append(item.getMetaData());
 			}
@@ -497,6 +471,17 @@ public class HTTPSampler extends AbstractSampler
 		return buf.toString();
 	}
 
+	/****************************************
+	 * Set request headers in preparation to opening a connection
+	 *
+	 *@param connection       <code>URLConnection</code> to set headers on
+	 *@exception IOException  if an I/O exception occurs
+	 ***************************************/
+	public void setPostHeaders(URLConnection conn) throws IOException
+	{
+		postWriter.setHeaders(conn, this);
+	}
+
 	/****************************************
 	 * Send POST data from <code>Entry</code> to the open connection.
 	 *
@@ -505,10 +490,9 @@ public class HTTPSampler extends AbstractSampler
 	 *@param url              contains the query string for POST
 	 *@exception IOException  if an I/O exception occurs
 	 ***************************************/
-	public void sendPostData(URLConnection connection)
-			 throws IOException
+	public void sendPostData(URLConnection connection) throws IOException
 	{
-		postWriter.sendPostData(connection,this);
+		postWriter.sendPostData(connection, this);
 	}
 
 	/****************************************
@@ -520,15 +504,10 @@ public class HTTPSampler extends AbstractSampler
 	 *@return                 <code>HttpURLConnection</code> of the URL request
 	 *@exception IOException  if an I/O Exception occurs
 	 ***************************************/
-	protected HttpURLConnection setupConnection(URL u,String method) throws IOException
+	protected HttpURLConnection setupConnection(URL u, String method)
+		throws IOException
 	{
 		HttpURLConnection conn;
-		conn = (HttpURLConnection)u.openConnection();
-		// delegate SSL specific stuff to SSLManager so that compilation still works otherwise.
-		if("https".equals(u.getProtocol()))
-		{
-			SSLManager.getInstance().setContext(conn);
-		}
 		// [Jordi <jsalvata@atg.com>]
 		// I've not been able to find out why we're not using this
 		// feature of HttpURLConnections and we're doing redirection
@@ -538,7 +517,22 @@ public class HTTPSampler extends AbstractSampler
 		// it doesn't seem like they're working on this.
 		// My longer term plan is to use Apache's home grown HTTP Client, or
 		// maybe even HTTPUnit's classes.  I'm sure both would be better than Sun's
-		conn.setFollowRedirects(false);
+		HttpURLConnection.setFollowRedirects(false);
+		conn = (HttpURLConnection) u.openConnection();
+		// delegate SSL specific stuff to SSLManager so that compilation still works otherwise.
+		if ("https".equals(u.getProtocol()))
+		{
+			try
+			{
+				SSLManager.getInstance().setContext(conn);
+			}
+			catch (Exception e)
+			{
+				log.warn(
+					"You may have forgotten to set the ssl.provider property in jmeter.properties",
+					e);
+			}
+		}
 		// a well-bahaved browser is supposed to send 'Connection: close'
 		// with the last request to an HTTP server. Instead, most browsers
 		// leave it to the server to close the connection after their
@@ -557,55 +551,54 @@ public class HTTPSampler extends AbstractSampler
 		setConnectionAuthorization(conn, u, getAuthManager());
 		return conn;
 	}
-	
-	     //Mark Walsh 2002-08-03, modified to also parse a parameter name value
-        //string, where string contains only the parameter name and no equal sign.
+	//Mark Walsh 2002-08-03, modified to also parse a parameter name value
+	//string, where string contains only the parameter name and no equal sign.
 	/**
 	 * This method allows a proxy server to send over the raw text from a browser's
 	 * output stream to be parsed and stored correctly into the UrlConfig object.
 	 */
-	public void 	parseArguments(String queryString)
+	public void parseArguments(String queryString)
 	{
-		String[] args = JMeterUtils.split(queryString, "&");
+		String[] args = JOrphanUtils.split(queryString, "&");
 		for (int i = 0; i < args.length; i++)
 		{
 			// need to handle four cases:   string contains name=value
 			//                              string contains name=
-			//                              string contains name 
+			//                              string contains name
 			//                              empty string
-			// find end of parameter name 
-			int endOfNameIndex=0; 
+			// find end of parameter name
+			int endOfNameIndex = 0;
 			String metaData = ""; // records the existance of an equal sign
-			if (args[i].indexOf("=") != -1) 
+			if (args[i].indexOf("=") != -1)
 			{
 				endOfNameIndex = args[i].indexOf("="); // case of name=value, name=
-				metaData="=";
-		   } 
-		   else 
-		   {
-				metaData="";
-				if (args[i].length() > 0) 
+				metaData = "=";
+			}
+			else
+			{
+				metaData = "";
+				if (args[i].length() > 0)
 				{
-					endOfNameIndex = args[i].length() ; // case name
-				} 
-				else 
+					endOfNameIndex = args[i].length(); // case name
+				}
+				else
 				{
-					endOfNameIndex=0; //case where name value string is empty
+					endOfNameIndex = 0; //case where name value string is empty
 				}
 			}
-		    // parse name
-		    String name="";  // for empty string
-		    if (args[i].length() >0) {
-			name = args[i].substring(0,endOfNameIndex); //for non empty string
-		    }
-
-                    // parse value
-		    String value="";
-		    if ((endOfNameIndex+1) < args[i].length()) {
-			value = args[i].substring(endOfNameIndex+1,args[i].length());
-		    }
-
-                    if (name.length() > 0)
+			// parse name
+			String name = ""; // for empty string
+			if (args[i].length() > 0)
+			{
+				name = args[i].substring(0, endOfNameIndex); //for non empty string
+			}
+			// parse value
+			String value = "";
+			if ((endOfNameIndex + 1) < args[i].length())
+			{
+				value = args[i].substring(endOfNameIndex + 1, args[i].length());
+			}
+			if (name.length() > 0)
 			{
 				// In JDK 1.2, the decode() method has a throws clause:
 				// "throws Exception". In JDK 1.3, the method does not have
@@ -613,17 +606,21 @@ public class HTTPSampler extends AbstractSampler
 				// we need to add a try/catch around the method call.
 				try
 				{
-					addEncodedArgument(name,value, metaData);
+					addEncodedArgument(name, value, metaData);
 				}
 				catch (Exception e)
 				{
-					System.out.println("UrlConfig:parseArguments(): Unable to parse argument=[" + value + "]");
-					System.out.println("UrlConfig:parseArguments(): queryString=[" + queryString + "]");
+					log.error(
+						"UrlConfig:parseArguments(): Unable to parse argument=["
+							+ value
+							+ "]");
+					log.error(
+						"UrlConfig:parseArguments(): queryString=[" + queryString + "]",
+						e);
 				}
 			}
 		}
 	}
-
 	/****************************************
 	 * Reads the response from the URL connection
 	 *
@@ -634,10 +631,18 @@ public class HTTPSampler extends AbstractSampler
 	protected byte[] readResponse(HttpURLConnection conn) throws IOException
 	{
 		byte[] buffer = new byte[4096];
-		BufferedInputStream in = new BufferedInputStream(conn.getInputStream());
+		BufferedInputStream in;
+		try
+		{
+			in = new BufferedInputStream(conn.getInputStream());
+		}
+		catch (Exception e)
+		{
+			in = new BufferedInputStream(conn.getErrorStream());
+		}
 		java.io.ByteArrayOutputStream w = new ByteArrayOutputStream();
 		int x = 0;
-		while((x = in.read(buffer)) > -1)
+		while ((x = in.read(buffer)) > -1)
 		{
 			w.write(buffer, 0, x);
 		}
@@ -646,7 +651,6 @@ public class HTTPSampler extends AbstractSampler
 		w.close();
 		return w.toByteArray();
 	}
-
 	/****************************************
 	 * Gets the ResponseHeaders from the URLConnection, save them to the
 	 * SampleResults object.
@@ -654,21 +658,19 @@ public class HTTPSampler extends AbstractSampler
 	 *@param conn  connection from which the headers are read
 	 *@param res   where the headers read are stored
 	 ***************************************/
-	protected byte[] getResponseHeaders(HttpURLConnection conn, SampleResult res) throws IOException
+	protected byte[] getResponseHeaders(HttpURLConnection conn, SampleResult res)
+		throws IOException
 	{
 		StringBuffer headerBuf = new StringBuffer();
-		//PrintWriter headerBytes = new PrintWriter(output);
-
-		// either 'HTTP/1.0' or 'HTTP/1.1'
 		headerBuf.append(conn.getHeaderField(0).substring(0, 8));
 		headerBuf.append(" ");
 		headerBuf.append(conn.getResponseCode());
 		headerBuf.append(" ");
 		headerBuf.append(conn.getResponseMessage());
 		headerBuf.append("\n");
-		for(int i = 1; conn.getHeaderFieldKey(i) != null; i++)
+		for (int i = 1; conn.getHeaderFieldKey(i) != null; i++)
 		{
-			if(!conn.getHeaderFieldKey(i).equalsIgnoreCase("transfer-encoding"))
+			if (!conn.getHeaderFieldKey(i).equalsIgnoreCase("transfer-encoding"))
 			{
 				headerBuf.append(conn.getHeaderFieldKey(i));
 				headerBuf.append(": ");
@@ -679,15 +681,6 @@ public class HTTPSampler extends AbstractSampler
 		headerBuf.append("\n");
 		return headerBuf.toString().getBytes("8859_1");
 	}
-
-	/*
-	 * Uploading a file - put in separate sampler
-	 * else if (contentType.equals(MULTIPART_FORM))
-	 * {
-	 *
-	 * }
-	 * }
-	 */
 	/****************************************
 	 * Extracts all the required cookies for that particular URL request and set
 	 * them in the <code>HttpURLConnection</code> passed in
@@ -698,18 +691,20 @@ public class HTTPSampler extends AbstractSampler
 	 *@param cookieManager  the <code>CookieManager</code> containing all the
 	 *      cookies for this <code>UrlConfig</code>
 	 ***************************************/
-	private void setConnectionCookie(HttpURLConnection conn, URL u, CookieManager cookieManager)
+	private void setConnectionCookie(
+		HttpURLConnection conn,
+		URL u,
+		CookieManager cookieManager)
 	{
-		if(cookieManager != null)
+		if (cookieManager != null)
 		{
 			String cookieHeader = cookieManager.getCookieHeaderForURL(u);
-			if(cookieHeader != null)
+			if (cookieHeader != null)
 			{
 				conn.setRequestProperty("Cookie", cookieHeader);
 			}
 		}
 	}
-
 	/****************************************
 	 * Extracts all the required headers for that particular URL request and set
 	 * them in the <code>HttpURLConnection</code> passed in
@@ -720,23 +715,25 @@ public class HTTPSampler extends AbstractSampler
 	 *@param headerManager  the <code>HeaderManager</code> containing all the
 	 *      cookies for this <code>UrlConfig</code>
 	 ***************************************/
-	private void setConnectionHeaders(HttpURLConnection conn, URL u, HeaderManager headerManager)
+	private void setConnectionHeaders(
+		HttpURLConnection conn,
+		URL u,
+		HeaderManager headerManager)
 	{
-		if(headerManager != null)
+		if (headerManager != null)
 		{
 			Collection headers = headerManager.getHeaders();
-			if(headers != null)
+			if (headers != null)
 			{
 				Iterator i = headers.iterator();
-				while(i.hasNext())
+				while (i.hasNext())
 				{
-					Header header = (Header)i.next();
+					Header header = (Header) i.next();
 					conn.setRequestProperty(header.getName(), header.getValue());
 				}
 			}
 		}
 	}
-
 	/****************************************
 	 * Extracts all the required authorization for that particular URL request and
 	 * set them in the <code>HttpURLConnection</code> passed in
@@ -747,18 +744,20 @@ public class HTTPSampler extends AbstractSampler
 	 *@param authManager  the <code>AuthManager</code> containing all the cookies
 	 *      for this <code>UrlConfig</code>
 	 ***************************************/
-	private void setConnectionAuthorization(HttpURLConnection conn, URL u, AuthManager authManager)
+	private void setConnectionAuthorization(
+		HttpURLConnection conn,
+		URL u,
+		AuthManager authManager)
 	{
-		if(authManager != null)
+		if (authManager != null)
 		{
 			String authHeader = authManager.getAuthHeaderForURL(u);
-			if(authHeader != null)
+			if (authHeader != null)
 			{
 				conn.setRequestProperty("Authorization", authHeader);
 			}
 		}
 	}
-
 	/****************************************
 	 * Get the response code of the URL connection and divide it by 100 thus
 	 * returning 2(for 2xx response codes), 3(for 3xx reponse codes), etc
@@ -768,22 +767,24 @@ public class HTTPSampler extends AbstractSampler
 	 *@param time  time when the URL request was first started
 	 *@return      HTTP response code divided by 100
 	 ***************************************/
-	private int getErrorLevel(HttpURLConnection conn, SampleResult res, long time) throws IOException
+	private int getErrorLevel(
+		HttpURLConnection conn,
+		SampleResult res,
+		long time)
+		throws IOException
 	{
 		int errorLevel = 200;
 		String message = null;
-		errorLevel = ((HttpURLConnection)conn).getResponseCode();
-		message = ((HttpURLConnection)conn).getResponseMessage();
+		errorLevel = ((HttpURLConnection) conn).getResponseCode();
+		message = ((HttpURLConnection) conn).getResponseMessage();
 		res.setResponseCode(String.valueOf(errorLevel));
 		res.setResponseMessage(message);
 		return errorLevel;
 	}
-	
 	public void removeArguments()
 	{
-		setProperty(HTTPSampler.ARGUMENTS,new Arguments());
+		setProperty(HTTPSampler.ARGUMENTS, new Arguments());
 	}
-
 	/****************************************
 	 * Follow redirection manually. Normally if the web server does a redirection
 	 * the intermediate page is not returned. Only the resultant page and the
@@ -797,132 +798,168 @@ public class HTTPSampler extends AbstractSampler
 	 *@param urlConfig                  !ToDo (Parameter description)
 	 *@exception MalformedURLException  if URL is not understood
 	 ***************************************/
-	private void redirectUrl(HttpURLConnection conn, URL u) throws MalformedURLException
+	private void redirectUrl(HttpURLConnection conn, URL u)
+		throws MalformedURLException
 	{
 		String loc = conn.getHeaderField("Location");
-		if(loc != null)
+		if (loc != null)
 		{
-			if(loc.indexOf("http") == -1)
+			if (loc.indexOf("http") == -1)
 			{
 				String tempURL = u.toString();
-				if(loc.startsWith("/"))
+				if (loc.startsWith("/"))
 				{
 					int ind = tempURL.indexOf("//") + 2;
-					loc = tempURL.substring(0, tempURL.indexOf("/", ind) + 1) + loc.substring(1);
+					loc =
+						tempURL.substring(0, tempURL.indexOf("/", ind) + 1)
+							+ loc.substring(1);
 				}
 				else
 				{
-					loc = u.toString().substring(0,
-							u.toString().lastIndexOf('/') + 1) + loc;
+					loc =
+						u.toString().substring(0, u.toString().lastIndexOf('/') + 1) + loc;
 				}
 			}
 		}
 		URL newUrl = new URL(loc);
 		setMethod(GET);
+		setProtocol(newUrl.getProtocol());
 		setDomain(newUrl.getHost());
+		setPort(newUrl.getPort());
 		setPath(newUrl.getFile());
 		removeArguments();
 		parseArguments(newUrl.getQuery());
 	}
 
+	protected long connect() throws IOException
+	{
+		long time = System.currentTimeMillis();
+		try
+		{
+			conn.connect();
+		}
+		catch(BindException e)
+		{
+			log.debug("Bind exception, try again");
+			if(connectionTries++ == 10)
+			{
+				log.error("Can't connect",e);
+				throw e;
+			}
+			conn.disconnect();
+			conn = null;
+			System.gc();
+			Runtime.getRuntime().runFinalization();
+			this.setUseKeepAlive(false);
+			conn = setupConnection(getUrl(),getMethod());
+			if(getMethod().equals(HTTPSampler.POST))
+			{
+				setPostHeaders(conn);
+			}
+			time = connect();
+		}
+		catch(IOException e)
+		{
+			log.debug("Connection failed, giving up");
+			conn.disconnect();
+			conn = null;
+			System.gc();
+			Runtime.getRuntime().runFinalization();
+			throw e;
+		}
+		return time;
+	}
+
 	/****************************************
 	 * Samples <code>Entry</code> passed in and stores the result in <code>SampleResult</code>
 	 *
 	 *@param e           <code>Entry</code> to be sampled
-	 *@param redirected  whether we're processing a redirect
+	 *@param redirects   the level of redirection we're processing (0 means
+	 *			original request) -- just used to prevent
+	 *			an infinite loop.
 	 *@return            results of the sampling
 	 ***************************************/
-	private SampleResult sample(boolean redirected)
+	private SampleResult sample(int redirects)
 	{
-		catClass.debug("Start : sample2");
-		long time = 0L;
+		log.debug("Start : sample2");
+		long time = System.currentTimeMillis();
 		SampleResult res = new SampleResult();
-		if(redirected)
-		{
-			//url.removeArguments();
-			// [Jordi <jsalvata@atg.com>
-			// TO-DO: I need to investigate why this is necessary.
-			// ...although it won't do any harm...
-			// [/Jordi]
-			// Mike: arguments will be sent otherwise, which is not the way a browser
-			// behaves.  That's not to say it's perfect as is...
-		}
 		URL u = null;
-		HttpURLConnection conn = null;
 		try
 		{
 			u = getUrl();
 			res.setSampleLabel(getName());
 			// specify the data to the result.
 			res.setSamplerData(this);
-
 			/****************************************
 			 * END - cached logging hack
 			 ***************************************/
-
-			if(catClass.isDebugEnabled())
+			if (log.isDebugEnabled())
 			{
-				catClass.debug("sample2 : sampling url - " + u);
+				log.debug("sample2 : sampling url - " + u);
 			}
-			conn = setupConnection(u,getMethod());
-			// [Jordi <jsalvata@atg.com>]
-			// There's some illegality here... see my comment in sendPostData.
-			// Also, we don't seem to be including the time needed to send the POST
-			// data in the count... should we? - mike: good point, I changed it
-			// TO-DO: Is there something I'm missing here?
-			// [/Jordi]			
-			time = System.currentTimeMillis();
-			if(!redirected &&
-			    getProperty(HTTPSampler.METHOD).equals(HTTPSampler.POST))
+			conn = setupConnection(u, getMethod());
+			if (getProperty(HTTPSampler.METHOD).equals(HTTPSampler.POST))
 			{
+				setPostHeaders(conn);
+				time = connect();
 				sendPostData(conn);
 			}
-			conn.connect();
+			else time = connect();
 			saveConnectionCookies(conn, u, getCookieManager());
-
 			int errorLevel = 0;
 			try
 			{
 				errorLevel = getErrorLevel(conn, res, time);
 			}
-			catch(IOException e)
+			catch (IOException e)
 			{
+				time = bundleResponseInResult(time, res, conn);
 				res.setSuccessful(false);
-				time = bundleResponseInResult(time,res,conn);
+				res.setTime(time);
 				return res;
-			}				
-			if(errorLevel/100 == 2 || errorLevel == 304)
+			}
+			if (errorLevel / 100 == 2 || errorLevel == 304)
 			{
 				time = bundleResponseInResult(time, res, conn);
 			}
-			else if(errorLevel/100 == 3)
+			else if (errorLevel / 100 == 3)
 			{
-				if(redirected || !getFollowRedirects())
+				if (redirects >= MAX_REDIRECTS)
 				{
-					time = bundleResponseInResult(time,res,conn);
+					throw new IOException("Maximum number of redirects exceeded");
+				}
+
+				if (!getFollowRedirects())
+				{
+					time = bundleResponseInResult(time, res, conn);
 				}
 				else
 				{
-					redirectUrl(conn, u);
-	
 					time = System.currentTimeMillis() - time;
-					res = sample(true);
-					time += res.getTime();	
+
+					HTTPSampler redirect= (HTTPSampler)this.clone();
+					redirect.redirectUrl(conn, u);
+					SampleResult redirectResult= redirect.sample(redirects+1);
+					res.addSubResult(redirectResult);
+					res.setResponseData(redirectResult.getResponseData());
+					time += redirectResult.getTime();
 				}
 			}
 			else
 			{
-				// Could not sample the URL								
-				time = bundleResponseInResult(time,res,conn);
+				// Could not sample the URL
+				time = bundleResponseInResult(time, res, conn);
 				res.setSuccessful(false);
 			}
 			res.setTime(time);
-			catClass.debug("End : sample2");
+			log.debug("End : sample2");
 			return res;
 		}
-		catch(IOException ex)
+		catch (IOException ex)
 		{
-			//ex.printStackTrace();
+			log.warn(ex.getMessage(), ex);
+			res.setDataType(res.TEXT);
 			res.setResponseData(ex.toString().getBytes());
 			res.setResponseCode(NON_HTTP_RESPONSE_CODE);
 			res.setResponseMessage(NON_HTTP_RESPONSE_MESSAGE);
@@ -933,36 +970,38 @@ public class HTTPSampler extends AbstractSampler
 		{
 			try
 			{
-				// the server can request that the connection be closed,
-				// but if we requested that the server close the connection
-				// the server should echo back our 'close' request.
-				// Otherwise, let the server disconnect the connection
-				// when its timout period is reached.
+				// calling disconnect doesn't close the connection immediately, but
+				// indicates we're through with it.  The JVM should close it when
+				// necessary.
 				String connection  = conn.getHeaderField("Connection");
 				if (connection == null || connection.equalsIgnoreCase("close"))
 					conn.disconnect();
 			}
-			catch(Exception e){}
+			catch (Exception e)
+			{
+			}
+
 		}
-		catClass.debug("End : sample2");
+		log.debug("End : sample2");
 		return res;
 	}
-
-	private long bundleResponseInResult(long time, SampleResult 
-			res, HttpURLConnection conn) throws IOException, 
-			FileNotFoundException {
+	private long bundleResponseInResult(
+		long time,
+		SampleResult res,
+		HttpURLConnection conn)
+		throws IOException, FileNotFoundException
+	{
+		res.setDataType(res.TEXT);
 		byte[] ret = readResponse(conn);
 		byte[] head = getResponseHeaders(conn, res);
 		time = System.currentTimeMillis() - time;
-		byte[] complete = new byte[ret.length+head.length];
-		System.arraycopy(head,0,complete,0,head.length);
-		System.arraycopy(ret,0,complete,head.length,ret.length);
+		byte[] complete = new byte[ret.length + head.length];
+		System.arraycopy(head, 0, complete, 0, head.length);
+		System.arraycopy(ret, 0, complete, head.length, ret.length);
 		res.setResponseData(complete);
 		res.setSuccessful(true);
-		res.setDataType(res.TEXT);
 		return time;
 	}
-
 	/****************************************
 	 * From the <code>HttpURLConnection</code>, store all the "set-cookie" key-pair
 	 * values in the cookieManager of the <code>UrlConfig</code>
@@ -973,149 +1012,161 @@ public class HTTPSampler extends AbstractSampler
 	 *@param cookieManager  the <code>CookieManager</code> containing all the
 	 *      cookies for this <code>UrlConfig</code>
 	 ***************************************/
-	private void saveConnectionCookies(HttpURLConnection conn, URL u, CookieManager cookieManager)
+	private void saveConnectionCookies(
+		HttpURLConnection conn,
+		URL u,
+		CookieManager cookieManager)
 	{
-		if(cookieManager != null)
+		if (cookieManager != null)
 		{
-			for(int i = 1; conn.getHeaderFieldKey(i) != null; i++)
+			for (int i = 1; conn.getHeaderFieldKey(i) != null; i++)
 			{
-				if(conn.getHeaderFieldKey(i).equalsIgnoreCase("set-cookie"))
+				if (conn.getHeaderFieldKey(i).equalsIgnoreCase("set-cookie"))
 				{
 					cookieManager.addCookieFromHeader(conn.getHeaderField(i), u);
 				}
 			}
 		}
 	}
-	
 	public String toString()
 	{
-		try {
-			return this.getUrl().toString()+((POST.equals(getMethod())) ?
-					"\nQuery Data: "+getQueryString() : "");
-		} catch(MalformedURLException e) {
+		try
+		{
+			return this.getUrl().toString()
+				+ ((POST.equals(getMethod())) ? "\nQuery Data: " + getQueryString() : "");
+		}
+		catch (MalformedURLException e)
+		{
 			return "";
 		}
 	}
-	
 	public static class Test extends junit.framework.TestCase
 	{
 		public Test(String name)
 		{
 			super(name);
 		}
-
 		public void testMakingUrl() throws Exception
 		{
 			HTTPSampler config = new HTTPSampler();
 			config.setProtocol("http");
 			config.setMethod(HTTPSampler.GET);
-			config.addArgument("param1","value1");
+			config.addArgument("param1", "value1");
 			config.setPath("/index.html");
 			config.setDomain("www.apache.org");
-			assertEquals("http://www.apache.org:80/index.html?param1=value1",config.getUrl().toString());
+			assertEquals(
+				"http://www.apache.org:80/index.html?param1=value1",
+				config.getUrl().toString());
 		}
-		
 		public void testMakingUrl2() throws Exception
 		{
 			HTTPSampler config = new HTTPSampler();
 			config.setProtocol("http");
 			config.setMethod(HTTPSampler.GET);
-			config.addArgument("param1","value1");
+			config.addArgument("param1", "value1");
 			config.setPath("/index.html?p1=p2");
 			config.setDomain("www.apache.org");
-			assertEquals("http://www.apache.org:80/index.html?param1=value1&p1=p2",config.getUrl().toString());
+			assertEquals(
+				"http://www.apache.org:80/index.html?param1=value1&p1=p2",
+				config.getUrl().toString());
 		}
-		
 		public void testMakingUrl3() throws Exception
 		{
 			HTTPSampler config = new HTTPSampler();
 			config.setProtocol("http");
 			config.setMethod(HTTPSampler.POST);
-			config.addArgument("param1","value1");
+			config.addArgument("param1", "value1");
 			config.setPath("/index.html?p1=p2");
 			config.setDomain("www.apache.org");
-			assertEquals("http://www.apache.org:80/index.html?p1=p2",config.getUrl().toString());
+			assertEquals(
+				"http://www.apache.org:80/index.html?p1=p2",
+				config.getUrl().toString());
 		}
-
-	        // test cases for making Url, and exercise method addArgument(String name,String value,String metadata)
+		// test cases for making Url, and exercise method addArgument(String name,String value,String metadata)
 		public void testMakingUrl4() throws Exception
 		{
 			HTTPSampler config = new HTTPSampler();
 			config.setProtocol("http");
 			config.setMethod(HTTPSampler.GET);
-			config.addArgument("param1","value1","=");
+			config.addArgument("param1", "value1", "=");
 			config.setPath("/index.html");
 			config.setDomain("www.apache.org");
-			assertEquals("http://www.apache.org:80/index.html?param1=value1",config.getUrl().toString());
+			assertEquals(
+				"http://www.apache.org:80/index.html?param1=value1",
+				config.getUrl().toString());
 		}
-
 		public void testMakingUrl5() throws Exception
 		{
 			HTTPSampler config = new HTTPSampler();
 			config.setProtocol("http");
 			config.setMethod(HTTPSampler.GET);
-			config.addArgument("param1","","=");
+			config.addArgument("param1", "", "=");
 			config.setPath("/index.html");
 			config.setDomain("www.apache.org");
-			assertEquals("http://www.apache.org:80/index.html?param1=",config.getUrl().toString());
+			assertEquals(
+				"http://www.apache.org:80/index.html?param1=",
+				config.getUrl().toString());
 		}
-
 		public void testMakingUrl6() throws Exception
 		{
 			HTTPSampler config = new HTTPSampler();
 			config.setProtocol("http");
 			config.setMethod(HTTPSampler.GET);
-			config.addArgument("param1","","");
+			config.addArgument("param1", "", "");
 			config.setPath("/index.html");
 			config.setDomain("www.apache.org");
-			assertEquals("http://www.apache.org:80/index.html?param1",config.getUrl().toString());
+			assertEquals(
+				"http://www.apache.org:80/index.html?param1",
+				config.getUrl().toString());
 		}
-
-	        // test cases for making Url, and exercise method parseArguments(String queryString)
+		// test cases for making Url, and exercise method parseArguments(String queryString)
 		public void testMakingUrl7() throws Exception
 		{
 			HTTPSampler config = new HTTPSampler();
 			config.setProtocol("http");
 			config.setMethod(HTTPSampler.GET);
-			config. parseArguments("param1=value1");
+			config.parseArguments("param1=value1");
 			config.setPath("/index.html");
 			config.setDomain("www.apache.org");
-			assertEquals("http://www.apache.org:80/index.html?param1=value1",config.getUrl().toString());
+			assertEquals(
+				"http://www.apache.org:80/index.html?param1=value1",
+				config.getUrl().toString());
 		}
-
 		public void testMakingUrl8() throws Exception
 		{
 			HTTPSampler config = new HTTPSampler();
 			config.setProtocol("http");
 			config.setMethod(HTTPSampler.GET);
-			config. parseArguments("param1=");
+			config.parseArguments("param1=");
 			config.setPath("/index.html");
 			config.setDomain("www.apache.org");
-			assertEquals("http://www.apache.org:80/index.html?param1=",config.getUrl().toString());
+			assertEquals(
+				"http://www.apache.org:80/index.html?param1=",
+				config.getUrl().toString());
 		}
-
 		public void testMakingUrl9() throws Exception
 		{
 			HTTPSampler config = new HTTPSampler();
 			config.setProtocol("http");
 			config.setMethod(HTTPSampler.GET);
-			config. parseArguments("param1");
+			config.parseArguments("param1");
 			config.setPath("/index.html");
 			config.setDomain("www.apache.org");
-			assertEquals("http://www.apache.org:80/index.html?param1",config.getUrl().toString());
+			assertEquals(
+				"http://www.apache.org:80/index.html?param1",
+				config.getUrl().toString());
 		}
-
 		public void testMakingUrl10() throws Exception
 		{
 			HTTPSampler config = new HTTPSampler();
 			config.setProtocol("http");
 			config.setMethod(HTTPSampler.GET);
-			config. parseArguments("");
+			config.parseArguments("");
 			config.setPath("/index.html");
 			config.setDomain("www.apache.org");
-			assertEquals("http://www.apache.org:80/index.html",config.getUrl().toString());
+			assertEquals(
+				"http://www.apache.org:80/index.html",
+				config.getUrl().toString());
 		}
-
 	}
-
 }
diff --git a/jakarta-jmeter/src/protocol/http/org/apache/jmeter/protocol/http/sampler/HTTPSamplerFull.java b/jakarta-jmeter/src/protocol/http/org/apache/jmeter/protocol/http/sampler/HTTPSamplerFull.java
index 6b45869..a4513b2 100644
--- a/jakarta-jmeter/src/protocol/http/org/apache/jmeter/protocol/http/sampler/HTTPSamplerFull.java
+++ b/jakarta-jmeter/src/protocol/http/org/apache/jmeter/protocol/http/sampler/HTTPSamplerFull.java
@@ -2,7 +2,7 @@
  * ====================================================================
  * The Apache Software License, Version 1.1
  *
- * Copyright (c) 2001 The Apache Software Foundation.  All rights
+ * Copyright (c) 2001-2003 The Apache Software Foundation.  All rights
  * reserved.
  *
  * Redistribution and use in source and binary forms, with or without
@@ -54,23 +54,27 @@
  */
 package org.apache.jmeter.protocol.http.sampler;
 
-import org.apache.jmeter.protocol.http.sampler.HTTPSampler;
-import org.apache.jmeter.protocol.http.config.*;
-import org.apache.jmeter.samplers.*;
-
-import java.util.*;
-import java.net.*;
-
-import javax.swing.ImageIcon;
-
-import org.apache.log4j.*;
+import java.io.ByteArrayInputStream;
+import java.io.FileOutputStream;
+import java.io.IOException;
+import java.io.UnsupportedEncodingException;
+import java.net.HttpURLConnection;
+import java.net.MalformedURLException;
+import java.net.URL;
+import java.util.HashSet;
+import java.util.Set;
 
 import junit.framework.TestCase;
 import junit.framework.TestSuite;
-import junit.framework.TestResult;
 
-import java.io.*;
-import org.w3c.dom.*;
+import org.apache.jmeter.samplers.Entry;
+import org.apache.jmeter.samplers.SampleResult;
+import org.apache.log.Hierarchy;
+import org.apache.log.Logger;
+import org.w3c.dom.Document;
+import org.w3c.dom.NamedNodeMap;
+import org.w3c.dom.Node;
+import org.w3c.dom.NodeList;
 import org.w3c.tidy.Tidy;
 import org.xml.sax.SAXException;
 
@@ -114,589 +118,579 @@ import org.xml.sax.SAXException;
  *
  * @author	Khor Soon Hin,
  *		<a href="mailto:mramshaw@alumni.concordia.ca">Martin Ramshaw</a>
- * @version	1.1
- * @created	$Date: 2002/08/12 18:12:37 $
+ * @version	$Id: HTTPSamplerFull.java,v 1.8 2003/01/14 01:14:07 jsalvata Exp $
+ * @created	$Date: 2003/01/14 01:14:07 $
  */
 public class HTTPSamplerFull extends HTTPSampler
 {
-	/** Used to store the Logger (used for debug and error messages). */
-	protected static Category catClass =
-		Category.getInstance(HTTPSamplerFull.class.getName());
-
-	/**
-	 * Used to store the UTF encoding name (which is version dependent).
-	 * @see #getUTFEncodingName
-	 */
-	protected static String utfEncodingName;
-
-	/**
-	 * Used to store the base URL. It should probably be updated to
-	 * respect the following parameter:
-	 * <pre>
-	 *     &lt;base href=<b>url</b>&gt;
-	 * </pre>
-	 */
-	protected URL baseUrl;
-
-	/**
-	 * This is the only Constructor.
-	 */
-	public HTTPSamplerFull()
-	{
-		super();
-		catClass.debug("Start : HTTPSamplerFull");
-		catClass.debug("End   : HTTPSamplerFull");
-	}
-
-	/**
-	 * Samples the <code>Entry</code> passed in and stores the result in
-	 * <code>SampleResult</code>. The original file (which is assumed to be
-	 * an HTML file) is parsed into a DOM tree and examined for embedded binary
-	 * files.
-	 * <p>
-	 * Note that files that are duplicated within the enclosing document will
-	 * only be downloaded once.
-	 *
-	 * @param entry	an entry to be sampled
-	 * @return	results of the sampling
-	 */
-	public SampleResult sample(Entry e)
-	{
-		// Sample the container page.
-		catClass.debug("Start : HTTPSamplerFull sample");
-		SampleResult res = super.sample(e);
-		if(catClass.isDebugEnabled())
-		{
-			catClass.debug("Main page loading time - " + res.getTime());
-		}
-
-		// Now parse the HTML page
-		String displayName = res.getSampleLabel();
-		Document html = null;
-		try
-		{
-			baseUrl = getUrl();
-			if(catClass.isDebugEnabled())
-			{
-				catClass.debug("baseUrl - " + baseUrl.toString());
-			}
-			html = (Document)getDOM(new String(res.getResponseData()));
-		}
-		catch(SAXException se)
-		{
-			catClass.error("Error parsing document - " + se);
-			res.setResponseData(se.toString().getBytes());
-			res.setResponseCode(NON_HTTP_RESPONSE_CODE);
-			res.setResponseMessage(NON_HTTP_RESPONSE_MESSAGE);
-			res.setSuccessful(false);
-			return res;
-		}
-		catch(MalformedURLException mfue)
-		{
-			catClass.error("Error creating URL '" + displayName + "'");
-			catClass.error("MalformedURLException - " + mfue);
-			res.setResponseData(mfue.toString().getBytes());
-			res.setResponseCode(NON_HTTP_RESPONSE_CODE);
-			res.setResponseMessage(NON_HTTP_RESPONSE_MESSAGE);
-			res.setSuccessful(false);
-			return res;
-		}
-
-		// Now parse the DOM tree
-
-		// This is used to ignore duplicated binary files.
-		Set uniqueURLs = new HashSet();
-
-		// look for images
-		parseNodes(html, "img", false, "src", uniqueURLs, res);
-		// look for applets
-
-		// This will only work with an Applet .class file.
-		// Ideally, this should be upgraded to work with Objects (IE)
-		//	and archives (.jar and .zip) files as well.
-
-		parseNodes(html, "applet", false, "code", uniqueURLs, res);
-		// look for input tags with image types
-		parseNodes(html, "input", true, "src", uniqueURLs, res);
-		// look for background images
-		parseNodes(html, "body", false, "background", uniqueURLs, res);
-
-		// Okay, we're all done now
-		if(catClass.isDebugEnabled())
-		{
-			catClass.debug("Total time - " + res.getTime());
-		}
-		catClass.debug("End   : HTTPSamplerFull sample");
-		return res;
-	}
-
-	/**
-	 * Parse the DOM tree looking for the specified HTML source tags,
-	 * and download the appropriate binary files matching these tags.
-	 *
-	 * @param html		the HTML document to parse
-	 * @param htmlTag	the HTML tag to parse for
-	 * @param type		indicates that we require 'type=image'
-	 * @param srcTag	the HTML tag that indicates the source URL
-	 * @param uniques	used to ensure that binary files are only downloaded once
-	 * @param res		<code>SampleResult</code> to store sampling results
-	 */
-	protected void parseNodes(Document html, String htmlTag, boolean type, String srcTag,
-					Set uniques, SampleResult res)
-	{
-		catClass.debug("Start : HTTPSamplerFull parseNodes");
-		NodeList nodeList = html.getElementsByTagName(htmlTag);
-		boolean uniqueBinary;
-		SampleResult binRes = null;
-		for(int i = 0; i < nodeList.getLength(); i++)
-		{
-			uniqueBinary = true;
-			Node tempNode = nodeList.item(i);
-			if(catClass.isDebugEnabled())
-			{
-				catClass.debug("'" + htmlTag + "' tag: " + tempNode);
-			}
-
-			// get the url of the Binary
-			NamedNodeMap nnm = tempNode.getAttributes();
-			Node namedItem = null;
-
-			if(type)
-			{
-				// if type is set, we need 'type=image'
-				namedItem = nnm.getNamedItem("type");
-				if(namedItem == null)
-				{
-					catClass.debug("namedItem 'null' - ignoring");
-					break;
-				}
-				String inputType = namedItem.getNodeValue();
-				if(catClass.isDebugEnabled())
-				{
-					catClass.debug("Input type - " + inputType);
-				}
-				if(inputType != null && inputType.equalsIgnoreCase("image"))
-				{
-					// then we need to download the binary
-				}
-				else
-				{
-					catClass.debug("type != 'image' - ignoring");
-					break;
-				}
-			}
-
-			binRes = new SampleResult();
-			namedItem = nnm.getNamedItem(srcTag);
-			if(namedItem == null)
-			{
-				continue;
-			}
-			String binUrlStr = namedItem.getNodeValue();
-			// set the baseUrl and binUrl so that if error occurs
-			// due to MalformedException then at least the values will be
-			// visible to the user to aid correction
-			binRes.setSampleLabel(baseUrl + "," + binUrlStr);
-			// download the binary
-			URL binUrl = null;
-			try
-			{
-				binUrl = new URL(baseUrl, binUrlStr);
-			}
-			catch(MalformedURLException mfue)
-			{
-				catClass.error("Error creating URL '" + baseUrl +
-						" , " + binUrlStr + "'");
-				catClass.error("MalformedURLException - " + mfue);
-				binRes.setResponseData(mfue.toString().getBytes());
-				binRes.setResponseCode(NON_HTTP_RESPONSE_CODE);
-				binRes.setResponseMessage(NON_HTTP_RESPONSE_MESSAGE);
-				binRes.setSuccessful(false);
-				res.addSubResult(binRes);
-				break;
-			}
-			if(catClass.isDebugEnabled())
-			{
-				catClass.debug("Binary url - " + binUrlStr);
-				catClass.debug("Full Binary url - " + binUrl);
-			}
-			binRes.setSampleLabel(binUrl.toString());
-			uniqueBinary = uniques.add(binUrl.toString());
-			if (uniqueBinary)
-			{
-				// a browser should be smart enough to *not* download
-				//   a binary file that it already has in its cache.
-				try
-				{
-					loadBinary(binUrl, binRes);
-				}
-				catch(IOException ioe)
-				{
-					catClass.error("Error reading from URL - " + ioe);
-					binRes.setResponseData(ioe.toString().getBytes());
-					binRes.setResponseCode(NON_HTTP_RESPONSE_CODE);
-					binRes.setResponseMessage(NON_HTTP_RESPONSE_MESSAGE);
-					binRes.setSuccessful(false);
-				}
-			}
-			else
-			{
-				  if(catClass.isDebugEnabled())
-				  {
-				 	 catClass.debug("Skipping duplicate - " + binUrl);
-				  }
-				  break;
-			}
-			catClass.debug("Adding result");
-			// Note that this only happens for unique binaries
-			res.addSubResult(binRes);
-			res.setTime(res.getTime() + binRes.getTime());
-		}
-		catClass.debug("End   : HTTPSamplerFull parseNodes");
-	}
-
-	/**
-	 * Download the binary file from the given <code>URL</code>.
-	 *
-	 * @param url	<code>URL</code> from where binary is to be downloaded
-	 * @param res	<code>SampleResult</code> to store sampling results
-	 * @return	binary downloaded
-	 *
-	 * @throws IOException indicates a problem reading from the URL
-	 */
-	protected byte[] loadBinary(URL url, SampleResult res) throws IOException
-	{
-		catClass.debug("Start : loadBinary");
-		byte[] ret = new byte[0];
-		res.setSamplerData(new HTTPSampler(url));
-		HttpURLConnection conn = null;
-		try
-		{
-			conn = setupConnection(url, GET);
-			conn.connect();
-		}
-		catch(IOException ioe)
-		{
-			// don't do anything 'cos presumably the connection will return the
-			// correct http response codes
-			if(catClass.isDebugEnabled())
-			{
-				catClass.debug("loadBinary : error in setupConnection " + ioe);
-			}
-			throw ioe;
-		 }
-
-		 try
-		 {
-			long time = System.currentTimeMillis();
-			if(catClass.isDebugEnabled())
-			{
-				catClass.debug("loadBinary : start time - " + time);
-			}
-			int errorLevel = getErrorLevel(conn, res);
-			if (errorLevel == 2)
-			{
-				ret = readResponse(conn);
-				res.setSuccessful(true);
-				long endTime = System.currentTimeMillis();
-				if(catClass.isDebugEnabled())
-				{
-					catClass.debug("loadBinary : end   time - " + endTime);
-				}
-				res.setTime(endTime - time);
-			 }
-			 else
-			 {
-				res.setSuccessful(false);
-				int responseCode =
-					((HttpURLConnection)conn).getResponseCode();
-				String responseMsg =
-					((HttpURLConnection)conn).getResponseMessage();
-				catClass.error("loadBinary : failed code - " + responseCode);
-				catClass.error("loadBinary : failed message - " + responseMsg);
-			}
-			if(catClass.isDebugEnabled())
-			{
-				catClass.debug("loadBinary : binary - " + ret[0]+ret[1]);
-				catClass.debug("loadBinary : loadTime - " + res.getTime());
-			}
-			catClass.debug("End   : loadBinary");
-			res.setResponseData(ret);
-			res.setDataType(SampleResult.BINARY);
-			return ret;
-		}
-		finally
-		{
-	 		try
-	 		{
-				// the server can request that the connection be closed,
-				// but if we requested that the server close the connection
-				// the server should echo back our 'close' request.
-				// Otherwise, let the server disconnect the connection
-				// when its timeout period is reached.
-				String connection  = conn.getHeaderField("Connection");
-				if (connection == null || connection.equalsIgnoreCase("close"))
-					conn.disconnect();
-		 	}
-	 		catch(Exception e){}
-		}
-	}
-
-	/**
-	 * Get the response code of the URL connection and divide it by 100 thus
-	 * returning 2 (for 2xx response codes), 3 (for 3xx reponse codes), etc.
-	 *
-	 * @param conn          <code>HttpURLConnection</code> of URL request
-	 * @param res           where all results of sampling will be stored
-	 * @return              HTTP response code divided by 100
-	 */
-	protected int getErrorLevel(HttpURLConnection conn, SampleResult res)
-	{
-		catClass.debug("Start : getErrorLevel");
-		int errorLevel = 2;
-		try
-		{
-			int responseCode =
-				((HttpURLConnection) conn).getResponseCode();
-			String responseMessage =
-				((HttpURLConnection) conn).getResponseMessage();
-			errorLevel = responseCode/100;
-			res.setResponseCode(String.valueOf(responseCode));
-			res.setResponseMessage(responseMessage);
-			if(catClass.isDebugEnabled())
-			{
-				catClass.debug("getErrorLevel : responseCode - " +
-					responseCode);
-				catClass.debug("getErrorLevel : responseMessage - " +
-					responseMessage);
-			}
-		}
-		catch (Exception e2)
-		{
-			System.out.println("getErrorLevel : " + conn.getHeaderField(0));
-			System.out.println("getErrorLevel : " + conn.getHeaderFieldKey(0));
-			catClass.error("getErrorLevel : " +
-				"Error getting response code for HttpUrlConnection - " + e2);
-			res.setResponseData(e2.toString().getBytes());
-			res.setResponseCode(NON_HTTP_RESPONSE_CODE);
-			res.setResponseMessage(NON_HTTP_RESPONSE_MESSAGE);
-			res.setSuccessful(false);
-		}
-		catClass.debug("End   : getErrorLevel");
-		return errorLevel;
-	}
-
-	public Object clone()
-	{
-		HTTPSamplerFull newSampler = new HTTPSamplerFull();
-		this.configureClone(newSampler);
-		return newSampler;
-	}
-
-	/**
-	 * Returns <code>tidy</code> as HTML parser.
-	 *
-	 * @return	a <code>tidy</code> HTML parser
-	 */
-	protected static Tidy getParser()
-	{
-		catClass.debug("Start : getParser");
-		Tidy tidy = new Tidy();
-		tidy.setCharEncoding(org.w3c.tidy.Configuration.UTF8);
-		tidy.setQuiet(true);
-		tidy.setShowWarnings(false);
-		if(catClass.isDebugEnabled())
-		{
-			catClass.debug("getParser : tidy parser created - " + tidy);
-		}
-		catClass.debug("End   : getParser");
-		return tidy;
-	}
-
-	/**
-	 * Returns a node representing a whole xml given an xml document.
-	 *
-	 * @param text	an xml document
-	 * @return	a node representing a whole xml
-	 *
-	 * @throws SAXException indicates an error parsing the xml document
-	 */
-	protected static Node getDOM(String text) throws SAXException
-	{
-		catClass.debug("Start : getDOM");
-		try
-		{
-			Node node = getParser().parseDOM(new
-			  ByteArrayInputStream(text.getBytes(getUTFEncodingName())), null);
-			if(catClass.isDebugEnabled())
-			{
-				catClass.debug("node : " + node);
-			}
-			catClass.debug("End   : getDOM");
-			return node;
-		 }
-		 catch(UnsupportedEncodingException e)
-		 {
-			catClass.error("getDOM1 : Unsupported encoding exception - " + e);
-			catClass.debug("End   : getDOM");
-			throw new RuntimeException("UTF-8 encoding failed - " + e);
-		}
-	}
-
-	/**
-	 * Returns the encoding type which is different for different jdks
-	 * even though they mean the same thing (for example, UTF8 or UTF-8).
-	 *
-	 * @return	either UTF8 or UTF-8 depending on the jdk version
-	 * @see		#utfEncodingName
-	 */
-	protected static String getUTFEncodingName()
-	{
-		catClass.debug("Start : getUTFEncodingName");
-		if (utfEncodingName == null)
-		{
-			String versionNum = System.getProperty( "java.version" );
-			if(catClass.isDebugEnabled())
-			{
-				catClass.debug("getUTFEncodingName : version = " + versionNum);
-			}
-			if (versionNum.startsWith( "1.1" ))
-			{
-				utfEncodingName = "UTF8";
-			}
-			else
-			{
-				utfEncodingName = "UTF-8";
-			}
-		}
-		if(catClass.isDebugEnabled())
-		{
-			catClass.debug("getUTFEncodingName : Encoding = " + utfEncodingName);
-		}
-		catClass.debug("End   : getUTFEncodingName");
-		return utfEncodingName;
-	}
-
-public static class Test extends TestCase
-{
-	private HTTPSamplerFull hsf;
-
-	private static Category catClass =
-		Category.getInstance(Test.class.getName());
-
-	public Test(String name)
-	{
-		super(name);
-	}
-
-	protected void setUp()
-	{
-		catClass.debug("Start : setUp1");
-		hsf = new HTTPSamplerFull();
-		hsf.setMethod(HTTPSampler.GET);
-		hsf.setProtocol("file");
-	//      urlConfigFull.setPort(8080);
-	//      urlConfigFull.setDomain("jakarta.apache.org");
-		hsf.setPath("HTTPSamplerFullTestFile.txt");
-		catClass.debug("End   : setUp1");
-	 }
-
-	 public void testGetUTFEncodingName()
-	 {
-		catClass.debug("Start : testGetUTFEncodingName");
-		String javaVersion = System.getProperty("java.version");
-		System.setProperty("java.version", "1.1");
-		assertEquals("UTF8", HTTPSamplerFull.getUTFEncodingName());
-		// need to clear utfEncodingName variable first 'cos
-		// getUTFEncodingName checks to see if it's null
-		utfEncodingName = null;
-		System.setProperty("java.version", "1.2");
-		assertEquals("UTF-8", HTTPSamplerFull.getUTFEncodingName());
-		System.setProperty("java.version", javaVersion);
-		catClass.debug("End   : testGetUTFEncodingName");
-	 }
-
-	 public void testGetUrlConfig()
-	 {
-		catClass.debug("Start : testGetUrlConfig");
-		assertEquals(HTTPSampler.GET, hsf.getMethod());
-		assertEquals("file", hsf.getProtocol());
-	//      assertEquals(8080, urlConfig.getPort());
-	//      assertEquals("jakarta.apache.org", urlConfig.getDomain());
-		assertEquals("HTTPSamplerFullTestFile.txt", hsf.getPath());
-		catClass.debug("End   : testGetUrlConfig");
-	 }
-
-	 // Can't think of a self-contained way to test this 'cos it requires
-	 // http server.  Tried to use file:// but HTTPSampler's sample
-	 // specifically requires http.
-	 public void testSampleMain()
-	 {
-		catClass.debug("Start : testSampleMain");
-		// !ToDo : Have to wait till the day SampleResult is extended to
-		// store results of all downloaded stuff e.g. images, applets etc
-		String fileInput = "<html>\n\n" +
-			"<title>\n" +
-			"  A simple applet\n" +
-			"</title>\n" +
-			"<body background=\"back.jpg\" vlink=\"#dd0000\" link=\"#0000ff\">\n" +
-			"<center>\n" +
-			"<h2>   A simple applet\n" +
-			"</h2>\n" +
-			"<br>\n" +
-			"<br>\n" +
-			"<table>\n" +
-			"<td width = 20>\n" +
-			"<td width = 500 align = left>\n" +
-			"<img src=\"/tomcat.gif\">\n" +
-			"<img src=\"/tomcat.gif\">\n" +
-			"<a href=\"NervousText.java\"> Read my code <a>\n" +
-			"<p><applet code=NervousText.class width=400 height=200>\n" +
-			"</applet>\n" +
-			"<p><applet code=NervousText.class width=400 height=200>\n" +
-			"</applet>\n" +
-			"</table>\n" +
-			"<form>\n" +
-			"  <input type=\"image\" src=\"/tomcat-power.gif\">\n" +
-			"</form>\n" +
-			"<form>\n" +
-			"  <input type=\"image\" src=\"/tomcat-power.gif\">\n" +
-			"</form>\n" +
-			"</body>\n" +
-			"</html>\n";
-		byte[] bytes = fileInput.getBytes();
-		try
-		{
-			FileOutputStream fos =
-				new FileOutputStream("HTTPSamplerFullTestFile.txt");
-			fos.write(bytes);
-			fos.close();
-		}
-		catch(IOException ioe)
-		{
-			fail("Cannot create HTTPSamplerFullTestFile.txt in current directory " +
-				"for testing - " + ioe);
-		}
-		// !ToDo
-		// hsf.sample(entry);
-		assertNull("Cannot think of way to test sample", null);
-		catClass.debug("End   : testSampleMain");
-	}
-
-	protected void tearDown()
-	{
-		catClass.debug("Start : tearDown");
-		hsf = null;
-		catClass.debug("End   : tearDown");
-	}
-
-	public static void main(String[] args)
-	{
-		BasicConfigurator.configure();
-		TestSuite suite = new TestSuite(Test.class);
-		junit.textui.TestRunner runner = new junit.textui.TestRunner();
-		runner.run(suite);
-	}
-}
+    /** Used to store the Logger (used for debug and error messages). */
+    transient private static Logger log =
+        Hierarchy.getDefaultHierarchy().getLoggerFor("jmeter.protocol.http");
+
+    /**
+     * Used to store the UTF encoding name (which is version dependent).
+     * @see #getUTFEncodingName
+     */
+    protected static String utfEncodingName;
+
+    /**
+     * Used to store the base URL. It should probably be updated to
+     * respect the following parameter:
+     * <pre>
+     *     &lt;base href=<b>url</b>&gt;
+     * </pre>
+     */
+    protected URL baseUrl;
+
+    /**
+     * This is the only Constructor.
+     */
+    public HTTPSamplerFull()
+    {
+        super();
+        log.debug("Start : HTTPSamplerFull");
+        log.debug("End   : HTTPSamplerFull");
+    }
+
+    /**
+     * Samples the <code>Entry</code> passed in and stores the result in
+     * <code>SampleResult</code>. The original file (which is assumed to be
+     * an HTML file) is parsed into a DOM tree and examined for embedded binary
+     * files.
+     * <p>
+     * Note that files that are duplicated within the enclosing document will
+     * only be downloaded once.
+     *
+     * @param entry	an entry to be sampled
+     * @return	results of the sampling
+     */
+    public SampleResult sample(Entry e)
+    {
+        // Sample the container page.
+        log.debug("Start : HTTPSamplerFull sample");
+        SampleResult res = super.sample(e);
+        if(log.isDebugEnabled())
+        {
+            log.debug("Main page loading time - " + res.getTime());
+        }
+
+        // Now parse the HTML page
+        String displayName = res.getSampleLabel();
+        Document html = null;
+        try
+        {
+            baseUrl = getUrl();
+            if(log.isDebugEnabled())
+            {
+                log.debug("baseUrl - " + baseUrl.toString());
+            }
+            html = (Document)getDOM(new String(res.getResponseData()));
+        }
+        catch(SAXException se)
+        {
+            log.error("Error parsing document - " + se);
+            res.setResponseData(se.toString().getBytes());
+            res.setResponseCode(NON_HTTP_RESPONSE_CODE);
+            res.setResponseMessage(NON_HTTP_RESPONSE_MESSAGE);
+            res.setSuccessful(false);
+            return res;
+        }
+        catch(MalformedURLException mfue)
+        {
+            log.error("Error creating URL '" + displayName + "'");
+            log.error("MalformedURLException - " + mfue);
+            res.setResponseData(mfue.toString().getBytes());
+            res.setResponseCode(NON_HTTP_RESPONSE_CODE);
+            res.setResponseMessage(NON_HTTP_RESPONSE_MESSAGE);
+            res.setSuccessful(false);
+            return res;
+        }
+
+        // Now parse the DOM tree
+
+        // This is used to ignore duplicated binary files.
+        Set uniqueURLs = new HashSet();
+
+        // look for images
+        parseNodes(html, "img", false, "src", uniqueURLs, res);
+        // look for applets
+
+        // This will only work with an Applet .class file.
+        // Ideally, this should be upgraded to work with Objects (IE)
+        //	and archives (.jar and .zip) files as well.
+
+        parseNodes(html, "applet", false, "code", uniqueURLs, res);
+        // look for input tags with image types
+        parseNodes(html, "input", true, "src", uniqueURLs, res);
+        // look for background images
+        parseNodes(html, "body", false, "background", uniqueURLs, res);
+
+        // Okay, we're all done now
+        if(log.isDebugEnabled())
+        {
+            log.debug("Total time - " + res.getTime());
+        }
+        log.debug("End   : HTTPSamplerFull sample");
+        return res;
+    }
+
+    /**
+     * Parse the DOM tree looking for the specified HTML source tags,
+     * and download the appropriate binary files matching these tags.
+     *
+     * @param html		the HTML document to parse
+     * @param htmlTag	the HTML tag to parse for
+     * @param type		indicates that we require 'type=image'
+     * @param srcTag	the HTML tag that indicates the source URL
+     * @param uniques	used to ensure that binary files are only downloaded once
+     * @param res		<code>SampleResult</code> to store sampling results
+     */
+    protected void parseNodes(Document html, String htmlTag, boolean type,
+            String srcTag, Set uniques, SampleResult res)
+    {
+        log.debug("Start : HTTPSamplerFull parseNodes");
+        NodeList nodeList = html.getElementsByTagName(htmlTag);
+        boolean uniqueBinary;
+        SampleResult binRes = null;
+        for(int i = 0; i < nodeList.getLength(); i++)
+        {
+            uniqueBinary = true;
+            Node tempNode = nodeList.item(i);
+            if(log.isDebugEnabled())
+            {
+                log.debug("'" + htmlTag + "' tag: " + tempNode);
+            }
+
+            // get the url of the Binary
+            NamedNodeMap nnm = tempNode.getAttributes();
+            Node namedItem = null;
+
+            if(type)
+            {
+                // if type is set, we need 'type=image'
+                namedItem = nnm.getNamedItem("type");
+                if(namedItem == null)
+                {
+                    log.debug("namedItem 'null' - ignoring");
+                    break;
+                }
+                String inputType = namedItem.getNodeValue();
+                if(log.isDebugEnabled())
+                {
+                    log.debug("Input type - " + inputType);
+                }
+                if(inputType != null && inputType.equalsIgnoreCase("image"))
+                {
+                    // then we need to download the binary
+                }
+                else
+                {
+                    log.debug("type != 'image' - ignoring");
+                    break;
+                }
+            }
+
+            binRes = new SampleResult();
+            namedItem = nnm.getNamedItem(srcTag);
+            if(namedItem == null)
+            {
+                continue;
+            }
+            String binUrlStr = namedItem.getNodeValue();
+            // set the baseUrl and binUrl so that if error occurs
+            // due to MalformedException then at least the values will be
+            // visible to the user to aid correction
+            binRes.setSampleLabel(baseUrl + "," + binUrlStr);
+            // download the binary
+            URL binUrl = null;
+            try
+            {
+                binUrl = new URL(baseUrl, binUrlStr);
+            }
+            catch(MalformedURLException mfue)
+            {
+                log.error("Error creating URL '" + baseUrl +
+                          " , " + binUrlStr + "'");
+                log.error("MalformedURLException - " + mfue);
+                binRes.setResponseData(mfue.toString().getBytes());
+                binRes.setResponseCode(NON_HTTP_RESPONSE_CODE);
+                binRes.setResponseMessage(NON_HTTP_RESPONSE_MESSAGE);
+                binRes.setSuccessful(false);
+                res.addSubResult(binRes);
+                break;
+            }
+            if(log.isDebugEnabled())
+            {
+                log.debug("Binary url - " + binUrlStr);
+                log.debug("Full Binary url - " + binUrl);
+            }
+            binRes.setSampleLabel(binUrl.toString());
+            uniqueBinary = uniques.add(binUrl.toString());
+            if (uniqueBinary)
+            {
+                // a browser should be smart enough to *not* download
+                //   a binary file that it already has in its cache.
+                try
+                {
+                    loadBinary(binUrl, binRes);
+                }
+                catch(IOException ioe)
+                {
+                    log.error("Error reading from URL - " + ioe);
+                    binRes.setResponseData(ioe.toString().getBytes());
+                    binRes.setResponseCode(NON_HTTP_RESPONSE_CODE);
+                    binRes.setResponseMessage(NON_HTTP_RESPONSE_MESSAGE);
+                    binRes.setSuccessful(false);
+                }
+                log.debug("Adding result");
+                res.addSubResult(binRes);
+                res.setTime(res.getTime() + binRes.getTime());
+            }
+            else
+            {
+                if(log.isDebugEnabled())
+                {
+                    log.debug("Skipping duplicate - " + binUrl);
+                }
+            }
+        }
+        log.debug("End   : HTTPSamplerFull parseNodes");
+    }
+
+    /**
+     * Download the binary file from the given <code>URL</code>.
+     *
+     * @param url	<code>URL</code> from where binary is to be downloaded
+     * @param res	<code>SampleResult</code> to store sampling results
+     * @return	binary downloaded
+     *
+     * @throws IOException indicates a problem reading from the URL
+     */
+    protected byte[] loadBinary(URL url, SampleResult res) throws IOException
+    {
+        log.debug("Start : loadBinary");
+        byte[] ret = new byte[0];
+        res.setSamplerData(new HTTPSampler(url));
+        try
+        {
+            conn = setupConnection(url, GET);
+            connect();
+        }
+        catch(IOException ioe)
+        {
+            // don't do anything 'cos presumably the connection will return the
+            // correct http response codes
+            if(log.isDebugEnabled())
+            {
+                log.debug("loadBinary : error in setupConnection " + ioe);
+            }
+            throw ioe;
+        }
+
+        try
+        {
+            long time = System.currentTimeMillis();
+            if(log.isDebugEnabled())
+            {
+                log.debug("loadBinary : start time - " + time);
+            }
+            int errorLevel = getErrorLevel(conn, res);
+            if (errorLevel == 2)
+            {
+                ret = readResponse(conn);
+                res.setSuccessful(true);
+                long endTime = System.currentTimeMillis();
+                if(log.isDebugEnabled())
+                {
+                    log.debug("loadBinary : end   time - " + endTime);
+                }
+                res.setTime(endTime - time);
+            }
+            else
+            {
+                res.setSuccessful(false);
+                int responseCode =
+                        ((HttpURLConnection)conn).getResponseCode();
+                String responseMsg =
+                        ((HttpURLConnection)conn).getResponseMessage();
+                log.error("loadBinary : failed code - " + responseCode);
+                log.error("loadBinary : failed message - " + responseMsg);
+            }
+            if(log.isDebugEnabled())
+            {
+                log.debug("loadBinary : binary - " + ret[0]+ret[1]);
+                log.debug("loadBinary : loadTime - " + res.getTime());
+            }
+            log.debug("End   : loadBinary");
+            res.setResponseData(ret);
+            res.setDataType(SampleResult.BINARY);
+            return ret;
+        }
+        finally
+        {
+            try
+            {
+                // the server can request that the connection be closed,
+                // but if we requested that the server close the connection
+                // the server should echo back our 'close' request.
+                // Otherwise, let the server disconnect the connection
+                // when its timeout period is reached.
+                String connection  = conn.getHeaderField("Connection");
+                if (connection == null || connection.equalsIgnoreCase("close"))
+                {
+                    conn.disconnect();
+                }
+            }
+            catch(Exception e)
+            {
+            }
+        }
+    }
+
+    /**
+     * Get the response code of the URL connection and divide it by 100 thus
+     * returning 2 (for 2xx response codes), 3 (for 3xx reponse codes), etc.
+     *
+     * @param conn          <code>HttpURLConnection</code> of URL request
+     * @param res           where all results of sampling will be stored
+     * @return              HTTP response code divided by 100
+     */
+    protected int getErrorLevel(HttpURLConnection conn, SampleResult res)
+    {
+        log.debug("Start : getErrorLevel");
+        int errorLevel = 2;
+        try
+        {
+            int responseCode =
+                    ((HttpURLConnection) conn).getResponseCode();
+            String responseMessage =
+                    ((HttpURLConnection) conn).getResponseMessage();
+            errorLevel = responseCode/100;
+            res.setResponseCode(String.valueOf(responseCode));
+            res.setResponseMessage(responseMessage);
+            if(log.isDebugEnabled())
+            {
+                log.debug("getErrorLevel : responseCode - " +
+                        responseCode);
+                log.debug("getErrorLevel : responseMessage - " +
+                        responseMessage);
+            }
+        }
+        catch (Exception e2)
+        {
+            log.error("getErrorLevel : " + conn.getHeaderField(0));
+            log.error("getErrorLevel : " + conn.getHeaderFieldKey(0));
+            log.error("getErrorLevel : " +
+                    "Error getting response code for HttpUrlConnection - ",e2);
+            res.setResponseData(e2.toString().getBytes());
+            res.setResponseCode(NON_HTTP_RESPONSE_CODE);
+            res.setResponseMessage(NON_HTTP_RESPONSE_MESSAGE);
+            res.setSuccessful(false);
+        }
+        log.debug("End   : getErrorLevel");
+        return errorLevel;
+    }
+
+    public Object clone()
+    {
+        HTTPSamplerFull newSampler = new HTTPSamplerFull();
+        this.configureClone(newSampler);
+        return newSampler;
+    }
+
+    /**
+     * Returns <code>tidy</code> as HTML parser.
+     *
+     * @return	a <code>tidy</code> HTML parser
+     */
+    protected static Tidy getParser()
+    {
+        log.debug("Start : getParser");
+        Tidy tidy = new Tidy();
+        tidy.setCharEncoding(org.w3c.tidy.Configuration.UTF8);
+        tidy.setQuiet(true);
+        tidy.setShowWarnings(false);
+        if(log.isDebugEnabled())
+        {
+            log.debug("getParser : tidy parser created - " + tidy);
+        }
+        log.debug("End   : getParser");
+        return tidy;
+    }
+
+    /**
+     * Returns a node representing a whole xml given an xml document.
+     *
+     * @param text	an xml document
+     * @return	a node representing a whole xml
+     *
+     * @throws SAXException indicates an error parsing the xml document
+     */
+    protected static Node getDOM(String text) throws SAXException
+    {
+        log.debug("Start : getDOM");
+        try
+        {
+            Node node = getParser().parseDOM(new
+              ByteArrayInputStream(text.getBytes(getUTFEncodingName())), null);
+            if(log.isDebugEnabled())
+            {
+                    log.debug("node : " + node);
+            }
+            log.debug("End   : getDOM");
+            return node;
+        }
+        catch(UnsupportedEncodingException e)
+        {
+            log.error("getDOM1 : Unsupported encoding exception - " + e);
+            log.debug("End   : getDOM");
+            throw new RuntimeException("UTF-8 encoding failed - " + e);
+        }
+    }
+
+    /**
+     * Returns the encoding type which is different for different jdks
+     * even though they mean the same thing (for example, UTF8 or UTF-8).
+     *
+     * @return	either UTF8 or UTF-8 depending on the jdk version
+     * @see		#utfEncodingName
+     */
+    protected static String getUTFEncodingName()
+    {
+        log.debug("Start : getUTFEncodingName");
+        if (utfEncodingName == null)
+        {
+            String versionNum = System.getProperty( "java.version" );
+            if(log.isDebugEnabled())
+            {
+                log.debug("getUTFEncodingName : version = " + versionNum);
+            }
+            if (versionNum.startsWith( "1.1" ))
+            {
+                utfEncodingName = "UTF8";
+            }
+            else
+            {
+                utfEncodingName = "UTF-8";
+            }
+        }
+        if(log.isDebugEnabled())
+        {
+            log.debug("getUTFEncodingName : Encoding = " + utfEncodingName);
+        }
+        log.debug("End   : getUTFEncodingName");
+        return utfEncodingName;
+    }
+
+    public static class Test extends TestCase
+    {
+        private HTTPSamplerFull hsf;
+
+        transient private static Logger log =
+                Hierarchy.getDefaultHierarchy().getLoggerFor("jmeter.test");
+
+        public Test(String name)
+        {
+            super(name);
+        }
+
+        protected void setUp()
+        {
+            log.debug("Start : setUp1");
+            hsf = new HTTPSamplerFull();
+            hsf.setMethod(HTTPSampler.GET);
+            hsf.setProtocol("file");
+            hsf.setPath("HTTPSamplerFullTestFile.txt");
+            log.debug("End   : setUp1");
+        }
+
+        public void testGetUTFEncodingName()
+        {
+            log.debug("Start : testGetUTFEncodingName");
+            String javaVersion = System.getProperty("java.version");
+            System.setProperty("java.version", "1.1");
+            assertEquals("UTF8", HTTPSamplerFull.getUTFEncodingName());
+            // need to clear utfEncodingName variable first 'cos
+            // getUTFEncodingName checks to see if it's null
+            utfEncodingName = null;
+            System.setProperty("java.version", "1.2");
+            assertEquals("UTF-8", HTTPSamplerFull.getUTFEncodingName());
+            System.setProperty("java.version", javaVersion);
+            log.debug("End   : testGetUTFEncodingName");
+        }
+
+        public void testGetUrlConfig()
+        {
+            log.debug("Start : testGetUrlConfig");
+            assertEquals(HTTPSampler.GET, hsf.getMethod());
+            assertEquals("file", hsf.getProtocol());
+            assertEquals("HTTPSamplerFullTestFile.txt", hsf.getPath());
+            log.debug("End   : testGetUrlConfig");
+        }
+
+        // Can't think of a self-contained way to test this 'cos it requires
+        // http server.  Tried to use file:// but HTTPSampler's sample
+        // specifically requires http.
+        public void testSampleMain()
+        {
+            log.debug("Start : testSampleMain");
+            // !ToDo : Have to wait till the day SampleResult is extended to
+            // store results of all downloaded stuff e.g. images, applets etc
+            String fileInput = "<html>\n\n" +
+                    "<title>\n" +
+                    "  A simple applet\n" +
+                    "</title>\n" +
+                    "<body background=\"back.jpg\" vlink=\"#dd0000\" "+
+                            "link=\"#0000ff\">\n" +
+                    "<center>\n" +
+                    "<h2>   A simple applet\n" +
+                    "</h2>\n" +
+                    "<br>\n" +
+                    "<br>\n" +
+                    "<table>\n" +
+                    "<td width = 20>\n" +
+                    "<td width = 500 align = left>\n" +
+                    "<img src=\"/tomcat.gif\">\n" +
+                    "<img src=\"/tomcat.gif\">\n" +
+                    "<a href=\"NervousText.java\"> Read my code <a>\n" +
+                    "<p><applet code=NervousText.class width=400 height=200>\n" +
+                    "</applet>\n" +
+                    "<p><applet code=NervousText.class width=400 height=200>\n" +
+                    "</applet>\n" +
+                    "</table>\n" +
+                    "<form>\n" +
+                    "  <input type=\"image\" src=\"/tomcat-power.gif\">\n" +
+                    "</form>\n" +
+                    "<form>\n" +
+                    "  <input type=\"image\" src=\"/tomcat-power.gif\">\n" +
+                    "</form>\n" +
+                    "</body>\n" +
+                    "</html>\n";
+            byte[] bytes = fileInput.getBytes();
+            try
+            {
+                FileOutputStream fos =
+                        new FileOutputStream("HTTPSamplerFullTestFile.txt");
+                fos.write(bytes);
+                fos.close();
+            }
+            catch(IOException ioe)
+            {
+                fail("Cannot create HTTPSamplerFullTestFile.txt in current directory " +
+                        "for testing - " + ioe);
+            }
+            // !ToDo
+            // hsf.sample(entry);
+            assertNull("Cannot think of way to test sample", null);
+            log.debug("End   : testSampleMain");
+        }
+
+        protected void tearDown()
+        {
+            log.debug("Start : tearDown");
+            hsf = null;
+            log.debug("End   : tearDown");
+        }
+    }
 }
 
diff --git a/jakarta-jmeter/src/protocol/http/org/apache/jmeter/protocol/http/sampler/PostWriter.java b/jakarta-jmeter/src/protocol/http/org/apache/jmeter/protocol/http/sampler/PostWriter.java
index 11ad68e..19e21cc 100644
--- a/jakarta-jmeter/src/protocol/http/org/apache/jmeter/protocol/http/sampler/PostWriter.java
+++ b/jakarta-jmeter/src/protocol/http/org/apache/jmeter/protocol/http/sampler/PostWriter.java
@@ -91,15 +91,10 @@ public class PostWriter
 	public void sendPostData(URLConnection connection, HTTPSampler sampler)
 			 throws IOException
 	{
-		((HttpURLConnection)connection).setRequestMethod("POST");
-
 		// If filename was specified then send the post using multipart syntax
 		String filename = sampler.getFilename();
 		if ((filename != null) && (filename.trim().length() > 0))
 		{
-			connection.setRequestProperty("Content-type", "multipart/form-data; boundary=" + BOUNDARY);
-			connection.setDoOutput(true);
-			connection.setDoInput(true);
 			OutputStream out = connection.getOutputStream();//new FileOutputStream("c:\\data\\experiment.txt");//new ByteArrayOutputStream();//
 			writeln(out,"--"+BOUNDARY);
 			Iterator args = sampler.getArguments().iterator();
@@ -117,6 +112,29 @@ public class PostWriter
 			out.close();
 		}
 
+		// No filename specified, so send the post using normal syntax
+		else
+		{
+			String postData = sampler.getQueryString();
+			PrintWriter out = new PrintWriter(connection.getOutputStream());
+			out.print(postData);
+			out.flush();
+		}
+	}
+	
+	public void setHeaders(URLConnection connection,HTTPSampler sampler) throws IOException
+	{
+		((HttpURLConnection)connection).setRequestMethod("POST");
+
+		// If filename was specified then send the post using multipart syntax
+		String filename = sampler.getFileField();
+		if ((filename != null) && (filename.trim().length() > 0))
+		{
+			connection.setRequestProperty("Content-type", "multipart/form-data; boundary=" + BOUNDARY);
+			connection.setDoOutput(true);
+			connection.setDoInput(true);
+		}
+
 		// No filename specified, so send the post using normal syntax
 		else
 		{
@@ -124,10 +142,6 @@ public class PostWriter
 			connection.setRequestProperty("Content-length", "" + postData.length());
 			connection.setRequestProperty("Content-type", "application/x-www-form-urlencoded");
 			connection.setDoOutput(true);
-
-			PrintWriter out = new PrintWriter(connection.getOutputStream());
-			out.print(postData);
-			out.close();
 		}
 	}
 	
diff --git a/jakarta-jmeter/src/protocol/http/org/apache/jmeter/protocol/http/sampler/SoapSampler.java b/jakarta-jmeter/src/protocol/http/org/apache/jmeter/protocol/http/sampler/SoapSampler.java
index deb7a89..bf5d8c8 100644
--- a/jakarta-jmeter/src/protocol/http/org/apache/jmeter/protocol/http/sampler/SoapSampler.java
+++ b/jakarta-jmeter/src/protocol/http/org/apache/jmeter/protocol/http/sampler/SoapSampler.java
@@ -7,26 +7,43 @@ import java.net.URLConnection;
 
 
 /**
- * @author Administrator
+ * Sampler to handle SOAP Requests
  *
- * To change this generated comment edit the template variable "typecomment":
- * Window>Preferences>Java>Templates.
+ *
+ * @author Jordi Salvat i Alabart
+ * @version $Id: SoapSampler.java,v 1.2 2002/12/02 03:07:43 jboutcher Exp $
  */
-public class SoapSampler extends HTTPSampler 
+public class SoapSampler extends HTTPSampler
 {
 	public static final String XML_DATA = "HTTPSamper.xml_data";
-	
+
 	public void setXmlData(String data)
 	{
 		setProperty(XML_DATA,data);
 	}
-	
+
 	public String getXmlData()
 	{
 		return getPropertyAsString(XML_DATA);
 	}
 
-		/****************************************
+	/****************************************
+	 * Set the HTTP request headers in preparation to open the connection
+	 * and sending the POST data:
+	 *
+	 *@param connection       <code>URLConnection</code> to set headers on
+	 *@exception IOException  if an I/O exception occurs
+	 ***************************************/
+	public void setHeaders(URLConnection connection)
+	  		throws IOException
+	{
+		((HttpURLConnection)connection).setRequestMethod("POST");
+		connection.setRequestProperty("Content-length", "" + getXmlData().length());
+		connection.setRequestProperty("Content-type", "text/xml");
+		connection.setDoOutput(true);
+	}
+
+	/****************************************
 	 * Send POST data from <code>Entry</code> to the open connection.
 	 *
 	 *@param connection       <code>URLConnection</code> of where POST data should
@@ -37,12 +54,9 @@ public class SoapSampler extends HTTPSampler
 	public void sendPostData(URLConnection connection)
 			 throws IOException
 	{
-		((HttpURLConnection)connection).setRequestMethod("POST");
-		connection.setRequestProperty("Content-length", "" + getXmlData().length());
-		connection.setRequestProperty("Content-type", "text/xml");
-		connection.setDoOutput(true);
 		PrintWriter out = new PrintWriter(connection.getOutputStream());
 		out.print(getXmlData());
 		out.close();
 	}
 }
+
diff --git a/jakarta-jmeter/src/protocol/http/org/apache/jmeter/protocol/http/util/CVS/Entries b/jakarta-jmeter/src/protocol/http/org/apache/jmeter/protocol/http/util/CVS/Entries
index fb93df0..05e9773 100644
--- a/jakarta-jmeter/src/protocol/http/org/apache/jmeter/protocol/http/util/CVS/Entries
+++ b/jakarta-jmeter/src/protocol/http/org/apache/jmeter/protocol/http/util/CVS/Entries
@@ -1,3 +1,3 @@
-/Base64Encoder.java/1.1/Sun Aug 11 19:24:52 2002//Tv1_7_3
-/HTTPArgument.java/1.4/Wed Aug 14 02:52:19 2002//Tv1_7_3
+/Base64Encoder.java/1.1/Sun Aug 11 19:24:52 2002//Tv1_8_1
+/HTTPArgument.java/1.5/Thu Oct 17 19:47:20 2002//Tv1_8_1
 D
diff --git a/jakarta-jmeter/src/protocol/http/org/apache/jmeter/protocol/http/util/CVS/Tag b/jakarta-jmeter/src/protocol/http/org/apache/jmeter/protocol/http/util/CVS/Tag
index 5f312fe..e2fda28 100644
--- a/jakarta-jmeter/src/protocol/http/org/apache/jmeter/protocol/http/util/CVS/Tag
+++ b/jakarta-jmeter/src/protocol/http/org/apache/jmeter/protocol/http/util/CVS/Tag
@@ -1 +1 @@
-Nv1_7_3
+Nv1_8_1
diff --git a/jakarta-jmeter/src/protocol/http/org/apache/jmeter/protocol/http/util/HTTPArgument.java b/jakarta-jmeter/src/protocol/http/org/apache/jmeter/protocol/http/util/HTTPArgument.java
index 897975e..86c70f2 100644
--- a/jakarta-jmeter/src/protocol/http/org/apache/jmeter/protocol/http/util/HTTPArgument.java
+++ b/jakarta-jmeter/src/protocol/http/org/apache/jmeter/protocol/http/util/HTTPArgument.java
@@ -1,4 +1,58 @@
-package org.apache.jmeter.protocol.http.util;
+/*
+ * ====================================================================
+ * The Apache Software License, Version 1.1
+ *
+ * Copyright (c) 2001 The Apache Software Foundation.  All rights
+ * reserved.
+ *
+ * Redistribution and use in source and binary forms, with or without
+ * modification, are permitted provided that the following conditions
+ * are met:
+ *
+ * 1. Redistributions of source code must retain the above copyright
+ * notice, this list of conditions and the following disclaimer.
+ *
+ * 2. Redistributions in binary form must reproduce the above copyright
+ * notice, this list of conditions and the following disclaimer in
+ * the documentation and/or other materials provided with the
+ * distribution.
+ *
+ * 3. The end-user documentation included with the redistribution,
+ * if any, must include the following acknowledgment:
+ * "This product includes software developed by the
+ * Apache Software Foundation (http://www.apache.org/)."
+ * Alternately, this acknowledgment may appear in the software itself,
+ * if and wherever such third-party acknowledgments normally appear.
+ *
+ * 4. The names "Apache" and "Apache Software Foundation" and
+ * "Apache JMeter" must not be used to endorse or promote products
+ * derived from this software without prior written permission. For
+ * written permission, please contact apache@apache.org.
+ *
+ * 5. Products derived from this software may not be called "Apache",
+ * "Apache JMeter", nor may "Apache" appear in their name, without
+ * prior written permission of the Apache Software Foundation.
+ *
+ * THIS SOFTWARE IS PROVIDED ``AS IS'' AND ANY EXPRESSED OR IMPLIED
+ * WARRANTIES, INCLUDING, BUT NOT LIMITED TO, THE IMPLIED WARRANTIES
+ * OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE ARE
+ * DISCLAIMED.  IN NO EVENT SHALL THE APACHE SOFTWARE FOUNDATION OR
+ * ITS CONTRIBUTORS BE LIABLE FOR ANY DIRECT, INDIRECT, INCIDENTAL,
+ * SPECIAL, EXEMPLARY, OR CONSEQUENTIAL DAMAGES (INCLUDING, BUT NOT
+ * LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES; LOSS OF
+ * USE, DATA, OR PROFITS; OR BUSINESS INTERRUPTION) HOWEVER CAUSED AND
+ * ON ANY THEORY OF LIABILITY, WHETHER IN CONTRACT, STRICT LIABILITY,
+ * OR TORT (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT
+ * OF THE USE OF THIS SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF
+ * SUCH DAMAGE.
+ * ====================================================================
+ *
+ * This software consists of voluntary contributions made by many
+ * individuals on behalf of the Apache Software Foundation.  For more
+ * information on the Apache Software Foundation, please see
+ * <http://www.apache.org/>.
+ */
+ package org.apache.jmeter.protocol.http.util;
 
 import junit.framework.TestCase;
 import java.net.URLEncoder;
diff --git a/jakarta-jmeter/src/protocol/java/CVS/Tag b/jakarta-jmeter/src/protocol/java/CVS/Tag
index f4b6a59..75ba187 100644
--- a/jakarta-jmeter/src/protocol/java/CVS/Tag
+++ b/jakarta-jmeter/src/protocol/java/CVS/Tag
@@ -1 +1 @@
-Tv1_7_3
+Tv1_8_1
diff --git a/jakarta-jmeter/src/protocol/java/org/CVS/Tag b/jakarta-jmeter/src/protocol/java/org/CVS/Tag
index f4b6a59..75ba187 100644
--- a/jakarta-jmeter/src/protocol/java/org/CVS/Tag
+++ b/jakarta-jmeter/src/protocol/java/org/CVS/Tag
@@ -1 +1 @@
-Tv1_7_3
+Tv1_8_1
diff --git a/jakarta-jmeter/src/protocol/java/org/apache/CVS/Tag b/jakarta-jmeter/src/protocol/java/org/apache/CVS/Tag
index f4b6a59..75ba187 100644
--- a/jakarta-jmeter/src/protocol/java/org/apache/CVS/Tag
+++ b/jakarta-jmeter/src/protocol/java/org/apache/CVS/Tag
@@ -1 +1 @@
-Tv1_7_3
+Tv1_8_1
diff --git a/jakarta-jmeter/src/protocol/java/org/apache/jmeter/CVS/Tag b/jakarta-jmeter/src/protocol/java/org/apache/jmeter/CVS/Tag
index f4b6a59..75ba187 100644
--- a/jakarta-jmeter/src/protocol/java/org/apache/jmeter/CVS/Tag
+++ b/jakarta-jmeter/src/protocol/java/org/apache/jmeter/CVS/Tag
@@ -1 +1 @@
-Tv1_7_3
+Tv1_8_1
diff --git a/jakarta-jmeter/src/protocol/java/org/apache/jmeter/protocol/CVS/Tag b/jakarta-jmeter/src/protocol/java/org/apache/jmeter/protocol/CVS/Tag
index f4b6a59..75ba187 100644
--- a/jakarta-jmeter/src/protocol/java/org/apache/jmeter/protocol/CVS/Tag
+++ b/jakarta-jmeter/src/protocol/java/org/apache/jmeter/protocol/CVS/Tag
@@ -1 +1 @@
-Tv1_7_3
+Tv1_8_1
diff --git a/jakarta-jmeter/src/protocol/java/org/apache/jmeter/protocol/java/CVS/Tag b/jakarta-jmeter/src/protocol/java/org/apache/jmeter/protocol/java/CVS/Tag
index f4b6a59..75ba187 100644
--- a/jakarta-jmeter/src/protocol/java/org/apache/jmeter/protocol/java/CVS/Tag
+++ b/jakarta-jmeter/src/protocol/java/org/apache/jmeter/protocol/java/CVS/Tag
@@ -1 +1 @@
-Tv1_7_3
+Tv1_8_1
diff --git a/jakarta-jmeter/src/protocol/java/org/apache/jmeter/protocol/java/config/CVS/Entries b/jakarta-jmeter/src/protocol/java/org/apache/jmeter/protocol/java/config/CVS/Entries
index f4cf798..91e5cc9 100644
--- a/jakarta-jmeter/src/protocol/java/org/apache/jmeter/protocol/java/config/CVS/Entries
+++ b/jakarta-jmeter/src/protocol/java/org/apache/jmeter/protocol/java/config/CVS/Entries
@@ -1,2 +1,2 @@
-/JavaConfig.java/1.1/Sun Aug 11 19:24:52 2002//Tv1_7_3
+/JavaConfig.java/1.4/Thu Aug 29 18:17:42 2002//Tv1_8_1
 D/gui////
diff --git a/jakarta-jmeter/src/protocol/java/org/apache/jmeter/protocol/java/config/CVS/Tag b/jakarta-jmeter/src/protocol/java/org/apache/jmeter/protocol/java/config/CVS/Tag
index 5f312fe..e2fda28 100644
--- a/jakarta-jmeter/src/protocol/java/org/apache/jmeter/protocol/java/config/CVS/Tag
+++ b/jakarta-jmeter/src/protocol/java/org/apache/jmeter/protocol/java/config/CVS/Tag
@@ -1 +1 @@
-Nv1_7_3
+Nv1_8_1
diff --git a/jakarta-jmeter/src/protocol/java/org/apache/jmeter/protocol/java/config/JavaConfig.java b/jakarta-jmeter/src/protocol/java/org/apache/jmeter/protocol/java/config/JavaConfig.java
index 1f1e9a9..dc9abcb 100644
--- a/jakarta-jmeter/src/protocol/java/org/apache/jmeter/protocol/java/config/JavaConfig.java
+++ b/jakarta-jmeter/src/protocol/java/org/apache/jmeter/protocol/java/config/JavaConfig.java
@@ -57,10 +57,11 @@ package org.apache.jmeter.protocol.java.config;
 import java.io.Serializable;
 
 import org.apache.jmeter.config.Arguments;
+import org.apache.jmeter.config.ConfigTestElement;
 import org.apache.jmeter.protocol.java.sampler.JavaSampler;
 import org.apache.jmeter.protocol.java.sampler.JavaSamplerClient;
-import org.apache.jmeter.testelement.AbstractTestElement;
-import org.apache.log4j.Category;
+import org.apache.log.Hierarchy;
+import org.apache.log.Logger;
 
 
 /**
@@ -69,15 +70,15 @@ import org.apache.log4j.Category;
  * necessary for the Java protocol.
  *
  *@author     Brad Kiewel
- *@created    $Date: 2002/08/11 19:24:52 $
- *@version    $Revision: 1.1 $
+ *@created    $Date: 2002/08/29 18:17:42 $
+ *@version    $Revision: 1.4 $
  */
 
-public class JavaConfig extends AbstractTestElement implements Serializable
+public class JavaConfig extends ConfigTestElement implements Serializable
 {
 
 	/** Logging  */
-	private static Category cat = Category.getInstance(JavaConfig.class);
+	transient private static Logger log = Hierarchy.getDefaultHierarchy().getLoggerFor("jmeter.protocol.java");
 	
 	private transient JavaSamplerClient javaClient = null;
 
diff --git a/jakarta-jmeter/src/protocol/java/org/apache/jmeter/protocol/java/config/gui/CVS/Entries b/jakarta-jmeter/src/protocol/java/org/apache/jmeter/protocol/java/config/gui/CVS/Entries
index c18491b..ec82813 100644
--- a/jakarta-jmeter/src/protocol/java/org/apache/jmeter/protocol/java/config/gui/CVS/Entries
+++ b/jakarta-jmeter/src/protocol/java/org/apache/jmeter/protocol/java/config/gui/CVS/Entries
@@ -1,2 +1,2 @@
-/JavaConfigGui.java/1.1/Sun Aug 11 19:24:52 2002//Tv1_7_3
+/JavaConfigGui.java/1.5/Thu Oct 17 19:47:20 2002//Tv1_8_1
 D
diff --git a/jakarta-jmeter/src/protocol/java/org/apache/jmeter/protocol/java/config/gui/CVS/Tag b/jakarta-jmeter/src/protocol/java/org/apache/jmeter/protocol/java/config/gui/CVS/Tag
index 5f312fe..e2fda28 100644
--- a/jakarta-jmeter/src/protocol/java/org/apache/jmeter/protocol/java/config/gui/CVS/Tag
+++ b/jakarta-jmeter/src/protocol/java/org/apache/jmeter/protocol/java/config/gui/CVS/Tag
@@ -1 +1 @@
-Nv1_7_3
+Nv1_8_1
diff --git a/jakarta-jmeter/src/protocol/java/org/apache/jmeter/protocol/java/config/gui/JavaConfigGui.java b/jakarta-jmeter/src/protocol/java/org/apache/jmeter/protocol/java/config/gui/JavaConfigGui.java
index f3ac8f3..61aeded 100644
--- a/jakarta-jmeter/src/protocol/java/org/apache/jmeter/protocol/java/config/gui/JavaConfigGui.java
+++ b/jakarta-jmeter/src/protocol/java/org/apache/jmeter/protocol/java/config/gui/JavaConfigGui.java
@@ -63,29 +63,31 @@ import javax.swing.JLabel;
 import javax.swing.JPanel;
 import javax.swing.border.Border;
 import javax.swing.border.EmptyBorder;
+
 import org.apache.jmeter.config.Arguments;
 import org.apache.jmeter.config.gui.AbstractConfigGui;
 import org.apache.jmeter.config.gui.ArgumentsPanel;
-import org.apache.jmeter.gui.util.VerticalLayout;
 import org.apache.jmeter.protocol.java.config.JavaConfig;
 import org.apache.jmeter.protocol.java.sampler.JavaSampler;
 import org.apache.jmeter.protocol.java.sampler.JavaSamplerClient;
 import org.apache.jmeter.testelement.TestElement;
-import org.apache.jmeter.util.ClassFinder;
 import org.apache.jmeter.util.JMeterUtils;
-import org.apache.log4j.Category;
+import org.apache.log.Hierarchy;
+import org.apache.log.Logger;
+import org.apache.jorphan.gui.layout.VerticalLayout;
+import org.apache.jorphan.reflect.ClassFinder;
 
 
 /**
  * The <code>JavaConfigGui</code> class provides the user interface for
  * the JavaConfig object.
  * @author Brad Kiewel
- * @version $Revision: 1.1 $
+ * @version $Revision: 1.5 $
  */
 
 public class JavaConfigGui extends AbstractConfigGui
 {
-	private static Category cat = Category.getInstance(JavaConfigGui.class);
+	transient private static Logger log = Hierarchy.getDefaultHierarchy().getLoggerFor("jmeter.protocol.java");
 	private static String CLASSNAMECOMBO = "classnamecombo";
 
 	private JComboBox classnameCombo;
@@ -160,7 +162,9 @@ public class JavaConfigGui extends AbstractConfigGui
 			
 			// Find all the classes which implement the JavaSamplerClient interface
 		
-			possibleClasses = ClassFinder.findClassesThatExtend(new Class[]{JavaSamplerClient.class});
+			possibleClasses = ClassFinder.findClassesThatExtend(
+					JMeterUtils.getSearchPaths(),
+					new Class[]{JavaSamplerClient.class});
 			
 			// Remove the JavaConfig class from the list since it only implements the interface for
 			// error conditions.
@@ -168,7 +172,7 @@ public class JavaConfigGui extends AbstractConfigGui
 			possibleClasses.remove("org.apache.jmeter.protocol.java.sampler.JavaSampler");
 		
 		} catch (Exception e) {
-			cat.debug("Exception getting interfaces.",e);
+			log.debug("Exception getting interfaces.",e);
 		}
 		
 		classnameCombo = new JComboBox(possibleClasses.toArray());
diff --git a/jakarta-jmeter/src/protocol/java/org/apache/jmeter/protocol/java/control/CVS/Tag b/jakarta-jmeter/src/protocol/java/org/apache/jmeter/protocol/java/control/CVS/Tag
index f4b6a59..75ba187 100644
--- a/jakarta-jmeter/src/protocol/java/org/apache/jmeter/protocol/java/control/CVS/Tag
+++ b/jakarta-jmeter/src/protocol/java/org/apache/jmeter/protocol/java/control/CVS/Tag
@@ -1 +1 @@
-Tv1_7_3
+Tv1_8_1
diff --git a/jakarta-jmeter/src/protocol/java/org/apache/jmeter/protocol/java/control/gui/CVS/Entries b/jakarta-jmeter/src/protocol/java/org/apache/jmeter/protocol/java/control/gui/CVS/Entries
index a423778..b6d70d4 100644
--- a/jakarta-jmeter/src/protocol/java/org/apache/jmeter/protocol/java/control/gui/CVS/Entries
+++ b/jakarta-jmeter/src/protocol/java/org/apache/jmeter/protocol/java/control/gui/CVS/Entries
@@ -1,2 +1,2 @@
-/JavaTestSamplerGui.java/1.1/Sun Aug 11 19:24:53 2002//Tv1_7_3
+/JavaTestSamplerGui.java/1.3/Thu Oct 17 19:47:20 2002//Tv1_8_1
 D
diff --git a/jakarta-jmeter/src/protocol/java/org/apache/jmeter/protocol/java/control/gui/CVS/Tag b/jakarta-jmeter/src/protocol/java/org/apache/jmeter/protocol/java/control/gui/CVS/Tag
index 5f312fe..e2fda28 100644
--- a/jakarta-jmeter/src/protocol/java/org/apache/jmeter/protocol/java/control/gui/CVS/Tag
+++ b/jakarta-jmeter/src/protocol/java/org/apache/jmeter/protocol/java/control/gui/CVS/Tag
@@ -1 +1 @@
-Nv1_7_3
+Nv1_8_1
diff --git a/jakarta-jmeter/src/protocol/java/org/apache/jmeter/protocol/java/control/gui/JavaTestSamplerGui.java b/jakarta-jmeter/src/protocol/java/org/apache/jmeter/protocol/java/control/gui/JavaTestSamplerGui.java
index 019700b..cb6e6ff 100644
--- a/jakarta-jmeter/src/protocol/java/org/apache/jmeter/protocol/java/control/gui/JavaTestSamplerGui.java
+++ b/jakarta-jmeter/src/protocol/java/org/apache/jmeter/protocol/java/control/gui/JavaTestSamplerGui.java
@@ -60,13 +60,14 @@ import javax.swing.JLabel;
 import javax.swing.JPanel;
 import javax.swing.border.Border;
 import javax.swing.border.EmptyBorder;
-import org.apache.jmeter.gui.util.VerticalLayout;
+
 import org.apache.jmeter.protocol.java.config.JavaConfig;
 import org.apache.jmeter.protocol.java.config.gui.JavaConfigGui;
 import org.apache.jmeter.protocol.java.sampler.JavaSampler;
 import org.apache.jmeter.samplers.gui.AbstractSamplerGui;
 import org.apache.jmeter.testelement.TestElement;
 import org.apache.jmeter.util.JMeterUtils;
+import org.apache.jorphan.gui.layout.VerticalLayout;
 
 
 /**
@@ -74,7 +75,7 @@ import org.apache.jmeter.util.JMeterUtils;
  * for the JavaTestSampler.
  * 
  * @author Brad Kiewel
- * @version $Revision: 1.1 $
+ * @version $Revision: 1.3 $
  */
 
 public class JavaTestSamplerGui extends AbstractSamplerGui {
diff --git a/jakarta-jmeter/src/protocol/java/org/apache/jmeter/protocol/java/sampler/CVS/Entries b/jakarta-jmeter/src/protocol/java/org/apache/jmeter/protocol/java/sampler/CVS/Entries
index 4c2383a..03b5843 100644
--- a/jakarta-jmeter/src/protocol/java/org/apache/jmeter/protocol/java/sampler/CVS/Entries
+++ b/jakarta-jmeter/src/protocol/java/org/apache/jmeter/protocol/java/sampler/CVS/Entries
@@ -1,3 +1,3 @@
-/JavaSampler.java/1.1/Sun Aug 11 19:24:53 2002//Tv1_7_3
-/JavaSamplerClient.java/1.1/Sun Aug 11 19:24:53 2002//Tv1_7_3
+/JavaSampler.java/1.4/Fri Aug 30 14:43:20 2002//Tv1_8_1
+/JavaSamplerClient.java/1.1/Sun Aug 11 19:24:53 2002//Tv1_8_1
 D
diff --git a/jakarta-jmeter/src/protocol/java/org/apache/jmeter/protocol/java/sampler/CVS/Tag b/jakarta-jmeter/src/protocol/java/org/apache/jmeter/protocol/java/sampler/CVS/Tag
index 5f312fe..e2fda28 100644
--- a/jakarta-jmeter/src/protocol/java/org/apache/jmeter/protocol/java/sampler/CVS/Tag
+++ b/jakarta-jmeter/src/protocol/java/org/apache/jmeter/protocol/java/sampler/CVS/Tag
@@ -1 +1 @@
-Nv1_7_3
+Nv1_8_1
diff --git a/jakarta-jmeter/src/protocol/java/org/apache/jmeter/protocol/java/sampler/JavaSampler.java b/jakarta-jmeter/src/protocol/java/org/apache/jmeter/protocol/java/sampler/JavaSampler.java
index e093325..33639e5 100644
--- a/jakarta-jmeter/src/protocol/java/org/apache/jmeter/protocol/java/sampler/JavaSampler.java
+++ b/jakarta-jmeter/src/protocol/java/org/apache/jmeter/protocol/java/sampler/JavaSampler.java
@@ -65,7 +65,8 @@ import org.apache.jmeter.samplers.AbstractSampler;
 import org.apache.jmeter.samplers.Entry;
 import org.apache.jmeter.samplers.SampleResult;
 import org.apache.jmeter.testelement.TestElement;
-import org.apache.log4j.Category;
+import org.apache.log.Hierarchy;
+import org.apache.log.Logger;
 
 /**
  * 
@@ -80,10 +81,10 @@ public class JavaSampler extends AbstractSampler implements JavaSamplerClient {
 	
 	public final static String ARGUMENTS = "arguments";
 
-	private JavaSamplerClient javaClient = null;
+	transient private JavaSamplerClient javaClient = null;
 
 	/** Logging  */
-	private static Category cat = Category.getInstance(JavaSampler.class);
+	transient private static Logger log = Hierarchy.getDefaultHierarchy().getLoggerFor("jmeter.protocol.java");
 
 	public JavaSampler() {
 		setArguments(new Arguments());
@@ -193,15 +194,15 @@ public class JavaSampler extends AbstractSampler implements JavaSamplerClient {
 						Object[] args = {};
 						javaClient = (JavaSamplerClient)constructors[i].newInstance(args);
 						javaClient.setupTest(createArgumentsHashMap(getArguments()));
-						if (cat.isDebugEnabled()) {
-							cat.debug(whoAmI() + "\tCreated:\t"+ getClassname()+ "@" + Integer.toHexString(javaClient.hashCode()));
+						if (log.isDebugEnabled()) {
+							log.debug(whoAmI() + "\tCreated:\t"+ getClassname()+ "@" + Integer.toHexString(javaClient.hashCode()));
 						}
 						break;
 					}
 				}
 
 			} catch (Exception e) {
-				cat.error(whoAmI() + "\tException creating: " + getClassname(),e);
+				log.error(whoAmI() + "\tException creating: " + getClassname(),e);
 				javaClient = this;
 			}
 		}
@@ -228,7 +229,7 @@ public class JavaSampler extends AbstractSampler implements JavaSamplerClient {
 	 * @see JavaSamplerClient#setupTest()
 	 */
 	public void setupTest(HashMap arguments) {
-		cat.debug(whoAmI() + "\tsetupTest");
+		log.debug(whoAmI() + "\tsetupTest");
 	}
 
 	/**
@@ -236,7 +237,7 @@ public class JavaSampler extends AbstractSampler implements JavaSamplerClient {
 	 * @see JavaSamplerClient#teardownTest()
 	 */
 	public void teardownTest(HashMap arguments) {
-		cat.debug(whoAmI() + "\tteardownTest");
+		log.debug(whoAmI() + "\tteardownTest");
 		javaClient = null;
 	}
 
@@ -245,7 +246,7 @@ public class JavaSampler extends AbstractSampler implements JavaSamplerClient {
 	 * @see JavaSamplerClient#runTest()
 	 */
 	public SampleResult runTest(HashMap arguments) {
-		cat.debug(whoAmI() + "\trunTest");
+		log.debug(whoAmI() + "\trunTest");
 		Thread.yield();
 		SampleResult results = new SampleResult();
 		results.setTime(0);
diff --git a/jakarta-jmeter/src/protocol/java/org/apache/jmeter/protocol/java/test/CVS/Entries b/jakarta-jmeter/src/protocol/java/org/apache/jmeter/protocol/java/test/CVS/Entries
index 7d774f7..8b68617 100644
--- a/jakarta-jmeter/src/protocol/java/org/apache/jmeter/protocol/java/test/CVS/Entries
+++ b/jakarta-jmeter/src/protocol/java/org/apache/jmeter/protocol/java/test/CVS/Entries
@@ -1,2 +1,2 @@
-/SleepTest.java/1.1/Sun Aug 11 19:24:53 2002//Tv1_7_3
+/SleepTest.java/1.4/Fri Aug 30 14:43:21 2002//Tv1_8_1
 D
diff --git a/jakarta-jmeter/src/protocol/java/org/apache/jmeter/protocol/java/test/CVS/Tag b/jakarta-jmeter/src/protocol/java/org/apache/jmeter/protocol/java/test/CVS/Tag
index 5f312fe..e2fda28 100644
--- a/jakarta-jmeter/src/protocol/java/org/apache/jmeter/protocol/java/test/CVS/Tag
+++ b/jakarta-jmeter/src/protocol/java/org/apache/jmeter/protocol/java/test/CVS/Tag
@@ -1 +1 @@
-Nv1_7_3
+Nv1_8_1
diff --git a/jakarta-jmeter/src/protocol/java/org/apache/jmeter/protocol/java/test/SleepTest.java b/jakarta-jmeter/src/protocol/java/org/apache/jmeter/protocol/java/test/SleepTest.java
index 440f523..cb76e30 100644
--- a/jakarta-jmeter/src/protocol/java/org/apache/jmeter/protocol/java/test/SleepTest.java
+++ b/jakarta-jmeter/src/protocol/java/org/apache/jmeter/protocol/java/test/SleepTest.java
@@ -55,13 +55,15 @@
 
 package org.apache.jmeter.protocol.java.test;
 
+import java.io.Serializable;
 import java.util.HashMap;
 import java.util.Iterator;
 import java.util.Map.Entry;
 
 import org.apache.jmeter.protocol.java.sampler.JavaSamplerClient;
 import org.apache.jmeter.samplers.SampleResult;
-import org.apache.log4j.Category;
+import org.apache.log.Hierarchy;
+import org.apache.log.Logger;
 
 /**
  * The <code>SleepTest</code> class is a simple example class for a
@@ -69,9 +71,9 @@ import org.apache.log4j.Category;
  * <code>JavaSamplerClient</code> interface.
  */
 
-public class SleepTest implements JavaSamplerClient {
+public class SleepTest implements JavaSamplerClient,Serializable {
 	/** Define category for logging  */
-	private static Category cat = Category.getInstance(SleepTest.class);
+	transient private static Logger log = Hierarchy.getDefaultHierarchy().getLoggerFor("jmeter.protocol.java");
 	/** */
 	private long sleepTime = 1000;
 	/** */
@@ -84,7 +86,7 @@ public class SleepTest implements JavaSamplerClient {
 	 * the client class.
 	 */
 	public SleepTest() {
-		cat.debug(whoAmI() + "\tConstruct");
+		log.debug(whoAmI() + "\tConstruct");
 	}
 
 	/**
@@ -93,11 +95,11 @@ public class SleepTest implements JavaSamplerClient {
 	 * setupTest() provides a way to do any initialization that may be required.
 	 */
 	public void setupTest(HashMap arguments) {
-		cat.debug(whoAmI() + "\tsetupTest()");
+		log.debug(whoAmI() + "\tsetupTest()");
 		Iterator argsIt = arguments.entrySet().iterator();
 		while (argsIt.hasNext()) {
 			Entry entry = (Entry)argsIt.next();
-			cat.debug(entry.getKey().toString() + "=" + entry.getValue().toString());
+			log.debug(entry.getKey().toString() + "=" + entry.getValue().toString());
 		}
 
 		if (arguments.containsKey("SleepTime")) {
@@ -115,11 +117,11 @@ public class SleepTest implements JavaSamplerClient {
 	 * teardownTest() provides a way to do any clean-up that may be required.
 	 */
 	public void teardownTest(HashMap arguments) {
-		cat.debug(whoAmI() + "\tteardownTest()");
+		log.debug(whoAmI() + "\tteardownTest()");
 		Iterator argsIt = arguments.entrySet().iterator();
 		while (argsIt.hasNext()) {
 			Entry entry = (Entry)argsIt.next();
-			cat.debug(entry.getKey().toString() + "=" + entry.getValue().toString());
+			log.debug(entry.getKey().toString() + "=" + entry.getValue().toString());
 		}
 	}
 
@@ -158,12 +160,12 @@ public class SleepTest implements JavaSamplerClient {
 		} catch (Exception e) {
 		}
 
-		if (cat.isDebugEnabled()) {
-			cat.debug(whoAmI() + "\trunTest()" + "\tTime:\t" + results.getTime());
+		if (log.isDebugEnabled()) {
+			log.debug(whoAmI() + "\trunTest()" + "\tTime:\t" + results.getTime());
 			Iterator argsIt = arguments.entrySet().iterator();
 			while (argsIt.hasNext()) {
 				Entry entry = (Entry)argsIt.next();
-				cat.debug(entry.getKey().toString() + "=" + entry.getValue().toString());
+				log.debug(entry.getKey().toString() + "=" + entry.getValue().toString());
 			}
 		}
 
@@ -185,7 +187,7 @@ public class SleepTest implements JavaSamplerClient {
 		try {
 			sleepTime = Long.parseLong((String)arg);
 		} catch (Exception e) {
-			cat.debug("Exception getting sleepTime:\t",e);
+			log.debug("Exception getting sleepTime:\t",e);
 			sleepTime = 1000l;
 		}
 	}
@@ -193,7 +195,7 @@ public class SleepTest implements JavaSamplerClient {
 		try {
 			sleepMask = Long.parseLong((String)arg);
 		} catch (Exception e) {
-			cat.debug("Exception getting sleepMask:\t",e);
+			log.debug("Exception getting sleepMask:\t",e);
 			sleepMask = 0x3ff;
 		}
 	}
diff --git a/jakarta-jmeter/src/protocol/jdbc/CVS/Tag b/jakarta-jmeter/src/protocol/jdbc/CVS/Tag
index f4b6a59..75ba187 100644
--- a/jakarta-jmeter/src/protocol/jdbc/CVS/Tag
+++ b/jakarta-jmeter/src/protocol/jdbc/CVS/Tag
@@ -1 +1 @@
-Tv1_7_3
+Tv1_8_1
diff --git a/jakarta-jmeter/src/protocol/jdbc/org/CVS/Tag b/jakarta-jmeter/src/protocol/jdbc/org/CVS/Tag
index f4b6a59..75ba187 100644
--- a/jakarta-jmeter/src/protocol/jdbc/org/CVS/Tag
+++ b/jakarta-jmeter/src/protocol/jdbc/org/CVS/Tag
@@ -1 +1 @@
-Tv1_7_3
+Tv1_8_1
diff --git a/jakarta-jmeter/src/protocol/jdbc/org/apache/CVS/Tag b/jakarta-jmeter/src/protocol/jdbc/org/apache/CVS/Tag
index f4b6a59..75ba187 100644
--- a/jakarta-jmeter/src/protocol/jdbc/org/apache/CVS/Tag
+++ b/jakarta-jmeter/src/protocol/jdbc/org/apache/CVS/Tag
@@ -1 +1 @@
-Tv1_7_3
+Tv1_8_1
diff --git a/jakarta-jmeter/src/protocol/jdbc/org/apache/jmeter/CVS/Tag b/jakarta-jmeter/src/protocol/jdbc/org/apache/jmeter/CVS/Tag
index f4b6a59..75ba187 100644
--- a/jakarta-jmeter/src/protocol/jdbc/org/apache/jmeter/CVS/Tag
+++ b/jakarta-jmeter/src/protocol/jdbc/org/apache/jmeter/CVS/Tag
@@ -1 +1 @@
-Tv1_7_3
+Tv1_8_1
diff --git a/jakarta-jmeter/src/protocol/jdbc/org/apache/jmeter/protocol/CVS/Tag b/jakarta-jmeter/src/protocol/jdbc/org/apache/jmeter/protocol/CVS/Tag
index f4b6a59..75ba187 100644
--- a/jakarta-jmeter/src/protocol/jdbc/org/apache/jmeter/protocol/CVS/Tag
+++ b/jakarta-jmeter/src/protocol/jdbc/org/apache/jmeter/protocol/CVS/Tag
@@ -1 +1 @@
-Tv1_7_3
+Tv1_8_1
diff --git a/jakarta-jmeter/src/protocol/jdbc/org/apache/jmeter/protocol/jdbc/CVS/Tag b/jakarta-jmeter/src/protocol/jdbc/org/apache/jmeter/protocol/jdbc/CVS/Tag
index f4b6a59..75ba187 100644
--- a/jakarta-jmeter/src/protocol/jdbc/org/apache/jmeter/protocol/jdbc/CVS/Tag
+++ b/jakarta-jmeter/src/protocol/jdbc/org/apache/jmeter/protocol/jdbc/CVS/Tag
@@ -1 +1 @@
-Tv1_7_3
+Tv1_8_1
diff --git a/jakarta-jmeter/src/protocol/jdbc/org/apache/jmeter/protocol/jdbc/config/CVS/Entries b/jakarta-jmeter/src/protocol/jdbc/org/apache/jmeter/protocol/jdbc/config/CVS/Entries
index 6b2d7f1..54f821b 100644
--- a/jakarta-jmeter/src/protocol/jdbc/org/apache/jmeter/protocol/jdbc/config/CVS/Entries
+++ b/jakarta-jmeter/src/protocol/jdbc/org/apache/jmeter/protocol/jdbc/config/CVS/Entries
@@ -1,4 +1,4 @@
-/DbConfig.java/1.1/Sun Aug 11 19:24:53 2002//Tv1_7_3
-/PoolConfig.java/1.1/Sun Aug 11 19:24:53 2002//Tv1_7_3
-/SqlConfig.java/1.1/Sun Aug 11 19:24:53 2002//Tv1_7_3
+/DbConfig.java/1.1/Sun Aug 11 19:24:53 2002//Tv1_8_1
+/PoolConfig.java/1.1/Sun Aug 11 19:24:53 2002//Tv1_8_1
+/SqlConfig.java/1.1/Sun Aug 11 19:24:53 2002//Tv1_8_1
 D/gui////
diff --git a/jakarta-jmeter/src/protocol/jdbc/org/apache/jmeter/protocol/jdbc/config/CVS/Tag b/jakarta-jmeter/src/protocol/jdbc/org/apache/jmeter/protocol/jdbc/config/CVS/Tag
index 5f312fe..e2fda28 100644
--- a/jakarta-jmeter/src/protocol/jdbc/org/apache/jmeter/protocol/jdbc/config/CVS/Tag
+++ b/jakarta-jmeter/src/protocol/jdbc/org/apache/jmeter/protocol/jdbc/config/CVS/Tag
@@ -1 +1 @@
-Nv1_7_3
+Nv1_8_1
diff --git a/jakarta-jmeter/src/protocol/jdbc/org/apache/jmeter/protocol/jdbc/config/gui/CVS/Entries b/jakarta-jmeter/src/protocol/jdbc/org/apache/jmeter/protocol/jdbc/config/gui/CVS/Entries
index 9e5f847..ae915c2 100644
--- a/jakarta-jmeter/src/protocol/jdbc/org/apache/jmeter/protocol/jdbc/config/gui/CVS/Entries
+++ b/jakarta-jmeter/src/protocol/jdbc/org/apache/jmeter/protocol/jdbc/config/gui/CVS/Entries
@@ -1,4 +1,4 @@
-/DbConfigGui.java/1.1/Sun Aug 11 19:24:53 2002//Tv1_7_3
-/PoolConfigGui.java/1.1/Sun Aug 11 19:24:53 2002//Tv1_7_3
-/SqlConfigGui.java/1.1/Sun Aug 11 19:24:53 2002//Tv1_7_3
+/DbConfigGui.java/1.3/Thu Oct 17 19:47:20 2002//Tv1_8_1
+/PoolConfigGui.java/1.3/Thu Oct 17 19:47:20 2002//Tv1_8_1
+/SqlConfigGui.java/1.3/Thu Oct 17 19:47:20 2002//Tv1_8_1
 D
diff --git a/jakarta-jmeter/src/protocol/jdbc/org/apache/jmeter/protocol/jdbc/config/gui/CVS/Tag b/jakarta-jmeter/src/protocol/jdbc/org/apache/jmeter/protocol/jdbc/config/gui/CVS/Tag
index 5f312fe..e2fda28 100644
--- a/jakarta-jmeter/src/protocol/jdbc/org/apache/jmeter/protocol/jdbc/config/gui/CVS/Tag
+++ b/jakarta-jmeter/src/protocol/jdbc/org/apache/jmeter/protocol/jdbc/config/gui/CVS/Tag
@@ -1 +1 @@
-Nv1_7_3
+Nv1_8_1
diff --git a/jakarta-jmeter/src/protocol/jdbc/org/apache/jmeter/protocol/jdbc/config/gui/DbConfigGui.java b/jakarta-jmeter/src/protocol/jdbc/org/apache/jmeter/protocol/jdbc/config/gui/DbConfigGui.java
index 7eb8092..9b388cc 100644
--- a/jakarta-jmeter/src/protocol/jdbc/org/apache/jmeter/protocol/jdbc/config/gui/DbConfigGui.java
+++ b/jakarta-jmeter/src/protocol/jdbc/org/apache/jmeter/protocol/jdbc/config/gui/DbConfigGui.java
@@ -53,25 +53,28 @@
  * <http://www.apache.org/>.
  */
 package org.apache.jmeter.protocol.jdbc.config.gui;
-import java.awt.*;
-import java.awt.event.*;
-import javax.swing.*;
-import javax.swing.border.*;
-import org.apache.jmeter.config.gui.LoginConfigGui;
-import org.apache.jmeter.gui.*;
-import org.apache.jmeter.gui.util.VerticalLayout;
-import org.apache.jmeter.protocol.jdbc.config.DbConfig;
-import org.apache.jmeter.util.JMeterUtils;
+import java.awt.Font;
+
+import javax.swing.BorderFactory;
+import javax.swing.JLabel;
+import javax.swing.JPanel;
+import javax.swing.JTextField;
+import javax.swing.border.Border;
+import javax.swing.border.EmptyBorder;
+
+import org.apache.jmeter.config.ConfigTestElement;
 import org.apache.jmeter.config.gui.AbstractConfigGui;
-import org.apache.jmeter.testelement.TestElement;
+import org.apache.jmeter.config.gui.LoginConfigGui;
 import org.apache.jmeter.protocol.jdbc.sampler.JDBCSampler;
-import org.apache.jmeter.config.ConfigTestElement;
+import org.apache.jmeter.testelement.TestElement;
+import org.apache.jmeter.util.JMeterUtils;
+import org.apache.jorphan.gui.layout.VerticalLayout;
 
 /****************************************
  * Title: Description: Copyright: Copyright (c) 2001 Company:
  *
  *@author    Michael Stover
- *@created   $Date: 2002/08/11 19:24:53 $
+ *@created   $Date: 2002/10/17 19:47:20 $
  *@version   1.0
  ***************************************/
 
diff --git a/jakarta-jmeter/src/protocol/jdbc/org/apache/jmeter/protocol/jdbc/config/gui/PoolConfigGui.java b/jakarta-jmeter/src/protocol/jdbc/org/apache/jmeter/protocol/jdbc/config/gui/PoolConfigGui.java
index bc742d1..6e7f4ca 100644
--- a/jakarta-jmeter/src/protocol/jdbc/org/apache/jmeter/protocol/jdbc/config/gui/PoolConfigGui.java
+++ b/jakarta-jmeter/src/protocol/jdbc/org/apache/jmeter/protocol/jdbc/config/gui/PoolConfigGui.java
@@ -53,24 +53,30 @@
  * <http://www.apache.org/>.
  */
 package org.apache.jmeter.protocol.jdbc.config.gui;
-import java.awt.*;
-import java.awt.event.*;
-import javax.swing.*;
-import javax.swing.border.*;
-import org.apache.jmeter.gui.*;
-import org.apache.jmeter.gui.util.VerticalLayout;
-import org.apache.jmeter.protocol.jdbc.config.*;
-import org.apache.jmeter.util.JMeterUtils;
+import java.awt.Font;
+import java.awt.event.FocusEvent;
+import java.awt.event.FocusListener;
+
+import javax.swing.BorderFactory;
+import javax.swing.JLabel;
+import javax.swing.JOptionPane;
+import javax.swing.JPanel;
+import javax.swing.JTextField;
+import javax.swing.border.Border;
+import javax.swing.border.EmptyBorder;
+
+import org.apache.jmeter.config.ConfigTestElement;
 import org.apache.jmeter.config.gui.AbstractConfigGui;
-import org.apache.jmeter.testelement.TestElement;
 import org.apache.jmeter.protocol.jdbc.sampler.JDBCSampler;
-import org.apache.jmeter.config.ConfigTestElement;
+import org.apache.jmeter.testelement.TestElement;
+import org.apache.jmeter.util.JMeterUtils;
+import org.apache.jorphan.gui.layout.VerticalLayout;
 
 /****************************************
  * Title: JMeter Description: Copyright: Copyright (c) 2000 Company: Apache
  *
  *@author    Michael Stover
- *@created   $Date: 2002/08/11 19:24:53 $
+ *@created   $Date: 2002/10/17 19:47:20 $
  *@version   1.0
  ***************************************/
 
diff --git a/jakarta-jmeter/src/protocol/jdbc/org/apache/jmeter/protocol/jdbc/config/gui/SqlConfigGui.java b/jakarta-jmeter/src/protocol/jdbc/org/apache/jmeter/protocol/jdbc/config/gui/SqlConfigGui.java
index 570fc93..119565b 100644
--- a/jakarta-jmeter/src/protocol/jdbc/org/apache/jmeter/protocol/jdbc/config/gui/SqlConfigGui.java
+++ b/jakarta-jmeter/src/protocol/jdbc/org/apache/jmeter/protocol/jdbc/config/gui/SqlConfigGui.java
@@ -53,24 +53,26 @@
  * <http://www.apache.org/>.
  */
 package org.apache.jmeter.protocol.jdbc.config.gui;
-import java.awt.*;
-import java.awt.event.*;
-import javax.swing.*;
-import javax.swing.border.*;
-import org.apache.jmeter.gui.*;
-import org.apache.jmeter.gui.util.VerticalLayout;
-import org.apache.jmeter.protocol.jdbc.config.SqlConfig;
-import org.apache.jmeter.util.JMeterUtils;
-import org.apache.jmeter.config.gui.AbstractConfigGui;
+import java.awt.Font;
+
+import javax.swing.JLabel;
+import javax.swing.JPanel;
+import javax.swing.JTextField;
+import javax.swing.border.Border;
+import javax.swing.border.EmptyBorder;
+
 import org.apache.jmeter.config.ConfigTestElement;
-import org.apache.jmeter.testelement.TestElement;
+import org.apache.jmeter.config.gui.AbstractConfigGui;
 import org.apache.jmeter.protocol.jdbc.sampler.JDBCSampler;
+import org.apache.jmeter.testelement.TestElement;
+import org.apache.jmeter.util.JMeterUtils;
+import org.apache.jorphan.gui.layout.VerticalLayout;
 
 /****************************************
  * Title: JMeter Description: Copyright: Copyright (c) 2000 Company: Apache
  *
  *@author    Michael Stover
- *@created   $Date: 2002/08/11 19:24:53 $
+ *@created   $Date: 2002/10/17 19:47:20 $
  *@version   1.0
  ***************************************/
 
diff --git a/jakarta-jmeter/src/protocol/jdbc/org/apache/jmeter/protocol/jdbc/control/CVS/Tag b/jakarta-jmeter/src/protocol/jdbc/org/apache/jmeter/protocol/jdbc/control/CVS/Tag
index f4b6a59..75ba187 100644
--- a/jakarta-jmeter/src/protocol/jdbc/org/apache/jmeter/protocol/jdbc/control/CVS/Tag
+++ b/jakarta-jmeter/src/protocol/jdbc/org/apache/jmeter/protocol/jdbc/control/CVS/Tag
@@ -1 +1 @@
-Tv1_7_3
+Tv1_8_1
diff --git a/jakarta-jmeter/src/protocol/jdbc/org/apache/jmeter/protocol/jdbc/control/gui/CVS/Entries b/jakarta-jmeter/src/protocol/jdbc/org/apache/jmeter/protocol/jdbc/control/gui/CVS/Entries
index 9ff6a1e..a4f0479 100644
--- a/jakarta-jmeter/src/protocol/jdbc/org/apache/jmeter/protocol/jdbc/control/gui/CVS/Entries
+++ b/jakarta-jmeter/src/protocol/jdbc/org/apache/jmeter/protocol/jdbc/control/gui/CVS/Entries
@@ -1,2 +1,2 @@
-/JdbcTestSampleGui.java/1.1/Sun Aug 11 19:24:53 2002//Tv1_7_3
+/JdbcTestSampleGui.java/1.3/Thu Oct 17 19:47:20 2002//Tv1_8_1
 D
diff --git a/jakarta-jmeter/src/protocol/jdbc/org/apache/jmeter/protocol/jdbc/control/gui/CVS/Tag b/jakarta-jmeter/src/protocol/jdbc/org/apache/jmeter/protocol/jdbc/control/gui/CVS/Tag
index 5f312fe..e2fda28 100644
--- a/jakarta-jmeter/src/protocol/jdbc/org/apache/jmeter/protocol/jdbc/control/gui/CVS/Tag
+++ b/jakarta-jmeter/src/protocol/jdbc/org/apache/jmeter/protocol/jdbc/control/gui/CVS/Tag
@@ -1 +1 @@
-Nv1_7_3
+Nv1_8_1
diff --git a/jakarta-jmeter/src/protocol/jdbc/org/apache/jmeter/protocol/jdbc/control/gui/JdbcTestSampleGui.java b/jakarta-jmeter/src/protocol/jdbc/org/apache/jmeter/protocol/jdbc/control/gui/JdbcTestSampleGui.java
index d86213d..3290aa6 100644
--- a/jakarta-jmeter/src/protocol/jdbc/org/apache/jmeter/protocol/jdbc/control/gui/JdbcTestSampleGui.java
+++ b/jakarta-jmeter/src/protocol/jdbc/org/apache/jmeter/protocol/jdbc/control/gui/JdbcTestSampleGui.java
@@ -53,23 +53,27 @@
  * <http://www.apache.org/>.
  */
 package org.apache.jmeter.protocol.jdbc.control.gui;
-import java.awt.*;
-import javax.swing.*;
-import javax.swing.border.*;
-import org.apache.jmeter.gui.*;
-import org.apache.jmeter.gui.util.VerticalLayout;
-import org.apache.jmeter.protocol.jdbc.config.*;
-import org.apache.jmeter.protocol.jdbc.config.gui.*;
-import org.apache.jmeter.util.JMeterUtils;
+import java.awt.Font;
+
+import javax.swing.JLabel;
+import javax.swing.JPanel;
+import javax.swing.border.Border;
+import javax.swing.border.EmptyBorder;
+
+import org.apache.jmeter.protocol.jdbc.config.gui.DbConfigGui;
+import org.apache.jmeter.protocol.jdbc.config.gui.PoolConfigGui;
+import org.apache.jmeter.protocol.jdbc.config.gui.SqlConfigGui;
+import org.apache.jmeter.protocol.jdbc.sampler.JDBCSampler;
 import org.apache.jmeter.samplers.gui.AbstractSamplerGui;
 import org.apache.jmeter.testelement.TestElement;
-import org.apache.jmeter.protocol.jdbc.sampler.JDBCSampler;
+import org.apache.jmeter.util.JMeterUtils;
+import org.apache.jorphan.gui.layout.VerticalLayout;
 
 /****************************************
  * Title: Description: Copyright: Copyright (c) 2001 Company:
  *
  *@author    Michael Stover
- *@created   $Date: 2002/08/11 19:24:53 $
+ *@created   $Date: 2002/10/17 19:47:20 $
  *@version   1.0
  ***************************************/
 
diff --git a/jakarta-jmeter/src/protocol/jdbc/org/apache/jmeter/protocol/jdbc/sampler/CVS/Entries b/jakarta-jmeter/src/protocol/jdbc/org/apache/jmeter/protocol/jdbc/sampler/CVS/Entries
index e653cdf..ec0bb35 100644
--- a/jakarta-jmeter/src/protocol/jdbc/org/apache/jmeter/protocol/jdbc/sampler/CVS/Entries
+++ b/jakarta-jmeter/src/protocol/jdbc/org/apache/jmeter/protocol/jdbc/sampler/CVS/Entries
@@ -1,2 +1,2 @@
-/JDBCSampler.java/1.1/Sun Aug 11 19:24:53 2002//Tv1_7_3
+/JDBCSampler.java/1.10/Sun Jan 12 01:28:40 2003//Tv1_8_1
 D
diff --git a/jakarta-jmeter/src/protocol/jdbc/org/apache/jmeter/protocol/jdbc/sampler/CVS/Tag b/jakarta-jmeter/src/protocol/jdbc/org/apache/jmeter/protocol/jdbc/sampler/CVS/Tag
index 5f312fe..e2fda28 100644
--- a/jakarta-jmeter/src/protocol/jdbc/org/apache/jmeter/protocol/jdbc/sampler/CVS/Tag
+++ b/jakarta-jmeter/src/protocol/jdbc/org/apache/jmeter/protocol/jdbc/sampler/CVS/Tag
@@ -1 +1 @@
-Nv1_7_3
+Nv1_8_1
diff --git a/jakarta-jmeter/src/protocol/jdbc/org/apache/jmeter/protocol/jdbc/sampler/JDBCSampler.java b/jakarta-jmeter/src/protocol/jdbc/org/apache/jmeter/protocol/jdbc/sampler/JDBCSampler.java
index 1a1bd72..ad680ba 100644
--- a/jakarta-jmeter/src/protocol/jdbc/org/apache/jmeter/protocol/jdbc/sampler/JDBCSampler.java
+++ b/jakarta-jmeter/src/protocol/jdbc/org/apache/jmeter/protocol/jdbc/sampler/JDBCSampler.java
@@ -2,7 +2,7 @@
  * ====================================================================
  * The Apache Software License, Version 1.1
  *
- * Copyright (c) 2001 The Apache Software Foundation.  All rights
+ * Copyright (c) 2001-2003 The Apache Software Foundation.  All rights
  * reserved.
  *
  * Redistribution and use in source and binary forms, with or without
@@ -52,9 +52,7 @@
  * information on the Apache Software Foundation, please see
  * <http://www.apache.org/>.
  */
- package org.apache.jmeter.protocol.jdbc.sampler;
-
-import java.net.URL;
+package org.apache.jmeter.protocol.jdbc.sampler;
 import java.sql.Connection;
 import java.sql.ResultSet;
 import java.sql.ResultSetMetaData;
@@ -74,246 +72,251 @@ import org.apache.jmeter.samplers.Entry;
 import org.apache.jmeter.samplers.SampleResult;
 import org.apache.jmeter.testelement.TestElement;
 import org.apache.jmeter.testelement.TestListener;
-import org.apache.jmeter.util.Data;
-
+import org.apache.log.Hierarchy;
+import org.apache.log.Logger;
+import org.apache.jorphan.collections.Data;
 /************************************************************
  *  A sampler which understands JDBC database requests
  *
- *@author     $Author: mstover1 $
- *@created    $Date: 2002/08/11 19:24:53 $
- *@version    $Revision: 1.1 $
+ *@author     $Author: jsalvata $
+ *@created    $Date: 2003/01/12 01:28:40 $
+ *@version    $Revision: 1.10 $
  ***********************************************************/
-
 public class JDBCSampler extends AbstractSampler implements TestListener
 {
+    transient private static Logger log =
+            Hierarchy.getDefaultHierarchy().getLoggerFor("jmeter.protocol.jdbc");
+    public final static String URL = "JDBCSampler.url";
+    public final static String DRIVER = "JDBCSampler.driver";
+    public static String CONNECTIONS = "JDBCSampler.connections";
+    public static String MAXUSE = "JDBCSampler.maxuse";
+    //database connection pool manager
+    transient DBConnectionManager manager = DBConnectionManager.getManager();
+    // end method
+    public final static String QUERY = "JDBCSampler.query";
+    private static Map keyMap = new HashMap();
+    private static boolean running = false;
 
-	public final static String URL = "JDBCSampler.url";
-	public final static String DRIVER = "JDBCSampler.driver";
-	public static String CONNECTIONS = "JDBCSampler.connections";
-	public static String MAXUSE = "JDBCSampler.maxuse";
-	//database connection pool manager
-	DBConnectionManager manager = DBConnectionManager.getManager();
-	// end method
+    /**
+     * Creates a JDBCSampler.
+     */
+    public JDBCSampler()
+    {
+    }
 
-	public final static String QUERY = "JDBCSampler.query";
-	private static Map keyMap = new HashMap();
-	private static boolean running = false;
+    public void addCustomTestElement(TestElement element)
+    {
+        if (element instanceof SqlConfig
+                || element instanceof PoolConfig
+                || element instanceof DbConfig)
+        {
+            this.mergeIn(element);
+        }
+    }
 
-	/************************************************************
-	 *  !ToDo (Constructor description)
-	 ***********************************************************/
-	public JDBCSampler()
-	{
+    public void testStarted(String host)
+    {
+    }
 
-	}
+    public void testEnded(String host)
+    {
+    }
 
-	public void addCustomTestElement(TestElement element)
-	{
-		if(element instanceof SqlConfig || element instanceof PoolConfig ||
-				element instanceof DbConfig)
-		{
-			this.mergeIn(element);
-		}
-	}
-	
-	public void testStarted(String host)
-	{
-	}
-	
-	public void testEnded(String host)
-	{
-	}
-	
-	public synchronized void testStarted()
-	{
-		if(!running)
-		{
-			running = true;
-		}
-	}
-	
-	public synchronized void testEnded()
-	{
-		if(running)
-		{
-			manager.shutdown();
-			keyMap.clear();
-			running = false;
-		}
-	}
-	
-	public String getQuery()
-	{
-		return this.getPropertyAsString(QUERY);
-	}
+    public synchronized void testStarted()
+    {
+        if (!running)
+        {
+            running = true;
+        }
+    }
 
-	/************************************************************
-	 *  !ToDo (Method description)
-	 *
-	 *@param  e  !ToDo (Parameter description)
-	 *@return    !ToDo (Return description)
-	 ***********************************************************/
-	public SampleResult sample(Entry e)
-	{
-		DBKey key = getKey();
-		long start;
-		long end;
-		long time;
-		time = start = end = 0;
-		SampleResult res = new SampleResult();
-		Connection con = null;
-		ResultSet rs = null;
-		Statement stmt = null;
-		Data data = new Data();
-		res.setSampleLabel(getQuery());
-		start = System.currentTimeMillis();
-		try
-		{
-			int count = 0;
-			while (count < 20 && (con = manager.getConnection(key)) == null)
-			{
-				try
-				{
-					Thread.sleep(10);
-				}
-				catch (Exception err)
-				{
-					count++;
-				}
-			}
-			stmt = con.createStatement();
-			// Execute database query
-			boolean retVal = stmt.execute(getQuery());
-			// Based on query return value, get results
-			if (retVal)
-			{
-				rs = stmt.getResultSet();
-				data = getDataFromResultSet(rs);
-				rs.close();
-			}
-			else
-			{
-				int updateCount = stmt.getUpdateCount();
-			}
-			stmt.close();
-			manager.releaseConnection(con);
-		}
-		catch (Exception ex)
-		{
-			if (rs != null)
-			{
-				try
-				{
-					rs.close();
-				}
-				catch (SQLException err)
-				{
-					rs = null;
-				}
-			}
-			if (stmt != null)
-			{
-				try
-				{
-					stmt.close();
-				}
-				catch (SQLException err)
-				{
-					stmt = null;
-				}
-			}
-			manager.releaseConnection(con);
-			ex.printStackTrace();
-		}
-		// Calculate response time
-		end = System.currentTimeMillis();
-		time += end - start;
-		res.setTime(time);
-		res.setResponseData(data.toString().getBytes());
-		res.setSamplerData(this);
-		res.setSuccessful(true);
-		return res;
-	}
-	
-	public String getUrl()
-	{
-		return getPropertyAsString(URL);
-	}
-	
-	public String getUsername()
-	{
-		return getPropertyAsString(ConfigTestElement.USERNAME);
-	}
-	
-	public String getPassword()
-	{
-		return getPropertyAsString(ConfigTestElement.PASSWORD);
-	}
-	
-	public String getDriver()
-	{
-		return getPropertyAsString(DRIVER);
-	}
-	
-	public int getMaxUse()
-	{
-		return getPropertyAsInt(this.MAXUSE);
-	}
-	
-	public int getNumConnections()
-	{
-		return getPropertyAsInt(CONNECTIONS);
-	}
+    public synchronized void testEnded()
+    {
+        if (running)
+        {
+            manager.shutdown();
+            keyMap.clear();
+            running = false;
+        }
+    }
 
-	private DBKey getKey()
-	{
-		DBKey key = (DBKey)keyMap.get(getUrl());
-		if (key == null)
-		{
-			key = manager.getKey(getUrl(), getUsername(),getPassword(),
-					getDriver(), getMaxUse(), getNumConnections());
-			keyMap.put(getUrl(), key);
-		}
-		return key;
-	}
+    public String getQuery()
+    {
+        return this.getPropertyAsString(QUERY);
+    }
 
-	/************************************************************
-	 *  Gets a Data object from a ResultSet.
-	 *
-	 *@param  rs                      ResultSet passed in from a database query
-	 *@return                         A Data object (com.stover.utils)
-	 *@exception  SQLException        !ToDo (Exception description)
-	 *@throws  java.sql.SQLException
-	 ***********************************************************/
-	private Data getDataFromResultSet(ResultSet rs) throws SQLException
-	{
-		ResultSetMetaData meta;
-		Data data = new Data();
-		meta = rs.getMetaData();
-		int numColumns = meta.getColumnCount();
-		String[] dbCols = new String[numColumns];
-		for (int count = 1; count <= numColumns; count++)
-		{
-			dbCols[count - 1] = meta.getColumnName(count);
-			data.addHeader(dbCols[count - 1]);
-		}
-		while (rs.next())
-		{
-			data.next();
-			for (int count = 0; count < numColumns; count++)
-			{
-				Object o = rs.getObject(count + 1);
-				if(o == null)
-				{
-				}
-				else if(o instanceof byte[])
-				{
-					o = new String((byte[])o);
-				}
-				data.addColumnValue(dbCols[count], o);
-			}
-		}
-		return data;
-	}
-}
+    public SampleResult sample(Entry e)
+    {
+        DBKey key = getKey();
+        long start;
+        long end;
+        long time;
+        time = start = end = 0;
+        SampleResult res = new SampleResult();
+        Connection con = null;
+        ResultSet rs = null;
+        Statement stmt = null;
+        Data data = new Data();
+        res.setSampleLabel(getQuery());
+        start = System.currentTimeMillis();
+        try
+        {
+            int count = 0;
+            while (count < 20 && (con = manager.getConnection(key)) == null)
+            {
+                try
+                {
+                    Thread.sleep(10);
+                }
+                catch (Exception err)
+                {
+                    count++;
+                }
+            }
+            stmt = con.createStatement();
+            // Execute database query
+            boolean retVal = stmt.execute(getQuery());
+            // Based on query return value, get results
+            if (retVal)
+            {
+                rs = stmt.getResultSet();
+                data = getDataFromResultSet(rs);
+                rs.close();
+            }
+            else
+            {
+                int updateCount = stmt.getUpdateCount();
+            }
+            stmt.close();
+            manager.releaseConnection(con);
+            res.setResponseData(data.toString().getBytes());
+            res.setDataType(res.TEXT);
+            res.setSuccessful(true);
+        }
+        catch (Exception ex)
+        {
+            if (rs != null)
+            {
+                try
+                {
+                    rs.close();
+                }
+                catch (SQLException err)
+                {
+                    rs = null;
+                }
+            }
+            if (stmt != null)
+            {
+                try
+                {
+                    stmt.close();
+                }
+                catch (SQLException err)
+                {
+                    stmt = null;
+                }
+            }
+            manager.releaseConnection(con);
+            log.error("Error in JDBC sampling", ex);
+            res.setResponseData(new byte[0]);
+            res.setSuccessful(false);
+        }
+        // Calculate response time
+        end = System.currentTimeMillis();
+        time += end - start;
+        res.setTime(time);
+        res.setSamplerData(this);
+        return res;
+    }
+
+    public String getUrl()
+    {
+        return getPropertyAsString(URL);
+    }
+
+    public String getUsername()
+    {
+        return getPropertyAsString(ConfigTestElement.USERNAME);
+    }
+
+    public String getPassword()
+    {
+        return getPropertyAsString(ConfigTestElement.PASSWORD);
+    }
 
+    public String getDriver()
+    {
+        return getPropertyAsString(DRIVER);
+    }
+
+    public int getMaxUse()
+    {
+        return getPropertyAsInt(this.MAXUSE);
+    }
+
+    public int getNumConnections()
+    {
+        return getPropertyAsInt(CONNECTIONS);
+    }
+
+    private DBKey getKey()
+    {
+        DBKey key = (DBKey) keyMap.get(getUrl());
+        if (key == null)
+        {
+            key = manager.getKey(getUrl(),
+                                 getUsername(),
+                                 getPassword(),
+                                 getDriver(),
+                                 getMaxUse(),
+                                 getNumConnections());
+            keyMap.put(getUrl(), key);
+        }
+        return key;
+    }
+
+    /**
+     * Gets a Data object from a ResultSet.
+     *
+     * @param  rs                      ResultSet passed in from a database query
+     * @return                         A Data object (com.stover.utils)
+     * @exception  SQLException        !ToDo (Exception description)
+     * @throws  java.sql.SQLException
+     */
+    private Data getDataFromResultSet(ResultSet rs) throws SQLException
+    {
+        ResultSetMetaData meta;
+        Data data = new Data();
+        meta = rs.getMetaData();
+        int numColumns = meta.getColumnCount();
+        String[] dbCols = new String[numColumns];
+        for (int count = 1; count <= numColumns; count++)
+        {
+            dbCols[count - 1] = meta.getColumnName(count);
+            data.addHeader(dbCols[count - 1]);
+        }
+        while (rs.next())
+        {
+            data.next();
+            for (int count = 0; count < numColumns; count++)
+            {
+                Object o = rs.getObject(count + 1);
+                if (o == null)
+                {
+                }
+                else if (o instanceof byte[])
+                {
+                    o = new String((byte[]) o);
+                }
+                data.addColumnValue(dbCols[count], o);
+            }
+        }
+        return data;
+    }
+
+    public String toString()
+    {
+        return getUrl()+", user: "+getUsername()+"\n"+getQuery();
+    }
+}
diff --git a/jakarta-jmeter/src/protocol/jdbc/org/apache/jmeter/protocol/jdbc/util/CVS/Entries b/jakarta-jmeter/src/protocol/jdbc/org/apache/jmeter/protocol/jdbc/util/CVS/Entries
index c52135f..147070e 100644
--- a/jakarta-jmeter/src/protocol/jdbc/org/apache/jmeter/protocol/jdbc/util/CVS/Entries
+++ b/jakarta-jmeter/src/protocol/jdbc/org/apache/jmeter/protocol/jdbc/util/CVS/Entries
@@ -1,4 +1,4 @@
-/ConnectionObject.java/1.1/Sun Aug 11 19:24:53 2002//Tv1_7_3
-/DBConnectionManager.java/1.1/Sun Aug 11 19:24:53 2002//Tv1_7_3
-/DBKey.java/1.1/Sun Aug 11 19:24:53 2002//Tv1_7_3
+/ConnectionObject.java/1.3/Thu Aug 29 18:17:43 2002//Tv1_8_1
+/DBConnectionManager.java/1.3/Thu Aug 29 18:17:43 2002//Tv1_8_1
+/DBKey.java/1.1/Sun Aug 11 19:24:53 2002//Tv1_8_1
 D
diff --git a/jakarta-jmeter/src/protocol/jdbc/org/apache/jmeter/protocol/jdbc/util/CVS/Tag b/jakarta-jmeter/src/protocol/jdbc/org/apache/jmeter/protocol/jdbc/util/CVS/Tag
index 5f312fe..e2fda28 100644
--- a/jakarta-jmeter/src/protocol/jdbc/org/apache/jmeter/protocol/jdbc/util/CVS/Tag
+++ b/jakarta-jmeter/src/protocol/jdbc/org/apache/jmeter/protocol/jdbc/util/CVS/Tag
@@ -1 +1 @@
-Nv1_7_3
+Nv1_8_1
diff --git a/jakarta-jmeter/src/protocol/jdbc/org/apache/jmeter/protocol/jdbc/util/ConnectionObject.java b/jakarta-jmeter/src/protocol/jdbc/org/apache/jmeter/protocol/jdbc/util/ConnectionObject.java
index 5d6697a..3eaed1d 100644
--- a/jakarta-jmeter/src/protocol/jdbc/org/apache/jmeter/protocol/jdbc/util/ConnectionObject.java
+++ b/jakarta-jmeter/src/protocol/jdbc/org/apache/jmeter/protocol/jdbc/util/ConnectionObject.java
@@ -54,7 +54,11 @@
  */
 
 package org.apache.jmeter.protocol.jdbc.util;
-import java.sql.*;
+import java.sql.Connection;
+import java.sql.SQLException;
+
+import org.apache.log.Hierarchy;
+import org.apache.log.Logger;
 
 
 /*********************************************************
@@ -68,6 +72,8 @@ import java.sql.*;
  *****************************************************************/
 public class ConnectionObject  implements Runnable
 {
+	transient private static Logger log = Hierarchy.getDefaultHierarchy().getLoggerFor(
+			"jmeter.protocol.jdbc");
   Connection con;
   DBKey key;
   int useCount,maxUsage;
@@ -96,7 +102,7 @@ public class ConnectionObject  implements Runnable
 	 reset.start();
 	/* try{
 		reset();
-	 }catch(SQLException e){e.printStackTrace();}*/
+	 }catch(SQLException e){log.error("",e);}*/
   } // End Method
 
 /*************************************************************
@@ -220,8 +226,9 @@ Method to run in separate thread that resets the connection object
 		  reset();
 		  set=false;
 		 // Functions.javaLog("ConnectionObject: Got to here - 2");
-		}catch(SQLException e){System.out.println("ConnectionObject: e="+e.toString()+
-				  "url = "+key.getUrl());}
+		}catch(SQLException e){
+			log.error("ConnectionObject: url = "+key.getUrl(),e);
+		}			
 	 }
 	// Functions.javaLog("ConnectionObject: Got to here - 3");
 	 reset=new Thread(this);
diff --git a/jakarta-jmeter/src/protocol/jdbc/org/apache/jmeter/protocol/jdbc/util/DBConnectionManager.java b/jakarta-jmeter/src/protocol/jdbc/org/apache/jmeter/protocol/jdbc/util/DBConnectionManager.java
index 12df61d..7b307b1 100644
--- a/jakarta-jmeter/src/protocol/jdbc/org/apache/jmeter/protocol/jdbc/util/DBConnectionManager.java
+++ b/jakarta-jmeter/src/protocol/jdbc/org/apache/jmeter/protocol/jdbc/util/DBConnectionManager.java
@@ -54,8 +54,16 @@
  */
 
 package org.apache.jmeter.protocol.jdbc.util;
-import java.sql.*;
-import java.util.*;
+import java.sql.Connection;
+import java.sql.DatabaseMetaData;
+import java.sql.Driver;
+import java.sql.DriverManager;
+import java.sql.SQLException;
+import java.util.Hashtable;
+import java.util.Iterator;
+
+import org.apache.log.Hierarchy;
+import org.apache.log.Logger;
 
 /*****************************************************************
  This class manages a pool of Connection objects (ConnectionObject).  This
@@ -69,6 +77,8 @@ import java.util.*;
  *****************************************************************/
 public class DBConnectionManager
 {
+	transient private static Logger log = Hierarchy.getDefaultHierarchy().getLoggerFor(
+			"jmeter.protocol.jdbc");
   int absoluteMaxConnections=100;
   long accessInterval=1800000;
   Hashtable connections;
@@ -161,7 +171,7 @@ Constructor.
 		  maxConnections=absoluteMaxConnections;
 		  key.setMaxConnections(maxConnections);
 		}
-	 }catch(Exception e){e.printStackTrace();
+	 }catch(Exception e){log.error("",e);
 		maxConnections=1;}
 	 connectionArray=new ConnectionObject[maxConnections];
 	 int count=-1;
@@ -220,7 +230,7 @@ Constructor.
 	 }
 	 else
 	 {
-		System.out.println("DBConnectionManager: Lost a connection connection='"+c+"'\r\n");
+		log.warn("DBConnectionManager: Lost a connection connection='"+c);
 		c=null;
 	 }
   } // End Method
@@ -263,7 +273,7 @@ Registers a driver for a database.
   {
 	 try{
 		DriverManager.registerDriver((Driver)Class.forName(driver).newInstance());
-	 }catch(Exception e){e.printStackTrace(); return false;}
+	 }catch(Exception e){log.error("",e); return false;}
 	 return true;
   }
 
@@ -279,7 +289,7 @@ Registers a driver for a database.
 	 {
 		DatabaseMetaData dmd=connection[counter].getCon().getMetaData();
 		int cons=dmd.getMaxConnections();
-	 }catch(SQLException e){connected=false;e.printStackTrace();}
+	 }catch(SQLException e){connected=false;log.error("",e);}
 
 	 return connected;
   }  //end of method      */
diff --git a/jakarta-jmeter/src/protocol/jndi/CVS/Tag b/jakarta-jmeter/src/protocol/jndi/CVS/Tag
index f4b6a59..75ba187 100644
--- a/jakarta-jmeter/src/protocol/jndi/CVS/Tag
+++ b/jakarta-jmeter/src/protocol/jndi/CVS/Tag
@@ -1 +1 @@
-Tv1_7_3
+Tv1_8_1
diff --git a/jakarta-jmeter/src/protocol/jndi/config/CVS/Entries b/jakarta-jmeter/src/protocol/jndi/config/CVS/Entries
index 98d3d6c..8919f55 100644
--- a/jakarta-jmeter/src/protocol/jndi/config/CVS/Entries
+++ b/jakarta-jmeter/src/protocol/jndi/config/CVS/Entries
@@ -1,6 +1,6 @@
-/JndiConfig.java/1.1/Sun Aug 11 19:24:53 2002//Tv1_7_3
-/LookupConfig.java/1.1/Sun Aug 11 19:24:53 2002//Tv1_7_3
-/MethodConfig.java/1.1/Sun Aug 11 19:24:53 2002//Tv1_7_3
-/MethodConfigUserObject.java/1.1/Sun Aug 11 19:24:53 2002//Tv1_7_3
-/MethodConfigUserObjectException.java/1.1/Sun Aug 11 19:24:53 2002//Tv1_7_3
+/JndiConfig.java/1.1/Sun Aug 11 19:24:53 2002//Tv1_8_1
+/LookupConfig.java/1.1/Sun Aug 11 19:24:53 2002//Tv1_8_1
+/MethodConfig.java/1.1/Sun Aug 11 19:24:53 2002//Tv1_8_1
+/MethodConfigUserObject.java/1.1/Sun Aug 11 19:24:53 2002//Tv1_8_1
+/MethodConfigUserObjectException.java/1.1/Sun Aug 11 19:24:53 2002//Tv1_8_1
 D/gui////
diff --git a/jakarta-jmeter/src/protocol/jndi/config/CVS/Tag b/jakarta-jmeter/src/protocol/jndi/config/CVS/Tag
index 5f312fe..e2fda28 100644
--- a/jakarta-jmeter/src/protocol/jndi/config/CVS/Tag
+++ b/jakarta-jmeter/src/protocol/jndi/config/CVS/Tag
@@ -1 +1 @@
-Nv1_7_3
+Nv1_8_1
diff --git a/jakarta-jmeter/src/protocol/jndi/config/gui/CVS/Entries b/jakarta-jmeter/src/protocol/jndi/config/gui/CVS/Entries
index 65939a6..e63908d 100644
--- a/jakarta-jmeter/src/protocol/jndi/config/gui/CVS/Entries
+++ b/jakarta-jmeter/src/protocol/jndi/config/gui/CVS/Entries
@@ -1,5 +1,5 @@
-/JndiConfigGui.java/1.1/Sun Aug 11 19:24:53 2002//Tv1_7_3
-/LookupConfigGui.java/1.1/Sun Aug 11 19:24:53 2002//Tv1_7_3
-/MethodConfigDialog.java/1.1/Sun Aug 11 19:24:53 2002//Tv1_7_3
-/MethodConfigGui.java/1.1/Sun Aug 11 19:24:53 2002//Tv1_7_3
+/JndiConfigGui.java/1.1/Sun Aug 11 19:24:53 2002//Tv1_8_1
+/LookupConfigGui.java/1.1/Sun Aug 11 19:24:53 2002//Tv1_8_1
+/MethodConfigDialog.java/1.1/Sun Aug 11 19:24:53 2002//Tv1_8_1
+/MethodConfigGui.java/1.3/Thu Aug 29 18:17:43 2002//Tv1_8_1
 D
diff --git a/jakarta-jmeter/src/protocol/jndi/config/gui/CVS/Tag b/jakarta-jmeter/src/protocol/jndi/config/gui/CVS/Tag
index 5f312fe..e2fda28 100644
--- a/jakarta-jmeter/src/protocol/jndi/config/gui/CVS/Tag
+++ b/jakarta-jmeter/src/protocol/jndi/config/gui/CVS/Tag
@@ -1 +1 @@
-Nv1_7_3
+Nv1_8_1
diff --git a/jakarta-jmeter/src/protocol/jndi/config/gui/MethodConfigGui.java b/jakarta-jmeter/src/protocol/jndi/config/gui/MethodConfigGui.java
index f93cf9b..d79c7e6 100644
--- a/jakarta-jmeter/src/protocol/jndi/config/gui/MethodConfigGui.java
+++ b/jakarta-jmeter/src/protocol/jndi/config/gui/MethodConfigGui.java
@@ -53,33 +53,41 @@
  * <http://www.apache.org/>.
  */
 package org.apache.jmeter.ejb.jndi.config.gui;
-
-import javax.swing.*;
-import javax.swing.event.*;
-import javax.swing.tree.*;
-import javax.swing.border.*;
-import java.awt.event.*;
-import javax.naming.InitialContext;
-import java.awt.*;
-import java.util.*;
-
+import java.awt.Component;
+import java.awt.Dimension;
+import java.awt.Font;
+import java.awt.Frame;
+import java.awt.event.ActionEvent;
+import java.awt.event.ActionListener;
+import java.awt.event.MouseAdapter;
+import java.awt.event.MouseEvent;
+import java.awt.event.MouseListener;
 import java.lang.reflect.Field;
-
-import org.apache.jmeter.control.TestPlan;
-import org.apache.jmeter.engine.ReflectionJMeterEngine;
+import java.util.ArrayList;
+import java.util.Collection;
+import java.util.Iterator;
+import javax.swing.BorderFactory;
+import javax.swing.JButton;
+import javax.swing.JComboBox;
+import javax.swing.JLabel;
+import javax.swing.JPanel;
+import javax.swing.JTree;
+import javax.swing.border.Border;
+import javax.swing.border.EmptyBorder;
+import javax.swing.event.TreeSelectionEvent;
+import javax.swing.event.TreeSelectionListener;
+import javax.swing.tree.DefaultMutableTreeNode;
+import javax.swing.tree.DefaultTreeModel;
+import javax.swing.tree.TreePath;
+import javax.swing.tree.TreeSelectionModel;
 import org.apache.jmeter.gui.GuiPackage;
-import org.apache.jmeter.gui.ModelSupported;
 import org.apache.jmeter.gui.NamePanel;
-import org.apache.jmeter.gui.VerticalLayout;
-import org.apache.jmeter.config.gui.ArgumentsPanel;
-import org.apache.jmeter.config.Arguments;
+import org.apache.jmeter.gui.util.VerticalLayout;
+import org.apache.jmeter.testelement.TestPlan;
 import org.apache.jmeter.threads.ThreadGroup;
 import org.apache.jmeter.util.JMeterUtils;
-import org.apache.jmeter.ejb.jndi.config.MethodConfig;
-import org.apache.jmeter.ejb.jndi.config.MethodConfigUserObject;
-import org.apache.jmeter.ejb.jndi.config.MethodConfigUserObjectException;
-import org.apache.log4j.Category;
-
+import org.apache.log.Hierarchy;
+import org.apache.log.Logger;
 /**
  * Provides the gui interface to configure remote method execution
  * @author	Khor Soon Hin
@@ -87,851 +95,815 @@ import org.apache.log4j.Category;
  * @created	2001 Dec 24
  * @modified	2001 Dec 30
  */
-public class MethodConfigGui extends JPanel implements ModelSupported,
-	ActionListener, TreeSelectionListener
+public class MethodConfigGui
+	extends JPanel
+	implements ModelSupported, ActionListener, TreeSelectionListener
 {
-  private static Category catClass = Category.getInstance(
-	MethodConfigGui.class.getName());
-
-  protected static final String REFLECT = "MethodConfigGui.reflect";
-  protected static final String INVOKE = "MethodConfigGui.invoke";
-  protected static final String STRING_CLASS = "java.lang.String";
-
-  protected JComboBox methodHomeNameBox;
-  protected JComboBox methodRemoteNameBox;
-  protected JComboBox remoteInterfaceBox;
-
-  protected DefaultMutableTreeNode rootHome;
-  protected DefaultMutableTreeNode rootRemote;
-  protected DefaultTreeModel treeModelHome;
-  protected DefaultTreeModel treeModelRemote;
-  protected NamePanel namePanel;
-  protected JPanel methodHomeNamePanel;
-  protected JPanel methodHomeParmsPanel;
-  protected JPanel remoteInterfaceListPanel;
-  protected JPanel methodRemoteNamePanel;
-  protected JPanel methodRemoteParmsPanel;
-  protected JPanel controlPanel;
-  protected JButton actionButton;
-  protected JTree jTreeHome;
-  protected JTree jTreeRemote;
-  protected boolean displayName;
-  protected MethodConfig model;
-  protected Frame frame;
+	transient private static Logger log =
+		Hierarchy.getDefaultHierarchy().getLoggerFor("jmeter.protocol.jndi");
+	protected static final String REFLECT = "MethodConfigGui.reflect";
+	protected static final String INVOKE = "MethodConfigGui.invoke";
+	protected static final String STRING_CLASS = "java.lang.String";
+	protected JComboBox methodHomeNameBox;
+	protected JComboBox methodRemoteNameBox;
+	protected JComboBox remoteInterfaceBox;
+	protected DefaultMutableTreeNode rootHome;
+	protected DefaultMutableTreeNode rootRemote;
+	protected DefaultTreeModel treeModelHome;
+	protected DefaultTreeModel treeModelRemote;
+	protected NamePanel namePanel;
+	protected JPanel methodHomeNamePanel;
+	protected JPanel methodHomeParmsPanel;
+	protected JPanel remoteInterfaceListPanel;
+	protected JPanel methodRemoteNamePanel;
+	protected JPanel methodRemoteParmsPanel;
+	protected JPanel controlPanel;
+	protected JButton actionButton;
+	protected JTree jTreeHome;
+	protected JTree jTreeRemote;
+	protected boolean displayName;
+	protected MethodConfig model;
+	protected Frame frame;
 	// The frame is required because the JDialog we create must be modal
 	// and to be modal it must be modal relative to a frame.  We want
 	// the dialog boxes to be modal so that user must fill them up before
 	// they can do anything with jmeter
-
-  public MethodConfigGui()
-  {
-    displayName = true;
-  }
-
-  public MethodConfigGui(boolean displayName)
-  {
-    this.displayName = displayName;
-  }
-
-  //----- ModelSupported interface : start -----
-
-  public void setModel(Object model)
-  {
-    this.model = (MethodConfig)model;
-    init();
-  }
-
-  public void updateGui()
-  {
-    catClass.debug("Start : updateGui1");
-System.out.println("updateGui1");
-    // the method name box will always be displayed regardless of the state
-    // of the MethodConfig of this gui
-    String methodName = model.getMethodHomeName();
-    catClass.debug("updateGui1 : home method name - " + methodName);
-    String[] strings = model.getMethodHomeList();
-    setupPullDown(methodHomeNameBox, methodName, strings);
-    // if methodName is null set the home method to be the first entry
-    // as setup in the home method name JComboBox by setupPullDown
-    // This is to ensure that if the user does not change the JComboBox
-    // the first value is set anyway.
-    if(methodName == null && strings != null)
-    {
-      model.setMethodHomeName(strings[0]);
-    }
-    // if the state of the MethodConfig of this gui after 
-    // MethodConfig.METHOD_GET_HOME_NAMES, display panel to get
-    // parms of the selected method
-    int childCount = treeModelHome.getChildCount(rootHome);
-    if(catClass.isDebugEnabled())
-    {
-      catClass.debug("updateGui1 : state - " + model.getState());
-      catClass.debug("updateGui1 : METHOD_GET_HOME_NAMES");
-      catClass.debug("updateGui1 : rootHome child count - " + childCount);
-    }
-    // if model is in state after getting home method name AND
-    // rootHome(method) has no child(parms set) yet then get them
-    if(model.getState() > MethodConfig.METHOD_GET_HOME_PARMS  && 
-        childCount == 0)
-    {
-      catClass.debug("updateGui1 : METHOD_GET_HOME_PARMS");
-      rootHome.setUserObject(model.getMethodHomeName());
-//      methodParmsPanel.setVisible(true);
-      // get all the parms
-      Class[] parmTypes = model.getMethodHomeParms();
-      // add all the parms into a JTree
-      for(int i = 0 ;i < parmTypes.length; i++)
-      {
-        catClass.debug("updateGui1 : parmType #" + i + " - " + parmTypes[i]);
-        recurseParm(parmTypes[i], rootHome, i, treeModelHome);
-      }
-      // if the chosen method has no parms then updating the value of
-      // root node with the method name doesn't seem to trigger a redraw of
-      // the tree so call treeDidChange()
-      if(parmTypes.length == 0)
-      {
-        jTreeHome.treeDidChange();
-      }
-    }
-    // if model is in state after getting home method name and
-    // all home method parms gave been obtained then get list of
-    // remote interfaces
-    if(model.getState() > MethodConfig.METHOD_SELECT_REMOTE_INTERFACE)
-    {
-      catClass.debug("METHOD_SELECT_REMOTE_INTERFACE");
-      // remoteInterfaceType is the remote interface selected by the user
-      // remoteInterfaces contains the list of remote interfaces returned
-      // by home method
-      Object remoteInterfaceType = model.getRemoteInterfaceType();
-      String interfaceName = null;
-      if(remoteInterfaceType != null)
-      {
-        interfaceName = remoteInterfaceType.toString();
-      }
-      ArrayList remoteInterfaces = (ArrayList)model.getRemoteInterfaceList();
-      if(catClass.isDebugEnabled())
-      {
-        catClass.debug("updateGui1 : remote interfaces - " + remoteInterfaces);
-        catClass.debug("updateGui1 : remoteInterfacesType - " + 
-		remoteInterfaces.getClass());
-      }
-      // prepare variable strings to contain a list of all the names of
-      // the remote interfaces
-      Object[] remoteInterfacesArray = remoteInterfaces.toArray();
-      strings = new String[remoteInterfacesArray.length];
-      for(int i = 0; i < remoteInterfacesArray.length; i++)
-      {
-        strings[i] = remoteInterfacesArray[i].toString();
-      }
-      setupPullDown(remoteInterfaceBox, interfaceName, 
-		strings);
-      // if interfaceName is null set the remote interface to be the first 
-      // entry as setup in the remote interface name JComboBox by setupPullDown.
-      // This is to ensure that if the user does not change the JComboBox
-      // the first value is set anyway.
-      if(interfaceName == null && remoteInterfacesArray != null)
-      {
-        model.setRemoteInterfaceType(remoteInterfacesArray[0]);
-      }
-    }
-    // if model is in state after user selects the list of remote interface
-    // then get a list of remote method names
-    if(model.getState() > MethodConfig.METHOD_GET_REMOTE_NAMES)
-    {
-      catClass.debug("METHOD_GET_REMOTE_NAMES");
-      methodName = model.getMethodRemoteName();
-      catClass.debug("updateGui1 : remote method name - " + methodName);
-      strings = model.getMethodRemoteList();
-      setupPullDown(methodRemoteNameBox, methodName, strings);
-      childCount = treeModelRemote.getChildCount(rootRemote);
-      if(catClass.isDebugEnabled())
-      {
-        catClass.debug("updateGui1 : rootRemote child count - " + childCount);
-      }
-    }
-    // if model is in state after getting remote interface AND
-    // rootRemote(method) has no child(parms set) yet then get them
-    if(model.getState() > MethodConfig.METHOD_GET_REMOTE_PARMS && 
-        childCount == 0)
-    {
-      catClass.debug("METHOD_GET_REMOTE_PARMS");
-      rootRemote.setUserObject(model.getMethodRemoteName());
-//      methodParmsPanel.setVisible(true);
-      // get all the parms
-      Class[] parmTypes = model.getMethodRemoteParms();
-      // add all the parms into a JTree
-      for(int i = 0 ;i < parmTypes.length; i++)
-      {
-        catClass.debug("updateGui1 : parmType #" + i + " - " + parmTypes[i]);
-        recurseParm(parmTypes[i], rootHome, i, treeModelHome);
-      }
-      // if the chosen method has no parms then updating the value of
-      // root node with the method name doesn't seem to trigger a redraw of
-      // the tree so call treeDidChange()
-      if(parmTypes.length == 0)
-      {
-        jTreeRemote.treeDidChange();
-      }
-    }
-    // if the state of the MethodConfig of this gui is
-    // MethodConfig.METHOD_GET_HOME_PARMS, display panel
-    if(displayName)
-    {
-      namePanel.updateGui();
-    }
-    catClass.debug("End : updateGui1");
-  }
-
-  //----- ModelSupported interface : end -----
-
-  protected void init()
-  {
-    catClass.info("Start : init1");
-    // The frame is required because the JDialog we create must be modal
-    // and to be modal it must be modal relative to a frame.  We want
-    // the dialog boxes to be modal so that user must fill them up before
-    // they can do anything with jmeter
-    GuiPackage guiPkg = GuiPackage.getInstance();
-    frame = guiPkg.getMainFrame();
-
-    model.setState(MethodConfig.METHOD_GET_HOME_NAMES);
-    model.setGui(this);
-    methodHomeNameBox = new JComboBox();
-    methodHomeNameBox.setEditable(false);
-    methodHomeNameBox.setAlignmentX(Component.LEFT_ALIGNMENT);
-    methodHomeNameBox.addActionListener(new ActionListener()
-        {
-          public void actionPerformed(ActionEvent e)
-          {
-	    catClass.debug(
-		"actionPerformed1 : Home name method JComboBox changed");
-            // change in method name so do the following
-            JComboBox comboBox = (JComboBox)e.getSource();
-            String method = (String)methodHomeNameBox.getSelectedItem();
-            model.setMethodHomeName(method);
-            model.setState(MethodConfig.METHOD_GET_HOME_PARMS);
-	    resetHomeMethodParms();
-	    resetRemoteInterfaceList();
-	    resetRemoteMethodName();
-	    resetRemoteMethodParms();
-//            methodParmsPanel.setVisible(false);
-            actionButton.setText(
-                JMeterUtils.getResString("jndi_method_button_reflect"));
-            updateGui();
-          }
-        });
-    remoteInterfaceBox = new JComboBox();
-    remoteInterfaceBox.setEditable(false);
-    remoteInterfaceBox.setAlignmentX(Component.LEFT_ALIGNMENT);
-    remoteInterfaceBox.addActionListener(new ActionListener()
+	public MethodConfigGui()
 	{
-          public void actionPerformed(ActionEvent e)
-	  {
-	    catClass.debug(
-		"actionPerformed1 : Remote Interface JComboBox changed");
-            JComboBox comboBox = (JComboBox)e.getSource();
-            String interfaceName = (String)remoteInterfaceBox.getSelectedItem();
-	    // compare interface selected with the ones in the remote interface
-	    // list and store the corresponding object in MethodConfig
-            ArrayList remoteInterfaceList = 
-		(ArrayList)model.getRemoteInterfaceList();
-	    if(remoteInterfaceList != null)
-	    {
-              Object[] remoteInterfaceListArray = remoteInterfaceList.toArray();
-              int i = 0;
-              boolean found = false;
-              String remoteInterfaceListName = null;
-              Object selectedInterface = null;
-              while(i < remoteInterfaceListArray.length && !found)
-              {
-                remoteInterfaceListName = remoteInterfaceListArray[i].toString();
-                if(remoteInterfaceListName.equals(interfaceName))
-                {
-                  found = true;
-                  selectedInterface = remoteInterfaceListArray[i];
-                }
-                i++;
-              }
-              model.setRemoteInterfaceType(selectedInterface);
-              model.setState(MethodConfig.METHOD_GET_REMOTE_NAMES);
-	    }
-	    resetRemoteMethodName();
-	    resetRemoteMethodParms();
-//            methodParmsPanel.setVisible(false);
-            actionButton.setText(
-                JMeterUtils.getResString("jndi_method_button_reflect"));
-            updateGui();
-	  }
-	});
-    methodRemoteNameBox = new JComboBox();
-    methodRemoteNameBox.setEditable(false);
-    methodRemoteNameBox.setAlignmentX(Component.LEFT_ALIGNMENT);
-    methodRemoteNameBox.addActionListener(new ActionListener()
-        {
-          public void actionPerformed(ActionEvent e)
-          {
-	    catClass.debug(
-		"actionPerformed1 : Remote method name JComboBox changed");
-            // change in method name so do the following
-            JComboBox comboBox = (JComboBox)e.getSource();
-            String method = (String)methodRemoteNameBox.getSelectedItem();
-            model.setMethodRemoteName(method);
-            model.setState(MethodConfig.METHOD_GET_REMOTE_PARMS);
-	    resetRemoteMethodParms();
-//            methodParmsPanel.setVisible(false);
-            actionButton.setText(
-                JMeterUtils.getResString("jndi_method_button_reflect"));
-            updateGui();
-          }
-        });
-
-
-//rootHome = new DefaultMutableTreeNode("Root");
-//treeModelHome = new DefaultTreeModel(rootHome);
-    this.setLayout(new VerticalLayout(5, VerticalLayout.LEFT, 
-	VerticalLayout.TOP));
-    JPanel mainPanel = new JPanel();
-    Border margin = new EmptyBorder(10, 10, 5, 10);
-    mainPanel.setBorder(margin);
-    mainPanel.setLayout(new VerticalLayout(5, VerticalLayout.LEFT));
-
-    // title
-    JLabel panelTitleLabel = new JLabel(
-	JMeterUtils.getResString("jndi_method_title"));
-    Font curFont = panelTitleLabel.getFont();
-    int curFontSize = curFont.getSize();
-    curFontSize += 4;
-    panelTitleLabel.setFont(new Font(curFont.getFontName(), 
-	curFont.getStyle(), curFontSize));
-    mainPanel.add(panelTitleLabel);
-    
-    // name
-    namePanel = new NamePanel(model);
-    mainPanel.add(namePanel);
-
-    // method properties
-    JPanel jndiPanel = new JPanel();
-    jndiPanel.setLayout(new VerticalLayout(5, VerticalLayout.LEFT));
-    jndiPanel.setBorder(BorderFactory.createTitledBorder(
-	JMeterUtils.getResString("jndi_method_name")));
-
-    methodHomeNamePanel = getMethodHomeNamePanel();
-    methodHomeParmsPanel = getMethodHomeParmsPanel();
-    remoteInterfaceListPanel = getRemoteInterfaceListPanel();
-    methodRemoteNamePanel= getMethodRemoteNamePanel();
-    methodRemoteParmsPanel = getMethodRemoteParmsPanel();
-
-    jndiPanel.add(methodHomeNamePanel);
-    jndiPanel.add(methodHomeParmsPanel);
-    jndiPanel.add(remoteInterfaceListPanel);
-    jndiPanel.add(methodRemoteNamePanel);
-    jndiPanel.add(methodRemoteParmsPanel);
-    controlPanel = new JPanel();
-    actionButton = new JButton(
-	JMeterUtils.getResString("jndi_method_button_reflect"));
-    actionButton.addActionListener(this);
-    actionButton.setActionCommand(REFLECT);
-    controlPanel.add(actionButton);
-   jndiPanel.add(controlPanel);
-
-    mainPanel.add(jndiPanel);
-
-    this.add(mainPanel);
-
-//methodHomeParmsPanel.setVisible(false);
-    catClass.info("End : init1");
-  }
-
-  /**
-   * Given a parameter type of a method, this method will find out
-   * if the parm type is a primitive.  If so, it'll just add the parm type
-   * as a node into the tree model (used to store all parm types of the method).
-   * If however, the parm type is not a primitive, then the parm type will be
-   * further recursed i.e. a reflection of all the fields is obtained
-   * and each of which will be examined to determined if they are primitives.
-   * For those which are primitives, they'll be added to the tree model
-   * and those otherwise will be further recursed.
-   *
-   * @param parmType	the parmType of a method which will be examined
-   * @param parentNode	the node under which the parmType will be added to
-   * @param childIndex	the index of the this parmType if it were to be added
-   *			under the parent node
-   */
-
-  protected void recurseParm(Class parmType, DefaultMutableTreeNode parentNode,
-	int childIndex, DefaultTreeModel treeModel)
-  {
-    catClass.debug("Start - recurseParm1");
-    DefaultMutableTreeNode node = new DefaultMutableTreeNode(parmType);
-    treeModel.insertNodeInto(node, parentNode, childIndex);
-System.out.println("recurseParm1 - parent : " + parentNode);
-System.out.println("recurseParm1 - parent : " + treeModel.getChildCount(parentNode));
-System.out.println("recurseParm1 - child : " + treeModel.getChildCount(node));
-    if(parmType.isPrimitive())
-    {
-      // if parmType is primitive then no need to recurse the parm
-    }
-    else if(parmType.getName().equals(STRING_CLASS))
-    {
-      // consider String as a primitive i.e. there is not need to recurse parm
-    }
-    else if(parmType.isArray())
-    {
-      // if parmType is array then need to handle differently
-    }
-    else
-    {
-      // if parmType is NOT primitive then need to recurse the parm since
-      // it's an object.
-      // to recurse the object, use reflections to get all fields
-      Field[] fields = parmType.getFields();
-      for(int i = 0; i < fields.length; i++)
-      {
-        Class fieldClass = fields[i].getType();
-        catClass.debug("recurseParm1 : field #" + i + " - " + fieldClass);
-        recurseParm(fieldClass, node, i, treeModel);
-      }
-    }
-    catClass.debug("End - recurseParm1");
-  }
-
-  protected JPanel getMethodHomeNamePanel()
-  {
-    catClass.info("Start : getMethodHomeNamePanel1");
-    JPanel panel = new JPanel();
-    panel.add(new JLabel(JMeterUtils.getResString("jndi_method_home_name")));
-    String methodName = model.getMethodHomeName();
-    if(methodName != null)
-    {
-      methodHomeNameBox.setSelectedItem(methodName);
-    }
-    panel.add(methodHomeNameBox);
-    catClass.info("End : getMethodHomeNamePanel1");
-    return panel;
-  }
-
-  protected JPanel getRemoteInterfaceListPanel()
-  {
-    catClass.info("Start : getRemoteInterfaceListPanel1");
-    JPanel panel = new JPanel();
-    panel.add(new JLabel(JMeterUtils.getResString(
-	"jndi_method_remote_interface_list")));
-    Object remoteInterfaceType =  model.getRemoteInterfaceType();
-    if(remoteInterfaceType != null)
-    {
-      remoteInterfaceBox.setSelectedItem(remoteInterfaceType.toString());
-    }
-    panel.add(remoteInterfaceBox);
-    catClass.info("End : getRemoteInterfaceListPanel1");
-    return panel;
-  }
-
-  protected JPanel getMethodRemoteNamePanel()
-  {
-    catClass.info("Start : getMethodRemoteNamePanel1");
-    JPanel panel = new JPanel();
-    panel.add(new JLabel(JMeterUtils.getResString("jndi_method_remote_name")));
-    String methodName = model.getMethodRemoteName();
-    if(methodName != null)
-    {
-      methodRemoteNameBox.setSelectedItem(methodName);
-    }
-    panel.add(methodRemoteNameBox);
-    catClass.info("End : getMethodRemoteNamePanel1");
-    return panel;
-  }
-
-  protected JPanel getMethodHomeParmsPanel()
-  {
-    catClass.info("Start : getMethodHomeParmsPanel1");
-    JPanel panel = new JPanel();
-    panel.add(new JLabel(JMeterUtils.getResString("jndi_method_home_parms")));
-    rootHome = new DefaultMutableTreeNode("Root");
-    treeModelHome = new DefaultTreeModel(rootHome);
-    jTreeHome = new JTree(treeModelHome);
-    jTreeHome.getSelectionModel().setSelectionMode(
-	TreeSelectionModel.SINGLE_TREE_SELECTION);
-    jTreeHome.addTreeSelectionListener(this);
-    jTreeHome.setPreferredSize(new Dimension(200, 50));
-    JPanel jTreePanel = new JPanel();
-    jTreePanel.add(jTreeHome);
-    panel.add(jTreePanel);
-    // set mouse listener to listen for double clicks
-    MouseListener ml = new MouseAdapter()
+		displayName = true;
+	}
+	public MethodConfigGui(boolean displayName)
 	{
-	  public void mousePressed(MouseEvent e)
-	  {
-	    TreePath selPath = jTreeHome.getPathForLocation(e.getX(), e.getY());
-	    if(e.getClickCount() == 2)
-	    {
-System.out.println("Double clicked on - " + selPath.getLastPathComponent());
-	      DefaultMutableTreeNode node =
-			(DefaultMutableTreeNode)selPath.getLastPathComponent();
-	      int childCount = node.getChildCount();
-	      // if node is a leaf and has a parent (i.e. not root)
-	      // then node is a parm which needs a value so pop out
-	      // dialog for user to fill in
-	      if(childCount == 0 && node.getParent() != null)
-	      {
-System.out.println("Pop!!!");
-                Object userObject = node.getUserObject();
-	        Class type = null;
-                if(userObject instanceof Class)
-                {
-                  type = (Class)userObject;
-	        }
-	        else if(userObject instanceof MethodConfigUserObject)
-	        {
-	          type = (Class)((MethodConfigUserObject)userObject).getType();
-	        }
-	        MethodConfigDialog dialog = new MethodConfigDialog(frame, type);
-	        dialog.pack();
-	        dialog.setVisible(true);
-	        MethodConfigUserObject input = dialog.getValidatedInput();
-System.out.println("input - " + input);
-	        if(input != null)
-	        {
-	          node.setUserObject(input);
-	        }
-	      }
-	    }
-	  }
-	};
-    jTreeHome.addMouseListener(ml);
-    catClass.info("End : getMethodHomeParmsPanel1");
-    return panel;
-  }
-
-  protected JPanel getMethodRemoteParmsPanel()
-  {
-    catClass.info("Start : getMethodRemoteParmsPanel1");
-    JPanel panel = new JPanel();
-    panel.add(new JLabel(JMeterUtils.getResString("jndi_method_remote_parms")));
-    rootRemote = new DefaultMutableTreeNode("Root");
-    treeModelRemote = new DefaultTreeModel(rootRemote);
-    jTreeRemote = new JTree(treeModelRemote);
-    jTreeRemote.getSelectionModel().setSelectionMode(
-	TreeSelectionModel.SINGLE_TREE_SELECTION);
-    jTreeRemote.addTreeSelectionListener(this);
-    jTreeRemote.setPreferredSize(new Dimension(200, 50));
-    JPanel jTreePanel = new JPanel();
-    jTreePanel.add(jTreeRemote);
-    panel.add(jTreePanel);
-    // set mouse listener to listen for double clicks
-    MouseListener ml = new MouseAdapter()
+		this.displayName = displayName;
+	}
+	//----- ModelSupported interface : start -----
+	public void setModel(Object model)
 	{
-	  public void mousePressed(MouseEvent e)
-	  {
-	    TreePath selPath = jTreeRemote.getPathForLocation(e.getX(), e.getY());
-	    if(e.getClickCount() == 2)
-	    {
-System.out.println("Double clicked on - " + selPath.getLastPathComponent());
-	      DefaultMutableTreeNode node =
-			(DefaultMutableTreeNode)selPath.getLastPathComponent();
-	      int childCount = node.getChildCount();
-	      if(childCount == 0)
-	      {
-System.out.println("Pop!!!");
-                Object userObject = node.getUserObject();
-	        Class type = null;
-                if(userObject instanceof Class)
-                {
-                  type = (Class)userObject;
-	        }
-	        else if(userObject instanceof MethodConfigUserObject)
-	        {
-	          type = (Class)((MethodConfigUserObject)userObject).getType();
-	        }
-	        MethodConfigDialog dialog = new MethodConfigDialog(frame, type);
-	        dialog.pack();
-	        dialog.setVisible(true);
-	        MethodConfigUserObject input = dialog.getValidatedInput();
-System.out.println("input - " + input);
-	        if(input != null)
-	        {
-	          node.setUserObject(input);
-	        }
-	      }
-	    }
-	  }
-	};
-    jTreeRemote.addMouseListener(ml);
-    catClass.info("End : getMethodHomeParmsPanel1");
-    return panel;
-  }
-
-  public MethodConfig getModel()
-  {
-    return model;
-  }
-
-  /**
-   * Caller needs to be able to get Method Parms for both the Home Method
-   * and Remote Method.  Based on the state this method will call
-   * <code>getMethodParmsValues</code> witht the appropriate root.  NOTE :
-   * parms for Home and Remote Methods are stored under different roots.
-   */
-  public Object[] getMethodParmsValues(int state)
-	throws MethodConfigUserObjectException
-  {
-    Object[] objects = null;
-    if(state == MethodConfig.METHOD_INVOKE_HOME)
-    {
-      objects = getMethodParmsValues(rootHome);
-    }
-    else if(state == MethodConfig.METHOD_INVOKE_REMOTE)
-    {
-      objects = getMethodParmsValues(rootRemote);
-    }
-    return objects;
-  }
-
-  public Object[] getMethodParmsValues(DefaultMutableTreeNode root)
-	throws MethodConfigUserObjectException
-  {
-    catClass.info("Start : getMethodParmsValues1");
-    // go through jTree to get all arguments
-    int childCount = root.getChildCount();
-    Object[] parmsValues = new Object[childCount];
-    for(int i = 0; i < childCount; i++)
-    {
-      parmsValues[i] = formObject((DefaultMutableTreeNode)
-		treeModelHome.getChild(root, i));
-    }
-    catClass.info("End : getMethodParmsValues1");
-    return parmsValues;
-  }
-
-  protected Object formObject(DefaultMutableTreeNode node)
-	throws MethodConfigUserObjectException
-  {
-    catClass.info("Start : formObject1");
-    Object obj = node.getUserObject();
-    Object returnVal = null;
-    if(obj instanceof MethodConfigUserObject)
-    {
-      // then node contains a primitive so just get the object
-      MethodConfigUserObject userObject = (MethodConfigUserObject)obj;
-      returnVal = userObject.getObject();
-      if(catClass.isDebugEnabled())
-      {
-        catClass.debug("formObject1 : primitive - " + userObject);
-      }
-    }
-    else if(obj instanceof Class)
-    {
-      // there are cases when the tree node will contain only class
-      // and not MethodConfigUserObject -
-      // 1. its value has not been input by the user but it's a primitive
-      // 2. it's not a primitive but an object
-      Class type = (Class)obj;
-      if(type.isPrimitive())
-      {
-        // it's a primitive but the user has not input a value for it
-        String errorStr = type.getName() + 
-		" is a primitive with uninitialized values";
-        catClass.error("formObject1 : " + errorStr);
-        throw new MethodConfigUserObjectException(errorStr);
-      }
-      else
-      {
-        // then node is an object which contains other primitives
-        if(catClass.isDebugEnabled())
-        { 
-          catClass.debug("formObject1 : Creating object - " + type);
-        }
-        int childCount = node.getChildCount();
-        Object[] constituents = new Object[childCount];
-        for(int i = 0; i < childCount; i++)
-        {
-          constituents[i] = formObject((DefaultMutableTreeNode)
-		treeModelHome.getChild(node, i));
-        }
-        // get the fields of the class
-        // gather all constituents to form object
-        Field[] fields = type.getFields();
-        try
-        {
-          for(int i = 0; i < constituents.length; i++)
-          {
-            catClass.debug("formObject1 : setting - " + fields[i].getName());
-            catClass.debug("formObject1 : to value - " + constituents[i]
-		+ " of - " + constituents[i].getClass());
-            returnVal = type.newInstance();
-            fields[i].set(returnVal, constituents[i]);
-          }
-        }
-        catch(IllegalAccessException e)
-        {
-          catClass.error(e);
-          throw new MethodConfigUserObjectException(e.getMessage());
-        }
-        catch(InstantiationException e)
-        {
-          catClass.error(e);
-          throw new MethodConfigUserObjectException(e.getMessage());
-        }
-      }
-    }
-    catClass.info("End : formObject1");
-    return returnVal;
-  }
-
-  /**
-   * Sets up the pull-down menus to contain all the <code>String</code>s
-   * passed in as well as displaying the user's selection.
-   *
-   * @param methodNameBox	the <code>JComboBox</code> to be manipulated
-   * @param methodName		the user's selection
-   * @param strings		the list of <code>String</code>s to be added
-   *				into the <code>JComboBox</code>
-   */
-  protected void setupPullDown(JComboBox methodNameBox, String methodName,
-        String[] strings)
-  {
-    catClass.info("Start : setupPullDown1");
-    // if the list is empty then try to fill it
-    if(methodNameBox.getItemCount() == 0)
-    {
-      if(strings != null)
-      {
-        for(int i = 0; i < strings.length; i++)
-        {
-          catClass.debug("setupPullDown1 :  adding method - " + strings[i]);
-          methodNameBox.addItem(strings[i]);
-        }
-      }
-    }
-    // change the methodBox selected item only if there's a change in the
-    // methodName to avoid triggering actionPerformed each time
-    String methodNameBoxSelected = 
-        (String)methodNameBox.getSelectedItem();
-    if((methodName != null) && !methodName.equals(methodNameBoxSelected))
-    {
-      methodNameBox.setSelectedItem(methodName);
-    }
-    catClass.info("End : setupPullDown1");
-  }
-
-  /**
-   * Resets the home method parms.  This method will be called when the user
-   * makes any changes which requires the resetting the method home parms
-   * e.g. when user decides to call another home method.
-   */
-  protected void resetHomeMethodParms()
-  {
-    catClass.info("Start : resetHomeMethodParms1");
-    // remove all parms of the old method
-    int totalChild = rootHome.getChildCount();
-    for(int i = 0; i < totalChild; i++)
-    {
-      // the child to be removed will always be 0 'cos as the child
-      // is removed the nth node will become (n-1)th
-      treeModelHome.removeNodeFromParent(
-		(DefaultMutableTreeNode)rootHome.getChildAt(0));
-    }
-    rootHome.setUserObject("Root");
-    catClass.info("End : resetHomeMethodParms1");
-  }
-
-  /**
-   * Resets the remote interface list returned by the home method.  This method
-   * will be called when the user makes any changes which requires the 
-   * remote interface list to be modified e.g. when user decides to call 
-   * another home method.
-   */
-  protected void resetRemoteInterfaceList()
-  {
-    catClass.info("Start : resetRemoteInterfaceList1");
-    model.setRemoteInterfaceList(null);
-    model.setRemoteInterfaceType(null);
-    remoteInterfaceBox.removeAllItems();
-    catClass.info("End : resetRemoteInterfaceList1");
-  }
-
-  /**
-   * Resets the selected remote interface.  This method will be called when 
-   * the user makes any changes which requires the resetting the selected
-   * remote interface e.g. when user decides to call another home method,
-   * when the user decides to change the remote interface to be executed.
-   */
-  protected void resetRemoteMethodName()
-  {
-    catClass.info("Start : resetRemoteMethodName1");
-    model.setMethodRemoteName(null);
-    methodRemoteNameBox.removeAllItems();
-    catClass.info("End : resetRemoteMethodName1");
-  }
-
- /** 
-   * Resets the remote method parms.  This method will be called when the user 
-   * makes any changes which requires the resetting the method remote parms
-   * e.g. when user decides to call another home method, when user changes the
-   * remote interface to be executed, when user changes the remote method
-   * to be run.
-   */
-  protected void resetRemoteMethodParms()
-  {
-    catClass.info("Start : resetRemoteMethodParms1");
-    // remove all parms of the old method
-    int totalChild = rootRemote.getChildCount();
-    for(int i = 0; i < totalChild; i++)
-    {
-      // the child to be removed will always be 0 'cos as the child
-      // is removed the nth node will become (n-1)th
-      treeModelRemote.removeNodeFromParent(
-		(DefaultMutableTreeNode)rootRemote.getChildAt(0));
-    }
-    rootRemote.setUserObject("Root");
-    catClass.info("End : resetRemoteMethodParms1");
-  }
-
-  //----- ActionListener interface : start -----
-
-  public void actionPerformed(ActionEvent e)
-  {
-    String command = e.getActionCommand();
-    ReflectionJMeterEngine engine = null;
-    GuiPackage guiPackage = null;
-    if(catClass.isDebugEnabled())
-    {
-      catClass.debug("actionPerformed1 : command - " + command);
-    }
-    if(command.equals(REFLECT))
-    {
-      guiPackage = GuiPackage.getInstance();
-      Collection groups = TestPlan.createTestPlan(null).compileTestPlan();
-      engine = new ReflectionJMeterEngine();
-      for(Iterator i = groups.iterator(); i.hasNext();)
-      {
-        ThreadGroup tg = (ThreadGroup)i.next();
-        if(catClass.isDebugEnabled())
-        {
-          catClass.debug("actionPerformed1 : threadgroup - " + tg);
-        }
-        engine.addThreadGroup(tg);
-      }
-      guiPackage.getMainFrame().setRunning(true);
-      model.setReflectionStatus(true);
-      engine.runTest();
-      guiPackage.getMainFrame().setRunning(false);
-      model.setReflectionStatus(false);
-      updateGui();
-    }
-    if(command.equals(INVOKE))
-    { 
-    }
-  }
-
-  //----- ActionListener interface : end -----
-
-  //----- TreeSelectionListener interface : start -----
-
-  public void valueChanged(TreeSelectionEvent e)
-  {
-    catClass.debug("Start : valueChanged1");
-    catClass.debug("End : valueChanged1");
-  }
-
-  //----- TreeSelectionListener interface : end -----
+		this.model = (MethodConfig) model;
+		init();
+	}
+	public void updateGui()
+	{
+		log.debug("Start : updateGui1");
+		log.info("updateGui1");
+		// the method name box will always be displayed regardless of the state
+		// of the MethodConfig of this gui
+		String methodName = model.getMethodHomeName();
+		log.debug("updateGui1 : home method name - " + methodName);
+		String[] strings = model.getMethodHomeList();
+		setupPullDown(methodHomeNameBox, methodName, strings);
+		// if methodName is null set the home method to be the first entry
+		// as setup in the home method name JComboBox by setupPullDown
+		// This is to ensure that if the user does not change the JComboBox
+		// the first value is set anyway.
+		if (methodName == null && strings != null)
+		{
+			model.setMethodHomeName(strings[0]);
+		}
+		// if the state of the MethodConfig of this gui after 
+		// MethodConfig.METHOD_GET_HOME_NAMES, display panel to get
+		// parms of the selected method
+		int childCount = treeModelHome.getChildCount(rootHome);
+		if (log.isDebugEnabled())
+		{
+			log.debug("updateGui1 : state - " + model.getState());
+			log.debug("updateGui1 : METHOD_GET_HOME_NAMES");
+			log.debug("updateGui1 : rootHome child count - " + childCount);
+		}
+		// if model is in state after getting home method name AND
+		// rootHome(method) has no child(parms set) yet then get them
+		if (model.getState() > MethodConfig.METHOD_GET_HOME_PARMS
+			&& childCount == 0)
+		{
+			log.debug("updateGui1 : METHOD_GET_HOME_PARMS");
+			rootHome.setUserObject(model.getMethodHomeName());
+			//      methodParmsPanel.setVisible(true);
+			// get all the parms
+			Class[] parmTypes = model.getMethodHomeParms();
+			// add all the parms into a JTree
+			for (int i = 0; i < parmTypes.length; i++)
+			{
+				log.debug("updateGui1 : parmType #" + i + " - " + parmTypes[i]);
+				recurseParm(parmTypes[i], rootHome, i, treeModelHome);
+			}
+			// if the chosen method has no parms then updating the value of
+			// root node with the method name doesn't seem to trigger a redraw of
+			// the tree so call treeDidChange()
+			if (parmTypes.length == 0)
+			{
+				jTreeHome.treeDidChange();
+			}
+		}
+		// if model is in state after getting home method name and
+		// all home method parms gave been obtained then get list of
+		// remote interfaces
+		if (model.getState() > MethodConfig.METHOD_SELECT_REMOTE_INTERFACE)
+		{
+			log.debug("METHOD_SELECT_REMOTE_INTERFACE");
+			// remoteInterfaceType is the remote interface selected by the user
+			// remoteInterfaces contains the list of remote interfaces returned
+			// by home method
+			Object remoteInterfaceType = model.getRemoteInterfaceType();
+			String interfaceName = null;
+			if (remoteInterfaceType != null)
+			{
+				interfaceName = remoteInterfaceType.toString();
+			}
+			ArrayList remoteInterfaces = (ArrayList) model.getRemoteInterfaceList();
+			if (log.isDebugEnabled())
+			{
+				log.debug("updateGui1 : remote interfaces - " + remoteInterfaces);
+				log.debug(
+					"updateGui1 : remoteInterfacesType - " + remoteInterfaces.getClass());
+			}
+			// prepare variable strings to contain a list of all the names of
+			// the remote interfaces
+			Object[] remoteInterfacesArray = remoteInterfaces.toArray();
+			strings = new String[remoteInterfacesArray.length];
+			for (int i = 0; i < remoteInterfacesArray.length; i++)
+			{
+				strings[i] = remoteInterfacesArray[i].toString();
+			}
+			setupPullDown(remoteInterfaceBox, interfaceName, strings);
+			// if interfaceName is null set the remote interface to be the first 
+			// entry as setup in the remote interface name JComboBox by setupPullDown.
+			// This is to ensure that if the user does not change the JComboBox
+			// the first value is set anyway.
+			if (interfaceName == null && remoteInterfacesArray != null)
+			{
+				model.setRemoteInterfaceType(remoteInterfacesArray[0]);
+			}
+		}
+		// if model is in state after user selects the list of remote interface
+		// then get a list of remote method names
+		if (model.getState() > MethodConfig.METHOD_GET_REMOTE_NAMES)
+		{
+			log.debug("METHOD_GET_REMOTE_NAMES");
+			methodName = model.getMethodRemoteName();
+			log.debug("updateGui1 : remote method name - " + methodName);
+			strings = model.getMethodRemoteList();
+			setupPullDown(methodRemoteNameBox, methodName, strings);
+			childCount = treeModelRemote.getChildCount(rootRemote);
+			if (log.isDebugEnabled())
+			{
+				log.debug("updateGui1 : rootRemote child count - " + childCount);
+			}
+		}
+		// if model is in state after getting remote interface AND
+		// rootRemote(method) has no child(parms set) yet then get them
+		if (model.getState() > MethodConfig.METHOD_GET_REMOTE_PARMS
+			&& childCount == 0)
+		{
+			log.debug("METHOD_GET_REMOTE_PARMS");
+			rootRemote.setUserObject(model.getMethodRemoteName());
+			//      methodParmsPanel.setVisible(true);
+			// get all the parms
+			Class[] parmTypes = model.getMethodRemoteParms();
+			// add all the parms into a JTree
+			for (int i = 0; i < parmTypes.length; i++)
+			{
+				log.debug("updateGui1 : parmType #" + i + " - " + parmTypes[i]);
+				recurseParm(parmTypes[i], rootHome, i, treeModelHome);
+			}
+			// if the chosen method has no parms then updating the value of
+			// root node with the method name doesn't seem to trigger a redraw of
+			// the tree so call treeDidChange()
+			if (parmTypes.length == 0)
+			{
+				jTreeRemote.treeDidChange();
+			}
+		}
+		// if the state of the MethodConfig of this gui is
+		// MethodConfig.METHOD_GET_HOME_PARMS, display panel
+		if (displayName)
+		{
+			namePanel.updateGui();
+		}
+		log.debug("End : updateGui1");
+	}
+	//----- ModelSupported interface : end -----
+	protected void init()
+	{
+		log.info("Start : init1");
+		// The frame is required because the JDialog we create must be modal
+		// and to be modal it must be modal relative to a frame.  We want
+		// the dialog boxes to be modal so that user must fill them up before
+		// they can do anything with jmeter
+		GuiPackage guiPkg = GuiPackage.getInstance();
+		frame = guiPkg.getMainFrame();
+		model.setState(MethodConfig.METHOD_GET_HOME_NAMES);
+		model.setGui(this);
+		methodHomeNameBox = new JComboBox();
+		methodHomeNameBox.setEditable(false);
+		methodHomeNameBox.setAlignmentX(Component.LEFT_ALIGNMENT);
+		methodHomeNameBox.addActionListener(new ActionListener()
+		{
+			public void actionPerformed(ActionEvent e)
+			{
+				log.debug("actionPerformed1 : Home name method JComboBox changed");
+				// change in method name so do the following
+				JComboBox comboBox = (JComboBox) e.getSource();
+				String method = (String) methodHomeNameBox.getSelectedItem();
+				model.setMethodHomeName(method);
+				model.setState(MethodConfig.METHOD_GET_HOME_PARMS);
+				resetHomeMethodParms();
+				resetRemoteInterfaceList();
+				resetRemoteMethodName();
+				resetRemoteMethodParms();
+				//            methodParmsPanel.setVisible(false);
+				actionButton.setText(
+					JMeterUtils.getResString("jndi_method_button_reflect"));
+				updateGui();
+			}
+		});
+		remoteInterfaceBox = new JComboBox();
+		remoteInterfaceBox.setEditable(false);
+		remoteInterfaceBox.setAlignmentX(Component.LEFT_ALIGNMENT);
+		remoteInterfaceBox.addActionListener(new ActionListener()
+		{
+			public void actionPerformed(ActionEvent e)
+			{
+				log.debug("actionPerformed1 : Remote Interface JComboBox changed");
+				JComboBox comboBox = (JComboBox) e.getSource();
+				String interfaceName = (String) remoteInterfaceBox.getSelectedItem();
+				// compare interface selected with the ones in the remote interface
+				// list and store the corresponding object in MethodConfig
+				ArrayList remoteInterfaceList =
+					(ArrayList) model.getRemoteInterfaceList();
+				if (remoteInterfaceList != null)
+				{
+					Object[] remoteInterfaceListArray = remoteInterfaceList.toArray();
+					int i = 0;
+					boolean found = false;
+					String remoteInterfaceListName = null;
+					Object selectedInterface = null;
+					while (i < remoteInterfaceListArray.length && !found)
+					{
+						remoteInterfaceListName = remoteInterfaceListArray[i].toString();
+						if (remoteInterfaceListName.equals(interfaceName))
+						{
+							found = true;
+							selectedInterface = remoteInterfaceListArray[i];
+						}
+						i++;
+					}
+					model.setRemoteInterfaceType(selectedInterface);
+					model.setState(MethodConfig.METHOD_GET_REMOTE_NAMES);
+				}
+				resetRemoteMethodName();
+				resetRemoteMethodParms();
+				//            methodParmsPanel.setVisible(false);
+				actionButton.setText(
+					JMeterUtils.getResString("jndi_method_button_reflect"));
+				updateGui();
+			}
+		});
+		methodRemoteNameBox = new JComboBox();
+		methodRemoteNameBox.setEditable(false);
+		methodRemoteNameBox.setAlignmentX(Component.LEFT_ALIGNMENT);
+		methodRemoteNameBox.addActionListener(new ActionListener()
+		{
+			public void actionPerformed(ActionEvent e)
+			{
+				log.debug("actionPerformed1 : Remote method name JComboBox changed");
+				// change in method name so do the following
+				JComboBox comboBox = (JComboBox) e.getSource();
+				String method = (String) methodRemoteNameBox.getSelectedItem();
+				model.setMethodRemoteName(method);
+				model.setState(MethodConfig.METHOD_GET_REMOTE_PARMS);
+				resetRemoteMethodParms();
+				//            methodParmsPanel.setVisible(false);
+				actionButton.setText(
+					JMeterUtils.getResString("jndi_method_button_reflect"));
+				updateGui();
+			}
+		});
+		//rootHome = new DefaultMutableTreeNode("Root");
+		//treeModelHome = new DefaultTreeModel(rootHome);
+		this.setLayout(
+			new VerticalLayout(5, VerticalLayout.LEFT, VerticalLayout.TOP));
+		JPanel mainPanel = new JPanel();
+		Border margin = new EmptyBorder(10, 10, 5, 10);
+		mainPanel.setBorder(margin);
+		mainPanel.setLayout(new VerticalLayout(5, VerticalLayout.LEFT));
+		// title
+		JLabel panelTitleLabel =
+			new JLabel(JMeterUtils.getResString("jndi_method_title"));
+		Font curFont = panelTitleLabel.getFont();
+		int curFontSize = curFont.getSize();
+		curFontSize += 4;
+		panelTitleLabel.setFont(
+			new Font(curFont.getFontName(), curFont.getStyle(), curFontSize));
+		mainPanel.add(panelTitleLabel);
+		// name
+		namePanel = new NamePanel(model);
+		mainPanel.add(namePanel);
+		// method properties
+		JPanel jndiPanel = new JPanel();
+		jndiPanel.setLayout(new VerticalLayout(5, VerticalLayout.LEFT));
+		jndiPanel.setBorder(
+			BorderFactory.createTitledBorder(
+				JMeterUtils.getResString("jndi_method_name")));
+		methodHomeNamePanel = getMethodHomeNamePanel();
+		methodHomeParmsPanel = getMethodHomeParmsPanel();
+		remoteInterfaceListPanel = getRemoteInterfaceListPanel();
+		methodRemoteNamePanel = getMethodRemoteNamePanel();
+		methodRemoteParmsPanel = getMethodRemoteParmsPanel();
+		jndiPanel.add(methodHomeNamePanel);
+		jndiPanel.add(methodHomeParmsPanel);
+		jndiPanel.add(remoteInterfaceListPanel);
+		jndiPanel.add(methodRemoteNamePanel);
+		jndiPanel.add(methodRemoteParmsPanel);
+		controlPanel = new JPanel();
+		actionButton =
+			new JButton(JMeterUtils.getResString("jndi_method_button_reflect"));
+		actionButton.addActionListener(this);
+		actionButton.setActionCommand(REFLECT);
+		controlPanel.add(actionButton);
+		jndiPanel.add(controlPanel);
+		mainPanel.add(jndiPanel);
+		this.add(mainPanel);
+		//methodHomeParmsPanel.setVisible(false);
+		log.info("End : init1");
+	}
+	/**
+	 * Given a parameter type of a method, this method will find out
+	 * if the parm type is a primitive.  If so, it'll just add the parm type
+	 * as a node into the tree model (used to store all parm types of the method).
+	 * If however, the parm type is not a primitive, then the parm type will be
+	 * further recursed i.e. a reflection of all the fields is obtained
+	 * and each of which will be examined to determined if they are primitives.
+	 * For those which are primitives, they'll be added to the tree model
+	 * and those otherwise will be further recursed.
+	 *
+	 * @param parmType	the parmType of a method which will be examined
+	 * @param parentNode	the node under which the parmType will be added to
+	 * @param childIndex	the index of the this parmType if it were to be added
+	 *			under the parent node
+	 */
+	protected void recurseParm(
+		Class parmType,
+		DefaultMutableTreeNode parentNode,
+		int childIndex,
+		DefaultTreeModel treeModel)
+	{
+		log.debug("Start - recurseParm1");
+		DefaultMutableTreeNode node = new DefaultMutableTreeNode(parmType);
+		treeModel.insertNodeInto(node, parentNode, childIndex);
+		log.info("recurseParm1 - parent : " + parentNode);
+		log.info("recurseParm1 - parent : " + treeModel.getChildCount(parentNode));
+		log.info("recurseParm1 - child : " + treeModel.getChildCount(node));
+		if (parmType.isPrimitive())
+		{
+			// if parmType is primitive then no need to recurse the parm
+		}
+		else if (parmType.getName().equals(STRING_CLASS))
+		{
+			// consider String as a primitive i.e. there is not need to recurse parm
+		}
+		else if (parmType.isArray())
+		{
+			// if parmType is array then need to handle differently
+		}
+		else
+		{
+			// if parmType is NOT primitive then need to recurse the parm since
+			// it's an object.
+			// to recurse the object, use reflections to get all fields
+			Field[] fields = parmType.getFields();
+			for (int i = 0; i < fields.length; i++)
+			{
+				Class fieldClass = fields[i].getType();
+				log.debug("recurseParm1 : field #" + i + " - " + fieldClass);
+				recurseParm(fieldClass, node, i, treeModel);
+			}
+		}
+		log.debug("End - recurseParm1");
+	}
+	protected JPanel getMethodHomeNamePanel()
+	{
+		log.info("Start : getMethodHomeNamePanel1");
+		JPanel panel = new JPanel();
+		panel.add(new JLabel(JMeterUtils.getResString("jndi_method_home_name")));
+		String methodName = model.getMethodHomeName();
+		if (methodName != null)
+		{
+			methodHomeNameBox.setSelectedItem(methodName);
+		}
+		panel.add(methodHomeNameBox);
+		log.info("End : getMethodHomeNamePanel1");
+		return panel;
+	}
+	protected JPanel getRemoteInterfaceListPanel()
+	{
+		log.info("Start : getRemoteInterfaceListPanel1");
+		JPanel panel = new JPanel();
+		panel.add(
+			new JLabel(
+				JMeterUtils.getResString("jndi_method_remote_interface_list")));
+		Object remoteInterfaceType = model.getRemoteInterfaceType();
+		if (remoteInterfaceType != null)
+		{
+			remoteInterfaceBox.setSelectedItem(remoteInterfaceType.toString());
+		}
+		panel.add(remoteInterfaceBox);
+		log.info("End : getRemoteInterfaceListPanel1");
+		return panel;
+	}
+	protected JPanel getMethodRemoteNamePanel()
+	{
+		log.info("Start : getMethodRemoteNamePanel1");
+		JPanel panel = new JPanel();
+		panel.add(new JLabel(JMeterUtils.getResString("jndi_method_remote_name")));
+		String methodName = model.getMethodRemoteName();
+		if (methodName != null)
+		{
+			methodRemoteNameBox.setSelectedItem(methodName);
+		}
+		panel.add(methodRemoteNameBox);
+		log.info("End : getMethodRemoteNamePanel1");
+		return panel;
+	}
+	protected JPanel getMethodHomeParmsPanel()
+	{
+		log.info("Start : getMethodHomeParmsPanel1");
+		JPanel panel = new JPanel();
+		panel.add(new JLabel(JMeterUtils.getResString("jndi_method_home_parms")));
+		rootHome = new DefaultMutableTreeNode("Root");
+		treeModelHome = new DefaultTreeModel(rootHome);
+		jTreeHome = new JTree(treeModelHome);
+		jTreeHome.getSelectionModel().setSelectionMode(
+			TreeSelectionModel.SINGLE_TREE_SELECTION);
+		jTreeHome.addTreeSelectionListener(this);
+		jTreeHome.setPreferredSize(new Dimension(200, 50));
+		JPanel jTreePanel = new JPanel();
+		jTreePanel.add(jTreeHome);
+		panel.add(jTreePanel);
+		// set mouse listener to listen for double clicks
+		MouseListener ml = new MouseAdapter()
+		{
+			public void mousePressed(MouseEvent e)
+			{
+				TreePath selPath = jTreeHome.getPathForLocation(e.getX(), e.getY());
+				if (e.getClickCount() == 2)
+				{
+					log.info("Double clicked on - " + selPath.getLastPathComponent());
+					DefaultMutableTreeNode node =
+						(DefaultMutableTreeNode) selPath.getLastPathComponent();
+					int childCount = node.getChildCount();
+					// if node is a leaf and has a parent (i.e. not root)
+					// then node is a parm which needs a value so pop out
+					// dialog for user to fill in
+					if (childCount == 0 && node.getParent() != null)
+					{
+						log.info("Pop!!!");
+						Object userObject = node.getUserObject();
+						Class type = null;
+						if (userObject instanceof Class)
+						{
+							type = (Class) userObject;
+						}
+						else if (userObject instanceof MethodConfigUserObject)
+						{
+							type = (Class) ((MethodConfigUserObject) userObject).getType();
+						}
+						MethodConfigDialog dialog = new MethodConfigDialog(frame, type);
+						dialog.pack();
+						dialog.setVisible(true);
+						MethodConfigUserObject input = dialog.getValidatedInput();
+						log.info("input - " + input);
+						if (input != null)
+						{
+							node.setUserObject(input);
+						}
+					}
+				}
+			}
+		};
+		jTreeHome.addMouseListener(ml);
+		log.info("End : getMethodHomeParmsPanel1");
+		return panel;
+	}
+	protected JPanel getMethodRemoteParmsPanel()
+	{
+		log.info("Start : getMethodRemoteParmsPanel1");
+		JPanel panel = new JPanel();
+		panel.add(new JLabel(JMeterUtils.getResString("jndi_method_remote_parms")));
+		rootRemote = new DefaultMutableTreeNode("Root");
+		treeModelRemote = new DefaultTreeModel(rootRemote);
+		jTreeRemote = new JTree(treeModelRemote);
+		jTreeRemote.getSelectionModel().setSelectionMode(
+			TreeSelectionModel.SINGLE_TREE_SELECTION);
+		jTreeRemote.addTreeSelectionListener(this);
+		jTreeRemote.setPreferredSize(new Dimension(200, 50));
+		JPanel jTreePanel = new JPanel();
+		jTreePanel.add(jTreeRemote);
+		panel.add(jTreePanel);
+		// set mouse listener to listen for double clicks
+		MouseListener ml = new MouseAdapter()
+		{
+			public void mousePressed(MouseEvent e)
+			{
+				TreePath selPath = jTreeRemote.getPathForLocation(e.getX(), e.getY());
+				if (e.getClickCount() == 2)
+				{
+					log.info("Double clicked on - " + selPath.getLastPathComponent());
+					DefaultMutableTreeNode node =
+						(DefaultMutableTreeNode) selPath.getLastPathComponent();
+					int childCount = node.getChildCount();
+					if (childCount == 0)
+					{
+						log.info("Pop!!!");
+						Object userObject = node.getUserObject();
+						Class type = null;
+						if (userObject instanceof Class)
+						{
+							type = (Class) userObject;
+						}
+						else if (userObject instanceof MethodConfigUserObject)
+						{
+							type = (Class) ((MethodConfigUserObject) userObject).getType();
+						}
+						MethodConfigDialog dialog = new MethodConfigDialog(frame, type);
+						dialog.pack();
+						dialog.setVisible(true);
+						MethodConfigUserObject input = dialog.getValidatedInput();
+						log.info("input - " + input);
+						if (input != null)
+						{
+							node.setUserObject(input);
+						}
+					}
+				}
+			}
+		};
+		jTreeRemote.addMouseListener(ml);
+		log.info("End : getMethodHomeParmsPanel1");
+		return panel;
+	}
+	public MethodConfig getModel()
+	{
+		return model;
+	}
+	/**
+	 * Caller needs to be able to get Method Parms for both the Home Method
+	 * and Remote Method.  Based on the state this method will call
+	 * <code>getMethodParmsValues</code> witht the appropriate root.  NOTE :
+	 * parms for Home and Remote Methods are stored under different roots.
+	 */
+	public Object[] getMethodParmsValues(int state)
+		throws MethodConfigUserObjectException
+	{
+		Object[] objects = null;
+		if (state == MethodConfig.METHOD_INVOKE_HOME)
+		{
+			objects = getMethodParmsValues(rootHome);
+		}
+		else if (state == MethodConfig.METHOD_INVOKE_REMOTE)
+		{
+			objects = getMethodParmsValues(rootRemote);
+		}
+		return objects;
+	}
+	public Object[] getMethodParmsValues(DefaultMutableTreeNode root)
+		throws MethodConfigUserObjectException
+	{
+		log.info("Start : getMethodParmsValues1");
+		// go through jTree to get all arguments
+		int childCount = root.getChildCount();
+		Object[] parmsValues = new Object[childCount];
+		for (int i = 0; i < childCount; i++)
+		{
+			parmsValues[i] =
+				formObject((DefaultMutableTreeNode) treeModelHome.getChild(root, i));
+		}
+		log.info("End : getMethodParmsValues1");
+		return parmsValues;
+	}
+	protected Object formObject(DefaultMutableTreeNode node)
+		throws MethodConfigUserObjectException
+	{
+		log.info("Start : formObject1");
+		Object obj = node.getUserObject();
+		Object returnVal = null;
+		if (obj instanceof MethodConfigUserObject)
+		{
+			// then node contains a primitive so just get the object
+			MethodConfigUserObject userObject = (MethodConfigUserObject) obj;
+			returnVal = userObject.getObject();
+			if (log.isDebugEnabled())
+			{
+				log.debug("formObject1 : primitive - " + userObject);
+			}
+		}
+		else if (obj instanceof Class)
+		{
+			// there are cases when the tree node will contain only class
+			// and not MethodConfigUserObject -
+			// 1. its value has not been input by the user but it's a primitive
+			// 2. it's not a primitive but an object
+			Class type = (Class) obj;
+			if (type.isPrimitive())
+			{
+				// it's a primitive but the user has not input a value for it
+				String errorStr =
+					type.getName() + " is a primitive with uninitialized values";
+				log.error("formObject1 : " + errorStr);
+				throw new MethodConfigUserObjectException(errorStr);
+			}
+			else
+			{
+				// then node is an object which contains other primitives
+				if (log.isDebugEnabled())
+				{
+					log.debug("formObject1 : Creating object - " + type);
+				}
+				int childCount = node.getChildCount();
+				Object[] constituents = new Object[childCount];
+				for (int i = 0; i < childCount; i++)
+				{
+					constituents[i] =
+						formObject(
+							(DefaultMutableTreeNode) treeModelHome.getChild(node, i));
+				}
+				// get the fields of the class
+				// gather all constituents to form object
+				Field[] fields = type.getFields();
+				try
+				{
+					for (int i = 0; i < constituents.length; i++)
+					{
+						log.debug("formObject1 : setting - " + fields[i].getName());
+						log.debug(
+							"formObject1 : to value - "
+								+ constituents[i]
+								+ " of - "
+								+ constituents[i].getClass());
+						returnVal = type.newInstance();
+						fields[i].set(returnVal, constituents[i]);
+					}
+				}
+				catch (IllegalAccessException e)
+				{
+					log.error(e);
+					throw new MethodConfigUserObjectException(e.getMessage());
+				}
+				catch (InstantiationException e)
+				{
+					log.error(e);
+					throw new MethodConfigUserObjectException(e.getMessage());
+				}
+			}
+		}
+		log.info("End : formObject1");
+		return returnVal;
+	}
+	/**
+	 * Sets up the pull-down menus to contain all the <code>String</code>s
+	 * passed in as well as displaying the user's selection.
+	 *
+	 * @param methodNameBox	the <code>JComboBox</code> to be manipulated
+	 * @param methodName		the user's selection
+	 * @param strings		the list of <code>String</code>s to be added
+	 *				into the <code>JComboBox</code>
+	 */
+	protected void setupPullDown(
+		JComboBox methodNameBox,
+		String methodName,
+		String[] strings)
+	{
+		log.info("Start : setupPullDown1");
+		// if the list is empty then try to fill it
+		if (methodNameBox.getItemCount() == 0)
+		{
+			if (strings != null)
+			{
+				for (int i = 0; i < strings.length; i++)
+				{
+					log.debug("setupPullDown1 :  adding method - " + strings[i]);
+					methodNameBox.addItem(strings[i]);
+				}
+			}
+		}
+		// change the methodBox selected item only if there's a change in the
+		// methodName to avoid triggering actionPerformed each time
+		String methodNameBoxSelected = (String) methodNameBox.getSelectedItem();
+		if ((methodName != null) && !methodName.equals(methodNameBoxSelected))
+		{
+			methodNameBox.setSelectedItem(methodName);
+		}
+		log.info("End : setupPullDown1");
+	}
+	/**
+	 * Resets the home method parms.  This method will be called when the user
+	 * makes any changes which requires the resetting the method home parms
+	 * e.g. when user decides to call another home method.
+	 */
+	protected void resetHomeMethodParms()
+	{
+		log.info("Start : resetHomeMethodParms1");
+		// remove all parms of the old method
+		int totalChild = rootHome.getChildCount();
+		for (int i = 0; i < totalChild; i++)
+		{
+			// the child to be removed will always be 0 'cos as the child
+			// is removed the nth node will become (n-1)th
+			treeModelHome.removeNodeFromParent(
+				(DefaultMutableTreeNode) rootHome.getChildAt(0));
+		}
+		rootHome.setUserObject("Root");
+		log.info("End : resetHomeMethodParms1");
+	}
+	/**
+	 * Resets the remote interface list returned by the home method.  This method
+	 * will be called when the user makes any changes which requires the 
+	 * remote interface list to be modified e.g. when user decides to call 
+	 * another home method.
+	 */
+	protected void resetRemoteInterfaceList()
+	{
+		log.info("Start : resetRemoteInterfaceList1");
+		model.setRemoteInterfaceList(null);
+		model.setRemoteInterfaceType(null);
+		remoteInterfaceBox.removeAllItems();
+		log.info("End : resetRemoteInterfaceList1");
+	}
+	/**
+	 * Resets the selected remote interface.  This method will be called when 
+	 * the user makes any changes which requires the resetting the selected
+	 * remote interface e.g. when user decides to call another home method,
+	 * when the user decides to change the remote interface to be executed.
+	 */
+	protected void resetRemoteMethodName()
+	{
+		log.info("Start : resetRemoteMethodName1");
+		model.setMethodRemoteName(null);
+		methodRemoteNameBox.removeAllItems();
+		log.info("End : resetRemoteMethodName1");
+	}
+	/** 
+	  * Resets the remote method parms.  This method will be called when the user 
+	  * makes any changes which requires the resetting the method remote parms
+	  * e.g. when user decides to call another home method, when user changes the
+	  * remote interface to be executed, when user changes the remote method
+	  * to be run.
+	  */
+	protected void resetRemoteMethodParms()
+	{
+		log.info("Start : resetRemoteMethodParms1");
+		// remove all parms of the old method
+		int totalChild = rootRemote.getChildCount();
+		for (int i = 0; i < totalChild; i++)
+		{
+			// the child to be removed will always be 0 'cos as the child
+			// is removed the nth node will become (n-1)th
+			treeModelRemote.removeNodeFromParent(
+				(DefaultMutableTreeNode) rootRemote.getChildAt(0));
+		}
+		rootRemote.setUserObject("Root");
+		log.info("End : resetRemoteMethodParms1");
+	}
+	//----- ActionListener interface : start -----
+	public void actionPerformed(ActionEvent e)
+	{
+		String command = e.getActionCommand();
+		ReflectionJMeterEngine engine = null;
+		GuiPackage guiPackage = null;
+		if (log.isDebugEnabled())
+		{
+			log.debug("actionPerformed1 : command - " + command);
+		}
+		if (command.equals(REFLECT))
+		{
+			guiPackage = GuiPackage.getInstance();
+			Collection groups = TestPlan.createTestPlan(null).compileTestPlan();
+			engine = new ReflectionJMeterEngine();
+			for (Iterator i = groups.iterator(); i.hasNext();)
+			{
+				ThreadGroup tg = (ThreadGroup) i.next();
+				if (log.isDebugEnabled())
+				{
+					log.debug("actionPerformed1 : threadgroup - " + tg);
+				}
+				engine.addThreadGroup(tg);
+			}
+			guiPackage.getMainFrame().setRunning(true);
+			model.setReflectionStatus(true);
+			engine.runTest();
+			guiPackage.getMainFrame().setRunning(false);
+			model.setReflectionStatus(false);
+			updateGui();
+		}
+		if (command.equals(INVOKE))
+		{
+		}
+	}
+	//----- ActionListener interface : end -----
+	//----- TreeSelectionListener interface : start -----
+	public void valueChanged(TreeSelectionEvent e)
+	{
+		log.debug("Start : valueChanged1");
+		log.debug("End : valueChanged1");
+	}
+	//----- TreeSelectionListener interface : end -----
 }
diff --git a/jakarta-jmeter/src/protocol/jndi/control/CVS/Entries b/jakarta-jmeter/src/protocol/jndi/control/CVS/Entries
index 2c4bbe7..a89e625 100644
--- a/jakarta-jmeter/src/protocol/jndi/control/CVS/Entries
+++ b/jakarta-jmeter/src/protocol/jndi/control/CVS/Entries
@@ -1,2 +1,2 @@
-/JndiTestSample.java/1.1/Sun Aug 11 19:24:54 2002//Tv1_7_3
+/JndiTestSample.java/1.1/Sun Aug 11 19:24:54 2002//Tv1_8_1
 D/gui////
diff --git a/jakarta-jmeter/src/protocol/jndi/control/CVS/Tag b/jakarta-jmeter/src/protocol/jndi/control/CVS/Tag
index 5f312fe..e2fda28 100644
--- a/jakarta-jmeter/src/protocol/jndi/control/CVS/Tag
+++ b/jakarta-jmeter/src/protocol/jndi/control/CVS/Tag
@@ -1 +1 @@
-Nv1_7_3
+Nv1_8_1
diff --git a/jakarta-jmeter/src/protocol/jndi/control/gui/CVS/Entries b/jakarta-jmeter/src/protocol/jndi/control/gui/CVS/Entries
index c99ba84..acd4034 100644
--- a/jakarta-jmeter/src/protocol/jndi/control/gui/CVS/Entries
+++ b/jakarta-jmeter/src/protocol/jndi/control/gui/CVS/Entries
@@ -1,2 +1,2 @@
-/JndiTestSampleGui.java/1.1/Sun Aug 11 19:24:54 2002//Tv1_7_3
+/JndiTestSampleGui.java/1.1/Sun Aug 11 19:24:54 2002//Tv1_8_1
 D
diff --git a/jakarta-jmeter/src/protocol/jndi/control/gui/CVS/Tag b/jakarta-jmeter/src/protocol/jndi/control/gui/CVS/Tag
index 5f312fe..e2fda28 100644
--- a/jakarta-jmeter/src/protocol/jndi/control/gui/CVS/Tag
+++ b/jakarta-jmeter/src/protocol/jndi/control/gui/CVS/Tag
@@ -1 +1 @@
-Nv1_7_3
+Nv1_8_1
diff --git a/jakarta-jmeter/src/protocol/jndi/sampler/CVS/Entries b/jakarta-jmeter/src/protocol/jndi/sampler/CVS/Entries
index f8f447e..5432d4b 100644
--- a/jakarta-jmeter/src/protocol/jndi/sampler/CVS/Entries
+++ b/jakarta-jmeter/src/protocol/jndi/sampler/CVS/Entries
@@ -1,2 +1,2 @@
-/JNDISampler.java/1.1/Sun Aug 11 19:24:54 2002//Tv1_7_3
+/JNDISampler.java/1.3/Thu Aug 29 18:17:43 2002//Tv1_8_1
 D
diff --git a/jakarta-jmeter/src/protocol/jndi/sampler/CVS/Tag b/jakarta-jmeter/src/protocol/jndi/sampler/CVS/Tag
index 5f312fe..e2fda28 100644
--- a/jakarta-jmeter/src/protocol/jndi/sampler/CVS/Tag
+++ b/jakarta-jmeter/src/protocol/jndi/sampler/CVS/Tag
@@ -1 +1 @@
-Nv1_7_3
+Nv1_8_1
diff --git a/jakarta-jmeter/src/protocol/jndi/sampler/JNDISampler.java b/jakarta-jmeter/src/protocol/jndi/sampler/JNDISampler.java
index 74369ea..6b3553e 100644
--- a/jakarta-jmeter/src/protocol/jndi/sampler/JNDISampler.java
+++ b/jakarta-jmeter/src/protocol/jndi/sampler/JNDISampler.java
@@ -54,8 +54,8 @@
  */
 package org.apache.jmeter.ejb.jndi.sampler;
 
-import java.lang.reflect.Method;
 import java.lang.reflect.InvocationTargetException;
+import java.lang.reflect.Method;
 import java.util.ArrayList;
 import java.util.HashMap;
 import java.util.Hashtable;
@@ -65,15 +65,11 @@ import java.util.Vector;
 import javax.naming.InitialContext;
 import javax.naming.NamingException;
 
-import org.apache.jmeter.ejb.jndi.config.JndiConfig;
-import org.apache.jmeter.ejb.jndi.config.LookupConfig;
-import org.apache.jmeter.ejb.jndi.config.MethodConfig;
-import org.apache.jmeter.ejb.jndi.config.MethodConfigUserObjectException;
-import org.apache.jmeter.ejb.jndi.config.gui.MethodConfigGui;
 import org.apache.jmeter.samplers.Entry;
-import org.apache.jmeter.samplers.Sampler;
 import org.apache.jmeter.samplers.SampleResult;
-import org.apache.log4j.Category;
+import org.apache.jmeter.samplers.Sampler;
+import org.apache.log.Hierarchy;
+import org.apache.log.Logger;
 /**
  * Samples the JNDI performance and records them
  *
@@ -83,8 +79,8 @@ import org.apache.log4j.Category;
  */
 public class JNDISampler implements Sampler
 {
-  private static Category catClass = Category.getInstance(
-	JNDISampler.class.getName());
+  transient private static Logger log = Hierarchy.getDefaultHierarchy().getLoggerFor(
+			"jmeter.protocol.jndi");
 
   public static final String QUERY = "JNDISampler.query";
 
@@ -102,7 +98,7 @@ public class JNDISampler implements Sampler
    */
   public SampleResult sample(Entry e)
   {
-    catClass.info("Start : sample1");
+    log.info("Start : sample1");
     boolean reflectionStatus = false;
     // There is a row of ifs condition which may be executed depending on the
     // state of the MethodConfig state.  During reflection only one of these
@@ -147,9 +143,9 @@ public class JNDISampler implements Sampler
           String value = jndiConfig.getValue(i);
           if(value != null)
           {
-            if(catClass.isDebugEnabled())
+            if(log.isDebugEnabled())
             {
-              catClass.debug("sample1 : JNDI env - " + 
+              log.debug("sample1 : JNDI env - " + 
 		JndiConfig.JNDI_PROPS[i] + " = " + value);
             }
             ht.put(JndiConfig.JNDI_PROPS[i], value);
@@ -159,7 +155,7 @@ public class JNDISampler implements Sampler
         start = System.currentTimeMillis();
         ctx = new InitialContext(ht);
         end = System.currentTimeMillis();
-        catClass.info("sample1 : Got initial context");
+        log.info("sample1 : Got initial context");
         // store the initial context for reuse
         jndiConfig.setInitialContext(ctx);
       }
@@ -174,15 +170,15 @@ public class JNDISampler implements Sampler
       if(lookupConfig != null)
       {
         lookupName = lookupConfig.getLookupName();
-        if(catClass.isDebugEnabled())
+        if(log.isDebugEnabled())
         {
-          catClass.debug("sample1 : LookupName - " + lookupName);
+          log.debug("sample1 : LookupName - " + lookupName);
         }
         start = System.currentTimeMillis();
         ref = ctx.lookup(lookupName);
         end = System.currentTimeMillis();
         lookupTime = end - start;
-        catClass.info("Got remote interface");
+        log.info("Got remote interface");
         lookupRes.setTime(lookupTime);
         lookupRes.putValue(SampleResult.DISPLAY_NAME, 
 		"Remote Interface Lookup - " + lookupName);
@@ -204,10 +200,10 @@ public class JNDISampler implements Sampler
       int state = model.getState();
       reflectionStatus = model.getReflectionStatus();
       String[] strings = null;
-      if(catClass.isDebugEnabled())
+      if(log.isDebugEnabled())
       {
-        catClass.debug("sample1 : state - " + state);
-        catClass.debug("sample1 : reflectionStatus - " + reflectionStatus);
+        log.debug("sample1 : state - " + state);
+        log.debug("sample1 : reflectionStatus - " + reflectionStatus);
       }
       // Perform only if : 
       // 1. doing a reflection and in this state
@@ -239,9 +235,9 @@ public class JNDISampler implements Sampler
         // for this state, get all the required parms for the selected
         // method
         String methodHomeName = methodConfig.getMethodHomeName();
-        if(catClass.isDebugEnabled())
+        if(log.isDebugEnabled())
         {
-          catClass.debug("sample1 : selected methodHomeName - " +
+          log.debug("sample1 : selected methodHomeName - " +
 		methodHomeName);
         }
         Vector returnValues = 
@@ -265,11 +261,11 @@ public class JNDISampler implements Sampler
 	&& !stateJustChanged)
 	|| (state >= MethodConfig.METHOD_INVOKE_HOME && !reflectionStatus))
       {
-        catClass.debug("sample1 : METHOD_INVOKE_HOME");
+        log.debug("sample1 : METHOD_INVOKE_HOME");
         Method method = model.getHomeMethod();
-        if(catClass.isDebugEnabled())
+        if(log.isDebugEnabled())
         {
-          catClass.debug("sample1 : home method to be invoked - " + method);
+          log.debug("sample1 : home method to be invoked - " + method);
         }
         // only initialize homeMethodRes if method execution is to be measured
         homeMethodRes = new SampleResult();
@@ -279,29 +275,26 @@ public class JNDISampler implements Sampler
         {
           parmsArray = methodConfigGui.getMethodParmsValues(
 		MethodConfig.METHOD_INVOKE_HOME);
-          if(catClass.isDebugEnabled())
+          if(log.isDebugEnabled())
           {
-            catClass.debug("sample1 : home method parms - " + parmsArray);
+            log.debug("sample1 : home method parms - " + parmsArray);
           }
           // invoke the method
           start = System.currentTimeMillis();
           remoteInterface = method.invoke(ref, parmsArray);
-System.out.println("return - " + remoteInterface);
+			log.info("return - " + remoteInterface);
         }
         catch(IllegalAccessException err)
         {
-          catClass.error(err);
-          System.out.println(err);
+          log.error(err);
         }
         catch(InvocationTargetException err)
         {
-          catClass.error(err);
-          System.out.println(err);
+          log.error(err);
         }
         catch(MethodConfigUserObjectException err)
         {
-          catClass.error(err);
-          System.out.println(err);
+          log.error(err);
         }
         end = System.currentTimeMillis();
         if(!reflectionStatus)
@@ -333,9 +326,9 @@ System.out.println("return - " + remoteInterface);
         // interface
         remoteInterface = model.getRemoteInterfaceType();
         Class remoteInterfaceClass = remoteInterface.getClass();
-        if(catClass.isDebugEnabled())
+        if(log.isDebugEnabled())
         {
-          catClass.debug("updateGui1 : remoteInterfaceClass - " +
+          log.debug("updateGui1 : remoteInterfaceClass - " +
 		remoteInterfaceClass);
         }
         Method[] methods = remoteInterfaceClass.getMethods();
@@ -358,9 +351,9 @@ System.out.println("return - " + remoteInterface);
         // for this state, get all the required parms for the selected
         // method
         String methodRemoteName = methodConfig.getMethodRemoteName();
-        if(catClass.isDebugEnabled())
+        if(log.isDebugEnabled())
         {
-          catClass.debug("sample1 : selected methodRemoteName - " +
+          log.debug("sample1 : selected methodRemoteName - " +
 		methodRemoteName);
         }
         Object selectedRemoteInterfaceType = model.getRemoteInterfaceType();
@@ -387,11 +380,11 @@ System.out.println("return - " + remoteInterface);
 	&& !stateJustChanged)
 	|| (state >= MethodConfig.METHOD_INVOKE_REMOTE && !reflectionStatus))
       {
-        catClass.debug("sample1 : METHOD_INVOKE_REMOTE");
+        log.debug("sample1 : METHOD_INVOKE_REMOTE");
         Method method = model.getRemoteMethod();
-        if(catClass.isDebugEnabled())
+        if(log.isDebugEnabled())
         {
-          catClass.debug("sample1 : remote method to be invoked - " + method);
+          log.debug("sample1 : remote method to be invoked - " + method);
         }
         Object selectedRemoteInterfaceType = model.getRemoteInterfaceType();
         // only initialize homeMethodRes if method execution is to be measured
@@ -405,22 +398,19 @@ System.out.println("return - " + remoteInterface);
           // invoke the method
           start = System.currentTimeMillis();
           results = method.invoke(selectedRemoteInterfaceType, parmsArray);
-System.out.println("return - " + results);
+			log.info("return - " + results);
         }
         catch(IllegalAccessException err)
         {
-          catClass.error(err);
-          System.out.println(err);
+          log.error(err);
         }
         catch(InvocationTargetException err)
         {
-          catClass.error(err);
-          System.out.println(err);
+          log.error(err);
         }
         catch(MethodConfigUserObjectException err)
         {
-          catClass.error(err);
-          System.out.println(err);
+          log.error(err);
         }
         end = System.currentTimeMillis();
         if(!reflectionStatus)
@@ -470,17 +460,16 @@ System.out.println("return - " + results);
       res.putValue(SampleResult.RESULT_LIST, resultList);
       res.putValue(SampleResult.TOTAL_TIME, new Long(totalTime));
 
-      System.out.println("!!!!! ctxTime : " + ctxTime);
-      System.out.println("!!!!! lookupTime : " + lookupTime);
-      System.out.println("!!!!! homeMethodTime : " + homeMethodTime);
+      log.info("!!!!! ctxTime : " + ctxTime);
+      log.info("!!!!! lookupTime : " + lookupTime);
+      log.info("!!!!! homeMethodTime : " + homeMethodTime);
     }
     catch(NamingException err)
     {
-      catClass.error(err);
-      System.err.println(err);
+      log.error(err);
     }
     
-    catClass.info("End : sample1");
+    log.info("End : sample1");
     return res;
   }
 
@@ -494,7 +483,7 @@ System.out.println("return - " + results);
    */
   protected String getMethodSignature(Method method)
   {
-    catClass.debug("Start : getMethodSignature1");
+    log.debug("Start : getMethodSignature1");
     StringBuffer strbuff = new StringBuffer();
     Class[] parameterTypes = method.getParameterTypes();
     strbuff.append(method.getName());
@@ -510,8 +499,8 @@ System.out.println("return - " + results);
     }
     strbuff.append(")");
     String returnVal = strbuff.toString();
-    catClass.debug("getMethodSignature1 : method signature - " + returnVal);
-    catClass.debug("End : getMethodSignature1");
+    log.debug("getMethodSignature1 : method signature - " + returnVal);
+    log.debug("End : getMethodSignature1");
     return returnVal;
   }
 
@@ -522,7 +511,7 @@ System.out.println("return - " + results);
    */
   protected Vector getMethodParmsTypes(String methodName, Class objectClass)
   {
-    catClass.debug("Start : getMethodParms1");
+    log.debug("Start : getMethodParms1");
     Method[] methods = objectClass.getMethods();
     Method method = null;
     Class[] methodParmTypes = null;
@@ -546,9 +535,9 @@ System.out.println("return - " + results);
       }
       strbuff.append(")");
       String name = strbuff.toString();
-      if(catClass.isDebugEnabled())
+      if(log.isDebugEnabled())
       {
-        catClass.debug("getMethodParms1 : current method to be compared - " 
+        log.debug("getMethodParms1 : current method to be compared - " 
 		+ name);
       }
       if(name.equals(methodName))
@@ -561,7 +550,7 @@ System.out.println("return - " + results);
     Vector returnValues = new Vector();
     returnValues.add(method);
     returnValues.add(methodParmTypes);
-    catClass.debug("End : getMethodParms1");
+    log.debug("End : getMethodParms1");
     return returnValues;
   }
 }
diff --git a/jakarta-jmeter/xdocs/CVS/Entries b/jakarta-jmeter/xdocs/CVS/Entries
index 0737dab..9699985 100644
--- a/jakarta-jmeter/xdocs/CVS/Entries
+++ b/jakarta-jmeter/xdocs/CVS/Entries
@@ -1,14 +1,14 @@
-/bugs.xml/1.3/Thu Jun 13 00:45:19 2002//Tv1_7_3
-/changes.xml/1.10/Sat Aug 10 17:18:33 2002//Tv1_7_3
-/contributing.xml/1.6/Sat Aug 10 17:18:33 2002//Tv1_7_3
-/extending.xml/1.1/Wed Mar  7 06:38:36 2001//Tv1_7_3
-/how_to_use_jmeter.xml/1.1/Wed Mar  7 06:38:36 2001//Tv1_7_3
-/index.xml/1.4/Sat Mar  9 23:47:57 2002//Tv1_7_3
-/installing.xml/1.2/Tue Aug 28 21:28:33 2001//Tv1_7_3
-/license.xml/1.1/Thu Mar 29 23:56:28 2001//Tv1_7_3
-/running.xml/1.3/Thu Aug 30 17:19:03 2001//Tv1_7_3
-/todo.xml/1.5/Thu Jun 13 00:45:19 2002//Tv1_7_3
-/velocity.properties/1.2/Fri Mar  1 00:09:06 2002//Tv1_7_3
+/bugs.xml/1.3/Thu Jun 13 00:45:19 2002//Tv1_8_1
+/changes.xml/1.13/Sat Feb  1 16:12:07 2003//Tv1_8_1
+/contributing.xml/1.10/Tue Jan  7 14:23:20 2003//Tv1_8_1
+/extending.xml/1.1/Wed Mar  7 06:38:36 2001//Tv1_8_1
+/how_to_use_jmeter.xml/1.1/Wed Mar  7 06:38:36 2001//Tv1_8_1
+/index.xml/1.4/Sat Mar  9 23:47:57 2002//Tv1_8_1
+/installing.xml/1.2/Tue Aug 28 21:28:33 2001//Tv1_8_1
+/license.xml/1.1/Thu Mar 29 23:56:28 2001//Tv1_8_1
+/running.xml/1.3/Thu Aug 30 17:19:03 2001//Tv1_8_1
+/todo.xml/1.5/Thu Jun 13 00:45:19 2002//Tv1_8_1
+/velocity.properties/1.2/Fri Mar  1 00:09:06 2002//Tv1_8_1
 D/demos////
 D/extending////
 D/stylesheets////
diff --git a/jakarta-jmeter/xdocs/CVS/Tag b/jakarta-jmeter/xdocs/CVS/Tag
index 5f312fe..e2fda28 100644
--- a/jakarta-jmeter/xdocs/CVS/Tag
+++ b/jakarta-jmeter/xdocs/CVS/Tag
@@ -1 +1 @@
-Nv1_7_3
+Nv1_8_1
diff --git a/jakarta-jmeter/xdocs/changes.xml b/jakarta-jmeter/xdocs/changes.xml
index e603692..ac2bd30 100644
--- a/jakarta-jmeter/xdocs/changes.xml
+++ b/jakarta-jmeter/xdocs/changes.xml
@@ -9,6 +9,40 @@
 <p><b>Changes are chronologically ordered from top (most recent) to bottom 
 (least recent)</b></p>  
 
+<b>Changes: for more info, contact <a href="mailto:mstover1@apache.org">Michael Stover</a></b>
+
+<h3>Version 1.8.1</h3>
+<ul>
+<li>Bug Fix Release.  Many bugs were fixed.</li>
+<li>Removed redundant "Root" node from test tree.</li>
+<li>Re-introduced Icons in test tree.</li>
+<li>Some re-organization of code to improve build process.</li>
+<li>View Results Tree has added option to view results as web document (still buggy at this point).</li>
+<li>New Total line in Aggregate Listener (still buggy at this point).</li>
+<li>Improvements to ability to change JMeter's Locale settings.</li>
+<li>Improvements to SSL Manager.</li>
+</ul>
+
+<h3>Version 1.8</h3>
+<ul>
+<li>Improvement to Aggregate report's calculations.</li>
+<li>Simplified application logging.</li>
+<li>New Duration Assertion.</li>
+<li>Fixed and improved Mailer Visualizer.</li>
+<li>Improvements to HTTP Sampler's recovery of resources (sockets and file handles).</li>
+<li>Improving JMeter's internal handling of test start/stop.</li>
+<li>Fixing and adding options to behavior of Interleave and Random Controllers.</li>
+<li>New Counter config element.</li>
+<li>New User Parameters config element.</li>
+<li>Improved performance of file opener.</li>
+<li>Functions and other elements can access global variables.</li>
+<li>Help system available within JMeter's GUI.</li>
+<li>Test Elements can be disabled.</li>
+<li>Language/Locale can be changed while running JMeter (mostly).</li>
+<li>View Results Tree can be configured to record only errors.</li>
+<li>Various bug fixes.</li>
+</ul>
+
 <b>Changes: for more info, contact <a href="mailto:mstover1@apache.org">Michael Stover</a></b>
 <h3>Version 1.7.3</h3>
 <ul>
@@ -159,7 +193,7 @@ test engine code.</li>
 </ul> </p>
   <p><b>Apache JMeter 1.3</b> - Apr 16 1999
   (<a href="mailto:stefano@apache.org">Stefano Mazzocchi</a>,
- <a href="mailto:luta.raphael@networks.vivendi.net">Raphaël Luta</a>)
+ <a href="mailto:luta.raphael@networks.vivendi.net">RaphaÃ«l Luta</a>)
 <ul>
    <li>Run the Garbage Collector and run finalization before starting to sampling to ensure
      same state every time (SM)</li>
@@ -202,4 +236,4 @@ test engine code.</li>
 </ul> </p> 
 </section> 
 </body> 
-</document>
\ No newline at end of file
+</document>
diff --git a/jakarta-jmeter/xdocs/contributing.xml b/jakarta-jmeter/xdocs/contributing.xml
index 5858b8d..89b576d 100644
--- a/jakarta-jmeter/xdocs/contributing.xml
+++ b/jakarta-jmeter/xdocs/contributing.xml
@@ -14,13 +14,19 @@
 <li>Kevin Hammond (committer)</li>
 <li>Neth (committer)</li>
 <li>Derek Baum</li>
-<li>Jordi Salvat i Alabart</li>
+<li>Jordi Salvat i Alabart (committer)</li>
 <li>William Weber</li>
 <li>Brendan Burns (committer)</li>
 <li>Michael Stover (commiter &amp; release manager)</li>
 <li>Jim Boucher (committer)</li>
-<li>Wolfram Rittmeyer</li>
+<li>Wolfram Rittmeyer (committer)</li>
 <li>Dion McMurtrie</li>
+<li>Keith Cassell (committer)</li>
+<li>Drew Gulino (committer)</li>
+<li>Michal Kostrzewa (committer)</li>
+<li>Scott Eade (committer)</li>
+<li>Oliver Rossmueller (committer)</li>
+<li>Jonathan Carlson</li>
 </ul>
 <p>If your name does not appear here and you feel it should, please 
 send me an email (mstover1@apache.org).</p>
diff --git a/jakarta-jmeter/xdocs/demos/CVS/Entries b/jakarta-jmeter/xdocs/demos/CVS/Entries
index 031619a..644eacc 100644
--- a/jakarta-jmeter/xdocs/demos/CVS/Entries
+++ b/jakarta-jmeter/xdocs/demos/CVS/Entries
@@ -1,11 +1,11 @@
-/AssertionTestPlan.jmx/1.2/Wed Aug  7 18:49:38 2002/-kb/Tv1_7_3
-/AuthManagerTestPlan.jmx/1.3/Wed Aug  7 18:49:38 2002//Tv1_7_3
-/HeaderManagerTestPlan.jmx/1.2/Wed Aug  7 18:49:38 2002//Tv1_7_3
-/InterleaveTestPlan.jmx/1.2/Wed Aug  7 18:49:38 2002//Tv1_7_3
-/InterleaveTestPlan2.jmx/1.2/Wed Aug  7 18:49:38 2002//Tv1_7_3
-/LoopTestPlan.jmx/1.2/Wed Aug  7 18:49:38 2002//Tv1_7_3
-/OnceOnlyTestPlan.jmx/1.2/Wed Aug  7 18:49:38 2002//Tv1_7_3
-/ProxyServerTestPlan.jmx/1.1/Sat Nov 24 00:15:11 2001//Tv1_7_3
-/SimpleTestPlan.jmx/1.2/Wed Aug  7 18:49:38 2002//Tv1_7_3
-/URLRewritingExample.jmx/1.2/Tue Jul 23 18:06:31 2002//Tv1_7_3
+/AssertionTestPlan.jmx/1.2/Wed Aug  7 18:49:38 2002/-kb/Tv1_8_1
+/AuthManagerTestPlan.jmx/1.3/Wed Aug  7 18:49:38 2002//Tv1_8_1
+/HeaderManagerTestPlan.jmx/1.2/Wed Aug  7 18:49:38 2002//Tv1_8_1
+/InterleaveTestPlan.jmx/1.2/Wed Aug  7 18:49:38 2002//Tv1_8_1
+/InterleaveTestPlan2.jmx/1.2/Wed Aug  7 18:49:38 2002//Tv1_8_1
+/LoopTestPlan.jmx/1.2/Wed Aug  7 18:49:38 2002//Tv1_8_1
+/OnceOnlyTestPlan.jmx/1.2/Wed Aug  7 18:49:38 2002//Tv1_8_1
+/ProxyServerTestPlan.jmx/1.1/Sat Nov 24 00:15:11 2001//Tv1_8_1
+/SimpleTestPlan.jmx/1.2/Wed Aug  7 18:49:38 2002//Tv1_8_1
+/URLRewritingExample.jmx/1.2/Tue Jul 23 18:06:31 2002//Tv1_8_1
 D
diff --git a/jakarta-jmeter/xdocs/demos/CVS/Tag b/jakarta-jmeter/xdocs/demos/CVS/Tag
index 5f312fe..e2fda28 100644
--- a/jakarta-jmeter/xdocs/demos/CVS/Tag
+++ b/jakarta-jmeter/xdocs/demos/CVS/Tag
@@ -1 +1 @@
-Nv1_7_3
+Nv1_8_1
diff --git a/jakarta-jmeter/xdocs/extending/CVS/Entries b/jakarta-jmeter/xdocs/extending/CVS/Entries
index 75aca88..cba0b59 100644
--- a/jakarta-jmeter/xdocs/extending/CVS/Entries
+++ b/jakarta-jmeter/xdocs/extending/CVS/Entries
@@ -1,3 +1,3 @@
-/JMeter Extension Scenario.xml/1.1/Thu Mar  7 23:03:13 2002//Tv1_7_3
-/index.xml/1.4/Thu Mar  7 23:03:13 2002//Tv1_7_3
+/JMeter Extension Scenario.xml/1.1/Thu Mar  7 23:03:13 2002//Tv1_8_1
+/index.xml/1.4/Thu Mar  7 23:03:13 2002//Tv1_8_1
 D
diff --git a/jakarta-jmeter/xdocs/extending/CVS/Tag b/jakarta-jmeter/xdocs/extending/CVS/Tag
index 5f312fe..e2fda28 100644
--- a/jakarta-jmeter/xdocs/extending/CVS/Tag
+++ b/jakarta-jmeter/xdocs/extending/CVS/Tag
@@ -1 +1 @@
-Nv1_7_3
+Nv1_8_1
diff --git a/jakarta-jmeter/xdocs/stylesheets/CVS/Entries b/jakarta-jmeter/xdocs/stylesheets/CVS/Entries
index 703faf4..9c11a7c 100644
--- a/jakarta-jmeter/xdocs/stylesheets/CVS/Entries
+++ b/jakarta-jmeter/xdocs/stylesheets/CVS/Entries
@@ -1,6 +1,6 @@
-/printable_project.xml/1.1/Fri Aug 31 12:17:26 2001//Tv1_7_3
-/project.xml/1.10/Tue Jul 16 18:25:24 2002//Tv1_7_3
-/site.vsl/1.12/Fri Aug  9 19:08:55 2002//Tv1_7_3
-/site.xsl/1.2/Sat Feb 23 03:47:56 2002//Tv1_7_3
-/site_printable.vsl/1.2/Mon Mar 11 22:30:23 2002//Tv1_7_3
+/printable_project.xml/1.1/Fri Aug 31 12:17:26 2001//Tv1_8_1
+/project.xml/1.11/Sat Feb  1 16:12:07 2003//Tv1_8_1
+/site.vsl/1.13/Tue Oct 15 20:28:42 2002//Tv1_8_1
+/site.xsl/1.2/Sat Feb 23 03:47:56 2002//Tv1_8_1
+/site_printable.vsl/1.2/Mon Mar 11 22:30:23 2002//Tv1_8_1
 D
diff --git a/jakarta-jmeter/xdocs/stylesheets/CVS/Tag b/jakarta-jmeter/xdocs/stylesheets/CVS/Tag
index 5f312fe..e2fda28 100644
--- a/jakarta-jmeter/xdocs/stylesheets/CVS/Tag
+++ b/jakarta-jmeter/xdocs/stylesheets/CVS/Tag
@@ -1 +1 @@
-Nv1_7_3
+Nv1_8_1
diff --git a/jakarta-jmeter/xdocs/stylesheets/project.xml b/jakarta-jmeter/xdocs/stylesheets/project.xml
index 23adb20..134dfcf 100644
--- a/jakarta-jmeter/xdocs/stylesheets/project.xml
+++ b/jakarta-jmeter/xdocs/stylesheets/project.xml
@@ -9,7 +9,8 @@
 	 <body>
 	 <menu name="About">
 		  <item name="Overview"               href="/index.html"/>
-		  <item name="Download"               href="http://jakarta.apache.org/builds/jakarta-jmeter/"/>
+		  <item name="Download Releases"               href="http://jakarta.apache.org/builds/jakarta-jmeter/"/>
+		  <item name="Download Nightly Tarball"  href="http://cvs.apache.org/builds/jakarta-jmeter/nightly"/>
 		  <item name="Changes"                href="/changes.html"/>
 		  <item name="Known Bugs"             href="http://nagoya.apache.org/bugzilla/buglist.cgi?bug_status=NEW&amp;bug_status=ASSIGNED&amp;bug_status=REOPENED&amp;email1=&amp;emailtype1=substring&amp;emailassigned_to1=1&amp;email2=&amp;emailtype2=substring&amp;emailreporter2=1&amp;bugidtype=include&amp;bug_id=&amp;changedin=&amp;votes=&amp;chfieldfrom=&amp;chfieldto=Now&amp;chfieldvalue=&amp;product=JMeter&amp;short_desc=&amp;short_desc_type=substring&amp;long_desc=&amp;long_desc_type=substring&amp;bug_file_loc=&amp;bug_file_loc_type=substring&amp;keywords=&amp;keywords_type=anywords&amp;field0-0-0=noop&amp;type0-0-0=noop&amp;value0-0-0=&amp;cmdtype=doit&amp;order=Reuse+same+sort+as+last+time"/>
 		  <item name="License"                href="/license.html"/>
@@ -19,6 +20,7 @@
 	 <menu name="Documentation">
 		<item name="User Manual"        href="/usermanual/index.html"/>
 		<item name="Developer Manual"       href="/extending/index.html"/>
+		<item name="JMeter Wiki"			href="http://nagoya.apache.org/wiki/apachewiki.cgi?JMeterProjectPages"/>
 	 </menu>
 	 <menu name="Community">
 		  <item name="Get Involved"           href="/site/getinvolved.html"/>
diff --git a/jakarta-jmeter/xdocs/stylesheets/site.vsl b/jakarta-jmeter/xdocs/stylesheets/site.vsl
index cf93cd4..0a17183 100644
--- a/jakarta-jmeter/xdocs/stylesheets/site.vsl
+++ b/jakarta-jmeter/xdocs/stylesheets/site.vsl
@@ -248,6 +248,9 @@
 			 <a name="$component.getAttributeValue("name").replace($space,$udsc)"><h3>$!component.getAttributeValue("index") $component.getAttributeValue("name")</h3></a>
 		  </font>
 		</td></tr>
+		#if($component.getAttribute("useinstead"))
+			<tr><td><em>* - This element is deprecated.  Use <a href="$relativePath/usermanual/component_reference.html#$component.getAttributeValue("useinstead").replace($space,$udsc)">$component.getAttributeValue("useinstead")</a> instead</td></tr>
+		#end
 		<tr><td>
 		  #foreach ( $c_items in $component.getChildren() )
 				#if ($c_items.getName().equals("description"))
diff --git a/jakarta-jmeter/xdocs/user_manual/CVS/Entries b/jakarta-jmeter/xdocs/user_manual/CVS/Entries
index b1f3896..ebafef9 100644
--- a/jakarta-jmeter/xdocs/user_manual/CVS/Entries
+++ b/jakarta-jmeter/xdocs/user_manual/CVS/Entries
@@ -1,21 +1,21 @@
-/assertions.xml/1.2/Mon Sep 24 13:17:01 2001//Tv1_7_3
-/ftp_test.xml/1.2/Thu Jun 13 00:45:19 2002//Tv1_7_3
-/index.xml/1.9/Thu Jun 13 00:45:19 2002//Tv1_7_3
-/interleave.xml/1.3/Thu Jun 13 00:45:19 2002//Tv1_7_3
-/jdbc_test.xml/1.2/Thu Jun 13 00:45:19 2002//Tv1_7_3
-/logical_controllers.xml/1.3/Tue Aug 28 21:28:34 2001//Tv1_7_3
-/loop_controller.xml/1.3/Thu Jun 13 00:45:19 2002//Tv1_7_3
-/modification_manager.xml/1.2/Thu Jun 13 00:45:19 2002//Tv1_7_3
-/once_only.xml/1.3/Thu Jun 13 00:45:19 2002//Tv1_7_3
-/proxy_server.xml/1.5/Thu Jun 13 00:45:19 2002//Tv1_7_3
-/ready_components.xml/1.2/Tue Aug 28 21:28:34 2001//Tv1_7_3
-/rmi.xml/1.2/Sat Mar 24 20:44:24 2001//Tv1_7_3
-/running.xml/1.2/Thu Aug  2 22:27:33 2001//Tv1_7_3
-/saving.xml/1.2/Thu Aug  2 22:27:33 2001//Tv1_7_3
-/sslmanager.xml/1.1/Wed Sep  5 05:19:25 2001//Tv1_7_3
-/test_samples.xml/1.4/Tue Aug 28 21:28:34 2001//Tv1_7_3
-/threadgroups.xml/1.3/Thu Aug 30 17:19:03 2001//Tv1_7_3
-/timers.xml/1.2/Thu Aug  2 22:27:33 2001//Tv1_7_3
-/visualizers.xml/1.2/Thu Aug  2 22:27:33 2001//Tv1_7_3
-/web_test.xml/1.2/Thu Jun 13 00:45:19 2002//Tv1_7_3
+/assertions.xml/1.2/Mon Sep 24 13:17:01 2001//Tv1_8_1
+/ftp_test.xml/1.2/Thu Jun 13 00:45:19 2002//Tv1_8_1
+/index.xml/1.9/Thu Jun 13 00:45:19 2002//Tv1_8_1
+/interleave.xml/1.3/Thu Jun 13 00:45:19 2002//Tv1_8_1
+/jdbc_test.xml/1.2/Thu Jun 13 00:45:19 2002//Tv1_8_1
+/logical_controllers.xml/1.3/Tue Aug 28 21:28:34 2001//Tv1_8_1
+/loop_controller.xml/1.3/Thu Jun 13 00:45:19 2002//Tv1_8_1
+/modification_manager.xml/1.2/Thu Jun 13 00:45:19 2002//Tv1_8_1
+/once_only.xml/1.3/Thu Jun 13 00:45:19 2002//Tv1_8_1
+/proxy_server.xml/1.5/Thu Jun 13 00:45:19 2002//Tv1_8_1
+/ready_components.xml/1.2/Tue Aug 28 21:28:34 2001//Tv1_8_1
+/rmi.xml/1.2/Sat Mar 24 20:44:24 2001//Tv1_8_1
+/running.xml/1.2/Thu Aug  2 22:27:33 2001//Tv1_8_1
+/saving.xml/1.2/Thu Aug  2 22:27:33 2001//Tv1_8_1
+/sslmanager.xml/1.1/Wed Sep  5 05:19:25 2001//Tv1_8_1
+/test_samples.xml/1.4/Tue Aug 28 21:28:34 2001//Tv1_8_1
+/threadgroups.xml/1.3/Thu Aug 30 17:19:03 2001//Tv1_8_1
+/timers.xml/1.2/Thu Aug  2 22:27:33 2001//Tv1_8_1
+/visualizers.xml/1.2/Thu Aug  2 22:27:33 2001//Tv1_8_1
+/web_test.xml/1.2/Thu Jun 13 00:45:19 2002//Tv1_8_1
 D
diff --git a/jakarta-jmeter/xdocs/user_manual/CVS/Tag b/jakarta-jmeter/xdocs/user_manual/CVS/Tag
index 5f312fe..e2fda28 100644
--- a/jakarta-jmeter/xdocs/user_manual/CVS/Tag
+++ b/jakarta-jmeter/xdocs/user_manual/CVS/Tag
@@ -1 +1 @@
-Nv1_7_3
+Nv1_8_1
diff --git a/jakarta-jmeter/xdocs/usermanual/CVS/Entries b/jakarta-jmeter/xdocs/usermanual/CVS/Entries
index 9ef2c77..d277968 100644
--- a/jakarta-jmeter/xdocs/usermanual/CVS/Entries
+++ b/jakarta-jmeter/xdocs/usermanual/CVS/Entries
@@ -1,17 +1,17 @@
-/best-practices.xml/1.4/Thu Mar  7 14:19:09 2002//Tv1_7_3
-/boss.xml/1.5/Wed Jun 26 00:59:49 2002//Tv1_7_3
-/build-adv-web-test-plan.xml/1.4/Tue Jun 18 01:01:15 2002//Tv1_7_3
-/build-db-test-plan.xml/1.3/Wed Jun 26 00:59:49 2002//Tv1_7_3
-/build-ftp-test-plan.xml/1.4/Wed Jun 26 00:59:49 2002//Tv1_7_3
-/build-jndi-test-plan.xml/1.2/Wed Mar  6 03:52:03 2002//Tv1_7_3
-/build-test-plan.xml/1.6/Tue Jun 18 01:01:15 2002//Tv1_7_3
-/build-web-test-plan.xml/1.13/Wed Jun 26 00:59:49 2002//Tv1_7_3
-/component_reference.xml/1.23/Fri Aug 16 12:39:03 2002//Tv1_7_3
-/functions.xml/1.2/Fri Aug  9 19:08:55 2002//Tv1_7_3
-/get-started.xml/1.13/Mon Aug 12 13:26:28 2002//Tv1_7_3
-/glossary.xml/1.4/Sat Jul 13 03:17:49 2002//Tv1_7_3
-/index.xml/1.23/Sat Jul 13 03:17:49 2002//Tv1_7_3
-/intro.xml/1.7/Sat Mar  2 19:32:12 2002//Tv1_7_3
-/remote-test.xml/1.5/Tue Jun 18 01:01:15 2002//Tv1_7_3
-/test_plan.xml/1.6/Sat Jun 29 00:37:00 2002//Tv1_7_3
+/best-practices.xml/1.4/Thu Mar  7 14:19:09 2002//Tv1_8_1
+/boss.xml/1.5/Wed Jun 26 00:59:49 2002//Tv1_8_1
+/build-adv-web-test-plan.xml/1.5/Thu Jan 30 00:35:46 2003//Tv1_8_1
+/build-db-test-plan.xml/1.4/Thu Jan 30 00:35:46 2003//Tv1_8_1
+/build-ftp-test-plan.xml/1.5/Thu Jan 30 00:35:46 2003//Tv1_8_1
+/build-jndi-test-plan.xml/1.2/Wed Mar  6 03:52:03 2002//Tv1_8_1
+/build-test-plan.xml/1.7/Sun Dec 29 14:27:21 2002//Tv1_8_1
+/build-web-test-plan.xml/1.14/Thu Jan 30 00:35:46 2003//Tv1_8_1
+/component_reference.xml/1.32/Sat Feb  1 14:41:11 2003//Tv1_8_1
+/functions.xml/1.2/Fri Aug  9 19:08:55 2002//Tv1_8_1
+/get-started.xml/1.14/Tue Oct 15 20:28:42 2002//Tv1_8_1
+/glossary.xml/1.4/Sat Jul 13 03:17:49 2002//Tv1_8_1
+/index.xml/1.23/Sat Jul 13 03:17:49 2002//Tv1_8_1
+/intro.xml/1.7/Sat Mar  2 19:32:12 2002//Tv1_8_1
+/remote-test.xml/1.9/Wed Jan 29 16:02:47 2003//Tv1_8_1
+/test_plan.xml/1.8/Thu Jan 30 00:35:46 2003//Tv1_8_1
 D
diff --git a/jakarta-jmeter/xdocs/usermanual/CVS/Tag b/jakarta-jmeter/xdocs/usermanual/CVS/Tag
index 5f312fe..e2fda28 100644
--- a/jakarta-jmeter/xdocs/usermanual/CVS/Tag
+++ b/jakarta-jmeter/xdocs/usermanual/CVS/Tag
@@ -1 +1 @@
-Nv1_7_3
+Nv1_8_1
diff --git a/jakarta-jmeter/xdocs/usermanual/build-adv-web-test-plan.xml b/jakarta-jmeter/xdocs/usermanual/build-adv-web-test-plan.xml
index 1ded884..1294d02 100644
--- a/jakarta-jmeter/xdocs/usermanual/build-adv-web-test-plan.xml
+++ b/jakarta-jmeter/xdocs/usermanual/build-adv-web-test-plan.xml
@@ -26,7 +26,7 @@ will find it and add it to each request.  If the request already has a value, it
 <p>Download <a href="../demos/URLRewritingExample.jmx">this example</a>. In Figure 1 is shown a 
 test plan using URL rewriting.  Note that the URL Re-writing modifier is attached to the ThreadGroup,
 thus assuring that it will affect every request in that ThreadGroup.</p>
-<figure image="../images/screenshots/url_rewrite_example_a.gif">Figure 1 - Test Tree</figure>
+<figure image="../images/screenshots/url_rewrite_example_a.png">Figure 1 - Test Tree</figure>
 <p>In Figure 2, we see the URL Re-writing modifier GUI, which just has a field for the user to specify
 the name of the session ID parameter.  There is also a checkbox for indicating that the session ID should
 be part of the path (separated by a ";"), rather than a request parameter</p>
diff --git a/jakarta-jmeter/xdocs/usermanual/build-db-test-plan.xml b/jakarta-jmeter/xdocs/usermanual/build-db-test-plan.xml
index 92b5e6a..5622152 100644
--- a/jakarta-jmeter/xdocs/usermanual/build-db-test-plan.xml
+++ b/jakarta-jmeter/xdocs/usermanual/build-db-test-plan.xml
@@ -45,7 +45,7 @@ in the tree, if you have not already selected it. You should now see the Thread
 Group Control Panel in the right section of the JMeter window (see Figure 7.1
 below)</p>
 
-<figure image="../images/screenshots/jdbctest/threadgroup.png">
+<figure image="../images/screenshots/webtest/threadgroup.png">
 Figure 7.1. Thread Group with Default Values</figure>
 
 <p>Start by providing a more descriptive name for our Thread Group. In the name
diff --git a/jakarta-jmeter/xdocs/usermanual/build-ftp-test-plan.xml b/jakarta-jmeter/xdocs/usermanual/build-ftp-test-plan.xml
index bbcf0ee..0feae08 100644
--- a/jakarta-jmeter/xdocs/usermanual/build-ftp-test-plan.xml
+++ b/jakarta-jmeter/xdocs/usermanual/build-ftp-test-plan.xml
@@ -45,7 +45,7 @@ in the tree, if you have not already selected it. You should now see the Thread
 Group Control Panel in the right section of the JMeter window (see Figure 8.1
 below)</p>
 
-<figure image="../images/screenshots/ftptest/threadgroup.png">
+<figure image="../images/screenshots/webtest/threadgroup.png">
 Figure 8.1. Thread Group with Default Values</figure>
 
 <p>Start by providing a more descriptive name for our Thread Group. In the name
diff --git a/jakarta-jmeter/xdocs/usermanual/build-test-plan.xml b/jakarta-jmeter/xdocs/usermanual/build-test-plan.xml
index f698325..8e75f9b 100644
--- a/jakarta-jmeter/xdocs/usermanual/build-test-plan.xml
+++ b/jakarta-jmeter/xdocs/usermanual/build-test-plan.xml
@@ -30,6 +30,8 @@ your elements are saved.  JMeter will load the elements into the tree.</p>
 <p>To save tree elements, right click on an element and choose the "save" option.
 JMeter will save the element selected, plus all child elements beneath it.  In this way,
 you can save test tree fragments, individual elements, or the entire test plan.</p>
+
+<note>The test plan file format changed with version 1.7. Versions later than 1.8 are no longer capable of reading test plans in the old format. If you need to use an old test plan, use JMeter 1.7 or 1.8 to load and re-save it in the new format.</note>
 </subsection>
 
 <subsection name="3.3 Configuring Tree Elements" anchor="config_element">
diff --git a/jakarta-jmeter/xdocs/usermanual/build-web-test-plan.xml b/jakarta-jmeter/xdocs/usermanual/build-web-test-plan.xml
index 3c44250..842c0a8 100644
--- a/jakarta-jmeter/xdocs/usermanual/build-web-test-plan.xml
+++ b/jakarta-jmeter/xdocs/usermanual/build-web-test-plan.xml
@@ -48,7 +48,7 @@ in the tree, if you have not already selected it. You should now see the Thread
 Group Control Panel in the right section of the JMeter window (see Figure 5.1
 below)</p>
 
-<figure image="../images/screenshots/webtest/threadgroup.gif">
+<figure image="../images/screenshots/webtest/threadgroup.png">
 Figure 5.1. Thread Group with Default Values</figure>
 
 <p>Start by providing a more descriptive name for our Thread Group. In the name
@@ -78,7 +78,7 @@ leave the Control Panel (for example, when selecting another tree element).</not
 
 <p>See Figure 5.2 for the completed Jakarta Users Thread Group.</p>
 
-<figure image="../images/screenshots/webtest/threadgroup2.gif">
+<figure image="../images/screenshots/webtest/threadgroup2.png">
 Figure 5.2. Jakarta Users Thread Group</figure>
 
 </section>
@@ -94,7 +94,7 @@ to get the Add menu, and then select Add --&gt; Config Element --&gt; HTTP Reque
 Defaults. Then, select this new element to view its Control Panel (see Figure 5.3).
 </p>
 
-<figure image="../images/screenshots/webtest/http-defaults1.gif">
+<figure image="../images/screenshots/webtest/http-defaults1.png">
 Figure 5.3. HTTP Request Defaults</figure>
 
 <p>
@@ -114,7 +114,7 @@ HTTP Request elements use.</note>
 
 <p>See Figure 5.4 for the completed HTTP Request Defaults element</p>
 
-<figure image="../images/screenshots/webtest/http-defaults2.gif">
+<figure image="../images/screenshots/webtest/http-defaults2.png">
 Figure 5.4. HTTP Defaults for our Test Plan</figure>
 
 </section>
@@ -154,7 +154,7 @@ element.</li>
 </ol>
 </p>
 
-<figure image="../images/screenshots/webtest/http-request1.gif">
+<figure image="../images/screenshots/webtest/http-request1.png">
 Figure 5.5. HTTP Request for Jakarta Home Page</figure>
 
 <p>Next, add the second HTTP Request and edit the following properties (see
@@ -165,7 +165,7 @@ Figure 5.6:
 </ol>
 </p>
 
-<figure image="../images/screenshots/webtest/http-request2.gif">
+<figure image="../images/screenshots/webtest/http-request2.png">
 Figure 5.6. HTTP Request for Jakarta Project Guidelines Page</figure>
 
 </section>
diff --git a/jakarta-jmeter/xdocs/usermanual/component_reference.xml b/jakarta-jmeter/xdocs/usermanual/component_reference.xml
index c5c1753..cc42392 100644
--- a/jakarta-jmeter/xdocs/usermanual/component_reference.xml
+++ b/jakarta-jmeter/xdocs/usermanual/component_reference.xml
@@ -17,17 +17,17 @@ using a <complink name="FTP Request Defaults"/> Configuration
 Element so you do not have to enter the same information for each FTP Request Generative
 Controller. </description>
 <properties>
-	<property name="Name" required="No">Descriptive name for this controller that is shown in the tree.</property>
-	<property name="Server Name or IP" required="Yes">Domain name or IP address of the FTP server.
+        <property name="Name" required="No">Descriptive name for this controller that is shown in the tree.</property>
+        <property name="Server Name or IP" required="Yes">Domain name or IP address of the FTP server.
 JMeter assumes the FTP server is listening on the default port.</property>
-	<property name="File to Retrieve From Server" required="Yes">Path and name of the file to retrieve.</property>
-	<property name="Username" required="Usually">FTP account username.</property>
-	<property name="Password" required="Usually">FTP account password.</property>
+        <property name="File to Retrieve From Server" required="Yes">Path and name of the file to retrieve.</property>
+        <property name="Username" required="Usually">FTP account username.</property>
+        <property name="Password" required="Usually">FTP account password.</property>
 </properties>
 <links>
-	<link href="test_plan.html#assertions">Assertions</link>
-	<complink name="FTP Request Defaults"/>
-	<link href="build-ftp-test-plan.html">Building an FTP Test Plan</link>
+        <link href="test_plan.html#assertions">Assertions</link>
+        <complink name="FTP Request Defaults"/>
+        <link href="build-ftp-test-plan.html">Building an FTP Test Plan</link>
 </links>
 
 </component>
@@ -35,74 +35,74 @@ JMeter assumes the FTP server is listening on the default port.</property>
 <component name="HTTP Request" index="13.1.2" screenshot="../images/screenshots/gen-controller/http-request.png">
 
 <description>
-	<p>This sampler lets you send an HTTP/HTTPS request to a web server.  It
-	also lets you control whether or not JMeter parses HTML files for images and
-	Java applets and sends HTTP requests to retrieve them.</p>
-	<p>If you are going to send multiple requests to the same web server, consider
-	using an <complink name="HTTP Request Defaults"/>
-	Configuration Element so you do not have to enter the same information for each
-	HTTP Request.</p>
-
-	<p>Or, instead of manually adding HTTP Requests, you may want to use
-	JMeter's <complink name="HTTP Proxy Server"/> to create
-	them.  This can save you time if you have a lot of HTTP requests or requests with many
-	parameters.</p>
-
-	<p>If the request requires a login authorization, you will also have to add an
-	<complink name="HTTP Authorization Manager"/>
-	Configuration Element. And, if the request uses cookies, then you will also need an
-	<complink name="HTTP Cookie Manager"/>.  You can
-	add either of these elements to the Thread Group or the HTTP Request.  If you have
-	more than one HTTP Request that needs authorizations or cookies, then add the
-	elements to the Thread Group.  That way, all HTTP Request controllers will share the
-	same Authorization Manager and Cookie Manager elements.</p>
-
-	<p>If the request uses a technique called "URL Rewriting" to maintain sessions,
-	then see section
-	<a href="build-adv-web-test-plan.html#url_rewriting">6.1 Handling User Sessions With URL Rewriting</a>
-	for additional configuration steps.</p>
+        <p>This sampler lets you send an HTTP/HTTPS request to a web server.  It
+        also lets you control whether or not JMeter parses HTML files for images and
+        Java applets and sends HTTP requests to retrieve them.</p>
+        <p>If you are going to send multiple requests to the same web server, consider
+        using an <complink name="HTTP Request Defaults"/>
+        Configuration Element so you do not have to enter the same information for each
+        HTTP Request.</p>
+
+        <p>Or, instead of manually adding HTTP Requests, you may want to use
+        JMeter's <complink name="HTTP Proxy Server"/> to create
+        them.  This can save you time if you have a lot of HTTP requests or requests with many
+        parameters.</p>
+
+        <p>If the request requires a login authorization, you will also have to add an
+        <complink name="HTTP Authorization Manager"/>
+        Configuration Element. And, if the request uses cookies, then you will also need an
+        <complink name="HTTP Cookie Manager"/>.  You can
+        add either of these elements to the Thread Group or the HTTP Request.  If you have
+        more than one HTTP Request that needs authorizations or cookies, then add the
+        elements to the Thread Group.  That way, all HTTP Request controllers will share the
+        same Authorization Manager and Cookie Manager elements.</p>
+
+        <p>If the request uses a technique called "URL Rewriting" to maintain sessions,
+        then see section
+        <a href="build-adv-web-test-plan.html#url_rewriting">6.1 Handling User Sessions With URL Rewriting</a>
+        for additional configuration steps.</p>
 </description>
 
 <properties>
-	<property name="Name" required="No">Descriptive name for this controller that is shown in the tree.</property>
-	<property name="Server" required="Yes">Domain name or IP address of the web server.</property>
-	<property name="Port" required="No (defaults to 80)">Port the web server is listening to.</property>
-	<property name="Protocol" required="Yes">HTTP or HTTPS.</property>
-	<property name="Method" required="Yes">HTTP GET or HTTP POST.</property>
-	<property name="Path" required="Yes">The path to resource (for example, /servlets/myServlet). If the
+        <property name="Name" required="No">Descriptive name for this controller that is shown in the tree.</property>
+        <property name="Server" required="Yes">Domain name or IP address of the web server.</property>
+        <property name="Port" required="No (defaults to 80)">Port the web server is listening to.</property>
+        <property name="Protocol" required="Yes">HTTP or HTTPS.</property>
+        <property name="Method" required="Yes">HTTP GET or HTTP POST.</property>
+        <property name="Path" required="Yes">The path to resource (for example, /servlets/myServlet). If the
 resource requires query string parameters, add them below in the
 "Send Parameters With the Request" section.</property>
-	<property name="Send Parameters With the Request" required="No">The query string will
-	be generated from the list of parameters you provide.  Each parameter has a <i>name</i> and
-	<i>value</i>.  The query string will be generated in the correct fashion, depending on
-	the choice of "Method" you made (ie if you chose GET, the query string will be
-	appended to the URL, if POST, then it will be sent separately).  Also, if you are
-	sending a file using a multipart form, the query string will be created using the
-	multipart form specifications.
-	<p>
-	Additionally, you can specify whether each paramter should be URL encoded.  If you are not sure what this
-	means, it is probably best to select it.  If your values contain characters such as &amp;amp; or spaces, or 
-	question marks, then encoding is usually required.</p></property>
-	<property name="Filename" required="No">Name of the file to send.  If left blank, JMeter
-	does not send a file, if filled in, JMeter automatically sends the request as
-	a multipart form request.</property>
-	<property name="Parameter Name" required="No (Yes if Filename filled in)">Name of the web request parameter.</property>
-	<property name="MIME Type" required="No (Yes if Filename filled in)">MIME type (for example, text/plain).</property>
-	<property name="Retrieve All Images and Java Applets" required="No">Tell JMeter to parse the HTML file
+        <property name="Send Parameters With the Request" required="No">The query string will
+        be generated from the list of parameters you provide.  Each parameter has a <i>name</i> and
+        <i>value</i>.  The query string will be generated in the correct fashion, depending on
+        the choice of "Method" you made (ie if you chose GET, the query string will be
+        appended to the URL, if POST, then it will be sent separately).  Also, if you are
+        sending a file using a multipart form, the query string will be created using the
+        multipart form specifications.
+        <p>
+        Additionally, you can specify whether each paramter should be URL encoded.  If you are not sure what this
+        means, it is probably best to select it.  If your values contain characters such as &amp;amp; or spaces, or
+        question marks, then encoding is usually required.</p></property>
+        <property name="Filename" required="No">Name of the file to send.  If left blank, JMeter
+        does not send a file, if filled in, JMeter automatically sends the request as
+        a multipart form request.</property>
+        <property name="Parameter Name" required="No (Yes if Filename filled in)">Name of the web request parameter.</property>
+        <property name="MIME Type" required="No (Yes if Filename filled in)">MIME type (for example, text/plain).</property>
+        <property name="Retrieve All Images and Java Applets" required="No">Tell JMeter to parse the HTML file
 and send HTTP/HTTPS requests for all images and Java applets referenced in the file.</property>
 </properties>
 
 <links>
-	<link href="test_plan.html#assertions">Assertion</link>
-	<link href="build-web-test-plan.html">Building a Web Test Plan</link>
-	<link href="build-adv-web-test-plan.html">Building an Advanced Web Test Plan</link>
-	<complink name="HTTP Authorization Manager"/>
-	<complink name="HTTP Cookie Manager"/>
-	<complink name="HTTP Header Manager"/>
-	<complink name="HTML Link Parser"/>
-	<complink name="HTTP Proxy Server"/>
-	<complink name="HTTP Request Defaults"/>
-	<link href="build-adv-web-test-plan.html#url_rewriting">HTTP Requests and Session ID's: URL Rewriting</link>
+        <link href="test_plan.html#assertions">Assertion</link>
+        <link href="build-web-test-plan.html">Building a Web Test Plan</link>
+        <link href="build-adv-web-test-plan.html">Building an Advanced Web Test Plan</link>
+        <complink name="HTTP Authorization Manager"/>
+        <complink name="HTTP Cookie Manager"/>
+        <complink name="HTTP Header Manager"/>
+        <complink name="HTML Link Parser"/>
+        <complink name="HTTP Proxy Server"/>
+        <complink name="HTTP Request Defaults"/>
+        <link href="build-adv-web-test-plan.html#url_rewriting">HTTP Requests and Session ID's: URL Rewriting</link>
 </links>
 
 </component>
@@ -119,30 +119,30 @@ This way, you do not have to enter the same information for each JDBC Request
 controller.</p></description>
 
 <properties>
-	<property name="Name" required="No">Descriptive name for this controller that is shown in the tree.</property>
-	<property name="JDBC URL" required="Yes">URL of the database (for example,
+        <property name="Name" required="No">Descriptive name for this controller that is shown in the tree.</property>
+        <property name="JDBC URL" required="Yes">URL of the database (for example,
 "jdbc:weblogic:oracle"). Refer to your database's JDBC documentation for the
 URL you should use.</property>
-	<property name="Driver Class" required="Yes">The database driver Java class (for example,
+        <property name="Driver Class" required="Yes">The database driver Java class (for example,
 "weblogic.jdbc.oci.Driver"). Refer to your database's JDBC documentation for
 the name of the JDBC driver class you should use.</property>
-	<property name="Username" required="Usually (database dependent)">FTP account username.</property>
-	<property name="Password" required="Usually (database dependent)">FTP account password.</property>
-	<property name="Number of Connections in Pool" required="Yes">Number of database connection
+        <property name="Username" required="Usually (database dependent)">FTP account username.</property>
+        <property name="Password" required="Usually (database dependent)">FTP account password.</property>
+        <property name="Number of Connections in Pool" required="Yes">Number of database connection
 instances to create and keep active. The maximum value depends on your database.
 Also, JMeter imposes a maximum of 100 connections.</property>
-	<property name="Max Usage For Each Connection" required="Yes">Maximum number of times JMeter
+        <property name="Max Usage For Each Connection" required="Yes">Maximum number of times JMeter
 uses a database connection instance before recycling it (destroying and creating
 a new instance).</property>
-	<property name="SQL Query String" required="Yes">SQL query (for example, "select * from t_customers").</property>
+        <property name="SQL Query String" required="Yes">SQL query (for example, "select * from t_customers").</property>
 </properties>
 
 <links>
-	<link href="test_plan.html#assertions">Assertion</link>
-	<link href="build-db-test-plan.html">Building a Database Test Plan</link>
-	<complink name="JDBC Database Login Defaults"/>
-	<complink name="JDBC Database Connection Pool Defaults"/>
-	<complink name="JDBC SQL Query Defaults"/>
+        <link href="test_plan.html#assertions">Assertion</link>
+        <link href="build-db-test-plan.html">Building a Database Test Plan</link>
+        <complink name="JDBC Database Login Defaults"/>
+        <complink name="JDBC Database Connection Pool Defaults"/>
+        <complink name="JDBC SQL Query Defaults"/>
 </links>
 
 </component>
@@ -159,14 +159,14 @@ table below - as defined by your implementation.  A simple example (SleepTest) i
 provided.</p></description>
 
 <properties>
-	<property name="Name" required="No">Descriptive name for this sampler
-	 that is shown in the tree.</property>
-	<property name="Classname" required="Yes">The specific implementation of
-	the JavaSamplerClient interface to be sampled.</property>
-	<property name="Send Parameters with Request" required="No">A list of
-	arguments that will be passed to the sampled class.  All arguments
-	are sent as Strings.</property>
-	</properties>
+        <property name="Name" required="No">Descriptive name for this sampler
+         that is shown in the tree.</property>
+        <property name="Classname" required="Yes">The specific implementation of
+        the JavaSamplerClient interface to be sampled.</property>
+        <property name="Send Parameters with Request" required="No">A list of
+        arguments that will be passed to the sampled class.  All arguments
+        are sent as Strings.</property>
+        </properties>
 
 </component>
 
@@ -178,12 +178,12 @@ POST content.</p>
 </description>
 
 <properties>
-	<property name="Name" required="No">Descriptive name for this sampler
-	 that is shown in the tree.</property>
-	<property name="URL" required="Yes">The URL to direct the SOAP request to.</property>
-	<property name="Soap/XML-RPC Data" required="No">The Soap XML message, or XML-RPC 
-	instructions.</property>
-	</properties>
+        <property name="Name" required="No">Descriptive name for this sampler
+         that is shown in the tree.</property>
+        <property name="URL" required="Yes">The URL to direct the SOAP request to.</property>
+        <property name="Soap/XML-RPC Data" required="No">The Soap XML message, or XML-RPC
+        instructions.</property>
+        </properties>
 
 </component>
 
@@ -196,7 +196,7 @@ POST content.</p>
 other controllers for each loop iteration. </p>
 </description>
 <properties>
-	<property name="name" required="No">Descriptive name for this controller that is shown in the tree.</property>
+        <property name="name" required="No">Descriptive name for this controller that is shown in the tree.</property>
 </properties>
 
 <!--
@@ -244,7 +244,7 @@ to have a single thread and a loop count of eight.  Notice that the Test Plan ha
 two Interleave Controllers inside of it.</p>
 
 <figure image="../images/screenshots/logic-controller/interleave2.gif">
-	Figure 2 - Interleave Controller Example 2
+        Figure 2 - Interleave Controller Example 2
 </figure>
 
 <p>The outer Interleave Controller alternates between the
@@ -263,13 +263,13 @@ count to three, JMeter will send a total of 2 * 3 = 6 HTTP Requests.
 </p></description>
 
 <properties>
-	<property name="Name" required="No">Descriptive name for this controller that is shown in the tree.</property>
-	<property name="Loop Count" required="Yes, unless &quot;Forever&quot; is checked">
-		The number of times the subelements of this controller will be iterated each time
-		through a test run.
-		<p><b>Special Case:</b> The Loop Controller embedded in the <a href="test_plan.html#thread_group">Thread Group</a>
-		element behaves slightly differently.  Unless set to forever, it stops the test after
-		the given number of iterations have been done.</p></property>
+        <property name="Name" required="No">Descriptive name for this controller that is shown in the tree.</property>
+        <property name="Loop Count" required="Yes, unless &quot;Forever&quot; is checked">
+                The number of times the subelements of this controller will be iterated each time
+                through a test run.
+                <p><b>Special Case:</b> The Loop Controller embedded in the <a href="test_plan.html#thread_group">Thread Group</a>
+                element behaves slightly differently.  Unless set to forever, it stops the test after
+                the given number of iterations have been done.</p></property>
 </properties>
 
 <example title="Looping Example" anchor="loop_example">
@@ -303,7 +303,7 @@ count value you specify in the Thread Group or Loop Controller.</p>
 to login once to establish a session.</p>
 </description>
 <properties>
-	<property name="Name" required="No">Descriptive name for this controller that is shown in the tree.</property>
+        <property name="Name" required="No">Descriptive name for this controller that is shown in the tree.</property>
 </properties>
 
 <example title="Once Only Example" anchor="once_only_example">
@@ -326,7 +326,7 @@ Logic Controllers.  Unlike other Logic Controllers, this controller provides no
 storage device.</p>
 </description>
 <properties>
-	<property name="Name" required="No">Descriptive name for this controller that is shown in the tree.</property>
+        <property name="Name" required="No">Descriptive name for this controller that is shown in the tree.</property>
 </properties>
 
 <example title="Using the Simple Controller" anchor="simple_controller_example">
@@ -353,33 +353,110 @@ This is particularly true of the Random Controller.  Experiment before you assum
 what results any given interaction will give</note>
 </description>
 <properties>
-	<property name="Name" required="No">Descriptive name for this controller that is shown in the tree.</property>
+        <property name="Name" required="No">Descriptive name for this controller that is shown in the tree.</property>
+</properties>
+
+</component>
+
+<component index="13.2.7" name="Recording Controller" screenshot="../images/screenshots/logic-controller/recording-controller.gif">
+<description>
+<p>The Recording Controller is a place holder indicating where the proxy server should
+record samples to.  During test run, it has no effect, similar to the Simple Controller.  But during
+recording using the <complink name="HTTP Proxy Server"/>, all recorded samples will
+be saved under the Recording Controller.</p>
+
+</description>
+<properties>
+        <property name="Name" required="No">Descriptive name for this controller that is shown in the tree.</property>
 </properties>
 
 </component>
 </section>
 
 <section name="13.3 Listeners" anchor="listeners">
+<description>
+Most of the listeners perform several roles in addition to "listening"
+to the test results.  They frequently also provide means to view,
+save, and read saved test results.
+<p>
+The saving and reading of test results is generic.  The various
+listeners generally have a panel whereby one can specify the file to
+which the results will be written (or read).  The results are stored as XML
+files, typically with a ".jtl" extension.</p>
+<p>
+The information to be saved is configurable.  If one specifies the
+"Functional Test Mode" on the Test Plan element, one gets the largest
+amount of information.  If this box is not checked, the default saved
+data includes a time stamp (the number of milliseconds since midnight,
+January 1, 1970 UTC), the data type, the thread name, the label, the
+response time, message, and code, and a success indicator.</p>
+<p>
+One can get a more selective set of information my modifying the
+jmeter.properties file.  The following example indicates how to set
+these.</p>
+<p>
+<code>
+<pre>
+#---------------------------------------------------------------------------
+# Results file configuration
+#---------------------------------------------------------------------------
+
+# This section helps determine how result data will be saved.
+# The commented out values are the defaults.
+
+# legitimate values: xml, csv, db.  Only xml is currently supported.
+#jmeter.save.saveservice.output_format=xml
+
+# true when field should be saved; false otherwise
+
+jmeter.save.saveservice.data_type=false
+jmeter.save.saveservice.label=true
+jmeter.save.saveservice.response_code=false
+jmeter.save.saveservice.response_data=false
+jmeter.save.saveservice.response_message=false
+jmeter.save.saveservice.successful=true
+jmeter.save.saveservice.thread_name=false
+jmeter.save.saveservice.time=false
+
+# legitimate values: none, ms, or a format suitable for SimpleDateFormat
+#jmeter.save.saveservice.timestamp_format=ms
+jmeter.save.saveservice.timestamp_format=MM/dd/yy HH:mm:ss
+
+# legitimate values: none, first, all
+jmeter.save.saveservice.assertion_results=first
+</pre>
+</code></p>
+<p>
+The date format to be used for the timestamp is described in <A
+HREF="http://java.sun.com/j2se/1.4/docs/api/java/text/SimpleDateFormat.html">
+<B>SimpleDateFormat</B></A>.
+Bear in mind that choosing a date format other than "ms" is likely to
+make it impossible for JMeter to interpret the value when it is read
+in later for viewing purposes.</p>
+<p>
+The viewing capabilities are described in the following subsections.</p>
+
+</description>
 <component index="13.3.1" name="Mailer Visualizer" screenshot="../images/screenshots/mailer_vis.png">
-<description><p>The mailer visualizer can be set up to send email if a test run receives too many 
+<description><p>The mailer visualizer can be set up to send email if a test run receives too many
 failed responses from the server.</p></description>
 
 <properties>
-	<property name="Name" required="No">Descriptive name for this element that is shown in the tree.</property>
-	<property name="From" required="Yes">Email address to send messages from.</property>
-	<property name="Addressie(s)" required="Yes">Email address to send messages to.</property>
-	<property name="SMTP Host" required="No">IP address or host name of SMTP (email redirector)
-	server.</property>
-	<property name="Failure Subject" required="No">Email subject line for fail messages.</property>
-	<property name="Success Subject" required="No">Email subject line for success messages.</property>
-	<property name="Failure Limit" required="Yes">Once this number of failed responses are received, a failure
-	email is sent.</property>
-	<property name="Success Limit" required="Yes">Once this number of successful responses are
-	received <strong>after previously reaching the failure limit</strong>, a success email
-	is sent.  The mailer will thus only send out messages in a sequence of failed-succeeded-failed-succeeded, etc.</property>
-	<property name="Test Mail" required="No"></property>
-	<property name="Failures" required="No">A field that keeps a running total of number
-	of failures so far received.</property>
+        <property name="Name" required="No">Descriptive name for this element that is shown in the tree.</property>
+        <property name="From" required="Yes">Email address to send messages from.</property>
+        <property name="Addressie(s)" required="Yes">Email address to send messages to.</property>
+        <property name="SMTP Host" required="No">IP address or host name of SMTP (email redirector)
+        server.</property>
+        <property name="Failure Subject" required="No">Email subject line for fail messages.</property>
+        <property name="Success Subject" required="No">Email subject line for success messages.</property>
+        <property name="Failure Limit" required="Yes">Once this number of failed responses are received, a failure
+        email is sent.</property>
+        <property name="Success Limit" required="Yes">Once this number of successful responses are
+        received <strong>after previously reaching the failure limit</strong>, a success email
+        is sent.  The mailer will thus only send out messages in a sequence of failed-succeeded-failed-succeeded, etc.</property>
+        <property name="Test Mail" required="No"></property>
+        <property name="Failures" required="No">A field that keeps a running total of number
+        of failures so far received.</property>
 </properties>
 </component>
 
@@ -395,7 +472,7 @@ current standard deviation (red), and the current throughput rate (green) are di
 includes any delays you added to your test and JMeter's own internal processing time.  The advantage
 of doing the calculation like this is that this number represents something
 real - your server in fact handled that many requests per minute, and you can increase the number of threads
-and/or decrease the delays to discover your server's maximum throughput.  Whereas if you made calculations 
+and/or decrease the delays to discover your server's maximum throughput.  Whereas if you made calculations
 that factored out delays and JMeter's processing, it would be unclear what you could conclude from that
 number.</p></description>
 </component>
@@ -413,14 +490,22 @@ is shown).  It also reports failures of any <a href="test_plan.html#assertions">
 are part of the test plan.</p></description>
 
 <links>
-	<complink name="Basic Assertion"/>
+        <complink name="Basic Assertion"/>
 </links>
 </component>
 
-<component index="13.3.6" name="View Result Tree" screenshot="../images/screenshots/view_results_tree.png">
+<component index="13.3.6" name="View Results Tree" screenshot="../images/screenshots/view_results_tree.png">
 <description>The View Results Tree shows a tree of all sample responses, allowing you to view the
 response for any sample.  In addition to showing the response, you can see the time it took to get
-this response, and some response codes.</description>
+this response, and some response codes.
+<p>
+There are two ways two view the response, controllable by a push
+button.  The default view shows all of the text contained in the
+response.  The alternative view attempts to render the response as
+HTML.  The rendered HTML is likely to compare poorly to the view one
+would get in any web browser; however, it does provide a quick
+approximation that is helpful for initial result evaluation.</p>
+</description>
 </component>
 
 <component index="13.3.7" name="Aggregate Report" screenshot="../images/screenshots/aggregate_report.png">
@@ -429,6 +514,12 @@ request, it totals the response information and provides request count, min, max
 idealized throughput calculation.</description>
 </component>
 
+<component index="13.3.7" name="View Results in Table" screenshot="../images/screenshots/table_results.gif">
+<description>This visualizer creates a row for every sample result.  Each sample result's URL,
+time in milliseconds, success/failure is displayed.  Like the <complink name="View Results Tree"/>,
+this visualizer uses a lot of memory.</description>
+</component>
+
 </section>
 
 <section name="13.4 Configuration Elements" anchor="config_elements">
@@ -449,7 +540,7 @@ Test Plan, with each Thread Group having its own Authorization Manager.
 </description>
 
 <properties>
-	<property name="Name" required="No">Descriptive name for this element that is shown in the tree. </property>
+        <property name="Name" required="No">Descriptive name for this element that is shown in the tree. </property>
   <property name="Base URL" required="Yes">A partial or complete URL that matches one or more HTTP Request URLs.  As an example,
 say you specify a Base URL of "http://jakarta.apache.org/restricted/" with a username of "jmeter" and
 a password of "jmeter".  If you send an HTTP request to the URL
@@ -505,7 +596,7 @@ session information, each JMeter thread will have its own session.</p>
 the cookie will be shared by all JMeter threads.</p>
 </description>
 <properties>
-	<property name="Name" required="No">Descriptive name for this element that is shown in the tree. </property>
+        <property name="Name" required="No">Descriptive name for this element that is shown in the tree. </property>
   <property name="Cookies Stored in the Cookie Manager" required="No (discouraged, unless you know what you're doing)">This
   gives you the opportunity to use hardcoded cookies that will be used by all threads during the test execution.</property>
   <property name="Add Button" required="N/A">Add an entry to the cookie table.</property>
@@ -529,17 +620,17 @@ Add menu (Add --> Non-Test Elements --> HTTP Proxy Server).</p>
 </description>
 
 <properties>
-	<property name="Name" required="No">Descriptive name for this controller that is shown in the tree.</property>
-	<property name="Port" required="Yes">The port that the Proxy Server listens to.  8080 is the default, but you can change it
+        <property name="Name" required="No">Descriptive name for this controller that is shown in the tree.</property>
+        <property name="Port" required="Yes">The port that the Proxy Server listens to.  8080 is the default, but you can change it
 if that port is already in use on your machine.</property>
-	<property name="Patterns to Include" required="No">Regular expressions that are matched against the full URL that is sampled.  Allows filtering of requests that are recorded.  All requests pass through, but only
-	those that meet the requirements of the Include/Exclude fields are <i>recorded</i>.  If both Include and Exclude are
-	left empty, then everything is recorded (which can result in dozens of samples recorded for each page, as images, stylesheets,
-	etc are recorded).  <b>If there is at least one entry in the Include field, then only requests that match one or more Include patterns are
-	recorded</b>.</property>
-	<property name="Patterns to Exclude" required="No">Regular expressions that are matched against the URL that is sampled.
-	<b>Any requests that match one or more Exclude pattern are <i>not</i> recorded</b>.</property>
-	<property name="Clear Buttons" required="N/A">Remove all regular expressions from the list.</property>
+        <property name="Patterns to Include" required="No">Regular expressions that are matched against the full URL that is sampled.  Allows filtering of requests that are recorded.  All requests pass through, but only
+        those that meet the requirements of the Include/Exclude fields are <i>recorded</i>.  If both Include and Exclude are
+        left empty, then everything is recorded (which can result in dozens of samples recorded for each page, as images, stylesheets,
+        etc are recorded).  <b>If there is at least one entry in the Include field, then only requests that match one or more Include patterns are
+        recorded</b>.</property>
+        <property name="Patterns to Exclude" required="No">Regular expressions that are matched against the URL that is sampled.
+        <b>Any requests that match one or more Exclude pattern are <i>not</i> recorded</b>.</property>
+        <property name="Clear Buttons" required="N/A">Remove all regular expressions from the list.</property>
   <property name="Start Button" required="N/A">Start the proxy server.  JMeter writes the following message to the console once the proxy server
 has started up and is ready to take requests: "Proxy up and running!".</property>
   <property name="Stop Button" required="N/A">Stop the proxy server.</property>
@@ -577,7 +668,7 @@ cookie manager, etc.</p>
 </component>
 
 <component index="13.4.4" name="HTTP Request Defaults"
-	screenshot="../images/screenshots/http-config/http-request-defaults.gif">
+        screenshot="../images/screenshots/http-config/http-request-defaults.gif">
 <description><p>This element lets you set default values that your HTTP Request controllers use.  For example, if you are
 creating a Test Plan with 25 HTTP Request controllers and all of the requests are being sent to the same server,
 you could add a single HTTP Request Defaults element with the "Server Name or IP" field filled in.  Then, when
@@ -586,41 +677,41 @@ this field value from the HTTP Request Defaults element.</p>
 </description>
 
 <properties>
-	<property name="Name" required="No">Descriptive name for this controller that is shown in the tree.</property>
-	<property name="Server" required="Yes">Domain name or IP address of the web server.</property>
-	<property name="Port" required="No (defaults to 80)">Port the web server is listening to.</property>
-	<property name="Protocol" required="Yes">HTTP or HTTPS.</property>
-	<property name="Method" required="Yes">HTTP GET or HTTP POST.</property>
-	<property name="Path" required="Yes">The path to resource (for example, /servlets/myServlet). If the
+        <property name="Name" required="No">Descriptive name for this controller that is shown in the tree.</property>
+        <property name="Server" required="Yes">Domain name or IP address of the web server.</property>
+        <property name="Port" required="No (defaults to 80)">Port the web server is listening to.</property>
+        <property name="Protocol" required="Yes">HTTP or HTTPS.</property>
+        <property name="Method" required="Yes">HTTP GET or HTTP POST.</property>
+        <property name="Path" required="Yes">The path to resource (for example, /servlets/myServlet). If the
 resource requires query string parameters, add them below in the
 "Send Parameters With the Request" section.</property>
-	<property name="Send Parameters With the Request" required="No">The query string will
-	be generated from the list of parameters you provide.  Each parameter has a <i>name</i> and
-	<i>value</i>.  The query string will be generated in the correct fashion, depending on
-	the choice of "Method" you made (ie if you chose GET, the query string will be
-	appended to the URL, if POST, then it will be sent separately).  Also, if you are
-	sending a file using a multipart form, the query string will be created using the
-	multipart form specifications.</property>
+        <property name="Send Parameters With the Request" required="No">The query string will
+        be generated from the list of parameters you provide.  Each parameter has a <i>name</i> and
+        <i>value</i>.  The query string will be generated in the correct fashion, depending on
+        the choice of "Method" you made (ie if you chose GET, the query string will be
+        appended to the URL, if POST, then it will be sent separately).  Also, if you are
+        sending a file using a multipart form, the query string will be created using the
+        multipart form specifications.</property>
 </properties>
 </component>
 
 <component index="13.4.5" name="FTP Request Defaults"
-		screenshot="../images/screenshots/ftp-config/ftp-request-defaults.gif">
+                screenshot="../images/screenshots/ftp-config/ftp-request-defaults.gif">
 <description></description>
 </component>
 
 <component index="13.4.6" name="JDBC Database Connection Pool Defaults"
-		screenshot="../images/screenshots/jdbc-config/jdbc-db-conn-pool.gif">
+                screenshot="../images/screenshots/jdbc-config/jdbc-db-conn-pool.gif">
 <description></description>
 </component>
 
 <component index="13.4.7" name="JDBC Database Login Defaults"
-		screenshot="../images/screenshots/jdbc-config/jdbc-db-login.gif">
+                screenshot="../images/screenshots/jdbc-config/jdbc-db-login.gif">
 <description></description>
 </component>
 
 <component index="13.4.8" name="JDBC SQL Query Defaults"
-		screenshot="../images/screenshots/jdbc-config/jdbc-sql-query.gif">
+                screenshot="../images/screenshots/jdbc-config/jdbc-sql-query.gif">
 <description></description>
 </component>
 
@@ -631,9 +722,9 @@ resource requires query string parameters, add them below in the
 </description>
 
 <properties>
-	<property name="Name" required="No">Descriptive name for this element that is shown in the tree. </property>
+        <property name="Name" required="No">Descriptive name for this element that is shown in the tree. </property>
   <property name="Name (Header)" required="No (You should have at least one, however)">Name of the request header.
-	Two common request headers you may want to experiment with
+        Two common request headers you may want to experiment with
 are "User-Agent" and "Referer".</property>
   <property name="Value" required="No (You should have at least one, however)">Request header value.</property>
   <property name="Add Button" required="N/A">Add an entry to the header table.</property>
@@ -655,6 +746,40 @@ instead. (see figures 9 and 10).</p>
 
 </component>
 
+<component index="13.4.10" name="User Parameters" screenshot="../images/screenshots/user_params.png">
+<description><p>Allows the user to specify values for User Variables specific to individual threads.</p>
+<p>User Variables can also be specified in the Test Plan but not specific to individual threads. This panel allows
+you to specify a series of values for any User Variable. For each thread, the variable will be assigned one of the values from the series
+in sequence. If there are more threads than values, the values get re-used. For example, this can be used to assign a distinct
+user id to be used by each thread. User variables can be referenced in any field of any jMeter Component.</p>
+
+<p>The variable is specified by clicking the Add Variable button in the bottom of the panel and filling in the Variable name in the 'Name:' column.
+To add a new value to the series, click the 'Add User' button and fill in the desired value in the newly added column.</p>
+
+<p>Values can be accessed in any test component in the same thread group, using the <a href="functions.html">function syntax</a>: ${variable}.</p>
+</description>
+</component>
+
+<component index="13.4.11" name="Counter" screenshot="../images/screenshots/counter.png">
+<description><p>Allows the user to create a counter that can be referenced anywhere
+in the Thread Group.  The counter config lets the user configure a starting point, a maximum,
+and the increment.  The counter will loop from the start to the max, and then start over
+with the start, continuing on like that until the test is ended.  </p></description>
+<properties>
+        <property name="Name" required="">Descriptive name for this element that is shown in the tree.</property>
+        <property name="Start" required="Yes">The starting number for the counter.  The counter will equal this
+        number during the first iteration.</property>
+        <property name="Increment" required="Yes">How much to increment the counter by after each
+        iteration.</property>
+        <property name="Maximum" required="Yes">If the counter exceeds the maximum, then it is reset to the Start value.</property>
+        <property name="Reference Name" required="Yes">This controls how you refer to this value in other elements.  Syntax is
+        as in <a href="functions.html">user-defined values</a>: <code>$(reference_name}</code>.</property>
+        <property name="Track Counter Independently for each User" required="No">In other words, is this a global counter, or does each user get their
+        own counter?  If unchecked, the counter is global (ie, user #1 will get value "1", and user #2 will get value "2" on
+        the first iteration).  If checked, each user has an independent counter.</property>
+</properties>
+</component>
+
 </section>
 
 <section name="13.5 Assertions" anchor="assertions">
@@ -667,16 +792,16 @@ to match the entire response, or if the response is only expected to contain the
 strings. You can attach multiple assertions to any controller for additionaly flexibility.</p>
 </description>
 <properties>
-	<property name="Name" required="">Descriptive name for this element that is shown in the tree.</property>
-	<property name="Response Field to Test" required="Yes">Instructs JMeter to test
-		against either the Response Text from the server, or against the URL string that was sampled.</property>
-	<property name="Pattern Matching Rules" required="Yes">Indicates whether the text being tested
-	must CONTAIN or MATCH the test patterns.  NOT may also be selected to indicate the text
-	should NOT CONTAIN or NOT MATCH the test patterns.</property>
-	<property name="Patterns to Test" required="Yes">A list of regular expressions to
-	be tested.  Each pattern is tested separately.  There is no difference between setting up
-	one Assertion with multiple patterns and setting up multiple Assertions with one
-	pattern each (assuming the other options are the same).</property>
+        <property name="Name" required="">Descriptive name for this element that is shown in the tree.</property>
+        <property name="Response Field to Test" required="Yes">Instructs JMeter to test
+                against either the Response Text from the server, or against the URL string that was sampled.</property>
+        <property name="Pattern Matching Rules" required="Yes">Indicates whether the text being tested
+        must CONTAIN or MATCH the test patterns.  NOT may also be selected to indicate the text
+        should NOT CONTAIN or NOT MATCH the test patterns.</property>
+        <property name="Patterns to Test" required="Yes">A list of regular expressions to
+        be tested.  Each pattern is tested separately.  There is no difference between setting up
+        one Assertion with multiple patterns and setting up multiple Assertions with one
+        pattern each (assuming the other options are the same).</property>
 </properties>
 
 <example title="Assertion Examples" anchor="assertion_examples">
@@ -696,9 +821,9 @@ user) is marked as a failed response.</p></description>
 
 <properties>
 <property name="Name" required="">Descriptive name for this element that is shown in the tree.</property>
-	<property name="Duration in Milliseconds" required="Yes">The maximum number of milliseconds
-	each response is allowed before being marked as failed.</property>
-	
+        <property name="Duration in Milliseconds" required="Yes">The maximum number of milliseconds
+        each response is allowed before being marked as failed.</property>
+
 </properties>
 </component>
 
@@ -712,8 +837,8 @@ user) is marked as a failed response.</p></description>
 requests, use this timer.</p></description>
 
 <properties>
-	<property name="Name" required="No">Descriptive name for this timer that is shown in the tree.</property>
-	<property name="Thread Delay" required="Yes">Number of milliseconds to pause.</property>
+        <property name="Name" required="No">Descriptive name for this timer that is shown in the tree.</property>
+        <property name="Thread Delay" required="Yes">Number of milliseconds to pause.</property>
 </properties>
 </component>
 
@@ -726,7 +851,7 @@ the deviation value you specify, and the offset value.</p></description>
 
 
 <properties>
-	<property name="Name" required="No">Descriptive name for this timer that is shown in the tree</property>
+        <property name="Name" required="No">Descriptive name for this timer that is shown in the tree</property>
   <property name="Deviation" required="Yes">Deviation in milliseconds.</property>
   <property name="Constant Delay Offset" required="Yes">Number of milliseconds to pause in addition
 to the random delay.</property>
@@ -741,13 +866,26 @@ each time interval having the same probability of occurring. The total delay
 is the sum of the random value and the offset value.</p></description>
 
 <properties>
-	<property name="Name" required="No">Descriptive name for this timer that is shown in the tree. </property>
+        <property name="Name" required="No">Descriptive name for this timer that is shown in the tree. </property>
   <property name="Random Delay Maximum" required="Yes">Maxium random number of milliseconds to
 pause.</property>
   <property name="Constant Delay Offset" required="Yes">Number of milliseconds to pause in addition
 to the random delay.</property>
 </properties>
 
+</component>
+
+<component index="13.6.4" name="Constant Throughput Timer" screenshot="../images/screenshots/timers/constant_throughput_timer.gif">
+
+<description><p>This timer introduces variable pauses, calculated to keep the total throughput (in terms of samples per minute) as close as possible to a give figure. Of course the throughput will be lower if the server is not capable of handling it, or if other timers or time-consuming test elements prevent it.</p>
+
+<p>Only samples within the container where you put the timer count towards the calculated throughput. Also note that the total time (used in the denominator to calculate the throughput) starts counting with the first such sample -- not with the test start.</p></description>
+
+<properties>
+        <property name="Name" required="No">Descriptive name for this timer that is shown in the tree. </property>
+  <property name="Target Throughput" required="Yes">Throughput we want the timer to try to generate.</property>
+</properties>
+
 </component>
 </section>
 
@@ -807,24 +945,24 @@ your dynamic test sample.</note>
 it is easier to use than the HTML Link Parser, and more efficient.  For web applications that
 use URL Re-writing to store session ids instead of cookies, this element can be attached at the
 ThreadGroup level, much like the <complink name="HTTP Cookie Manager"/>.  Simply give it the name
-of the session id parameter, and it will find it on the page and add the argument to every 
+of the session id parameter, and it will find it on the page and add the argument to every
 request of that ThreadGroup.</p>
-<p>Alternatively, this modifier can be attached to select requests and it will modify only them.  
-Clever users will even determine that this modifier can be used to grab values that elude the 
+<p>Alternatively, this modifier can be attached to select requests and it will modify only them.
+Clever users will even determine that this modifier can be used to grab values that elude the
 <complink name="HTML Link Parser"/>.</p>
 </description>
 
 <properties>
-	<property name="Name" required="No">Descriptive name given to this element in the test tree.</property>
-	<property name="Session Argument Name" required="Yes">The name of the parameter to grab from 
-	previous response.  This modifier will find the parameter anywhere it exists on the page, and
-	grab the value assigned to it, whether it's in an HREF or a form.</property>
-	<property name="Path Extension" required="No">Some web apps rewrite URLs by appending
-	a semi-colon plus the session id parameter.  Check this box if that is so.</property>
+        <property name="Name" required="No">Descriptive name given to this element in the test tree.</property>
+        <property name="Session Argument Name" required="Yes">The name of the parameter to grab from
+        previous response.  This modifier will find the parameter anywhere it exists on the page, and
+        grab the value assigned to it, whether it's in an HREF or a form.</property>
+        <property name="Path Extension" required="No">Some web apps rewrite URLs by appending
+        a semi-colon plus the session id parameter.  Check this box if that is so.</property>
 </properties>
 </component>
 
-<component index="13.7.3" name="HTML Parameter Mask" screenshot="../images/screenshots/parameter_mask.png">
+<component index="13.7.3" name="HTML Parameter Mask" useinstead="Counter" screenshot="../images/screenshots/parameter_mask.png">
 <description><p>The HTML Parameter Mask is used to generate unique values for HTML arguments.  By
 specifying the name of the parameter, a value prefix and suffix, and counter parameters, this
 modifier will generate values of the form "<code>name=prefixcountersuffix</code>".  Any HTTP
@@ -832,7 +970,7 @@ Request that it modifies, it will replace any parameter with the same name or ad
 parameter to the requests list of arguments.</p>
 <note>The value of the argument in your HTTP Request must be a '*' in order for the HTML Parameter Mask
 Modifier to replace it.</note>
-<p>As an example, the username for a login script could be modified to send a series of values 
+<p>As an example, the username for a login script could be modified to send a series of values
 such as:<br/>
 user_1<br/>
 user_2<br/>
@@ -840,33 +978,34 @@ user_3<br/>
 user_4, etc.</p></description>
 
 <properties>
-	<property name="Name" required="No">Descriptive name given to this element in the test tree.</property>
-	<property name="Name (second appearing)" required="Yes">The name of the parameter to
-	modify or add to the HTTP Request.</property>
-	<property name="ID Prefix" required="No">A string value to prefix to every generated value.</property>
-	<property name="Lower Bound" required="Yes">A number value to start the counter at.</property>
-	<property name="Upper Bound" required="Yes">A number value to end the counter, at which point it restarts 
-	with the Lower Bound value.</property>
-	<property name="Increment" required="Yes">Value to increment the counter by each time through.</property>
-	<property name="ID Suffix" required="No">A string value to add as suffix to every generated vaue.</property>
+        <property name="Name" required="No">Descriptive name given to this element in the test tree.</property>
+        <property name="Name (second appearing)" required="Yes">The name of the parameter to
+        modify or add to the HTTP Request.</property>
+        <property name="ID Prefix" required="No">A string value to prefix to every generated value.</property>
+        <property name="Lower Bound" required="Yes">A number value to start the counter at.</property>
+        <property name="Upper Bound" required="Yes">A number value to end the counter, at which point it restarts
+        with the Lower Bound value.</property>
+        <property name="Increment" required="Yes">Value to increment the counter by each time through.</property>
+        <property name="ID Suffix" required="No">A string value to add as suffix to every generated vaue.</property>
 </properties>
 </component>
 
-<component index="13.7.4" name="HTML User Parameter Modifier" screenshot="../images/screenshots/user_param_modifier.gif">
+<component index="13.7.4" name="HTTP User Parameter Modifier" useinstead="User Parameters" screenshot="../images/screenshots/user_param_modifier.gif">
 <description><p>The User Parameter Modifier uses an XML file get values for HTTP arguments.  Any
 HTTP Request that this modifier modifies will be checked for the existence of the specified
 arguments.  If found, the values for those arguments will be replaced by the values found in the
-xml file.  The XML file can have multiple sets of the same values.  This modifier will iterate 
-through these values in a round-robin style, thus each request will get a different set of values 
+xml file.  The XML file can have multiple sets of the same values.  This modifier will iterate
+through these values in a round-robin style, thus each request will get a different set of values
 until the last set of values is reached, at which point it will begin again at the first set.</p>
 <note>If the number of value sets is equal to the number of threads in your test, then it will work
 out that each thread will get the same set of values each time, which will be a different set from
-any other thread</note></description>
+any other thread</note>
+</description>
 
 <properties>
-	<property name="Name" required="No">Descriptive name given to this element in the test tree.</property>
-	<property name="File Name" required="Yes">Name of the XML file in JMeter's /bin directory
-	that holds the value sets.</property>
+        <property name="Name" required="No">Descriptive name given to this element in the test tree.</property>
+        <property name="File Name" required="Yes">Name of the XML file in JMeter's /bin directory
+        that holds the value sets.</property>
 </properties>
 </component>
 
@@ -933,39 +1072,54 @@ any other thread</note></description>
 <p>Please read the <a href="functions.html">general description</a> of how functions work.  Here is given only the details of
 specific functions.</p>
 
-<component index="13.9.1" name="Regex Function">
-<description><p>The Regex Function is used to parse the previous response using any regular 
+<component index="13.9.1" name="__regexFunction">
+<description><p>The Regex Function is used to parse the previous response using any regular
 expression (provided by user).  The function returns the template string with variable values filled
-in.</p></description>
+in.</p>
+<p>The __regexFunction stores values for future use.  In the sixth parameter, you can specify
+a reference name.  After this function executes, the same values can be retrieved at later times
+using the syntax for user-defined values.  For instance, if you enter "refName" as the sixth
+parameter you will be able to use:
+<ul>
+<li>${refName} to refer to the computed result of the second parameter ("Template for the
+replacement string") parsed by this function</li>
+<li>${refName_g0} to refer to the entire match  parsed by this function.</li>
+<li>${refName_g1} to refer to the first group parsed by this function.</li>
+<li>${refName_g#} to refer to the n<sup>th</sup> group parsed by this function.</li>
+</ul>
+</p></description>
 
 <properties>
-	<property name="First arguement" required="Yes">The first argument is the regular expression
-	to be applied to the response data.  It will grab all matches.  Any parts of this expression
-	that you wish to use in your template string, be sure to surround in parentheses.  Example:
-	&amp;lt;a href="(.*)"&amp;gt;.  This will grab the value of the link and store it as the first group (there is
-	only 1 group).  Another example: &amp;lt;input type="hidden" name="(.*)" value="(.*)"&amp;gt;.  This will
-	grab the name as the first group, and the value as the second group.  These values can be used
-	in your template string</property>
-	<property name="Second argument" required="Yes">This is the template string that will replace
-	the function at run-time.  To refer to a group captured in the regular expression, use the syntax:
-	$[group_number]$.  Ie: $1$, or $2$.  Your template can be any string.</property>
-	<property name="Third argument" required="Yes">The third argument tells JMeter which match
-	to use.  Your regular expression might find numerous matches.  You have four choices:
-		<ul><li>An integer - Tells JMeter to use that match.  '1' for the first found match, '2' for the 
-		second, and so on</li>
-		<li>RAND - Tells JMeter to choose a match at random.</li>
-		<li>ALL - Tells JMeter to use all matches, and create a template string for each one and then
-		append them all together.  This option is little used.</li>
-		<li>A float number between 0 and 1 - tells JMeter to find the Xth match using the formula:
-		(number_of_matches_found * float_number) rounded to nearest integer.</li>
-		</ul></property>
-	<property name="Fourth argument" required="No">If 'ALL' was selected for the above argument
-	value, then this argument will be inserted between each appended copy of the template value.</property>
-	<property name="Fifth argument" required="No">Default value returned if no match is found</property>
+        <property name="First arguement" required="Yes">The first argument is the regular expression
+        to be applied to the response data.  It will grab all matches.  Any parts of this expression
+        that you wish to use in your template string, be sure to surround in parentheses.  Example:
+        &amp;lt;a href="(.*)"&amp;gt;.  This will grab the value of the link and store it as the first group (there is
+        only 1 group).  Another example: &amp;lt;input type="hidden" name="(.*)" value="(.*)"&amp;gt;.  This will
+        grab the name as the first group, and the value as the second group.  These values can be used
+        in your template string</property>
+        <property name="Second argument" required="Yes">This is the template string that will replace
+        the function at run-time.  To refer to a group captured in the regular expression, use the syntax:
+        $[group_number]$.  Ie: $1$, or $2$.  Your template can be any string.</property>
+        <property name="Third argument" required="Yes">The third argument tells JMeter which match
+        to use.  Your regular expression might find numerous matches.  You have four choices:
+                <ul><li>An integer - Tells JMeter to use that match.  '1' for the first found match, '2' for the
+                second, and so on</li>
+                <li>RAND - Tells JMeter to choose a match at random.</li>
+                <li>ALL - Tells JMeter to use all matches, and create a template string for each one and then
+                append them all together.  This option is little used.</li>
+                <li>A float number between 0 and 1 - tells JMeter to find the Xth match using the formula:
+                (number_of_matches_found * float_number) rounded to nearest integer.</li>
+                </ul></property>
+        <property name="Fourth argument" required="No">If 'ALL' was selected for the above argument
+        value, then this argument will be inserted between each appended copy of the template value.</property>
+        <property name="Fifth argument" required="No">Default value returned if no match is found</property>
+    <property name="Sixth argument" required="No">A reference name for reusing the values parsed by this function.<br/>
+        Stored values are ${refName} (the replacement template string) and ${refName_g#} where "#" is the
+        group number from the regular expression ("0" can be used to refer to the entire match).</property>
 </properties>
 </component>
 
-<component index="13.9.2" name="Counter Function">
+<component index="13.9.2" name="__counter">
 <description><p>The counter generates a new number each time it is called, starting with 1
 and incrementing by +1 each time.  The counter can be configured to keep each simulated user's values
 separate, or to use the same counter for all user.  If each user's values is incremented separately,
@@ -973,13 +1127,17 @@ that is like counting the number of iterations through the test plan.  A global
 counting how many times that request was run.</p></description>
 
 <properties>
-	<property name="First argument" required="Yes">TRUE if you wish each simulated user's counter 
-	to be kept independent and separate from the other users.  FALSE for a global counter.</property>
+        <property name="First argument" required="Yes">TRUE if you wish each simulated user's counter
+        to be kept independent and separate from the other users.  FALSE for a global counter.</property>
+
+<property name="Second argument" required="No">A reference name for reusing the value created by this function.<br/>
+                Stored values are of the form ${refName}.  This allows you to keep one counter and refer to its value in
+                multiple places.</property>
 </properties>
 </component>
 
-<component index="13.9.3" name="Thread Number Function">
-<description><p>The thread number function simply returns the number of the thread currently 
+<component index="13.9.3" name="__threadNum">
+<description><p>The thread number function simply returns the number of the thread currently
 being executed.  These numbers are independent of ThreadGroup, meaning thread #1 in one threadgroup
 is indistinguishable from thread #1 in another threadgroup, from the point of view of this function.</p>
 
@@ -987,6 +1145,20 @@ is indistinguishable from thread #1 in another threadgroup, from the point of vi
 </description>
 </component>
 
+<component index="13.9.4" name="__sumInt">
+<description><p>The sumInt function can be used to compute the sum of two or more integer values.
+</p></description>
+
+<properties>
+        <property name="First argument" required="Yes">The first int value.</property>
+        <property name="Second argument" required="Yes">The second int value.</property>
+        <property name="nth argument" required="No">The nth int value.</property>
+        <property name="last argument" required="Yes">A reference name for reusing the value
+                computed by this function.</property>
+</properties>
+</component>
+
 </section>
 </body>
 </document>
+
diff --git a/jakarta-jmeter/xdocs/usermanual/get-started.xml b/jakarta-jmeter/xdocs/usermanual/get-started.xml
index f6814e0..b780320 100644
--- a/jakarta-jmeter/xdocs/usermanual/get-started.xml
+++ b/jakarta-jmeter/xdocs/usermanual/get-started.xml
@@ -29,7 +29,7 @@ over your Test Plans.</p>
 <p>JMeter requires your computing environment meets some minimum requirements.</p>
 
 <subsection name="2.1.1 Java Version" anchor="java_ver">
-<p>JMeter requires a fully compliant JDK1.2 (or higher) environment. Because JMeter uses only
+<p>JMeter (as of version 1.8) requires a fully compliant JDK1.4 (or higher) environment. Because JMeter uses only
 standard Java APIs (java.*), please do not file bug reports if your JRE fails to run
 JMeter because of JRE implementation issues.</p>
 <note>JDK1.4.1Beta appears to be buggy, and there are some GUI elements that won't work correctly in this JVM.</note>
diff --git a/jakarta-jmeter/xdocs/usermanual/remote-test.xml b/jakarta-jmeter/xdocs/usermanual/remote-test.xml
index 3b09fdd..db8be90 100644
--- a/jakarta-jmeter/xdocs/usermanual/remote-test.xml
+++ b/jakarta-jmeter/xdocs/usermanual/remote-test.xml
@@ -9,18 +9,13 @@
 
 <section name="10. Remote Testing">
 
-<p>In most real world web application environments the machine running the web 
-application is not the machine which is sitting on your desk. However to get a 
-true estimate of performance you would like to be measuring the true response 
-time of your server, not any (highly variable) network bottle-necks that might 
-exist between you and the machine on which your web application is running. At 
-the same time using a GUI especially a Java GUI over the network is at best 
-painful (using Un*x and X) and at times not possible (using windows). 
-</p>
-<p>To solve this problem JMeter provides a client-server architecture for load 
-and performance testing which allows the JMeterEngine (the tester) to reside 
-and run on your application server while the configuration GUI and visualization 
-executes on the development machine. This offers a number of features: 
+<p>In the event that your JMeter client machine is unable, performance-wise, to simulate 
+enough users to stress your server, an option exists to control multiple, remote JMeter
+engines from a single JMeter GUI client.  By running JMeter remotely, you can replicate 
+a test across many low-end computers and thus simulate a larger load on the server.  One
+instance of the JMeter GUI client can control any number of remote JMeter instances, and collect
+all the data from them.  This offers the following features: 
+
 
 <ul>
 <li>True performance measurment without network bottlenecks </li>
@@ -28,13 +23,28 @@ executes on the development machine. This offers a number of features:
 <li>Saving of test samples to a local machine </li>
 <li>Managment of multiple JMeterEngines from a single machine </li>
 </ul>
+</p>
 
+<p>Note that while you can indeed execute the JMeterEngine on your application 
+server, you need to be mindful of the fact that this will be adding processing 
+overhead on the application server and thus your testing results will be 
+somewhat tainted.  The recommended approach is to have one or more machines on
+the same Ethernet segment as your application server that you configure to run
+the JMeterEngine.  This will minimize the impact of the network on the test 
+results without impacting the performance of the application serer 
+itself.
 </p>
 
 <p><b>Step 1: Start the RMI Registry</b></p>
 <p>JMeter uses Remote Method Invocation (RMI) as the remote communication mechanism.  Therefore, you need
 to run the RMI Registry application (which is named, "rmiregistry") that comes with the JDK and is located in the "bin" 
-directory.  Before running rmiregistry, make sure that the JMeter's core JAR file (JMETER_HOME/lib/ext/ApacheJMeter_core.jar) is in your CLASSPATH environment variable.  The 
+directory.  Before running rmiregistry, make sure that the following jars are in your system claspath:
+<ul>
+	<li>JMETER_HOME/lib/ext/ApacheJMeter_core.jar</li>
+	<li>JMETER_HOME/lib/jorphan.jar</li>
+	<li>JMETER_HOME/lib/logkit-1.0.1.jar</li>
+</ul>
+The 
 rmiregistry application needs access to certain JMeter classes.  Run rmiregistry with no parameters.  By default the 
 application listens to port 1099.</p>
 
diff --git a/jakarta-jmeter/xdocs/usermanual/test_plan.xml b/jakarta-jmeter/xdocs/usermanual/test_plan.xml
index 5533902..44af0e9 100644
--- a/jakarta-jmeter/xdocs/usermanual/test_plan.xml
+++ b/jakarta-jmeter/xdocs/usermanual/test_plan.xml
@@ -191,13 +191,12 @@ that come with JMeter.</p>
 <subsection name="4.4 Timers" anchor="timers">
 
 <p>By default, a JMeter thread sends requests without pausing between each request.
-We recommend that you specify a delay by adding one of the three timers to
+We recommend that you specify a delay by adding one of the available timers to
 your Thread Group. If you do not add a delay, JMeter could overwhelm your server by
 making too many requests in a very short amount of time.</p>
 
 <p>The timer will cause JMeter to delay a certain amount of time between each
-request that a thread makes.  Remember, threads are independent of one
-another, and this applies to the timer delay as well.</p>
+request that a thread makes.</p>
 
 <p>
 If you choose to add more than one timer to a Thread Group, JMeter takes the sum of
@@ -236,7 +235,7 @@ branch.  For example, we defined two HTTP Request Defaults elements, "Web Defaul
 Since we placed "Web Defaults 1" inside a Loop Controller, only "Web Page 2" can access it.  The other HTTP
 requests will use "Web Defaults 2", since we placed it in the Thread Group (the "parent" of all other branches).</p>
 
-<figure image="../images/screenshots/http-config/http-config-example.gif">Figure 1 -
+<figure image="../images/screenshots/http-config/http-config-example.png">Figure 1 -
 	Test Plan Showing Accessability of Configuration Elements</figure>
 </subsection>
 
